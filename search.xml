<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[åæ§½]]></title>
    <url>%2F2020%2F05%2F24%2F%E5%90%90%E6%A7%BD.html</url>
    <content type="text"><![CDATA[åœæ›´ä¸€ä¸ªæœˆäº†ï¼Œæœ€è¿‘ä¸€ä¸ªæœˆåŸºæœ¬æ²¡çœ‹å¤ªå¤šä¹¦ï¼Œä¸€ç›´åœ¨å¿™ç€åšç®—æ³•è®¾è®¡çš„å®éªŒè¿˜æœ‰å¤„ç†å®¶äº‹å’Œä¸€äº›å…¶ä»–éå¸¸è®©äººçƒ¦å¿ƒçš„äº‹ï¼Œè¶…çº§æ€€å¿µå¯ä»¥ä¸“å¿ƒå­¦ä¹ å’Œå†™åšå®¢çš„æ—¥å­ï¼Œæ‰€å¹¸ï¼Œä¸€åˆ‡éƒ½å‘Šä¸€æ®µè½å•¦ï¼Œ5 æœˆ 28 å·ä¹Ÿè¦å…¥èŒå•¦ï¼Œå¸Œæœ›åœ¨æ¥ä¸‹æ¥çš„æ—¶é—´é‡Œï¼Œè‡ªå·±èƒ½å¤Ÿä¸“å¿ƒå·¥ä½œï¼Œä¸“å¿ƒå†™åšå®¢ï¼Œä¸“å¿ƒåšä¸€äº›æŠ€æœ¯æ²‰æ·€ï¼ŒåŠ æ²¹ğŸ†™]]></content>
  </entry>
  <entry>
    <title><![CDATA[é‡æ„é¡¹ç›®ä»£ç ]]></title>
    <url>%2F2020%2F05%2F05%2F%E4%BA%94%E4%B8%80%E5%81%87%E6%9C%9F%E4%B9%8B%E9%87%8D%E6%9E%84%E9%A1%B9%E7%9B%AE.html</url>
    <content type="text"><![CDATA[å‰è¨€è¶ç€äº”ä¸€å‡æœŸï¼Œè‡ªå·±ä¹Ÿæ²¡å‡ºå»ç©ï¼Œæ‰€ä»¥æœ‰å¤§æŠŠçš„ç©ºé—²æ—¶é—´ï¼Œæƒ³åˆ°é©¬ä¸Šå®ä¹ å»äº†ï¼Œå¯èƒ½é¡¹ç›®è¦äº¤æ¥ï¼Œäºæ˜¯è‡ªå·±å†³å®šé‡æ„ä¸€ä¸‹ä»£ç â€¦ å› ä¸ºæˆ‘æ˜¯åœ¨å¸ˆå…„çš„ä»£ç çš„åŸºç¡€ä¸Šè¿›è¡Œç»´æŠ¤ä¿®æ”¹çš„ï¼Œæ”¹åˆ°åé¢çœŸçš„æ˜¯è¶Šæ¥è¶Šå¤æ‚ï¼Œè¶Šæ¥è¶Šéº»çƒ¦ï¼Œä»¥è‡³äºç°åœ¨æˆ‘éšä¾¿åŠ ç‚¹æ–°åŠŸèƒ½ï¼Œå®Œå…¨æ²¡æœ‰å¯æ‰©å±•æ€§ï¼Œè€Œä¸”ä»£ç æ²¡æœ‰ä»»ä½•å¯è¯»æ€§â€¦æˆ‘éƒ½ä¸çŸ¥é“æˆ‘æ˜¯æ€ä¹ˆè¯»ä¸‹å»è¿™ä¸ªä»£ç å¹¶ä¸”ä¿®æ”¹çš„ï¼Œç®€ç›´å°±æ˜¯åœ¨ â€shiä¸Šé›•èŠ±â€œï¼Œæƒ³æƒ³è¿˜æ˜¯ä¸èƒ½å‘åˆ«äººï¼Œäºæ˜¯ç‹ ä¸‹å¿ƒæ¥ï¼Œå†³å®šå°†åŸæ¥ç”¨ node å†™çš„æ”¹æˆ javaï¼Œè¿˜å¥½ï¼Œä¸€åˆ‡éƒ½æ¯”è¾ƒé¡ºåˆ©ï¼Œç»è¿‡2å¤©çš„é‡æ„ + 1å¤©çš„æµ‹è¯•ï¼Œèƒ½å¤Ÿé¡ºåˆ©è·‘é€šäº†ï¼Œå¦‚æœåæœŸè¦äº¤æ¥çš„è¯ï¼Œå°±å°†è¿™ä»½ä»£ç ä¸Šçº¿â€¦ ä¸ºäº†æœ€å¤§é™åº¦çš„å‡å°‘ä¿®æ”¹å’Œå¯¹å‰æœŸä»£ç çš„å…¼å®¹ï¼Œæˆ‘åªä¿®æ”¹äº† node éƒ¨åˆ†çš„ä»£ç ï¼Œå…¨éƒ¨è½¬æˆ javaï¼Œè¿™æ ·åŒæ—¶ä¹Ÿè§£å†³äº† kafka å¯¹ node æ— æ³•è¿›è¡Œ kerberos åŠ å¯†çš„ç¼ºç‚¹ï¼Œç»ˆäºä¸ç”¨è£¸å¥”äº†â€¦ ä½†æ˜¯ç›®å‰ä»£ç å¯¹è°·æ­ŒéªŒè¯çš„å°å µèƒ½åŠ›è¿˜æ²¡æœ‰è¿›è¡Œè€ƒéªŒï¼Œæ‰€ä»¥ä¸åˆ°ä¸‡ä¸å¾—å·²è¿™ä»½ä»£ç è¿˜æ˜¯ä¸ä¼šä¸Šçº¿çš„â€¦é™¤éçœŸçš„è¦æ·»åŠ æ–°åŠŸèƒ½æˆ–è€…è¦äº¤æ¥â€¦ ç°åœ¨è®°å½•ä¸€ä¸‹åœ¨é‡æ„ä¸­é‡åˆ°çš„ä¸€äº›å°é—®é¢˜ã€‚ã€Œä»£ç ç›´æ¥åœ¨ leetcode å·¥ç¨‹ä¸­å†™çš„ï¼Œæ²¡æœ‰ç‹¬ç«‹å‡ºæ¥ï¼Œæ–‡ä»¶å¤¹åå­—ä¸º ReWrite_xxx_Listã€ é—®é¢˜Q1ï¼šJavaç‰ˆæœ¬çš„ Kafka ä¸­çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œä¸æ”¯æŒ JSONï¼Œè€Œ Python é‚£ä¸ªæ¨¡å—çš„ä»£ç è¦æ±‚ç”¨ json ä¼ é€’æ¶ˆæ¯ æˆ‘å‘ç° Java è¿™è¾¹çš„ Stringï¼Œè¦æƒ³æ­£å¸¸çš„åœ¨ python æ¨¡å—å˜ä¸º jsonï¼Œå°±å¿…é¡»ä½¿å¾— String ä¸­çš„å•å¼•å·å…¨éƒ¨å˜ä¸ºåŒå¼•å·ï¼Œå¦åˆ™å°±æ— æ³•è½¬æ¢ã€Œjson.loads(str) ä¼šæŠ¥é”™ã€ã€‚ ä¾‹å¦‚ï¼š 12&gt; String msg = "&#123;\"params\": \"apple\", \"task_id\": \"W2155_1588604670842_0310\",\"is_cycle\": 0, \"task_type\": 9, \"cron_expression\": \"---\", \"priority \": 1, \"operation\": \"init\", \"quantity\": 100, \"comments\": 0, \"follower\": 0, \"followed\": 0, \"u_id\": \"0452mlppa555\", \"address\": \"0452_m\", \"remain_count\": 50&#125;";&gt; è¿™æ ·å°±æ²¡é—®é¢˜ï¼ŒåŒç†ï¼Œåœ¨æˆ‘å°è¯•æŠ“å–åˆ—è¡¨é¡µçš„ç®€å†çš„ name æ—¶ï¼Œä¹ŸåŒæ ·å‘ç°äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å½“æ—¶æ²¡æœ‰æ³¨æ„åˆ°ï¼Œåœ¨ selenium_test æ–‡ä»¶å¤¹ä¸‹çš„ url_test ä¸­ï¼Œæœ‰ 12&gt; JSONObject resultsJson = (JSONObject) JSONObject.parse(results);&gt; è¦æƒ³å°è¯•è½¬æ¢æˆåŠŸï¼Œå°±å¿…é¡»æŠŠ results ä¸­çš„ å•å¼•å· å…¨éƒ¨æ›¿æ¢æˆ åŒå¼•å·ã€‚ è¯è¯´ï¼Œé€šè¿‡æ­¤æ¬¡é‡æ„ï¼Œå°†è‡ªå·±å‰å‡ å¤©çœ‹çš„ kafka å®Œç¾çš„èå…¥äº†è¿›æ¥ï¼Œç®€ç›´ç¾æ»‹æ»‹â€¦ Q2ï¼šé‡åˆ°çš„ç¬¬ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå…¶å®è¿˜æ˜¯è€ƒè™‘å¦‚ä½•å°†ç™»å½•åçš„ç•Œé¢æ‹¿åˆ°ï¼Œå› ä¸ºæˆ‘åç»­çš„æ“ä½œéƒ½æ˜¯è¦åŸºäºå·²ç»ç™»å½•åçš„è¿™ä¸ªæ ‡ç­¾é¡µçš„ è¿™çš„ç¡®æ˜¯ä¸€ä¸ªéš¾é¢˜ï¼Œæˆ‘è¿™è¾¹æœ€åçš„åšæ³•æ˜¯å°† driver è¿™ä¸ªchromeçš„é©±åŠ¨å˜ä¸ºä¸€ä¸ª static volatileï¼Œè¿™æ ·åœ¨å¤šçº¿ç¨‹æ“ä½œçš„æ—¶å€™ï¼Œèƒ½å¤ŸåŒæ­¥ driver çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ª Crawl ç±»åªæœ‰ä¸€ä¸ª driver å®ä¾‹ï¼Œè€Œä¸”æˆ‘ç”¨äº†å•ä¾‹æ¨¡å¼ä¸‹çš„é¥¿æ±‰æ¨¡å¼ï¼Œç›´æ¥åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–çš„æ—¶å€™å°±å°† driver è¿›è¡Œå®ä¾‹åŒ–äº†ï¼Œlogin() æ‰§è¡Œçš„æ—¶å€™æ˜¯æ‹¿åˆ°å”¯ä¸€çš„ driver å®ä¾‹ï¼Œç„¶ååæœŸ crawl çš„æ—¶å€™ï¼Œç”±äºæ˜¯å•ä¾‹åŒ–çš„ï¼Œæ‰€ä»¥å¿…ç„¶ä¹Ÿæ˜¯æ‹¿åˆ°åŒä¸€ä¸ª driverï¼Œæ©ï¼Œæˆ‘çœŸæ˜¯ä¸ªå¤©æ‰â€¦ Q3ï¼šæœ€è´¹æ—¶é—´çš„è¿˜æ˜¯è¦å¯¹ python æ¨¡å—è¿›è¡Œä¸€ä¸ªå®Œæ•´çš„å¯¹æ¥ åœ¨ä¸æ”¹å˜ pythonæ¨¡å—çš„ä»£ç çš„å‰æä¸‹ï¼Œè¿›è¡Œä»£ç çš„é‡æ„ï¼Œè¿™çš„ç¡®æœ‰ç‚¹æµªè´¹æ—¶é—´ï¼Œå°¤å…¶æ˜¯è¦è€ƒè™‘åˆ° kafka æ¶ˆæ¯ä¼ é€’çš„ä¸å˜ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæ¯”è¾ƒèŠ±è´¹æ—¶é—´å§.. Q4ï¼šå¦‚ä½•å¯åŠ¨çˆ¬è™«çš„ æˆ‘æ˜¯ç›´æ¥å°†ä¸šåŠ¡å…¨éƒ¨å†™åœ¨ Consumer è¿™ä¸ªç±»ä¸­äº†ï¼Œç„¶å Crawl è¿™ä¸ªç±»å°±è´Ÿè´£è¿›è¡Œç™»å½•ã€çˆ¬å–ç­‰æ“ä½œï¼Œå…¶ä¸­ï¼ŒConsumer ç±»ä¸­ç›´æ¥é€šè¿‡çº¿ç¨‹æ± è°ƒç”¨ Crawl ä¸­çš„æ–¹æ³•ï¼Œå¹¶é€šè¿‡ future.get() è¿›è¡Œç»“æœçš„è·å–ã€‚ Producer è¿™ä¸ªç±»è´Ÿè´£è¿›è¡Œä»»åŠ¡çš„å‘é€ï¼Œè€Œ Utils åˆ™æ˜¯åŒ…å«ä¸€äº›å·¥å…·æ–¹æ³•ï¼Œæ¯”å¦‚å¯¹ keyword çš„å¤„ç†ï¼Œè¯´åˆ°å¯¹ keyword çš„å¤„ç†ï¼Œä¸»è¦è¿˜æ˜¯è¦æ»¡è¶³ url ç¼–ç çš„è§„èŒƒï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œä¸€å®šçš„å¤„ç†ã€‚ Q5ï¼šæŠ“å–åå­—æ˜¯æŠ“å– html è¿˜æ˜¯é€šè¿‡ rpc è·å–ï¼Ÿ ç»è¿‡è‡ªå·±çš„æµ‹è¯•ï¼Œè¿˜æ˜¯ rpc çš„é è°±ä¸€äº›ï¼Œä½†æ˜¯ä¸¤è€…éƒ½ä¸å¤Ÿé è°±â€¦ 123&gt; // 1. é€šè¿‡ rpcï¼Œè¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯å½“é¡µé¢ä¸€ç›´å¤„äº loading çŠ¶æ€å¹¶ä¸”æ— æ³•åŠ è½½æ•°æ®æ—¶ï¼Œé€šè¿‡ rpc åè€Œå¯ä»¥è·å¾—æ•°æ®ï¼Œåå¤„å°±æ˜¯æœ‰çš„æ—¶å€™é¡µé¢åŠ è½½å‡ºæ¥äº†æ•°æ®ä½†æ˜¯å´æ‹¦æˆªä¸åˆ°è¯¥è¯·æ±‚&gt; // 2. ç›´æ¥é€šè¿‡é¡µé¢æŠ“å–æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œå¥½å¤„å°±æ˜¯ä¸ç”¨æ‰¿æ‹… rpc å¯èƒ½æ‹¦æˆªä¸åˆ°çš„é£é™©ï¼Œåå¤„å°±æ˜¯æœ‰çš„æ—¶å€™ä¼š loadingï¼Œå¯¼è‡´æŠ“ä¸åˆ°æ•°æ®&gt; æ„Ÿè§‰æœ€å¥½çš„æ–¹å¼æ˜¯ï¼šå…ˆè¿›è¡Œé¡µé¢çš„æŠ“å–ï¼Œå¦‚æœå‘ç°æ˜¯ loading çŠ¶æ€ï¼Œåˆ™è½¬ä¸º rpc è°ƒç”¨ï¼Œä¸¤è€…éƒ½æ²¡æœ‰æ•°æ®ï¼Œè¯´æ˜ no matchã€‚ æ‡’å¾—è¯•äº†â€¦åˆ°æ—¶å€™å¦‚æœè¦ä¸Šçº¿ï¼Œå†è¯•è¯•â€¦ Q6ï¼š java ä¸­å¦‚ä½•ä½¿ç”¨ webdriverï¼Ÿ http://www.testclass.net/selenium_java ä¸»è¦æ˜¯å‚è€ƒè¿™ä¸ªç½‘å€ï¼Œå‰©ä¸‹çš„çœ‹chromeä¸­çš„ â€å…¶ä»–ä¹¦ç­¾â€œ Q7ï¼šè®¾ç½® cookieï¼Œä¸éœ€è¦å†ç™»å½•äº† æ”¶è· å¯¹ kafka å’Œ java çš„å¯¹æ¥çš„ç†Ÿæ‚‰ï¼Œç›´æ¥å°†å‰å‡ å¤©çœ‹çš„å…¨éƒ¨ç»™ç”¨ä¸Šäº†ï¼Œé¡ºå¸¦è‡ªå·±å†™äº†ä¸ªè‡ªå®šä¹‰çš„åºåˆ—åŒ–å™¨ã€‚ çº¿ç¨‹æ± ã€seleniumçš„è¿ç”¨ã€requestçš„è¿ç”¨ï¼Œä»¥å‰éƒ½åªæ˜¯åœ¨ python ä¸­ç”¨ï¼Œç°åœ¨æ„Ÿè§‰åœ¨ java ä¸­ä¹ŸåŒæ ·æ˜¯ååˆ†æ–¹ä¾¿çš„ã€‚ è‡ªå·±é¡ºå¸¦é‡å†™äº†ä¸ª request æœ‰å…³çš„å·¥å…·ç±»ï¼Œé‡Œé¢æœ‰å¾ˆå¤šå®ç”¨çš„å·¥å…·æ–¹æ³•ï¼Œåœ¨ leetcode æ–‡ä»¶å¤¹ä¸‹çš„ çˆ¬è™«demoã€‚ å¯¹ä¸šåŠ¡çš„å†æ¬¡ç†Ÿæ‚‰ï¼Œæ„Ÿè§‰ä¸€æ•´å¥—ä¸‹æ¥ï¼Œé€»è¾‘å·²ç»æ˜¯éå¸¸æ¸…æ™°äº†ï¼Œæˆ‘çš„ä»£ç è‡ªå·±è§‰å¾—å†™çš„ä¹Ÿæ˜¯å¾ˆæ¸…æ™°çš„ï¼Œç»ˆäºä¸ç”¨æ‹…å¿ƒäº¤æ¥çš„æ—¶å€™å‘åˆ«äººäº†â€¦ æœ€å¤§çš„æ”¶è·å½“ç„¶æ˜¯æ›´åŠ è‡ªä¿¡äº†ï¼Œæ„Ÿè§‰å†™èµ·æ¥è¿˜æ˜¯æŒºç®€å•çš„ï¼Œä»¥å‰èŠ±äº†ä¸ªæŠŠæœˆæ‰ç†Ÿæ‚‰çš„ nodeï¼Œç”¨ java å†™ä¸¤å¤©ä¸åˆ°å°±æå®šäº†ï¼Œæœ€ç»ˆå¯èƒ½è¿™ä»½ä»£ç ä¹Ÿç”¨ä¸ä¸Šï¼Œä½†æ˜¯ç»™è‡ªå·±çš„ä¿¡å¿ƒæ˜¯å®æ‰“å®çš„ï¼ è¿˜éœ€è¦åšçš„å·¥ä½œ å°†è¯¥å·¥ç¨‹ç‹¬ç«‹å‡ºå»ï¼Œå½¢æˆä¸€ä¸ªmavenç®¡ç†çš„å•ç‹¬çš„å·¥ç¨‹ è·ŸåŸæ¥çš„éƒ¨åˆ†ä»£ç å¯¹æ¥å¥½ï¼Œå°¤å…¶æ˜¯ topic ä¸è¦å¼„é”™äº† ã€Œå·²å®Œæˆã€ åŠ å¯†åè®®å†™å¥½ ã€Œchangze é‚£è¾¹å·²ç»å†™å®Œäº†ã€ æœåŠ¡å™¨ä¸Šçš„æŸäº›ä¸œè¥¿å’Œmacæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚ chromeDriver çš„åœ°å€éœ€è¦æ”¹åŠ¨ï¼Œè¿˜æœ‰å°±æ˜¯ä»˜è´¹è´¦å·æ˜¯æ‹¥æœ‰çœŸå®å§“åï¼Œæ‰€ä»¥åœ¨é€šè¿‡keywordçš„ç¬¬äºŒç§æ–¹æ³•è·å–åå­—æ—¶ï¼ŒclassName æ˜¯æœ‰å˜åŒ–çš„ ã€Œäº†è§£äº†ã€ å°½é‡å‡å°‘è°·æ­ŒéªŒè¯å‡ºç°çš„æ¬¡æ•° å†™ä¸€ä¸ª ReadMe.txt ã€Œå·²å®Œæˆã€ å¥½äº†ï¼Œé¡¹ç›®è¿™å—å°±è¿™æ ·äº†â€¦ å¾—æŠ“ç´§æ—¶é—´å†™ä¸€ä¸‹å®éªŒå’Œå¤ä¹ è€ƒè¯•ç§‘ç›®äº†â€¦ åŠ æ²¹ï¼ï¼ï¼]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£ kafkaï¼ˆä¸‰ï¼‰]]></title>
    <url>%2F2020%2F04%2F29%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20kafka%EF%BC%88%E4%B8%89%EF%BC%89.html</url>
    <content type="text"><![CDATA[ç¬¬å››ç«  ä¸»é¢˜å’Œåˆ†åŒºä»Kafkaçš„åº•å±‚å®ç°æ¥è¯´ï¼Œä¸»é¢˜å’Œåˆ†åŒºéƒ½æ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œåˆ†åŒºå¯ä»¥æœ‰ä¸€è‡³å¤šä¸ªå‰¯æœ¬ï¼Œæ¯ä¸ªå‰¯æœ¬å¯¹åº”ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œæ¯ä¸ªæ—¥å¿—æ–‡ä»¶å¯¹åº”ä¸€è‡³å¤šä¸ªæ—¥å¿—åˆ†æ®µï¼ˆLogSegmentï¼‰ï¼Œæ¯ä¸ªæ—¥å¿—åˆ†æ®µè¿˜å¯ä»¥ç»†åˆ†ä¸ºç´¢å¼•æ–‡ä»¶ã€æ—¥å¿—å­˜å‚¨æ–‡ä»¶å’Œå¿«ç…§æ–‡ä»¶ç­‰ã€‚ ä¸»é¢˜çš„ç®¡ç†ä¸»é¢˜çš„ç®¡ç†åŒ…æ‹¬åˆ›å»ºä¸»é¢˜ã€æŸ¥çœ‹ä¸»é¢˜ä¿¡æ¯ã€ä¿®æ”¹ä¸»é¢˜å’Œåˆ é™¤ä¸»é¢˜ç­‰æ“ä½œã€‚å¯ä»¥é€šè¿‡ kafka æä¾›çš„ kafka-topics.sh è„šæœ¬æˆ–è€… KafkaAdminClient çš„æ–¹å¼æ¥å®ç°ã€‚ è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬ä¸»è¦è®² kafka-topics.sh çš„å®ç°ã€‚ åˆ›å»ºä¸»é¢˜é¦–å…ˆå»ºè®®å…ˆå°†brokerç«¯é…ç½®å‚æ•°auto.create.topics.enableè®¾ç½®ä¸ºfalseï¼ˆé»˜è®¤å€¼å°±æ˜¯trueï¼‰ï¼Œå› ä¸ºå¦‚æœæ˜¯é»˜è®¤å€¼ï¼Œå½“ç”Ÿäº§è€…æˆ–è€…æ¶ˆè´¹è€…ä¸ä¸€ä¸ªä¸å­˜åœ¨çš„ä¸»é¢˜æœ‰å…³ç³»æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºè¯¥ topicï¼Œè¿™ç§è‡ªåŠ¨åˆ›å»ºä¸»é¢˜çš„è¡Œä¸ºæ˜¯éé¢„æœŸçš„ï¼Œä¼šå¢åŠ ä¸»é¢˜çš„ç®¡ç†ä¸ç»´æŠ¤çš„éš¾åº¦ï¼Œæ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æœ€å¥½ä¸è¦è¿™æ ·ã€‚ æ›´åŠ æ¨èçš„æ–¹å¼æ˜¯é€šè¿‡ kafka-topics.sh è„šæœ¬æ¥åˆ›å»ºä¸»é¢˜ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š æˆ‘ä»¬ä¸ä»…å¯ä»¥é€šè¿‡æ—¥å¿—æ–‡ä»¶çš„æ ¹ç›®å½•æ¥æŸ¥çœ‹é›†ç¾¤ä¸­å„ä¸ªbrokerçš„åˆ†åŒºå‰¯æœ¬çš„åˆ†é…æƒ…å†µï¼Œè¿˜å¯ä»¥é€šè¿‡ZooKeeperå®¢æˆ·ç«¯æ¥è·å–ã€‚å½“åˆ›å»ºä¸€ä¸ªä¸»é¢˜æ—¶ä¼šåœ¨ZooKeeperçš„/brokers/topics/ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåŒåçš„å®èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¸­è®°å½•äº†è¯¥ä¸»é¢˜çš„åˆ†åŒºå‰¯æœ¬åˆ†é…æ–¹æ¡ˆã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼šï¿¼ ç¤ºä¾‹æ•°æ®ä¸­çš„â€2â€ï¼š[1ï¼Œ2]è¡¨ç¤ºåˆ†åŒº 2 åˆ†é…äº† 2 ä¸ªå‰¯æœ¬ï¼Œåˆ†åˆ«åœ¨ brokerId ä¸º 1 å’Œ 2 çš„ brokerèŠ‚ç‚¹ä¸­ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåˆ›å»ºä¸»é¢˜æ—¶çš„åˆ†åŒºå‰¯æœ¬éƒ½æ˜¯æŒ‰ç…§æ—¢å®šçš„å†…éƒ¨é€»è¾‘æ¥è¿›è¡Œåˆ†é…çš„ã€‚ kafka-topics.sh è„šæœ¬ä¸­è¿˜æä¾›äº†ä¸€ä¸ª replica-assignment å‚æ•°æ¥æ‰‹åŠ¨æŒ‡å®šåˆ†åŒºå‰¯æœ¬çš„åˆ†é…æ–¹æ¡ˆï¼Œå¦‚å›¾æ‰€ç¤ºï¼š æ³¨æ„äº‹é¡¹ï¼š ä¸»é¢˜çš„å‘½ååŒæ ·ä¸æ¨èï¼ˆè™½ç„¶å¯ä»¥è¿™æ ·åšï¼‰ä½¿ç”¨åŒä¸‹ç”»çº¿â€œâ€å¼€å¤´ï¼Œå› ä¸ºä»¥åŒä¸‹ç”»çº¿å¼€å¤´çš„ä¸»é¢˜ä¸€èˆ¬çœ‹ä½œKafkaçš„å†…éƒ¨ä¸»é¢˜ï¼Œæ¯”å¦‚consumer_offsetså’Œ__transaction_stateã€‚ åˆ†åŒºå‰¯æœ¬çš„åˆ†é…è¿™é‡Œçš„åˆ†åŒºåˆ†é…ï¼Œè·Ÿå‰é¢çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åˆ†åŒºåˆ†é…ä¸ä¸€æ ·ã€‚ç”Ÿäº§è€…çš„åˆ†åŒºåˆ†é…æ˜¯æŒ‡ä¸ºæ¯æ¡æ¶ˆæ¯æŒ‡å®šå…¶æ‰€è¦å‘å¾€çš„åˆ†åŒºï¼Œæ¶ˆè´¹è€…ä¸­çš„åˆ†åŒºåˆ†é…æ˜¯æŒ‡ä¸ºæ¶ˆè´¹è€…æŒ‡å®šå…¶å¯ä»¥æ¶ˆè´¹æ¶ˆæ¯çš„åˆ†åŒºï¼Œè€Œè¿™é‡Œçš„åˆ†åŒºåˆ†é…æ˜¯æŒ‡ä¸ºé›†ç¾¤åˆ¶å®šåˆ›å»ºä¸»é¢˜æ—¶çš„åˆ†åŒºå‰¯æœ¬åˆ†é…æ–¹æ¡ˆï¼Œå³åœ¨å“ªä¸ªbrokerä¸­åˆ›å»ºå“ªäº›åˆ†åŒºçš„å‰¯æœ¬ã€‚ åœ¨åˆ›å»ºä¸»é¢˜æ—¶ï¼Œå¦‚æœä½¿ç”¨äº†replica-assignmentå‚æ•°ï¼Œé‚£ä¹ˆå°±æŒ‰ç…§æŒ‡å®šçš„æ–¹æ¡ˆæ¥è¿›è¡Œåˆ†åŒºå‰¯æœ¬çš„åˆ›å»ºï¼›å¦‚æœæ²¡æœ‰ä½¿ç”¨replica-assignmentå‚æ•°ï¼Œé‚£ä¹ˆå°±éœ€è¦æŒ‰ç…§å†…éƒ¨çš„é€»è¾‘æ¥è®¡ç®—åˆ†é…æ–¹æ¡ˆäº†ã€‚ ä½¿ç”¨kafka-topics.shè„šæœ¬åˆ›å»ºä¸»é¢˜æ—¶çš„å†…éƒ¨åˆ†é…é€»è¾‘æŒ‰ç…§æœºæ¶ä¿¡æ¯åˆ’åˆ†æˆä¸¤ç§ç­–ç•¥ï¼šæœªæŒ‡å®šæœºæ¶ä¿¡æ¯å’ŒæŒ‡å®šæœºæ¶ä¿¡æ¯ã€‚é»˜è®¤å°±æ˜¯ æœªæŒ‡å®šæœºæ¶ä¿¡æ¯çš„åˆ†é…ç­–ç•¥ã€Œå³ broker.rack å‚æ•°ä¸º nullã€ã€‚ æŸ¥çœ‹ä¸»é¢˜åœ¨ kafka-topics.sh ä¸­ä½¿ç”¨ list æˆ–è€… describe å°±å¯ä»¥æŸ¥çœ‹ä¸»é¢˜ä¿¡æ¯ã€‚list å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„å½“å‰å¯ç”¨ä¸»é¢˜ï¼Œ describe å¯ä»¥æŸ¥çœ‹å•ä¸ªä¿¡æ¯çš„ä¸»é¢˜çš„è¯¦ç»†ä¿¡æ¯ã€‚]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
        <category>kafka ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£ kafkaï¼ˆäºŒï¼‰]]></title>
    <url>%2F2020%2F04%2F25%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20kafka%EF%BC%88%E4%BA%8C%EF%BC%89.html</url>
    <content type="text"><![CDATA[ç¬¬äºŒç«  ç”Ÿäº§è€…å®¢æˆ·ç«¯å¼€å‘12345678910111213141516171819202122232425262728293031323334353637383940package Kafka.Demo1;import org.apache.kafka.clients.Metadata;import org.apache.kafka.clients.producer.KafkaProducer;import org.apache.kafka.clients.producer.ProducerConfig;import org.apache.kafka.clients.producer.ProducerRecord;import org.apache.kafka.clients.producer.RecordMetadata;import org.apache.kafka.common.serialization.StringSerializer;import java.util.Properties;import java.util.concurrent.Future;public class ProducerFastStart &#123; public static final String brokerList = "localhost:9092"; public static final String topic = "topic-demo"; public static void main(String[] args) &#123; Properties properties = new Properties();// properties.put("key.serializer","org.apache.kafka.common.serialization.StringSerializer"); properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());// properties.put("value.serializer","org.apache.kafka.common.serialization.StringSerializer"); properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,StringSerializer.class.getName()); properties.put("bootstrap.servers",brokerList); KafkaProducer&lt;String,String&gt; producer = new KafkaProducer&lt;String, String&gt;(properties); // æ„é€ è¦å‘é€çš„æ¶ˆæ¯ ProducerRecord&lt;String, String&gt; record = new ProducerRecord&lt;&gt;(topic,"hello,baby"); // å‘é€æ¶ˆæ¯ try&#123; Future&lt;RecordMetadata&gt; future = producer.send(record); RecordMetadata recordMetadata = future.get(); System.out.println(recordMetadata.topic() + "-" + recordMetadata.partition() + "-" + recordMetadata.offset()); &#125; catch (Exception e)&#123; e.printStackTrace(); &#125; producer.close(); &#125;&#125; ç”±ä¸Šè¿°ä»£ç å¯çŸ¥ï¼Œåœ¨ç”Ÿäº§è€…å®¢æˆ·ç«¯ï¼Œä¸€ä¸ªæ­£å¸¸çš„ç”Ÿäº§é€»è¾‘éœ€è¦å…·å¤‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š é…ç½®ç”Ÿäº§è€…å®¢æˆ·ç«¯å‚æ•°åŠåˆ›å»ºç›¸åº”çš„ç”Ÿäº§è€…å®ä¾‹ã€‚ æ„å»ºå¾…å‘é€çš„æ¶ˆæ¯ã€‚ å‘é€æ¶ˆæ¯ã€‚ å…³é—­ç”Ÿäº§è€…å®ä¾‹ã€‚ é…ç½®ç”Ÿäº§è€…å®¢æˆ·ç«¯å‚æ•°åŠåˆ›å»ºç”Ÿäº§è€…å®ä¾‹é¦–å…ˆæ˜¯æœ‰ä¸‰ä¸ªå¿…é¡»é…ç½®çš„å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ bootstrap.serversã€key.serializerã€value.serializerã€‚ Bootstrap.servers è¯¥å‚æ•°ç”¨æ¥æŒ‡å®šç”Ÿäº§è€…å®¢æˆ·ç«¯è¿æ¥Kafkaé›†ç¾¤æ‰€éœ€çš„brokeråœ°å€æ¸…å•ã€‚æ³¨æ„è¿™é‡Œå¹¶ééœ€è¦æ‰€æœ‰çš„brokeråœ°å€ï¼Œå› ä¸ºç”Ÿäº§è€…ä¼šä»ç»™å®šçš„brokeré‡ŒæŸ¥æ‰¾åˆ°å…¶ä»–brokerçš„ä¿¡æ¯ã€‚ä¸è¿‡å»ºè®®è‡³å°‘è¦è®¾ç½®ä¸¤ä¸ªä»¥ä¸Šçš„broker åœ°å€ä¿¡æ¯ï¼Œå½“å…¶ä¸­ä»»æ„ä¸€ä¸ªå®•æœºæ—¶ï¼Œç”Ÿäº§è€…ä»ç„¶å¯ä»¥è¿æ¥åˆ° Kafkaé›†ç¾¤ä¸Šã€‚ key.serializer &amp; value.serializer broker ç«¯æ¥æ”¶çš„æ¶ˆæ¯å¿…é¡»ä»¥å­—èŠ‚æ•°ç»„ï¼ˆbyte[]ï¼‰çš„å½¢å¼å­˜åœ¨ã€‚åœ¨å‘å¾€brokerä¹‹å‰éœ€è¦å°†æ¶ˆæ¯ä¸­å¯¹åº”çš„keyå’Œvalueåšç›¸åº”çš„åºåˆ—åŒ–æ“ä½œæ¥è½¬æ¢æˆå­—èŠ‚æ•°ç»„ã€‚key.serializerå’Œvalue.serializerè¿™ä¸¤ä¸ªå‚æ•°åˆ†åˆ«ç”¨æ¥æŒ‡å®škeyå’Œvalueåºåˆ—åŒ–æ“ä½œçš„åºåˆ—åŒ–å™¨ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ— é»˜è®¤å€¼ã€‚æ³¨æ„è¿™é‡Œå¿…é¡»å¡«å†™åºåˆ—åŒ–å™¨çš„å…¨é™å®šåã€‚ é…ç½®å®Œå‚æ•°ä¹‹åï¼Œç›´æ¥åˆ›å»ºç”Ÿäº§è€…å®ä¾‹å°±å¯ä»¥äº†ï¼Œæ³¨æ„è¿™é‡Œçš„ KafkaProducer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«å•ä¸ªKafkaProducerå®ä¾‹ï¼Œä¹Ÿå¯ä»¥å°†KafkaProducerå®ä¾‹è¿›è¡Œæ± åŒ–æ¥ä¾›å…¶ä»–çº¿ç¨‹è°ƒç”¨ã€‚ æ¶ˆæ¯çš„å‘é€æ¶ˆæ¯çš„å‘é€æœ‰ä¸‰ç§æ–¹å¼ï¼š å‘åå³å¿˜ã€‚ä¹Ÿå°±æ˜¯ç›´æ¥æ˜¾å¼è°ƒç”¨ producer.send(record)ï¼Œä¸å…³å¿ƒæ¶ˆæ¯æ˜¯å¦æ­£ç¡®åˆ°è¾¾æœåŠ¡å™¨ç«¯ï¼› åŒæ­¥ã€‚producer.send(record) çš„è¿”å›ç±»å‹ä¸º Future&lt;RecordMetadata&gt;ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ future.get() è¿›è¡ŒåŒæ­¥ï¼ŒRecordMetadata å¯¹è±¡åŒ…å«äº†æ¶ˆæ¯çš„ä¸€äº›å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚å½“å‰æ¶ˆæ¯çš„ä¸»é¢˜ã€åˆ†åŒºå·ã€åˆ†åŒºä¸­çš„åç§»é‡ã€æ—¶é—´æˆ³ç­‰ç­‰ã€‚ å¼‚æ­¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç›´æ¥åœ¨ send() ä¸­ä½¿ç”¨å›è°ƒå‡½æ•°ã€‚ æ¶ˆæ¯åœ¨é€šè¿‡ send() æ–¹æ³•å‘å¾€brokerçš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½éœ€è¦ç»è¿‡æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ã€åºåˆ—åŒ–å™¨ï¼ˆSerializerï¼‰å’Œåˆ†åŒºå™¨ï¼ˆPartitionerï¼‰çš„ä¸€ç³»åˆ—ä½œç”¨ä¹‹åæ‰èƒ½è¢«çœŸæ­£åœ°å‘å¾€ brokerã€‚ç”Ÿäº§è€…æ‹¦æˆªå™¨å¯ä»¥ç”¨æ¥åœ¨æ¶ˆè´¹æ¶ˆæ¯é’±åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œç„¶åæ¶ˆæ¯ç»è¿‡åºåˆ—åŒ–ä¹‹åå°±éœ€è¦ç¡®å®šå®ƒå‘å¾€çš„åˆ†åŒºï¼Œå¦‚æœæ¶ˆæ¯ProducerRecordä¸­æŒ‡å®šäº†partitionå­—æ®µï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦åˆ†åŒºå™¨çš„ä½œç”¨ï¼Œå› ä¸ºpartitionä»£è¡¨çš„å°±æ˜¯æ‰€è¦å‘å¾€çš„åˆ†åŒºå·ã€‚ æ‹¦æˆªå™¨ï¼Œä¸€èˆ¬ä¸æ˜¯å¿…éœ€çš„ã€‚ç”Ÿäº§è€…æ‹¦æˆªå™¨æ—¢å¯ä»¥ç”¨æ¥åœ¨æ¶ˆæ¯å‘é€å‰åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œæ¯”å¦‚æŒ‰ç…§æŸä¸ªè§„åˆ™è¿‡æ»¤ä¸ç¬¦åˆè¦æ±‚çš„æ¶ˆæ¯ã€ä¿®æ”¹æ¶ˆæ¯çš„å†…å®¹ç­‰ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥åœ¨å‘é€å›è°ƒé€»è¾‘å‰åšä¸€äº›å®šåˆ¶åŒ–çš„éœ€æ±‚ï¼Œæ¯”å¦‚ç»Ÿè®¡ç±»å·¥ä½œã€‚KafkaProducerä¸­ä¸ä»…å¯ä»¥æŒ‡å®šä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œè¿˜å¯ä»¥æŒ‡å®šå¤šä¸ªæ‹¦æˆªå™¨ä»¥å½¢æˆæ‹¦æˆªé“¾ã€‚ ç”Ÿäº§è€…éœ€è¦ç”¨åºåˆ—åŒ–å™¨ï¼ˆSerializerï¼‰æŠŠå¯¹è±¡è½¬æ¢æˆå­—èŠ‚æ•°ç»„æ‰èƒ½é€šè¿‡ç½‘ç»œå‘é€ç»™Kafkaï¼Œè¿™æ˜¯å¿…é¡»çš„ã€‚ åˆ†åŒºå™¨çš„ä½œç”¨å°±æ˜¯ä¸ºæ¶ˆæ¯åˆ†é…åˆ†åŒºã€‚å¦‚æœæ¶ˆæ¯ProducerRecordä¸­æ²¡æœ‰æŒ‡å®špartitionå­—æ®µï¼Œé‚£ä¹ˆå°±éœ€è¦ä¾èµ–åˆ†åŒºå™¨ï¼Œæ ¹æ®keyè¿™ä¸ªå­—æ®µæ¥è®¡ç®—partitionçš„å€¼ã€‚å¦‚æœkeyä¸ºnullï¼Œé‚£ä¹ˆæ¶ˆæ¯å°†ä¼šä»¥è½®è¯¢çš„æ–¹å¼å‘å¾€ä¸»é¢˜å†…çš„å„ä¸ªå¯ç”¨åˆ†åŒºã€‚ åŸç†åˆ†æåœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†KafkaProducerçš„å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼Œè€Œæœ¬èŠ‚çš„å†…å®¹ä¸»è¦æ˜¯å¯¹Kafka ç”Ÿäº§è€…å®¢æˆ·ç«¯çš„å†…éƒ¨åŸç†è¿›è¡Œåˆ†æï¼Œé€šè¿‡äº†è§£ç”Ÿäº§è€…å®¢æˆ·ç«¯çš„æ•´ä½“è„‰ç»œå¯ä»¥è®©æˆ‘ä»¬æ›´å¥½åœ°ä½¿ç”¨å®ƒï¼Œé¿å…å› ä¸ºä¸€äº›ç†è§£ä¸Šçš„åå·®è€Œé€ æˆä½¿ç”¨ä¸Šçš„é”™è¯¯ã€‚ æ•´ä½“æ¶æ„ ç”±å‰ä¸€å°ç»“å¯çŸ¥ï¼Œç”Ÿäº§è€…å®¢æˆ·ç«¯çš„send()æ˜¯å¼‚æ­¥çš„ï¼Œè¯´æ˜æœ‰ä¸¤ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œä¹Ÿå°±æ˜¯ä¸»çº¿ç¨‹å’Œsendçº¿ç¨‹ã€‚åœ¨ä¸»çº¿ç¨‹ä¸­ç”±KafkaProduceråˆ›å»ºæ¶ˆæ¯ï¼Œç„¶åé€šè¿‡å¯èƒ½çš„æ‹¦æˆªå™¨ã€åºåˆ—åŒ–å™¨å’Œåˆ†åŒºå™¨çš„ä½œç”¨ä¹‹åç¼“å­˜åˆ°æ¶ˆæ¯ç´¯åŠ å™¨ï¼ˆRecordAccumulatorï¼Œä¹Ÿç§°ä¸ºæ¶ˆæ¯æ”¶é›†å™¨ï¼‰ä¸­ã€‚Sender çº¿ç¨‹è´Ÿè´£ä»RecordAccumulatorä¸­è·å–æ¶ˆæ¯å¹¶å°†å…¶å‘é€åˆ°Kafkaä¸­ã€‚RecordAccumulator çš„å†…éƒ¨ä¸ºæ¯ä¸ªåˆ†åŒºéƒ½ç»´æŠ¤äº†ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­çš„å†…å®¹å°±æ˜¯ProducerBatchï¼ŒProducerBatchä¸­å¯ä»¥åŒ…å«ä¸€è‡³å¤šä¸ª ProducerRecordã€‚æ‰€ä»¥æˆ‘ä»¬å…¶å®æœ€ç»ˆå‘é€çš„æ¶ˆæ¯æ˜¯ ProducerBatchã€‚ å…ƒæ•°æ®çš„æ›´æ–°å…ƒæ•°æ®æ˜¯æŒ‡Kafkaé›†ç¾¤çš„å…ƒæ•°æ®ï¼Œè¿™äº›å…ƒæ•°æ®å…·ä½“è®°å½•äº†é›†ç¾¤ä¸­æœ‰å“ªäº›ä¸»é¢˜ï¼Œè¿™äº›ä¸»é¢˜æœ‰å“ªäº›åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºçš„leaderå‰¯æœ¬åˆ†é…åœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šï¼Œfollowerå‰¯æœ¬åˆ†é…åœ¨å“ªäº›èŠ‚ç‚¹ä¸Šï¼Œå“ªäº›å‰¯æœ¬åœ¨ARã€ISRç­‰é›†åˆä¸­ï¼Œé›†ç¾¤ä¸­æœ‰å“ªäº›èŠ‚ç‚¹ï¼Œæ§åˆ¶å™¨èŠ‚ç‚¹åˆæ˜¯å“ªä¸€ä¸ªç­‰ä¿¡æ¯ã€‚ åœ¨ä¸Šé¢çš„ç¬¬ 8 æ­¥ä¹‹å‰ï¼Œæˆ‘ä»¬è¦æŒ‘å‡ºè´Ÿè½½æœ€å°çš„ brokerã€Œæ¯ä¸ªNodeåœ¨InFlightRequestsä¸­è¿˜æœªç¡®è®¤çš„è¯·æ±‚æ•°å†³å®šçš„ï¼Œæœªç¡®è®¤çš„è¯·æ±‚è¶Šå¤šåˆ™è®¤ä¸ºè´Ÿè½½è¶Šå¤§ã€ï¼Œè¿™æ ·å°±èƒ½å¤Ÿå°½å¿«çš„å‘å‡ºï¼Œå› ä¸ºåœ¨å‘å‡ºçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å…ˆè·å¾—å¯¹åº”çš„ partition åœ¨å“ªä¸ª brokerã€broker æ˜¯å“ªä¸ªipï¼Œæ‰€ä»¥åœ¨å‘å‡ºä¹‹å‰é¦–å…ˆè¦è¿›è¡Œå…ƒæ•°æ®çš„æ›´æ–°ï¼Œè¿™é‡Œæˆ‘ä»¬è‚¯å®šæ˜¯å…ˆæŒ‘é€‰å‡ºleastLoadedNodeï¼Œç„¶åå‘è¿™ä¸ªNodeå‘é€MetadataRequestè¯·æ±‚æ¥è·å–å…·ä½“çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚è¿™ä¸ªæ›´æ–°æ“ä½œæ˜¯ç”±Senderçº¿ç¨‹å‘èµ·çš„ï¼Œåœ¨åˆ›å»ºå®ŒMetadataRequestä¹‹ååŒæ ·ä¼šå­˜å…¥InFlightRequestsï¼Œä¹‹åçš„æ­¥éª¤å°±å’Œå‘é€æ¶ˆæ¯æ—¶çš„ç±»ä¼¼ã€‚å…ƒæ•°æ®è™½ç„¶ç”±Senderçº¿ç¨‹è´Ÿè´£æ›´æ–°ï¼Œä½†æ˜¯ä¸»çº¿ç¨‹ä¹Ÿéœ€è¦è¯»å–è¿™äº›ä¿¡æ¯ï¼Œè¿™é‡Œçš„æ•°æ®åŒæ­¥é€šè¿‡synchronizedå’Œfinalå…³é”®å­—æ¥ä¿éšœã€‚ é‡è¦çš„ç”Ÿäº§è€…å‚æ•° acksã€‚è¿™ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šåˆ†åŒºä¸­å¿…é¡»è¦æœ‰å¤šå°‘ä¸ªå‰¯æœ¬æ”¶åˆ°è¿™æ¡æ¶ˆæ¯ï¼Œä¹‹åç”Ÿäº§è€…æ‰ä¼šè®¤ä¸ºè¿™æ¡æ¶ˆæ¯æ˜¯æˆåŠŸå†™å…¥çš„ã€‚ acks = 1ã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ä¹‹åï¼Œåªè¦åˆ†åŒºçš„leaderå‰¯æœ¬æˆåŠŸå†™å…¥æ¶ˆæ¯ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æˆåŠŸå“åº”ï¼Œæ˜¯æ¶ˆæ¯å¯é æ€§å’Œååé‡çš„æŠ˜ä¸­æ–¹æ¡ˆã€‚ acks=0ã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ä¹‹åä¸éœ€è¦ç­‰å¾…ä»»ä½•æœåŠ¡ç«¯çš„å“åº”ï¼Œå¯ä»¥è·å–æœ€å¤§çš„ååé‡ã€‚ acks=-1æˆ–acks=allã€‚ç”Ÿäº§è€…åœ¨æ¶ˆæ¯å‘é€ä¹‹åï¼Œéœ€è¦ç­‰å¾…ISRä¸­çš„æ‰€æœ‰å‰¯æœ¬éƒ½æˆåŠŸå†™å…¥æ¶ˆæ¯ä¹‹åæ‰èƒ½å¤Ÿæ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æˆåŠŸå“åº”ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€æ¶ˆæ¯å°±ä¸€å®šå¯é ï¼Œå› ä¸ºISRä¸­å¯èƒ½åªæœ‰leaderå‰¯æœ¬ï¼Œè¿™æ ·å°±é€€åŒ–æˆäº†acks=1çš„æƒ…å†µã€‚ æ³¨æ„å“¦ï¼Œè¿™é‡Œçš„ acks å‚æ•°é…ç½®çš„å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯æ•´æ•°å‹ã€‚ Max.request.sizeã€‚è¿™ä¸ªå‚æ•°ç”¨æ¥é™åˆ¶ç”Ÿäº§è€…å®¢æˆ·ç«¯èƒ½å‘é€çš„æ¶ˆæ¯çš„æœ€å¤§å€¼ï¼Œé»˜è®¤å€¼ä¸º 1048576Bï¼Œå³ 1MBã€‚ retrieså’Œretry.backoff.msã€‚retrieså‚æ•°ç”¨æ¥é…ç½®ç”Ÿäº§è€…é‡è¯•çš„æ¬¡æ•°ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œå³åœ¨å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ä¸è¿›è¡Œä»»ä½•é‡è¯•åŠ¨ä½œã€‚retry.backoff.mså‚æ•°ç”¨æ¥è®¾å®šä¸¤æ¬¡é‡è¯•ä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚ compression.typeã€‚é»˜è®¤ä¸º â€œnoneâ€ï¼Œå‹ç¼©å¯ä»¥å‡å°‘ç½‘ç»œä¼ è¾“é‡ï¼Œé™ä½ç½‘ç»œI/Oã€‚ request.timeout.msã€‚è¿™ä¸ªå‚æ•°ç”¨æ¥é…ç½®Producerç­‰å¾…è¯·æ±‚å“åº”çš„æœ€é•¿æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º30000ï¼ˆmsï¼‰ã€‚è¯·æ±‚è¶…æ—¶ä¹‹åå¯ä»¥é€‰æ‹©è¿›è¡Œé‡è¯•ã€‚ æ€»ç»“æœ¬ç« ä¸»è¦è®²è¿°äº†ç”Ÿäº§è€…å®¢æˆ·ç«¯çš„å…·ä½“ç”¨æ³•åŠå…¶æ•´ä½“æ¶æ„ï¼Œä¸»è¦å†…å®¹åŒ…æ‹¬é…ç½®å‚æ•°çš„è¯¦è§£ã€æ¶ˆæ¯çš„å‘é€æ–¹å¼ã€åºåˆ—åŒ–å™¨ã€åˆ†åŒºå™¨ã€æ‹¦æˆªå™¨ç­‰ã€‚ å¯¹äºKafkaProducerè€Œè¨€ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸­å¤ç”¨å®ƒï¼Œè€Œå¯¹äºä¸‹ä¸€ç« çš„æ¶ˆè´¹è€…å®¢æˆ·ç«¯KafkaConsumerè€Œè¨€ï¼Œå®ƒæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒå…·å¤‡äº†çŠ¶æ€ã€‚ ç¬¬ä¸‰ç«  æ¶ˆè´¹è€…æ¶ˆè´¹è€…å’Œæ¶ˆè´¹è€…ç»„çš„æ¦‚å¿µæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰è´Ÿè´£è®¢é˜…Kafkaä¸­çš„ä¸»é¢˜ï¼ˆTopicï¼‰ï¼Œå¹¶ä¸”ä»è®¢é˜…çš„ä¸»é¢˜ä¸Šæ‹‰å–æ¶ˆæ¯ã€‚ä¸å…¶ä»–ä¸€äº›æ¶ˆæ¯ä¸­é—´ä»¶ä¸åŒçš„æ˜¯ï¼šåœ¨Kafkaçš„æ¶ˆè´¹ç†å¿µä¸­è¿˜æœ‰ä¸€å±‚æ¶ˆè´¹ç»„ï¼ˆConsumer Groupï¼‰çš„æ¦‚å¿µï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ¶ˆè´¹ç»„ã€‚å½“æ¶ˆæ¯å‘å¸ƒåˆ°ä¸»é¢˜åï¼Œåªä¼šè¢«æŠ•é€’ç»™è®¢é˜…å®ƒçš„æ¯ä¸ªæ¶ˆè´¹ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚ å¯¹äºæ¶ˆæ¯ä¸­é—´ä»¶è€Œè¨€ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ¶ˆæ¯æŠ•é€’æ¨¡å¼ï¼šç‚¹å¯¹ç‚¹ï¼ˆP2Pï¼ŒPoint-to-Pointï¼‰æ¨¡å¼å’Œå‘å¸ƒ/è®¢é˜…ï¼ˆPub/Subï¼‰æ¨¡å¼ã€‚ å¦‚æœæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½éš¶å±äºåŒä¸€ä¸ªæ¶ˆè´¹ç»„ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ¶ˆæ¯éƒ½ä¼šè¢«å‡è¡¡åœ°æŠ•é€’ç»™æ¯ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå³æ¯æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ï¼Œè¿™å°±ç›¸å½“äºç‚¹å¯¹ç‚¹æ¨¡å¼çš„åº”ç”¨ã€‚ å¦‚æœæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½éš¶å±äºä¸åŒçš„æ¶ˆè´¹ç»„ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ¶ˆæ¯éƒ½ä¼šè¢«å¹¿æ’­ç»™æ‰€æœ‰çš„æ¶ˆè´¹è€…ï¼Œå³æ¯æ¡æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰çš„æ¶ˆè´¹è€…å¤„ç†ï¼Œè¿™å°±ç›¸å½“äºå‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„åº”ç”¨ã€‚ å®¢æˆ·ç«¯å¼€å‘ä¸€ä¸ªæ­£å¸¸çš„æ¶ˆè´¹é€»è¾‘éœ€è¦å…·å¤‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š é…ç½®æ¶ˆè´¹è€…å®¢æˆ·ç«¯å‚æ•°åŠåˆ›å»ºç›¸åº”çš„æ¶ˆè´¹è€…å®ä¾‹ã€‚ è®¢é˜…ä¸»é¢˜ã€‚ æ‹‰å–æ¶ˆæ¯å¹¶æ¶ˆè´¹ã€‚ æäº¤æ¶ˆè´¹ä½ç§»ã€‚ å…³é—­æ¶ˆè´¹è€…å®ä¾‹ã€‚ Demo: 1234567891011121314151617181920212223242526272829303132333435package Kafka.Chapter1;import org.apache.kafka.clients.consumer.ConsumerRecord;import org.apache.kafka.clients.consumer.ConsumerRecords;import org.apache.kafka.clients.consumer.KafkaConsumer;import java.time.Duration;import java.util.Collections;import java.util.Properties;public class ConsumerFastStart &#123; public static final String brokerList = "localhost:9092"; public static final String topic = "topic-demo"; public static final String groupId = "group.demo"; public static void main(String[] args) &#123; Properties properties = new Properties(); properties.put("key.deserializer","org.apache.kafka.common.serialization.StringDeserializer"); properties.put("value.deserializer","org.apache.kafka.common.serialization.StringDeserializer"); properties.put("bootstrap.servers",brokerList); properties.put("group.id",groupId); KafkaConsumer&lt;String,String&gt; consumer = new KafkaConsumer&lt;String, String&gt;(properties); // è®¢é˜…ä¸»é¢˜ consumer.subscribe(Collections.singletonList(topic)); // å¾ªç¯è¯»å–æ¶ˆæ¯ while (true)&#123; ConsumerRecords&lt;String,String&gt; records = consumer.poll(Duration.ZERO); for(ConsumerRecord&lt;String,String&gt; records1 : records)&#123; System.out.println(records1.value()); &#125; &#125; &#125;&#125; é…ç½®æ¶ˆè´¹è€…å®¢æˆ·ç«¯å‚æ•°åŠåˆ›å»ºç›¸åº”çš„æ¶ˆè´¹è€…å®ä¾‹è·Ÿç”Ÿäº§è€…å®¢æˆ·ç«¯å‚æ•°å·®ä¸å¤šï¼Œè¿™é‡Œå¤šäº†ä¸€ä¸ª group.idã€‚ bootstrap.serversã€‚ group.idï¼šæ¶ˆè´¹è€…éš¶å±çš„æ¶ˆè´¹ç»„çš„åç§°ï¼Œé»˜è®¤å€¼ä¸ºâ€œâ€ã€‚å¦‚æœè®¾ç½®ä¸ºç©ºï¼Œåˆ™ä¼šæŠ¥å‡ºå¼‚å¸¸ï¼šException in thread â€œmainâ€ org.apache.kafka.common.errors.InvalidGroupIdExceptionï¼šThe configured groupId is invalidã€‚ä¸€èˆ¬è€Œè¨€ï¼Œè¿™ä¸ªå‚æ•°éœ€è¦è®¾ç½®æˆå…·æœ‰ä¸€å®šçš„ä¸šåŠ¡æ„ä¹‰çš„åç§°ã€‚ key.deserializer å’Œ value.deserializerã€‚æ¶ˆè´¹è€…ä»brokerç«¯è·å–çš„æ¶ˆæ¯æ ¼å¼éƒ½æ˜¯å­—èŠ‚æ•°ç»„ï¼ˆbyte[]ï¼‰ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦æ‰§è¡Œç›¸åº”çš„ååºåˆ—åŒ–æ“ä½œæ‰èƒ½è¿˜åŸæˆåŸæœ‰çš„å¯¹è±¡æ ¼å¼ã€‚è¿™ä¸¤ä¸ªå‚æ•°åˆ†åˆ«ç”¨æ¥æŒ‡å®šæ¶ˆæ¯ä¸­keyå’Œvalueæ‰€éœ€ååºåˆ—åŒ–æ“ä½œçš„ååºåˆ—åŒ–å™¨ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ— é»˜è®¤å€¼ã€‚æ³¨æ„è¿™é‡Œå¿…é¡»å¡«å†™ååºåˆ—åŒ–å™¨ç±»çš„å…¨é™å®šåï¼Œæ¯”å¦‚ç¤ºä¾‹ä¸­çš„org.apache.kafka.common.serialization.StringDeserializerï¼Œå•å•æŒ‡å®šStringDeserializeræ˜¯é”™è¯¯çš„ã€‚ æ¶ˆæ¯çš„æ¶ˆè´¹è®¢é˜…ä¸»é¢˜é…ç½®å®Œå‚æ•°ã€åˆ›å»ºå®Œæ¶ˆè´¹è€…å®ä¾‹ä¹‹åï¼Œå°±æ˜¯é€‰æ‹©è®¢é˜…ä¸»é¢˜äº†ã€‚é›†åˆè®¢é˜…çš„æ–¹å¼subscribeï¼ˆCollectionï¼‰ã€æ­£åˆ™è¡¨è¾¾å¼è®¢é˜…çš„æ–¹å¼subscribeï¼ˆPatternï¼‰å’ŒæŒ‡å®šåˆ†åŒºçš„è®¢é˜…æ–¹å¼ assignï¼ˆCollectionï¼‰åˆ†è¡¨ä»£è¡¨äº†ä¸‰ç§ä¸åŒçš„è®¢é˜…çŠ¶æ€ï¼šAUTO_TOPICSã€AUTO_PATTERNå’ŒUSER_ASSIGNEDï¼ˆå¦‚æœæ²¡æœ‰è®¢é˜…ï¼Œé‚£ä¹ˆè®¢é˜…çŠ¶æ€ä¸ºNONEï¼‰ã€‚ é›†åˆè®¢é˜…çš„æ–¹å¼subscribeï¼ˆCollectionï¼‰ã€æ­£åˆ™è¡¨è¾¾å¼è®¢é˜…çš„æ–¹å¼subscribeï¼ˆPatternï¼‰å’ŒæŒ‡å®šåˆ†åŒºçš„è®¢é˜…æ–¹å¼ assignï¼ˆCollectionï¼‰åˆ†è¡¨ä»£è¡¨äº†ä¸‰ç§ä¸åŒçš„è®¢é˜…çŠ¶æ€ï¼šAUTO_TOPICSã€AUTO_PATTERNå’ŒUSER_ASSIGNEDï¼ˆå¦‚æœæ²¡æœ‰è®¢é˜…ï¼Œé‚£ä¹ˆè®¢é˜…çŠ¶æ€ä¸ºNONEï¼‰ã€‚ é€šè¿‡ assign() æ–¹æ³•è®¢é˜…åˆ†åŒºæ—¶ï¼Œæ˜¯ä¸å…·å¤‡æ¶ˆè´¹è€…è‡ªåŠ¨å‡è¡¡çš„åŠŸèƒ½çš„ï¼Œå› ä¸ºå…¶æŒ‡å®šäº† TopicPartitionã€‚ æ‹‰å–æ¶ˆæ¯è®¢é˜…å®Œä¸»é¢˜ä¹‹åï¼Œå°±è¦å¼€å§‹æ‹‰å–æ¶ˆæ¯äº†ã€‚Kafkaä¸­çš„æ¶ˆè´¹æ˜¯åŸºäºæ‹‰æ¨¡å¼çš„ã€‚æ¶ˆæ¯çš„æ¶ˆè´¹ä¸€èˆ¬æœ‰ä¸¤ç§æ¨¡å¼ï¼šæ¨æ¨¡å¼å’Œæ‹‰æ¨¡å¼ã€‚æ¨æ¨¡å¼æ˜¯æœåŠ¡ç«¯ä¸»åŠ¨å°†æ¶ˆæ¯æ¨é€ç»™æ¶ˆè´¹è€…ï¼Œè€Œæ‹‰æ¨¡å¼æ˜¯æ¶ˆè´¹è€…ä¸»åŠ¨å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚æ¥æ‹‰å–æ¶ˆæ¯ã€‚ä¸€èˆ¬å°±æ˜¯é‡‡ç”¨ poll() è¿›è¡Œæ¶ˆæ¯çš„æ¶ˆè´¹ï¼Œè¯¥æ–¹æ³•æ¶‰åŠæ¶ˆè´¹ä½ç§»ã€æ¶ˆè´¹è€…åè°ƒå™¨ã€ç»„åè°ƒå™¨ã€æ¶ˆè´¹è€…çš„é€‰ä¸¾ã€åˆ†åŒºåˆ†é…çš„åˆ†å‘ã€å†å‡è¡¡çš„é€»è¾‘ã€å¿ƒè·³ç­‰å†…å®¹ï¼Œåç»­ç« èŠ‚ä¼šè¯¦ç»†ä»‹ç»ã€‚ ä¿®æ”¹åç§»é‡æ¶ˆè´¹å®Œæ¶ˆæ¯ä¹‹åï¼Œå°±éœ€è¦ä¿®æ”¹åç§»é‡äº†ã€‚åœ¨æ¯æ¬¡è°ƒç”¨pollï¼ˆï¼‰æ–¹æ³•æ—¶ï¼Œå®ƒè¿”å›çš„æ˜¯è¿˜æ²¡æœ‰è¢«æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯é›†ï¼Œè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå°±éœ€è¦è®°å½•ä¸Šä¸€æ¬¡æ¶ˆè´¹æ—¶çš„æ¶ˆè´¹ä½ç§»ã€‚æ¶ˆè´¹ä½ç§»å­˜å‚¨åœ¨Kafkaå†…éƒ¨çš„ä¸»é¢˜__consumer_offsetsä¸­ã€‚ åœ¨ Kafka ä¸­ï¼Œæœ‰ è‡ªåŠ¨æäº¤åç§»é‡ å’Œ æ‰‹åŠ¨æäº¤åç§»é‡ï¼Œé»˜è®¤çš„æ˜¯è‡ªåŠ¨æäº¤åç§»é‡ï¼Œï¼Œå¥½å¤„å°±æ˜¯å…å»äº†å¤æ‚çš„ä½ç§»æäº¤é€»è¾‘ï¼Œåå¤„å°±æ˜¯åç§»é‡çš„ä¿®æ”¹äº¤ç”±æœåŠ¡å™¨è‡ªèº«å»å¤„ç†çš„è¯ä¼šå¯¼è‡´é‡å¤æ¶ˆè´¹å’Œæ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µï¼Œè‡ªåŠ¨ä½ç§»æäº¤çš„åŠ¨ä½œæ˜¯åœ¨pollï¼ˆï¼‰æ–¹æ³•çš„é€»è¾‘é‡Œå®Œæˆçš„ï¼Œåœ¨æ¯æ¬¡çœŸæ­£å‘æœåŠ¡ç«¯å‘èµ·æ‹‰å–è¯·æ±‚ä¹‹å‰ä¼šæ£€æŸ¥æ˜¯å¦å¯ä»¥è¿›è¡Œä½ç§»æäº¤ï¼Œå¦‚æœå¯ä»¥ï¼Œé‚£ä¹ˆå°±ä¼šæäº¤ä¸Šä¸€æ¬¡è½®è¯¢çš„ä½ç§»ã€‚ æ‰€ä»¥ï¼Œæœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ§åˆ¶ä½ç§»æäº¤ï¼Œå¼€å¯æ‰‹åŠ¨æäº¤åŠŸèƒ½çš„å‰ææ˜¯æ¶ˆè´¹è€…å®¢æˆ·ç«¯å‚æ•° enable.auto.commit é…ç½®ä¸º falseã€‚æ‰‹åŠ¨æäº¤å¯ä»¥ç»†åˆ†ä¸ºåŒæ­¥æäº¤å’Œå¼‚æ­¥æäº¤ï¼Œå¯¹åº”äº KafkaConsumer ä¸­çš„ commitSyncï¼ˆï¼‰å’ŒcommitAsyncï¼ˆï¼‰ä¸¤ç§ç±»å‹çš„æ–¹æ³•ã€‚åŒæ­¥æäº¤ä¼šé˜»å¡æ¶ˆè´¹è€…çº¿ç¨‹ç›´åˆ°ä½ç§»æäº¤å®Œæˆï¼Œå¼‚æ­¥æäº¤ä¸ä¼šé˜»å¡ï¼Œä½†æ˜¯å¾ˆå¯èƒ½å¯¼è‡´é‡å¤æ¶ˆè´¹çš„é—®é¢˜ï¼Œæ‰€ä»¥ä¸€èˆ¬é‡‡ç”¨ä»¥ä¸‹çš„æ–¹å¼ï¼š æŒ‡å®šä½ç§»æ¶ˆè´¹åœ¨ Kafka ä¸­æ¯å½“æ¶ˆè´¹è€…æŸ¥æ‰¾ä¸åˆ°æ‰€è®°å½•çš„æ¶ˆè´¹ä½ç§»æ—¶ï¼Œå°±ä¼šæ ¹æ®æ¶ˆè´¹è€…å®¢æˆ·ç«¯å‚æ•°auto.offset.resetçš„é…ç½®æ¥å†³å®šä»ä½•å¤„å¼€å§‹è¿›è¡Œæ¶ˆè´¹ï¼Œè¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼ä¸ºâ€œlatestâ€ï¼Œè¡¨ç¤ºä»åˆ†åŒºæœ«å°¾å¼€å§‹æ¶ˆè´¹æ¶ˆæ¯ã€‚è¿˜æœ‰ä¸€ä¸ªå¯¹åº”çš„å€¼æ˜¯â€earliestâ€œã€‚ auto.offset.resetå‚æ•°è¿˜æœ‰ä¸€ä¸ªå¯é…ç½®çš„å€¼â€”â€œnoneâ€ï¼Œé…ç½®ä¸ºæ­¤å€¼å°±æ„å‘³ç€å‡ºç°æŸ¥åˆ°ä¸åˆ°æ¶ˆè´¹ä½ç§»çš„æ—¶å€™ï¼Œæ—¢ä¸ä»æœ€æ–°çš„æ¶ˆæ¯ä½ç½®å¤„å¼€å§‹æ¶ˆè´¹ï¼Œä¹Ÿä¸ä»æœ€æ—©çš„æ¶ˆæ¯ä½ç½®å¤„å¼€å§‹æ¶ˆè´¹ï¼Œæ­¤æ—¶ä¼šæŠ¥å‡ºNoOffsetForPartitionExceptionå¼‚å¸¸ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´éƒ½æ˜¯ä½¿ç”¨ poll() ä¸­çš„é€»è¾‘æ¥è¿›è¡Œæ•°æ®çš„æ‹‰å–ï¼Œæ¯”å¦‚è‡ªåŠ¨ä¿®æ”¹åç§»é‡ã€ä½¿ç”¨ auto.offset.reset æ¥å†³å®šä»æœ«å°¾å¼€å§‹æ¶ˆè´¹ï¼Œä½†æ˜¯æˆ‘ä»¬åªèƒ½ç²—ç²’åº¦çš„ä»å¼€å¤´æˆ–è€…æœ«å°¾è¿›è¡Œæ¶ˆè´¹ï¼Œé‚£æœ‰æ²¡æœ‰ä¸€ä¸ªæ›´ç»†ç²’åº¦çš„æ–¹æ³•å‘¢ï¼Ÿå½“ç„¶æœ‰ï¼Œé‚£å°±æ˜¯KafkaConsumer ä¸­çš„ seekï¼ˆï¼‰æ–¹æ³•ã€‚ 1public void seek(TopicPartition partition,long offset) seekï¼ˆï¼‰æ–¹æ³•ä¸­çš„å‚æ•°partitionè¡¨ç¤ºåˆ†åŒºï¼Œè€Œoffsetå‚æ•°ç”¨æ¥æŒ‡å®šä»åˆ†åŒºçš„å“ªä¸ªä½ç½®å¼€å§‹æ¶ˆè´¹ã€‚seekï¼ˆï¼‰æ–¹æ³•åªèƒ½é‡ç½®æ¶ˆè´¹è€…åˆ†é…åˆ°çš„åˆ†åŒºçš„æ¶ˆè´¹ä½ç½®ï¼Œè€Œåˆ†åŒºçš„åˆ†é…æ˜¯åœ¨ pollï¼ˆï¼‰æ–¹æ³•çš„è°ƒç”¨è¿‡ç¨‹ä¸­å®ç°çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œseekï¼ˆï¼‰æ–¹æ³•ä¹‹å‰éœ€è¦å…ˆæ‰§è¡Œä¸€æ¬¡pollï¼ˆï¼‰æ–¹æ³•ï¼Œç­‰åˆ°åˆ†é…åˆ°åˆ†åŒºä¹‹åæ‰å¯ä»¥é‡ç½®æ¶ˆè´¹ä½ç½®ã€‚ seekï¼ˆï¼‰æ–¹æ³•ä¸ºæˆ‘ä»¬æä¾›äº†ä»ç‰¹å®šä½ç½®è¯»å–æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥å‘å‰è·³è¿‡è‹¥å¹²æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥å‘åå›æº¯è‹¥å¹²æ¶ˆæ¯ï¼Œè¿™æ ·ä¸ºæ¶ˆæ¯çš„æ¶ˆè´¹æä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ã€‚seekï¼ˆï¼‰æ–¹æ³•ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†å°†æ¶ˆè´¹ä½ç§»ä¿å­˜åœ¨å¤–éƒ¨å­˜å‚¨ä»‹è´¨ä¸­çš„èƒ½åŠ›ï¼Œè¿˜å¯ä»¥é…åˆå†å‡è¡¡ç›‘å¬å™¨æ¥æä¾›æ›´åŠ ç²¾å‡†çš„æ¶ˆè´¹èƒ½åŠ›ã€‚ å¤šçº¿ç¨‹å®ç°æ¶ˆè´¹è€…å®¢æˆ·ç«¯KafkaProduceræ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œç„¶è€ŒKafkaConsumerå´æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚ KafkaConsumer éçº¿ç¨‹å®‰å…¨å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬åœ¨æ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™åªèƒ½ä»¥å•çº¿ç¨‹çš„æ–¹å¼æ‰§è¡Œã€‚å¦‚æœç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é€Ÿåº¦å¤§äºæ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰è¶Šæ¥è¶Šå¤šçš„æ¶ˆæ¯å¾—ä¸åˆ°åŠæ—¶çš„æ¶ˆè´¹ï¼Œé€ æˆäº†ä¸€å®šçš„å»¶è¿Ÿã€‚ æ¶ˆæ¯å †ç§¯é—®é¢˜çš„è§£å†³æªæ–½ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œå…·ä½“æ¥è¯´ï¼Œå¯ä»¥é‡‡ç”¨ä¸‰ç§æ–¹å¼ï¼š æ¯ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ª KafkaConsumerï¼Œæ¯ä¸€ä¸ª KafkaConsumer å¯¹åº” topic ä¸­çš„ä¸€ä¸ª partitionï¼Œè¿™äº› KafkaConsumer éš¶å±äºåŒä¸€ä¸ªæ¶ˆè´¹ç»„ï¼Œè¿™æ ·èƒ½ä¿è¯åŒä¸€æ¡æ¶ˆæ¯ä¸è¢«å¤šä¸ª Consumer æ¶ˆè´¹ã€‚å¥½å¤„å°±æ˜¯å¯ä»¥ä¸ç”¨å¤„ç†åç§»é‡å’Œé¡ºåºæ§åˆ¶ï¼Œå› ä¸º partition å†…éƒ¨ä½¿æŒ‰åºçš„ï¼Œç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯è¯¥å¤šçº¿ç¨‹çš„èƒ½åŠ›å—é™äºåˆ†åŒºæ•°ï¼Œå¦‚æœéœ€æ±‚æ˜¯æ‰€æœ‰æ¶ˆæ¯éƒ½å¿…é¡»æŒ‰åºï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰æ¶ˆæ¯éƒ½åœ¨ä¸€ä¸ª partition å†…ï¼Œæ­¤æ—¶ï¼Œè¯¥æ–¹æ³•å¤±æ•ˆï¼› ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯åœ¨åªæœ‰ä¸€ä¸ªåˆ†åŒºçš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è§£å†³æ¶ˆæ¯å †ç§¯ã€‚è¿™ä¸ªå°±å¿…é¡»é€šè¿‡æ‰‹åŠ¨æ§åˆ¶offsetäº†ï¼Œé€šè¿‡ assign()ã€seek() ç­‰æ–¹æ³•è§£å†³ã€‚å¥½å¤„å°±æ˜¯æ‰“ç ´äº†åŸæœ‰çš„æ¶ˆè´¹çº¿ç¨‹çš„ä¸ªæ•°å—åˆ†åŒºæ•°çš„é™åˆ¶ï¼Œåå¤„å°±æ˜¯è¿™ç§å®ç°æ–¹å¼å¯¹äºä½ç§»æäº¤å’Œé¡ºåºæ§åˆ¶çš„å¤„ç†ä¼šå˜å¾—ååˆ†å¤æ‚ï¼Œå®é™…åº”ç”¨åŸºæœ¬ä¸ä¼šæ¶‰åŠã€‚ ä¸Šè¿°ä¸¤ç§æ–¹æ³•éƒ½æ˜¯ä»æé«˜æ‹‰å–æ¶ˆæ¯çš„é€Ÿç‡è€ƒè™‘çš„ï¼Œä½†æ˜¯åœ¨å®é™…æƒ…å†µä¸­ï¼Œpoll() æ‹‰å–æ¶ˆæ¯çš„é€Ÿåº¦æ˜¯ç›¸å½“å¿«çš„ï¼Œæ•´ä½“çš„æ¶ˆè´¹æ€§èƒ½ç“¶é¢ˆå¹¶ä¸åœ¨äºæ­¤ï¼Œè€Œæ˜¯åœ¨äºå¤„ç†æ¶ˆæ¯è¿™ä¸€å—ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤„ç†æ¶ˆæ¯æ¨¡å—æ”¹æˆå¤šçº¿ç¨‹çš„å®ç°æ–¹å¼ï¼Œä½†æ˜¯è¿™æ ·åŒæ ·ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ¶ˆæ¯çš„é¡ºåºé—®é¢˜ï¼Œå› ä¸ºå¤šçº¿ç¨‹å¤„ç†æ¶ˆæ¯ï¼ŒåŸæœ¬ partition çš„æ¶ˆæ¯æ˜¯æŒ‰åºæ‹‰å–çš„ï¼Œä½†æ˜¯å¤šçº¿ç¨‹å¤„ç†å®Œä¹‹åå¯èƒ½å°±ä¸æ˜¯æŒ‰é¡ºåºçš„äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥è¿›è¡Œå¤„ç†ï¼Œä½œè€…åœ¨è¯¥ä¹¦ä¸­æå‡ºäº†æ»‘åŠ¨çª—å£çš„è§£å†³æ€è·¯ï¼Œå³å¦‚æœæŒ‰åºæ‹‰å–åçš„æ­£åœ¨å¤„ç†çš„æ¶ˆæ¯å¤„ç†å®Œæˆï¼Œå°†å…¶æ”¾åˆ°çª—å£ç¼“å­˜ï¼Œå½“å…¨éƒ¨å®Œæˆä¹‹åçª—å£æ‰å‘åæ»‘åŠ¨ï¼Œç±»ä¼¼äº TCP ä¸­çš„ GBN åè®®å’Œ SR åè®®ã€‚ ## é‡è¦çš„æ¶ˆè´¹è€…å‚æ•° fetch.min.bytes è¯¥å‚æ•°ç”¨æ¥é…ç½®Consumeråœ¨ä¸€æ¬¡æ‹‰å–è¯·æ±‚ï¼ˆè°ƒç”¨pollï¼ˆï¼‰æ–¹æ³•ï¼‰ä¸­èƒ½ä»Kafkaä¸­æ‹‰å–çš„æœ€å°æ•°æ®é‡ï¼Œé»˜è®¤å€¼ä¸º1ï¼ˆBï¼‰ã€‚ fetch.max.bytes ä¸ä¸Šè¿°å¯¹åº”ï¼Œé»˜è®¤å€¼ä¸º 50 MBã€‚ Max.poll.records è¿™ä¸ªå‚æ•°ç”¨æ¥é…ç½®Consumeråœ¨ä¸€æ¬¡æ‹‰å–è¯·æ±‚ä¸­æ‹‰å–çš„æœ€å¤§æ¶ˆæ¯æ•°ï¼Œé»˜è®¤å€¼ä¸º500ï¼ˆæ¡ï¼‰ã€‚ connections.max.idle.ms è¿™ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šåœ¨å¤šä¹…ä¹‹åå…³é—­é™åˆ¶çš„è¿æ¥ï¼Œé»˜è®¤å€¼æ˜¯540000ï¼ˆmsï¼‰ï¼Œå³9åˆ†é’Ÿã€‚ metadata.max.age.msè¿™ä¸ªå‚æ•°ç”¨æ¥é…ç½®å…ƒæ•°æ®çš„è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º300000ï¼ˆmsï¼‰ï¼Œå³5åˆ†é’Ÿã€‚å¦‚æœå…ƒæ•°æ®åœ¨æ­¤å‚æ•°æ‰€é™å®šçš„æ—¶é—´èŒƒå›´å†…æ²¡æœ‰è¿›è¡Œæ›´æ–°ï¼Œåˆ™ä¼šè¢«å¼ºåˆ¶æ›´æ–°ï¼Œå³ä½¿æ²¡æœ‰ä»»ä½•åˆ†åŒºå˜åŒ–æˆ–æœ‰æ–°çš„brokeråŠ å…¥ã€‚]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
        <category>kafka ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£ kafkaï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2020%2F04%2F23%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20kafka%EF%BC%88%E4%B8%80%EF%BC%89.html</url>
    <content type="text"><![CDATA[å‰è¨€é¡¹ç›®æœ€è¿‘ kafka åˆå´©äº†â€¦ å¿ƒæ€ç‚¸äº†â€¦ æ€»æ˜¯ nobrokerï¼Œè‡ªå·±ä¹Ÿæ€»æ˜¯æ²¡æœ‰å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥ï¼Œå—ä¸äº†äº†ï¼Œæˆ‘è¦å¼€å§‹æ·±å…¥ç†è§£ä¸€ä¸‹ kafka äº†â€¦ ç”±äºä¹‹å‰ä¸€ç¯‡æ–‡ç« éƒ½æ˜¯å‡ ä¸‡å­—ï¼Œå¯¼è‡´å¯è¯»æ€§æ¯”è¾ƒæ‹‰èƒ¯ï¼Œæ‰€ä»¥ä»ç°åœ¨å¼€å§‹ï¼Œæˆ‘æ¯ä¸€ç« å‡ºä¸€ç¯‡æ–‡ç« â€¦è¿™æ ·å¯è¯»æ€§å¼ºä¸€äº›â€¦ ç¬¬ä¸€ç«  åˆè¯† kafkaKafkaèµ·åˆæ˜¯ç”±LinkedInå…¬å¸é‡‡ç”¨Scalaè¯­è¨€å¼€å‘çš„ä¸€ä¸ªå¤šåˆ†åŒºã€å¤šå‰¯æœ¬ä¸”åŸºäºZooKeeperåè°ƒçš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼Œç°å·²è¢«æçŒ®ç»™ApacheåŸºé‡‘ä¼šã€‚ç›®å‰Kafkaå·²ç»å®šä½ä¸ºä¸€ä¸ªåˆ†å¸ƒå¼æµå¼å¤„ç†å¹³å°ï¼Œå®ƒä»¥é«˜ååã€å¯æŒä¹…åŒ–ã€å¯æ°´å¹³æ‰©å±•ã€æ”¯æŒæµæ•°æ®å¤„ç†ç­‰å¤šç§ç‰¹æ€§è€Œè¢«å¹¿æ³›ä½¿ç”¨ã€‚ Kafkaä¸»è¦æ‰®æ¼”ä¸‰å¤§è§’è‰²ï¼š æ¶ˆæ¯ç³»ç»Ÿã€‚æä¾›ä¼ ç»Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶çš„åŠŸèƒ½ï¼šç³»ç»Ÿè§£è€¦ã€å†—ä½™å­˜å‚¨ã€æµé‡å‰Šå³°ã€å¼‚æ­¥é€šä¿¡ç­‰ï¼ŒåŒæ—¶è¿˜æä¾›äº†æ¶ˆæ¯çš„é¡ºåºæ€§ä¿éšœä»¥åŠå›æº¯æ¶ˆè´¹çš„åŠŸèƒ½ã€‚ å­˜å‚¨ç³»ç»Ÿã€‚Kafkaæœ‰å¤šå‰¯æœ¬æœºåˆ¶ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥å½“æ•°æ®å­˜å‚¨ç³»ç»Ÿä½¿ç”¨ã€‚ æµå¼å¤„ç†å¹³å°ã€‚ä¸ºæ¯ä¸ªæµè¡Œçš„æµå¼å¤„ç†æ¡†æ¶æä¾›äº†å¯é çš„æ•°æ®æ¥æºï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„æµå¼å¤„ç†ç±»åº“ã€‚ åŸºæœ¬æ¦‚å¿µç»„æˆ Producerã€‚ç”Ÿäº§è€…ï¼Œè´Ÿè´£åˆ›å»ºæ¶ˆæ¯å‘é€åˆ° broker ä¸­ã€‚ Consumerã€‚ä» broker ä¸­æ¥æ”¶æ¶ˆæ¯ã€‚ Zookeeperã€‚è´Ÿè´£é›†ç¾¤å…ƒæ•°æ®çš„ç®¡ç†ã€æ§åˆ¶å™¨çš„é€‰ä¸¾ç­‰ç­‰ã€‚ Brokerã€‚è´Ÿè´£å°†æ”¶åˆ°çš„æ¶ˆæ¯å­˜å‚¨åˆ°ç£ç›˜ä¸­ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªé›†ç¾¤ã€‚ é‡è¦çš„æ¦‚å¿µTopic å’Œ PartitionKafkaä¸­çš„æ¶ˆæ¯ä»¥ topic ä¸ºå•ä½è¿›è¡Œå½’ç±»ï¼Œç”Ÿäº§è€…è´Ÿè´£å°†æ¶ˆæ¯å‘é€åˆ°ç‰¹å®šçš„ä¸»é¢˜ï¼Œè€Œæ¶ˆè´¹è€…è´Ÿè´£è®¢é˜…ä¸»é¢˜å¹¶è¿›è¡Œæ¶ˆè´¹ã€‚ topic ä»…ä»…æ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå®é™…çš„å®ç°è¿˜æ˜¯åˆ†åŒºï¼Œä¸€ä¸ªä¸»é¢˜å¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºéƒ½å¯ä»¥åˆ†æ•£åˆ°ä¸åŒ broker ä¸­ï¼Œåˆ†åŒºåœ¨å­˜å‚¨å±‚é¢å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¯è¿½åŠ çš„ log æ–‡ä»¶ï¼Œè€Œ offset æ˜¯æ¶ˆæ¯åœ¨åˆ†åŒºä¸­çš„å”¯ä¸€æ ‡è¯†ï¼ŒKafka é€šè¿‡å®ƒæ¥ä¿è¯åˆ†åŒºå†…çš„æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Œæ‰€ä»¥ Kafka ä»…ä¿è¯åˆ†åŒºæœ‰åºï¼Œä¸ä¿è¯ä¸»é¢˜æœ‰åºã€‚ å¤šå‰¯æœ¬æœºåˆ¶Kafka ä¸ºåˆ†åŒºå¼•å…¥äº†å¤šå‰¯æœ¬æœºåˆ¶ï¼Œä¿è¯é«˜å¯ç”¨ã€‚åœ¨è¿™é‡Œå’Œ Mysql ä¸€æ ·ï¼ŒåŒæ ·æ˜¯ä¸€ä¸»å¤šä»ï¼Œæ‰€ä»¥å…³é”®å°±æ˜¯ä¸»ä»åŒæ­¥çš„é—®é¢˜ï¼ŒåŒæ—¶è¿˜ä¼šæ¶‰åŠåˆ°ä¸»å¤‡åˆ‡æ¢ã€ä¸»ä»å»¶è¿Ÿç­‰é€šç”¨é—®é¢˜ã€‚ åˆ†åŒºä¸­æ‰€æœ‰å‰¯æœ¬ç»Ÿç§°ä¸º AR(Assigned Replicas)ï¼ŒAR = ISR(In-Sync Replicas) + OSR(Out-of-Sync Replicas)ï¼Œå½“ leaderå‰¯æœ¬å‘ç”Ÿæ•…éšœæ—¶ï¼Œåªæœ‰åœ¨ ISR ä¸­çš„ å‰¯æœ¬æ‰æœ‰èµ„æ ¼è¢«é€‰å–ä¸ºæ–°çš„ leaderã€‚ åœ¨è¯»å– offset çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå¼•å…¥äº† HW(é«˜æ°´ä½) å’Œ LEO(Log End Offset)çš„æ¦‚å¿µï¼Œåœ¨ Mysql ä¸­å®ç° mvcc ä¸­ï¼Œä¹ŸåŒæ ·é‡‡ç”¨äº† é«˜æ°´ä½çš„æ¦‚å¿µï¼Œä¸è¿‡åœ¨é‚£é‡Œæ˜¯åœ¨äº‹åŠ¡çš„è§†å›¾ä¸­å‡ºç°çš„ã€‚è¿™é‡Œçš„ HW å’Œ LEO åŒæ ·è®©æˆ‘æƒ³åˆ°äº† NIO ä¸­çš„ buffer ä¹Ÿæ˜¯æ‹¥æœ‰åŒæ ·çš„æ¦‚å¿µçš„ã€‚ Kafka çš„å¤åˆ¶æœºåˆ¶æ—¢ä¸æ˜¯å®Œå…¨çš„åŒæ­¥å¤åˆ¶ï¼Œä¹Ÿä¸æ˜¯å•çº¯çš„å¼‚æ­¥å¤åˆ¶ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç±»æ¯”äº‹åŠ¡å¤„ç†ã€‚åŒæ­¥æ„å‘³ç€æ‰€æœ‰éƒ½å®Œæˆæ‰æäº¤äº‹åŠ¡ã€Œå³è¦æ±‚æ‰€æœ‰ follower å‰¯æœ¬å…¨éƒ¨å¤åˆ¶å®Œæ‰å¯ä»¥è¿›è¡Œè¯»å–æ¶ˆæ¯ã€ï¼Œè€Œå¼‚æ­¥åˆ™æ„å‘³ç€åªè¦leaderè¯»å…¥æˆåŠŸåˆ™ç›´æ¥æäº¤äº‹åŠ¡ã€ŒMysql æ˜¯å¼‚æ­¥å¤åˆ¶ã€ã€‚å‰è€…å½±å“æ•ˆç‡ï¼Œåè€…åˆ™å­˜åœ¨ä¸å¯é æ€§ï¼Œå› ä¸ºä¸€æ—¦leaderå®•æœºè€Œfolloweræ²¡æœ‰åŒæ­¥å®Œæˆï¼Œæ•°æ®å°±ä¼šå‡ºç°é—®é¢˜ã€‚æ‰€ä»¥è¿™é‡Œé‡‡ç”¨æŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œæ¯åŒæ­¥å®Œä¸€ä¸ªæ¶ˆæ¯ï¼Œå°±è¿›è¡Œä¸€æ¬¡äº‹åŠ¡æäº¤ã€Œå³æ¯å…¨éƒ¨åŒæ­¥å®Œä¸€æ¡æ¶ˆæ¯å°±æäº¤ä¸€æ¬¡äº‹åŠ¡ã€ã€‚ å®‰è£…å’Œé…ç½®åšä¸»ä½¿ç”¨çš„ macOS ç³»ç»Ÿï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å¯¹åœ¨ macOS ä¸‹å¦‚ä½•å®‰è£…è¿è¡Œ kafka åšä¸€ä¸ªè¯¦ç»†çš„å™è¿°ã€‚ JDK çš„å®‰è£…å’Œé…ç½®Kafkaæ˜¯å»ºç«‹åœ¨ jvm ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®‰è£… jvmï¼Œè¿™ä¸ªå¾ˆç®€å•å•¦â€¦ https://www.jianshu.com/p/194531d106ae ä¸‹è½½ é…ç¯å¢ƒ æŸ¥çœ‹é…ç½®æ˜¯å¦æˆåŠŸ è¿™é‡Œæˆ‘ä¸è¯¦ç»†å™è¿°ï¼Œç›´æ¥çœ‹è¯¥ç½‘å€å°±è¡Œï¼Œä¸‹é¢çš„æˆ‘ä¼šè¯¦ç»†å™è¿°ã€‚ Zookeeper çš„å®‰è£…å’Œé…ç½®é¦–å…ˆå†ç®€å•ä»‹ç»ä¸€ä¸‹ Zookeeperï¼Œå…¶å® kafka ç°åœ¨å·²ç»å†…ç½®äº† Zookeeperï¼Œè¿™é‡Œæˆ‘ä»¬å°±æš‚æ—¶ä¸ä½¿ç”¨å†…ç½®çš„ zk äº†ï¼Œå› ä¸ºå†…ç½®çš„åªèƒ½æ˜¯å•æœºç‰ˆï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ zk ä¸€èˆ¬éƒ½æ˜¯é›†ç¾¤ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å†å•ç‹¬è¿›è¡Œ zk çš„å®‰è£…å’Œé…ç½®ã€‚ ZooKeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œæ˜¯Google Chubbyçš„ä¸€ä¸ªå¼€æºå®ç°ã€‚åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥åŸºäºZooKeeperå®ç°è¯¸å¦‚æ•°æ®å‘å¸ƒ/è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ã€é›†ç¾¤ç®¡ç†ã€Masteré€‰ä¸¾ã€é…ç½®ç»´æŠ¤ç­‰åŠŸèƒ½ã€‚åœ¨ZooKeeperä¸­å…±æœ‰3ä¸ªè§’è‰²ï¼šleaderã€followerå’Œobserverï¼ŒåŒä¸€æ—¶åˆ» ZooKeeperé›†ç¾¤ä¸­åªä¼šæœ‰ä¸€ä¸ªleaderï¼Œå…¶ä»–çš„éƒ½æ˜¯followerå’Œobserverã€‚observerä¸å‚ä¸æŠ•ç¥¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ ZooKeeper ä¸­åªæœ‰ leader å’Œ follower ä¸¤ä¸ªè§’è‰²ã€‚ ä¸‹è½½ Zookeeper brew install zookeeper è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸‹è½½ä¹‹åï¼ŒZookeeper ä¸­çš„ bin ç›®å½•å’Œé…ç½®æ–‡ä»¶ä¸åœ¨ä¸€å—ã€‚ bin ç›®å½•çš„ä½ç½®ï¼šâ€/usr/local/Cellar/zookeeper/3.4.14â€ é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼šâ€/usr/local/etc/zookeeperâ€ Zookeeper çš„ å¯åŠ¨åœæ­¢æ—¥å¿—ï¼š/usr/local/var/log/zookeeper é…ç¯å¢ƒ å‘½ä»¤ï¼šopen -e .bash_profile 123456789101112131415MONGODB_HOME=/usr/local/mongodbKAFKA_HOME=/usr/local/Cellar/kafka/2.4.0ZOOKEEPER_HOME=/usr/local/Cellar/zookeeper/3.4.14PATH="/Library/Frameworks/Python.framework/Versions/3.7/bin:$ZOOKEEPER_HOME/bin:$KAFKA_HOME/bin:$MONGODB_HOME/bin:$&#123;PATH&#125;:"export PATHexport PATH="/Users/yangweijie/anaconda3/bin:$PATH"export JAVA_HOME=/Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Homeexport CLASSPAHT=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarexport PATH=$JAVA_HOME/bin:$PATH: å‘½ä»¤ï¼šsource .bash_profile è®©é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ ä¿®æ”¹ Zookeeper é…ç½®æ–‡ä»¶ è¿›å…¥åˆ° /usr/local/etc/zookeeperï¼Œç„¶åå°† zoo_sample.cfg æ–‡ä»¶ä¿®æ”¹ä¸º zoo.cfg cd /usr/local/etc/zookeepercp zoo_sample.cfg zoo.cfg ä¿®æ”¹ zoo.cfg é…ç½®æ–‡ä»¶ï¼Œä¸»è¦æ˜¯åˆ›å»ºæ•°æ®ç›®å½•å’Œæ—¥å¿—ç›®å½•ï¼Œå› ä¸ºé»˜è®¤æ˜¯æ²¡æœ‰çš„ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±åˆ›å»º open -e zoo.cfgmkdir -p tmp/datamkdir -p tmp/log 123456789101112131415161718192021222324252627282930313233343536373839404142# zoo.cfg æ–‡ä»¶å†…å®¹# The number of milliseconds of each tick# zookeeper æœåŠ¡å™¨å¿ƒè·³æ—¶é—´ï¼Œå•ä½ä¸º mstickTime=2000# The number of ticks that the initial # synchronization phase can take# æŠ•ç¥¨é€‰ä¸¾æ–°leaderçš„åˆå§‹åŒ–æ—¶é—´initLimit=10# The number of ticks that can pass between # sending a request and getting an acknowledgement# leaderä¸follower å¿ƒè·³æ£€æµ‹æœ€å¤§å®¹å¿æ—¶é—´ï¼Œå“åº”æ—¶é—´è¶…è¿‡ syncLimit * tickTimeï¼Œlead# erå°±è®¤ä¸º follower æ­»æ‰äº†ï¼Œä»æœåŠ¡å™¨ä¸­åˆ é™¤ followersyncLimit=5# the directory where the snapshot is stored.# do not use /tmp for storage, /tmp here is just # example sakes.# æ•°æ®ç›®å½•dataDir=/usr/local/etc/zookeeper/tmp/data# the port at which the clients will connect# å¯¹å¤–æœåŠ¡ç«¯å£clientPort=2181# the maximum number of client connections.# increase this if you need to handle more clients#maxClientCnxns=60# æ—¥å¿—ç›®å½•dataLogDir=/usr/local/etc/zookeeper/tmp/log# # Be sure to read the maintenance section of the # administrator guide before turning on autopurge.## http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance## The number of snapshots to retain in dataDir#autopurge.snapRetainCount=3# Purge task interval in hours# Set to "0" to disable auto purge feature#autopurge.purgeInterval=1 dataDirï¼šâ€/usr/local/etc/zookeeper/tmp/dataâ€ Log: â€œ/usr/local/etc/zookeeper/tmp/logâ€ å¯åŠ¨ Zookeeperå¯åŠ¨ zookeeperï¼š zkServer start æŸ¥çœ‹ zookeeper çŠ¶æ€ï¼š zkServer status è¿™ä¸ªå…¶å®çœ‹ä¸å‡ºæ¥ Zookeeper æ˜¯å¦çœŸçš„è¿è¡Œèµ·æ¥äº†ï¼Œæˆ‘åœ¨ä¸‹é¢çš„é—®é¢˜æ¨¡å—ä¹Ÿæœ‰è®²åˆ°ï¼Œå¦‚æœæƒ³çœ‹ Zookeeper æ˜¯å¦çœŸçš„è¿è¡Œèµ·æ¥äº†ï¼Œå¯ä»¥æŸ¥çœ‹ â€œ/usr/local/etc/zookeeper/tmp/data/zookeeper_server.pidâ€ æ˜¯å¦å­˜åœ¨ï¼Œå½“ zk stopæ—¶è¯¥æ–‡ä»¶å°±ä¼šæ¶ˆå¤±ã€‚ Kafka çš„å®‰è£…å’Œé…ç½®ä¸‹è½½ kafka brew install kafka åŒæ ·çš„ï¼Œbin å’Œ é…ç½®æ–‡ä»¶ä½ç½®ä¸åœ¨ä¸€èµ·ã€‚ bin ç›®å½•çš„ä½ç½®ï¼šâ€/usr/local/Cellar/kafka/2.4.0â€ é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼šâ€/usr/local/etc/kafkaâ€ Kafka çš„å¯åŠ¨åœæ­¢æ—¥å¿—ï¼š/usr/local/var/log/kafka é…ç¯å¢ƒè§ä¸Šé¢çš„ bash_profile ä¿®æ”¹ Kafka é…ç½®æ–‡ä»¶å°† /usr/local/etc/kafka/server.properties è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ï¼Œä¸»è¦æ˜¯å¯¹æ—¥å¿—æ–‡ä»¶çš„åœ°å€è¿›è¡Œä¿®æ”¹ï¼Œç„¶åä¿®æ”¹å®Œä¹‹åè‡ªå·±åˆ›å»ºå¥½ç›¸åº”çš„ç›®å½•ã€‚ è¿™é‡Œæˆ‘çš„ kafka çš„æ¶ˆæ¯ log æ˜¯ /usr/local/etc/kafka/tmp/kafka-logsã€‚ å¯åŠ¨ Kafka å¯åŠ¨ kafka 1kafka-server-start /usr/local/etc/kafka/server.properties å¸¸ç”¨æŒ‡ä»¤ï¼š åˆ›å»º topicï¼š 1kafka-topics --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test æŸ¥çœ‹ topic : 1kafka-topics --list --zookeeper localhost:2181 å‘é€æ¶ˆæ¯ï¼š 1kafka-console-producer --broker-list localhost:9092 --topic test æ¶ˆè´¹æ¶ˆæ¯ï¼š 1kafka-console-consumer --bootstrap-server localhost:9092 --topic test --from-beginning æŸ¥çœ‹ java æœ‰å…³çš„è¿›ç¨‹ï¼š 1jps -l é‡åˆ°çš„é—®é¢˜Q1é—®é¢˜ç³»ç»Ÿæ˜¯ macOSï¼Œkafka ç‰ˆæœ¬ä¸º 2.4.0ï¼Œzookeeper ç‰ˆæœ¬ä¸º3.4.14ï¼Œåœ¨å®‰è£…å¯åŠ¨é‡åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š ç”¨ â€œkafka-server-stop /usr/local/etc/kafka/server.propertiesâ€ æ— æ³•æ€æ­» kafka è¿›ç¨‹â€¦ ä½¿ç”¨å®Œè¿™ä¸ªå‘½ä»¤ä¹‹å ç”¨å‘½ä»¤ â€œjps -lâ€ å¯ä»¥çœ‹åˆ°ï¼ŒåŸå…ˆçš„Kafka.kafka å¯¹åº”çš„è¿›ç¨‹çš„ç¡®æ²¡äº†ï¼Œä½†æ˜¯è«åå…¶å¦™åˆèµ·äº†ä¸€ä¸ªè¿›ç¨‹æ¥è¿è¡Œ kafkaï¼Œè¿™æ˜¯å•¥æƒ…å†µâ€¦ ä¸ºå•¥ä¼šæ€ä¸æ­»ã€‚ ã€Œä»åæ–‡å¯ä»¥çŸ¥é“ï¼Œjps å®é™…ä¸Šæ— æ³•å‡†å¤‡çš„ç¡®è®¤ kafkaæœåŠ¡ æ˜¯å¦æ­£å¸¸å¯åŠ¨ã€‚ã€ å°è¯•è§£å†³æ–¹æ¡ˆ é‡å†™kafka-server-stop.sh è„šæœ¬ 12345678PIDS=$(ps -ef |grep java|grep kafka | grep -v grep | awk '&#123;print $2&#125;')for PID in $PIDSdo kill -9 $PIDdoneecho -e "Stop Finished!\n" åŸ kafka-server-stop.sh å†…å®¹ï¼š 123456789SIGNAL=$&#123;SIGNAL:-TERM&#125;PIDS=$(ps ax | grep -i 'kafka\.Kafka' | grep java | grep -v grep | awk '&#123;print $1&#125;')if [ -z "$PIDS" ]; then echo "No kafka server to stop" exit 1else kill -s $SIGNAL $PIDSfi ç»“æœï¼šæ— æ•ˆã€‚ã€‚ã€‚ã€‚ å‚è€ƒï¼š https://blog.csdn.net/dengjili/article/details/95041267 ä¾æ—§æ˜¯ä¿®æ”¹ kafka-server-stop.sh çš„å†…å®¹ 1PIDS=$(ps ax | grep -i â€˜kafka.Kafkaâ€™ | grep java | grep -v grep | awk â€˜&#123;print $1&#125;â€™) ä¿®æ”¹ä¸ºï¼š 1PIDS=$(jps -lm | grep -i 'kafka.Kafka' | awk '&#123;print $1&#125;') ç»“æœï¼šä¾æ—§å¤±è´¥ã€‚ã€‚ã€‚ã€‚ã€‚å¿ƒæ€ç‚¸äº† åœ¨è§£å†³ç¬¬ä¸‰ä¸ªé—®é¢˜çš„æ—¶å€™å‘ç°ï¼Œå‘ç°å¹¶ä¸èƒ½ä»…ä»…é€šè¿‡ jps å»çœ‹ kafka æ˜¯å¦åœæ­¢è¿è¡Œï¼Œå› ä¸ºå…¶éå¸¸çš„ä¸å‡†ç¡®ï¼Œå…¶å® kafka å¯èƒ½å·²ç»åœæ­¢äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œâ€kafka-server-stop /usr/local/etc/kafka/server.propertiesâ€ å…¶å®å·²ç»æ€æ­» kafka æœåŠ¡è¿›ç¨‹ï¼Œåªæ˜¯æˆ‘ä»¬ä¸çŸ¥é“è€Œå·²ã€‚ã€‚ã€‚ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ç”Ÿäº§æ¶ˆæ¯ï¼škafka-console-producer --broker-list localhost:9092 --topic testæ¥åˆ¤æ–­ kafka æ˜¯å¦æ˜¯æ­£å¸¸å¯åŠ¨çš„ã€‚ ç»“æœï¼šå·²è§£å†³ï¼ï¼ï¼ Q2é—®é¢˜ä½¿ç”¨å‘½ä»¤ â€œzkServer stopâ€ æ— æ³•åœæ­¢ zookeeperï¼ŒæŠ¥é”™ï¼š 123ZooKeeper JMX enabled by defaultUsing config: /usr/local/etc/zookeeper/zoo.cfgStopping zookeeper ... no zookeeper to stop (could not find file /usr/local/etc/zookeeper/tmp/data/zookeeper_server.pid) å°è¯•è§£å†³æ–¹æ¡ˆåŸæ¥æ˜¯å› ä¸ºæˆ‘æ ¹æœ¬æ²¡æœ‰æŠŠ Zookeeper èµ·æ¥ï¼Œä½¿ç”¨ zkServer statuså¹¶ä¸èƒ½æ˜¾ç¤º zk æ˜¯å¦çœŸçš„èµ·æ¥äº†â€¦ åœ¨æˆ‘å†æ¬¡å¯åŠ¨ zk æ—¶ï¼Œçš„ç¡®åœ¨ â€œ/usr/local/etc/zookeeper/tmp/data ä¸‹ å‡ºç°äº† zookeeper_server.pidâ€ è¿™ä¸ªæ–‡ä»¶ã€‚ æ‰€ä»¥è¯´ï¼Œæƒ³çœ‹ zk åˆ°åº•æ˜¯å¦çœŸçš„èµ·æ¥äº†ï¼Œå¯ä»¥æŸ¥çœ‹ â€œ/usr/local/etc/zookeeper/tmp/data/zookeeper_server.pidâ€ æ˜¯å¦å­˜åœ¨ï¼Œå½“ zk stopæ—¶è¯¥æ–‡ä»¶å°±ä¼šæ¶ˆå¤±ã€‚ ç»“æœï¼šè¯¥é—®é¢˜è§£å†³ï¼ï¼ï¼ Q3é—®é¢˜åœ¨æˆ‘ä¸€ç›´æ— æ³•å…³é—­ kafka ä¹‹åï¼Œæˆ‘è¿›è¡Œäº†ç”µè„‘é‡å¯ï¼Œé‡å¯ä¹‹åï¼Œä½¿ç”¨ â€œjps -lâ€ çš„ç¡®æ²¡æœ‰å†å‡ºç° â€œkafka.Kafkaâ€ï¼Œè¯´æ˜è¿™æ—¶ kafka çš„ç¡®åœæ­¢äº†ï¼Œä½†æ˜¯æ–°çš„é—®é¢˜åˆå‡ºç°äº†â€¦ åœ¨ä½¿ç”¨ kafka-server-start /usr/local/etc/kafka/server.properties å‘½ä»¤ä¹‹åï¼Œå†ä¹Ÿæ— æ³•å¯åŠ¨ kafka äº†â€¦ æˆ‘å¤ªéš¾äº†â€¦ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647[2020-04-24 23:16:58,980] INFO Registered kafka:type=kafka.Log4jController MBean (kafka.utils.Log4jControllerRegistration$)[2020-04-24 23:16:59,391] INFO Registered signal handlers for TERM, INT, HUP (org.apache.kafka.common.utils.LoggingSignalHandler)[2020-04-24 23:16:59,392] INFO starting (kafka.server.KafkaServer)[2020-04-24 23:16:59,392] INFO Connecting to zookeeper on localhost:2181 (kafka.server.KafkaServer)[2020-04-24 23:16:59,406] INFO [ZooKeeperClient Kafka server] Initializing a new session to localhost:2181. (kafka.zookeeper.ZooKeeperClient)[2020-04-24 23:16:59,410] INFO Client environment:zookeeper.version=3.5.6-c11b7e26bc554b8523dc929761dd28808913f091, built on 10/08/2019 20:18 GMT (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,410] INFO Client environment:host.name=localhost (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,411] INFO Client environment:java.version=1.8.0_222 (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,411] INFO Client environment:java.vendor=AdoptOpenJDK (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,411] INFO Client environment:java.home=/Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home/jre (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,411] INFO Client environment:java.class.path=/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/activation-1.1.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/aopalliance-repackaged-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/argparse4j-0.7.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/audience-annotations-0.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/commons-cli-1.4.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/commons-lang3-3.8.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-api-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-basic-auth-extension-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-file-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-json-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-mirror-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-mirror-client-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-runtime-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-transforms-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/guava-20.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/hk2-api-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/hk2-locator-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/hk2-utils-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-annotations-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-core-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-databind-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-dataformat-csv-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-datatype-jdk8-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-jaxrs-base-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-jaxrs-json-provider-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-module-jaxb-annotations-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-module-paranamer-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-module-scala_2.12-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.activation-api-1.2.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.annotation-api-1.3.4.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.inject-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.ws.rs-api-2.1.5.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.xml.bind-api-2.3.2.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/javassist-3.22.0-CR2.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/javax.servlet-api-3.1.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/javax.ws.rs-api-2.1.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jaxb-api-2.3.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-client-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-common-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-container-servlet-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-container-servlet-core-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-hk2-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-media-jaxb-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-server-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-client-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-continuation-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-http-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-io-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-security-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-server-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-servlet-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-servlets-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-util-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jopt-simple-5.0.4.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-clients-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-log4j-appender-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-streams-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-streams-examples-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-streams-scala_2.12-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-streams-test-utils-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-tools-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka_2.12-2.4.0-sources.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka_2.12-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/log4j-1.2.17.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/lz4-java-1.6.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/maven-artifact-3.6.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/metrics-core-2.2.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-buffer-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-codec-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-common-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-handler-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-resolver-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-transport-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-transport-native-epoll-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-transport-native-unix-common-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/osgi-resource-locator-1.0.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/paranamer-2.8.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/plexus-utils-3.2.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/reflections-0.9.11.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/rocksdbjni-5.18.3.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-collection-compat_2.12-2.1.2.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-java8-compat_2.12-0.9.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-library-2.12.10.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-logging_2.12-3.9.2.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-reflect-2.12.10.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/slf4j-api-1.7.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/slf4j-log4j12-1.7.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/snappy-java-1.1.7.3.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/validation-api-2.0.1.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/zookeeper-3.5.6.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/zookeeper-jute-3.5.6.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/zstd-jni-1.4.3-1.jar (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,411] INFO Client environment:java.library.path=/Users/yangweijie/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:. (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,412] INFO Client environment:java.io.tmpdir=/var/folders/cp/p4lwr_6n66s065dhcw80dzd80000gn/T/ (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,412] INFO Client environment:java.compiler=&lt;NA&gt; (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,412] INFO Client environment:os.name=Mac OS X (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,412] INFO Client environment:os.arch=x86_64 (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,412] INFO Client environment:os.version=10.15.4 (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,412] INFO Client environment:user.name=yangweijie (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,412] INFO Client environment:user.home=/Users/yangweijie (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,412] INFO Client environment:user.dir=/usr/local/etc/kafka/tmp (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,412] INFO Client environment:os.memory.free=978MB (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,412] INFO Client environment:os.memory.max=1024MB (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,412] INFO Client environment:os.memory.total=1024MB (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,414] INFO Initiating client connection, connectString=localhost:2181 sessionTimeout=6000 watcher=kafka.zookeeper.ZooKeeperClient$ZooKeeperClientWatcher$@7722c3c3 (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,417] INFO Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation (org.apache.zookeeper.common.X509Util)[2020-04-24 23:16:59,422] INFO jute.maxbuffer value is 4194304 Bytes (org.apache.zookeeper.ClientCnxnSocket)[2020-04-24 23:16:59,426] INFO zookeeper.request.timeout value is 0. feature enabled= (org.apache.zookeeper.ClientCnxn)[2020-04-24 23:16:59,428] INFO [ZooKeeperClient Kafka server] Waiting until connected. (kafka.zookeeper.ZooKeeperClient)[2020-04-24 23:16:59,430] INFO Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181. Will not attempt to authenticate using SASL (unknown error) (org.apache.zookeeper.ClientCnxn)[2020-04-24 23:16:59,440] INFO Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:51131, server: localhost/0:0:0:0:0:0:0:1:2181 (org.apache.zookeeper.ClientCnxn)[2020-04-24 23:16:59,444] INFO Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, sessionid = 0x10000053312004f, negotiated timeout = 6000 (org.apache.zookeeper.ClientCnxn)[2020-04-24 23:16:59,447] INFO [ZooKeeperClient Kafka server] Connected. (kafka.zookeeper.ZooKeeperClient)[2020-04-24 23:16:59,612] INFO Cluster ID = I5sBHS6MSMG4MmUddyviFQ (kafka.server.KafkaServer)[2020-04-24 23:16:59,621] ERROR Fatal error during KafkaServer startup. Prepare to shutdown (kafka.server.KafkaServer)kafka.common.InconsistentClusterIdException: The Cluster ID I5sBHS6MSMG4MmUddyviFQ doesn't match stored clusterId Some(Lz_cYIXrTryPr_06DLt6hQ) in meta.properties. The broker is trying to join the wrong cluster. Configured zookeeper.connect may be wrong. at kafka.server.KafkaServer.startup(KafkaServer.scala:220) at kafka.server.KafkaServerStartable.startup(KafkaServerStartable.scala:44) at kafka.Kafka$.main(Kafka.scala:84) at kafka.Kafka.main(Kafka.scala)[2020-04-24 23:16:59,623] INFO shutting down (kafka.server.KafkaServer)[2020-04-24 23:16:59,625] INFO [ZooKeeperClient Kafka server] Closing. (kafka.zookeeper.ZooKeeperClient)[2020-04-24 23:16:59,732] INFO Session: 0x10000053312004f closed (org.apache.zookeeper.ZooKeeper)[2020-04-24 23:16:59,732] INFO EventThread shut down for session: 0x10000053312004f (org.apache.zookeeper.ClientCnxn)[2020-04-24 23:16:59,734] INFO [ZooKeeperClient Kafka server] Closed. (kafka.zookeeper.ZooKeeperClient)[2020-04-24 23:16:59,737] INFO shut down completed (kafka.server.KafkaServer)[2020-04-24 23:16:59,737] ERROR Exiting Kafka. (kafka.server.KafkaServerStartable)[2020-04-24 23:16:59,739] INFO shutting down (kafka.server.KafkaServer) é€šè¿‡ â€œjps -lâ€ çš„ç»“æœçœ‹ï¼Œçš„ç¡®æ˜¯æ²¡æœ‰å¯åŠ¨èµ·æ¥ã€‚ 123yangweijieMacBook-Pro:tmp yangweijie$ jps -l640 org.apache.zookeeper.server.quorum.QuorumPeerMain30653 sun.tools.jps.Jps ç„¶åæˆ‘å°±å»æ´—æ¾¡äº†.. å›æ¥ â€œjps -lâ€ï¼Œæˆ‘æ“¦ï¼Œkafka èµ·æ¥äº†ï¼Œè‡ªå·±èµ·æ¥äº†ï¼Ÿï¼Ÿï¼Ÿæˆ‘çš„å¦ˆï¼Œå—ä¸äº†äº†â€¦ 1234yangweijieMacBook-Pro:~ yangweijie$ jps -l26240 sun.tools.jps.Jps25920 kafka.Kafka640 org.apache.zookeeper.server.quorum.QuorumPeerMain ç„¶åæˆ‘ä¸ä¿¡ï¼Œæˆ‘å°±è¯•ç€å»ç”Ÿäº§ä¸€ä¸ªæ¶ˆæ¯ 1kafka-console-producer --broker-list localhost:9092 --topic test çš„ç¡®ï¼ŒæŠ¥é”™äº† 1WARN [Producer clientId=console-producer] Connection to node -1 (localhost/127.0.0.1:9092) could not be established. Broker may not be available. (org.apache.kafka.clients.NetworkClient) è¿™æˆ‘å°±æƒ³ä¸é€šäº†â€¦ è¿™ä¸ª kafka.Kafka éš¾é“ä¸èƒ½ä»£è¡¨ kafka æœåŠ¡ç«¯æ´»ç€ï¼Ÿ ç„¶åæˆ‘åˆå»å°è¯•çš„ â€œjps -lâ€ ï¼Œå¦ˆçš„ï¼Œé‚£ä¸ªè¿›ç¨‹åˆæ­»äº†â€¦ 123yangweijieMacBook-Pro:~ yangweijie$ jps -l640 org.apache.zookeeper.server.quorum.QuorumPeerMain32381 sun.tools.jps.Jps ä¸ºäº†è¯æ˜æˆ‘çœ¼ç›æ²¡èŠ±ï¼Œæˆ‘åˆå°è¯•çš„ä¸€éï¼Œå¦ˆçš„ï¼Œåˆå‡ºç°äº†ä¸€ä¸ªæ–°çš„ kafka è¿›ç¨‹ã€‚ã€‚ã€‚ 1234yangweijieMacBook-Pro:~ yangweijie$ jps -l32704 sun.tools.jps.Jps640 org.apache.zookeeper.server.quorum.QuorumPeerMain32384 kafka.Kafka ç„¶åæˆ‘åˆè¯•äº†ä¸€éï¼Œkafka è¿›ç¨‹åˆæ²¡äº†â€¦ ç„¶åæˆ‘æ¥ç€è¯•äº†å¾ˆå¤šéï¼Œkafkaè¿›ç¨‹ä¸€ç›´æ²¡æœ‰â€¦ è¿™æ¬¡ï¼Œæˆ‘å†³å®šå†æ¬¡å¯åŠ¨ä¸€ä¸‹ kafka è¯•è¯•â€¦ è¿˜æ˜¯å¯åŠ¨ä¸äº†â€¦ ç„¶åæˆ‘æ— èŠçš„æµ‹è¯•ä¸‹ â€œjsp -lâ€ è¿™ä¸ªå‘½ä»¤ï¼Œå‘ç°å…¶æ‰§è¡Œ 5-6 æ¬¡å°±ä¼šæœ‰ä¸€æ¬¡ â€œkafka.Kafkaâ€ çš„è¿›ç¨‹äº§ç”Ÿï¼Œç„¶ååˆä¼šè‡ªå·±æ¶ˆå¤±â€¦ ç„å­¦ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿå´©äº†â€¦ å°è¯•è§£å†³æ–¹æ¡ˆ å‚è€ƒï¼šhttps://blog.csdn.net/Sakitaf/article/details/104954268 æˆ‘ä»¬å›åˆ°ç¬¬ä¸‰ä¸ªæœ€åˆçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ä¸€ç›´å¯åŠ¨ä¸äº† kafkaï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„æŠ¥é”™ï¼š 1kafka.common.InconsistentClusterIdException: The Cluster ID I5sBHS6MSMG4MmUddyviFQ doesn't match stored clusterId Some(Lz_cYIXrTryPr_06DLt6hQ) in meta.properties. The broker is trying to join the wrong cluster. Configured zookeeper.connect may be wrong. äºæ˜¯ï¼Œæˆ‘å°±å°è¯•å»æ‰¾ meta.propertiesï¼ŒåŸæ¥è¿™ä¸ª meta.properties åœ¨/usr/local/etc/kafka/tmp/kafka-logs/ï¼Œç„¶åå°†å…¶é‡Œé¢çš„ meta.properties ä¸­çš„ Cluster ID æ”¹ä¸ºæŠ¥é”™ä¸­éœ€è¦çš„ã€‚è¿™åº”è¯¥å°±æ˜¯ 2.4.0 çš„bugäº†ï¼Œåœ¨æˆ‘ä¸Šæ¬¡æš´åŠ›å…³é—­ kafka æ—¶ï¼Œä¸ä¼šä¸»åŠ¨çš„ä¸æ–°çš„zkå®ä¾‹å»ºç«‹è¿æ¥ã€‚ ç»“æœï¼šå·²è§£å†³ï¼ï¼ï¼ï¼ Q4é—®é¢˜æœ€è¿‘æƒ³æŸ¥ä¸€ä¸‹ kafka çš„å¯åŠ¨æ—¥å¿—ï¼Œç»“æœä¸æŸ¥ä¸çŸ¥é“ï¼Œä¸€æŸ¥å“ä¸€è·³ï¼Œä¸€ä¸ªå¯åŠ¨æ—¥å¿—å äº†4ä¸ªå¤šgçš„å­˜å‚¨â€¦ çœ‹äº†ä¸‹ï¼Œå…¨æ˜¯å¯åŠ¨æ—¥å¿—ï¼Œ10åˆ†é’Ÿå°±æ›´æ–°ä¸€æ¬¡â€¦ å“å¾—æˆ‘èµ¶ç´§åˆ äº†ï¼Œå¾—ç ”ç©¶ä¸€ä¸‹å¦‚ä½•ä¸è®©ä»–æ›´æ–°çš„è¿™ä¹ˆé¢‘ç¹ï¼Œæˆ‘çš„256gçš„ç”µè„‘ç‘Ÿç‘Ÿå‘æŠ–â€¦ å°è¯•è§£å†³æ–¹æ¡ˆçœ‹äº†ä¸‹ï¼Œåº”è¯¥æ˜¯ä»¥å‰æŠŠ Zookeeper å…³é—­äº†ï¼Œä½†æ˜¯ kafka ä¸€ç›´æ²¡å…³é—­ï¼Œç„¶å kafka ä¸€ç›´å¤±è´¥é‡è¿ï¼Œæ—¥å¿—ç–¯ç‹‚å¢åŠ â€¦ å†æ¬¡å°è¯•çš„ä½¿ç”¨å‘½ä»¤ â€œkafka-server-stop /usr/local/etc/kafka/server.propertiesâ€ï¼Œç„¶åçœ‹ â€œ/usr/local/var/log/kafkaâ€ ä¸‹çš„æ—¥å¿—ã€‚ é¦–å…ˆï¼Œçš„ç¡®æœ‰ shutdownï¼Œè¿™æ˜¯æˆ‘æœç´¢ shutdown åè¿‡æ»¤å¾—åˆ°çš„æ—¥å¿—ï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425 controlled.shutdown.enable = true controlled.shutdown.max.retries = 3 controlled.shutdown.retry.backoff.ms = 5000 controlled.shutdown.enable = true controlled.shutdown.max.retries = 3 controlled.shutdown.retry.backoff.ms = 5000[2020-04-29 18:21:19,508] ERROR [KafkaServer id=0] Fatal error during KafkaServer startup. Prepare to shutdown (kafka.server.KafkaServer)[2020-04-29 18:21:19,517] INFO [LogDirFailureHandler]: Shutdown completed (kafka.server.ReplicaManager$LogDirFailureHandler)[2020-04-29 18:21:19,518] INFO [ReplicaFetcherManager on broker 0] shutdown completed (kafka.server.ReplicaFetcherManager)[2020-04-29 18:21:19,519] INFO [ReplicaAlterLogDirsManager on broker 0] shutdown completed (kafka.server.ReplicaAlterLogDirsManager)[2020-04-29 18:21:19,637] INFO [ExpirationReaper-0-Fetch]: Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,911] INFO [ExpirationReaper-0-Produce]: Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,912] INFO [ExpirationReaper-0-DeleteRecords]: Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:20,187] INFO [ExpirationReaper-0-ElectLeader]: Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:20,262] INFO Shutdown complete. (kafka.log.LogManager)[2020-04-29 18:21:20,714] INFO [ThrottledChannelReaper-Fetch]: Shutdown completed (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:21,714] INFO [ThrottledChannelReaper-Produce]: Shutdown completed (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:22,786] INFO [ThrottledChannelReaper-Request]: Shutdown completed (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:22,814] INFO [SocketServer brokerId=0] Shutdown completed (kafka.network.SocketServer) controlled.shutdown.enable = true controlled.shutdown.max.retries = 3 controlled.shutdown.retry.backoff.ms = 5000 controlled.shutdown.enable = true controlled.shutdown.max.retries = 3 controlled.shutdown.retry.backoff.ms = 5000 ä½†æ˜¯ï¼Œä½¿ç”¨ jps -l çœ‹çš„ç¡® kafka è¿›ç¨‹è¿˜æ²¡æ­»ï¼Œæ”¶å‘æ¶ˆæ¯ä¹Ÿæ­£å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬å†çœ‹ä¸€ä¸‹å®Œæ•´çš„æ—¥å¿—ï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210310410510610710810911011111211311411511611711811912012112212312412512612712812913013113213313413513613713813914014114214314414514614714814915015115215315415515615715815916016116216316416516616716816917017117217317417517617717817918018118218318418518618718818919019119219319419519619719819920020120220320420520620720820921021121221321421521621721821922022122222322422522622722822923023123223323423523623723823924024124224324424524624724824925025125225325425525625725825926026126226326426526626726826927027127227327427527627727827928028128228328428528628728828929029129229329429529629729829930030130230330430530630730830931031131231331431531631731831932032132232332432532632732832933033133233333433533633733833934034134234334434534634734834935035135235335435535635735835936036136236336436536636736836937037137237337437537637737837938038138238338438538638738838939039139239339439539639739839940040140240340440540640740840941041141241341441541641741841942042142242342442542642742842943043143243343443543643743843944044144244344444544644744844945045145245345445545645745845946046146246346446546646746846947047147247347447547647747847948048148248348448548648748848949049149249349449549649749849950050150250350450550650750850951051151251351451551651751851952052152252352452552652752852953053153253353453553653753853954054154254354454554654754854955055155255355455555655755855956056156256356456556656756856957057157257357457557657757857958058158258358458558658758858959059159259359459559659759859960060160260360460560660760860961061161261361461561661761861962062162262362462562662762862963063163263363463563663763863964064164264364464564664764864965065165265365465565665765865966066166266366466566666766866967067167267367467567667767867968068168268368468568668768868969069169269369469569669769869970070170270370470570670770870971071171271371471571671771871972072172272372472572672772872973073173273373473573673773873974074174274374474574674774874975075175275375475575675775875976076176276376476576676776876977077177277377477577677777877978078178278378478578678778878979079179279379479579679779879980080180280380480580680780880981081181281381481581681781881982082182282382482582682782882983083183283383483583683783883984084184284384484584684784884985085185285385485585685785885986086186286386486586686786886987087187287387487587687787887988088188288388488588688788888989089189289389489589689789889990090190290390490590690790890991091191291391491591691791891992092192292392492592692792892993093193293393493593693793893994094194294394494594694794894995095195295395495595695795895996096196296396496596696796896997097197297397497597697797897998098198298398498598698798898999099199299399499599699799899910001001100210031004100510061007100810091010101110121013101410151016101710181019102010211022102310241025102610271028102910301031103210331034103510361037103810391040104110421043104410451046104710481049105010511052105310541055105610571058105910601061106210631064106510661067106810691070107110721073107410751076107710781079108010811082108310841085108610871088108910901091109210931094109510961097109810991100110111021103110411051106110711081109111011111112111311141115111611171118111911201121112211231124112511261127112811291130113111321133113411351136113711381139114011411142114311441145114611471148114911501151115211531154115511561157115811591160116111621163116411651166116711681169117011711172117311741175117611771178117911801181118211831184118511861187118811891190119111921193119411951196119711981199120012011202120312041205120612071208120912101211121212131214121512161217121812191220122112221223122412251226122712281229123012311232123312341235123612371238123912401241124212431244124512461247124812491250125112521253125412551256125712581259126012611262126312641265126612671268126912701271127212731274127512761277127812791280128112821283128412851286128712881289129012911292129312941295129612971298129913001301130213031304130513061307130813091310131113121313131413151316131713181319132013211322132313241325132613271328132913301331133213331334133513361337133813391340134113421343134413451346134713481349135013511352135313541355135613571358135913601361136213631364136513661367136813691370137113721373137413751376137713781379138013811382138313841385138613871388138913901391139213931394139513961397139813991400140114021403140414051406140714081409141014111412141314141415141614171418141914201421142214231424142514261427142814291430143114321433143414351436143714381439144014411442144314441445144614471448144914501451145214531454145514561457145814591460146114621463146414651466146714681469147014711472147314741475147614771478147914801481148214831484148514861487148814891490149114921493149414951496149714981499150015011502150315041505150615071508150915101511151215131514151515161517[2020-04-29 18:21:17,883] INFO Registered kafka:type=kafka.Log4jController MBean (kafka.utils.Log4jControllerRegistration$)[2020-04-29 18:21:18,347] INFO Registered signal handlers for TERM, INT, HUP (org.apache.kafka.common.utils.LoggingSignalHandler)[2020-04-29 18:21:18,348] INFO starting (kafka.server.KafkaServer)[2020-04-29 18:21:18,348] INFO Connecting to zookeeper on localhost:2181 (kafka.server.KafkaServer)[2020-04-29 18:21:18,364] INFO [ZooKeeperClient Kafka server] Initializing a new session to localhost:2181. (kafka.zookeeper.ZooKeeperClient)[2020-04-29 18:21:18,370] INFO Client environment:zookeeper.version=3.5.6-c11b7e26bc554b8523dc929761dd28808913f091, built on 10/08/2019 20:18 GMT (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,370] INFO Client environment:host.name=localhost (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,370] INFO Client environment:java.version=1.8.0_222 (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,370] INFO Client environment:java.vendor=AdoptOpenJDK (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,370] INFO Client environment:java.home=/Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home/jre (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,370] INFO Client environment:java.class.path=/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/activation-1.1.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/aopalliance-repackaged-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/argparse4j-0.7.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/audience-annotations-0.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/commons-cli-1.4.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/commons-lang3-3.8.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-api-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-basic-auth-extension-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-file-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-json-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-mirror-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-mirror-client-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-runtime-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-transforms-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/guava-20.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/hk2-api-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/hk2-locator-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/hk2-utils-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-annotations-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-core-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-databind-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-dataformat-csv-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-datatype-jdk8-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-jaxrs-base-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-jaxrs-json-provider-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-module-jaxb-annotations-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-module-paranamer-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-module-scala_2.12-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.activation-api-1.2.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.annotation-api-1.3.4.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.inject-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.ws.rs-api-2.1.5.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.xml.bind-api-2.3.2.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/javassist-3.22.0-CR2.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/javax.servlet-api-3.1.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/javax.ws.rs-api-2.1.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jaxb-api-2.3.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-client-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-common-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-container-servlet-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-container-servlet-core-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-hk2-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-media-jaxb-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-server-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-client-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-continuation-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-http-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-io-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-security-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-server-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-servlet-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-servlets-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-util-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jopt-simple-5.0.4.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-clients-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-log4j-appender-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-streams-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-streams-examples-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-streams-scala_2.12-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-streams-test-utils-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-tools-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka_2.12-2.4.0-sources.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka_2.12-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/log4j-1.2.17.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/lz4-java-1.6.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/maven-artifact-3.6.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/metrics-core-2.2.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-buffer-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-codec-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-common-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-handler-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-resolver-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-transport-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-transport-native-epoll-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-transport-native-unix-common-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/osgi-resource-locator-1.0.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/paranamer-2.8.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/plexus-utils-3.2.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/reflections-0.9.11.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/rocksdbjni-5.18.3.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-collection-compat_2.12-2.1.2.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-java8-compat_2.12-0.9.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-library-2.12.10.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-logging_2.12-3.9.2.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-reflect-2.12.10.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/slf4j-api-1.7.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/slf4j-log4j12-1.7.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/snappy-java-1.1.7.3.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/validation-api-2.0.1.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/zookeeper-3.5.6.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/zookeeper-jute-3.5.6.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/zstd-jni-1.4.3-1.jar (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,370] INFO Client environment:java.library.path=/Users/yangweijie/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:. (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,371] INFO Client environment:java.io.tmpdir=/var/folders/cp/p4lwr_6n66s065dhcw80dzd80000gn/T/ (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,371] INFO Client environment:java.compiler=&lt;NA&gt; (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,371] INFO Client environment:os.name=Mac OS X (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,371] INFO Client environment:os.arch=x86_64 (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,371] INFO Client environment:os.version=10.15.4 (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,371] INFO Client environment:user.name=yangweijie (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,371] INFO Client environment:user.home=/Users/yangweijie (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,371] INFO Client environment:user.dir=/usr/local (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,371] INFO Client environment:os.memory.free=978MB (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,371] INFO Client environment:os.memory.max=1024MB (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,371] INFO Client environment:os.memory.total=1024MB (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,373] INFO Initiating client connection, connectString=localhost:2181 sessionTimeout=6000 watcher=kafka.zookeeper.ZooKeeperClient$ZooKeeperClientWatcher$@7722c3c3 (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:18,377] INFO Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation (org.apache.zookeeper.common.X509Util)[2020-04-29 18:21:18,383] INFO jute.maxbuffer value is 4194304 Bytes (org.apache.zookeeper.ClientCnxnSocket)[2020-04-29 18:21:18,388] INFO zookeeper.request.timeout value is 0. feature enabled= (org.apache.zookeeper.ClientCnxn)[2020-04-29 18:21:18,389] INFO [ZooKeeperClient Kafka server] Waiting until connected. (kafka.zookeeper.ZooKeeperClient)[2020-04-29 18:21:18,392] INFO Opening socket connection to server localhost/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error) (org.apache.zookeeper.ClientCnxn)[2020-04-29 18:21:18,403] INFO Socket connection established, initiating session, client: /127.0.0.1:56049, server: localhost/127.0.0.1:2181 (org.apache.zookeeper.ClientCnxn)[2020-04-29 18:21:18,408] INFO Session establishment complete on server localhost/127.0.0.1:2181, sessionid = 0x100000533120320, negotiated timeout = 6000 (org.apache.zookeeper.ClientCnxn)[2020-04-29 18:21:18,411] INFO [ZooKeeperClient Kafka server] Connected. (kafka.zookeeper.ZooKeeperClient)[2020-04-29 18:21:18,600] INFO Cluster ID = I5sBHS6MSMG4MmUddyviFQ (kafka.server.KafkaServer)[2020-04-29 18:21:18,659] INFO KafkaConfig values: advertised.host.name = null advertised.listeners = null advertised.port = null alter.config.policy.class.name = null alter.log.dirs.replication.quota.window.num = 11 alter.log.dirs.replication.quota.window.size.seconds = 1 authorizer.class.name = auto.create.topics.enable = true auto.leader.rebalance.enable = true background.threads = 10 broker.id = 0 broker.id.generation.enable = true broker.rack = null client.quota.callback.class = null compression.type = producer connection.failed.authentication.delay.ms = 100 connections.max.idle.ms = 600000 connections.max.reauth.ms = 0 control.plane.listener.name = null controlled.shutdown.enable = true controlled.shutdown.max.retries = 3 controlled.shutdown.retry.backoff.ms = 5000 controller.socket.timeout.ms = 30000 create.topic.policy.class.name = null default.replication.factor = 1 delegation.token.expiry.check.interval.ms = 3600000 delegation.token.expiry.time.ms = 86400000 delegation.token.master.key = null delegation.token.max.lifetime.ms = 604800000 delete.records.purgatory.purge.interval.requests = 1 delete.topic.enable = true fetch.purgatory.purge.interval.requests = 1000 group.initial.rebalance.delay.ms = 0 group.max.session.timeout.ms = 1800000 group.max.size = 2147483647 group.min.session.timeout.ms = 6000 host.name = inter.broker.listener.name = null inter.broker.protocol.version = 2.4-IV1 kafka.metrics.polling.interval.secs = 10 kafka.metrics.reporters = [] leader.imbalance.check.interval.seconds = 300 leader.imbalance.per.broker.percentage = 10 listener.security.protocol.map = PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL listeners = PLAINTEXT://:9092 log.cleaner.backoff.ms = 15000 log.cleaner.dedupe.buffer.size = 134217728 log.cleaner.delete.retention.ms = 86400000 log.cleaner.enable = true log.cleaner.io.buffer.load.factor = 0.9 log.cleaner.io.buffer.size = 524288 log.cleaner.io.max.bytes.per.second = 1.7976931348623157E308 log.cleaner.max.compaction.lag.ms = 9223372036854775807 log.cleaner.min.cleanable.ratio = 0.5 log.cleaner.min.compaction.lag.ms = 0 log.cleaner.threads = 1 log.cleanup.policy = [delete] log.dir = /tmp/kafka-logs log.dirs = /usr/local/etc/kafka/tmp/kafka-logs log.flush.interval.messages = 9223372036854775807 log.flush.interval.ms = null log.flush.offset.checkpoint.interval.ms = 60000 log.flush.scheduler.interval.ms = 9223372036854775807 log.flush.start.offset.checkpoint.interval.ms = 60000 log.index.interval.bytes = 4096 log.index.size.max.bytes = 10485760 log.message.downconversion.enable = true log.message.format.version = 2.4-IV1 log.message.timestamp.difference.max.ms = 9223372036854775807 log.message.timestamp.type = CreateTime log.preallocate = false log.retention.bytes = -1 log.retention.check.interval.ms = 300000 log.retention.hours = 168 log.retention.minutes = null log.retention.ms = null log.roll.hours = 168 log.roll.jitter.hours = 0 log.roll.jitter.ms = null log.roll.ms = null log.segment.bytes = 1073741824 log.segment.delete.delay.ms = 60000 max.connections = 2147483647 max.connections.per.ip = 2147483647 max.connections.per.ip.overrides = max.incremental.fetch.session.cache.slots = 1000 message.max.bytes = 1000012 metric.reporters = [] metrics.num.samples = 2 metrics.recording.level = INFO metrics.sample.window.ms = 30000 min.insync.replicas = 1 num.io.threads = 8 num.network.threads = 3 num.partitions = 1 num.recovery.threads.per.data.dir = 1 num.replica.alter.log.dirs.threads = null num.replica.fetchers = 1 offset.metadata.max.bytes = 4096 offsets.commit.required.acks = -1 offsets.commit.timeout.ms = 5000 offsets.load.buffer.size = 5242880 offsets.retention.check.interval.ms = 600000 offsets.retention.minutes = 10080 offsets.topic.compression.codec = 0 offsets.topic.num.partitions = 50 offsets.topic.replication.factor = 1 offsets.topic.segment.bytes = 104857600 password.encoder.cipher.algorithm = AES/CBC/PKCS5Padding password.encoder.iterations = 4096 password.encoder.key.length = 128 password.encoder.keyfactory.algorithm = null password.encoder.old.secret = null password.encoder.secret = null port = 9092 principal.builder.class = null producer.purgatory.purge.interval.requests = 1000 queued.max.request.bytes = -1 queued.max.requests = 500 quota.consumer.default = 9223372036854775807 quota.producer.default = 9223372036854775807 quota.window.num = 11 quota.window.size.seconds = 1 replica.fetch.backoff.ms = 1000 replica.fetch.max.bytes = 1048576 replica.fetch.min.bytes = 1 replica.fetch.response.max.bytes = 10485760 replica.fetch.wait.max.ms = 500 replica.high.watermark.checkpoint.interval.ms = 5000 replica.lag.time.max.ms = 10000 replica.selector.class = null replica.socket.receive.buffer.bytes = 65536 replica.socket.timeout.ms = 30000 replication.quota.window.num = 11 replication.quota.window.size.seconds = 1 request.timeout.ms = 30000 reserved.broker.max.id = 1000 sasl.client.callback.handler.class = null sasl.enabled.mechanisms = [GSSAPI] sasl.jaas.config = null sasl.kerberos.kinit.cmd = /usr/bin/kinit sasl.kerberos.min.time.before.relogin = 60000 sasl.kerberos.principal.to.local.rules = [DEFAULT] sasl.kerberos.service.name = null sasl.kerberos.ticket.renew.jitter = 0.05 sasl.kerberos.ticket.renew.window.factor = 0.8 sasl.login.callback.handler.class = null sasl.login.class = null sasl.login.refresh.buffer.seconds = 300 sasl.login.refresh.min.period.seconds = 60 sasl.login.refresh.window.factor = 0.8 sasl.login.refresh.window.jitter = 0.05 sasl.mechanism.inter.broker.protocol = GSSAPI sasl.server.callback.handler.class = null security.inter.broker.protocol = PLAINTEXT security.providers = null socket.receive.buffer.bytes = 102400 socket.request.max.bytes = 104857600 socket.send.buffer.bytes = 102400 ssl.cipher.suites = [] ssl.client.auth = none ssl.enabled.protocols = [TLSv1.2, TLSv1.1, TLSv1] ssl.endpoint.identification.algorithm = https ssl.key.password = null ssl.keymanager.algorithm = SunX509 ssl.keystore.location = null ssl.keystore.password = null ssl.keystore.type = JKS ssl.principal.mapping.rules = DEFAULT ssl.protocol = TLS ssl.provider = null ssl.secure.random.implementation = null ssl.trustmanager.algorithm = PKIX ssl.truststore.location = null ssl.truststore.password = null ssl.truststore.type = JKS transaction.abort.timed.out.transaction.cleanup.interval.ms = 60000 transaction.max.timeout.ms = 900000 transaction.remove.expired.transaction.cleanup.interval.ms = 3600000 transaction.state.log.load.buffer.size = 5242880 transaction.state.log.min.isr = 1 transaction.state.log.num.partitions = 50 transaction.state.log.replication.factor = 1 transaction.state.log.segment.bytes = 104857600 transactional.id.expiration.ms = 604800000 unclean.leader.election.enable = false zookeeper.connect = localhost:2181 zookeeper.connection.timeout.ms = 6000 zookeeper.max.in.flight.requests = 10 zookeeper.session.timeout.ms = 6000 zookeeper.set.acl = false zookeeper.sync.time.ms = 2000 (kafka.server.KafkaConfig)[2020-04-29 18:21:18,667] INFO KafkaConfig values: advertised.host.name = null advertised.listeners = null advertised.port = null alter.config.policy.class.name = null alter.log.dirs.replication.quota.window.num = 11 alter.log.dirs.replication.quota.window.size.seconds = 1 authorizer.class.name = auto.create.topics.enable = true auto.leader.rebalance.enable = true background.threads = 10 broker.id = 0 broker.id.generation.enable = true broker.rack = null client.quota.callback.class = null compression.type = producer connection.failed.authentication.delay.ms = 100 connections.max.idle.ms = 600000 connections.max.reauth.ms = 0 control.plane.listener.name = null controlled.shutdown.enable = true controlled.shutdown.max.retries = 3 controlled.shutdown.retry.backoff.ms = 5000 controller.socket.timeout.ms = 30000 create.topic.policy.class.name = null default.replication.factor = 1 delegation.token.expiry.check.interval.ms = 3600000 delegation.token.expiry.time.ms = 86400000 delegation.token.master.key = null delegation.token.max.lifetime.ms = 604800000 delete.records.purgatory.purge.interval.requests = 1 delete.topic.enable = true fetch.purgatory.purge.interval.requests = 1000 group.initial.rebalance.delay.ms = 0 group.max.session.timeout.ms = 1800000 group.max.size = 2147483647 group.min.session.timeout.ms = 6000 host.name = inter.broker.listener.name = null inter.broker.protocol.version = 2.4-IV1 kafka.metrics.polling.interval.secs = 10 kafka.metrics.reporters = [] leader.imbalance.check.interval.seconds = 300 leader.imbalance.per.broker.percentage = 10 listener.security.protocol.map = PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL listeners = PLAINTEXT://:9092 log.cleaner.backoff.ms = 15000 log.cleaner.dedupe.buffer.size = 134217728 log.cleaner.delete.retention.ms = 86400000 log.cleaner.enable = true log.cleaner.io.buffer.load.factor = 0.9 log.cleaner.io.buffer.size = 524288 log.cleaner.io.max.bytes.per.second = 1.7976931348623157E308 log.cleaner.max.compaction.lag.ms = 9223372036854775807 log.cleaner.min.cleanable.ratio = 0.5 log.cleaner.min.compaction.lag.ms = 0 log.cleaner.threads = 1 log.cleanup.policy = [delete] log.dir = /tmp/kafka-logs log.dirs = /usr/local/etc/kafka/tmp/kafka-logs log.flush.interval.messages = 9223372036854775807 log.flush.interval.ms = null log.flush.offset.checkpoint.interval.ms = 60000 log.flush.scheduler.interval.ms = 9223372036854775807 log.flush.start.offset.checkpoint.interval.ms = 60000 log.index.interval.bytes = 4096 log.index.size.max.bytes = 10485760 log.message.downconversion.enable = true log.message.format.version = 2.4-IV1 log.message.timestamp.difference.max.ms = 9223372036854775807 log.message.timestamp.type = CreateTime log.preallocate = false log.retention.bytes = -1 log.retention.check.interval.ms = 300000 log.retention.hours = 168 log.retention.minutes = null log.retention.ms = null log.roll.hours = 168 log.roll.jitter.hours = 0 log.roll.jitter.ms = null log.roll.ms = null log.segment.bytes = 1073741824 log.segment.delete.delay.ms = 60000 max.connections = 2147483647 max.connections.per.ip = 2147483647 max.connections.per.ip.overrides = max.incremental.fetch.session.cache.slots = 1000 message.max.bytes = 1000012 metric.reporters = [] metrics.num.samples = 2 metrics.recording.level = INFO metrics.sample.window.ms = 30000 min.insync.replicas = 1 num.io.threads = 8 num.network.threads = 3 num.partitions = 1 num.recovery.threads.per.data.dir = 1 num.replica.alter.log.dirs.threads = null num.replica.fetchers = 1 offset.metadata.max.bytes = 4096 offsets.commit.required.acks = -1 offsets.commit.timeout.ms = 5000 offsets.load.buffer.size = 5242880 offsets.retention.check.interval.ms = 600000 offsets.retention.minutes = 10080 offsets.topic.compression.codec = 0 offsets.topic.num.partitions = 50 offsets.topic.replication.factor = 1 offsets.topic.segment.bytes = 104857600 password.encoder.cipher.algorithm = AES/CBC/PKCS5Padding password.encoder.iterations = 4096 password.encoder.key.length = 128 password.encoder.keyfactory.algorithm = null password.encoder.old.secret = null password.encoder.secret = null port = 9092 principal.builder.class = null producer.purgatory.purge.interval.requests = 1000 queued.max.request.bytes = -1 queued.max.requests = 500 quota.consumer.default = 9223372036854775807 quota.producer.default = 9223372036854775807 quota.window.num = 11 quota.window.size.seconds = 1 replica.fetch.backoff.ms = 1000 replica.fetch.max.bytes = 1048576 replica.fetch.min.bytes = 1 replica.fetch.response.max.bytes = 10485760 replica.fetch.wait.max.ms = 500 replica.high.watermark.checkpoint.interval.ms = 5000 replica.lag.time.max.ms = 10000 replica.selector.class = null replica.socket.receive.buffer.bytes = 65536 replica.socket.timeout.ms = 30000 replication.quota.window.num = 11 replication.quota.window.size.seconds = 1 request.timeout.ms = 30000 reserved.broker.max.id = 1000 sasl.client.callback.handler.class = null sasl.enabled.mechanisms = [GSSAPI] sasl.jaas.config = null sasl.kerberos.kinit.cmd = /usr/bin/kinit sasl.kerberos.min.time.before.relogin = 60000 sasl.kerberos.principal.to.local.rules = [DEFAULT] sasl.kerberos.service.name = null sasl.kerberos.ticket.renew.jitter = 0.05 sasl.kerberos.ticket.renew.window.factor = 0.8 sasl.login.callback.handler.class = null sasl.login.class = null sasl.login.refresh.buffer.seconds = 300 sasl.login.refresh.min.period.seconds = 60 sasl.login.refresh.window.factor = 0.8 sasl.login.refresh.window.jitter = 0.05 sasl.mechanism.inter.broker.protocol = GSSAPI sasl.server.callback.handler.class = null security.inter.broker.protocol = PLAINTEXT security.providers = null socket.receive.buffer.bytes = 102400 socket.request.max.bytes = 104857600 socket.send.buffer.bytes = 102400 ssl.cipher.suites = [] ssl.client.auth = none ssl.enabled.protocols = [TLSv1.2, TLSv1.1, TLSv1] ssl.endpoint.identification.algorithm = https ssl.key.password = null ssl.keymanager.algorithm = SunX509 ssl.keystore.location = null ssl.keystore.password = null ssl.keystore.type = JKS ssl.principal.mapping.rules = DEFAULT ssl.protocol = TLS ssl.provider = null ssl.secure.random.implementation = null ssl.trustmanager.algorithm = PKIX ssl.truststore.location = null ssl.truststore.password = null ssl.truststore.type = JKS transaction.abort.timed.out.transaction.cleanup.interval.ms = 60000 transaction.max.timeout.ms = 900000 transaction.remove.expired.transaction.cleanup.interval.ms = 3600000 transaction.state.log.load.buffer.size = 5242880 transaction.state.log.min.isr = 1 transaction.state.log.num.partitions = 50 transaction.state.log.replication.factor = 1 transaction.state.log.segment.bytes = 104857600 transactional.id.expiration.ms = 604800000 unclean.leader.election.enable = false zookeeper.connect = localhost:2181 zookeeper.connection.timeout.ms = 6000 zookeeper.max.in.flight.requests = 10 zookeeper.session.timeout.ms = 6000 zookeeper.set.acl = false zookeeper.sync.time.ms = 2000 (kafka.server.KafkaConfig)[2020-04-29 18:21:18,688] INFO [ThrottledChannelReaper-Fetch]: Starting (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:18,688] INFO [ThrottledChannelReaper-Produce]: Starting (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:18,688] INFO [ThrottledChannelReaper-Request]: Starting (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:18,721] INFO Loading logs. (kafka.log.LogManager)[2020-04-29 18:21:18,768] INFO [Log partition=__consumer_offsets-9, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,770] INFO [Log partition=__consumer_offsets-9, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,802] INFO [Log partition=__consumer_offsets-9, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,804] INFO [Log partition=__consumer_offsets-9, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 60 ms (kafka.log.Log)[2020-04-29 18:21:18,812] INFO [Log partition=__consumer_offsets-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,812] INFO [Log partition=__consumer_offsets-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,814] INFO [Log partition=__consumer_offsets-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,815] INFO [Log partition=__consumer_offsets-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,819] INFO [Log partition=__consumer_offsets-7, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,819] INFO [Log partition=__consumer_offsets-7, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,821] INFO [Log partition=__consumer_offsets-7, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,822] INFO [Log partition=__consumer_offsets-7, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 5 ms (kafka.log.Log)[2020-04-29 18:21:18,826] INFO [Log partition=__consumer_offsets-31, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,826] INFO [Log partition=__consumer_offsets-31, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,828] INFO [Log partition=__consumer_offsets-31, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,829] INFO [Log partition=__consumer_offsets-31, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,832] INFO [Log partition=__consumer_offsets-36, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,832] INFO [Log partition=__consumer_offsets-36, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,834] INFO [Log partition=__consumer_offsets-36, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,835] INFO [Log partition=__consumer_offsets-36, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,838] INFO [Log partition=__consumer_offsets-38, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,839] INFO [Log partition=__consumer_offsets-38, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,841] INFO [Log partition=__consumer_offsets-38, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,841] INFO [Log partition=__consumer_offsets-38, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,845] INFO [Log partition=__consumer_offsets-6, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,845] INFO [Log partition=__consumer_offsets-6, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,847] INFO [Log partition=__consumer_offsets-6, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,847] INFO [Log partition=__consumer_offsets-6, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,850] INFO [Log partition=__consumer_offsets-1, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,851] INFO [Log partition=__consumer_offsets-1, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,853] INFO [Log partition=__consumer_offsets-1, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,853] INFO [Log partition=__consumer_offsets-1, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,857] INFO [Log partition=__consumer_offsets-8, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,857] INFO [Log partition=__consumer_offsets-8, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,859] INFO [Log partition=__consumer_offsets-8, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,859] INFO [Log partition=__consumer_offsets-8, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,863] INFO [Log partition=__consumer_offsets-39, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,863] INFO [Log partition=__consumer_offsets-39, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,865] INFO [Log partition=__consumer_offsets-39, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,865] INFO [Log partition=__consumer_offsets-39, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,869] INFO [Log partition=__consumer_offsets-37, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,869] INFO [Log partition=__consumer_offsets-37, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,871] INFO [Log partition=__consumer_offsets-37, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,871] INFO [Log partition=__consumer_offsets-37, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,874] INFO [Log partition=__consumer_offsets-30, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,874] INFO [Log partition=__consumer_offsets-30, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,876] INFO [Log partition=__consumer_offsets-30, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,877] INFO [Log partition=__consumer_offsets-30, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,881] INFO [Log partition=test-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,881] INFO [Log partition=test-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,891] INFO [ProducerStateManager partition=test-0] Writing producer snapshot at offset 13 (kafka.log.ProducerStateManager)[2020-04-29 18:21:18,898] INFO [Log partition=test-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 13 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,899] INFO [ProducerStateManager partition=test-0] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/test-0/00000000000000000013.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:18,906] INFO [Log partition=test-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 13 in 27 ms (kafka.log.Log)[2020-04-29 18:21:18,909] INFO [Log partition=__consumer_offsets-12, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,909] INFO [Log partition=__consumer_offsets-12, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,924] INFO [ProducerStateManager partition=__consumer_offsets-12] Writing producer snapshot at offset 430 (kafka.log.ProducerStateManager)[2020-04-29 18:21:18,926] INFO [Log partition=__consumer_offsets-12, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 430 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,926] INFO [ProducerStateManager partition=__consumer_offsets-12] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/__consumer_offsets-12/00000000000000000430.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:18,927] INFO [Log partition=__consumer_offsets-12, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 430 in 20 ms (kafka.log.Log)[2020-04-29 18:21:18,929] INFO [Log partition=__consumer_offsets-15, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,930] INFO [Log partition=__consumer_offsets-15, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,931] INFO [Log partition=__consumer_offsets-15, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,932] INFO [Log partition=__consumer_offsets-15, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,935] INFO [Log partition=__consumer_offsets-23, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,935] INFO [Log partition=__consumer_offsets-23, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,936] INFO [ProducerStateManager partition=__consumer_offsets-23] Writing producer snapshot at offset 3 (kafka.log.ProducerStateManager)[2020-04-29 18:21:18,938] INFO [Log partition=__consumer_offsets-23, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 3 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,938] INFO [ProducerStateManager partition=__consumer_offsets-23] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/__consumer_offsets-23/00000000000000000003.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:18,938] INFO [Log partition=__consumer_offsets-23, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 3 in 5 ms (kafka.log.Log)[2020-04-29 18:21:18,941] INFO [Log partition=__consumer_offsets-24, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,941] INFO [Log partition=__consumer_offsets-24, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,943] INFO [Log partition=__consumer_offsets-24, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,944] INFO [Log partition=__consumer_offsets-24, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,947] INFO [Log partition=test2-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,947] INFO [Log partition=test2-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,948] INFO [Log partition=test2-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,949] INFO [Log partition=test2-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:18,951] INFO [Log partition=__consumer_offsets-48, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,952] INFO [Log partition=__consumer_offsets-48, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,953] INFO [Log partition=__consumer_offsets-48, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,954] INFO [Log partition=__consumer_offsets-48, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,957] INFO [Log partition=__consumer_offsets-41, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,957] INFO [Log partition=__consumer_offsets-41, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,959] INFO [Log partition=__consumer_offsets-41, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,960] INFO [Log partition=__consumer_offsets-41, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 5 ms (kafka.log.Log)[2020-04-29 18:21:18,962] INFO [Log partition=__consumer_offsets-46, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,962] INFO [Log partition=__consumer_offsets-46, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,964] INFO [Log partition=__consumer_offsets-46, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,965] INFO [Log partition=__consumer_offsets-46, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,968] INFO [Log partition=__consumer_offsets-25, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,968] INFO [Log partition=__consumer_offsets-25, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,970] INFO [Log partition=__consumer_offsets-25, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,970] INFO [Log partition=__consumer_offsets-25, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:18,973] INFO [Log partition=__consumer_offsets-22, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,973] INFO [Log partition=__consumer_offsets-22, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,975] INFO [Log partition=__consumer_offsets-22, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,975] INFO [Log partition=__consumer_offsets-22, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:18,978] INFO [Log partition=__consumer_offsets-14, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,978] INFO [Log partition=__consumer_offsets-14, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,980] INFO [Log partition=__consumer_offsets-14, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,980] INFO [Log partition=__consumer_offsets-14, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:18,983] INFO [Log partition=__consumer_offsets-13, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,984] INFO [Log partition=__consumer_offsets-13, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,985] INFO [ProducerStateManager partition=__consumer_offsets-13] Writing producer snapshot at offset 3 (kafka.log.ProducerStateManager)[2020-04-29 18:21:18,986] INFO [Log partition=__consumer_offsets-13, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 3 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,987] INFO [ProducerStateManager partition=__consumer_offsets-13] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/__consumer_offsets-13/00000000000000000003.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:18,987] INFO [Log partition=__consumer_offsets-13, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 3 in 5 ms (kafka.log.Log)[2020-04-29 18:21:18,990] INFO [Log partition=__consumer_offsets-47, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,990] INFO [Log partition=__consumer_offsets-47, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,992] INFO [Log partition=__consumer_offsets-47, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,992] INFO [Log partition=__consumer_offsets-47, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:18,995] INFO [Log partition=__consumer_offsets-40, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,995] INFO [Log partition=__consumer_offsets-40, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,997] INFO [Log partition=__consumer_offsets-40, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:18,997] INFO [Log partition=__consumer_offsets-40, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:18,999] INFO [Log partition=__consumer_offsets-49, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:18,999] INFO [Log partition=__consumer_offsets-49, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,001] INFO [Log partition=__consumer_offsets-49, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,002] INFO [Log partition=__consumer_offsets-49, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,004] INFO [Log partition=__consumer_offsets-35, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,004] INFO [Log partition=__consumer_offsets-35, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,006] INFO [Log partition=__consumer_offsets-35, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,007] INFO [Log partition=__consumer_offsets-35, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,009] INFO [Log partition=__consumer_offsets-32, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,009] INFO [Log partition=__consumer_offsets-32, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,010] INFO [ProducerStateManager partition=__consumer_offsets-32] Writing producer snapshot at offset 3 (kafka.log.ProducerStateManager)[2020-04-29 18:21:19,012] INFO [Log partition=__consumer_offsets-32, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 3 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,012] INFO [ProducerStateManager partition=__consumer_offsets-32] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/__consumer_offsets-32/00000000000000000003.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:19,012] INFO [Log partition=__consumer_offsets-32, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 3 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,015] INFO [Log partition=__consumer_offsets-4, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,015] INFO [Log partition=__consumer_offsets-4, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,016] INFO [Log partition=__consumer_offsets-4, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,017] INFO [Log partition=__consumer_offsets-4, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,019] INFO [Log partition=__consumer_offsets-3, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,019] INFO [Log partition=__consumer_offsets-3, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,021] INFO [Log partition=__consumer_offsets-3, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,022] INFO [Log partition=__consumer_offsets-3, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,024] INFO [Log partition=__consumer_offsets-33, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,024] INFO [Log partition=__consumer_offsets-33, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,026] INFO [Log partition=__consumer_offsets-33, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,027] INFO [Log partition=__consumer_offsets-33, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,028] INFO [Log partition=__consumer_offsets-34, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,029] INFO [Log partition=__consumer_offsets-34, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,030] INFO [Log partition=__consumer_offsets-34, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,031] INFO [Log partition=__consumer_offsets-34, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:19,033] INFO [Log partition=__consumer_offsets-2, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,033] INFO [Log partition=__consumer_offsets-2, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,039] INFO [Log partition=__consumer_offsets-2, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,040] INFO [Log partition=__consumer_offsets-2, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 8 ms (kafka.log.Log)[2020-04-29 18:21:19,042] INFO [Log partition=__consumer_offsets-5, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,042] INFO [Log partition=__consumer_offsets-5, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,044] INFO [Log partition=__consumer_offsets-5, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,044] INFO [Log partition=__consumer_offsets-5, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:19,046] INFO [Log partition=jerome-1, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,046] INFO [Log partition=jerome-1, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,048] INFO [Log partition=jerome-1, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,048] INFO [Log partition=jerome-1, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:19,050] INFO [Log partition=__consumer_offsets-45, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,050] INFO [Log partition=__consumer_offsets-45, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,052] INFO [Log partition=__consumer_offsets-45, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,052] INFO [Log partition=__consumer_offsets-45, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:19,054] INFO [Log partition=__consumer_offsets-42, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,055] INFO [Log partition=__consumer_offsets-42, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,056] INFO [Log partition=__consumer_offsets-42, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,057] INFO [Log partition=__consumer_offsets-42, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,059] INFO [Log partition=__consumer_offsets-29, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,059] INFO [Log partition=__consumer_offsets-29, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,060] INFO [Log partition=__consumer_offsets-29, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,061] INFO [Log partition=__consumer_offsets-29, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:19,063] INFO [Log partition=__consumer_offsets-16, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,063] INFO [Log partition=__consumer_offsets-16, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,065] INFO [Log partition=__consumer_offsets-16, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,065] INFO [Log partition=__consumer_offsets-16, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:19,067] INFO [Log partition=topic-demo-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,067] INFO [Log partition=topic-demo-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,069] INFO [ProducerStateManager partition=topic-demo-0] Writing producer snapshot at offset 20 (kafka.log.ProducerStateManager)[2020-04-29 18:21:19,070] INFO [Log partition=topic-demo-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 20 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,071] INFO [ProducerStateManager partition=topic-demo-0] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/topic-demo-0/00000000000000000020.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:19,071] INFO [Log partition=topic-demo-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 20 in 5 ms (kafka.log.Log)[2020-04-29 18:21:19,073] INFO [Log partition=__consumer_offsets-11, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,073] INFO [Log partition=__consumer_offsets-11, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,075] INFO [Log partition=__consumer_offsets-11, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,075] INFO [Log partition=__consumer_offsets-11, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:19,077] INFO [Log partition=__consumer_offsets-18, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,077] INFO [Log partition=__consumer_offsets-18, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,080] INFO [Log partition=__consumer_offsets-18, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,080] INFO [Log partition=__consumer_offsets-18, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,083] INFO [Log partition=__consumer_offsets-27, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,083] INFO [Log partition=__consumer_offsets-27, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,084] INFO [ProducerStateManager partition=__consumer_offsets-27] Writing producer snapshot at offset 3 (kafka.log.ProducerStateManager)[2020-04-29 18:21:19,085] INFO [Log partition=__consumer_offsets-27, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 3 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,086] INFO [ProducerStateManager partition=__consumer_offsets-27] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/__consumer_offsets-27/00000000000000000003.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:19,086] INFO [Log partition=__consumer_offsets-27, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 3 in 5 ms (kafka.log.Log)[2020-04-29 18:21:19,088] INFO [Log partition=__consumer_offsets-20, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,088] INFO [Log partition=__consumer_offsets-20, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,090] INFO [Log partition=__consumer_offsets-20, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,090] INFO [Log partition=__consumer_offsets-20, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:19,092] INFO [Log partition=__consumer_offsets-43, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,092] INFO [Log partition=__consumer_offsets-43, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,094] INFO [Log partition=__consumer_offsets-43, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,094] INFO [Log partition=__consumer_offsets-43, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:19,096] INFO [Log partition=__consumer_offsets-44, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,096] INFO [Log partition=__consumer_offsets-44, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,098] INFO [Log partition=__consumer_offsets-44, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,098] INFO [Log partition=__consumer_offsets-44, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:19,100] INFO [Log partition=jerome-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,100] INFO [Log partition=jerome-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,102] INFO [Log partition=jerome-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,103] INFO [Log partition=jerome-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,104] INFO [Log partition=__consumer_offsets-21, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,104] INFO [Log partition=__consumer_offsets-21, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,106] INFO [Log partition=__consumer_offsets-21, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,107] INFO [Log partition=__consumer_offsets-21, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,108] INFO [Log partition=__consumer_offsets-19, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,108] INFO [Log partition=__consumer_offsets-19, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,110] INFO [Log partition=__consumer_offsets-19, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,111] INFO [Log partition=__consumer_offsets-19, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,112] INFO [Log partition=__consumer_offsets-26, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,112] INFO [Log partition=__consumer_offsets-26, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,114] INFO [Log partition=__consumer_offsets-26, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,115] INFO [Log partition=__consumer_offsets-26, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,116] INFO [Log partition=__consumer_offsets-10, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,116] INFO [Log partition=__consumer_offsets-10, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,118] INFO [Log partition=__consumer_offsets-10, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,119] INFO [Log partition=__consumer_offsets-10, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,120] INFO [Log partition=__consumer_offsets-28, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,120] INFO [Log partition=__consumer_offsets-28, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,122] INFO [Log partition=__consumer_offsets-28, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,122] INFO [Log partition=__consumer_offsets-28, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 3 ms (kafka.log.Log)[2020-04-29 18:21:19,124] INFO [Log partition=__consumer_offsets-17, dir=/usr/local/etc/kafka/tmp/kafka-logs] Recovering unflushed segment 0 (kafka.log.Log)[2020-04-29 18:21:19,124] INFO [Log partition=__consumer_offsets-17, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,126] INFO [Log partition=__consumer_offsets-17, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:19,127] INFO [Log partition=__consumer_offsets-17, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 4 ms (kafka.log.Log)[2020-04-29 18:21:19,128] INFO Logs loading complete in 407 ms. (kafka.log.LogManager)[2020-04-29 18:21:19,137] INFO Starting log cleanup with a period of 300000 ms. (kafka.log.LogManager)[2020-04-29 18:21:19,138] INFO Starting log flusher with a default period of 9223372036854775807 ms. (kafka.log.LogManager)[2020-04-29 18:21:19,399] INFO Awaiting socket connections on 0.0.0.0:9092. (kafka.network.Acceptor)[2020-04-29 18:21:19,420] INFO [SocketServer brokerId=0] Created data-plane acceptor and processors for endpoint : EndPoint(null,9092,ListenerName(PLAINTEXT),PLAINTEXT) (kafka.network.SocketServer)[2020-04-29 18:21:19,421] INFO [SocketServer brokerId=0] Started 1 acceptor threads for data-plane (kafka.network.SocketServer)[2020-04-29 18:21:19,437] INFO [ExpirationReaper-0-Produce]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,437] INFO [ExpirationReaper-0-Fetch]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,437] INFO [ExpirationReaper-0-DeleteRecords]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,438] INFO [ExpirationReaper-0-ElectLeader]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,447] INFO [LogDirFailureHandler]: Starting (kafka.server.ReplicaManager$LogDirFailureHandler)[2020-04-29 18:21:19,492] INFO Creating /brokers/ids/0 (is it secure? false) (kafka.zk.KafkaZkClient)[2020-04-29 18:21:19,502] ERROR Error while creating ephemeral at /brokers/ids/0, node already exists and owner '72057616369582879' does not match current session '72057616369582880' (kafka.zk.KafkaZkClient$CheckedEphemeral)[2020-04-29 18:21:19,508] ERROR [KafkaServer id=0] Fatal error during KafkaServer startup. Prepare to shutdown (kafka.server.KafkaServer)org.apache.zookeeper.KeeperException$NodeExistsException: KeeperErrorCode = NodeExists at org.apache.zookeeper.KeeperException.create(KeeperException.java:126) at kafka.zk.KafkaZkClient$CheckedEphemeral.getAfterNodeExists(KafkaZkClient.scala:1815) at kafka.zk.KafkaZkClient$CheckedEphemeral.create(KafkaZkClient.scala:1753) at kafka.zk.KafkaZkClient.checkedEphemeralCreate(KafkaZkClient.scala:1720) at kafka.zk.KafkaZkClient.registerBroker(KafkaZkClient.scala:93) at kafka.server.KafkaServer.startup(KafkaServer.scala:270) at kafka.server.KafkaServerStartable.startup(KafkaServerStartable.scala:44) at kafka.Kafka$.main(Kafka.scala:84) at kafka.Kafka.main(Kafka.scala)[2020-04-29 18:21:19,509] INFO [KafkaServer id=0] shutting down (kafka.server.KafkaServer)[2020-04-29 18:21:19,510] INFO [SocketServer brokerId=0] Stopping socket server request processors (kafka.network.SocketServer)[2020-04-29 18:21:19,514] INFO [SocketServer brokerId=0] Stopped socket server request processors (kafka.network.SocketServer)[2020-04-29 18:21:19,516] INFO [ReplicaManager broker=0] Shutting down (kafka.server.ReplicaManager)[2020-04-29 18:21:19,517] INFO [LogDirFailureHandler]: Shutting down (kafka.server.ReplicaManager$LogDirFailureHandler)[2020-04-29 18:21:19,517] INFO [LogDirFailureHandler]: Stopped (kafka.server.ReplicaManager$LogDirFailureHandler)[2020-04-29 18:21:19,517] INFO [LogDirFailureHandler]: Shutdown completed (kafka.server.ReplicaManager$LogDirFailureHandler)[2020-04-29 18:21:19,517] INFO [ReplicaFetcherManager on broker 0] shutting down (kafka.server.ReplicaFetcherManager)[2020-04-29 18:21:19,518] INFO [ReplicaFetcherManager on broker 0] shutdown completed (kafka.server.ReplicaFetcherManager)[2020-04-29 18:21:19,519] INFO [ReplicaAlterLogDirsManager on broker 0] shutting down (kafka.server.ReplicaAlterLogDirsManager)[2020-04-29 18:21:19,519] INFO [ReplicaAlterLogDirsManager on broker 0] shutdown completed (kafka.server.ReplicaAlterLogDirsManager)[2020-04-29 18:21:19,519] INFO [ExpirationReaper-0-Fetch]: Shutting down (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,637] INFO [ExpirationReaper-0-Fetch]: Stopped (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,637] INFO [ExpirationReaper-0-Fetch]: Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,638] INFO [ExpirationReaper-0-Produce]: Shutting down (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,911] INFO [ExpirationReaper-0-Produce]: Stopped (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,911] INFO [ExpirationReaper-0-Produce]: Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,912] INFO [ExpirationReaper-0-DeleteRecords]: Shutting down (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,912] INFO [ExpirationReaper-0-DeleteRecords]: Stopped (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,912] INFO [ExpirationReaper-0-DeleteRecords]: Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:19,913] INFO [ExpirationReaper-0-ElectLeader]: Shutting down (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:20,187] INFO [ExpirationReaper-0-ElectLeader]: Stopped (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:20,187] INFO [ExpirationReaper-0-ElectLeader]: Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:20,194] INFO [ReplicaManager broker=0] Shut down completely (kafka.server.ReplicaManager)[2020-04-29 18:21:20,195] INFO Shutting down. (kafka.log.LogManager)[2020-04-29 18:21:20,262] INFO Shutdown complete. (kafka.log.LogManager)[2020-04-29 18:21:20,263] INFO [ZooKeeperClient Kafka server] Closing. (kafka.zookeeper.ZooKeeperClient)[2020-04-29 18:21:20,441] INFO Session: 0x100000533120320 closed (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:20,441] INFO EventThread shut down for session: 0x100000533120320 (org.apache.zookeeper.ClientCnxn)[2020-04-29 18:21:20,442] INFO [ZooKeeperClient Kafka server] Closed. (kafka.zookeeper.ZooKeeperClient)[2020-04-29 18:21:20,442] INFO [ThrottledChannelReaper-Fetch]: Shutting down (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:20,714] INFO [ThrottledChannelReaper-Fetch]: Stopped (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:20,714] INFO [ThrottledChannelReaper-Fetch]: Shutdown completed (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:20,714] INFO [ThrottledChannelReaper-Produce]: Shutting down (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:21,714] INFO [ThrottledChannelReaper-Produce]: Stopped (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:21,714] INFO [ThrottledChannelReaper-Produce]: Shutdown completed (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:21,714] INFO [ThrottledChannelReaper-Request]: Shutting down (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:22,786] INFO [ThrottledChannelReaper-Request]: Stopped (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:22,786] INFO [ThrottledChannelReaper-Request]: Shutdown completed (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:22,788] INFO [SocketServer brokerId=0] Shutting down socket server (kafka.network.SocketServer)[2020-04-29 18:21:22,814] INFO [SocketServer brokerId=0] Shutdown completed (kafka.network.SocketServer)[2020-04-29 18:21:22,818] INFO [KafkaServer id=0] shut down completed (kafka.server.KafkaServer)[2020-04-29 18:21:22,819] ERROR Exiting Kafka. (kafka.server.KafkaServerStartable)[2020-04-29 18:21:22,825] INFO [KafkaServer id=0] shutting down (kafka.server.KafkaServer)[2020-04-29 18:21:28,872] INFO Registered kafka:type=kafka.Log4jController MBean (kafka.utils.Log4jControllerRegistration$)[2020-04-29 18:21:29,333] INFO Registered signal handlers for TERM, INT, HUP (org.apache.kafka.common.utils.LoggingSignalHandler)[2020-04-29 18:21:29,334] INFO starting (kafka.server.KafkaServer)[2020-04-29 18:21:29,335] INFO Connecting to zookeeper on localhost:2181 (kafka.server.KafkaServer)[2020-04-29 18:21:29,350] INFO [ZooKeeperClient Kafka server] Initializing a new session to localhost:2181. (kafka.zookeeper.ZooKeeperClient)[2020-04-29 18:21:29,355] INFO Client environment:zookeeper.version=3.5.6-c11b7e26bc554b8523dc929761dd28808913f091, built on 10/08/2019 20:18 GMT (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,355] INFO Client environment:host.name=localhost (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,355] INFO Client environment:java.version=1.8.0_222 (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,355] INFO Client environment:java.vendor=AdoptOpenJDK (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,355] INFO Client environment:java.home=/Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home/jre (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,356] INFO Client environment:java.class.path=/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/activation-1.1.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/aopalliance-repackaged-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/argparse4j-0.7.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/audience-annotations-0.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/commons-cli-1.4.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/commons-lang3-3.8.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-api-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-basic-auth-extension-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-file-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-json-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-mirror-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-mirror-client-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-runtime-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/connect-transforms-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/guava-20.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/hk2-api-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/hk2-locator-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/hk2-utils-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-annotations-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-core-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-databind-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-dataformat-csv-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-datatype-jdk8-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-jaxrs-base-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-jaxrs-json-provider-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-module-jaxb-annotations-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-module-paranamer-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jackson-module-scala_2.12-2.10.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.activation-api-1.2.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.annotation-api-1.3.4.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.inject-2.5.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.ws.rs-api-2.1.5.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jakarta.xml.bind-api-2.3.2.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/javassist-3.22.0-CR2.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/javax.servlet-api-3.1.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/javax.ws.rs-api-2.1.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jaxb-api-2.3.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-client-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-common-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-container-servlet-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-container-servlet-core-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-hk2-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-media-jaxb-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jersey-server-2.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-client-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-continuation-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-http-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-io-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-security-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-server-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-servlet-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-servlets-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jetty-util-9.4.20.v20190813.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/jopt-simple-5.0.4.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-clients-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-log4j-appender-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-streams-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-streams-examples-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-streams-scala_2.12-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-streams-test-utils-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka-tools-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka_2.12-2.4.0-sources.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/kafka_2.12-2.4.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/log4j-1.2.17.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/lz4-java-1.6.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/maven-artifact-3.6.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/metrics-core-2.2.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-buffer-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-codec-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-common-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-handler-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-resolver-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-transport-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-transport-native-epoll-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/netty-transport-native-unix-common-4.1.42.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/osgi-resource-locator-1.0.1.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/paranamer-2.8.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/plexus-utils-3.2.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/reflections-0.9.11.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/rocksdbjni-5.18.3.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-collection-compat_2.12-2.1.2.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-java8-compat_2.12-0.9.0.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-library-2.12.10.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-logging_2.12-3.9.2.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/scala-reflect-2.12.10.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/slf4j-api-1.7.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/slf4j-log4j12-1.7.28.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/snappy-java-1.1.7.3.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/validation-api-2.0.1.Final.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/zookeeper-3.5.6.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/zookeeper-jute-3.5.6.jar:/usr/local/Cellar/kafka/2.4.0/libexec/bin/../libs/zstd-jni-1.4.3-1.jar (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,356] INFO Client environment:java.library.path=/Users/yangweijie/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:. (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,356] INFO Client environment:java.io.tmpdir=/var/folders/cp/p4lwr_6n66s065dhcw80dzd80000gn/T/ (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,356] INFO Client environment:java.compiler=&lt;NA&gt; (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,356] INFO Client environment:os.name=Mac OS X (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,356] INFO Client environment:os.arch=x86_64 (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,356] INFO Client environment:os.version=10.15.4 (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,356] INFO Client environment:user.name=yangweijie (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,356] INFO Client environment:user.home=/Users/yangweijie (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,356] INFO Client environment:user.dir=/usr/local (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,356] INFO Client environment:os.memory.free=978MB (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,356] INFO Client environment:os.memory.max=1024MB (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,356] INFO Client environment:os.memory.total=1024MB (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,358] INFO Initiating client connection, connectString=localhost:2181 sessionTimeout=6000 watcher=kafka.zookeeper.ZooKeeperClient$ZooKeeperClientWatcher$@7722c3c3 (org.apache.zookeeper.ZooKeeper)[2020-04-29 18:21:29,362] INFO Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation (org.apache.zookeeper.common.X509Util)[2020-04-29 18:21:29,367] INFO jute.maxbuffer value is 4194304 Bytes (org.apache.zookeeper.ClientCnxnSocket)[2020-04-29 18:21:29,372] INFO zookeeper.request.timeout value is 0. feature enabled= (org.apache.zookeeper.ClientCnxn)[2020-04-29 18:21:29,374] INFO [ZooKeeperClient Kafka server] Waiting until connected. (kafka.zookeeper.ZooKeeperClient)[2020-04-29 18:21:29,377] INFO Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181. Will not attempt to authenticate using SASL (unknown error) (org.apache.zookeeper.ClientCnxn)[2020-04-29 18:21:29,387] INFO Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:56065, server: localhost/0:0:0:0:0:0:0:1:2181 (org.apache.zookeeper.ClientCnxn)[2020-04-29 18:21:29,391] INFO Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, sessionid = 0x100000533120321, negotiated timeout = 6000 (org.apache.zookeeper.ClientCnxn)[2020-04-29 18:21:29,394] INFO [ZooKeeperClient Kafka server] Connected. (kafka.zookeeper.ZooKeeperClient)[2020-04-29 18:21:29,570] INFO Cluster ID = I5sBHS6MSMG4MmUddyviFQ (kafka.server.KafkaServer)[2020-04-29 18:21:29,625] INFO KafkaConfig values: advertised.host.name = null advertised.listeners = null advertised.port = null alter.config.policy.class.name = null alter.log.dirs.replication.quota.window.num = 11 alter.log.dirs.replication.quota.window.size.seconds = 1 authorizer.class.name = auto.create.topics.enable = true auto.leader.rebalance.enable = true background.threads = 10 broker.id = 0 broker.id.generation.enable = true broker.rack = null client.quota.callback.class = null compression.type = producer connection.failed.authentication.delay.ms = 100 connections.max.idle.ms = 600000 connections.max.reauth.ms = 0 control.plane.listener.name = null controlled.shutdown.enable = true controlled.shutdown.max.retries = 3 controlled.shutdown.retry.backoff.ms = 5000 controller.socket.timeout.ms = 30000 create.topic.policy.class.name = null default.replication.factor = 1 delegation.token.expiry.check.interval.ms = 3600000 delegation.token.expiry.time.ms = 86400000 delegation.token.master.key = null delegation.token.max.lifetime.ms = 604800000 delete.records.purgatory.purge.interval.requests = 1 delete.topic.enable = true fetch.purgatory.purge.interval.requests = 1000 group.initial.rebalance.delay.ms = 0 group.max.session.timeout.ms = 1800000 group.max.size = 2147483647 group.min.session.timeout.ms = 6000 host.name = inter.broker.listener.name = null inter.broker.protocol.version = 2.4-IV1 kafka.metrics.polling.interval.secs = 10 kafka.metrics.reporters = [] leader.imbalance.check.interval.seconds = 300 leader.imbalance.per.broker.percentage = 10 listener.security.protocol.map = PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL listeners = PLAINTEXT://:9092 log.cleaner.backoff.ms = 15000 log.cleaner.dedupe.buffer.size = 134217728 log.cleaner.delete.retention.ms = 86400000 log.cleaner.enable = true log.cleaner.io.buffer.load.factor = 0.9 log.cleaner.io.buffer.size = 524288 log.cleaner.io.max.bytes.per.second = 1.7976931348623157E308 log.cleaner.max.compaction.lag.ms = 9223372036854775807 log.cleaner.min.cleanable.ratio = 0.5 log.cleaner.min.compaction.lag.ms = 0 log.cleaner.threads = 1 log.cleanup.policy = [delete] log.dir = /tmp/kafka-logs log.dirs = /usr/local/etc/kafka/tmp/kafka-logs log.flush.interval.messages = 9223372036854775807 log.flush.interval.ms = null log.flush.offset.checkpoint.interval.ms = 60000 log.flush.scheduler.interval.ms = 9223372036854775807 log.flush.start.offset.checkpoint.interval.ms = 60000 log.index.interval.bytes = 4096 log.index.size.max.bytes = 10485760 log.message.downconversion.enable = true log.message.format.version = 2.4-IV1 log.message.timestamp.difference.max.ms = 9223372036854775807 log.message.timestamp.type = CreateTime log.preallocate = false log.retention.bytes = -1 log.retention.check.interval.ms = 300000 log.retention.hours = 168 log.retention.minutes = null log.retention.ms = null log.roll.hours = 168 log.roll.jitter.hours = 0 log.roll.jitter.ms = null log.roll.ms = null log.segment.bytes = 1073741824 log.segment.delete.delay.ms = 60000 max.connections = 2147483647 max.connections.per.ip = 2147483647 max.connections.per.ip.overrides = max.incremental.fetch.session.cache.slots = 1000 message.max.bytes = 1000012 metric.reporters = [] metrics.num.samples = 2 metrics.recording.level = INFO metrics.sample.window.ms = 30000 min.insync.replicas = 1 num.io.threads = 8 num.network.threads = 3 num.partitions = 1 num.recovery.threads.per.data.dir = 1 num.replica.alter.log.dirs.threads = null num.replica.fetchers = 1 offset.metadata.max.bytes = 4096 offsets.commit.required.acks = -1 offsets.commit.timeout.ms = 5000 offsets.load.buffer.size = 5242880 offsets.retention.check.interval.ms = 600000 offsets.retention.minutes = 10080 offsets.topic.compression.codec = 0 offsets.topic.num.partitions = 50 offsets.topic.replication.factor = 1 offsets.topic.segment.bytes = 104857600 password.encoder.cipher.algorithm = AES/CBC/PKCS5Padding password.encoder.iterations = 4096 password.encoder.key.length = 128 password.encoder.keyfactory.algorithm = null password.encoder.old.secret = null password.encoder.secret = null port = 9092 principal.builder.class = null producer.purgatory.purge.interval.requests = 1000 queued.max.request.bytes = -1 queued.max.requests = 500 quota.consumer.default = 9223372036854775807 quota.producer.default = 9223372036854775807 quota.window.num = 11 quota.window.size.seconds = 1 replica.fetch.backoff.ms = 1000 replica.fetch.max.bytes = 1048576 replica.fetch.min.bytes = 1 replica.fetch.response.max.bytes = 10485760 replica.fetch.wait.max.ms = 500 replica.high.watermark.checkpoint.interval.ms = 5000 replica.lag.time.max.ms = 10000 replica.selector.class = null replica.socket.receive.buffer.bytes = 65536 replica.socket.timeout.ms = 30000 replication.quota.window.num = 11 replication.quota.window.size.seconds = 1 request.timeout.ms = 30000 reserved.broker.max.id = 1000 sasl.client.callback.handler.class = null sasl.enabled.mechanisms = [GSSAPI] sasl.jaas.config = null sasl.kerberos.kinit.cmd = /usr/bin/kinit sasl.kerberos.min.time.before.relogin = 60000 sasl.kerberos.principal.to.local.rules = [DEFAULT] sasl.kerberos.service.name = null sasl.kerberos.ticket.renew.jitter = 0.05 sasl.kerberos.ticket.renew.window.factor = 0.8 sasl.login.callback.handler.class = null sasl.login.class = null sasl.login.refresh.buffer.seconds = 300 sasl.login.refresh.min.period.seconds = 60 sasl.login.refresh.window.factor = 0.8 sasl.login.refresh.window.jitter = 0.05 sasl.mechanism.inter.broker.protocol = GSSAPI sasl.server.callback.handler.class = null security.inter.broker.protocol = PLAINTEXT security.providers = null socket.receive.buffer.bytes = 102400 socket.request.max.bytes = 104857600 socket.send.buffer.bytes = 102400 ssl.cipher.suites = [] ssl.client.auth = none ssl.enabled.protocols = [TLSv1.2, TLSv1.1, TLSv1] ssl.endpoint.identification.algorithm = https ssl.key.password = null ssl.keymanager.algorithm = SunX509 ssl.keystore.location = null ssl.keystore.password = null ssl.keystore.type = JKS ssl.principal.mapping.rules = DEFAULT ssl.protocol = TLS ssl.provider = null ssl.secure.random.implementation = null ssl.trustmanager.algorithm = PKIX ssl.truststore.location = null ssl.truststore.password = null ssl.truststore.type = JKS transaction.abort.timed.out.transaction.cleanup.interval.ms = 60000 transaction.max.timeout.ms = 900000 transaction.remove.expired.transaction.cleanup.interval.ms = 3600000 transaction.state.log.load.buffer.size = 5242880 transaction.state.log.min.isr = 1 transaction.state.log.num.partitions = 50 transaction.state.log.replication.factor = 1 transaction.state.log.segment.bytes = 104857600 transactional.id.expiration.ms = 604800000 unclean.leader.election.enable = false zookeeper.connect = localhost:2181 zookeeper.connection.timeout.ms = 6000 zookeeper.max.in.flight.requests = 10 zookeeper.session.timeout.ms = 6000 zookeeper.set.acl = false zookeeper.sync.time.ms = 2000 (kafka.server.KafkaConfig)[2020-04-29 18:21:29,633] INFO KafkaConfig values: advertised.host.name = null advertised.listeners = null advertised.port = null alter.config.policy.class.name = null alter.log.dirs.replication.quota.window.num = 11 alter.log.dirs.replication.quota.window.size.seconds = 1 authorizer.class.name = auto.create.topics.enable = true auto.leader.rebalance.enable = true background.threads = 10 broker.id = 0 broker.id.generation.enable = true broker.rack = null client.quota.callback.class = null compression.type = producer connection.failed.authentication.delay.ms = 100 connections.max.idle.ms = 600000 connections.max.reauth.ms = 0 control.plane.listener.name = null controlled.shutdown.enable = true controlled.shutdown.max.retries = 3 controlled.shutdown.retry.backoff.ms = 5000 controller.socket.timeout.ms = 30000 create.topic.policy.class.name = null default.replication.factor = 1 delegation.token.expiry.check.interval.ms = 3600000 delegation.token.expiry.time.ms = 86400000 delegation.token.master.key = null delegation.token.max.lifetime.ms = 604800000 delete.records.purgatory.purge.interval.requests = 1 delete.topic.enable = true fetch.purgatory.purge.interval.requests = 1000 group.initial.rebalance.delay.ms = 0 group.max.session.timeout.ms = 1800000 group.max.size = 2147483647 group.min.session.timeout.ms = 6000 host.name = inter.broker.listener.name = null inter.broker.protocol.version = 2.4-IV1 kafka.metrics.polling.interval.secs = 10 kafka.metrics.reporters = [] leader.imbalance.check.interval.seconds = 300 leader.imbalance.per.broker.percentage = 10 listener.security.protocol.map = PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL listeners = PLAINTEXT://:9092 log.cleaner.backoff.ms = 15000 log.cleaner.dedupe.buffer.size = 134217728 log.cleaner.delete.retention.ms = 86400000 log.cleaner.enable = true log.cleaner.io.buffer.load.factor = 0.9 log.cleaner.io.buffer.size = 524288 log.cleaner.io.max.bytes.per.second = 1.7976931348623157E308 log.cleaner.max.compaction.lag.ms = 9223372036854775807 log.cleaner.min.cleanable.ratio = 0.5 log.cleaner.min.compaction.lag.ms = 0 log.cleaner.threads = 1 log.cleanup.policy = [delete] log.dir = /tmp/kafka-logs log.dirs = /usr/local/etc/kafka/tmp/kafka-logs log.flush.interval.messages = 9223372036854775807 log.flush.interval.ms = null log.flush.offset.checkpoint.interval.ms = 60000 log.flush.scheduler.interval.ms = 9223372036854775807 log.flush.start.offset.checkpoint.interval.ms = 60000 log.index.interval.bytes = 4096 log.index.size.max.bytes = 10485760 log.message.downconversion.enable = true log.message.format.version = 2.4-IV1 log.message.timestamp.difference.max.ms = 9223372036854775807 log.message.timestamp.type = CreateTime log.preallocate = false log.retention.bytes = -1 log.retention.check.interval.ms = 300000 log.retention.hours = 168 log.retention.minutes = null log.retention.ms = null log.roll.hours = 168 log.roll.jitter.hours = 0 log.roll.jitter.ms = null log.roll.ms = null log.segment.bytes = 1073741824 log.segment.delete.delay.ms = 60000 max.connections = 2147483647 max.connections.per.ip = 2147483647 max.connections.per.ip.overrides = max.incremental.fetch.session.cache.slots = 1000 message.max.bytes = 1000012 metric.reporters = [] metrics.num.samples = 2 metrics.recording.level = INFO metrics.sample.window.ms = 30000 min.insync.replicas = 1 num.io.threads = 8 num.network.threads = 3 num.partitions = 1 num.recovery.threads.per.data.dir = 1 num.replica.alter.log.dirs.threads = null num.replica.fetchers = 1 offset.metadata.max.bytes = 4096 offsets.commit.required.acks = -1 offsets.commit.timeout.ms = 5000 offsets.load.buffer.size = 5242880 offsets.retention.check.interval.ms = 600000 offsets.retention.minutes = 10080 offsets.topic.compression.codec = 0 offsets.topic.num.partitions = 50 offsets.topic.replication.factor = 1 offsets.topic.segment.bytes = 104857600 password.encoder.cipher.algorithm = AES/CBC/PKCS5Padding password.encoder.iterations = 4096 password.encoder.key.length = 128 password.encoder.keyfactory.algorithm = null password.encoder.old.secret = null password.encoder.secret = null port = 9092 principal.builder.class = null producer.purgatory.purge.interval.requests = 1000 queued.max.request.bytes = -1 queued.max.requests = 500 quota.consumer.default = 9223372036854775807 quota.producer.default = 9223372036854775807 quota.window.num = 11 quota.window.size.seconds = 1 replica.fetch.backoff.ms = 1000 replica.fetch.max.bytes = 1048576 replica.fetch.min.bytes = 1 replica.fetch.response.max.bytes = 10485760 replica.fetch.wait.max.ms = 500 replica.high.watermark.checkpoint.interval.ms = 5000 replica.lag.time.max.ms = 10000 replica.selector.class = null replica.socket.receive.buffer.bytes = 65536 replica.socket.timeout.ms = 30000 replication.quota.window.num = 11 replication.quota.window.size.seconds = 1 request.timeout.ms = 30000 reserved.broker.max.id = 1000 sasl.client.callback.handler.class = null sasl.enabled.mechanisms = [GSSAPI] sasl.jaas.config = null sasl.kerberos.kinit.cmd = /usr/bin/kinit sasl.kerberos.min.time.before.relogin = 60000 sasl.kerberos.principal.to.local.rules = [DEFAULT] sasl.kerberos.service.name = null sasl.kerberos.ticket.renew.jitter = 0.05 sasl.kerberos.ticket.renew.window.factor = 0.8 sasl.login.callback.handler.class = null sasl.login.class = null sasl.login.refresh.buffer.seconds = 300 sasl.login.refresh.min.period.seconds = 60 sasl.login.refresh.window.factor = 0.8 sasl.login.refresh.window.jitter = 0.05 sasl.mechanism.inter.broker.protocol = GSSAPI sasl.server.callback.handler.class = null security.inter.broker.protocol = PLAINTEXT security.providers = null socket.receive.buffer.bytes = 102400 socket.request.max.bytes = 104857600 socket.send.buffer.bytes = 102400 ssl.cipher.suites = [] ssl.client.auth = none ssl.enabled.protocols = [TLSv1.2, TLSv1.1, TLSv1] ssl.endpoint.identification.algorithm = https ssl.key.password = null ssl.keymanager.algorithm = SunX509 ssl.keystore.location = null ssl.keystore.password = null ssl.keystore.type = JKS ssl.principal.mapping.rules = DEFAULT ssl.protocol = TLS ssl.provider = null ssl.secure.random.implementation = null ssl.trustmanager.algorithm = PKIX ssl.truststore.location = null ssl.truststore.password = null ssl.truststore.type = JKS transaction.abort.timed.out.transaction.cleanup.interval.ms = 60000 transaction.max.timeout.ms = 900000 transaction.remove.expired.transaction.cleanup.interval.ms = 3600000 transaction.state.log.load.buffer.size = 5242880 transaction.state.log.min.isr = 1 transaction.state.log.num.partitions = 50 transaction.state.log.replication.factor = 1 transaction.state.log.segment.bytes = 104857600 transactional.id.expiration.ms = 604800000 unclean.leader.election.enable = false zookeeper.connect = localhost:2181 zookeeper.connection.timeout.ms = 6000 zookeeper.max.in.flight.requests = 10 zookeeper.session.timeout.ms = 6000 zookeeper.set.acl = false zookeeper.sync.time.ms = 2000 (kafka.server.KafkaConfig)[2020-04-29 18:21:29,654] INFO [ThrottledChannelReaper-Fetch]: Starting (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:29,654] INFO [ThrottledChannelReaper-Produce]: Starting (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:29,655] INFO [ThrottledChannelReaper-Request]: Starting (kafka.server.ClientQuotaManager$ThrottledChannelReaper)[2020-04-29 18:21:29,686] INFO Loading logs. (kafka.log.LogManager)[2020-04-29 18:21:29,744] INFO [Log partition=__consumer_offsets-9, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,752] INFO [Log partition=__consumer_offsets-9, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 43 ms (kafka.log.Log)[2020-04-29 18:21:29,760] INFO [Log partition=__consumer_offsets-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,761] INFO [Log partition=__consumer_offsets-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,765] INFO [Log partition=__consumer_offsets-7, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,765] INFO [Log partition=__consumer_offsets-7, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,769] INFO [Log partition=__consumer_offsets-31, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,769] INFO [Log partition=__consumer_offsets-31, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,773] INFO [Log partition=__consumer_offsets-36, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,773] INFO [Log partition=__consumer_offsets-36, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,777] INFO [Log partition=__consumer_offsets-38, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,777] INFO [Log partition=__consumer_offsets-38, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,781] INFO [Log partition=__consumer_offsets-6, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,781] INFO [Log partition=__consumer_offsets-6, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,785] INFO [Log partition=__consumer_offsets-1, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,785] INFO [Log partition=__consumer_offsets-1, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,788] INFO [Log partition=__consumer_offsets-8, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,788] INFO [Log partition=__consumer_offsets-8, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,792] INFO [Log partition=__consumer_offsets-39, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,792] INFO [Log partition=__consumer_offsets-39, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,796] INFO [Log partition=__consumer_offsets-37, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,796] INFO [Log partition=__consumer_offsets-37, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,799] INFO [Log partition=__consumer_offsets-30, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,799] INFO [Log partition=__consumer_offsets-30, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,814] INFO [Log partition=test-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 13 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,818] INFO [ProducerStateManager partition=test-0] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/test-0/00000000000000000013.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:29,828] INFO [Log partition=test-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 13 in 27 ms (kafka.log.Log)[2020-04-29 18:21:29,833] INFO [Log partition=__consumer_offsets-12, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 430 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,833] INFO [ProducerStateManager partition=__consumer_offsets-12] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/__consumer_offsets-12/00000000000000000430.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:29,834] INFO [Log partition=__consumer_offsets-12, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 430 in 4 ms (kafka.log.Log)[2020-04-29 18:21:29,837] INFO [Log partition=__consumer_offsets-15, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,837] INFO [Log partition=__consumer_offsets-15, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,841] INFO [Log partition=__consumer_offsets-23, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 3 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,842] INFO [ProducerStateManager partition=__consumer_offsets-23] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/__consumer_offsets-23/00000000000000000003.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:29,842] INFO [Log partition=__consumer_offsets-23, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 3 in 3 ms (kafka.log.Log)[2020-04-29 18:21:29,845] INFO [Log partition=__consumer_offsets-24, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,846] INFO [Log partition=__consumer_offsets-24, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,849] INFO [Log partition=test2-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,849] INFO [Log partition=test2-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,852] INFO [Log partition=__consumer_offsets-48, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,852] INFO [Log partition=__consumer_offsets-48, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,855] INFO [Log partition=__consumer_offsets-41, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,855] INFO [Log partition=__consumer_offsets-41, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,858] INFO [Log partition=__consumer_offsets-46, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,859] INFO [Log partition=__consumer_offsets-46, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,862] INFO [Log partition=__consumer_offsets-25, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,862] INFO [Log partition=__consumer_offsets-25, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,865] INFO [Log partition=__consumer_offsets-22, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,865] INFO [Log partition=__consumer_offsets-22, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,868] INFO [Log partition=__consumer_offsets-14, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,868] INFO [Log partition=__consumer_offsets-14, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,872] INFO [Log partition=__consumer_offsets-13, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 3 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,873] INFO [ProducerStateManager partition=__consumer_offsets-13] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/__consumer_offsets-13/00000000000000000003.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:29,873] INFO [Log partition=__consumer_offsets-13, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 3 in 4 ms (kafka.log.Log)[2020-04-29 18:21:29,876] INFO [Log partition=__consumer_offsets-47, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,876] INFO [Log partition=__consumer_offsets-47, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,879] INFO [Log partition=__consumer_offsets-40, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,879] INFO [Log partition=__consumer_offsets-40, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,882] INFO [Log partition=__consumer_offsets-49, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,882] INFO [Log partition=__consumer_offsets-49, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,885] INFO [Log partition=__consumer_offsets-35, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,885] INFO [Log partition=__consumer_offsets-35, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,889] INFO [Log partition=__consumer_offsets-32, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 3 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,890] INFO [ProducerStateManager partition=__consumer_offsets-32] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/__consumer_offsets-32/00000000000000000003.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:29,890] INFO [Log partition=__consumer_offsets-32, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 3 in 4 ms (kafka.log.Log)[2020-04-29 18:21:29,892] INFO [Log partition=__consumer_offsets-4, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,892] INFO [Log partition=__consumer_offsets-4, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,895] INFO [Log partition=__consumer_offsets-3, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,895] INFO [Log partition=__consumer_offsets-3, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,898] INFO [Log partition=__consumer_offsets-33, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,898] INFO [Log partition=__consumer_offsets-33, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,901] INFO [Log partition=__consumer_offsets-34, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,901] INFO [Log partition=__consumer_offsets-34, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,903] INFO [Log partition=__consumer_offsets-2, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,904] INFO [Log partition=__consumer_offsets-2, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,906] INFO [Log partition=__consumer_offsets-5, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,906] INFO [Log partition=__consumer_offsets-5, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,909] INFO [Log partition=jerome-1, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,909] INFO [Log partition=jerome-1, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,911] INFO [Log partition=__consumer_offsets-45, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,911] INFO [Log partition=__consumer_offsets-45, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,914] INFO [Log partition=__consumer_offsets-42, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,914] INFO [Log partition=__consumer_offsets-42, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,916] INFO [Log partition=__consumer_offsets-29, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,917] INFO [Log partition=__consumer_offsets-29, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,919] INFO [Log partition=__consumer_offsets-16, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,919] INFO [Log partition=__consumer_offsets-16, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,923] INFO [Log partition=topic-demo-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 20 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,923] INFO [ProducerStateManager partition=topic-demo-0] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/topic-demo-0/00000000000000000020.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:29,923] INFO [Log partition=topic-demo-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 20 in 3 ms (kafka.log.Log)[2020-04-29 18:21:29,926] INFO [Log partition=__consumer_offsets-11, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,926] INFO [Log partition=__consumer_offsets-11, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,928] INFO [Log partition=__consumer_offsets-18, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,928] INFO [Log partition=__consumer_offsets-18, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,931] INFO [Log partition=__consumer_offsets-27, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 3 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,932] INFO [ProducerStateManager partition=__consumer_offsets-27] Loading producer state from snapshot file '/usr/local/etc/kafka/tmp/kafka-logs/__consumer_offsets-27/00000000000000000003.snapshot' (kafka.log.ProducerStateManager)[2020-04-29 18:21:29,932] INFO [Log partition=__consumer_offsets-27, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 3 in 3 ms (kafka.log.Log)[2020-04-29 18:21:29,934] INFO [Log partition=__consumer_offsets-20, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,934] INFO [Log partition=__consumer_offsets-20, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,937] INFO [Log partition=__consumer_offsets-43, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,937] INFO [Log partition=__consumer_offsets-43, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,939] INFO [Log partition=__consumer_offsets-44, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,939] INFO [Log partition=__consumer_offsets-44, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,941] INFO [Log partition=jerome-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,942] INFO [Log partition=jerome-0, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,944] INFO [Log partition=__consumer_offsets-21, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,944] INFO [Log partition=__consumer_offsets-21, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 2 ms (kafka.log.Log)[2020-04-29 18:21:29,946] INFO [Log partition=__consumer_offsets-19, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,946] INFO [Log partition=__consumer_offsets-19, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,948] INFO [Log partition=__consumer_offsets-26, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,948] INFO [Log partition=__consumer_offsets-26, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,950] INFO [Log partition=__consumer_offsets-10, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,950] INFO [Log partition=__consumer_offsets-10, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,952] INFO [Log partition=__consumer_offsets-28, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,952] INFO [Log partition=__consumer_offsets-28, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,954] INFO [Log partition=__consumer_offsets-17, dir=/usr/local/etc/kafka/tmp/kafka-logs] Loading producer state till offset 0 with message format version 2 (kafka.log.Log)[2020-04-29 18:21:29,954] INFO [Log partition=__consumer_offsets-17, dir=/usr/local/etc/kafka/tmp/kafka-logs] Completed load of log with 1 segments, log start offset 0 and log end offset 0 in 1 ms (kafka.log.Log)[2020-04-29 18:21:29,956] INFO Logs loading complete in 270 ms. (kafka.log.LogManager)[2020-04-29 18:21:29,964] INFO Starting log cleanup with a period of 300000 ms. (kafka.log.LogManager)[2020-04-29 18:21:29,965] INFO Starting log flusher with a default period of 9223372036854775807 ms. (kafka.log.LogManager)[2020-04-29 18:21:30,221] INFO Awaiting socket connections on 0.0.0.0:9092. (kafka.network.Acceptor)[2020-04-29 18:21:30,243] INFO [SocketServer brokerId=0] Created data-plane acceptor and processors for endpoint : EndPoint(null,9092,ListenerName(PLAINTEXT),PLAINTEXT) (kafka.network.SocketServer)[2020-04-29 18:21:30,244] INFO [SocketServer brokerId=0] Started 1 acceptor threads for data-plane (kafka.network.SocketServer)[2020-04-29 18:21:30,259] INFO [ExpirationReaper-0-Produce]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:30,260] INFO [ExpirationReaper-0-Fetch]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:30,260] INFO [ExpirationReaper-0-DeleteRecords]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:30,260] INFO [ExpirationReaper-0-ElectLeader]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:30,270] INFO [LogDirFailureHandler]: Starting (kafka.server.ReplicaManager$LogDirFailureHandler)[2020-04-29 18:21:30,310] INFO Creating /brokers/ids/0 (is it secure? false) (kafka.zk.KafkaZkClient)[2020-04-29 18:21:30,320] INFO Stat of the created znode at /brokers/ids/0 is: 12126,12126,1588155690317,1588155690317,1,0,0,72057616369582881,188,0,12126 (kafka.zk.KafkaZkClient)[2020-04-29 18:21:30,321] INFO Registered broker 0 at path /brokers/ids/0 with addresses: ArrayBuffer(EndPoint(localhost,9092,ListenerName(PLAINTEXT),PLAINTEXT)), czxid (broker epoch): 12126 (kafka.zk.KafkaZkClient)[2020-04-29 18:21:30,366] INFO [ExpirationReaper-0-topic]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:30,368] INFO [ExpirationReaper-0-Heartbeat]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:30,369] INFO [ExpirationReaper-0-Rebalance]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:30,402] INFO [GroupCoordinator 0]: Starting up. (kafka.coordinator.group.GroupCoordinator)[2020-04-29 18:21:30,402] INFO [GroupCoordinator 0]: Startup complete. (kafka.coordinator.group.GroupCoordinator)[2020-04-29 18:21:30,407] INFO [GroupMetadataManager brokerId=0] Removed 0 expired offsets in 5 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,416] INFO [ProducerId Manager 0]: Acquired new producerId block (brokerId:0,blockStartProducerId:6000,blockEndProducerId:6999) by writing to Zk with path version 7 (kafka.coordinator.transaction.ProducerIdManager)[2020-04-29 18:21:30,434] INFO [TransactionCoordinator id=0] Starting up. (kafka.coordinator.transaction.TransactionCoordinator)[2020-04-29 18:21:30,441] INFO [Transaction Marker Channel Manager 0]: Starting (kafka.coordinator.transaction.TransactionMarkerChannelManager)[2020-04-29 18:21:30,442] INFO [TransactionCoordinator id=0] Startup complete. (kafka.coordinator.transaction.TransactionCoordinator)[2020-04-29 18:21:30,462] INFO [ExpirationReaper-0-AlterAcls]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2020-04-29 18:21:30,489] INFO [/config/changes-event-process-thread]: Starting (kafka.common.ZkNodeChangeNotificationListener$ChangeEventProcessThread)[2020-04-29 18:21:30,508] INFO [SocketServer brokerId=0] Started data-plane processors for 1 acceptors (kafka.network.SocketServer)[2020-04-29 18:21:30,512] INFO Kafka version: 2.4.0 (org.apache.kafka.common.utils.AppInfoParser)[2020-04-29 18:21:30,512] INFO Kafka commitId: 77a89fcf8d7fa018 (org.apache.kafka.common.utils.AppInfoParser)[2020-04-29 18:21:30,512] INFO Kafka startTimeMs: 1588155690509 (org.apache.kafka.common.utils.AppInfoParser)[2020-04-29 18:21:30,513] INFO [KafkaServer id=0] started (kafka.server.KafkaServer)[2020-04-29 18:21:30,585] INFO [ReplicaFetcherManager on broker 0] Removed fetcher for partitions Set(__consumer_offsets-22, __consumer_offsets-30, __consumer_offsets-8, __consumer_offsets-21, __consumer_offsets-4, __consumer_offsets-27, __consumer_offsets-7, __consumer_offsets-9, __consumer_offsets-46, __consumer_offsets-25, __consumer_offsets-35, __consumer_offsets-41, __consumer_offsets-33, __consumer_offsets-23, __consumer_offsets-49, __consumer_offsets-47, __consumer_offsets-16, test-0, __consumer_offsets-28, __consumer_offsets-31, __consumer_offsets-36, __consumer_offsets-42, __consumer_offsets-3, __consumer_offsets-18, __consumer_offsets-37, __consumer_offsets-15, __consumer_offsets-24, __consumer_offsets-38, __consumer_offsets-17, jerome-1, __consumer_offsets-48, __consumer_offsets-19, jerome-0, __consumer_offsets-11, __consumer_offsets-13, __consumer_offsets-2, __consumer_offsets-43, __consumer_offsets-6, __consumer_offsets-14, __consumer_offsets-20, __consumer_offsets-0, __consumer_offsets-44, __consumer_offsets-39, __consumer_offsets-12, topic-demo-0, __consumer_offsets-45, __consumer_offsets-1, __consumer_offsets-5, __consumer_offsets-26, __consumer_offsets-29, __consumer_offsets-34, __consumer_offsets-10, __consumer_offsets-32, __consumer_offsets-40) (kafka.server.ReplicaFetcherManager)[2020-04-29 18:21:30,607] INFO [Partition __consumer_offsets-0 broker=0] Log loaded for partition __consumer_offsets-0 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,608] INFO [Partition __consumer_offsets-0 broker=0] __consumer_offsets-0 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,617] INFO [Partition __consumer_offsets-29 broker=0] Log loaded for partition __consumer_offsets-29 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,617] INFO [Partition __consumer_offsets-29 broker=0] __consumer_offsets-29 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,619] INFO [Partition __consumer_offsets-48 broker=0] Log loaded for partition __consumer_offsets-48 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,619] INFO [Partition __consumer_offsets-48 broker=0] __consumer_offsets-48 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,621] INFO [Partition __consumer_offsets-10 broker=0] Log loaded for partition __consumer_offsets-10 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,621] INFO [Partition __consumer_offsets-10 broker=0] __consumer_offsets-10 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,623] INFO [Partition __consumer_offsets-45 broker=0] Log loaded for partition __consumer_offsets-45 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,623] INFO [Partition __consumer_offsets-45 broker=0] __consumer_offsets-45 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,625] INFO [Partition __consumer_offsets-26 broker=0] Log loaded for partition __consumer_offsets-26 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,625] INFO [Partition __consumer_offsets-26 broker=0] __consumer_offsets-26 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,626] INFO [Partition __consumer_offsets-7 broker=0] Log loaded for partition __consumer_offsets-7 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,627] INFO [Partition __consumer_offsets-7 broker=0] __consumer_offsets-7 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,628] INFO [Partition __consumer_offsets-42 broker=0] Log loaded for partition __consumer_offsets-42 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,628] INFO [Partition __consumer_offsets-42 broker=0] __consumer_offsets-42 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,630] INFO [Partition __consumer_offsets-4 broker=0] Log loaded for partition __consumer_offsets-4 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,630] INFO [Partition __consumer_offsets-4 broker=0] __consumer_offsets-4 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,632] INFO [Partition __consumer_offsets-23 broker=0] Log loaded for partition __consumer_offsets-23 with initial high watermark 3 (kafka.cluster.Partition)[2020-04-29 18:21:30,632] INFO [Partition __consumer_offsets-23 broker=0] __consumer_offsets-23 starts at Leader Epoch 0 from offset 3. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,633] INFO [Partition __consumer_offsets-1 broker=0] Log loaded for partition __consumer_offsets-1 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,633] INFO [Partition __consumer_offsets-1 broker=0] __consumer_offsets-1 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,634] INFO [Partition __consumer_offsets-20 broker=0] Log loaded for partition __consumer_offsets-20 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,634] INFO [Partition __consumer_offsets-20 broker=0] __consumer_offsets-20 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,636] INFO [Partition __consumer_offsets-39 broker=0] Log loaded for partition __consumer_offsets-39 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,636] INFO [Partition __consumer_offsets-39 broker=0] __consumer_offsets-39 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,638] INFO [Partition __consumer_offsets-17 broker=0] Log loaded for partition __consumer_offsets-17 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,638] INFO [Partition __consumer_offsets-17 broker=0] __consumer_offsets-17 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,640] INFO [Partition __consumer_offsets-36 broker=0] Log loaded for partition __consumer_offsets-36 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,640] INFO [Partition __consumer_offsets-36 broker=0] __consumer_offsets-36 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,641] INFO [Partition __consumer_offsets-14 broker=0] Log loaded for partition __consumer_offsets-14 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,642] INFO [Partition __consumer_offsets-14 broker=0] __consumer_offsets-14 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,643] INFO [Partition __consumer_offsets-33 broker=0] Log loaded for partition __consumer_offsets-33 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,643] INFO [Partition __consumer_offsets-33 broker=0] __consumer_offsets-33 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,645] INFO [Partition __consumer_offsets-49 broker=0] Log loaded for partition __consumer_offsets-49 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,645] INFO [Partition __consumer_offsets-49 broker=0] __consumer_offsets-49 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,647] INFO [Partition __consumer_offsets-11 broker=0] Log loaded for partition __consumer_offsets-11 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,647] INFO [Partition __consumer_offsets-11 broker=0] __consumer_offsets-11 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,649] INFO [Partition __consumer_offsets-30 broker=0] Log loaded for partition __consumer_offsets-30 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,649] INFO [Partition __consumer_offsets-30 broker=0] __consumer_offsets-30 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,650] INFO [Partition test-0 broker=0] Log loaded for partition test-0 with initial high watermark 13 (kafka.cluster.Partition)[2020-04-29 18:21:30,650] INFO [Partition test-0 broker=0] test-0 starts at Leader Epoch 0 from offset 13. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,651] INFO [Partition __consumer_offsets-46 broker=0] Log loaded for partition __consumer_offsets-46 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,651] INFO [Partition __consumer_offsets-46 broker=0] __consumer_offsets-46 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,653] INFO [Partition __consumer_offsets-27 broker=0] Log loaded for partition __consumer_offsets-27 with initial high watermark 3 (kafka.cluster.Partition)[2020-04-29 18:21:30,653] INFO [Partition __consumer_offsets-27 broker=0] __consumer_offsets-27 starts at Leader Epoch 0 from offset 3. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,654] INFO [Partition __consumer_offsets-8 broker=0] Log loaded for partition __consumer_offsets-8 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,654] INFO [Partition __consumer_offsets-8 broker=0] __consumer_offsets-8 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,656] INFO [Partition __consumer_offsets-24 broker=0] Log loaded for partition __consumer_offsets-24 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,656] INFO [Partition __consumer_offsets-24 broker=0] __consumer_offsets-24 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,658] INFO [Partition __consumer_offsets-43 broker=0] Log loaded for partition __consumer_offsets-43 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,658] INFO [Partition __consumer_offsets-43 broker=0] __consumer_offsets-43 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,659] INFO [Partition __consumer_offsets-5 broker=0] Log loaded for partition __consumer_offsets-5 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,659] INFO [Partition __consumer_offsets-5 broker=0] __consumer_offsets-5 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,661] INFO [Partition jerome-0 broker=0] Log loaded for partition jerome-0 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,661] INFO [Partition jerome-0 broker=0] jerome-0 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,662] INFO [Partition __consumer_offsets-21 broker=0] Log loaded for partition __consumer_offsets-21 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,662] INFO [Partition __consumer_offsets-21 broker=0] __consumer_offsets-21 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,664] INFO [Partition __consumer_offsets-40 broker=0] Log loaded for partition __consumer_offsets-40 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,664] INFO [Partition __consumer_offsets-40 broker=0] __consumer_offsets-40 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,666] INFO [Partition __consumer_offsets-2 broker=0] Log loaded for partition __consumer_offsets-2 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,666] INFO [Partition __consumer_offsets-2 broker=0] __consumer_offsets-2 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,667] INFO [Partition __consumer_offsets-37 broker=0] Log loaded for partition __consumer_offsets-37 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,667] INFO [Partition __consumer_offsets-37 broker=0] __consumer_offsets-37 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,669] INFO [Partition __consumer_offsets-18 broker=0] Log loaded for partition __consumer_offsets-18 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,669] INFO [Partition __consumer_offsets-18 broker=0] __consumer_offsets-18 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,670] INFO [Partition __consumer_offsets-34 broker=0] Log loaded for partition __consumer_offsets-34 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,670] INFO [Partition __consumer_offsets-34 broker=0] __consumer_offsets-34 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,672] INFO [Partition __consumer_offsets-15 broker=0] Log loaded for partition __consumer_offsets-15 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,672] INFO [Partition __consumer_offsets-15 broker=0] __consumer_offsets-15 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,674] INFO [Partition topic-demo-0 broker=0] Log loaded for partition topic-demo-0 with initial high watermark 20 (kafka.cluster.Partition)[2020-04-29 18:21:30,674] INFO [Partition topic-demo-0 broker=0] topic-demo-0 starts at Leader Epoch 0 from offset 20. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,675] INFO [Partition __consumer_offsets-12 broker=0] Log loaded for partition __consumer_offsets-12 with initial high watermark 430 (kafka.cluster.Partition)[2020-04-29 18:21:30,675] INFO [Partition __consumer_offsets-12 broker=0] __consumer_offsets-12 starts at Leader Epoch 0 from offset 430. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,676] INFO [Partition __consumer_offsets-31 broker=0] Log loaded for partition __consumer_offsets-31 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,676] INFO [Partition __consumer_offsets-31 broker=0] __consumer_offsets-31 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,677] INFO [Partition jerome-1 broker=0] Log loaded for partition jerome-1 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,677] INFO [Partition jerome-1 broker=0] jerome-1 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,679] INFO [Partition __consumer_offsets-9 broker=0] Log loaded for partition __consumer_offsets-9 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,679] INFO [Partition __consumer_offsets-9 broker=0] __consumer_offsets-9 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,680] INFO [Partition __consumer_offsets-47 broker=0] Log loaded for partition __consumer_offsets-47 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,680] INFO [Partition __consumer_offsets-47 broker=0] __consumer_offsets-47 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,682] INFO [Partition __consumer_offsets-19 broker=0] Log loaded for partition __consumer_offsets-19 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,682] INFO [Partition __consumer_offsets-19 broker=0] __consumer_offsets-19 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,683] INFO [Partition __consumer_offsets-28 broker=0] Log loaded for partition __consumer_offsets-28 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,683] INFO [Partition __consumer_offsets-28 broker=0] __consumer_offsets-28 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,684] INFO [Partition __consumer_offsets-38 broker=0] Log loaded for partition __consumer_offsets-38 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,685] INFO [Partition __consumer_offsets-38 broker=0] __consumer_offsets-38 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,686] INFO [Partition __consumer_offsets-35 broker=0] Log loaded for partition __consumer_offsets-35 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,686] INFO [Partition __consumer_offsets-35 broker=0] __consumer_offsets-35 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,687] INFO [Partition __consumer_offsets-6 broker=0] Log loaded for partition __consumer_offsets-6 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,688] INFO [Partition __consumer_offsets-6 broker=0] __consumer_offsets-6 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,689] INFO [Partition __consumer_offsets-44 broker=0] Log loaded for partition __consumer_offsets-44 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,689] INFO [Partition __consumer_offsets-44 broker=0] __consumer_offsets-44 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,690] INFO [Partition __consumer_offsets-25 broker=0] Log loaded for partition __consumer_offsets-25 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,690] INFO [Partition __consumer_offsets-25 broker=0] __consumer_offsets-25 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,692] INFO [Partition __consumer_offsets-16 broker=0] Log loaded for partition __consumer_offsets-16 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,692] INFO [Partition __consumer_offsets-16 broker=0] __consumer_offsets-16 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,693] INFO [Partition __consumer_offsets-22 broker=0] Log loaded for partition __consumer_offsets-22 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,693] INFO [Partition __consumer_offsets-22 broker=0] __consumer_offsets-22 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,694] INFO [Partition __consumer_offsets-41 broker=0] Log loaded for partition __consumer_offsets-41 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,694] INFO [Partition __consumer_offsets-41 broker=0] __consumer_offsets-41 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,696] INFO [Partition __consumer_offsets-32 broker=0] Log loaded for partition __consumer_offsets-32 with initial high watermark 3 (kafka.cluster.Partition)[2020-04-29 18:21:30,696] INFO [Partition __consumer_offsets-32 broker=0] __consumer_offsets-32 starts at Leader Epoch 0 from offset 3. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,697] INFO [Partition __consumer_offsets-3 broker=0] Log loaded for partition __consumer_offsets-3 with initial high watermark 0 (kafka.cluster.Partition)[2020-04-29 18:21:30,697] INFO [Partition __consumer_offsets-3 broker=0] __consumer_offsets-3 starts at Leader Epoch 0 from offset 0. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,698] INFO [Partition __consumer_offsets-13 broker=0] Log loaded for partition __consumer_offsets-13 with initial high watermark 3 (kafka.cluster.Partition)[2020-04-29 18:21:30,698] INFO [Partition __consumer_offsets-13 broker=0] __consumer_offsets-13 starts at Leader Epoch 0 from offset 3. Previous Leader Epoch was: -1 (kafka.cluster.Partition)[2020-04-29 18:21:30,705] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-22 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,705] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-25 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,705] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-28 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,705] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-31 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,705] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-34 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,705] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-37 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,705] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-40 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,705] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-43 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,705] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-46 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,705] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-49 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,705] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-41 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-44 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-47 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-1 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-4 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-7 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-10 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-13 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-16 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-19 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-2 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-5 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-8 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-11 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-14 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-17 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-20 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-23 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-26 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-29 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-32 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-35 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-38 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-0 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-3 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-6 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-9 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,706] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-12 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,707] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-15 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,707] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-18 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,707] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-21 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,707] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-24 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,707] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-27 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,707] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-30 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,707] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-33 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,707] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-36 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,707] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-39 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,707] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-42 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,707] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-45 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,707] INFO [GroupMetadataManager brokerId=0] Scheduling loading of offsets and group metadata from __consumer_offsets-48 (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,709] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-22 in 4 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,710] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-25 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,710] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-28 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,711] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-31 in 1 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,711] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-34 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,711] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-37 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,711] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-40 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,711] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-43 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,712] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-46 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,712] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-49 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,712] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-41 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,712] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-44 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,713] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-47 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,713] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-1 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,713] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-4 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,714] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-7 in 1 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,714] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-10 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,734] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-13 in 20 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,735] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-16 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,735] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-19 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,735] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-2 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,735] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-5 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,736] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-8 in 1 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,736] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-11 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,736] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-14 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,736] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-17 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,736] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-20 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,739] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-23 in 2 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,740] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-26 in 1 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,740] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-29 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,742] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-32 in 2 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,743] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-35 in 1 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,743] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-38 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,743] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-0 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,743] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-3 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,743] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-6 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,743] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-9 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,763] INFO [GroupCoordinator 0]: Loading group metadata for group.demo with generation 18 (kafka.coordinator.group.GroupCoordinator)[2020-04-29 18:21:30,763] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-12 in 20 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,763] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-15 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,763] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-18 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,763] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-21 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,764] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-24 in 1 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,766] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-27 in 2 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,766] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-30 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,767] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-33 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,767] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-36 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,767] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-39 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,767] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-42 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,767] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-45 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:21:30,767] INFO [GroupMetadataManager brokerId=0] Finished loading offsets and group metadata from __consumer_offsets-48 in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)[2020-04-29 18:25:57,932] INFO [GroupCoordinator 0]: Preparing to rebalance group group.demo in state PreparingRebalance with old generation 18 (__consumer_offsets-12) (reason: Adding new member consumer-group.demo-1-6e7f0048-7df1-4574-8f74-31c7e1680f88 with group instanceid None) (kafka.coordinator.group.GroupCoordinator)[2020-04-29 18:25:57,937] INFO [GroupCoordinator 0]: Stabilized group group.demo generation 19 (__consumer_offsets-12) (kafka.coordinator.group.GroupCoordinator)[2020-04-29 18:25:57,945] INFO [GroupCoordinator 0]: Assignment received from leader for group group.demo for generation 19 (kafka.coordinator.group.GroupCoordinator)[2020-04-29 18:26:23,049] INFO [GroupCoordinator 0]: Member consumer-group.demo-1-6e7f0048-7df1-4574-8f74-31c7e1680f88 in group group.demo has failed, removing it from the group (kafka.coordinator.group.GroupCoordinator)[2020-04-29 18:26:23,050] INFO [GroupCoordinator 0]: Preparing to rebalance group group.demo in state PreparingRebalance with old generation 19 (__consumer_offsets-12) (reason: removing member consumer-group.demo-1-6e7f0048-7df1-4574-8f74-31c7e1680f88 on heartbeat expiration) (kafka.coordinator.group.GroupCoordinator)[2020-04-29 18:26:23,051] INFO [GroupCoordinator 0]: Group group.demo with generation 20 is now empty (__consumer_offsets-12) (kafka.coordinator.group.GroupCoordinator) æœ€ç»ˆï¼Œæˆ‘åœ¨ https://www.orchome.com/32 æ‰¾åˆ°ä¸€ä¸ªçœ‹ä¸Šå»å¾ˆä¸é”™çš„ç­”æ¡ˆï¼Œä½†æ˜¯å¾ˆé—æ†¾ï¼Œä¾æ—§å¤±è´¥äº†ï¼Œæˆ‘å¼ºåˆ¶ kill ä¹Ÿæ²¡ç”¨ï¼Œä¾ç„¶ä¼šè‡ªåŠ¨é‡æ–°åˆ›å»ºä¸€ä¸ª kafka æœåŠ¡â€¦ è‡³äºæ–‡ç« ä¸­æåˆ°çš„ controlled.shutdown.enableï¼Œå¼€å¯(true)åï¼Œæ‰§è¡Œshutdownæ—¶ï¼Œbrokerä¸»åŠ¨å°†è‡ªå·±æœ‰leaderèº«ä»½çš„partitionè½¬ç§»ç»™ISRé‡Œçš„å…¶ä»–brokerï¼Œä½†æ˜¯å¦‚æœæ˜¯é»˜è®¤å€¼falseï¼Œå¯¹å…³é—­ä¾ç„¶ä¸ä¼šæœ‰å½±å“ï¼ŒæŒ‰ç…§é»˜è®¤çš„è§„åˆ™åˆ‡æ¢åªæ˜¯ä¼šæ…¢ä¸€ç‚¹ç‚¹è€Œå·²â€¦ æ‰€ä»¥ï¼Œå¾ˆé—æ†¾ï¼Œæ²¡æœ‰è§£å†³â€¦ Kafka åœ¨ java ä¸­ä½¿ç”¨å®ç°maven ä¾èµ–123456789101112131415161718192021&lt;dependency&gt; &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt; &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt; &lt;version&gt;2.4.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt; &lt;version&gt;1.7.28&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;1.2.17&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-nop&lt;/artifactId&gt; &lt;version&gt;1.7.2&lt;/version&gt; &lt;/dependency&gt; ç”Ÿäº§è€…å®¢æˆ·ç«¯123456789101112131415161718192021222324252627282930package Kafka.Demo1;import org.apache.kafka.clients.producer.KafkaProducer;import org.apache.kafka.clients.producer.ProducerRecord;import java.util.Properties;public class ProducerFastStart &#123; public static final String brokerList = "localhost:9092"; public static final String topic = "topic-demo"; public static void main(String[] args) &#123; Properties properties = new Properties(); properties.put("key.serializer","org.apache.kafka.common.serialization.StringSerializer"); properties.put("value.serializer","org.apache.kafka.common.serialization.StringSerializer"); properties.put("bootstrap.servers",brokerList); KafkaProducer&lt;String,String&gt; producer = new KafkaProducer&lt;String, String&gt;(properties); // æ„é€ è¦å‘é€çš„æ¶ˆæ¯ ProducerRecord&lt;String, String&gt; record = new ProducerRecord&lt;&gt;(topic,"hello,I am jerome_memory"); // å‘é€æ¶ˆæ¯ try&#123; producer.send(record); &#125; catch (Exception e)&#123; e.printStackTrace(); &#125; producer.close(); &#125;&#125; æ¶ˆè´¹è€…å®¢æˆ·ç«¯123456789101112131415161718192021222324252627282930313233343536package Kafka.Demo1;import org.apache.kafka.clients.consumer.ConsumerRecord;import org.apache.kafka.clients.consumer.ConsumerRecords;import org.apache.kafka.clients.consumer.KafkaConsumer;import org.apache.kafka.common.protocol.types.Field;import java.time.Duration;import java.util.Collections;import java.util.Properties;public class ConsumerFastStart &#123; public static final String brokerList = "localhost:9092"; public static final String topic = "topic-demo"; public static final String groupId = "group.demo"; public static void main(String[] args) &#123; Properties properties = new Properties(); properties.put("key.deserializer","org.apache.kafka.common.serialization.StringDeserializer"); properties.put("value.deserializer","org.apache.kafka.common.serialization.StringDeserializer"); properties.put("bootstrap.servers",brokerList); properties.put("group.id",groupId); KafkaConsumer&lt;String,String&gt; consumer = new KafkaConsumer&lt;String, String&gt;(properties); // è®¢é˜…ä¸»é¢˜ consumer.subscribe(Collections.singletonList(topic)); // å¾ªç¯è¯»å–æ¶ˆæ¯ while (true)&#123; ConsumerRecords&lt;String,String&gt; records = consumer.poll(Duration.ZERO); for(ConsumerRecord&lt;String,String&gt; records1 : records)&#123; System.out.println(records1.value()); &#125; &#125; &#125;&#125; é‡åˆ°çš„é—®é¢˜åœ¨å¯åŠ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…åï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼šã€Œä½†æ˜¯ç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œâ€¦ã€ 123SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder".SLF4J: Defaulting to no-operation (NOP) logger implementationSLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details. è§£å†³æ–¹æ¡ˆï¼š é‡‡ç”¨ å…¶æç¤ºçš„ url ä¸­çš„è§£å†³æ–¹æ¡ˆè¿›è¡Œè§£å†³ï¼Œå¤±è´¥ã€‚ã€‚ã€‚è¿˜æ˜¯ä¼šæœ‰ä¸Šé¢çš„é”™è¯¯â€¦ 12345678910111213141516171819&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt; org.apache.cassandra&lt;/groupId&gt; &lt;artifactId&gt;cassandra-all&lt;/artifactId&gt; &lt;version&gt;0.8.1&lt;/version&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;exclusion&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt;&lt;/dependencies&gt; å‚è€ƒï¼šhttps://www.cnblogs.com/felixzh/p/12487644.html ç›´æ¥ä¸Šslf4jå®˜ç½‘æ‰¾åˆ°ç›¸åº”çš„mavenåŒ…æ·»åŠ åˆ°pom.xml ç½‘å€ï¼šhttps://mvnrepository.com/artifact/org.slf4j/slf4j-log4j12/1.8.0-alpha2 å¥½å§â€¦ ä¾æ—§ä¸å¥½ä½¿ æœ€ç»ˆå¾—ä»¥è§£å†³ï¼Œä»¥ä¸‹æ˜¯æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼š å‚è€ƒï¼šhttps://www.shuzhiduo.com/A/pRdBO486zn/ åœ¨æ·»åŠ äº†ä»¥ä¸‹ä¾èµ–,è¿˜æ˜¯ä¼šæŠ¥é”™â€¦ã€Œè¿™é‡Œçš„ç‰ˆæœ¬æˆ‘æ˜¯é€šè¿‡æŸ¥è¯¢ cd /usr/local/Cellar/kafka/2.4.0/libexec/lib/ å¾—åˆ°çš„ slf4j å’Œ log4j çš„ç‰ˆæœ¬ã€ 123456789101112&gt; &lt;dependency&gt;&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt;&gt; &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;&gt; &lt;version&gt;1.7.28&lt;/version&gt;&gt; &lt;scope&gt;test&lt;/scope&gt;&gt; &lt;/dependency&gt;&gt; &lt;dependency&gt;&gt; &lt;groupId&gt;log4j&lt;/groupId&gt;&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt;&gt; &lt;version&gt;1.2.17&lt;/version&gt;&gt; &lt;/dependency&gt;&gt; ä¹‹åï¼Œçœ‹åˆ°äº†ä¸Šé¢çš„å‚è€ƒæ–‡ç« ï¼Œå†æ¬¡æ·»åŠ  123456&gt; &lt;dependency&gt;&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt;&gt; &lt;artifactId&gt;slf4j-nop&lt;/artifactId&gt;&gt; &lt;version&gt;1.7.2&lt;/version&gt;&gt; &lt;/dependency&gt;&gt; å¾—ä»¥è§£å†³è¯¥é—®é¢˜â€¦]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
        <category>kafka ç³»åˆ—</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å®ä¹ åæ§½]]></title>
    <url>%2F2020%2F04%2F15%2F%E5%AE%9E%E4%B9%A0%E5%90%90%E6%A7%BD%E5%B8%96.html</url>
    <content type="text"><![CDATA[å¥½å­ï¼Œè‡ªä» 2 å·é¢å®Œé˜¿é‡Œå››é¢ä¹‹åï¼ŒåŸºæœ¬ä¸Šå°±æ²¡è®¤çœŸçœ‹è¿‡ä¹¦è¾½ï¼Œè¿™åå¤šå¤©åªé¢äº†ä¸‹è…¾è®¯çš„ hr é¢å’Œé˜¿é‡Œçš„ hr é¢ï¼Œå·®ä¸å¤šå’¸é±¼äº† 10 å¤©è¾½ï¼Œç°åœ¨è…¾è®¯å’Œé˜¿é‡Œçš„ offer éƒ½åˆ°æ‰‹è¾½ï¼Œéœ€è¦é‡æ–°å¼€å§‹ä¸‹ä¸€è½®çš„å­¦ä¹ äº†ï¼Œä¸èƒ½å†å’¸é±¼å•¦ï¼ï¼ï¼åŠ æ²¹åŠ æ²¹ï¼ï¼ï¼]]></content>
      <categories>
        <category>åæ§½</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä»åŒäº²å§”æ´¾æ¨¡å‹åˆ° jdbc]]></title>
    <url>%2F2020%2F03%2F19%2F%E4%BB%8E%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B%E5%88%B0%20jdbc.html</url>
    <content type="text"><![CDATA[å¼•å­åŒäº²å§”æ´¾æ¨¡å‹ï¼Œjdbcï¼Œè²Œä¼¼æ²¡å•¥å…³ç³»ï¼Œä¹‹é—´çš„è”ç³»è¿˜å¾—ä»å‘¨å¿—åè€å¸ˆçš„ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹è¿™æœ¬ä¹¦è¯´èµ·ã€‚ ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œjdbc è¿™ç§æ¶‰åŠ SPI çš„ç±»åŠ è½½æ–¹å¼ç ´åäº†åŒäº²å§”æ´¾æ¨¡å‹ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å…·ä½“åˆ†æä¸€æ³¢ã€‚ å›é¡¾ â€” åŒäº²å§”æ´¾æ¨¡å‹ç±»åŠ è½½å™¨è°ˆåˆ°åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå¿…ç„¶æ˜¯è¦è°ˆåˆ°ç±»åŠ è½½å™¨å•¦ï¼Œè€Œç±»åŠ è½½å™¨è¦åšçš„äº‹æƒ…ï¼Œå°±æ˜¯å®Œæˆç±»åŠ è½½ä¸­çš„ç¬¬ä¸€ä¸ªåŠ¨ä½œï¼Œé¡ºå¸¦å›é¡¾ä¸€ä¸‹ç±»åŠ è½½çš„ä¸‰ä¸ªåŠ¨ä½œï¼š é€šè¿‡ç±»çš„å…¨é™å®šåã€Œä¸€èˆ¬æ˜¯ .class æ–‡ä»¶çš„å½¢å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„ï¼Œæ²¡æœ‰é™å®šã€äº§ç”Ÿä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ®æµï¼› å°†è¯¥äºŒè¿›åˆ¶æ•°æ®æµè§£æä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼› åœ¨ Java å †ä¸­åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºè¯¥ç±»å‹çš„java.lang.Classç±»çš„å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚ è®²å®Œç±»åŠ è½½å™¨çš„å·¥ä½œï¼Œå†æ¥å›é¡¾ä¸€ä¸‹ç±»åŠ è½½å™¨çš„åˆ†ç±»ï¼Œç±»åŠ è½½å™¨çš„åˆ†ç±»å¯ä»¥ä»ä¸¤ä¸ªè§’åº¦çœ‹ï¼Œ å¦‚æœæ˜¯ jvm è§’åº¦çœ‹ï¼Œé‚£å°±åªéœ€è¦åˆ†ä¸º å¯åŠ¨ç±»åŠ è½½å™¨ ã€Œnative è¯­è¨€å†™çš„ã€å’Œ å…¶ä»–ç±»åŠ è½½å™¨ã€Œjava å†™çš„ã€ï¼› å¦‚æœä»ç¨‹åºå‘˜è§’åº¦çœ‹ï¼Œé‚£å°±åˆ†ä¸ºå››ç±»ï¼Œä¸€ç±»æ˜¯ å¯åŠ¨ç±»åŠ è½½å™¨ã€ŒBootstrap ClassLoaderã€ï¼Œä¸€ç±»æ˜¯ æ‰©å±•ç±»åŠ è½½å™¨ã€ŒExtension ClassLoaderã€ï¼Œä¸€ç±»æ˜¯ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€ŒApplication ClassLoaderï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬å¼€å‘ç¨‹åºçš„é»˜è®¤ä½¿ç”¨è¿‡çš„ç±»åŠ è½½å™¨ã€ï¼Œæœ€åä¸€ç±»æ˜¯ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€Œè‡ªå·±å®ç°çš„ç±»åŠ è½½å™¨ï¼Œå…¶å®åªè¦å»ç»§æ‰¿CLassLoader ä¸‹çš„ findCLass() æ–¹æ³•å°±è¡Œäº†ï¼Œè¿™æ ·æ˜¯ç¬¦åˆåŒäº²å§”æ´¾æ¨¡å‹çš„ã€ã€‚ åŒäº²å§”æ´¾æ¨¡å‹æ¥ä¸‹æ¥æˆ‘ä»¬ä»ç¨‹åºå‘˜è§’åº¦çš„åˆ†ç±»æ¥çœ‹åŒäº²å§”æ´¾æ¨¡å‹ã€‚ æ¦‚å¿µ ã€Œä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ã€é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä»¥å¤–ï¼Œæ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½åº”è¯¥æœ‰çˆ¶ç±»åŠ è½½å™¨ï¼Œè¿™é‡Œçš„çˆ¶å­å…³ç³»ä¸æ˜¯é€šè¿‡ç»§æ‰¿æ¥çš„ï¼Œè€Œæ˜¯é€šè¿‡ç»„åˆå…³ç³»ã€‚ã€Œè¦ç‰¹åˆ«æ³¨æ„å“¦ï¼Œæ˜¯ç»„åˆå…³ç³»ï¼Œæ˜¯ has-a å…³ç³»ï¼Œè¿™ä¸ªåœ°æ–¹è·Ÿåé¢ä¸ºä½• jdbc è¦è¿ååŒäº²å§”æ´¾æ¨¡å‹æœ‰ä¸å¯åˆ†å‰²çš„å…³ç³»å“ˆã€ æ¨¡å‹æ€ä¹ˆç”¨ã€ŒåŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œæµç¨‹ã€å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå…ˆæŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼ˆæ‰€ä»¥æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼‰ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚(å®ƒçš„æœç´¢èŒƒå›´æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€è¦çš„ç±»)æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚ å…·ä½“æˆ‘ä»¬åœ¨æºä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ ·çœ‹çš„æ›´æ¸…æ¥šä¸€ç‚¹ï¼Œåœ¨ ClassLoader ç±»ä¸­ï¼Œå®Œæˆè¿™ä¸ªå·¥ä½œæµç¨‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException &#123; synchronized (getClassLoadingLock(name)) &#123; // First, check if the class has already been loaded // é¦–å…ˆæ£€æŸ¥æ˜¯å¦å·²ç»åŠ è½½è¿‡äº†ï¼ŒåŠ è½½è¿‡äº†å°±æ²¡å¿…è¦åŠ è½½äº†ã€‚ Class&lt;?&gt; c = findLoadedClass(name); if (c == null) &#123; long t0 = System.nanoTime(); try &#123; if (parent != null) &#123; // å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯ä¸ªé€’å½’è°ƒç”¨ï¼Œå°±æ˜¯æ„å‘³ç€å°†è¯¥è¯·æ±‚ä¸æ–­åœ°å‘ä¸Šå§”æ´¾ c = parent.loadClass(name, false); &#125; else &#123; // æ²¡æœ‰è€çˆ¶äº²äº†ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯ BootStrap ClassLoader c = findBootstrapClassOrNull(name); &#125; &#125; catch (ClassNotFoundException e) &#123; // ClassNotFoundException thrown if class not found // from the non-null parent class loader &#125; if (c == null) &#123; // If still not found, then invoke findClass in order // to find the class. long t1 = System.nanoTime(); c = findClass(name); // this is the defining class loader; record the stats sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); &#125; &#125; if (resolve) &#123; resolveClass(c); &#125; return c; &#125; &#125; ä¸ºä½•è¦å¼•å…¥è¿™ä¸ªåŒäº²å§”æ´¾æ¨¡å‹ï¼Œç›´æ¥ç”¨ä¸€ä¸ªç±»åŠ è½½å™¨ä¸å¥½å—ï¼Ÿå½“ç„¶ä¸å¥½ï¼æˆ‘è§‰å¾—åŒäº²å§”æ´¾æ¨¡å‹æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼šèƒ½å¤Ÿæœ€å¤§é™åº¦çš„ä¿è¯å†…åº“çš„å®‰å…¨æ€§ï¼Œæ¯”å¦‚ String ç±»ï¼Œå¦‚æœæˆ‘è‡ªå·±å»å®ç°ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹æ˜¯ä¸ä¼šåŠ è½½æˆ‘è¿™ä¸ªç±»çš„ï¼Œè€Œæ˜¯ä¼šä½¿ç”¨å¯åŠ¨äº†åŠ è½½å™¨å»åŠ è½½å†…åº“ä¸­çš„ String ç±»ã€‚ æ¢å¥è¯è¯´ï¼ŒåŒäº²å§”æ´¾å¸¦æ¥çš„è¿™ä¸ªå¥½å¤„ï¼Œå°±æ˜¯ javaç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ï¼Œå†…åº“çš„ç±»ä¼˜å…ˆçº§é«˜ï¼Œæ‰€ä»¥å°±æ›´åŠ å®‰å…¨äº†ã€‚ é‚£æˆ‘å¼„å¤šä¸ªç±»åŠ è½½å™¨ï¼Œæˆ‘ä¸æè¿™ç§å·¥ä½œæµç¨‹å¯ä¸å¯ä»¥ï¼Ÿä¸è¿™æ ·çš„è¯ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´ä¸€ä¸ªç±»è¢«å¤šä¸ªä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œè¿™æ ·ä¼šäº§ç”Ÿå¾ˆå¤šæœ¬åº”è¯¥ä¸€æ ·çš„äºŒè¿›åˆ¶æµï¼Œä½†æ˜¯ç”±äºç±»åŠ è½½å™¨ä¸åŒï¼Œåœ¨æ–¹æ³•åŒºå°±ä¸åŒäº†ã€‚ æ—¢ç„¶è¿™ä¹ˆå¥½ï¼Œä¸ºä½•è¦è¿åè¿™ä¸ªæ¨¡å‹ï¼Œè¿åä¸ä¼šå¸¦æ¥é—®é¢˜å—ï¼Ÿå¥½çš„ç¡®æ˜¯å¥½å•Šï¼Œä½†æ˜¯è¿™ä¸ªæ¨¡å‹ä»–æœ‰è‡´å‘½çš„å¼±ç‚¹å•Šï¼Œå°±æ˜¯ has-aï¼Œä¹Ÿå°±æ˜¯ä»–ä»¬åªæ˜¯ç»„åˆçš„å…³ç³»ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘é¡¶å±‚åŠ è½½å™¨åŠ è½½ç±»æ—¶ï¼Œé‡åˆ°é—®é¢˜äº†ï¼Œæ¯”å¦‚è¯´ jdbcï¼Œå°±æ˜¯é¡¶å±‚åŠ è½½å™¨åŠ è½½äº† driver è¿™ä¸ªæ¥å£ï¼Œä½†æ˜¯æ²¡æœ‰å®ç°ç±»ï¼Œè¿™ä¸ªæ—¶å€™é¡¶å±‚åŠ è½½å™¨å·²ç»åœ¨åŠ è½½è¿™ä¸ªç±»äº†ï¼Œä½†æ˜¯å¡ä½äº†ï¼Œæ­¤æ—¶åŒäº²å§”æ´¾æ¨¡å‹ä¹Ÿå¸®ä¸ä¸Šå¿™äº†å•Šï¼Œå› ä¸ºè¿™ä¸ªæ¨¡å‹å¹¶ä¸å…è®¸ä½ é¡¶å±‚åŠ è½½å™¨å»è·å¾—ä¸‹ä¸€çº§çš„åŠ è½½å™¨å»å¸®å¿™åŠ è½½ç±»ï¼Œæ‰€ä»¥æ­¤æ—¶å°±å¿…é¡»è¿èƒŒè¿™ä¸ªæ¨¡å‹å»åšä¸€äº›äº‹æƒ…äº†ã€‚ å›é¡¾ â€” jdbcåœ¨æ­£å¼è®² jdbc ç ´ååŒäº²å§”æ´¾æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å¥½å¥½å›é¡¾ä¸€ä¸‹ jdbc çš„æ¦‚å¿µï¼Œè¿™æ˜¯ mybatis çš„åŸºç¡€ã€‚ å®šä¹‰JDBCï¼ˆJava DataBase Connectivity,javaæ•°æ®åº“è¿æ¥ï¼‰æ˜¯ä¸€ç§ç”¨äºæ‰§è¡ŒSQLè¯­å¥çš„Java APIï¼Œå¯ä»¥ä¸ºå¤šç§å…³ç³»æ•°æ®åº“æä¾›ç»Ÿä¸€è®¿é—®ï¼Œå®ƒç”±ä¸€ç»„ç”¨ Java è¯­è¨€ç¼–å†™çš„ç±»å’Œæ¥å£ç»„æˆã€‚JDBCæä¾›äº†ä¸€ç§åŸºå‡†ï¼Œæ®æ­¤å¯ä»¥æ„å»ºæ›´é«˜çº§çš„å·¥å…·å’Œæ¥å£ï¼Œä½¿æ•°æ®åº“å¼€å‘äººå‘˜èƒ½å¤Ÿç¼–å†™æ•°æ®åº“åº”ç”¨ç¨‹åºã€‚ ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼Œjdbc æ˜¯ sun å…¬å¸æå‡ºæ¥ java æ“ä½œ æ•°æ®åº“çš„è§„èŒƒï¼Œå…·ä½“å¦‚ä½•å»å®ç°ï¼Œéœ€è¦å„å¤§å‚å•†è‡ªå·±å®ç°ã€‚ ä½¿ç”¨123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117package ç±»åŠ è½½å™¨;import java.sql.*;import java.util.ArrayList;import java.util.List;// è¿™é‡Œä½¿ç”¨çš„æ˜¯ Class.forName("")ï¼Œæ²¡æœ‰ä½¿ç”¨ spi å»åŠ è½½ï¼Œæ‰€ä»¥è¿™ä¸ªå¹¶æ²¡æœ‰è¿ååŒäº²å§”æ´¾æ¨¡å‹/** * åœ¨mysqlä¸­åˆ›å»ºtestæ•°æ®åº“ï¼Œå¹¶å»ºç«‹userè¡¨ï¼Œä¸¤ä¸ªå­—æ®µï¼Œnameå’Œage */public class jdbc &#123; /** * æ•°æ®åº“ç›¸å…³å‚æ•° */ // maven å¯¼åŒ…å°±å¥½ï¼Œmysql 8.0ä¹‹åçš„åŒ…ï¼Œå®˜æ–¹ä¹Ÿæ˜¯å»ºè®®ä½¿ç”¨ SPI å“¦ï¼ï¼ // ä½¿ç”¨ spi å°±å¯ä»¥ä¸ç”¨ç¡¬ç¼–ç äº†ï¼Œä¸ç”¨æ¯æ¬¡æ¢åŒ…éƒ½æ”¹ä»£ç äº†ï¼ public static final String JDBC_DRIVER = "com.mysql.cj.jdbc.Driver"; //è¿æ¥æ•°æ®åº“çš„urlï¼Œå„ä¸ªæ•°æ®åº“å‚å•†ä¸ä¸€æ ·ï¼Œæ­¤å¤„ä¸ºmysqlçš„;åé¢æ˜¯åˆ›å»ºçš„æ•°æ®åº“åç§° public static final String JDBC_URL = "jdbc:mysql://localhost:3306/test"; //è¿æ¥æ•°æ®åº“æ‰€éœ€è´¦æˆ·å public static final String JDBC_USERNAME = "root"; //ç”¨æˆ·åå¯¹åº”çš„å¯†ç ï¼Œæˆ‘çš„mysqlå¯†ç æ˜¯123456 public static final String JDBC_PASSWORD ="jwyjwy9951206-=-"; public static void main(String[] args) &#123; List&lt;Student&gt; students = new ArrayList&lt;Student&gt;(); Connection connection = null; PreparedStatement preparedStatement = null; ResultSet resultSet = null; try &#123; //ç¬¬ä¸€æ­¥ï¼šåŠ è½½Driverç±»ï¼Œæ³¨å†Œæ•°æ®åº“é©±åŠ¨ Class.forName(JDBC_DRIVER); //ç¬¬äºŒæ­¥ï¼šé€šè¿‡DriverManager,ä½¿ç”¨urlï¼Œç”¨æˆ·åå’Œå¯†ç å»ºç«‹è¿æ¥(Connection) connection = DriverManager.getConnection(JDBC_URL, JDBC_USERNAME, JDBC_PASSWORD); //ç¬¬ä¸‰æ­¥ï¼šé€šè¿‡Connectionï¼Œä½¿ç”¨sqlè¯­å¥æ‰“å¼€Statementå¯¹è±¡ï¼› preparedStatement = connection.prepareStatement("select * from user where age =?"); //ä¼ å…¥å‚æ•°ï¼Œä¹‹æ‰€ä»¥è¿™æ ·æ˜¯ä¸ºäº†é˜²æ­¢sqlæ³¨å…¥ preparedStatement.setInt(1, 21); //ç¬¬å››æ­¥ï¼šæ‰§è¡Œè¯­å¥ï¼Œå°†ç»“æœè¿”å›resultSet resultSet = preparedStatement.executeQuery(); //ç¬¬äº”æ­¥ï¼šå¯¹ç»“æœè¿›è¡Œå¤„ç† while (resultSet.next())&#123; String name = resultSet.getString("name"); int age = resultSet.getInt("age"); Student student = new Student(); student.setAge(age); student.setName(name); students.add(student); &#125; &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; catch (SQLException e) &#123; e.printStackTrace(); &#125;finally &#123; //ç¬¬å…­æ­¥ï¼šå€’å™é‡Šæ”¾èµ„æºresultSet-ã€‹preparedStatement-ã€‹connection try &#123; if (resultSet!=null &amp;&amp; !resultSet.isClosed())&#123; resultSet.close(); &#125; &#125; catch (SQLException e) &#123; e.printStackTrace(); &#125; try &#123; if(preparedStatement!=null &amp;&amp; !preparedStatement.isClosed())&#123; preparedStatement.close(); &#125; &#125; catch (SQLException e) &#123; e.printStackTrace(); &#125; try &#123; if(connection!=null &amp;&amp; connection.isClosed())&#123; connection.close(); &#125; &#125; catch (SQLException e) &#123; e.printStackTrace(); &#125; &#125; for (Student student:students) &#123; System.out.println(student.getName()+"="+student.getAge()); &#125; &#125;&#125;class Student&#123; private String name; private int age; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125;&#125; æ€»ç»“ä¸€ä¸‹ï¼Œæœ‰ä»¥ä¸‹å‡ æ­¥ï¼š ä½¿ç”¨ DriverManager å»å»ºç«‹è¿æ¥ï¼Œè¿™é‡Œæ˜¯ç›´æ¥ç”¨ Class.forName()å»è¿›è¡Œ driveré©±åŠ¨çš„åŠ è½½ï¼Œè¿™æ ·çš„è¯è¿™ä¸ªdriver æ˜¯ç”± Application ClassLoader åŠ è½½çš„ï¼Œè€Œ DriverManager æ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œç”±äº driver å…ˆåŠ è½½äº†ï¼Œæ‰€ä»¥è¿™é‡Œå¹¶ä¸ä¼šè¿ååŒäº²å§”æ´¾åŸåˆ™ï¼Œåœ¨ä¸‹é¢æˆ‘è¿˜ä¼šè¯¦ç»†è®²åˆ°è¿™ä¸ªåŠ è½½è¿‡ç¨‹ï¼› å»ºç«‹è¿æ¥åï¼Œé€šè¿‡ connection å¯¹è±¡ï¼Œä¼ å…¥ sql è¯­å¥ï¼ŒåŒ…è£…æˆ Statement å¯¹è±¡ï¼Œç„¶åå¯ä»¥å¯¹å…¶ä¼ å‚ï¼› ç„¶åæ‰§è¡Œ sql è¯­å¥ï¼Œä¼šè¿”å›ç»“æœç»“æœé›† ResultSetï¼› å¤„ç†ç»“æœå³å¯ï¼› æœ€åé‡Šæ”¾èµ„æºã€‚ jdbc &amp; åŒäº²å§”æ´¾æ¨¡å‹çš„çˆ±æ¨æƒ…ä»‡ä¸»è¦å‚è€ƒï¼š https://blog.csdn.net/justloveyou_/article/details/72231425 åœ¨è®²æ­£é¢˜ä¹‹å‰ï¼Œè¿˜æ˜¯è¦å†é“ºå«ä¸€ä¸‹ï¼Œå…ˆä»‹ç»å‡ ä¸ªéœ€è¦çŸ¥é“çš„æ¦‚å¿µï¼šSPI æœºåˆ¶ã€çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚ SPIç®€ä»‹SPIï¼ˆService Provider Interfaceï¼‰ï¼Œé’ˆå¯¹å‚å•†æˆ–è€…æ’ä»¶çš„ä¸€ç§æœºåˆ¶ã€‚æˆ‘ä»¬ç³»ç»Ÿé‡ŒæŠ½è±¡çš„å„ä¸ªæ¨¡å—ï¼Œå¾€å¾€æœ‰å¾ˆå¤šä¸åŒçš„å®ç°æ–¹æ¡ˆï¼Œæ¯”å¦‚æ—¥å¿—æ¨¡å—çš„æ–¹æ¡ˆï¼Œxmlè§£ææ¨¡å—ã€jdbcæ¨¡å—çš„æ–¹æ¡ˆç­‰ã€‚é¢å‘çš„å¯¹è±¡çš„è®¾è®¡é‡Œï¼Œæˆ‘ä»¬ä¸€èˆ¬æ¨èæ¨¡å—ä¹‹é—´åŸºäºæ¥å£ç¼–ç¨‹ï¼Œæ¨¡å—ä¹‹é—´ä¸å¯¹å®ç°ç±»è¿›è¡Œç¡¬ç¼–ç ã€‚ä¸€æ—¦ä»£ç é‡Œæ¶‰åŠå…·ä½“çš„å®ç°ç±»ï¼Œå°±è¿åäº†å¯æ‹”æ’çš„åŸåˆ™ï¼Œå¦‚æœéœ€è¦æ›¿æ¢ä¸€ç§å®ç°ï¼Œå°±éœ€è¦ä¿®æ”¹ä»£ç ã€‚ä¸ºäº†å®ç°åœ¨æ¨¡å—è£…é…çš„æ—¶å€™èƒ½ä¸åœ¨ç¨‹åºé‡ŒåŠ¨æ€æŒ‡æ˜ï¼Œè¿™å°±éœ€è¦ä¸€ç§æœåŠ¡å‘ç°æœºåˆ¶ã€‚ java spiå°±æ˜¯æä¾›è¿™æ ·çš„ä¸€ä¸ªæœºåˆ¶ï¼šä¸ºæŸä¸ªæ¥å£å¯»æ‰¾æœåŠ¡å®ç°çš„æœºåˆ¶ã€‚æœ‰ç‚¹ç±»ä¼¼IOCçš„æ€æƒ³ï¼Œå°±æ˜¯å°†è£…é…çš„æ§åˆ¶æƒç§»åˆ°ç¨‹åºä¹‹å¤–ï¼Œåœ¨æ¨¡å—åŒ–è®¾è®¡ä¸­è¿™ä¸ªæœºåˆ¶å°¤å…¶é‡è¦ã€‚ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œsigangjunã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/sigangjun/article/details/79071850 çº¦å®šå½“æœåŠ¡çš„æä¾›è€…æä¾›äº†æœåŠ¡æ¥å£çš„ä¸€ç§å®ç°ä¹‹åï¼Œåœ¨jaråŒ…çš„META-INF/services/ç›®å½•é‡ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªä»¥æœåŠ¡æ¥å£å‘½åçš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶é‡Œå°±æ˜¯å®ç°è¯¥æœåŠ¡æ¥å£çš„å…·ä½“å®ç°ç±»ã€‚è€Œå½“å¤–éƒ¨ç¨‹åºè£…é…è¿™ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œå°±èƒ½é€šè¿‡è¯¥jaråŒ…META-INF/services/é‡Œçš„é…ç½®æ–‡ä»¶æ‰¾åˆ°å…·ä½“çš„å®ç°ç±»åï¼Œå¹¶è£…è½½å®ä¾‹åŒ–ï¼Œå®Œæˆæ¨¡å—çš„æ³¨å…¥ã€‚åŸºäºè¿™æ ·ä¸€ä¸ªçº¦å®šå°±èƒ½æ‰¾åˆ°æœåŠ¡æ¥å£çš„å®ç°ç±»ï¼Œä¸éœ€è¦åœ¨ä»£ç é‡ŒæŒ‡å®šã€‚jdkæä¾›æœåŠ¡å®ç°æŸ¥æ‰¾çš„å·¥å…·ç±»ï¼šjava.util.ServiceLoaderã€‚ å¸¦æ¥çš„é—®é¢˜SPI ï¼ˆæœåŠ¡æä¾›æ¥å£ï¼‰æ˜¯åœ¨ rt.jar ä¸‹å®šä¹‰çš„ï¼Œè¿™æ˜¯ç³»ç»Ÿæ ¸å¿ƒåº“ï¼Œæ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨å»åŠ è½½çš„ï¼Œä½†æ˜¯æ¥å£çš„å®ç°å´åœ¨å„ä¾›åº”å•†æä¾›çš„ jar åŒ…ä¸‹ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨è‚¯å®šæ˜¯æ— æ³•å»è¿›è¡ŒåŠ è½½çš„ï¼Œæ‰€ä»¥æ­¤æ—¶åŒäº²å§”æ´¾æ¨¡å‹æ— æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ­£æ˜¯å› ä¸º SPI å¸¦æ¥çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼•å…¥ çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€ŒContext ClassLoaderã€ è¿™ä¸ªæ­¦å™¨æ¥è¿›è¡ŒåŒäº²å§”æ´¾æ¨¡å‹çš„è¿åã€‚ çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯ä» JDK 1.2 å¼€å§‹å¼•å…¥çš„ã€‚Java.lang.Threadä¸­çš„æ–¹æ³• getContextClassLoader()å’Œ setContextClassLoader(ClassLoader cl)ç”¨æ¥è·å–å’Œè®¾ç½®çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚å¦‚æœæ²¡æœ‰é€šè¿‡ setContextClassLoader(ClassLoader cl)æ–¹æ³•è¿›è¡Œè®¾ç½®çš„è¯ï¼Œçº¿ç¨‹å°†ç»§æ‰¿å…¶çˆ¶çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚Java åº”ç”¨è¿è¡Œçš„åˆå§‹çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ã€ŒApplication ClassLoaderã€ï¼Œåœ¨çº¿ç¨‹ä¸­è¿è¡Œçš„ä»£ç å¯ä»¥é€šè¿‡æ­¤ç±»åŠ è½½å™¨æ¥åŠ è½½ç±»å’Œèµ„æºã€‚ æœ‰äº†ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œé‚£å°±å¯ä»¥ç›´æ¥åœ¨ SPI ä¸­å»åŠ è½½å„å‚å•†æä¾›çš„å®ç°ç±»äº†ã€‚ jdbc çš„åŠ è½½jdbc å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è¿›è¡ŒåŠ è½½ï¼š è¿™ç§æ–¹å¼å¹¶æ²¡æœ‰è¿ååŒäº²å§”æ´¾æ¨¡å‹ï¼Œå› ä¸ºå…¶å¹¶æ²¡æœ‰è°ƒç”¨ SPI æ¥å£ï¼Œç›´æ¥å»ç¡¬ç¼–ç åŠ è½½ Driver é©±åŠ¨ï¼Œæ‰€ä»¥æ ¹æœ¬ä¸ä¼šç”¨åˆ° BootStrap ClassLoader å»è°ƒç”¨ SPIã€‚ 12Class.forName("com.mysql.cj.jdbc.Driver");connection = DriverManager.getConnection(JDBC_URL, JDBC_USERNAME, JDBC_PASSWORD); SPI æœºåˆ¶å»åŠ è½½ Driver é©±åŠ¨ï¼Œå¯ä»¥é¿å…ç¡¬ç¼–ç ï¼Œé©±åŠ¨æ”¹äº†ä¹Ÿæ— éœ€ä¿®æ”¹ä»£ç ã€‚å› ä¸º jdk é»˜è®¤å°±æ˜¯ spi æœºåˆ¶ï¼Œæ‰€ä»¥å…¶å®ä¸Šé¢é‚£ä¸€è¡Œæ˜¯å¤šä½™çš„ï¼Œå»æ‰ Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);ç¨‹åºæ˜¯ç…§æ ·æ‰§è¡Œçš„ã€‚ æˆ‘ä»¬å¯ä»¥æ·±å…¥æºç å»çœ‹ä¸€ä¸‹å®ç°çš„å…·ä½“æ­¥éª¤ï¼š åœ¨ DriverManager çš„ static ä»£ç å—ä¸­ 12345678/** * Load the initial JDBC drivers by checking the System property * jdbc.properties and then use the &#123;@code ServiceLoader&#125; mechanism */static &#123; loadInitialDrivers(); println("JDBC DriverManager initialized");&#125; æˆ‘ä»¬æ³¨æ„åˆ°æœ‰ä¸ª loadIntialDrivers()ï¼Œç»§ç»­çœ‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162private static void loadInitialDrivers() &#123; String drivers; try &#123; drivers = AccessController.doPrivileged(new PrivilegedAction&lt;String&gt;() &#123; public String run() &#123; return System.getProperty("jdbc.drivers"); &#125; &#125;); &#125; catch (Exception ex) &#123; drivers = null; &#125; // If the driver is packaged as a Service Provider, load it. // Get all the drivers through the classloader // exposed as a java.sql.Driver.class service. // ServiceLoader.load() replaces the sun.misc.Providers() AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123; public Void run() &#123; // è¿™é‡Œæ˜¯é‡ç‚¹ï¼ï¼ï¼ï¼ï¼ï¼ï¼ ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class); Iterator&lt;Driver&gt; driversIterator = loadedDrivers.iterator(); /* Load these drivers, so that they can be instantiated. * It may be the case that the driver class may not be there * i.e. there may be a packaged driver with the service class * as implementation of java.sql.Driver but the actual class * may be missing. In that case a java.util.ServiceConfigurationError * will be thrown at runtime by the VM trying to locate * and load the service. * * Adding a try catch block to catch those runtime errors * if driver not available in classpath but it's * packaged as service and that service is there in classpath. */ try&#123; while(driversIterator.hasNext()) &#123; driversIterator.next(); &#125; &#125; catch(Throwable t) &#123; // Do nothing &#125; return null; &#125; &#125;); println("DriverManager.initialize: jdbc.drivers = " + drivers); if (drivers == null || drivers.equals("")) &#123; return; &#125; String[] driversList = drivers.split(":"); println("number of Drivers:" + driversList.length); for (String aDriver : driversList) &#123; try &#123; println("DriverManager.Initialize: loading " + aDriver); Class.forName(aDriver, true, ClassLoader.getSystemClassLoader()); &#125; catch (Exception ex) &#123; println("DriverManager.Initialize: load failed: " + ex); &#125; &#125; &#125; æˆ‘ä»¬çœ‹åˆ°äº†æˆ‘ä¸Šæ–‡æåŠçš„ ServiceLoaderï¼Œæˆ‘ä»¬è¯´è¿‡ä»–å…¶å®å°±æ˜¯å»è¿›è¡ŒæœåŠ¡å®ç°æŸ¥æ‰¾çš„ï¼Œç»§ç»­çœ‹ ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class);åšäº†äº›ä»€ä¹ˆã€Œå…¶å®æˆ‘ä»¬è‚¯å®šéƒ½èƒ½çŒœåˆ°äº†ï¼Œè‚¯å®šæ˜¯æ‹¿åˆ°äº†é©±åŠ¨çš„åˆ—è¡¨ã€‚ã€ 12345678910public static &lt;S&gt; ServiceLoader&lt;S&gt; load(Class&lt;S&gt; service) &#123; ClassLoader cl = Thread.currentThread().getContextClassLoader(); return ServiceLoader.load(service, cl);&#125; public static &lt;S&gt; ServiceLoader&lt;S&gt; load(Class&lt;S&gt; service, ClassLoader loader)&#123; return new ServiceLoader&lt;&gt;(service, loader);&#125; åœ¨è¿™é‡Œï¼Œç»ˆäºå‡ºç°äº†çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œç„¶åå†ç»è¿‡ä¸€ç³»åˆ—çš„å‡½æ•°è°ƒç”¨ã€Œæˆ‘å°±ä¸å±•å¼€äº†ï¼Œè¿˜æ˜¯éå¸¸å¤æ‚çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æœ€ç»ˆçš„æœ‰æ•ˆä»£ç ã€ã€‚ 12345678910111213141516171819202122232425private boolean hasNextService() &#123; if (nextName != null) &#123; return true; &#125; if (configs == null) &#123; try &#123; // ç­‰åŒäº Class.forName() String fullName = PREFIX + service.getName(); if (loader == null) configs = ClassLoader.getSystemResources(fullName); else configs = loader.getResources(fullName); &#125; catch (IOException x) &#123; fail(service, "Error locating configuration files", x); &#125; &#125; while ((pending == null) || !pending.hasNext()) &#123; if (!configs.hasMoreElements()) &#123; return false; &#125; pending = parse(service, configs.nextElement()); &#125; nextName = pending.next(); return true; &#125; æ‰€ä»¥ï¼Œå°±æ˜¯åˆ©ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨å»å®Œæˆè¿ååŒäº²å§”æ´¾æ¨¡å‹çš„è¡Œä¸ºçš„ã€‚ â€‹ æ‹“å±•é™¤äº† SPI æœºåˆ¶ï¼Œè¿åäº†åŒäº²å§”æ´¾æ¨¡å‹ï¼Œåœ¨ Spring ä¸­ å’Œ Tomcat ä¸­ä¹ŸåŒæ ·è¿åäº†åŒäº²å§”æ´¾æ¨¡å‹ã€‚ â€‹ ã€ŒTomcatè¿™ä¸€å—æ²¡å¤ªææ˜ç™½ã€‚ã€‚ã€‚ã€‚ã€‚ã€ Tomcat ä¸­è¿åçš„åŸå› æ˜¯æ¯ä¸ª webåº”ç”¨ç¨‹åºå¯¹åº”çš„ç±»åº“éƒ½åº”è¯¥æ˜¯äº’ç›¸éš”ç¦»çš„ï¼Œä½†æ˜¯å¦‚æœæ˜¯åŒäº²å§”æ´¾æœºåˆ¶ï¼Œé‚£ä¹ˆéƒ½ä¼šå»ç”¨é¡¶å±‚åŠ è½½å™¨åŠ è½½ç›¸åº”çš„ç±»ï¼Œé‚£ä¹ˆä¸€ä¸ªç›¸åŒçš„ç±»ä¼šè¢«åŠ è½½å¤šæ¬¡ï¼Œè€Œåˆæ˜¯å±äºä¸åŒçš„webappï¼Œå¯¼è‡´å‘ç”Ÿå†²çªï¼Œæ‰€ä»¥åœ¨ Tomcat ä¸­æ˜¯ WebApp è‡ªå·±ç›´æ¥åŠ è½½ï¼Œä¸è½¬å‘ç»™ä¸Šçº§åŠ è½½å™¨ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œå­ä¼˜å…ˆâ€ã€‚ã€Œè¿™å—æˆ‘è‡ªå·±ä¹Ÿæœ‰äº›ä¸ç¡®å®šï¼Œåœ¨å‘¨å¿—åè€å¸ˆçš„ä¹¦ä¸­ä¹Ÿè®²åˆ°äº†è¿™ä¸ªä¾‹å­ï¼Œä½†æ˜¯æˆ‘ä¹Ÿæ²¡å¤ªæ˜ç™½ä»–è®²è¿™ä¸ªä¾‹å­çš„æ„æ€ã€‚ã€‚ã€‚ã€ æœ‰ä¸ªè·Ÿæˆ‘ç±»ä¼¼æƒ³æ³•çš„åšå®¢ï¼Œå†™çš„æ¯”è¾ƒè¯¦ç»†ï¼Œå¯ä»¥çœ‹çœ‹ï¼šhttps://www.cnblogs.com/aspirant/p/8991830.html è¿™ä¸ªè°ˆåˆ°äº†å­ä¼˜å…ˆï¼Œä¸è¿‡ä¹Ÿæ²¡å¤ªçœ‹æ˜ç™½ï¼šhttps://zhuanlan.zhihu.com/p/24168200 Springï¼Œè¿™ä¸ªé—®é¢˜å‘¨å¿—åè€å¸ˆçš„ä¹¦ä¸­ä¹Ÿæœ‰æåŠã€‚ å¦‚ä¸‹ï¼šå¦‚æœæœ‰ 10 ä¸ª Web åº”ç”¨ç¨‹åºéƒ½ç”¨åˆ°äº†springçš„è¯ï¼Œå¯ä»¥æŠŠSpringçš„jaråŒ…æ”¾åˆ° common æˆ– shared ç›®å½•ä¸‹è®©è¿™äº›ç¨‹åºå…±äº«ã€‚Spring çš„ä½œç”¨æ˜¯ç®¡ç†æ¯ä¸ªwebåº”ç”¨ç¨‹åºçš„beanï¼ŒgetBeanæ—¶è‡ªç„¶è¦èƒ½è®¿é—®åˆ°åº”ç”¨ç¨‹åºçš„ç±»ï¼Œè€Œç”¨æˆ·çš„ç¨‹åºæ˜¾ç„¶æ˜¯æ”¾åœ¨ /WebApp/WEB-INF ç›®å½•ä¸­çš„ï¼ˆç”± WebAppClassLoader åŠ è½½ï¼‰ï¼Œé‚£ä¹ˆåœ¨ CommonClassLoader æˆ– SharedClassLoader ä¸­çš„ Spring å®¹å™¨å¦‚ä½•å»åŠ è½½å¹¶ä¸åœ¨å…¶åŠ è½½èŒƒå›´çš„ç”¨æˆ·ç¨‹åºï¼ˆ/WebApp/WEB-INF/ï¼‰ä¸­çš„Classå‘¢ï¼Ÿ springæ ¹æœ¬ä¸ä¼šå»ç®¡è‡ªå·±è¢«æ”¾åœ¨å“ªé‡Œï¼Œå®ƒç»Ÿç»Ÿä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ¥åŠ è½½ç±»ï¼Œè€Œçº¿ç¨‹ç±»åŠ è½½å™¨é»˜è®¤è®¾ç½®ä¸ºäº†WebAppClassLoaderã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå“ªä¸ªWebAppåº”ç”¨è°ƒç”¨äº†Springï¼ŒSpringå°±å»å–è¯¥åº”ç”¨è‡ªå·±çš„WebAppClassLoaderæ¥åŠ è½½beanã€‚]]></content>
      <categories>
        <category>jvm</category>
        <category>jdbc</category>
      </categories>
      <tags>
        <tag>åŒäº²å§”æ´¾æ¨¡å‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é¢è¯•ç»å†]]></title>
    <url>%2F2020%2F03%2F17%2F%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95%E7%BB%8F%E9%AA%8C.html</url>
    <content type="text"><![CDATA[2020.3.17 15:38 - 16:35 ã€Œ57 åˆ†é’Ÿã€é˜¿é‡Œä¸€é¢ç”µè¯é¢ã€‚è‡ªå·±ç¬¬ä¸€æ¬¡é¢è¯•ï¼Œé¢å¾—å¾ˆç³Ÿç³•ï¼Œé¢å¯¹é—®é¢˜å¾ˆæ…Œâ€¦ æ•´ä¸ªé¢è¯•åˆ†ä¸‰å—è¿›è¡Œï¼š åŸºç¡€çŸ¥è¯†ï¼Œä¸»è¦é—®äº†è®¡ç½‘å’Œæ•°æ®åº“ä»¥åŠç®—æ³• TCP çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ è…¾è®¯çš„é¢è¯•å®˜å¤§å¤§ä¹Ÿé—®äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”ç‰¹åˆ«æé†’äº†æˆ‘è¦æ³¨æ„è®°ä½ tcp è¿æ¥å’Œæ–­å¼€æ—¶å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„çŠ¶æ€ï¼ŒçœŸæ˜¯è¶…çº§æ„Ÿè°¢å•Šï¼Œè¿™ç‚¹åŸæ¥è¿˜çœŸçš„ä¸€ç›´æ²¡æœ‰æ³¨æ„è¿‡ã€‚ é¦–å…ˆæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ TCP çš„æ•°æ®ä¼ è¾“å•å…ƒï¼ŒTCP ä¼ é€çš„æ•°æ®å•å…ƒç§°ä¸ºæŠ¥æ–‡æ®µã€‚ä¸€ä¸ª TCP æŠ¥æ–‡æ®µåˆ†ä¸º TCP é¦–éƒ¨å’Œ TCP æ•°æ®ä¸¤éƒ¨åˆ†ï¼Œæ•´ä¸ª TCP æŠ¥æ–‡æ®µéƒ½å°è£…åœ¨ IP æ•°æ®æŠ¥ä¸­çš„æ•°æ®éƒ¨åˆ†ï¼ŒTCP é¦–éƒ¨é•¿åº¦æ˜¯4çš„æ•´æ•°å€ï¼Œå…¶ä¸­æœ‰å›ºå®šçš„20ä¸ªå­—èŠ‚ï¼Œå‰©ä½™çš„å¯å˜åŠ¨çš„å°±æ˜¯é€‰é¡¹å’Œå¡«å……ã€Œæœ€å¸¸è§çš„å¯é€‰å­—æ®µæ˜¯æœ€é•¿æŠ¥æ–‡å¤§å°ï¼Œåˆç§°ä¸ºMSSï¼ˆMaximum Segment Sizeï¼‰ï¼Œæ¯ä¸ªè¿æ¥æ–¹é€šå¸¸éƒ½åœ¨é€šä¿¡çš„ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µï¼ˆä¸ºå»ºç«‹è¿æ¥è€Œè®¾ç½®SYNæ ‡å¿—ä¸º1çš„é‚£ä¸ªæ®µï¼‰ä¸­æŒ‡æ˜è¿™ä¸ªé€‰é¡¹ï¼Œå®ƒè¡¨ç¤ºæœ¬ç«¯æ‰€èƒ½æ¥å—çš„æœ€å¤§æŠ¥æ–‡æ®µçš„é•¿åº¦ã€‚ã€ï¼Œ20ä¸ªå›ºå®šçš„å­—èŠ‚åŒ…æ‹¬äº†æºç«¯å£å·ï¼ˆ2 å­—èŠ‚ï¼‰ã€ç›®çš„ç«¯å£ï¼ˆ2å­—èŠ‚ï¼‰ã€seqåºåˆ—å·ï¼ˆ4å­—èŠ‚ï¼‰ã€ç¡®è®¤å·ackï¼ˆ4å­—èŠ‚ï¼‰ã€ä»¥åŠç¡®è®¤ä½ACK ç­‰ç­‰ã€‚ å…¶æ¬¡ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†è®²è§£ä¸€ä¸‹ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼š ä¸‰æ¬¡æ¡æ‰‹ é¦–å…ˆï¼Œåœ¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„é˜¶æ®µï¼Œæ˜¯ä¸ä¼šä¼ è¾“ TCP æŠ¥æ–‡æ®µçš„ï¼Œä¼ è¾“çš„æ˜¯ ä¼ è¾“æ§åˆ¶å—ï¼ˆTCBï¼‰ï¼Œä¼ è¾“æ§åˆ¶å— TCB(Transmission Control Block)å­˜å‚¨äº†æ¯ä¸€ä¸ªè¿æ¥ä¸­çš„ä¸€äº›é‡è¦ä¿¡æ¯ï¼Œå¦‚ï¼šTCP è¿æ¥è¡¨ï¼ŒæŒ‡å‘å‘é€å’Œæ¥æ”¶ç¼“å­˜çš„æŒ‡é’ˆï¼ŒæŒ‡å‘é‡ä¼ é˜Ÿåˆ—çš„æŒ‡é’ˆï¼Œå½“å‰çš„å‘é€å’Œæ¥æ”¶åºå·ç­‰ç­‰ã€‚ æœ€å¼€å§‹çš„ Client å’Œ Server éƒ½æ˜¯å¤„äº Closedï¼Œç”±äºæœåŠ¡å™¨ç«¯ä¸çŸ¥é“è¦è·Ÿè°å»ºç«‹è¿æ¥ï¼Œæ‰€ä»¥å…¶åªèƒ½è¢«åŠ¨æ‰“å¼€ï¼Œç„¶åç›‘å¬ç«¯å£ï¼Œæ­¤æ—¶ Server å¤„äº Listen çŠ¶æ€ï¼› è€Œ Client ä¼šä¸»åŠ¨æ‰“å¼€ï¼Œç„¶åæ„å»ºå¥½ TCB ã€ŒSYN= 1ï¼Œseq = xã€ï¼Œå‘é€ç»™æœåŠ¡å™¨ç«¯ï¼Œæ­¤æ—¶ Client ä¼šå°†çŠ¶æ€ç½®ä¸º SYN_SEND ã€ŒåŒæ­¥å·²å‘é€ã€ï¼› æœåŠ¡å™¨ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„åŒæ­¥è¯·æ±‚åï¼Œä¼šå°†çŠ¶æ€ç½®ä¸º SYN_RECVã€ŒåŒæ­¥å·²æ¥æ”¶ã€ï¼ŒåŒæ—¶ä¼šæ„å»ºå¥½ TCBã€ŒSYN = 1ï¼Œseq = yï¼ŒACK = 1ï¼Œack = x + 1ã€å‘é€ç»™å®¢æˆ·ç«¯ï¼› å®¢æˆ·ç«¯æ¥æ”¶åˆ°äº†æœåŠ¡å™¨ç«¯å‘æ¥çš„ä¼ è¾“æ§åˆ¶å—ä¹‹åï¼Œä¼šå°†è‡ªå·±çš„çŠ¶æ€æ”¹ä¸º ESTABLISHEDã€Œå»ºç«‹è¿æ¥ã€ï¼Œç„¶åå‘é€ç¡®è®¤æŠ¥æ–‡ï¼ˆACK= 1ï¼Œseq = x + 1ï¼Œack = y + 1ï¼‰ï¼› æœåŠ¡å™¨ç«¯åœ¨æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘æ¥çš„æŠ¥æ–‡ä¹‹åï¼Œä¹Ÿå°†çŠ¶æ€ç½®ä¸º ESTABLISHEDã€Œå»ºç«‹è¿æ¥ã€ï¼Œè‡³æ­¤ï¼Œä¸‰æ¬¡æ¡æ‰‹ç»“æŸï¼Œå½“ç„¶åœ¨è¿™é‡Œï¼Œå¯ä»¥å¸¦ tcp æŠ¥æ–‡æ®µä¿¡æ¯è¿‡æ¥äº†ï¼Œå› ä¸ºæ­¤æ—¶å®¢æˆ·ç«¯å·²ç»å¯ä»¥ä¿è¯æ˜¯å¯é çš„ä¼ è¾“äº†ï¼Œæ‰€ä»¥åœ¨è¿™ä¸€ç«¯å¯ä»¥å‘é€æŠ¥æ–‡æ®µäº†ã€‚ å‡ ä¸ªé—®é¢˜ï¼š ä¸ºä½•ä¸ç›´æ¥åœ¨ç¬¬ä¸€æ¬¡æ¡æ‰‹å°±å¸¦ä¸ŠæŠ¥æ–‡æ®µæ¶ˆæ¯ï¼Œéè¦ç¬¬ä¸‰æ¬¡æ‰å¯ä»¥å¸¦ï¼Ÿ å› ä¸º TCP æ˜¯è¦ä¿è¯æ•°æ®çš„ä¸ä¸¢å¤±ä¸”å¯é ï¼Œå¦‚æœåœ¨ç¬¬ä¸€æ¬¡å°±å¸¦ä¸ŠæŠ¥æ–‡æ®µæ¶ˆæ¯ï¼Œæ­¤æ¬¡å»ºç«‹è¿æ¥å¾ˆæœ‰å¯èƒ½å°±ä¼šå¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä¿è¯æ•°æ®çš„ä¸ä¸¢å¤±äº†ï¼Œåœ¨ä¸å¯é çš„æœºåˆ¶ä¸Šè¿›è¡Œè¿™ç§æ“ä½œï¼Œæ¢æ¥çš„ä»£ä»·å¤ªå¤§ï¼Œæ¯æ¬¡å‘é€æŠ¥æ–‡æ®µçš„èµ„æºä¹Ÿä¼šå¢å¤§ï¼Œå¾—ä¸å¿å¤±ï¼› è€Œç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯å·²ç»çŸ¥é“æœåŠ¡å™¨ç«¯å‡†å¤‡å¥½äº†ï¼Œæ‰€ä»¥åªè¦å‘Šè¯‰æœåŠ¡å™¨ç«¯è‡ªå·±å‡†å¤‡å¥½äº†å°±okayäº†ï¼Œæ‰€ä»¥æ­¤æ—¶å¸¦ä¸ŠæŠ¥æ–‡æ®µä¿¡æ¯æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ å¯ä¸å¯ä»¥åªæ¡æ‰‹ä¸¤æ¬¡ï¼Ÿ è‚¯å®šæ˜¯ä¸å¯ä»¥çš„ï¼Œä¸‰æ¬¡æ¡æ‰‹ä¸»è¦æ˜¯è§£å†³è¿™æ ·ä¸€ä¸ªå¸¸è§çš„é—®é¢˜ï¼Œå®¢æˆ·ç«¯å‘é€äº†ç¬¬ä¸€ä¸ªè¯·æ±‚è¿æ¥å¹¶ä¸”æ²¡æœ‰ä¸¢å¤±ï¼Œåªæ˜¯å› ä¸ºåœ¨ç½‘ç»œç»“ç‚¹ä¸­æ»ç•™çš„æ—¶é—´å¤ªé•¿äº†ï¼Œç”±äºTCPçš„å®¢æˆ·ç«¯è¿Ÿè¿Ÿæ²¡æœ‰æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ï¼Œä»¥ä¸ºæœåŠ¡å™¨æ²¡æœ‰æ”¶åˆ°ï¼Œæ­¤æ—¶é‡æ–°å‘æœåŠ¡å™¨å‘é€è¿™æ¡æŠ¥æ–‡ï¼Œæ­¤åå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»è¿‡ä¸¤æ¬¡æ¡æ‰‹å®Œæˆè¿æ¥ï¼Œä¼ è¾“æ•°æ®ï¼Œç„¶åå…³é—­è¿æ¥ã€‚æ­¤æ—¶æ­¤å‰æ»ç•™çš„é‚£ä¸€æ¬¡è¯·æ±‚è¿æ¥ï¼Œç½‘ç»œé€šç•…äº†åˆ°è¾¾äº†æœåŠ¡å™¨ï¼Œè¿™ä¸ªæŠ¥æ–‡æœ¬è¯¥æ˜¯å¤±æ•ˆçš„ï¼Œä½†æ˜¯ï¼Œä¸¤æ¬¡æ¡æ‰‹çš„æœºåˆ¶å°†ä¼šè®©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å†æ¬¡å»ºç«‹è¿æ¥ï¼Œè¿™å°†å¯¼è‡´ä¸å¿…è¦çš„é”™è¯¯å’Œèµ„æºçš„æµªè´¹ã€‚ å¦‚æœé‡‡ç”¨çš„æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå°±ç®—æ˜¯é‚£ä¸€æ¬¡å¤±æ•ˆçš„æŠ¥æ–‡ä¼ é€è¿‡æ¥äº†ï¼ŒæœåŠ¡ç«¯æ¥å—åˆ°äº†é‚£æ¡å¤±æ•ˆæŠ¥æ–‡å¹¶ä¸”å›å¤äº†ç¡®è®¤æŠ¥æ–‡ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸ä¼šå†æ¬¡å‘å‡ºç¡®è®¤ã€‚ç”±äºæœåŠ¡å™¨æ”¶ä¸åˆ°ç¡®è®¤ï¼Œå°±çŸ¥é“å®¢æˆ·ç«¯å¹¶æ²¡æœ‰è¯·æ±‚è¿æ¥ã€‚â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œå°ä¹¦goã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/qzcsu/article/details/72861891 å››æ¬¡æŒ¥æ‰‹ æœ€å¼€å§‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½æ˜¯ ESTABLISHED çš„çŠ¶æ€ï¼Œç„¶åå®¢æˆ·ç«¯ä¼šä¸»åŠ¨å…³é—­ï¼Œè€ŒæœåŠ¡å™¨ç«¯åˆ™æ˜¯è¢«åŠ¨å…³é—­ã€‚ å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª FIN æŠ¥æ–‡æ®µï¼Œseq = ç»“æŸçš„æŠ¥æ–‡æ®µåºå· + 1ã€Œå‡è®¾ä¸º uã€ï¼Œå‘Šè¯‰æœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯éœ€è¦å…³é—­äº†ï¼Œæ­¤æ—¶å°†å®¢æˆ·ç«¯çš„çŠ¶æ€å˜ä¸º FIN-WAIT-1ï¼Œç­‰å¾…æœåŠ¡å™¨ç«¯çš„åé¦ˆï¼› æœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘æ¥çš„ FIN åŒ…ä¹‹åï¼Œä¼šå‘ä¸€æ¡ ackæŠ¥æ–‡åé¦ˆç»™å®¢æˆ·ç«¯ï¼Œå…¶ä¸­æŠ¥æ–‡ä¸­åŒ…æ‹¬ ACK = 1ï¼Œseq = vï¼Œack = u+1ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯æ”¶åˆ°äº†å®¢æˆ·ç«¯è¦å…³é—­çš„æ¶ˆæ¯äº†ï¼ŒåŒæ—¶æœåŠ¡å™¨ç«¯ä¼šé€šçŸ¥åº”ç”¨è¿›ç¨‹éœ€è¦å…³é—­è¿æ¥äº†ï¼Œå¹¶å°†è‡ªå·±çš„çŠ¶æ€ç½®ä¸º CLOSE-WAITï¼› ç”±äºæœåŠ¡å™¨ç«¯å¯èƒ½è¿˜æœ‰ä¸€äº›æ•°æ®æ²¡å¤„ç†å®Œï¼Œæ‰€ä»¥éœ€è¦ä¸€æ®µæ—¶é—´çš„ç­‰å¾…ï¼Œå½“å¤„ç†å®Œäº†ä¹‹åï¼Œä¼šå†å‘ä¸€æ¡æŠ¥æ–‡ï¼Œå…¶ä¸­ FIN = 1ï¼ŒACK = 1ï¼Œseq = wï¼Œack = u+1ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨ç«¯ç°åœ¨å¯ä»¥å…³é—­äº†ï¼Œå¹¶å°†æœåŠ¡å™¨ç«¯çš„çŠ¶æ€ç”± CLOSE-WAIT å˜ä¸º LAST-ACKï¼› å®¢æˆ·ç«¯åœ¨æ”¶åˆ°äº†æœåŠ¡å™¨ç«¯å‘æ¥çš„æ¶ˆæ¯ä¹‹åï¼Œä¼šå‘ä¸€æ¡ackæŠ¥æ–‡ã€ŒACK = 1ï¼Œseq = u+1ï¼Œack = w+1ã€å›å»ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯å·²ç»çŸ¥é“äº†ä½ å‡†å¤‡å¥½å…³é—­äº†ï¼Œæ­¤æ—¶ä¼šå°†å®¢æˆ·ç«¯çš„çŠ¶æ€ç”± FIN-WAIT-2 ç½®ä¸º TIME-WAITï¼Œåœ¨ä¸¤ä¸ªæœ€é•¿æŠ¥æ–‡æ®µä¼ è¾“æ—¶é—´è¿‡åï¼Œä¼šè‡ªåŠ¨å°†å®¢æˆ·ç«¯çš„çŠ¶æ€ç”± TIME-WAIT ç½®ä¸º CLOSEDã€‚ æœåŠ¡å™¨ç«¯æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œå°±å°†çŠ¶æ€ç”± LAST-ACK ç½®ä¸ºäº† CLOSEDï¼Œè‡ªæ­¤ï¼Œå››æ¬¡æŒ¥æ‰‹å…¨éƒ¨ç»“æŸã€‚ ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ï¼Œä¸ºä½•ä¸èƒ½ä¸‰æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ é¦–å…ˆå¦‚æœå»æ‰æœ€åä¸€æ¬¡æŒ¥æ‰‹ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ç«¯å°±ä¸çŸ¥é“è‡ªå·±è¦å…³é—­çš„æŠ¥æ–‡æœ‰æ²¡æœ‰ä¼ è¾“æˆåŠŸï¼Œå¯èƒ½åŠè·¯ä¸Šå°±å¤±è´¥äº†ï¼Œä½†æ˜¯æ­¤æ—¶å®¢æˆ·ç«¯ä¸çŸ¥é“ï¼Œå¯¼è‡´å®¢æˆ·ç«¯ä¸€ç›´åœ¨ç­‰å¾…æœåŠ¡å™¨å…³é—­ï¼Œä½†æ˜¯æ­¤æ—¶æœåŠ¡å™¨ç«¯ç›´æ¥å°±å…³é—­äº†ï¼› å¦‚æœä¸­é—´çš„ä¸¤æ¬¡æŒ¥æ‰‹åˆå¹¶ï¼Œé‚£æ˜¯è‚¯å®šä¸è¡Œçš„ï¼Œå› ä¸ºæ­¤æ—¶æœåŠ¡å™¨ç«¯å¯èƒ½è¿˜æœ‰å¾ˆå¤šæŠ¥æ–‡æœªå¤„ç†å®Œï¼Œæ­¤æ—¶ç›´æ¥å…³é—­è‚¯å®šä¼šå¯¹ä¼ è¾“æœ‰å¾ˆå¤§å½±å“ã€‚ ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯åœ¨æ”¶åˆ° æœåŠ¡å™¨ç«¯å‘æ¥çš„ FIN åŒ…åè¦ç­‰ 2 ä¸ªæœ€é•¿æŠ¥æ–‡æ®µä¼ è¾“æ—¶é—´ï¼Ÿ é˜²æ­¢æœ€åè‡ªå·±å‘å»çš„ ack æ²¡ä¼ é€åˆ°æœåŠ¡å™¨ï¼Œå¦‚æœæœåŠ¡å™¨æ²¡æ”¶åˆ°å®¢æˆ·ç«¯çš„ ackï¼Œè‚¯å®šä¼šé€‰æ‹©é‡å‘ä¸€æ¬¡ FIN åŒ…ï¼Œé‚£ä¹ˆæ­¤æ—¶å¦‚æœå®¢æˆ·ç«¯å·²ç»å…³é—­äº†ï¼Œå®¢æˆ·ç«¯å°±ä¸èƒ½å†å‘ ack ç¡®è®¤æ”¶åˆ°äº†ï¼Œè‡³äºä¸ºä½•æ˜¯ 2 ä¸ªæŠ¥æ–‡æ®µä¼ è¾“æ—¶é—´ï¼Œå› ä¸ºåˆšå¥½ä¸€å»ä¸€å›å˜›â€¦ 2 ä¸ªæœ€é•¿æŠ¥æ–‡ä¼ è¾“æ—¶é—´æ²¡æœ‰ FIN åŒ…å‘æ¥ï¼Œå°±è¯´æ˜æœåŠ¡å™¨å·²ç»å…³é—­äº†ï¼Œå®¢æˆ·ç«¯ä¹Ÿå°±å¯ä»¥å®‰å¿ƒå…³é—­äº†ã€‚ è¿™æ–‡ç« æ•´æŒºå¥½ï¼šhttps://blog.csdn.net/qzcsu/article/details/72861891 http å’Œ tcp çš„åŒºåˆ« tcp æ˜¯ä¼ è¾“å±‚åè®®ï¼Œhttpæ˜¯åº”ç”¨å±‚åè®®ï¼Œhttpåœ¨ä¼ è¾“å±‚å°±æ˜¯ä½¿ç”¨çš„ tcpã€‚ æ’åºç®—æ³•æœ‰å“ªäº› è¿™ä¸ªç®€å•ã€‚æ’åºç®—æ³•åˆ†ä¸ºæ¯”è¾ƒç®—æ³•å’Œéæ¯”è¾ƒç®—æ³•ï¼Œå…¶ä¸­æ¯”è¾ƒç®—æ³•åŒ…æ‹¬äº¤æ¢æ’åºã€Œå†’æ³¡å’Œå¿«æ’ã€ã€é€‰æ‹©æ’åºã€Œç®€å•é€‰æ‹©æ’åºå’Œå †æ’åºã€ã€æ’å…¥æ’åºã€Œç›´æ¥æ’å…¥æ’åºã€å¸Œå°”æ’åºã€ã€å½’å¹¶æ’åºã€ŒäºŒè·¯å½’å¹¶å’Œå¤šè·¯å½’å¹¶ã€ï¼Œéæ¯”è¾ƒæ’åºæœ‰è®¡æ•°æ’åºã€æ¡¶æ’åºã€åŸºæ•°æ’åºã€‚ ã€Œå…¬å¼ï¼š ä¸ç¨³å®šçš„æœ‰ï¼šå¿«äº›é€‰å †ã€ å†’æ³¡æ’åºã€‚ç¨³å®šçš„ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(nÂ²)ï¼Œæœ€å¥½æ—¶é—´å¤æ‚åº¦é‚£è‚¯å®šå°±æ˜¯ä¸€æ¬¡å¾ªç¯ O(n)ï¼Œæœ€åæ—¶é—´å¤æ‚åº¦ä¸º O(nÂ²)ã€‚ç©ºé—´å¤æ‚åº¦ O(1)ã€‚ å¿«é€Ÿæ’åºã€‚ä¸ç¨³å®šï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn)ï¼Œæœ€å¥½çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn)ï¼Œæœ€åå°±æ˜¯é€‰å®šçš„åŸºå‡†å€¼åœ¨æœ€è¾¹ä¸Šï¼Œè¿™æ ·å°±æ˜¯O(nÂ²)ï¼Œæ³¨æ„å“¦ï¼Œå¿«æ’çš„ç©ºé—´å¤æ‚åº¦å¹³å‡æ˜¯ O(logn)ï¼Œæœ€å·® O(n)ã€‚ ç®€å•é€‰æ‹©æ’åºã€‚ä¸ç¨³å®šï¼Œå¹³å‡ã€æœ€å¥½ã€æœ€åæ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(nÂ²)ã€‚ç©ºé—´å¤æ‚åº¦ O(1)ã€‚ å †æ’åºã€‚ä¸ç¨³å®šï¼Œå¹³å‡ã€æœ€å¥½ã€æœ€åçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn)ã€‚ç©ºé—´å¤æ‚åº¦ O(1)ã€‚ ç›´æ¥æ’å…¥æ’åºã€‚ç¨³å®šã€‚æœ€å¥½O(n)ï¼Œå¹³å‡ã€æœ€åæ—¶é—´å¤æ‚åº¦O(nÂ²)ã€‚ç©ºé—´å¤æ‚åº¦ O(1)ã€‚ å¸Œå°”æ’åºã€‚ä¸ç¨³å®šã€‚æœ€å¥½O(n)ï¼Œå¹³å‡O(n1.3)ï¼Œæœ€åè‚¯å®šæ˜¯O(nÂ²)ã€‚ç©ºé—´å¤æ‚åº¦O(1)ã€‚ å½’å¹¶æ’åºã€‚ç¨³å®šã€‚æœ€å¥½ã€æœ€åã€æœ€å·®æ—¶é—´å¤æ‚åº¦O(nlogn)ï¼Œç©ºé—´å¤æ‚åº¦O(n)ã€‚ è®¡æ•°æ’åºã€‚ç¨³å®šï¼Œç©ºé—´æ¢æ—¶é—´ã€‚é€‚åˆæ•°æ¯”è¾ƒé›†ä¸­åœ¨ä¸€èµ·çš„ï¼Œè¿™æ ·kå°±å°‘äº†ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n+k)ï¼Œç©ºé—´å¤æ‚åº¦ä¹Ÿä¸ºO(n+k)ã€‚ã€Œä¸ªäººè¿˜æ˜¯è§‰å¾—å…¶å®ç©ºé—´å¤æ‚åº¦ä¸ºO(k)ï¼Œå› ä¸ºæˆ‘å¯ä»¥æŠŠå€¼æ”¾å›å»çš„æ—¶å€™å¯ä»¥æ”¾åˆ°åŸæ•°ç»„ä¸Šï¼Œæ‰€ä»¥æ˜¯O(k)ã€‚ã€ æ¡¶æ’åºï¼Œæ¡¶è¶Šå¤šï¼Œæ—¶é—´å¤æ‚åº¦å¾ˆç®€å•ï¼Œä¸ºO(n+k)ï¼Œç©ºé—´å¤æ‚åº¦æœ€åä¸ºO(n+k)ï¼Œå…¶ä¸­ n æ˜¯å› ä¸ºæ¡¶å†…éƒ¨æ‰€æœ‰å…ƒç´ å¾—æ’åºï¼Œ k æ˜¯æŒ‡æ¡¶çš„æ•°é‡ã€‚ åŸºæ•°æ’åºï¼Œæ—¶é—´å¤æ‚åº¦O(n*k)ï¼Œkä¸ºæœ€å¤§æ•°çš„ä½æ•°ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(n)ã€‚ å †æ’åºçš„ç¨³å®šæ€§ï¼Œå¦‚ä½•å®ç°å †æ’åºï¼Œå…·ä½“ç»†èŠ‚ è¿™ä¸ªå¾ˆç®€å•ï¼Œå°±ä¸è¯¦ç»†è¯´äº†ã€‚ å½’å¹¶æ’åºçš„ç¨³å®šæ€§ï¼Œå¦‚ä½•å®ç°å½’å¹¶æ’åºï¼Œå…·ä½“ç»†èŠ‚ ç®€å•ã€‚ è¯´ä¸€ä¸‹jdkè‡ªå¸¦çš„æ’åºç”¨åˆ°äº†å“ªäº›æ’åºç®—æ³•ï¼Œå±•å¼€è®²ä¸€ä¸‹ Arrays.sort() &amp; Collections.sort() JDKä¸­çš„è‡ªå¸¦çš„æ’åºç®—æ³•å®ç°åŸç†ç²¾å½©æ€»ç»“ jdkå±‚é¢å®ç°çš„sortæ€»å…±æ˜¯ä¸¤ç±»ï¼Œä¸€ä¸ªæ˜¯ Arrays.sort()ï¼Œ Collections.sort()ï¼› Arrays.sort() å¦‚æœæ•°ç»„å†…å…ƒç´ æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæœ€ä¸»è¦é‡‡ç”¨çš„æ˜¯åŒè½´å¿«é€Ÿæ’åºã€Œå…¶å®å°±æ˜¯ä¸‰è·¯å¿«æ’ä¸€æ¨¡ä¸€æ ·çš„æ€è·¯ï¼Œåªä¸è¿‡ä¸‰è·¯å¿«æ’ä¸­é—´æ˜¯ = pivot1ï¼Œè€ŒåŒè½´å¿«é€Ÿæ’åºæ˜¯ï¼ˆpivot1ï¼Œpivot2ï¼‰ï¼Œå…·ä½“æˆ³é“¾æ¥ï¼šhttps://www.cnblogs.com/nullzx/p/5880191.html ã€‚ æ€»ç»“å°±æ˜¯æ•°ç»„é•¿åº¦å°äº47çš„æ—¶å€™æ˜¯ç”¨ç›´æ¥æ’å…¥ç®—æ³•ï¼Œå¤§äº47å¹¶ä¸”å°äº286æ˜¯é‡‡ç”¨åŒè½´å¿«é€Ÿæ’åºï¼Œå¤§äº286å¦‚æœè¿ç»­æ€§å¥½ã€Œä¹Ÿå°±æ˜¯å…ƒç´ å¤§å¤šæœ‰åºï¼Œæœ‰ä¸€ä¸ªflagä¸“é—¨ç”¨æ¥è®°å½•æ•°ç»„å…ƒç´ çš„å‡é™æ¬¡æ•°ï¼Œä»£è¡¨è¿™ä¸ªæ•°ç»„çš„è¿ç»­æ€§ã€é‡‡ç”¨çš„æ˜¯å½’å¹¶æ’åºï¼Œå¦åˆ™è¿˜æ˜¯ä¾æ—§é‡‡ç”¨åŒè½´å¿«é€Ÿæ’åºã€‚ å¦‚æœæ•°ç»„å†…å…ƒç´ æ˜¯å¯¹è±¡ï¼Œé‡‡ç”¨çš„æ˜¯TimSort.sort()ï¼Œè·Ÿ Collections.sort()ä¸€æ ·ï¼Œéƒ½æ˜¯é‡‡ç”¨çš„è¿™ä¸ªå‡½æ•°ï¼Œè¿™æ˜¯å½’å¹¶æ’åºç®—æ³•å’Œæ’å…¥æ’åºçš„ç»“åˆã€‚ Collections.sort()ï¼Œé‡‡ç”¨ TimSort.sort()ã€‚ TimSort.sort() å¤§æ¦‚åŸç†ï¼š å½“å¾…æ’åºå…ƒç´ å°äº32ä¸ªæ—¶ï¼Œé‡‡ç”¨äºŒåˆ†æ’å…¥æ’åºï¼Œæ˜¯æ’å…¥æ’åºçš„ä¸€ç§æ”¹è¿›ï¼Œå¯ä»¥å‡å°‘æ’å…¥æ’åºæ¯”è¾ƒçš„æ¬¡æ•°ã€‚å½“æ‰¾åˆ°æ’å…¥ä½ç½®æ—¶ï¼Œç›´æ¥åˆ©ç”¨System.copy()å‡½æ•°å³å¯ã€‚ å½“å¾…æ’åºå…ƒç´ å¤§äºç­‰äº32ä¸ªæ—¶ï¼Œè¿›è¡Œå½’å¹¶æ’åºï¼ˆå’Œä¼ ç»Ÿçš„å½’å¹¶ä¸ä¸€æ ·ï¼‰ï¼Œé¦–å…ˆå°†æ’åºå…ƒç´ åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºçš„å¤§å°åŒºé—´ä¸º[16,32)ï¼Œç„¶åä¾æ¬¡å¯¹æ¯ä¸ªåˆ†åŒºè¿›è¡Œæ’åºï¼ˆå…·ä½“å®ç°ä¾ç„¶æ˜¯äºŒåˆ†æ’å…¥æ’åºï¼‰ï¼Œæ’å®Œåºçš„åˆ†åŒºå‹å…¥æ ˆï¼ˆå‡†ç¡®çš„è¯´ä¸æ˜¯æ ˆï¼Œè€Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥è®°å½•æ’åºå¥½çš„åˆ†åŒºï¼‰ï¼Œå½“æ ˆå†…çš„åˆ†åŒºæ•°æ»¡è¶³æ¡ä»¶æ—¶ï¼Œè¿›è¡Œåˆ†åŒºåˆå¹¶ï¼Œåˆå¹¶ä¸ºä¸€ä¸ªæ›´å¤§çš„åˆ†åŒºï¼Œå½“æ ˆä¸­åªå‰©ä¸€ä¸ªåˆ†åŒºæ—¶ï¼Œæ’åºå®Œæˆã€‚ mysqlå¦‚ä½•ä¼˜åŒ– å»ºç´¢å¼• ç´¢å¼•çš„å»ºç«‹çš„åŸåˆ™æœ‰å“ªäº› é™¤äº†è¿ç”¨æœ€å·¦å‰ç¼€ã€ç´¢å¼•ä¸‹æ¨ã€è€ƒè™‘ç´¢å¼•é•¿åº¦ï¼Œè¿˜æœ‰å“ªäº›æ˜¯å»ºç«‹ç´¢å¼•éœ€è¦è€ƒè™‘çš„ ã€Œè¿™ä¸ªå®åœ¨æƒ³ä¸åˆ°äº†ã€ çº¢é»‘æ ‘å’Œå¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«ï¼Œå„è‡ªçš„ä¼˜åŠ¿ç‰¹ç‚¹ï¼Œä»¥åŠçº¢é»‘æ ‘å¦‚ä½•è¿›è¡Œæ·»åŠ æ•°æ®ã€Œå…·ä½“è¯´ä¸€ä¸‹æ—‹è½¬è¿‡ç¨‹ï¼Œæˆ‘åªè¯´äº†æˆ‘åšå®¢ä¸Šå†™äº†ï¼Œå…·ä½“çš„ç»™å¿˜äº†â€¦ã€ è¿™ä¸ªäºŒé¢çœŸå¾—å¤ä¹ å¤ä¹ ã€‚ javaæ–¹é¢ è®²ä¸€ä¸‹åŒäº²å§”æ´¾æ¨¡å‹ï¼Œä¸ºä»€ä¹ˆè¦è®¾è®¡åŒäº²å§”æ´¾æ¨¡å‹ åŒäº²å§”æ´¾æ¨¡å‹ï¼šä¸€ä¸ªç±»åŠ è½½å™¨åœ¨åŠ è½½ç±»æ—¶ï¼Œå…ˆæŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨å»æ‰§è¡Œï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨çˆ¶ç±»åŠ è½½å™¨ï¼Œå°±ç»§ç»­å‘ä¸Šå§”æ‰˜ï¼Œç›´åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ã€‚å¦‚æœçˆ¶ç±»åŠ è½½å™¨èƒ½å¤Ÿå®Œæˆç±»åŠ è½½ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½ï¼Œé‚£ä¹ˆå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚ å¥½å¤„ï¼šjavaç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ã€‚ è¿™ç§åŒäº²å§”æ´¾æ¨¡å¼çš„è®¾è®¡åŸå› ï¼šå¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½ï¼Œå¦å¤–ä¹Ÿé¿å…äº†javaçš„æ ¸å¿ƒAPIè¢«ç¯¡æ”¹ã€‚ è¿ååŒäº²å§”æ´¾æ¨¡å‹ï¼Œæˆ‘ä¸å°å¿ƒè¯´äº†jdbcï¼Œç„¶åé—®æˆ‘jdbcæ˜¯å¦‚ä½•è¿æ¥åˆ°æ•°æ®åº“çš„ï¼Œå…·ä½“æµç¨‹æ˜¯ä»€ä¹ˆï¼Œæˆ‘å°±è¯´äº†ä¸ªåå°„â€¦æ²¡å¤ä¹ åˆ°ä½ è§æˆ‘å†™çš„ ã€Šä»åŒäº²å§”æ´¾æ¨¡å‹åˆ°jdbcã€‹ è®²ä¸€ä¸‹jmmï¼Œä¸ºä½•è¿™æ ·è®¾è®¡ java memeory model ï¼Œjava å†…å­˜æ¨¡å‹ï¼Œè®¾è®¡çš„ç›®çš„æ˜¯å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿä¹‹é—´çš„å·®å¼‚æ€§ï¼Œå®ç°è®© Java åœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½èƒ½åˆ°ä¸€è‡´çš„å¹¶å‘æ•ˆæœã€‚jmm ä¸­ï¼Œåˆ†ä¸ºä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜ï¼Œå…¶ä¸­æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œè€Œä¸»å†…å­˜æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ã€‚è¿™é‡Œæˆ‘é‡åˆ°ç–‘é—®äº†ï¼Œåœ¨å‘¨å¿—åè€å¸ˆé‚£æœ¬ä¹¦ä¸­ï¼Œå…ˆæ˜¯è®²ä¸»å†…å­˜ä¸­å­˜å‚¨äº†æ‰€æœ‰çš„å˜é‡ï¼Œé‚£å¿…ç„¶å°±åŒ…æ‹¬äº†çº¿ç¨‹çš„å±€éƒ¨å˜é‡ï¼Œé‚£éš¾é“æˆ‘çº¿ç¨‹ä½¿ç”¨è‡ªå·±çš„å±€éƒ¨å˜é‡ï¼Œä¹Ÿè¦ä»ä¸»å†…å­˜ä¸­æ‹·è´ä¸€ä»½å‰¯æœ¬åˆ°å·¥ä½œå†…å­˜ä¸­å‘¢ï¼Ÿè¿™æ˜¯ä¸æ˜¯å’Œè¯´ä¸»å†…å­˜æ˜¯å…±äº«åŒºåŸŸäº§ç”Ÿäº†çŸ›ç›¾å‘¢ï¼Ÿä¹¦ä¸­è¿˜è¯´å¯ä»¥ç±»æ¯”ï¼Œä¸»å†…å­˜å°±æ˜¯è·Ÿå †å·®ä¸å¤šï¼Œè€Œå·¥ä½œå†…å­˜ç±»ä¼¼äºæ ˆï¼Œé‚£ä¹‹å‰è¯´çš„ä¸»å†…å­˜å­˜å‚¨äº†æ‰€æœ‰çš„å˜é‡ï¼Œè¿™å¥è¯æ˜¯ä¸æ˜¯æœ‰é—®é¢˜å‘¢ï¼Ÿä¸ªäººè§‰å¾—ä¸»å†…å­˜ä¸å¯èƒ½å­˜å‚¨æ‰€æœ‰çš„å˜é‡â€¦åº”è¯¥å°±æ˜¯ç±»ä¼¼äºå †å­˜å‚¨å…±äº«å˜é‡â€¦ ä¸ºä½•è¦æœ‰å·¥ä½œå†…å­˜ï¼Œæœ‰äº†ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜ä¸æ˜¯æ›´éº»çƒ¦å•Šï¼Œè¦ä¸æ–­çš„å¤åˆ¶ç§»åŠ¨æ•°æ®ï¼Œä¸ºä½•ä¸èƒ½ç›´æ¥å¯¹ä¸»å†…å­˜æ“ä½œã€Œè¿™ä¸ªä¹Ÿæ²¡ç­”ä¸Šæ¥ã€ è¿™å°±è·Ÿä¸ºä½•è¦æå‡ºå¯„å­˜å™¨å’Œç¼“å­˜ä¸€æ ·çš„é“ç†ï¼Œå¦‚æœæ‰€æœ‰çš„æ“ä½œéƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼Œé‚£é€Ÿåº¦å®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œåªæœ‰å·¥ä½œåœ¨å¯„å­˜å™¨å’Œç¼“å­˜ä¸­ï¼Œé€Ÿåº¦æ‰èƒ½è®©äººæ»¡æ„ï¼Œè€Œè¿™é‡Œçš„ä¸»å†…å­˜å°±ç±»æ¯”ä¸ºå†…å­˜ï¼Œå·¥ä½œå†…å­˜å°±ç±»æ¯”ä¸ºå¯„å­˜å™¨å’Œç¼“å­˜ã€‚ ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ ã€Œå¤šçº¿ç¨‹æ–¹é¢ä¸€ä¸ªé—®é¢˜éƒ½æ²¡é—®â€¦è¡€äºã€ å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªå¯¹è±¡ï¼Œæ— éœ€è€ƒè™‘ç¯å¢ƒå’Œé¢å¤–åŒæ­¥ï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºå°±èƒ½å¾—åˆ°æ­£ç¡®çš„ç­”æ¡ˆï¼Œå°±è¯´æ˜è¿™ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ä¸¾ä¸‰ä¸ªä¾‹å­åˆ†åˆ«æè¿° jmmçš„ä¸‰ä¸ªç‰¹æ€§ã€ŒåŸå­æ€§ã€æœ‰åºæ€§ã€å¯è§æ€§ã€å¯¼è‡´çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ ä¸éµå¾ªåŸå­æ€§ï¼švolatile å˜é‡çš„è‡ªåŠ ï¼Œå¤åˆæ“ä½œï¼Œå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ï¼› ä¸éµå¾ªæœ‰åºæ€§ï¼šæ¯”å¦‚å…±äº«å˜é‡ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œä¸æŒ‰åºï¼Œæ¯ä¸ªéƒ½æ‹·è´ä¸€ä»½åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå¿…ç„¶ä¼šå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ï¼› ä¸éµå¾ªå¯è§æ€§ï¼šæ™®é€šå˜é‡ï¼Œè·Ÿæœ‰åºæ€§ä¸€æ ·çš„ä¾‹å­ï¼Œæ¯ä¸ªéƒ½ä»ä¸»å†…å­˜æ‹·è´ä¸€ä»½å˜é‡çš„å‰¯æœ¬åˆ°å·¥ä½œå†…å­˜ï¼Œå¿…ç„¶ä¼šå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ã€‚ è®²ä¸€ä¸‹ RunTimeException çš„é€ æˆçš„åŸå› ã€Œéæ£€æŸ¥å‹å¼‚å¸¸ã€ï¼Œå¹¶è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆä¸å¤„ç† RunTimeExceptionï¼Ÿ RuntimeExceptionæ˜¯Exceptionå­ç±»ã€‚è€ŒExceptionè¿˜æœ‰å…¶å®ƒç±»å‹çš„å¼‚å¸¸ï¼Œæˆ‘ä»¬ç»Ÿä¸€ç§°ä¸ºéRuntimeå¼‚å¸¸ã€‚RuntimeExceptionçš„ç‰¹ç‚¹æ˜¯éæ£€æŸ¥å‹å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯Javaç³»ç»Ÿä¸­å…è®¸å¯ä»¥ä¸è¢«catchï¼Œåœ¨è¿è¡Œæ—¶æŠ›å‡ºã€‚è€Œå…¶å®ƒå®šéè¿è¡Œæ—¶å¼‚å¸¸å¦‚æœæŠ›å‡ºçš„è¯å¿…é¡»æ˜¾ç¤ºçš„catchï¼Œå¦åˆ™ç¼–è¯‘ä¸è¿‡ã€‚ RuntimeExceptionå¸¸è§å¼‚å¸¸ï¼š 1 NullPointerExceptionï¼Œç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ 2 NumberFormatExceptionï¼Œå­—ç¬¦ä¸²è½¬åŒ–æˆæ•°å­—æ—¶ã€‚ 3 ArrayIndexOutOfBoundsExceptionï¼Œ æ•°ç»„è¶Šç•Œæ—¶ã€‚ 4 StringIndexOutOfBoundsExceptionï¼Œ å­—ç¬¦ä¸²è¶Šç•Œæ—¶ã€‚ 5 ClassCastExceptionï¼Œç±»å‹è½¬æ¢æ—¶ã€‚ 6 UnsupportedOperationExceptionï¼Œè¯¥æ“ä½œä¸æ”¯æŒï¼Œä¸€èˆ¬å­ç±»ä¸å®ç°çˆ¶ç±»çš„æŸäº›æ–¹æ³•æ—¶ã€‚ 7 ArithmeticExceptionï¼Œé›¶ä½œä¸ºé™¤æ•°ç­‰ã€‚ 8 IllegalArgumentExceptionï¼Œè¡¨æ˜ä¼ é€’äº†ä¸€ä¸ªä¸åˆæ³•æˆ–ä¸æ­£ç¡®çš„å‚æ•° è¿è¡Œæ—¶å‡ºç°é”™è¯¯ï¼Œè¯´æ˜ä½ çš„ä»£ç æœ‰é—®é¢˜ï¼Œç¨‹åºå·²ç»æ— æ³•ç»§ç»­è¿è¡Œï¼Œæ‰€ä»¥å¯¹RuntimeExceptionçš„å¤„ç†æ—¶ä¸å¿…è¦çš„ã€‚ä¹‹æ‰€ä»¥ä¸å¤„ç†ï¼Œç›®çš„å°±æ˜¯è¦æ˜¯ç¨‹åºåœæ­¢ï¼Œä¿®æ­£ä»£ç ã€‚ é¡¹ç›® ä¸»è¦å°±é—®äº†ä¸‹æˆ‘æœ€è¿‘åœ¨åšä»€ä¹ˆé¡¹ç›®ï¼Œåˆ°ä»€ä¹ˆé˜¶æ®µäº†ï¼Œæœ‰å¤šå°‘äººç”¨ï¼› é—®æˆ‘çˆ¬è™«çš„å®ç°ã€Œé¢è¯•å®˜è²Œä¼¼æ²¡æœ‰åšè¿‡è¿™æ–¹é¢çš„ä¸œè¥¿ã€ æˆ‘æäº†ä¸€å˜´ xxl-jobï¼Œé¢è¯•å®˜åº”è¯¥ä¹Ÿæ²¡ç”¨è¿‡ï¼Œå°±æ²¡æœ‰æ·±ç©¶ï¼Œæœ¬æ¥è¿˜æƒ³è®²è®²kafkaçš„ï¼Œç»“æœç›´æ¥æ²¡é—®â€¦ç™½å‡†å¤‡äº† æœ€åå°±é—®äº†ä¸€ä¸ªå¾ˆå¸¸è§çš„ç®—æ³•é—®é¢˜ï¼š 256M çš„å†…å­˜å¦‚ä½•å¯¹ 16gçš„æ•°ç»„è¿›è¡Œæ’åº å¤šè·¯å½’å¹¶ï¼Œå› ä¸ºæ²¡è¦æ±‚å­˜å‚¨ï¼Œåªè¦æ±‚äº†å†…å­˜ï¼Œå¯ä»¥å¤šè·¯å½’å¹¶ï¼ŒåŠ å…¥æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ 1Mï¼Œåˆ™å¯ä»¥æœ€å¤šåˆ†æˆ 256 ç»„ï¼Œç„¶åè¿›è¡Œå½’å¹¶ã€‚ å…·ä½“æè¿°ï¼šé‡‡ç”¨å¤–éƒ¨æ’åºï¼Œå…ˆå°†16 gæ•°ç»„åˆ†æˆ 256 M ä¸€ç»„ï¼Œç„¶ååˆ†åˆ«è¯»å…¥å†…å­˜è¿›è¡Œå†…éƒ¨æ’åºã€Œæ¯”å¦‚è¯´å¯ä»¥ä½¿ç”¨å¿«æ’ã€ï¼Œå°†è¿™äº›ç»„å†…å…ƒç´ å…¨éƒ¨æ’å¥½åºä¹‹åï¼Œç„¶åè¿ç”¨è´¥è€…æ ‘å’Œç½®æ¢-é€‰æ‹©æ’åºï¼Œè¿›è¡Œå¤šè·¯å½’å¹¶ï¼Œå³å¯ã€‚ è¿™é‡Œå…¶å®å¯ä»¥å¼•ç”³å‡ºå¥½å¤šé—®é¢˜ï¼š æµ·é‡æ•°æ® æ±‚æœ€å¤§çš„ Kä¸ªæ•°é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ æŒ‰ä½åˆ’åˆ†åŒºåŸŸï¼Œå¯ä»¥å°½å¿«çš„ç¼©å°èŒƒå›´ï¼Œæ¯”å¦‚æœ€é«˜ä½ 0 åˆ†ä¸€å †ï¼Œ1 åˆ†æˆä¸€å †è€Œä¸”ä¸ç”¨æ’åºï¼Œè¿™æ˜¯ç¬¬ä¸€é€‰æ‹©ã€‚ æœ€ç»å…¸çš„æ–¹æ³•å½“ç„¶æ˜¯ å † äº†ï¼Œæ¯”å¦‚è¦æ±‚å‰1000ä¸ªæœ€å¤§çš„æ•°ï¼Œé‚£å°±ç›´æ¥å»ºä¸€ä¸ª 1000 å¤§å°çš„å°æ ¹å †ï¼Œç„¶åéå†ï¼Œåªè¦å‘ç°åé¢çš„æ•°æ¯”å°æ ¹å †çš„æ ¹èŠ‚ç‚¹å¤§ï¼Œå°±æŠŠæ ¹èŠ‚ç‚¹å’Œè¯¥æ•°äº¤æ¢ï¼Œé‡æ–°è°ƒæ•´å †ï¼Œéå†å®Œä¹‹åï¼Œå †ä¸­çš„æ•°è‡ªç„¶å°±æ˜¯æœ€å¤§çš„ 1000 ä¸ªæ•°äº†ï¼› å½“ç„¶èƒ½ä½¿ç”¨å †æ’åºçš„å‰ææ˜¯å†…å­˜ä¸­è¦èƒ½å¤Ÿæ”¾å¾—ä¸‹è¿™ä¸ª Kï¼Œå¦‚æœæ”¾ä¸ä¸‹å‘¢ï¼Ÿé‚£å°±åªèƒ½å¤–éƒ¨æ’åºäº†ï¼Œæ’åºå®Œä¹‹åæ‹¿åˆ°ç¬¬ K å¤§çš„æ•°å³å¯ï¼Œå½“ç„¶æ’åºå‰å¯ä»¥å’Œæ–¹æ³•ä¸€æ­é…ä¸€ä¸‹ã€‚ æµ·é‡æ•°æ®æ±‚ä¸­ä½æ•°ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ å¯ä»¥æŒ‰ç…§ä½æ¥åˆ†ç»„ï¼Œæ¯”å¦‚è¯´æœ€é«˜ä½æ˜¯0çš„ä¸€ç»„ï¼Œæ˜¯ 1 çš„ä¸€ç»„ï¼Œè¿™æ ·å¯ä»¥ç»Ÿè®¡å‡ºé‚£ä¸€ç»„æ›´å°‘ï¼Œè¿™æ ·å°±æ’é™¤äº†ä¸€å¤§åŠï¼Œç„¶åç»§ç»­è¿™æ ·æ’æŸ¥ï¼Œæœ€ç»ˆç¼©å°èŒƒå›´åç›´æ¥å†…éƒ¨æ’åºã€‚ ç›´æ¥å¤–éƒ¨æ’åºï¼Œç„¶åå–ä¸­é—´å€¼ï¼Œæœ€ç¬¨çš„æ–¹æ³•ã€‚ åœ¨æµ·é‡æ•°æ®ä¸­æ‰¾å‡ºå‡ºç°é¢‘ç‡æœ€é«˜çš„å‰kä¸ªæ•°ï¼Œä¾‹å¦‚ï¼Œåœ¨æœç´¢å¼•æ“ä¸­ï¼Œç»Ÿè®¡æœç´¢æœ€çƒ­é—¨çš„10ä¸ªæŸ¥è¯¢è¯ï¼›åœ¨æ­Œæ›²åº“ä¸­ç»Ÿè®¡ä¸‹è½½æœ€é«˜çš„å‰10é¦–æ­Œç­‰ã€‚ å¦‚æœé‡å¤ç‡å¾ˆé«˜ï¼Œå¯ä»¥é‡‡ç”¨å‰ç¼€æ ‘ï¼Œå› ä¸º trie æ ‘é€‚ç”¨äºæ•°æ®é‡å¤§ï¼Œé‡å¤å¤šï¼Œä½†æ˜¯æ•°æ®ç§ç±»å°å¿…é¡»å¾—å¯ä»¥æ”¾å…¥å†…å­˜ï¼› æŒ‰ç…§ hash è¿›è¡Œåˆ†ç»„ï¼Œè¿™æ ·å°±èƒ½é¿å…ç›¸åŒçš„æ•°åˆ†åˆ°ä¸åŒåŒºåŸŸå»äº†ï¼Œå¯¼è‡´ä¸å¥½ç»Ÿè®¡ã€‚hash åˆ†ç»„å®Œæ¯•åï¼Œç„¶åç”¨å‰ç¼€æ ‘ æˆ–è€… hashmap æ¥è®¡ç®—æ¯ä¸ªç»„çš„å‰ k ä¸ªé¢‘ç‡æœ€é«˜çš„æ•°ï¼Œæœ€åå¯¹å„ä¸ªç»„çš„å‰ k ä¸ªæ•°è¿›è¡Œç»Ÿè®¡å³å¯ã€‚ ç»™40äº¿ä¸ªä¸é‡å¤çš„unsigned intçš„æ•´æ•°ï¼Œæ²¡æ’è¿‡åºçš„ï¼Œç„¶åå†ç»™ä¸€ä¸ªæ•°ï¼Œå¦‚ä½•å¿«é€Ÿåˆ¤æ–­è¿™ä¸ªæ•°æ˜¯å¦åœ¨é‚£40äº¿ä¸ªæ•°å½“ä¸­ï¼Ÿ è¿™é‡Œæˆ‘ä»¬æŠŠ40äº¿ä¸ªæ•°ä¸­çš„æ¯ä¸€ä¸ªç”¨32ä½çš„äºŒè¿›åˆ¶æ¥è¡¨ç¤ºå‡è®¾è¿™40äº¿ä¸ªæ•°å¼€å§‹æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ ç„¶åå°†è¿™40äº¿ä¸ªæ•°åˆ†æˆä¸¤ç±»: 1.æœ€é«˜ä½ä¸º0 2.æœ€é«˜ä½ä¸º1 å¹¶å°†è¿™ä¸¤ç±»åˆ†åˆ«å†™å…¥åˆ°ä¸¤ä¸ªæ–‡ä»¶ä¸­ï¼Œå…¶ä¸­ä¸€ä¸ªæ–‡ä»¶ä¸­æ•°çš„ä¸ªæ•°&lt;=20äº¿ï¼Œè€Œå¦ä¸€ä¸ª&gt;=20äº¿ï¼ˆè¿™ç›¸å½“äºæŠ˜åŠäº†ï¼‰ï¼›ä¸è¦æŸ¥æ‰¾çš„æ•°çš„æœ€é«˜ä½æ¯”è¾ƒå¹¶æ¥ç€è¿›å…¥ç›¸åº”çš„æ–‡ä»¶å†æŸ¥æ‰¾ å†ç„¶åæŠŠè¿™ä¸ªæ–‡ä»¶ä¸ºåˆåˆ†æˆä¸¤ç±»: 1.æ¬¡æœ€é«˜ä½ä¸º0 2.æ¬¡æœ€é«˜ä½ä¸º1 å¹¶å°†è¿™ä¸¤ç±»åˆ†åˆ«å†™å…¥åˆ°ä¸¤ä¸ªæ–‡ä»¶ä¸­ï¼Œå…¶ä¸­ä¸€ä¸ªæ–‡ä»¶ä¸­æ•°çš„ä¸ªæ•°&lt;=10äº¿ï¼Œè€Œå¦ä¸€ä¸ª&gt;=10äº¿ï¼ˆè¿™ç›¸å½“äºæŠ˜åŠäº†ï¼‰ï¼› ä¸è¦æŸ¥æ‰¾çš„æ•°çš„æ¬¡æœ€é«˜ä½æ¯”è¾ƒå¹¶æ¥ç€è¿›å…¥ç›¸åº”çš„æ–‡ä»¶å†æŸ¥æ‰¾ã€‚ â€¦â€¦. ä»¥æ­¤ç±»æ¨ï¼Œå°±å¯ä»¥æ‰¾åˆ°äº†,è€Œä¸”æ—¶é—´å¤æ‚åº¦ä¸ºO(logn)ã€‚ å¤§æ¦‚ç»Ÿè®¡ä¸€ä¸‹ï¼Œæµ·é‡æ•°æ®æ±‚ TopK çš„æ™®éæ–¹æ³•ï¼š æœ€å¿«çš„ä¸éœ€è¦æ’åºå°±èƒ½æ’é™¤ä¸€å¤§å †çš„æ•°æ®çš„æ–¹æ³•å°±æ˜¯çœ‹ â€œä½â€ï¼Œæ¯”å¦‚æœ€é«˜ä½ä¸º 0 çš„åˆ†ä¸€å—ï¼Œä¸º 1 çš„åˆ†ä¸€å—ï¼Œè¿™æ ·è¿…é€Ÿå°±åˆ†å‡ºä¸€å¤§å—ä¸éœ€è¦çš„äº†ï¼Œå°¤å…¶é€‚åˆæ‰¾ä¸­ä½æ•°ï¼Œç­‰åˆ†çš„å·®ä¸å¤šäº†å°±å¯ä»¥è¿›è¡Œå†…éƒ¨æ’åºäº†ã€‚ å †æ’åºï¼Œé€‚ç”¨äºæ±‚æµ·é‡æ•°æ®æœ€å¤§ K or æœ€å°çš„ K ä¸ªæ•°ï¼› åˆ†æ²»hashï¼Œé€‚ç”¨äºé‚£äº›å†…å­˜å¾ˆå°ï¼Œæ•°æ®å¾ˆå¤§ï¼Œä½†æ˜¯åˆæƒ³æ±‚æœ€å¤§çš„ K ä¸ªä¼—æ•°çš„é—®é¢˜ï¼Œå¯ä»¥å…ˆ hash åˆ°å¾ˆå¤šä¸ªç»„ï¼Œç„¶ååœ¨ç»„å†…éƒ¨ä½¿ç”¨ hashmap æˆ–è€… å‰ç¼€æ ‘ ã€Œgoogleç­‰å­—ç¬¦ã€ï¼Œå–åˆ°ç»„å†…å‰ K ä¸ªä¼—æ•°ï¼Œæœ€åè¿›è¡Œç»„é—´æ¯”è¾ƒä¹…okayäº†ï¼› å½“ç„¶ä¸èƒ½å¿˜äº†ä¸‡èƒ½æ³•ï¼Œé‚£å°±æ˜¯å¤–éƒ¨æ’åºï¼Œç„¶åå†è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ æœ€åçš„æœ€åï¼Œè®©æˆ‘ä»¬å†æ¥åšä¸ªé™„åŠ é¢˜ï¼š å…ˆæ¥çœ‹å‡ ä¸ªæ¯”è¾ƒå¸¸è§çš„ä¾‹å­ å­—å¤„ç†è½¯ä»¶ä¸­ï¼Œéœ€è¦æ£€æŸ¥ä¸€ä¸ªè‹±è¯­å•è¯æ˜¯å¦æ‹¼å†™æ­£ç¡® åœ¨ FBIï¼Œä¸€ä¸ªå«Œç–‘äººçš„åå­—æ˜¯å¦å·²ç»åœ¨å«Œç–‘åå•ä¸Š åœ¨ç½‘ç»œçˆ¬è™«é‡Œï¼Œä¸€ä¸ªç½‘å€æ˜¯å¦è¢«è®¿é—®è¿‡ yahoo, gmailç­‰é‚®ç®±åƒåœ¾é‚®ä»¶è¿‡æ»¤åŠŸèƒ½ è¿™å‡ ä¸ªä¾‹å­æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼š å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Ÿ è¿™é‡Œå¿…é¡»ä»‹ç»ä¸€ä¸‹ bitmap è¿™ä¸ªæ–¹æ³•äº†ï¼Œä¾‹å¦‚æˆ‘è¦ä»æµ·é‡æ•°æ®ä¸­æ‰¾ä¸€ä¸ªæ•°æ˜¯å¦å‡ºç°è¿‡ï¼Œå°±å¯ä»¥ç”¨ä½å›¾çš„æ€è·¯å»åšï¼Œå¦‚æœæ•°å­—æ˜¯ 7 ï¼Œé‚£å°±åœ¨ç¬¬ 7 ä½ ç½® 1ï¼Œå¦‚æœè¯¥ä½ç½®å·²ç»æ˜¯ 1 äº†ï¼Œé‚£å°±ä»£è¡¨å‡ºç°è¿‡ï¼Œä¸ç”¨æ›´æ”¹ã€‚ å¦‚æœé—®é¢˜å˜ä¸ºä»æµ·é‡æ•°æ®ä¸­æ‰¾ä¸€ä¸ªæ•°æ˜¯å¦å‡ºç°è¿‡ä¸€æ¬¡ï¼Œé‚£è¿™ä¸ªæ—¶å€™å°±å¾—ç”¨ 2 bitmap æ¥è¡¨ç¤ºäº†ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ•°å¦‚æœå‡ºç°ä¸€æ¬¡ï¼Œç½®ä¸º 01 ï¼Œå‡ºç°è¿‡ä¸¤æ¬¡ï¼Œç½®ä¸º 10ï¼Œç„¶åå†å‡ºç°ï¼Œéƒ½æ˜¯10ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬åªç”¨ä¸€ä½ï¼Œæ˜¯ä¸èƒ½è¡¨ç¤ºå‡ºå‡ºç°çš„æ¬¡æ•°çš„ã€‚ è‡³äºæˆ‘ä»¬å¸¸è¯´çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå…¶å®ä¹Ÿå°±æ˜¯åœ¨bitmapä¹‹å‰è¿›è¡Œä¸€ä¸ªhashï¼Œä¾‹å¦‚å°†å­—ç¬¦ä¸²è¿›è¡Œhashæˆæ•°ç»„ï¼Œç„¶åä½¿ç”¨ä½å›¾ï¼Œè§£å†³è¿™ç±»é—®é¢˜ã€‚ 2020.3.18 09:28 - 11:12 ã€Œ105 åˆ†é’Ÿã€ è…¾è®¯ä¸€é¢è§†é¢‘é¢ã€‚æœ¬æ¬¡é¢è¯•åˆ†ä¸ºä¸¤å¤§å—ï¼š ç‰›å®¢ç½‘å†™ä»£ç  ã€ŒLeetCode easyéš¾åº¦ã€ï¼Œè¿™ä¸ªé˜¶æ®µå¤§æ¦‚ 5-10 åˆ†é’Ÿ 123456789101112131415161718192021ç¿»è½¬æ•°åˆ—å°Qå®šä¹‰äº†ä¸€ç§æ•°åˆ—ç§°ä¸ºç¿»è½¬æ•°åˆ—:ç»™å®šæ•´æ•°nå’Œm, æ»¡è¶³nèƒ½è¢«2mæ•´é™¤ã€‚å¯¹äºä¸€ä¸²è¿ç»­é€’å¢æ•´æ•°æ•°åˆ—1, 2, 3, 4..., æ¯éš”mä¸ªç¬¦å·ç¿»è½¬ä¸€æ¬¡, æœ€åˆç¬¦å·ä¸º'-';ã€‚ä¾‹å¦‚n = 8, m = 2, æ•°åˆ—å°±æ˜¯: -1, -2, +3, +4, -5, -6, +7, +8.è€Œn = 4, m = 1, æ•°åˆ—å°±æ˜¯: -1, +2, -3, + 4.å°Qç°åœ¨å¸Œæœ›ä½ èƒ½å¸®ä»–ç®—ç®—å‰né¡¹å’Œä¸ºå¤šå°‘ã€‚è¾“å…¥æè¿°è¾“å…¥åŒ…æ‹¬ä¸¤ä¸ªæ•´æ•°nå’Œm(2 &lt;= n &lt;= 109, 1 &lt;= m), å¹¶ä¸”æ»¡è¶³nèƒ½è¢«2mæ•´é™¤ã€‚è¾“å‡ºæè¿°è¾“å‡ºä¸€ä¸ªæ•´æ•°, è¡¨ç¤ºå‰né¡¹å’Œã€‚ç¤ºä¾‹1è¾“å…¥8 2è¾“å‡º8 æ­£å¼è¿›å…¥é¢è¯• ã€Œ100åˆ†é’Ÿã€ è…¾è®¯çœ‹æ¥çš„ç¡®å…¨éƒ¨æ˜¯ c++ï¼Œé¢è¯•å®˜ä¹Ÿæ˜¯è¯´åŸºæœ¬ä¸Šéƒ½æ˜¯ c++ï¼Œæ²¡æœ‰ä¸“é—¨æ java çš„ç»„ï¼Œæ‰€ä»¥å¤§å®¶ java æŠ•è…¾è®¯è¿˜æ˜¯åŠ¡å¿…æ…é‡ï¼Œæœ€å¼€å§‹é—®æˆ‘çš„æŠ€æœ¯æ ˆæ˜¯ä»€ä¹ˆï¼Œc++æ˜¯å¦äº†è§£ï¼Œç”¨çš„æ¯”è¾ƒå¤šï¼Ÿå¾—çŸ¥æˆ‘è¯´åŸºæœ¬æ²¡å’‹ç”¨è¿‡ä¹‹åï¼Œå°±å¼€å§‹å°è¯•é—®è®¡ç®—æœºç½‘ç»œæ–¹é¢çš„é—®é¢˜ã€‚ é—®çš„å¾ˆæ·±å…¥ï¼Œæ¯”å¦‚è¯´ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹ï¼Œå®¢æˆ·ç«¯æœåŠ¡å™¨ç«¯å„è‡ªçš„çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Œå¯¹æ•´ä¸ªå»ºç«‹è¿æ¥å’Œå…³é—­è¿æ¥çš„å…·ä½“æµç¨‹æ˜¯ä»€ä¹ˆï¼Œæ·±å…¥åˆ° OSI æ¨¡å‹å»è®²ï¼› è¿™ä¸ªæˆ‘åœ¨ä¸Šé¢å·²ç»è¯¦ç»†è¯´è¿‡äº†â€¦ ç„¶åä¸»è¦é—®çš„æ˜¯ Socket ç¼–ç¨‹ï¼Œè®²å¥—æ¥å­—ç¼–ç¨‹çš„å…·ä½“å®ç°æµç¨‹ï¼Œä»£ç å¦‚ä½•å†™ï¼Œå¦‚ä½•å®ç°ç±»ä¼¼äº Nginx çš„å¤šæœåŠ¡å™¨çš„ Socket ç¼–ç¨‹ï¼› ç„¶åè°ˆåˆ° selectã€epollç­‰ç›¸å…³ c++ çš„çŸ¥è¯†ï¼Œæˆ‘æ˜¯åœ¨ java å±‚é¢å»è®²çš„å¦‚ä½•å®ç°çš„ ã€ŒNIOã€ï¼› â€‹ å˜¿å˜¿å˜¿ï¼Œè¿™ä¸ªæ²¡é—®é¢˜äº†ï¼Œå¯ä»¥çœ‹æˆ‘çš„æœ€æ–°çš„æ–‡ç«  â€”ã€Šé›¶æ‹·è´åŠå…¶å‘¨è¾¹ã€‹ å†è€…å°±æ˜¯èŠåˆ°æ•°æ®åº“ï¼Œè¿™ä¸ªæ˜¯å¿…é—®çš„ï¼Œé—®æˆ‘ç´¢å¼•å¦‚ä½•å»ºç«‹ã€å¦‚ä½•ä¼˜åŒ–ç´¢å¼•ï¼Œç„¶åæ˜¯ä¸€äº›å…·ä½“é—®é¢˜å¯¹ç´¢å¼•çš„åˆ†æï¼› ç”¨ key or index å»ºç«‹ç´¢å¼•ï¼Œä¼˜åŒ–ç´¢å¼•çš„æ–¹æ³•ï¼šå°½é‡å¤ç”¨ç´¢å¼•ï¼Œåˆ©ç”¨å¥½æœ€å·¦å‰ç¼€å’Œç´¢å¼•ä¸‹æ¨åŸåˆ™ï¼Œå°½é‡å‡å°‘å›è¡¨æ¬¡æ•°ï¼Œåˆ©ç”¨è¦†ç›–ç´¢å¼•ã€‚ ç„¶åè°ˆåˆ°äº‹åŠ¡çš„å››ä¸ªç‰¹æ€§ï¼Œå¦‚ä½•å®ç°åŸå­æ€§ã€éš”ç¦»æ€§ã€ä¸€è‡´æ€§ã€æŒä¹…æ€§çš„ï¼Œå†…éƒ¨æœºåˆ¶å…·ä½“å¦‚ä½•å®ç°ï¼› åŸå­æ€§ï¼šåˆ©ç”¨ undologï¼Œå›æ»šæœºåˆ¶ï¼Œå®Œæˆè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼› éš”ç¦»æ€§ï¼šä¸»è¦æ˜¯é ä¸€è‡´æ€§è§†å›¾+å½“å‰è¡Œçš„ row_id_transactionï¼Œæ¥å®Œæˆçš„ã€‚ ä¸€è‡´æ€§ï¼šä¸»è¦é åŠ é”é˜²æ­¢äº‹åŠ¡å†²çªï¼Œä¸€è‡´æ€§æ˜¯å¦å¤–ä¸‰ä¸ªçš„é¡¶å±‚ï¼Œåªè¦ä»–ä»¬ä¸‰å®Œæˆäº†ä»–æ‰æœ‰å¯èƒ½å®Œæˆï¼Œè¿˜æœ‰mvccçš„åŠ æŒï¼Œä»¥åŠ undologã€redologã€‚ æŒä¹…æ€§ï¼šredologä¿è¯crash-safeï¼Œbin-logä¿è¯å½’æ¡£ã€‚ å€Ÿæ­¤è°ˆåˆ° undologã€redologã€binlogï¼Œä»¥åŠ mvcc çš„å®ç°ï¼› ç•¥ Redolog åˆ°åº•æ˜¯ä¿å­˜åœ¨ç£ç›˜ä¸­çš„è¿˜æ˜¯åœ¨å†…å­˜ä¸­ï¼Ÿ redo logåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šä¸€æ˜¯å†…å­˜ä¸­çš„æ—¥å¿—ç¼“å†²(redo log buffer)ï¼Œè¯¥éƒ¨åˆ†æ—¥å¿—æ˜¯æ˜“å¤±æ€§çš„ï¼›äºŒæ˜¯ç£ç›˜ä¸Šçš„é‡åšæ—¥å¿—æ–‡ä»¶(redo log file)ï¼Œè¯¥éƒ¨åˆ†æ—¥å¿—æ˜¯æŒä¹…çš„ã€‚ è¯¦ç»†åˆ†æ Mysql ä¸­çš„ä¸‰ä¸ªæ—¥å¿—ï¼šredologã€undologã€binlog è°ˆä¸€è°ˆ mysql çš„è¿è¡Œæœºåˆ¶ï¼Œæ•´ä¸ªè¿è¡Œè¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Œå¦‚ä½•å¤„ç†çš„ï¼› è¿™ä¸ªç®€å•ï¼Œç•¥ mysqlçš„ç´¢å¼•å®ç°ï¼ŒB+çš„ä¼˜ç‚¹ç­‰ç­‰ï¼› ç®€å•ï¼Œç•¥ å…¨ç¨‹è°ˆ ä¸€è‡´æ€§é—®é¢˜ è°ˆçš„å¾ˆå¤šï¼ŒåŒ…æ‹¬äº† mysql ä¸»ä»å¤åˆ¶çš„ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Œæˆ‘è¯´ä¸å¤ªæ¸…æ¥šï¼Œä½†æ˜¯å€Ÿæ­¤è®²äº† kafka ä¸­çš„é«˜å¯ç”¨æœºåˆ¶ã€ŒISRã€ï¼Œä»¥åŠ kafkaä¸­çš„ ack æœºåˆ¶å’Œ kafka ä¸­çš„æ¶ˆæ¯è¯­ä¹‰ã€Œå¦‚ä½•ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€ï¼› Mysql ä¿è¯ä¸»ä»ä¸€è‡´æ€§ï¼š ä¸»åº“æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„æ›´æ–°è¯·æ±‚åï¼Œæ‰§è¡Œå†…éƒ¨äº‹åŠ¡çš„æ›´æ–°é€»è¾‘ï¼ŒåŒæ—¶å†™binlogã€‚ å¤‡åº“Bè·Ÿä¸»åº“Aä¹‹é—´ç»´æŒäº†ä¸€ä¸ªé•¿è¿æ¥ã€‚ä¸»åº“Aå†…éƒ¨æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸“é—¨ç”¨äºæœåŠ¡å¤‡åº“Bçš„è¿™ä¸ªé•¿è¿æ¥ã€‚ä¸€ä¸ªäº‹åŠ¡æ—¥å¿—åŒæ­¥çš„å®Œæ•´è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š åœ¨å¤‡åº“Bä¸Šé€šè¿‡change masterå‘½ä»¤ï¼Œè®¾ç½®ä¸»åº“Açš„IPã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ï¼Œä»¥åŠè¦ä»å“ªä¸ªä½ç½®å¼€å§‹è¯·æ±‚binlogï¼Œè¿™ä¸ªä½ç½®åŒ…å«æ–‡ä»¶åå’Œæ—¥å¿—åç§»é‡ã€‚ åœ¨å¤‡åº“Bä¸Šæ‰§è¡Œstart slaveå‘½ä»¤ï¼Œè¿™æ—¶å€™å¤‡åº“ä¼šå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯å›¾ä¸­çš„io_threadå’Œsql_threadã€‚å…¶ä¸­io_threadè´Ÿè´£ä¸ä¸»åº“å»ºç«‹è¿æ¥ã€‚ ä¸»åº“Aæ ¡éªŒå®Œç”¨æˆ·åã€å¯†ç åï¼Œå¼€å§‹æŒ‰ç…§å¤‡åº“Bä¼ è¿‡æ¥çš„ä½ç½®ï¼Œä»æœ¬åœ°è¯»å–binlogï¼Œå‘ç»™Bã€‚ å¤‡åº“Bæ‹¿åˆ°binlogåï¼Œå†™åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œç§°ä¸ºä¸­è½¬æ—¥å¿—ï¼ˆrelay logï¼‰ã€‚ sql_threadè¯»å–ä¸­è½¬æ—¥å¿—ï¼Œè§£æå‡ºæ—¥å¿—é‡Œçš„å‘½ä»¤ï¼Œå¹¶æ‰§è¡Œã€‚ è¿™é‡Œéœ€è¦è¯´æ˜ï¼Œåæ¥ç”±äºå¤šçº¿ç¨‹å¤åˆ¶æ–¹æ¡ˆçš„å¼•å…¥ï¼Œsql_threadæ¼”åŒ–æˆä¸ºäº†å¤šä¸ªçº¿ç¨‹ã€‚ å› ä¸ºè¯­è¨€ä¸Šè¿˜æ˜¯æœ‰å¾ˆå¤šåŒºåˆ«çš„ï¼Œåœ¨åé¢åˆé—®äº†å‡ ä¸ªæœ‰å…³äº c++ çš„é—®é¢˜ï¼Œç­”å¾—ä¸æ˜¯å¾ˆå¥½ è™šå‡½æ•°æ˜¯ä»€ä¹ˆ ã€Œæ²¡ç­”ä¸Šæ¥ã€ï¼› ç•¥ã€‚ å› ä¸ºçœ‹åˆ°æˆ‘åšå®¢æœ‰äº›æ»‘åŠ¨çª—å£ç®—æ³•ï¼Œå°±é—®äº† tcp æ»‘åŠ¨çª—å£åº•å±‚çš„ä»£ç å®ç°ï¼› è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹çš„åŒºåˆ«ï¼Œæˆ‘è¯´å®Œä¹‹åï¼Œåˆå»¶ä¼¸åˆ°çº¿ç¨‹æ˜¯å¦‚ä½•ä¿è¯åŒæ­¥çš„ï¼Œå€Ÿæ­¤è°ˆåˆ°äº†çº¿ç¨‹å®‰å…¨ï¼Œç„¶åæˆ‘è‡ªå·±æ‹“å±•äº† synchronizedã€Œè¯¦ç»†ä»‹ç»äº†é”å‡çº§è¿‡ç¨‹ã€ã€lockä½“ç³»ã€CAS çš„å®ç°ä»¥åŠ final å…³é”®å­—å’Œ ThreadLocalï¼› åç¨‹çš„åº”ç”¨åœºæ™¯ä¸»è¦åœ¨äº ï¼šI/O å¯†é›†å‹ä»»åŠ¡ã€‚ è¿™ä¸€ç‚¹ä¸å¤šçº¿ç¨‹æœ‰äº›ç±»ä¼¼ï¼Œä½†åç¨‹è°ƒç”¨æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹å†…è¿›è¡Œçš„ï¼Œæ˜¯å•çº¿ç¨‹ï¼Œåˆ‡æ¢çš„å¼€é”€å°ï¼Œå› æ­¤æ•ˆç‡ä¸Šç•¥é«˜äºå¤šçº¿ç¨‹ã€‚å½“ç¨‹åºåœ¨æ‰§è¡Œ I/O æ—¶æ“ä½œæ—¶ï¼ŒCPU æ˜¯ç©ºé—²çš„ï¼Œæ­¤æ—¶å¯ä»¥å……åˆ†åˆ©ç”¨ CPU çš„æ—¶é—´ç‰‡æ¥å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚åœ¨å•çº¿ç¨‹ä¸­ï¼Œä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œä¸€èˆ¬æ˜¯ä»å‡½æ•°çš„ç¬¬ä¸€è¡Œä»£ç å¼€å§‹æ‰§è¡Œï¼Œç»“æŸäº return è¯­å¥ã€å¼‚å¸¸æˆ–è€…å‡½æ•°æ‰§è¡Œï¼ˆä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯éšå¼åœ°è¿”å›äº† None ï¼‰ã€‚ æœ‰äº†åç¨‹ï¼Œæˆ‘ä»¬åœ¨å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°äº†è€—æ—¶çš„ I/O æ“ä½œï¼Œå‡½æ•°å¯ä»¥ä¸´æ—¶è®©å‡ºæ§åˆ¶æƒï¼Œè®© CPU æ‰§è¡Œå…¶ä»–å‡½æ•°ï¼Œç­‰ I/O æ“ä½œæ‰§è¡Œå®Œæ¯•ä»¥åå†æ”¶å›æ§åˆ¶æƒã€‚ ç®€å•æ¥è®²åç¨‹çš„å¥½å¤„ï¼š è·¨å¹³å° è·¨ä½“ç³»æ¶æ„ æ— éœ€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ æ— éœ€åŸå­æ“ä½œé”å®šåŠåŒæ­¥çš„å¼€é”€ æ–¹ä¾¿åˆ‡æ¢æ§åˆ¶æµï¼Œç®€åŒ–ç¼–ç¨‹æ¨¡å‹ é«˜å¹¶å‘+é«˜æ‰©å±•æ€§+ä½æˆæœ¬ï¼šä¸€ä¸ªCPUæ”¯æŒä¸Šä¸‡çš„åç¨‹éƒ½ä¸æ˜¯é—®é¢˜ã€‚æ‰€ä»¥å¾ˆé€‚åˆç”¨äºé«˜å¹¶å‘å¤„ç†ã€‚ ç¼ºç‚¹ï¼š æ— æ³•åˆ©ç”¨å¤šæ ¸èµ„æºï¼šåç¨‹çš„æœ¬è´¨æ˜¯ä¸ªå•çº¿ç¨‹,å®ƒä¸èƒ½åŒæ—¶å°† å•ä¸ªCPU çš„å¤šä¸ªæ ¸ç”¨ä¸Š,åç¨‹éœ€è¦å’Œè¿›ç¨‹é…åˆæ‰èƒ½è¿è¡Œåœ¨å¤šCPUä¸Š.å½“ç„¶æˆ‘ä»¬æ—¥å¸¸æ‰€ç¼–å†™çš„ç»å¤§éƒ¨åˆ†åº”ç”¨éƒ½æ²¡æœ‰è¿™ä¸ªå¿…è¦ï¼Œé™¤éæ˜¯cpuå¯†é›†å‹åº”ç”¨ã€‚ è¿›è¡Œé˜»å¡ï¼ˆBlockingï¼‰æ“ä½œï¼ˆå¦‚IOæ—¶ï¼‰ä¼šé˜»å¡æ‰æ•´ä¸ªç¨‹åºï¼šè¿™ä¸€ç‚¹å’Œäº‹ä»¶é©±åŠ¨ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥IOæ“ä½œæ¥è§£å†³ æœ€åå†è´´ä¸ªå›¾æ¥æ€»ç»“ä¸€ä¸‹ï¼Œæ›´æ¸…æ¥šï¼š ä½œè€…ï¼šç¨‹åºçŒ¿æ‚è´§é“ºé“¾æ¥ï¼šhttps://juejin.im/post/5d5df6b35188252ae10bdf42æ¥æºï¼šæ˜é‡‘è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ è¿›è¡Œé—´é€šä¿¡ IPC æœ‰å“ªäº›æ–¹å¼ã€Œæˆ‘åªè¯´äº†ä¿¡å·é‡ã€å…±äº«åŒºåŸŸã€ç®¡é“è¿™å‡ ä¸ªï¼Œé¢è¯•å®˜ä¹Ÿæ²¡è¿½é—®ã€ ç®¡é“ã€‚ç®¡é“çš„å®è´¨æ˜¯ä¸€ä¸ªå†…æ ¸ç¼“å†²åŒºï¼Œè¿›ç¨‹ä»¥å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼ä»ç¼“å†²åŒºå­˜å–æ•°æ®ï¼Œç®¡é“ä¸€ç«¯çš„è¿›è¡Œé¡ºåºçš„å°†è¿›ç¨‹æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œå¦ä¸€ç«¯çš„è¿›åˆ™é¡ºåºåœ°è¯»å–æ•°æ®ï¼Œè¯¥ç¼“å†²åŒºå¯ä»¥çœ‹åšä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—ï¼Œè¯»å’Œå†™çš„ä½ç½®éƒ½æ˜¯è‡ªåŠ¨å¢åŠ çš„ï¼Œä¸€ä¸ªæ•°æ®åªèƒ½è¢«è¯»ä¸€æ¬¡ï¼Œè¯»å‡ºä»¥ååœ¨ç¼“å†²åŒºå°±ä¸å¤å­˜åœ¨äº†ã€‚å½“ç¼“å†²åŒºè¯»ç©ºæˆ–è€…å†™æ»¡æ—¶ï¼Œæœ‰ä¸€å®šçš„è§„åˆ™æ§åˆ¶ç›¸åº”çš„è¯»è¿›ç¨‹æˆ–å†™è¿›ç¨‹æ˜¯å¦è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå½“ç©ºçš„ç¼“å†²åŒºæœ‰æ–°æ•°æ®å†™å…¥æˆ–æ»¡çš„ç¼“å†²åŒºæœ‰æ•°æ®è¯»å‡ºæ—¶ï¼Œå°±å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ç»§ç»­è¯»å†™ã€‚ç®¡é“æ˜¯ä¸€ç§åŠåŒå·¥é€šä¿¡æ–¹å¼ï¼Œæ•°æ®åªèƒ½å•å‘æµåŠ¨ã€‚éœ€è¦è¿›è¡Œé€šä¿¡æ—¶ï¼Œéœ€è¦å»ºç«‹2ä¸ªç®¡é“ã€‚ ä¿¡å·é‡ã€‚è¿›ç¨‹ä¹‹é—´é€šä¿¡çš„æœºåˆ¶ï¼Œä¾‹å¦‚ Semphore ï¼Ÿ å…±äº«å†…å­˜ã€‚è¿›ç¨‹çš„ä¸åŒè™šæ‹Ÿå†…å­˜æ˜ å°„åˆ°ç”¨ä¸€ä¸ªç‰©ç†å†…å­˜ä¸Šï¼Œå®ç°å…±äº«ã€‚ å†…å­˜æ³„éœ²é—®é¢˜å¦‚ä½•æ’æŸ¥ï¼Œä¸»è¦é—®linuxå¦‚ä½•è¿›è¡Œæ’æŸ¥ã€Œæ²¡ç­”ä¸Šæ¥ï¼Œå°±è¯´å¯ä»¥ç”¨å¯è§†åŒ–ç•Œé¢ã€ å†…å­˜æ³„éœ²ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Œç³»ç»Ÿä¼šå‡æ­»å—ï¼Ÿ æœ€åè°ˆäº†è°ˆä¸€äº›æ•°æ®ç»“æ„å’Œç®—æ³•ï¼š ä¸¤ä¸ªå †å¦‚ä½•å®ç°é˜Ÿåˆ—ã€Œè²Œä¼¼å †ä¸å°±æ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—å˜›â€¦ã€ï¼Œä¸¤ä¸ªé˜Ÿåˆ—å¦‚ä½•å®ç°å †ï¼›ã€Œé¢è¯•å®˜è¡¨è¿°ä¸æ¸…æ¥šï¼Œå¯èƒ½å°±æ˜¯æƒ³æŒ‡å †æ ˆï¼Ÿï¼Ÿï¼Ÿã€ ä¸¤ä¸ªæ ˆå¦‚ä½•å®ç°é˜Ÿåˆ—ï¼Œä¸¤ä¸ªé˜Ÿåˆ—å¦‚ä½•å®ç°æ ˆï¼› é“¾è¡¨å¦‚ä½•æŸ¥æ‰¾æ˜¯å¦æœ‰ç¯ï¼› é“¾è¡¨å¦‚ä½•ç¡®å®šç¯çš„èµ·ç‚¹ï¼› ä¸¤æ¡é“¾è¡¨æ‰¾å…¬å…±å¤„çš„èµ·ç‚¹ã€‚ è¿˜æœ‰ä¸€äº›ç»†ææœ«èŠ‚çš„é—®é¢˜ï¼Œå°è±¡å·²ç»ä¸æ·±äº†ï¼Œå¤§æ¦‚å°±æ˜¯è¿™äº›å§ã€‚ æ€»ç»“ä¸€ä¸‹ï¼šé¢è¯•å®˜éå¸¸æ“…é•¿æŒ–æ˜é¢è¯•è€…çš„ä¼˜åŠ¿ï¼Œå¯¹é¢è¯•è€…ä¸å¤ªæ‡‚çš„å…¨éƒ¨ä¸é—®ï¼ŒåŸºæœ¬ä¸Šæˆ‘ä¼šä»€ä¹ˆå°±é—®ä»€ä¹ˆï¼Œæ‰€ä»¥å¤§æ¦‚é¢è¯•äº†åŠå°æ—¶åï¼Œå°±å¼€å§‹å¯¹ç€æˆ‘çš„åšå®¢é—®ï¼Œæ‰€ä»¥æ•´ä½“ä¸Šç»™äººçš„æ„Ÿè§‰æ˜¯å¾ˆå¥½çš„ã€‚å¤§å®¶å¦‚æœè¦é¢è…¾è®¯çš„è¯å»ºè®®å¤šçœ‹çœ‹c++ï¼Œå¹¶ä¸”å¯¹å¸¸è§çš„ è®¡ç½‘ å’Œ os çš„é—®é¢˜å°½é‡å¾€æ·±å¤„èµ°ï¼Œé¢è¯•å®˜åªçœ‹ä¸­ä½ å¯¹é—®é¢˜çš„æ·±åº¦ï¼Œä¸ä¼šçš„é—®é¢˜ä»–ä¸ä¼šè¿½é—®ã€‚ æœ€å¤§çš„æ”¶è·ï¼š é¢è¯•å®˜å¯¹è‡ªå·±æ–¹æ–¹é¢é¢çš„å»ºè®®ã€‚å¹¶ä¸”ç»™è‡ªå·±æ¨èäº†ä¸‰æœ¬ä¹¦ã€Šunixç½‘ç»œç¼–ç¨‹å·ä¸€ã€‹ã€Šunixç½‘ç»œç¼–ç¨‹å·äºŒã€‹ã€Šlinuxå†…æ ¸ã€‹ éƒ¨åˆ†æ‹“å±• è¾“å…¥ www.taobao.com åå‘ç”Ÿäº†ä»€ä¹ˆ å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è®¿é—® www.taobao.comï¼Œå®¢æˆ·ç«¯ã€Œæµè§ˆå™¨ã€ä¼šé¦–å…ˆå» dns æœåŠ¡å™¨æŸ¥æ‰¾å¯¹åº”çš„ipï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è®¿é—® è¿™ä¸ªç½‘ç«™ï¼Œé‚£ä¹ˆé¦–å…ˆä¼šå»èµ° http åè®®ï¼Œå®¢æˆ·ç«¯ã€Œæµè§ˆå™¨ã€å’ŒæœåŠ¡å™¨çš„ 80 ç«¯å£è¿›è¡Œ tcp è¿æ¥ï¼Œç„¶å æœåŠ¡å™¨ 80 ç«¯å£ä¼šè¿”å›ä¸€ä¸ª 301/302ã€Œå…·ä½“åŒºåˆ«ä¸‹æ–‡ä¼šè®²ã€é‡å®šå‘ï¼Œåœ¨æœåŠ¡å™¨å“åº”å¤´ä¸­è¿˜ä¼šæ·»åŠ  HTTP-Strict-Transport-Securityï¼Œé‡Œé¢æœ‰ max-ageï¼Œç”¨æˆ·è®¿é—®æ—¶ï¼ŒæœåŠ¡å™¨ç§ä¸‹è¿™ä¸ªå¤´ï¼Œä¸‹æ¬¡å¦‚æœä½¿ç”¨ http è®¿é—®ï¼Œåªè¦ max-age æœªè¿‡æœŸã€Œå®¢æˆ·ç«¯æ£€éªŒã€ï¼Œå®¢æˆ·ç«¯ä¼šè¿›è¡Œå†…éƒ¨è·³è½¬ï¼Œå¯ä»¥çœ‹åˆ° 307 Redirect Internel çš„å“åº”ç ã€‚ç„¶åå°±ç›´æ¥å˜æˆå’Œ 443 ç«¯å£å»ºç«‹è¿æ¥ï¼Œèµ° https è¿æ¥ã€‚ å¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œé‚£åœ¨æ‹¿åˆ°ipä¹‹åå®¢æˆ·ç«¯ç›´æ¥æ ¡éªŒè‡ªå·±çš„ max-ageå­—æ®µï¼Œå¦‚æœæ²¡è¿‡æœŸç›´æ¥ 307 å†…éƒ¨è·³è½¬ï¼Œç›´æ¥å’ŒæœåŠ¡å™¨çš„ 443 ç«¯å£è¿›è¡Œ https çš„è¿æ¥äº†ã€‚å‰©ä¸‹çš„å°±æ˜¯httpsçš„è¿‡ç¨‹äº†ã€‚ ä½œè€…ï¼šèœ—ç‰›çš„åŒ—ææ˜Ÿä¹‹æ—…é“¾æ¥ï¼šhttps://juejin.im/post/5d8a34ea6fb9a04dfa09561bæ¥æºï¼šæ˜é‡‘è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚å‘Šè¯‰æˆ‘ä»¬éœ€è¦å»ºç«‹ https 301ã€302ã€307çš„åŒºåˆ« 301é‡å®šå‘æ˜¯æ°¸ä¹…çš„é‡å®šå‘ï¼Œæœç´¢å¼•æ“åœ¨æŠ“å–æ–°çš„å†…å®¹çš„åŒæ—¶ä¹Ÿå°†æ—§çš„ç½‘å€æ›¿æ¢ä¸ºäº†é‡å®šå‘ä¹‹åçš„ç½‘å€ã€‚ 302é‡å®šå‘åªæ˜¯æš‚æ—¶çš„é‡å®šå‘ï¼Œæœç´¢å¼•æ“ä¼šæŠ“å–æ–°çš„å†…å®¹è€Œä¿ç•™æ—§çš„åœ°å€ï¼Œå› ä¸ºæœåŠ¡å™¨è¿”å›302ï¼Œæ‰€ä»¥ï¼Œæœç´¢æœç´¢å¼•æ“è®¤ä¸ºæ–°çš„ç½‘å€æ˜¯æš‚æ—¶çš„ã€‚æ‰€ä»¥302ï¼Œä¼šå¯¼è‡´åŠ«æŒé—®é¢˜ï¼šAç«™é€šè¿‡é‡å®šå‘åˆ°Bç«™çš„èµ„æºxxooï¼ŒAç«™å®é™…ä¸Šä»€ä¹ˆéƒ½æ²¡åšä½†æ˜¯æœ‰ä¸€ä¸ªæ¯”è¾ƒå‹å¥½çš„åŸŸåï¼Œwebèµ„æºxxooå­˜åœ¨Bç«™å¹¶ç”±Bç«™æä¾›ï¼Œä½†æ˜¯Bç«™çš„åŸŸåä¸é‚£ä¹ˆå‹å¥½ï¼Œå› æ­¤å¯¹æœç´¢å¼•æ“è€Œè¨€ï¼Œå¯èƒ½ä¼šä¿å­˜Aç«™çš„åœ°å€å¯¹åº”xxooèµ„æºè€Œä¸æ˜¯Bç«™ï¼Œè¿™å°±æ„å‘³ç€Bç«™å‡ºäº†èµ„æºç‰ˆæƒã€å¸¦å®½ã€æœåŠ¡å™¨çš„é’±ï¼Œä½†æ˜¯ç”¨æˆ·é€šè¿‡æœç´¢å¼•æ“æœç´¢xxooèµ„æºçš„æ—¶å€™å‡ºæ¥çš„æ˜¯Aç«™ï¼ŒAç«™ä»€ä¹ˆéƒ½æ²¡åšå´è¢«ç´¢æœå¼•æ“å¹¿è€Œå‘Šä¹‹ç”¨æˆ·ï¼ŒBç«™åšäº†ä¸€åˆ‡å´ä¸è¢«ç”¨æˆ·çŸ¥é“ï¼Œä»·å€¼è¢«Aç«™çªƒå–äº†ã€‚è¿™é‡Œ A å°±ç›¸å½“äºæ˜¯æˆ‘ä»¬åœ¨è¾“å…¥æ¡†è¾“å…¥çš„åŸŸåï¼Œç„¶åå¯¹ B é‡å®šå‘ 302ï¼Œå¯¼è‡´è‡ªå·±çš„åŸŸåä¸ä¼šè¢«æ›¿æ¢å´è¿˜äº«ç”¨ B çš„èµ„æºã€‚ 307æ„æ€å°±æ˜¯å®¢æˆ·ç«¯å†…éƒ¨è‡ªå·±åšäº†é‡å®šå‘ï¼Œå°±æ¯”å¦‚ www.baidu.com ï¼Œæˆ‘åœ¨æœ‰äº† HSTS çš„ max-age ä¹‹åä¼šè‡ªåŠ¨ä» http://www.baidu.com è·³è½¬åˆ° https://www.baidu.comã€‚ https çš„å½¢æˆè¿‡ç¨‹ åœ¨ä¼ è¾“å±‚å’Œåº”ç”¨å±‚ä¸­é—´æœ‰ä¸ª ssl/tls å±‚ æµç¨‹ï¼š éªŒè¯è¿‡ç¨‹ã€Œå…·ä½“æµç¨‹ï¼šhttps://www.jianshu.com/p/b0b6b88fe9feã€ å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼‰å…ˆå‘æœåŠ¡å™¨å‘å‡ºåŠ å¯†é€šä¿¡çš„è¯·æ±‚ï¼Œä¸æœåŠ¡å™¨çš„443ç«¯å£å»ºç«‹è¿æ¥ï¼› æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚,ç„¶åå“åº”ï¼Œç¡®è®¤åŠ å¯†æ–¹æ³•ï¼Œå¦‚ RSAéå¯¹ç§°åŠ å¯†ï¼Œç„¶åå°†æœåŠ¡å™¨çš„è¯ä¹¦å‘è¿‡å»ï¼› å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œç„¶åä½¿ç”¨å…¬é’¥åŠ å¯†å‘é€æ¶ˆæ¯ï¼› æœåŠ¡å™¨ç”¨ç§é’¥è§£å¯†ï¼Œå¾—åˆ°æ˜æ–‡ã€‚ æ­£å¸¸ä¼ è¾“ è·Ÿæ­£å¸¸çš„httpä¼ è¾“ä¸€è‡´ï¼Œåªä¸è¿‡æ˜¯å¯†æ–‡ä¼ è¾“ã€‚ å¯¹ç§°åŠ å¯†ç®—æ³•å’Œéå¯¹ç§°åŠ å¯†ç®—æ³•çš„åŒºåˆ« https://blog.csdn.net/u013320868/article/details/54090295 å¯¹ç§°åŠ å¯†ï¼ŒåŠ å¯†è§£å¯†æ—¶é—´æ›´å¿«ï¼Œä½†æ˜¯å¯†é’¥ç®¡ç†æ˜¯ä¸ªå¤§é—®é¢˜ï¼› éå¯¹ç§°åŠ å¯†ï¼Œæ›´å®‰å…¨ï¼Œä½†æ˜¯åŠ å¯†è§£å¯†æ—¶é—´è¾ƒé•¿ä¸€äº›ã€‚ RSA ç®—æ³•æµç¨‹ https://zhuanlan.zhihu.com/p/44185847 ä¹‹æ‰€ä»¥éš¾è§£ï¼Œæ˜¯å› ä¸ºä½æ•°å¾ˆé•¿ï¼Œå¹¶ä¸”å»å¯¹ä¸€ä¸ªè¶…çº§å¤§çš„æ•°è¿›è¡Œå› å¼åˆ†è§£ï¼Œå¦‚æœæ²¡æœ‰ç§é’¥çš„è¯å‡ ä¹ä¸å¯èƒ½åšåˆ°ã€‚ ä¸»è¦ç”¨åˆ°çš„æ•°å­¦çŸ¥è¯†æœ‰æ¬§æ‹‰å‡½æ•°ã€è´¹é©¬å°å®šç†ç­‰ç­‰ Mysql çš„é«˜å¯ç”¨æœºåˆ¶æ˜¯å¦‚ä½•å®ç°çš„ è§ä¸‹é¢å†™çš„ğŸ‘‡ 2020.3.26 16:00 - 17:00 ã€Œ60 åˆ†é’Ÿã€ ç¾å›¢ä¸€é¢ç”µè¯é¢ã€‚ è·Ÿå‰ä¸¤é¢é£æ ¼å®Œå…¨ä¸ä¸€æ ·ï¼ å…ˆé—®æˆ‘å­¦è¿‡ä»€ä¹ˆç§‘ç›®ï¼Ÿ æˆ‘è¯´è®¡ç®—æœºç½‘ç»œã€æ“ä½œç³»ç»Ÿã€ç¼–è¯‘åŸç†ã€æ•°æ®ç»“æ„ã€è®¡ç®—æœºç»„æˆåŸç†ã€æ•°æ®åº“ç­‰ç­‰ï¼› å¯¹ä»€ä¹ˆç§‘ç›®æ„Ÿå…´è¶£ï¼Ÿ æˆ‘è¯´è®¡ç®—æœºç½‘ç»œå§ ä¸ºä»€ä¹ˆå–œæ¬¢è¿™é—¨è¯¾ï¼Ÿ æˆ‘è¯´å› ä¸ºä¸Šè¯¾å¬å¾—æ‡‚ï¼Œè¿™é—¨è¯¾çš„ä½“ç³»ä¹Ÿæ¯”è¾ƒæ¸…æ™°ï¼Œåˆ†å±‚æ¥å­¦ï¼Œå¾ªåºæ¸è¿›ï¼Œåˆ†æ•°è€ƒå¾—é«˜ï¼Œæœ‰æˆå°±æ„Ÿæ‰€ä»¥å°±å–œæ¬¢äº†ã€‚ è¿™é—¨è¯¾æœ‰å“ªäº›è®©ä½ è®°å¿†æ·±åˆ»çš„åœ°æ–¹ï¼Ÿ æˆ‘è¯´ tcpã€ipå§ï¼Œtcp æ¯”è¾ƒè®°å¿†æ·±åˆ»å› ä¸ºä»–å¾ˆé‡è¦ï¼Œå‡ºç°çš„åœ°æ–¹æ¯”è¾ƒå¤šï¼Œipçš„è¯åº”è¯¥æˆ‘ä»¬ç°å®ç”Ÿæ´»ä¸­ä¹Ÿæ€»æ˜¯æèµ·ï¼Œæ‰€ä»¥è®°å¿†æ¯”è¾ƒæ·±åˆ»ä¸€äº›ã€‚ é‚£æˆ‘ä»¬ç°å®ä¸­è¯´åˆ°çš„ ip å’Œ ä½ è¿™é‡Œçš„ ip æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ æˆ‘è¯´ä¸€ä¸ªæ˜¯ ip åè®®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®šä¹‰IPåœ°å€æ ¼å¼ï¼Œæ•°æ®åŒ…çš„æ ¼å¼ï¼Œåˆ†ç»„è½¬å‘è§„åˆ™ï¼Œè€Œæˆ‘ä»¬ç°å®ä¸­çš„ ipï¼Œæ˜¯æŒ‡çš„ ip åœ°å€ï¼Œè¿™æ˜¯ä¸»æœºåœ¨ç½‘ç»œä¸­çš„æ ‡è¯†ï¼Œä¸€èˆ¬æˆ‘ä»¬æ¥è§¦çš„éƒ½æ˜¯ IPv4ï¼Œå³ 32 ä½çš„åœ°å€ã€‚ é‚£ä½ è®²è®² IPV4 æœ‰ä»€ä¹ˆå§ ã€Œæˆ‘è‡ªå·±åŠ çš„é—®é¢˜ã€ IPv4 åˆ†ä¸ºç½‘ç»œå·å’Œä¸»æœºå·ï¼Œç½‘ç»œå·å°±æ˜¯ä¸»æœºæˆ–è€…è·¯ç”±å™¨æ‰€è¿æ¥åˆ°çš„ç½‘ç»œçš„æ ‡è¯†ï¼Œä¸»æœºå·å°±æ˜¯ä¸»æœºæˆ–è€…è·¯ç”±å™¨åœ¨è¿™ä¸ªç½‘ç»œå†…çš„æ ‡è¯†ã€‚ æ—¢ç„¶è°ˆåˆ°äº†è·¯ç”±å™¨ï¼Œé‚£è·¯ç”±å™¨æœ‰ ip åœ°å€å—ï¼Œè·¯ç”±å™¨åˆæœ‰ä»€ä¹ˆåŠŸèƒ½å‘¢ï¼Ÿ è·¯ç”±å™¨è‚¯å®šæ˜¯æœ‰ ip åœ°å€çš„ï¼Œå¹¶ä¸”è·¯ç”±å™¨æ€»æ˜¯æœ‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„ ip åœ°å€ï¼Œè·¯ç”±å™¨çš„æ¯ä¸€ä¸ªç«¯å£éƒ½æœ‰ä¸€ä¸ªä¸åŒç½‘ç»œå·çš„ ip åœ°å€ï¼Œå› ä¸ºè·¯ç”±å™¨æœ€ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯åˆ†ç»„è½¬å‘è·¯ç”±ï¼Œé€šè¿‡è·¯ç”±è¡¨å¯¹æŠ¥æ–‡è¿›è¡Œç›¸åº”çš„è½¬å‘ã€‚ é‚£ç½‘å…³åˆæ˜¯ä»€ä¹ˆï¼Ÿå’Œè·¯ç”±å™¨æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ è¿™ä¸ªçœŸçš„éš¾â€¦å¹³æ—¶è¿˜çœŸä¸ä¼šå»æ€è€ƒè¿™äº›é—®é¢˜â€¦ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè·¯ç”±å™¨å…¶å®å°±æ˜¯å®ç°äº†ç½‘å…³çš„åŠŸèƒ½ï¼Œç½‘å…³æ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ç½‘ç»œçš„å‡ºå£å’Œå…¥å£ã€Œç½‘ç»œè¾¹ç•Œã€ï¼Œè€Œè·¯ç”±å™¨åˆ™æ˜¯ä¸€ä¸ªç‰©ç†æ¦‚å¿µï¼Œå®ç°äº†ç½‘å…³çš„åŠŸèƒ½ï¼Œæ˜¯ä¸åŒç½‘å…³çš„æ²Ÿé€šæ¡¥æ¢å’Œç‰©ç†åŸºç¡€ã€‚ ä½ è¯´çš„ ip åè®®æ˜¯ä»€ä¹ˆï¼Ÿå±äºå“ªä¸€å±‚ï¼Ÿ æˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„åè®®æ˜¯ IPv4 åè®®ï¼Œå±äºç½‘ç»œå±‚ã€‚ ä»‹ç»ä¸€ä¸‹ IPv4 åè®®æœ‰å“ªäº›å†…å®¹ï¼Œç„¶åè¯´è¯´ç½‘ç»œå±‚çš„ä¸€äº›å…¶ä»–åè®®å§ï¼Ÿ é¦–éƒ¨å›ºå®š20å­—èŠ‚ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ï¼Œé¦–éƒ¨é•¿åº¦ï¼Œæºåœ°å€ï¼Œç›®çš„åœ°å€ç­‰ç­‰ã€‚ ç½‘ç»œå±‚çš„å…¶ä»–åè®®åŒ…æ‹¬ ARPã€Œåœ°å€è§£æåè®®ï¼Œç”¨äºIPåœ°å€å’ŒMACåœ°å€çš„æ˜ å°„ã€ã€NATã€Œç½‘ç»œåœ°å€è½¬æ¢ï¼Œå¯¹å¤–éšè—å†…éƒ¨çš„ ipã€ã€ICMPã€Œç½‘ç»œæŠ¥æ–‡æ§åˆ¶åè®®ï¼Œå…è®¸ä¸»æœºå’Œè·¯ç”±å™¨æŠ¥å‘Šå·®é”™å’Œå¼‚å¸¸æƒ…å†µã€ã€CIDRã€Œå­ç½‘åˆ’åˆ†åè®®ï¼Œæ— åˆ†ç±»åŸŸé—´è·¯ç”±é€‰æ‹©ï¼Œæ²¡æœ‰å­ç½‘æ¦‚å¿µï¼Œä½†æ˜¯æœ‰ç”¨å­ç½‘æ©ç ã€ è¿˜è¦ DHCPï¼Œä¸è¿‡è¿™ä¸ªæ˜¯åº”ç”¨å±‚åè®®ï¼ŒåŸºäº UDPï¼Œç”¨äºç»™ä¸»æœºåŠ¨æ€åˆ†é… IP åœ°å€ï¼Œæˆ‘ä»¬çš„ç¬”è®°æœ¬çªç„¶æ¥å…¥ wifi è·å¾—çš„ IP å°±æ˜¯ DHCP åè®®è·å–çš„ã€‚ ç¬¬ä¸€æ®µè½å‘Šç»ˆï¼Œå› ä¸ºæˆ‘å®åœ¨æ˜¯å¬ä¸æ¸…å¯¹é¢é¢è¯•å®˜è¯´è¯ï¼Œå£°éŸ³å¤ªä½äº†ï¼Œå¹¶ä¸”ç”±äºä»–ä½¿ç”¨çš„å…¬å¸çš„ vpnï¼Œå‹æ ¹å¬ä¸æ¸…â€¦æˆ‘æ‰€æœ‰çš„æ³¨æ„åŠ›åŸºæœ¬ä¸Šéƒ½é›†ä¸­åœ¨å¬ä»–è¯´è¯ä¸Šäº†â€¦æ ¹æœ¬æ²¡å¿ƒæ€æ€è€ƒé—®é¢˜â€¦è«åçš„ç´§å¼ â€¦ ç„¶åä»–æ¢äº†ç”µè¯æ‰“è¿‡æ¥ï¼Œç»ˆäºå¬å¾—æ¸…æ¥šäº†ï¼Œä¹Ÿç»ˆäºä¸ç”¨å°½å…¨åŠ›å¬ä»–è®²è¯äº†ï¼Œäºæ˜¯å°±ä¸ç´§å¼ äº†ï¼Œç„¶åæˆ‘ä»¬å°±ç»§ç»­èŠäº†ä¸‹å»ã€‚ é™¤äº†è®¡ç®—æœºç½‘ç»œï¼Œè¿˜å¯¹å“ªé—¨è¯¾ç¨‹æ¯”è¾ƒæœ‰å°è±¡ï¼Ÿ æ•°æ®åº“å§ï¼Œè‡ªå·±å› ä¸ºåšé¡¹ç›®ä¹Ÿä¸€ç›´æœ‰ç”¨ã€‚ é‚£ä½ å¹³æ—¶ç”¨çš„æ˜¯ä»€ä¹ˆæ•°æ®åº“ï¼Ÿ Mysqlã€mongodb è¿™ä¸¤ä¸ªæ•°æ®åº“æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ä¸€ä¸ªæ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œä¸€ä¸ªæ˜¯éå…³ç³»å‹æ•°æ®åº“ã€‚ é‚£ä»€ä¹ˆæ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œä»€ä¹ˆæ˜¯éå…³ç³»å‹æ•°æ®åº“ï¼Ÿä¸ºä»€ä¹ˆè¦åˆ†æˆè¿™ä¸¤ç§æ•°æ®åº“å‘¢ï¼Ÿå„è‡ªçš„ä¼˜åŠ¿å’Œä½¿ç”¨åœºæ™¯åœ¨å“ªå‘¢ï¼Ÿ å…³ç³»å‹æ•°æ®åº“æŒ‡é‡‡ç”¨äº†å…³ç³»æ¨¡å‹æ¥ç»„ç»‡æ•°æ®çš„æ•°æ®åº“ï¼Œå…³ç³»æ¨¡å‹å¯ä»¥ç®€å•çš„ç†è§£ä¸ºä¸€ä¸ªäºŒç»´è¡¨ï¼Œæ‰€ä»¥é‡Œé¢çš„å­—æ®µåç§°å’Œå­—æ®µç±»å‹éƒ½æ˜¯åœ¨å»ºè¡¨çš„æ—¶å€™å°±ç¡®å®šå¥½äº†çš„ï¼› éå…³ç³»å‹æ•°æ®åº“åˆ™æ˜¯ç»“æ„ä¸å›ºå®šï¼Œé›†åˆå†…æ•°æ®å­—æ®µå¯ä»¥ä¸ä¸€æ ·ï¼Œæ•°æ®æ¯”è¾ƒæ¾æ•£ï¼Œä¸€èˆ¬ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨ï¼Œæ¯”å¦‚ä¸€èˆ¬éƒ½æ˜¯jsonæ•°æ®ç›´æ¥å­˜å‚¨ã€‚ é€‚åˆä½¿ç”¨SQLå¼€å‘çš„é¡¹ç›®ï¼š å¯ä»¥é¢„å…ˆå®šä¹‰é€»è¾‘ç›¸å…³çš„ç¦»æ•£æ•°æ®çš„éœ€æ±‚ æ•°æ®ä¸€è‡´æ€§æ˜¯å¿…è¦çš„{acid} å…·æœ‰è‰¯å¥½çš„å¼€å‘è€…ç»éªŒå’ŒæŠ€æœ¯æ”¯æŒçš„æ ‡å‡†çš„æˆç†ŸæŠ€æœ¯ é€‚åˆä½¿ç”¨NoSQLå¼€å‘çš„é¡¹ç›®ï¼š ä¸ç›¸å…³ï¼Œä¸ç¡®å®šå’Œé€æ­¥å‘å±•çš„æ•°æ®éœ€æ±‚ æ›´ç®€å•æˆ–è€…æ›´å®½æ¾çš„èƒ½å¤Ÿå¿«é€Ÿå¼€å§‹ç¼–ç¨‹çš„é¡¹ç›® é€Ÿåº¦å’Œå¯æ‰©å±•æ€§è‡³å…³é‡è¦çš„ éå…³ç³»å‹æ•°æ®åº“çš„ä¼˜åŠ¿ï¼š æ€§èƒ½NOSQLæ˜¯åŸºäºé”®å€¼å¯¹çš„ï¼Œå¯ä»¥æƒ³è±¡æˆè¡¨ä¸­çš„ä¸»é”®å’Œå€¼çš„å¯¹åº”å…³ç³»ï¼Œè€Œä¸”ä¸éœ€è¦ç»è¿‡SQLå±‚çš„è§£æï¼Œæ‰€ä»¥æ€§èƒ½éå¸¸é«˜ã€‚ å¯æ‰©å±•æ€§åŒæ ·ä¹Ÿæ˜¯å› ä¸ºåŸºäºé”®å€¼å¯¹ï¼Œæ•°æ®ä¹‹é—´æ²¡æœ‰è€¦åˆæ€§ï¼Œæ‰€ä»¥éå¸¸å®¹æ˜“æ°´å¹³æ‰©å±•ã€‚ å…³ç³»å‹æ•°æ®åº“çš„ä¼˜åŠ¿ï¼š å¤æ‚æŸ¥è¯¢å¯ä»¥ç”¨SQLè¯­å¥æ–¹ä¾¿çš„åœ¨ä¸€ä¸ªè¡¨ä»¥åŠå¤šä¸ªè¡¨ä¹‹é—´åšéå¸¸å¤æ‚çš„æ•°æ®æŸ¥è¯¢ã€‚ äº‹åŠ¡æ”¯æŒä½¿å¾—å¯¹äºå®‰å…¨æ€§èƒ½å¾ˆé«˜çš„æ•°æ®è®¿é—®è¦æ±‚å¾—ä»¥å®ç°ã€‚ å¯¹äºè¿™ä¸¤ç±»æ•°æ®åº“ï¼Œå¯¹æ–¹çš„ä¼˜åŠ¿å°±æ˜¯è‡ªå·±çš„å¼±åŠ¿ï¼Œåä¹‹äº¦ç„¶ã€‚ ä½†æ˜¯è¿‘å¹´æ¥è¿™ä¸¤ç§æ•°æ®åº“éƒ½åœ¨å‘ç€å¦å¤–ä¸€ä¸ªæ–¹å‘è¿›åŒ–ã€‚ä¾‹å¦‚ï¼šNOSQLæ•°æ®åº“æ…¢æ…¢å¼€å§‹å…·å¤‡SQLæ•°æ®åº“çš„ä¸€äº›å¤æ‚æŸ¥è¯¢åŠŸèƒ½çš„é›å½¢ï¼Œæ¯”å¦‚Couchbaseçš„indexä»¥åŠMONGOçš„å¤æ‚æŸ¥è¯¢ã€‚å¯¹äºäº‹åŠ¡çš„æ”¯æŒä¹Ÿå¯ä»¥ç”¨ä¸€äº›ç³»ç»Ÿçº§çš„åŸå­æ“ä½œæ¥å®ç°ä¾‹å¦‚ä¹è§‚é”ä¹‹ç±»çš„æ–¹æ³•æ¥æ›²çº¿æ•‘å›½ã€‚SQLæ•°æ®åº“ä¹Ÿå¼€å§‹æ…¢æ…¢è¿›åŒ–ï¼Œæ¯”å¦‚HandlerSockeræŠ€æœ¯çš„å®ç°ï¼Œå¯ä»¥åœ¨MYSQLä¸Šå®ç°å¯¹äºSQLå±‚çš„ç©¿é€ï¼Œç”¨NOSQLçš„æ–¹å¼è®¿é—®æ•°æ®åº“ï¼Œæ€§èƒ½å¯ä»¥ä¸Šå¯ä»¥è¾¾åˆ°ç”šè‡³è¶…è¶ŠNOSQLæ•°æ®åº“ã€‚å¯æ‰©å±•æ€§ä¸Šä¾‹å¦‚Percona Serverï¼Œå¯ä»¥å®ç°æ— ä¸­å¿ƒåŒ–çš„é›†ç¾¤ã€‚ è™½ç„¶è¿™ä¸¤æéƒ½å› ä¸ºå„è‡ªçš„å¼±åŠ¿è€Œå¼€å§‹è¿›åŒ–å‡ºå¦ä¸€æçš„ä¸€äº›ç‰¹æ€§ï¼Œä½†æ˜¯è¿™äº›ç‰¹æ€§çš„å¢åŠ ä¹Ÿä¼šæ¶ˆå¼±å…¶æœ¬æ¥å…·å¤‡çš„ä¼˜åŠ¿ï¼Œæ¯”å¦‚Couchbaseä¸Šçš„indexçš„å¢åŠ ä¼šé€æ­¥é™ä½æ•°æ®åº“çš„è¯»å†™æ€§èƒ½ã€‚æ‰€ä»¥æ€æ ·æ„å»ºç³»ç»Ÿçš„çŸ­æœŸå’Œé•¿æœŸå­˜å‚¨ç­–ç•¥ï¼Œç”¨å¥½ä»–ä»¬å„è‡ªçš„å¼ºé¡¹æ˜¯æ¶æ„å¸ˆéœ€è¦å¥½å¥½è€ƒè™‘çš„é‡è¦é—®é¢˜ã€‚ ä½œè€…ï¼šé™ˆé¼æ˜Ÿé“¾æ¥ï¼šhttps://www.zhihu.com/question/24225007/answer/81501685æ¥æºï¼šçŸ¥ä¹è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ é‚£ä½ è®²è®² mysql ä¸­ä½ å°è±¡æ·±åˆ»çš„åœ°æ–¹å§ ç¬¬ä¸€ä¸ªï¼Œå¯¹ mysql æ”¯æŒçš„ RR éš”ç¦»çº§åˆ«éå¸¸çš„å°è±¡æ·±åˆ»ï¼Œç«Ÿç„¶å¯ä»¥åšåˆ°ä¿®æ”¹äº†ä½†ä¸å»è¯»è¿™ç§éš”ç¦»çº§åˆ«ï¼› è¿˜æœ‰å°±æ˜¯ Mysql çš„é«˜å¯ç”¨æœºåˆ¶ï¼›ã€Œå¿…é¡»ç–¯ç‹‚è½¬å…¥è‡ªå·±ç†Ÿæ‚‰çš„åœ°æ–¹å•Šã€ Mysql çš„ Write Ahead Logging ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç‰¹ç‚¹ï¼Œæœ‰å»ä½¿ç”¨ redologã€undologã€binlogï¼› Mysql çš„é”ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç‰¹ç‚¹ï¼Œé‡Œé¢æœ‰ä¸°å¯Œçš„é”ï¼Œè·Ÿ juc ä¸‹çš„é”æœ‰çš„ä¸€æ‹¼ï¼Œç”šè‡³æ›´ä¸°å¯Œï¼› è¿˜æœ‰å°±æ˜¯ Mysql ä¸­çš„ç´¢å¼•ï¼Œèƒ½æé«˜æ£€ç´¢é€Ÿåº¦ã€‚ ã€æœºä¼šæ¥äº†å°±è¦æŠŠæ¡ä½ï¼Œè¿™ç§é—®é¢˜æ˜¯æœ€é€‚åˆå±•ç°è‡ªå·±çš„å­¦ä¹ æ·±åº¦ã€ é‚£ä½ åˆ†åˆ«è®²è®²è¿™äº”ä¸ªå§ å…¶å®é¢è¯•å®˜å¹¶æ²¡æœ‰è®©æˆ‘è®²è¿™äº”ä¸ªï¼Œåªæ˜¯è®©æˆ‘è®²è®² rr çº§åˆ«å¦‚ä½•å®ç°çš„ï¼Œä½†æ˜¯ä¸ºäº†å¤ä¹ ï¼Œæˆ‘è¿˜æ˜¯æŠŠè¿™äº”ä¸ªå†ä¸²ä¸€éå§ã€‚ å…ˆè®²ç¬¬ä¸€ä¸ªï¼Œmysql å¦‚ä½•å®ç°çš„ RR éš”ç¦»çº§åˆ« ä¸»è¦æ˜¯é‡‡ç”¨äº†äº‹åŠ¡çš„ä¸€è‡´æ€§è§†å›¾ï¼Œå’Œå½“å‰è¡Œçš„ä¸€ä¸ª row_tranc_idï¼Œæ ¹æ®ä¸€è‡´æ€§è§†å›¾é‡Œé¢çš„ä½æ°´ä½å’Œé«˜æ°´ä½å’Œ row_tranc_id è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ç”¨ undolog æ‹¿åˆ°ä¸Šä¸€ä¸ªå€¼ï¼Œundolog åœ¨è¿™é‡Œå°±æ˜¯å®ç° mvcc çš„åŸºç¡€ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼Œå°±æ˜¯å¦‚æœ select æ˜¯ä¸åŠ æ‚²è§‚é”çš„å»è¯»ï¼Œæ²¡æœ‰é—®é¢˜ï¼Œæ˜¯rrçº§åˆ«çš„è¯»å–ï¼Œä½†æ˜¯å¦‚æœ select æ˜¾å¼çš„åŠ é”ï¼Œæ¯”å¦‚è¯´åŠ äº†è¡Œé”ä¸­çš„è¯»é”ã€Œåœ¨è¯­å¥æœ€ååŠ  in shared modeã€æˆ–è€…å†™é”ã€Œfor updateã€ï¼Œè¿™æ ·è·Ÿ update ä¸€æ ·å¼ºåˆ¶å»è¿›è¡Œä¸€ä¸ªåŠ é”ï¼Œå¯¼è‡´åªèƒ½å»å½“å‰è¯»ï¼Œæ­¤æ—¶ mvcc æ˜¯å¤±æ•ˆçš„ã€‚ å†è®²ç¬¬äºŒä¸ªï¼Œmysql çš„é«˜å¯ç”¨æœºåˆ¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ è¿™é‡Œæˆ‘åœ¨è…¾è®¯é¢è¯•éƒ¨åˆ†ä¹Ÿæœ‰æåˆ°ï¼Œä½†æ˜¯è…¾è®¯é‚£éƒ¨åˆ†ä¸»è¦ä¾§é‡è®²äº†ä¸»ä»ä¸€è‡´æ˜¯å¦‚ä½•å®ç°çš„ï¼Œè€Œé«˜å¯ç”¨åˆ™æ˜¯å»ºç«‹åœ¨ä¸»ä»ä¸€è‡´çš„åŸºç¡€ä¸Šçš„ã€‚ å…ˆä¸Šä¸€ä¸ªè‡ªå·±ç”»çš„å›¾ï¼š mysql çš„é«˜å¯ç”¨çš„å®ç°ï¼ŒåŸºç¡€å°±æ˜¯èƒ½å¤Ÿåšåˆ°ä¸»å¤‡åˆ‡æ¢ï¼Œè€Œä¸»å¤‡åˆ‡æ¢çš„å‰ææ˜¯è¦ä¿è¯ä¸»ä»çš„ä¸€è‡´æ€§ï¼Œè¿™æ ·æ‰èƒ½åˆ‡æ¢ï¼Œä¸ç„¶è‚¯å®šä¼šå½±å“æ•°æ®ï¼Œä½†æ˜¯è¦ä¿è¯ä¸»ä»ä¸€è‡´æ€§ï¼Œå°±ä¼šå¸¦æ¥ä¸»ä»å»¶è¿Ÿçš„æƒ…å†µï¼Œå…·ä½“çš„ä¸»ä»ä¸€è‡´æ€§çš„å®ç°å¯ä»¥çœ‹æˆ‘ä¸Šé¢è®²çš„ï¼Œä¸»ä»å»¶è¿Ÿå¯èƒ½ä¼šæœ‰å›¾ä¸­é‚£äº›åŸå› ï¼Œé’ˆå¯¹ä¸å¯é¿å…çš„ä¸»ä»å»¶è¿Ÿï¼Œä¸»å¤‡åˆ‡æ¢æœ‰ä¸¤ç§ç­–ç•¥ï¼š å¯é æ€§ä¼˜å…ˆç­–ç•¥ã€‚å…·ä½“æ­¥éª¤æ˜¯ç­‰å»¶è¿Ÿå°äºæŸä¸ªæ•°æ—¶ï¼Œä¾‹å¦‚ 5 ç§’ï¼Œå°†ä¸»åº“ A æ”¹æˆåªè¯»çŠ¶æ€ï¼Œç„¶åå†çœ‹ä¸»ä»å»¶è¿Ÿã€Œseconds_behind_masterã€ï¼Œç­‰å…¶å˜ä¸º 0 åï¼Œå°†å¤‡åº“ B æ”¹æˆå¯è¯»å†™çŠ¶æ€ï¼Œç„¶åæŠŠä¸šåŠ¡åˆ‡æ¢åˆ°å¤‡åº“ B ä¸Šï¼Œè¿™ä¸ªç­–ç•¥çš„å¥½å¤„å°±æ˜¯èƒ½ä¿è¯ä¸»ä»çš„å®Œå…¨ä¸€è‡´æ€§ï¼Œä½†æ˜¯ä¼šæœ‰å°‘é‡æ—¶é—´å¯¼è‡´ç³»ç»Ÿå¤„äºä¸å¯å†™çš„çŠ¶æ€ï¼Œä¸è¿‡å½±å“ä¸å¤§ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ç­–ç•¥ï¼› å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥ã€‚ä¸ç­‰ä¸»å¤‡æ•°æ®åŒæ­¥ï¼Œç›´æ¥æŠŠè¿æ¥åˆ‡åˆ°å¤‡åº“Bï¼Œå¹¶ä¸”è®©å¤‡åº“Bå¯ä»¥è¯»å†™ï¼Œé‚£ä¹ˆç³»ç»Ÿå‡ ä¹å°±æ²¡æœ‰ä¸å¯ç”¨æ—¶é—´äº†ã€‚å¥½å¤„å°±æ˜¯æ²¡æœ‰ä¸å¯ç”¨æ—¶é—´ï¼Œä½†æ˜¯å®¹æ˜“å¯¼è‡´æ•°æ®é€»è¾‘å‡ºç°é—®é¢˜ã€‚ å†è®²ç¬¬ä¸‰ä¸ªï¼ŒMysql çš„ Write Ahead Logging Mysql ä¸­å¸¸è§çš„ä¸‰ä¸ªæ—¥å¿—æ–‡ä»¶åˆ†åˆ«æ˜¯ undologã€redologä»¥åŠbinlogï¼Œredolog ä¸»è¦æ˜¯è´Ÿè´£ crash-safeï¼Œä¹Ÿå°±æ˜¯å´©æºƒæ¢å¤çš„å·¥ä½œï¼Œbinlogä¸»è¦æ˜¯åšä¸€ä¸ªå½’æ¡£çš„ä½œç”¨ï¼Œredologå’Œbinlogæ˜¯ä¸¤é˜¶æ®µæäº¤çš„ï¼Œè¿™ä¹Ÿæ˜¯å¸¸ç”¨çš„åˆ†å¸ƒå¼çš„æ‰‹æ®µå§ï¼Œå¤§å®¶éƒ½okayäº†æ‰commitï¼Œredologæ˜¯å¯æ“¦é™¤çš„ï¼Œå­˜å‚¨çš„æ˜¯ç‰©ç†æ—¥å¿—ï¼Œä½†æ˜¯binlogæ˜¯é¡ºåºå†™ï¼Œå­˜å‚¨çš„æ˜¯é€»è¾‘æ—¥å¿—ï¼Œå¹¶ä¸” redolog æ˜¯ Innodb ç‹¬æœ‰çš„ï¼Œbinlogåˆ™æ˜¯ serverç«¯æœ‰çš„ã€‚undolog ä¸»è¦æ˜¯è´Ÿè´£ mvcc å’Œå›æ»šï¼Œåœ¨æ•°æ®ä¿®æ”¹çš„æ—¶å€™ï¼Œä¸ä»…è®°å½•äº†redoï¼Œè¿˜è®°å½•äº†ç›¸å¯¹åº”çš„undoï¼Œå¦‚æœå› ä¸ºæŸäº›åŸå› å¯¼è‡´äº‹åŠ¡å¤±è´¥æˆ–å›æ»šäº†ï¼Œå¯ä»¥å€ŸåŠ©è¯¥undoè¿›è¡Œå›æ»šã€‚undo logå’Œredo logè®°å½•ç‰©ç†æ—¥å¿—ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯é€»è¾‘æ—¥å¿—ã€‚å¯ä»¥è®¤ä¸ºå½“deleteä¸€æ¡è®°å½•æ—¶ï¼Œundo logä¸­ä¼šè®°å½•ä¸€æ¡å¯¹åº”çš„insertè®°å½•ï¼Œåä¹‹äº¦ç„¶ï¼Œå½“updateä¸€æ¡è®°å½•æ—¶ï¼Œå®ƒè®°å½•ä¸€æ¡å¯¹åº”ç›¸åçš„updateè®°å½•ã€‚ å†è®²ç¬¬å››ä¸ªï¼ŒMysql ä¸­çš„é” Mysql ä»é”çš„èŒƒå›´ä¸Šè®²åˆ†ä¸ºå…¨å±€é”ã€è¡¨çº§é”ä»¥åŠè¡Œé”ã€‚ å…¨å±€é”ç§°ä¸º Flash Tables with Read Lockï¼Œä¸»è¦ç”¨æ¥å…¨åº“é€»è¾‘å¤‡ä»½ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥ä½¿æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ã€‚ä½¿ç”¨è¯¥å‘½ä»¤ä¹‹åï¼Œæ•°æ®æ›´æ–°è¯­å¥ã€æ•°æ®å®šä¹‰è¯­å¥å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ç­‰æ“ä½œéƒ½ä¼šè¢«é˜»å¡ã€‚å¦‚æœè¿™ä¸ªå‘½ä»¤åœ¨ä¸»åº“æ“ä½œçš„è¯ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡åœæ‘†ï¼Œå¦‚æœå†å¤‡åº“æ“ä½œçš„è¯ï¼Œä¼šå¯¼è‡´å¤‡åº“æ— æ³•å†™ä»ä¸»åº“ä¼ æ¥çš„binlogï¼Œé€ æˆä¸»å¤‡å»¶è¿Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆå°‘ä½¿ç”¨å®ƒï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨mysqlè‡ªå¸¦çš„ mysqldump å»è¿›è¡Œå…¨åº“é€»è¾‘å¤‡ä»½ï¼Œå› ä¸º mysqldump æœ‰ mvcc çš„æ”¯æŒï¼Œæ‰€ä»¥å¯ä»¥ä¸€è¾¹å¤‡ä»½ä¸€è¾¹è¯»å†™ï¼Œä½†æ˜¯è¿™ä¸ªå¿…é¡»è¦æ•°æ®åº“å¼•æ“æ”¯æŒrrè¿™ä¸ªéš”ç¦»çº§åˆ«ï¼Œåƒ MyISAM å°±ä¸è¡Œã€‚ è¡¨çº§é”åˆåˆ†ä¸ºè¡¨é”å’Œå…ƒæ•°æ®é”MDLï¼Œå…¶ä¸­è¡¨é”éœ€è¦æˆ‘ä»¬å»æ˜¾å¼åŠ é”ï¼Œä¾‹å¦‚ lock tables â€¦ read/writeï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹å¯¹å…¶æ˜¾å¼åŠ äº†è¡¨è¯»é”ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹å’Œè¯¥çº¿ç¨‹åªèƒ½è¯»è¯¥è¡¨ï¼Œå¦‚æœè¯¥çº¿ç¨‹åŠ äº†è¡¨å†™é”ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹å•¥ä¹Ÿå¹²ä¸äº†ï¼Œæ‰€ä»¥è¿™ä¸ªé”è¡¨çš„ç²’åº¦è¿˜æ˜¯å¤ªå¤§ï¼Œä¸€èˆ¬ä¸ä¼šé‡‡ç”¨ã€‚ è¡¨çº§é”çš„å¦å¤–ä¸€ç§æ˜¯å…ƒæ•°æ®é”MDLï¼Œè¿™æ˜¯ç³»ç»Ÿé»˜è®¤åŠ ä¸Šçš„ï¼Œå¯¹è¡¨è¿›è¡Œ DML æ˜¯åŠ è¯»é”ï¼Œå¯¹è¡¨è¿›è¡Œ DDL æ˜¯åŠ å†™é”ï¼Œè¯»å†™äº’æ–¥ï¼Œè¯»å…±äº«ï¼Œç›¸å½“äº ReadWriteLockï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰å†™é™çº§çš„è¿‡ç¨‹ã€‚ è¡Œé”æ˜¯æˆ‘ä»¬æœ€ç»å¸¸ç”¨çš„äº†ï¼Œä¹Ÿåˆ†ä¸ºè¯»é”å’Œå†™é”ï¼Œè¿™é‡Œçš„è¯»å•æŒ‡ selectï¼Œè¿™é‡Œçš„å†™æŒ‡çš„æ˜¯ updateã€deleteã€insertç­‰ç­‰ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹ select è¿›è¡Œæ˜¾å¼çš„åŠ é”ï¼Œæ­¤æ—¶ select å°±ä»ä¹è§‚è¯»é”ã€Œè·Ÿ StampedLock ç±»ä¼¼ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡ version åˆ¤æ–­æ•°æ®æœ‰æ²¡æœ‰å˜åŒ–ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡ stamp åˆ¤æ–­ã€å˜æˆäº†æ‚²è§‚è¯»é”æˆ–è€…å†™é”äº†ï¼Œæ­¤æ—¶mvccæ˜¯å¤±æ•ˆçš„ï¼Œæ˜¯è·Ÿ updateç­‰è¯­å¥ä¸€æ ·å¼ºåˆ¶å»å½“å‰è¯»çš„ã€‚ å†è®²ç¬¬äº”ä¸ªï¼ŒMysql çš„ç´¢å¼•ï¼Ÿ ç´¢å¼•æœ‰å¾ˆå¤šï¼Œå¸¸è§çš„å°±æ˜¯èšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•ï¼Œèšé›†ç´¢å¼•å°±æ˜¯å…ƒç´ çš„é€»è¾‘ä½ç½®å’Œç‰©ç†ä½ç½®ä¿æŒä¸€è‡´ï¼Œä¹Ÿç§°ä¸ºä¸»é”®ç´¢å¼•ï¼Œæ˜¯B+æ ‘ï¼Œå› ä¸ºæ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œå¹¶ä¸”ç´¢å¼•èŠ‚ç‚¹åªæœ‰æŒ‡é’ˆå’Œç´¢å¼•ï¼Œè¿™æ ·å•ä¸ªèŠ‚ç‚¹å°±èƒ½å®¹çº³æ›´å¤šçš„æŒ‡é’ˆåŸŸï¼Œä»è€Œä½¿å¾—æ ‘çš„é«˜åº¦ä¸‹é™ã€‚ éèšé›†ç´¢å¼•è¦æ³¨æ„å‡å°‘å›è¡¨çš„æ¬¡æ•°ï¼Œå¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯è¦†ç›–ç´¢å¼•ã€ä½¿ç”¨æœ€å·¦å‰ç¼€åŸåˆ™å°½é‡å‡å°‘ç´¢å¼•çš„å»ºç«‹ï¼ŒåŒæ—¶æ³¨æ„å¯ä»¥ä½¿ç”¨ç´¢å¼•ä¸‹æ¨æ¥å‡å°‘å›è¡¨çš„æ¬¡æ•°ã€‚ å¥½å‹’ï¼Œæ•°æ®åº“å·®ä¸å¤šäº†ï¼Œæœ€åè®²ä¸€è®²èŒƒå¼å§ mysqlä¸­å¸¸ç”¨çš„èŒƒå¼å°±æ˜¯ä¸‰å¤§èŒƒå¼ ç¬¬ä¸€èŒƒå¼ï¼šç¡®ä¿æ¯åˆ—çš„åŸå­æ€§ï¼Œæ¯”å¦‚è¯´åœ°å€è¿™ä¸€å±æ€§ï¼Œæœ‰çš„ä¸šåŠ¡å¯èƒ½å¯¹åŸå¸‚ç”¨çš„æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬å°±å°±åº”è¯¥ç»†åˆ†ï¼Œè¿™æ ·åœ¨å¯¹ç”¨æˆ·ä½¿ç”¨åŸå¸‚è¿›è¡Œåˆ†ç±»çš„æ—¶å€™å°±éå¸¸æ–¹ä¾¿ï¼Œä¹Ÿæé«˜äº†æ•°æ®åº“çš„æ€§èƒ½ã€‚ ç¬¬äºŒèŒƒå¼ï¼šç¡®ä¿è¡¨ä¸­çš„æ¯åˆ—éƒ½å’Œä¸»é”®ç›¸å…³ï¼Œå»é™¤éƒ¨åˆ†ä¾èµ–ã€‚æœ€å…¸å‹çš„åœºæ™¯å°±æ˜¯å¤šå¯¹å¤šçš„åœºæ™¯ï¼Œæ¯”å¦‚è®¢å•-å•†å“è¡¨ï¼Œå› ä¸ºè®¢å•ä¸­å¯èƒ½ä¼šæœ‰å¤šç§å•†å“ï¼Œæ‰€ä»¥è¦å°†è®¢å•ç¼–å·å’Œå•†å“ç¼–å·ä½œä¸ºæ•°æ®åº“è¡¨çš„è”åˆä¸»é”®ï¼Œå¦‚æœæ­¤æ—¶æŠŠå•†å“ä¿¡æ¯ä¹Ÿå†™åœ¨è¿™ä¸ªè¡¨ä¸­ï¼Œå°±ä¸ç¬¦åˆç¬¬äºŒèŒƒå¼äº†ï¼Œè¿™æ ·ä¼šé€ æˆæ•°æ®å†—ä½™ï¼Œåˆ†è¡¨ä¼šæ›´å¥½ã€‚ ç¬¬ä¸‰èŒƒå¼ï¼šç¡®ä¿æ²¡æœ‰ä¼ é€’ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªéä¸»å±æ€§éƒ½è¦ä¾èµ–äºä¸»å±æ€§ï¼Œä¾‹å¦‚è®¢å•è¡¨ï¼Œå’Œç”¨æˆ·æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œæ­¤æ—¶ç”¨æˆ·çš„idä¼šæ˜¯è¿™ä¸ªè¡¨çš„å¤–é”®ï¼Œå¦‚æœåœ¨è¿™é‡ŒåŠ ä¸Šç”¨æˆ·çš„åå­—ï¼Œå°±è¿åäº†ç¬¬ä¸‰èŒƒå¼ï¼Œä¹Ÿæ˜¯ä¼šé€ æˆæ•°æ®çš„å†—ä½™çš„ã€‚ å‚è€ƒ: https://www.cnblogs.com/linjiqin/archive/2012/04/01/2428695.html 2020.3.28 15:30 - 16:30 ã€Œ60 åˆ†é’Ÿã€è…¾è®¯äºŒé¢ç”µè¯é¢ã€‚è¿™ä¸€è½®é¢è¯•è²Œä¼¼æ²¡é‡åˆ°ä»€ä¹ˆå¤§é—®é¢˜ï¼Œé—®çš„é—®é¢˜ä¹Ÿä¸éš¾ï¼Œæ²¡ä»€ä¹ˆå¤ªå¤§å°è±¡äº†â€¦ åªè®°å¾—ä¸€ä¸ªå…³äºå†…å­˜çš„ã€‚ GC roots æœ‰å“ªäº›ç±»å‹ï¼Ÿ å°±æ˜¯é‚£äº›ç¡®ä¿å­˜æ´»çš„å¯¹è±¡ï¼Œä¾‹å¦‚ æ ˆä¸­æœ¬åœ°å˜é‡è¡¨ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼› native æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼› æ–¹æ³•åŒº(non-heap)ä¸­çš„ç±»é™æ€å±æ€§å¼•ç”¨çš„å˜é‡ï¼› æ–¹æ³•åŒº(non-heap)ä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼› ä¸ºä»€ä¹ˆè¦é€‰å®šè¿™äº›å¯¹è±¡ä¸º GC rootsï¼Ÿ å› ä¸º gc çš„ç›®çš„æ˜¯å›æ”¶é‚£äº›ä¸ç”¨çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥ç¡®ä¿éœ€è¦ç”¨åˆ°ï¼Œæ‰€ä»¥è‚¯å®šå°±ä¸èƒ½å›æ”¶ã€‚ å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡ä¸å¯è¾¾ï¼Ÿä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼Ÿ å½“ä¸€ä¸ªå¯¹è±¡åˆ° GC roots çš„å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯ä¸å¯ç”¨çš„ï¼Œæœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯ 123&gt; A a = new A();&gt; a = null;&gt; æ­¤æ—¶ a å¼€å§‹æŒ‡å‘çš„å¯¹è±¡ï¼Œå·²ç»æ²¡æœ‰ GC rootsçš„å¯¹è±¡æŒ‡å‘å®ƒäº†ï¼Œæ‰€ä»¥å®ƒåº”è¯¥è¢«æ ‡è®°ä¸ºä¸å¯è¾¾ï¼Œæˆ‘ä»¬å§‹ç»ˆæ³¨æ„çš„æ˜¯ï¼Œå›æ”¶çš„æ°¸è¿œéƒ½æ˜¯å †ä¸Šçš„ä¸å¯ç”¨å¯¹è±¡ï¼Œå½“ç„¶å®ƒä¹Ÿæœ‰è‡ªæ•‘çš„æœºä¼šï¼Œå°±æ˜¯ A è¿™ä¸ªç±»é‡å†™ finalize() æ–¹æ³•ï¼Œç„¶ååœ¨é‡Œé¢åŠ ä¸Š B.b = thisï¼Œè¿™é‡Œå‡è®¾ b æ˜¯ç±» B çš„ä¸€ä¸ªé™æ€å˜é‡ï¼Œè¿™æ ·è¿™ä¸ªå¯¹è±¡ä¾æ—§ä¸ä¼šè¢«å›æ”¶ï¼Œå› ä¸ºæœ‰ GC roots åˆ°å®ƒçš„å¼•ç”¨é“¾ã€‚ æ ¹æœç´¢ç®—æ³•æ˜¯å¦‚ä½•å»å®ç°çš„å‘¢ï¼Ÿ HotSpoté¦–å…ˆéœ€è¦æšä¸¾æ‰€æœ‰çš„GC Rootsæ ¹èŠ‚ç‚¹ï¼Œè™šæ‹Ÿæœºæ ˆçš„ç©ºé—´ä¸å¤§ï¼Œéå†ä¸€æ¬¡çš„æ—¶é—´æˆ–è®¸å¯ä»¥æ¥å—ï¼Œä½†æ˜¯æ–¹æ³•åŒºçš„ç©ºé—´å¾ˆå¯èƒ½å°±æœ‰æ•°ç™¾å…†ï¼Œéå†ä¸€æ¬¡éœ€è¦å¾ˆä¹…ã€‚æ›´åŠ å…³é”®çš„æ˜¯ï¼Œå½“æˆ‘ä»¬éå†æ‰€æœ‰GC Rootsæ ¹èŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ­¤æ—¶æ­¤åˆ»çš„â€è™šæ‹Ÿæœºå¿«ç…§â€ï¼Œæ‰¾åˆ°æ­¤æ—¶æ­¤åˆ»çš„å¯è¾¾æ€§åˆ†æå…³ç³»å›¾ã€‚åŸºäºè¿™ç§æƒ…å†µï¼ŒHotSpotå®ç°äº†ä¸€ç§å«åšOopMapçš„æ•°æ®ç»“æ„ï¼Œå­˜å‚¨GC Rootså¯¹è±¡ï¼ŒåŒæ—¶å¹¶ä¸æ˜¯æ¯ä¸ªæŒ‡ä»¤éƒ½ä¼šå¯¹OopMapè¿›è¡Œä¿®æ”¹ï¼Œè¿™æ ·OopMapå¾ˆåºå¤§ï¼Œè¿™é‡ŒHotspotå¼•å…¥äº†å®‰å…¨ç‚¹ï¼ŒsafePointï¼Œåªä¼šåœ¨Safe Pointå¤„è®°å½•GC Rootsä¿¡æ¯ã€‚è¿™ä¹Ÿå°±æ˜¯ CMS å¸¸è¯´çš„åˆå§‹é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œå…ˆæŠŠ GC roots æ‰¾åˆ°ï¼Œç„¶åå»æ ‡è®°é‚£äº›ä¸ GC roots ç›¸å…³çš„å¯¹è±¡ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºåœ¨ gc roots ä¸­ä¼šæ ‡è®°å¼•ç”¨äº†ä»–çš„å¯¹è±¡çš„ç¬¦å·å¼•ç”¨çš„ä½ç½®ï¼Œè¿™æ ·å°±èƒ½å¤Ÿå®ç°æ‰¾åˆ° GC roots ç›¸å…³çš„å¯¹è±¡äº†ï¼Œè¿™ä¸ªè·Ÿç±»åŠ è½½è¿‡ç¨‹çš„åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸‰ä¸ªåŠ¨ä½œä¸€æ ·ï¼Œåœ¨å †ä¸Š å» new ä¸€ä¸ªå¯¹è±¡ä½œä¸ºä¸€ä¸ªç±»çš„å…¥å£ï¼Œé‚£è¿™ä¸ªå¯¹è±¡è‚¯å®šæ˜¯çŸ¥é“æ–¹æ³•åŒºä¸­ç±»çš„ä½ç½®çš„ï¼Œæ‰€ä»¥å°±æ˜¯è¯´å¼•ç”¨äº† gc rootsçš„å¯¹è±¡çš„å¼•ç”¨é“¾éƒ½ä¼šæœ‰è®°å½•ã€‚ ä¸Šé¢è¯´çš„è™šæ‹Ÿæœºå¿«ç…§æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ å¿«ç…§ï¼Œå°±æ˜¯å­˜å‚¨åœ¨è¿™ä¸ªç‚¹ä¸Šçš„æ‰€æœ‰vmçš„çŠ¶æ€ï¼ŒåŒ…æ‹¬å†…å­˜å’Œç¡¬ç›˜ï¼Œå½“ç„¶ä¹Ÿå°±åŒ…æ‹¬äº†æ–¹æ³•åŒºä¸­çš„ GC roots æ ¹èŠ‚ç‚¹ã€‚ å›æ”¶çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ è¿™é‡Œä»¥ cms æ”¶é›†å™¨ä¸ºä»£è¡¨ã€‚ åˆå§‹æ ‡è®°ï¼šå…ˆå»åˆ¤æ–­å¯¹è±¡çš„å¯è¾¾æ€§ï¼Œå¦‚æœä¸å¯è¾¾ï¼Œæ ‡è®°ä¸º deadï¼Œç„¶åçœ‹æ˜¯å¦æœ‰ç»§æ‰¿ finalize æ–¹æ³•ï¼Œæ²¡æœ‰çš„è¯ç›´æ¥æ ‡è®°ä¸ºéœ€è¦ gcï¼Œå¦‚æœç»§æ‰¿äº†çœ‹æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œæ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡ŒæŠŠå…¶æ ‡è®°ä¸º aliveï¼Œå¦åˆ™æ ‡è®°ä¸º deadã€‚ å¹¶å‘æ ‡è®°ï¼šsafepointåˆ°è¾¾ä¹‹åï¼Œä¸€è¾¹ç»§ç»­æ ‡è®°è¿˜å¯ä»¥ä¸€è¾¹è®©ç”¨æˆ·å¹¶è¡Œï¼› æœ€ç»ˆæ ‡è®°ï¼šåœ¨è®©ç”¨æˆ·ç¨‹åºå¹¶è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œè¿˜ä¼šäº§ç”Ÿ gc çš„å¯¹è±¡ï¼Œæ‰€ä»¥è¿˜éœ€è¦å†æ ‡è®°ä¸€ä¸‹ï¼› å¹¶å‘æ¸…é™¤ï¼šå¤šçº¿ç¨‹æ¸…é™¤ã€‚ ä¸ºä»€ä¹ˆè¦å°†å¯¹è±¡åˆ†ä¸ºæ–°ç”Ÿä»£è€å¹´ä»£ æ—©æœŸæå‡ºè¿™ä¸ªåˆ†ä»£çš„æ€æƒ³æˆ‘è®¤ä¸ºä¸»è¦æ˜¯è§£å†³ stop the worldçš„æ—¶é—´é•¿åº¦ï¼Œå› ä¸ºå¦‚æœæ—¶é—´å¤ªé•¿å¾ˆå½±å“ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥åªå»æ‰«å¯èƒ½å¾ˆå¿«å°±æ­»äº¡çš„é‚£ä¸€äº›å—åŒºåŸŸæ˜¯å¾ˆæ­£å¸¸çš„æƒ³æ³•ï¼Œè€Œè€å¹´ä»£ç”±äºé€ƒè¿‡äº†å¾ˆå¤šæ¬¡gcï¼Œè¯´æ˜ä»–æ˜¯æœ‰åœ¨è¢«æ´»è·ƒä½¿ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¹³æ—¶çš„gcçš„æ—¶å€™å¯ä»¥ä¸å»è€ƒè™‘ä»–ï¼Œè¿™æ ·å°±åŠ å¿«äº†gcçš„é€Ÿåº¦ï¼› åæœŸç”±äºå¼•å…¥äº†å¹¶è¡Œæœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·è¿›ç¨‹å’Œåƒåœ¾å›æ”¶è¿›ç¨‹å¯ä»¥åŒæ­¥è¿›è¡Œï¼Œå¹¶ä¸”å¯ä»¥å¤šçº¿ç¨‹è¿›è¡Œå›æ”¶ï¼Œé‚£ stop the world è¿™ä¸ªæ—¶é—´å°±ä¸æ˜¯é‡ç‚¹äº†ï¼Œé‡ç‚¹å°±åœ¨äºGCèƒ½å¤Ÿåº”ä»˜çš„åº”ç”¨å†…å­˜åˆ†é…é€Ÿç‡(allocation rate)ï¼Œä¹Ÿå°±æ˜¯è¯´ gc çš„å›æ”¶é€Ÿåº¦è¦è·Ÿä¸Šåº”ç”¨çš„åˆ†é…å†…å­˜çš„é€Ÿåº¦ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œgcè‚¯å®šæ˜¯é€‰æ‹©ç–¯ç‹‚å›æ”¶é‚£ç§å›æ”¶ç‡å¾ˆé«˜çš„åŒºåŸŸï¼Œå…¶ä»–å›æ”¶ç‡ä¸é«˜çš„è‚¯å®šå¾—ç­‰ç­‰ã€‚ æ‰€ä»¥ï¼Œå‰è€…æ˜¯ä»æ—¶é—´è§’åº¦è€ƒè™‘ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ†ä»£ï¼Œå› ä¸ºæ‰«å°åŒºåŸŸæ¯”æ‰«å¤§åŒºåŸŸæ—¶é—´æ›´çŸ­ï¼› è€Œåè€…åˆ™æ˜¯ä»è¿½èµ¶ç”¨æˆ·åˆ†é…å†…å­˜çš„è§’åº¦è€ƒè™‘ï¼Œéœ€è¦åˆ†ä»£ï¼Œè¿™æ ·æ‰«çš„åŒºåŸŸçš„å›æŠ¥ç‡æ›´é«˜ã€‚ æ”¾ä¸€ä¸ªé“¾æ¥ï¼Œå†™çš„è¿˜æ˜¯æ¯”è¾ƒæœ‰æ¡ç†çš„ï¼šhttps://allenwu.itscoder.com/java-gc 2020.3.29 15:00 - 17:30 ã€Œ150 åˆ†é’Ÿã€ è…¾è®¯ä¸‰é¢è§†é¢‘é¢ã€‚è¿™ä¸€é¢å‰é¢é¢çš„è¿˜ç®—okayï¼Œä½†æ˜¯æœ€åä»£ç æ’•äº†ä¸€ä¸ªå¤šå°æ—¶ï¼Œç”Ÿæ­»æœªåœäº†â€¦ ä¸»è¦é—®é¢˜è¿˜æ˜¯åœ¨è®¡ç®—æœºç½‘ç»œæ–¹é¢å§ã€‚ å¤§ç«¯å°ç«¯æ˜¯ä»€ä¹ˆï¼Ÿè¯¦ç»†å™è¿°ä¸€ä¸‹ï¼Ÿ å¤§ç«¯å’Œå°ç«¯æ˜¯æŒ‡æ•°æ®åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ¨¡å¼ï¼Œå®ƒç”± CPU å†³å®šï¼š 1) å¤§ç«¯æ¨¡å¼ï¼ˆBig-endianï¼‰æ˜¯æŒ‡å°†æ•°æ®çš„ä½ä½ï¼ˆæ¯”å¦‚ 1234 ä¸­çš„ 34 å°±æ˜¯ä½ä½ï¼‰æ”¾åœ¨å†…å­˜çš„é«˜åœ°å€ä¸Šï¼Œè€Œæ•°æ®çš„é«˜ä½ï¼ˆæ¯”å¦‚ 1234 ä¸­çš„ 12 å°±æ˜¯é«˜ä½ï¼‰æ”¾åœ¨å†…å­˜çš„ä½åœ°å€ä¸Šã€‚è¿™ç§å­˜å‚¨æ¨¡å¼æœ‰ç‚¹å„¿ç±»ä¼¼äºæŠŠæ•°æ®å½“ä½œå­—ç¬¦ä¸²é¡ºåºå¤„ç†ï¼Œåœ°å€ç”±å°åˆ°å¤§å¢åŠ ï¼Œè€Œæ•°æ®ä»é«˜ä½å¾€ä½ä½å­˜æ”¾ã€‚ 2) å°ç«¯æ¨¡å¼ï¼ˆLittle-endianï¼‰æ˜¯æŒ‡å°†æ•°æ®çš„ä½ä½æ”¾åœ¨å†…å­˜çš„ä½åœ°å€ä¸Šï¼Œè€Œæ•°æ®çš„é«˜ä½æ”¾åœ¨å†…å­˜çš„é«˜åœ°å€ä¸Šã€‚è¿™ç§å­˜å‚¨æ¨¡å¼å°†åœ°å€çš„é«˜ä½å’Œæ•°æ®çš„å¤§å°ç»“åˆèµ·æ¥ï¼Œé«˜åœ°å€å­˜æ”¾æ•°å€¼è¾ƒå¤§çš„éƒ¨åˆ†ï¼Œä½åœ°å€å­˜æ”¾æ•°å€¼è¾ƒå°çš„éƒ¨åˆ†ï¼Œè¿™å’Œæˆ‘ä»¬çš„æ€ç»´ä¹ æƒ¯æ˜¯ä¸€è‡´ï¼Œæ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚ ä¸ºä»€ä¹ˆæœ‰å¤§å°ç«¯æ¨¡å¼ä¹‹åˆ†? è®¡ç®—æœºä¸­çš„æ•°æ®æ˜¯ä»¥å­—èŠ‚ï¼ˆByteï¼‰ä¸ºå•ä½å­˜å‚¨çš„ï¼Œæ¯ä¸ªå­—èŠ‚éƒ½æœ‰ä¸åŒçš„åœ°å€ã€‚ç°ä»£ CPU çš„ä½æ•°ï¼ˆå¯ä»¥ç†è§£ä¸ºä¸€æ¬¡èƒ½å¤„ç†çš„æ•°æ®çš„ä½æ•°ï¼‰éƒ½è¶…è¿‡äº† 8 ä½ï¼ˆä¸€ä¸ªå­—èŠ‚ï¼‰ï¼ŒPCæœºã€æœåŠ¡å™¨çš„ CPU åŸºæœ¬éƒ½æ˜¯ 64 ä½çš„ï¼ŒåµŒå…¥å¼ç³»ç»Ÿæˆ–å•ç‰‡æœºç³»ç»Ÿä»ç„¶åœ¨ä½¿ç”¨ 32 ä½å’Œ 16 ä½çš„ CPUã€‚ å¯¹äºä¸€æ¬¡èƒ½å¤„ç†å¤šä¸ªå­—èŠ‚çš„CPUï¼Œå¿…ç„¶å­˜åœ¨ç€å¦‚ä½•å®‰æ’å¤šä¸ªå­—èŠ‚çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯å¤§ç«¯å’Œå°ç«¯æ¨¡å¼ã€‚ä»¥ int ç±»å‹çš„ 0x12345678 ä¸ºä¾‹ï¼Œå®ƒå ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œå¦‚æœæ˜¯å°ç«¯æ¨¡å¼ï¼ˆLittle-endianï¼‰ï¼Œé‚£ä¹ˆåœ¨å†…å­˜ä¸­çš„åˆ†å¸ƒæƒ…å†µä¸ºï¼ˆå‡è®¾ä»åœ°å€ 0x 4000 å¼€å§‹å­˜æ”¾ï¼‰ï¼š å†…å­˜åœ°å€ 0x4000 0x4001 0x4002 0x4003å­˜æ”¾å†…å®¹ 0x78 0x56 0x34 0x12 å¦‚æœæ˜¯å¤§ç«¯æ¨¡å¼ï¼ˆBig-endianï¼‰ï¼Œé‚£ä¹ˆåˆ†å¸ƒæƒ…å†µæ­£å¥½ç›¸åï¼š å†…å­˜åœ°å€ 0x4000 0x4001 0x4002 0x4003å­˜æ”¾å†…å®¹ 0x12 0x34 0x56 0x78 æˆ‘ä»¬çš„ PC æœºä¸Šä½¿ç”¨çš„æ˜¯ X86 ç»“æ„çš„ CPUï¼Œå®ƒæ˜¯å°ç«¯æ¨¡å¼ï¼›51 å•ç‰‡æœºæ˜¯å¤§ç«¯æ¨¡å¼ï¼›å¾ˆå¤š ARMã€DSP ä¹Ÿæ˜¯å°ç«¯æ¨¡å¼ï¼ˆéƒ¨åˆ† ARM å¤„ç†å™¨è¿˜å¯ä»¥ç”±ç¡¬ä»¶æ¥é€‰æ‹©æ˜¯å¤§ç«¯æ¨¡å¼è¿˜æ˜¯å°ç«¯æ¨¡å¼ï¼‰ã€‚ cookie å’Œ sessionçš„åŒºåˆ« cookieæ˜¯ä¸ºä¼šè¯å­˜å‚¨çš„é”®å€¼ä¿¡æ¯ï¼Œä¸å¯è·¨åŸŸåï¼ˆåªèƒ½æ‹¿åˆ°å½“å‰åŸŸåä¸‹çš„cookieï¼ŒåŒ…å«çˆ¶çº§åŸŸåï¼‰ï¼Œæœ‰æœ‰æ•ˆæœŸé™ï¼Œæ˜¯åœ¨å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¿å­˜ã€‚ sessionæ˜¯åŸºäºå†…å­˜çš„ç¼“å­˜æŠ€æœ¯ï¼Œç”¨æ¥ä¿å­˜é’ˆå¯¹æ¯ä¸ªç”¨æˆ·çš„ä¼šè¯æ•°æ®ï¼Œé€šè¿‡session ID æ¥åŒºåˆ†ç”¨æˆ·ï¼Œå­˜å‚¨äºæœåŠ¡å™¨ç«¯ã€‚ æµè§ˆå™¨åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œæ— cookieï¼Œç„¶åæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œåˆ›å»ºä¸€ä¸ª sessionï¼Œç”¨sessionid æ ‡è¯†ï¼Œå°†å…¶æ”¾å…¥cookieä¸­ï¼Œç„¶åå®¢æˆ·ç«¯ä»¥åè¯·æ±‚éƒ½å¸¦ä¸Šcookieï¼ŒæœåŠ¡å™¨ç«¯æ”¶åˆ°æ¶ˆæ¯åï¼Œè§£æé‡Œé¢çš„sessionidå³å¯ã€‚ java nio ä¸­å¦‚ä½•è§£å†³åŠåŒ…ã€ç²˜åŒ…é—®é¢˜ï¼Ÿ å¯¹äºç²˜åŒ…é—®é¢˜å…ˆè¯»å‡ºåŒ…å¤´å³åŒ…ä½“é•¿åº¦nï¼Œç„¶åå†è¯»å–é•¿åº¦ä¸ºnçš„åŒ…å†…å®¹ï¼Œè¿™æ ·æ•°æ®åŒ…ä¹‹é—´çš„è¾¹ç•Œå°±æ¸…æ¥šäº†ã€‚ å¯¹äºåŠåŒ…é—®é¢˜å…ˆè¯»å‡ºåŒ…å¤´å³åŒ…ä½“é•¿åº¦nï¼Œç”±äºæ­¤æ¬¡è¯»å–çš„ç¼“å­˜æ± é•¿åº¦å°äºnï¼Œè¿™æ—¶å€™å°±éœ€è¦å…ˆç¼“å­˜è¿™éƒ¨åˆ†çš„å†…å®¹ï¼Œç­‰å¾…ä¸‹æ¬¡readäº‹ä»¶æ¥æ—¶æ‹¼æ¥èµ·æ¥å½¢æˆå®Œæ•´çš„æ•°æ®åŒ…ã€‚ æ•°æ®åº“ä¸­ varchar å’Œ char çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ å­—ç¬¦ä¸²æ•°æ®ç±»å‹ MySQLæ•°æ®ç±»å‹ å«ä¹‰ char(n) å›ºå®šé•¿åº¦ï¼Œç”³è¯·çš„é•¿åº¦å°±æ˜¯æœ€ç»ˆçš„é•¿åº¦ï¼Œç±»ä¼¼äºé™æ€æ•°ç»„ï¼Œè‹±æ–‡å ä¸€ä¸ªå­—èŠ‚ï¼Œæ±‰å­—å ä¸¤ä¸ªå­—èŠ‚ varchar(n) å¯å˜é•¿åº¦ï¼Œç±»ä¼¼äºå¯å˜æ•°ç»„â€”åˆ—è¡¨ï¼Œè‹±æ–‡å’Œæ±‰å­—éƒ½å ä¸¤ä¸ªå­—èŠ‚ï¼Œå®é™…é•¿åº¦æ˜¯å®ƒçš„å€¼çš„å®é™…é•¿åº¦+1 text å­˜å‚¨å¯å˜é•¿åº¦çš„éUnicodeæ•°æ®ï¼Œæœ€å¤§é•¿åº¦ä¸º2^31-1ä¸ªå­—ç¬¦ã€‚textåˆ—ä¸èƒ½æœ‰é»˜è®¤å€¼ï¼Œå­˜å‚¨æˆ–æ£€ç´¢è¿‡ç¨‹ä¸­ï¼Œä¸å­˜åœ¨å¤§å°å†™è½¬æ¢ï¼Œåé¢å¦‚æœæŒ‡å®šé•¿åº¦ï¼Œä¸ä¼šæŠ¥é”™è¯¯ï¼Œä½†æ˜¯è¿™ä¸ªé•¿åº¦æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œæ„æ€å°±æ˜¯ä½ æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œè¶…è¿‡ä½ æŒ‡å®šçš„é•¿åº¦è¿˜æ˜¯å¯ä»¥æ­£å¸¸æ’å…¥ã€‚ ç»å¸¸å˜åŒ–çš„å­—æ®µç”¨varcharï¼› çŸ¥é“å›ºå®šé•¿åº¦çš„ç”¨charï¼› å°½é‡ç”¨ varcharï¼› è¶…è¿‡255å­—èŠ‚çš„åªèƒ½ç”¨varcharæˆ–è€…textï¼› èƒ½ç”¨varcharçš„åœ°æ–¹ä¸ç”¨textï¼› è¶…é•¿çš„ï¼Œä¾‹å¦‚å­˜å‚¨æ•´ä¸ªhtmlç”¨textã€‚ ç„¶åå°±ä¸€ç›´åœ¨èŠé¡¹ç›®äº†æœ€åå‡ºäº†ä¸€é“ç®—æ³•é¢˜ï¼Œå°±æ˜¯ LeetCode ä¸Šçš„æ±‚ä¸‹ä¸€ä¸ªæ’åˆ—æ•°çš„å˜ä½“é¢˜ï¼Œæˆ‘ç«Ÿç„¶â€¦ç´§å¼ äº†â€¦ 2020.3.30 17:24 - 18:30 ã€Œ66 åˆ†é’Ÿã€ é˜¿é‡ŒäºŒé¢ç”µè¯é¢ã€‚è¿™ä¸€é¢ï¼Œé¡¹ç›®ä¸ºä¸»ï¼ŒåŸºç¡€çŸ¥è¯†ä¸ºè¾…ï¼Œé‡ç‚¹æ˜¯éœ€è¦å°†è‡ªå·±åšçš„é¡¹ç›®ç”¨æ¯”è¾ƒæ¸…æ¥šçš„è¯è¯­è¡¨è¿°æ¸…æ¥šï¼Œè®©é¢è¯•å®˜èƒ½å¤Ÿæœ€çŸ­æ—¶é—´äº†è§£åˆ°ä½ åšçš„é¡¹ç›®ï¼ŒåŒæ—¶åˆ‡å¿Œæ³¨æ„ï¼Œè‡ªå·±ä¸äº†è§£ä¸æ·±å…¥çš„çŸ¥è¯†ç‚¹å°½é‡ä¸è¦æåŠï¼Œè¿™æ˜¯å¤§å¿Œã€‚ å½“å°†ä¸šåŠ¡æ°´å¹³åˆ†åº“åï¼Œè½¬è´¦ä¸šåŠ¡å¦‚ä½•ä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Ÿ è¿™æ˜¯å…¸å‹çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œç†è®ºæœ‰ CAP ã€ŒC (ä¸€è‡´æ€§)ï¼ŒA (å¯ç”¨æ€§)ï¼ŒP (åˆ†åŒºå®¹é”™æ€§)ï¼Œåªèƒ½é€‰æ‹© AP or CPã€ï¼ŒBASEã€ŒBasically Available(åŸºæœ¬å¯ç”¨)ã€Soft state(è½¯çŠ¶æ€)å’Œ Eventually consistent (æœ€ç»ˆä¸€è‡´æ€§)ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚æ˜¯å¯¹CAPä¸­APçš„ä¸€ä¸ªæ‰©å±•ã€ å¸¸è§çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼š 2PCï¼Œä¸¤é˜¶æ®µæäº¤ï¼Œäº‹åŠ¡ç®¡ç†å™¨æ¥åè°ƒï¼Œå…¨éƒ¨okayäº†æ‰okayï¼Œè¿™æ ·æ•ˆç‡å¾ˆä½ï¼Œå› ä¸ºæ˜¯å¦‚æœæ²¡æˆåŠŸå°±ä¸€ç›´é˜»å¡ã€‚ TCCï¼ˆTry-Confirm-Cancelï¼‰æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œåœ¨æ›´æ–°å¤šä¸ªèµ„æºæ—¶ï¼Œå°†å¤šä¸ªèµ„æºçš„æäº¤å°½é‡å»¶ååˆ°æœ€åä¸€åˆ»å¤„ç†ï¼Œè¿™æ ·çš„è¯ï¼Œå¦‚æœä¸šåŠ¡æµç¨‹å‡ºç°é—®é¢˜ï¼Œåˆ™æ‰€æœ‰çš„èµ„æºæ›´æ–°éƒ½å¯ä»¥å›æ»šï¼Œäº‹åŠ¡ä»ç„¶ä¿æŒä¸€è‡´ã€‚å”¯ä¸€å¯èƒ½å‡ºç°é—®é¢˜çš„æƒ…å†µæ˜¯åœ¨æäº¤å¤šä¸ªèµ„æºæ—¶å‘ç”Ÿäº†ç³»ç»Ÿé—®é¢˜ï¼Œæ¯”å¦‚ç½‘ç»œé—®é¢˜ç­‰ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µæ˜¯éå¸¸ç½•è§çš„ï¼Œä¸€æ—¦å‡ºç°è¿™ç§æƒ…å†µï¼Œå°±éœ€è¦è¿›è¡Œå®æ—¶è¡¥å¿ï¼Œå°†å·²æäº¤çš„äº‹åŠ¡è¿›è¡Œå›æ»šã€‚ äº‹åŠ¡è¡¥å¿æœºåˆ¶ã€‚åœ¨æ•°æ®åº“åˆ†åº“åˆ†è¡¨åï¼Œå¦‚æœæ¶‰åŠçš„å¤šä¸ªæ›´æ–°æ“ä½œåœ¨æŸä¸€ä¸ªæ•°æ®åº“èŒƒå›´å†…å®Œæˆï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ•°æ®åº“å†…çš„æœ¬åœ°äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§ï¼›å¯¹äºè·¨åº“çš„å¤šä¸ªæ“ä½œï¼Œå¯é€šè¿‡è¡¥å¿å’Œé‡è¯•ï¼Œä½¿å…¶åœ¨ä¸€å®šçš„æ—¶é—´çª—å£å†…å®Œæˆæ“ä½œï¼Œè¿™æ ·å°±å¯ä»¥å®ç°äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œçªç ´äº‹åŠ¡é‡åˆ°é—®é¢˜å°±æ»šå›çš„ä¼ ç»Ÿæ€è·¯ã€‚ å‚è€ƒï¼šhttps://juejin.im/post/5b5a0bf9f265da0f6523913b#heading-16 https://cloud.tencent.com/developer/news/200316 è¯´å®è¯â€¦è¿˜æ²¡çœ‹å¤ªæ‡‚â€¦ zookeeperä¸­çš„ä¸¤é˜¶æ®µæäº¤æ˜¯æ€ä¹ˆå»åšçš„ï¼Ÿ CAPç†è®ºä¸­ï¼Œzookeeperå°±æ˜¯CPï¼Œæ”¾å¼ƒå¯ç”¨æ€§ï¼Œè¿½æ±‚ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼Œè¿½æ±‚çš„æ˜¯å¼ºä¸€è‡´ã€‚ åœ¨é¡¹ç›®ä¸­å‡å¦‚ä¸€çº§è°ƒåº¦å™¨æŒ‚äº†ï¼Œæ€ä¹ˆå¤„ç†ï¼Ÿ æˆ‘è¯´æ²¡å¤„ç†â€¦æ­£å¸¸åº”è¯¥æ˜¯ç±»ä¼¼äº Mysql ä¸€æ ·æœ‰ä¸ªä¸»å¤‡åˆ‡æ¢çš„æœºåˆ¶ã€‚ SpringBootä¸­çš„ AOP åˆ†ä¸ºå‡ ç±»ï¼Œ AOP ä¸»è¦æ˜¯ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥é€šè¿‡ JDK åŠ¨æ€ä»£ç†ï¼Œä¸€ç§æ˜¯é€šè¿‡cglibã€‚ å…ˆæ¥å›é¡¾ä¸€ä¸‹ Spring ä¸­ AOP çš„æµç¨‹ï¼š ä»£ç†çš„åˆ›å»ºã€‚ éœ€è¦åˆ›å»ºä»£ç†å·¥å‚ï¼Œä»£ç†å·¥å‚éœ€è¦ 3 ä¸ªé‡è¦çš„ä¿¡æ¯ï¼šæ‹¦æˆªå™¨æ•°ç»„ï¼Œç›®æ ‡å¯¹è±¡æ¥å£æ•°ç»„ï¼Œç›®æ ‡å¯¹è±¡ã€‚ åˆ›å»ºä»£ç†å·¥å‚æ—¶ï¼Œé»˜è®¤ä¼šåœ¨æ‹¦æˆªå™¨æ•°ç»„å°¾éƒ¨å†å¢åŠ ä¸€ä¸ªé»˜è®¤æ‹¦æˆªå™¨ â€”â€” ç”¨äºæœ€ç»ˆçš„è°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚ å½“è°ƒç”¨ getProxy æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šæ ¹æ®æ¥å£æ•°é‡å¤§ä½™ 0 æ¡ä»¶è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ˆJDK or Cglibï¼‰ã€‚ æ³¨æ„ï¼šåˆ›å»ºä»£ç†å¯¹è±¡æ—¶ï¼ŒåŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªå¤–å±‚æ‹¦æˆªå™¨ï¼Œè¿™ä¸ªæ‹¦æˆªå™¨å°±æ˜¯ Spring å†…æ ¸çš„æ‹¦æˆªå™¨ã€‚ç”¨äºæ§åˆ¶æ•´ä¸ª AOP çš„æµç¨‹ã€‚ ä»£ç†çš„è°ƒç”¨ å½“å¯¹ä»£ç†å¯¹è±¡è¿›è¡Œè°ƒç”¨æ—¶ï¼Œå°±ä¼šè§¦å‘å¤–å±‚æ‹¦æˆªå™¨ã€‚ å¤–å±‚æ‹¦æˆªå™¨æ ¹æ®ä»£ç†é…ç½®ä¿¡æ¯ï¼Œåˆ›å»ºå†…å±‚æ‹¦æˆªå™¨é“¾ã€‚åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ ¹æ®è¡¨è¾¾å¼åˆ¤æ–­å½“å‰æ‹¦æˆªæ˜¯å¦åŒ¹é…è¿™ä¸ªæ‹¦æˆªå™¨ã€‚è€Œè¿™ä¸ªæ‹¦æˆªå™¨é“¾è®¾è®¡æ¨¡å¼å°±æ˜¯èŒè´£é“¾æ¨¡å¼ã€‚ å½“æ•´ä¸ªé“¾æ¡æ‰§è¡Œåˆ°æœ€åæ—¶ï¼Œå°±ä¼šè§¦å‘åˆ›å»ºä»£ç†æ—¶é‚£ä¸ªå°¾éƒ¨çš„é»˜è®¤æ‹¦æˆªå™¨ï¼Œä»è€Œè°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚æœ€åè¿”å›ã€‚ å‚è€ƒï¼šhttps://www.jianshu.com/p/e18fd44964eb è®²è®² cglib å¦‚ä½•ä½¿ç”¨å¹¶å®ç°çš„ï¼Ÿ åŠ¨æ€ä»£ç†å†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œæ˜¯åªèƒ½ä»£ç†æ¥å£ï¼Œcglibç°åœ¨æˆ‘ä»¬æ¥å…·ä½“çœ‹ä¸€ä¸‹ã€‚ æˆ‘ä»¬çŸ¥é“ï¼ŒåŠ¨æ€ä»£ç†æ˜¯ä»£ç†ç±»å®ç°è¢«ä»£ç†ç±»çš„æ¥å£ï¼Œè€Œcglibåˆ™æ˜¯ä»£ç†ç±»ç»§æ‰¿è¢«ä»£ç†ç±»ï¼Œä¹Ÿå°±æ˜¯å­ç±»å¢å¼ºçˆ¶ç±»çš„æ‰‹æ®µã€‚cglibå…¶å®ä¹Ÿå°±æ˜¯å­—èŠ‚ç å¢å¼ºç±»åº“ã€‚ å…·ä½“å¦‚ä½•ä½¿ç”¨ cglibï¼šhttps://zhuanlan.zhihu.com/p/37886319 åŠ¨æ€ä»£ç†å’Œcglibçš„åŒºåˆ«ï¼Ÿ ä¸€ä¸ªæ˜¯ä»£ç†ç±»å®ç°æ¥å£ï¼Œä¸€ä¸ªæ˜¯ä»£ç†ç±»ç»§æ‰¿ç±»ï¼Œæˆ‘è§‰å¾—å·®ä¸å¤ªå¤šã€‚ åŠ¨æ€ä»£ç†ç”¨åˆ°çš„æ¥å£æœ‰ InnvocationHandlerï¼Œé€šè¿‡å®ç°å…¶ invoke æ–¹æ³•å¢å¼ºæ–¹æ³•ï¼Œå¹¶ä¸”é€šè¿‡ Proxy.newInstace() å®ç°ä»£ç†è¿‡ç¨‹ã€‚è€Œcglibåˆ™ä½¿ç”¨ MethodInterceptor æ¥å£ï¼Œé€šè¿‡å®ç°å…¶ intercept() æ–¹æ³•å¢å¼ºæ–¹æ³•ï¼Œå¹¶ä¸”é€šè¿‡ Enhancer.create() æ–¹æ³•å®ç°ä»£ç†è¿‡ç¨‹ã€‚ ä¸‹é¢æˆ‘æ”¾ä¸€ä¸‹è‡ªå·±å†™çš„åŠ¨æ€ä»£ç†å’Œ cglib çš„å®ç° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091// åŠ¨æ€ä»£ç†ï¼Œæ€»å…±æœ‰å››ä¸ªç±»// 1. æ¥å£package AOP.Proxy;public interface Person &#123; void play(); void dance();&#125;// 2. å®ç°ç±»ï¼Œä¹Ÿå°±æ˜¯è¦è¢«ä»£ç†çš„ç±»package AOP.Proxy;public class Universities implements Person &#123; @Override public void play() &#123; System.out.println("I like play computer"); &#125; @Override public void dance() &#123; System.out.println("I like dance"); &#125;&#125;// 3. å®ç° InnocationHandler æ¥å£ï¼Œå®Œæˆä»£ç†çš„ä»»åŠ¡package AOP.Proxy;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;public class Dynamic implements InvocationHandler &#123; // æ•´å®¹çš„äººæ˜¯è°ï¼Œæˆ‘å¾—çŸ¥é“ private Object obj; public Dynamic(Object obj)&#123; this.obj = obj; &#125; // æ•´å®¹çš„è¿‡ç¨‹ public Object myDynamic()&#123; return Proxy.newProxyInstance(this.obj.getClass().getClassLoader(),this.obj.getClass().getInterfaces(),this); &#125; // æ•´å®¹çš„åœ°æ–¹äº¤ä»£æ¸…æ¥š @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println("å¼€å§‹ä¸º" + method.getName() + "æ–¹æ³•è¿›è¡Œä»£ç†"); Object result = method.invoke(obj,args); System.out.println("ç»“æŸ" + method.getName() + "æ–¹æ³•çš„ä»£ç†"); return result; &#125;&#125;// 4. æµ‹è¯•ç±»// è¿™é‡Œæˆ‘é‡‡ç”¨äº†ä¸¤ç§æ–¹æ³•æµ‹è¯•ï¼Œä¸€ç§æ˜¯ç›´æ¥åœ¨ test ç±»ä¸­å†™å‡ºæ•´å®¹çš„è¿‡ç¨‹// å¦å¤–ä¸€ç§æ˜¯ç›´æ¥è°ƒç”¨æˆ‘åœ¨ Dynamic å·²ç»åŒ…è£…å¥½æ•´å®¹è¿‡ç¨‹çš„æ–¹æ³•ï¼Œå»ºè®®ä½¿ç”¨è¿™ç§// å› ä¸ºè¿™æ ·ä»£ç å°±å°‘äº†ï¼Œä¸‹é¢ cglib å°±æ˜¯é‡‡ç”¨æ–¹æ³•äºŒå“ˆpackage AOP.Proxy;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;public class test &#123; public static void main(String[] args) &#123; // ç›¸å½“äºåšç”Ÿæ„çš„è¿‡ç¨‹ï¼Œæ¯”å¦‚æˆ‘å»åŒ»é™¢æ•´å®¹ï¼Œé¦–å…ˆæˆ‘è¦ç¡®ä¿æˆ‘æœ‰é’±(ä¹Ÿå°±æ˜¯æœ‰æ¥å£) Universities person = new Universities(); // å…¶æ¬¡ï¼Œæˆ‘å¾—å»åŒ»é™¢æ‰¾åˆ°ç›¸åº”çš„åŒ»ç”Ÿï¼Œä¹Ÿå°±æ˜¯æŠŠæˆ‘æƒ³ä»£ç†çš„å¯¹è±¡ï¼Œå³æˆ‘æœ¬äººï¼Œå‘ŠçŸ¥ç»™åŒ»ç”Ÿ // åŒ»ç”Ÿè‚¯å®šå¾—æœ‰èƒ½æ•´å®¹çš„æŠ€æœ¯ï¼Œé‚£å°±æ˜¯å¾—ç»§æ‰¿ InvocationHandler InvocationHandler dynamic_person = new Dynamic(person); // è¿›è¡Œäº¤æ˜“çš„è¿‡ç¨‹ï¼Œä¸€æ‰‹äº¤é’±ä¸€æ‰‹äº¤æ¢ï¼ŒåŒ»ç”Ÿæ‹¿åˆ°é’±ï¼Œä¼šè¿”å›ä¸€ä¸ªæœ‰é’±çš„å¤„ç†å¥½çš„ç¾å¥³ï¼Œä¹Ÿå°±æ˜¯ä»£ç†å®Œæˆäº† // è¿™é‡Œå¿…é¡»å¼ºè°ƒä»£ç†è¿”å›çš„æ˜¯ æ¥å£å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯åŒ»ç”Ÿåªä¼šå¯¹æœ‰é’±äººè¿›è¡Œä»£ç†ï¼Œæ²¡é’±çš„ä»£ç†å°±å¤±è´¥äº† // å¦‚æœæœ€å¼€å§‹æˆ‘æ²¡é’±ï¼Œæˆ‘å°±å»æ‰¾åŒ»ç”Ÿäº†ï¼Œé‚£åœ¨è¿™ä¸€æ­¥äº¤æ˜“çš„è¿‡ç¨‹å°±ä¼šå‡ºé”™ï¼Œå› ä¸ºåŒ»ç”Ÿåªä¼šå¤„ç†æœ‰é’±äººï¼Œå¹¶ä¸”è¿”å›æœ‰é’±äººçš„ä»£ç†å¥½çš„å¯¹è±¡ // æœ‰é’±äººå¾—åˆ°ä»£ç†åçš„å¯¹è±¡ï¼Œå°±å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº† Person pp = (Person) Proxy.newProxyInstance(person.getClass().getClassLoader(),person.getClass().getInterfaces(),dynamic_person); pp.dance(); System.out.println("-----------"); Person pp2 = (Person) new Dynamic(person).myDynamic(); pp2.dance(); &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586// cglib å®ç°//1. å¯¼åŒ…ï¼Œåœ¨pom.xml å¯¼åŒ… &lt;dependency&gt; &lt;groupId&gt;cglib&lt;/groupId&gt; &lt;artifactId&gt;cglib-nodep&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;cglib&lt;/groupId&gt; &lt;artifactId&gt;cglib&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt; &lt;/dependency&gt; // 2. éœ€è¦è¢«ä»£ç†çš„ç±»package AOP.Cglib;public class SomeService &#123; public String doFirst() &#123; System.out.println("æ‰§è¡ŒdoFirst()æ–¹æ³•"); return "abc"; &#125; public void doSecond() &#123; System.out.println("doSecond()æ–¹æ³•"); &#125;&#125;// 3. è¿›è¡Œä»£ç†è¿‡ç¨‹package AOP.Cglib;import net.sf.cglib.proxy.Enhancer;import net.sf.cglib.proxy.MethodInterceptor;import net.sf.cglib.proxy.MethodProxy;import java.lang.reflect.Method;public class CglibFactory implements MethodInterceptor &#123; private Object object; public CglibFactory(Object object) &#123; this.object = object; &#125; public Object myCglibCreator() &#123; Enhancer enhancer = new Enhancer(); //å°†ç›®æ ‡ç±»è®¾ç½®ä¸ºçˆ¶ç±»ï¼ŒcglibåŠ¨æ€ä»£ç†å¢å¼ºçš„åŸç†å°±æ˜¯å­ç±»å¢å¼ºçˆ¶ç±»,cglibä¸èƒ½å¢å¼ºç›®æ ‡ç±»ä¸ºfinalçš„ç±» //å› ä¸ºfinalç±»ä¸èƒ½æœ‰å­ç±» enhancer.setSuperclass(this.object.getClass()); //è®¾ç½®å›è°ƒæ¥å£,è¿™é‡Œçš„MethodInterceptorå®ç°ç±»å›è°ƒæ¥å£ï¼Œè€Œæˆ‘ä»¬åˆå®ç°äº†MethodInterceptor,å…¶å® //è¿™é‡Œçš„å›è°ƒæ¥å£å°±æ˜¯æœ¬ç±»å¯¹è±¡,è°ƒç”¨çš„æ–¹æ³•å…¶å®å°±æ˜¯intercept()æ–¹æ³• enhancer.setCallback(this); //create()æ–¹æ³•ç”¨äºåˆ›å»ºcglibåŠ¨æ€ä»£ç†å¯¹è±¡ return enhancer.create(); &#125; //å›è°ƒæ¥å£çš„æ–¹æ³• //å›è°ƒæ¥å£çš„æ–¹æ³•æ‰§è¡Œçš„æ¡ä»¶æ˜¯ï¼šä»£ç†å¯¹è±¡æ‰§è¡Œç›®æ ‡æ–¹æ³•æ—¶ä¼šè°ƒç”¨å›è°ƒæ¥å£çš„æ–¹æ³• @Override public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable &#123; Object result = methodProxy.invokeSuper(o, objects); //è¿™é‡Œå®ç°å°†è¿”å›å€¼å­—ç¬¦ä¸²å˜ä¸ºå¤§å†™çš„é€»è¾‘ if(result != null) &#123; result = ((String) result).toUpperCase(); &#125; return result; &#125;&#125;// 4. æµ‹è¯•package AOP.Cglib;public class Test &#123; public static void main(String[] args) &#123; SomeService target = new SomeService(); SomeService proxy = (SomeService) new CglibFactory(target).myCglibCreator(); String result = proxy.doFirst(); System.out.println(result); proxy.doSecond(); &#125;&#125; Springä¸­ Ioc å’Œ DI è®²ä¸€ä¸‹ï¼Ÿ å‚è€ƒï¼šhttps://juejin.im/post/5df5bab0e51d45582427104e https://www.jianshu.com/p/17b66e6390fd IoC(Inversion of Control æ§åˆ¶åè½¬)ï¼šæ˜¯ä¸€ç§é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œç”¨æ¥å‡ä½è®¡ç®—æœºä»£ç ä¹‹é—´çš„è€¦åˆåº¦ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯ï¼šå€ŸåŠ©äºâ€œç¬¬ä¸‰æ–¹â€å®ç°å…·æœ‰ä¾èµ–å…³ç³»çš„å¯¹è±¡ä¹‹é—´çš„è§£è€¦ã€‚ DI(Dependence Injection ä¾èµ–æ³¨å…¥)ï¼šå°†å®ä¾‹å˜é‡ä¼ å…¥åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­å»(Dependency injection means giving an object its instance variables)ã€‚ ä¹Ÿå°±æ˜¯è¯´ DI æ˜¯ Ioc çš„ å®ç°ï¼ŒIoc æ˜¯ä¸€ç§è®¾è®¡åŸåˆ™ã€‚ Spring ä½œè€… Rod Johnson è®¾è®¡äº†ä¸¤ä¸ªæ¥å£ç”¨ä»¥è¡¨ç¤ºå®¹å™¨ã€‚ BeanFactory ApplicationContext BeanFactory ç²—æš´ç®€å•ï¼Œå¯ä»¥ç†è§£ä¸ºå°±æ˜¯ä¸ª HashMapï¼ŒKey æ˜¯ BeanNameï¼ŒValue æ˜¯ Bean å®ä¾‹ã€‚é€šå¸¸åªæä¾›æ³¨å†Œï¼ˆputï¼‰ï¼Œè·å–ï¼ˆgetï¼‰è¿™ä¸¤ä¸ªåŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸º â€œä½çº§å®¹å™¨â€ã€‚ ApplicationContext å¯ä»¥ç§°ä¹‹ä¸º â€œé«˜çº§å®¹å™¨â€ã€‚å› ä¸ºä»–æ¯” BeanFactory å¤šäº†æ›´å¤šçš„åŠŸèƒ½ã€‚ä»–ç»§æ‰¿äº†å¤šä¸ªæ¥å£ã€‚å› æ­¤å…·å¤‡äº†æ›´å¤šçš„åŠŸèƒ½ã€‚ä¾‹å¦‚èµ„æºçš„è·å–ï¼Œæ”¯æŒå¤šç§æ¶ˆæ¯ï¼ˆä¾‹å¦‚ JSP tag çš„æ”¯æŒï¼‰ï¼Œå¯¹ BeanFactory å¤šäº†å·¥å…·çº§åˆ«çš„æ”¯æŒç­‰å¾…ã€‚æ‰€ä»¥ä½ çœ‹ä»–çš„åå­—ï¼Œå·²ç»ä¸æ˜¯ BeanFactory ä¹‹ç±»çš„å·¥å‚äº†ï¼Œè€Œæ˜¯ â€œåº”ç”¨ä¸Šä¸‹æ–‡â€ï¼Œ ä»£è¡¨ç€æ•´ä¸ªå¤§å®¹å™¨çš„æ‰€æœ‰åŠŸèƒ½ã€‚è¯¥æ¥å£å®šä¹‰äº†ä¸€ä¸ª refresh æ–¹æ³•ï¼Œæ­¤æ–¹æ³•æ˜¯æ‰€æœ‰é˜…è¯» Spring æºç çš„äººçš„æœ€ç†Ÿæ‚‰çš„æ–¹æ³•ï¼Œç”¨äºåˆ·æ–°æ•´ä¸ªå®¹å™¨ï¼Œå³é‡æ–°åŠ è½½/åˆ·æ–°æ‰€æœ‰çš„ beanã€‚ Ioc çš„è¿‡ç¨‹ï¼š a. åŠ è½½é…ç½®æ–‡ä»¶ï¼Œè§£ææˆ BeanDefinition æ”¾åœ¨ Map é‡Œã€‚ b. è°ƒç”¨ getBean çš„æ—¶å€™ï¼Œä» BeanDefinition æ‰€å±çš„ Map é‡Œï¼Œæ‹¿å‡º Class å¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–ï¼ŒåŒæ—¶ï¼Œå¦‚æœæœ‰ä¾èµ–å…³ç³»ï¼Œå°†é€’å½’è°ƒç”¨ getBean æ–¹æ³• â€”â€” å®Œæˆä¾èµ–æ³¨å…¥ã€‚ ORMæ¡†æ¶æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿä»€ä¹ˆæ˜¯mysqlæ³¨å…¥ï¼Ÿ$ å’Œ # æœ‰ä»€ä¹ˆåŒºåˆ« JPAæ˜¯ormæ¡†æ¶æ ‡å‡†ï¼Œä¸»æµçš„ormæ¡†æ¶éƒ½å®ç°äº†è¿™ä¸ªæ ‡å‡†ã€‚ MyBatisæ²¡æœ‰å®ç°JPAï¼Œä»–å’Œormæ¡†æ¶çš„è®¾è®¡æ€è·¯å®Œå…¨ä¸ä¸€æ ·ã€‚MyBatisæ˜¯æ‹¥æŠ±sqlï¼Œè€Œormåˆ™æ›´é è¿‘é¢å‘å¯¹è±¡ï¼Œä¸å»ºè®®å†™sqlï¼Œå®åœ¨è¦å†™æ¨èä½ å†™hqlä»£æ›¿ã€‚ Mybatisæ˜¯sql mappingæ¡†æ¶è€Œä¸æ˜¯ormæ¡†æ¶ï¼Œå½“ç„¶ormå’ŒMybatiséƒ½æ˜¯æŒä¹…å±‚æ¡†æ¶ã€‚ æ‰€ä»¥è¯´hibernateæ˜¯å…¸å‹çš„ORMæ¡†æ¶ï¼Œå¥½å¤„å°±æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨é¢å‘å¯¹è±¡çš„æ€æƒ³å»å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œæˆ‘è§‰å¾—ä¸»è¦å°±æ˜¯æ¯”è¾ƒçœä»£ç ï¼Œè§£å†³é¢å‘å¯¹è±¡çš„è®¾è®¡æ–¹å¼å’Œå…³ç³»å‹æ•°æ®åº“ä¹‹é—´çš„å…³è”ï¼ŒJavaä¸»è¦é¢å‘å¯¹è±¡è®¾è®¡ï¼Œå› æ­¤åœ¨åˆ†æä¸šåŠ¡çš„æ—¶å€™ä¼šä»¥å¯¹è±¡çš„è§’åº¦æ¥çœ‹å¾…é—®é¢˜ã€‚ç„¶è€Œæ•°æ®åº“æ˜¯å…³ç³»å‹çš„ï¼Œå¯¹äºJavaç¨‹åºå‘˜è€Œè¨€æ˜¯ä¸ç¬¦åˆé¢å‘å¯¹è±¡è®¾è®¡çš„ï¼Œå› æ­¤æ‰ä¼šå‡ºç°ORMè¿™ç§ä¸œè¥¿ã€‚æœ‰äº†ORMï¼ŒJavaå¼€å‘äººå‘˜åœ¨æ•´ä¸ªä»£ç è®¾è®¡éƒ½å°†éµå¾ªå¯¹è±¡çš„æ€ç»´æ¨¡å¼ï¼Œè¿™å°±æ˜¯å¥½å¤„ã€‚ mysqlæ³¨å…¥ï¼šå‚æ•°è¿›è¡Œè½¬ä¹‰ä¸è¿‡æ»¤ å¦‚ä½•è§£å†³ï¼šä½¿ç”¨ Prepare Statement $ å’Œ # çš„åŒºåˆ«ï¼š Sql: delete from student where name=${name} å‡å¦‚ name = jerome OR 1 = 1 åœ¨ Mybatis ä¸­ï¼Œå¦‚æœå†™ ${name}ï¼Œé‚£å°±æ˜¯ç›´æ¥å°† name æ‹¼æ¥åˆ° sql ä¸­ï¼Œç»“å±€å°±æ˜¯å…¨åˆ ï¼› å¦‚æœå†™ #{name}ï¼Œåˆ™ sql å˜æˆ delete from student where name= â€™jerome OR 1 = 1â€˜ï¼Œè¿™æ ·åªæœ‰name = jerome OR 1 = 1 çš„æ‰ä¼šåˆ é™¤ï¼Œå¦åˆ™ä¸ä¼šåˆ é™¤ä»»ä½•ä¸œè¥¿ã€‚ 2020.3.31 20:02 - 20:45 ã€Œ43 åˆ†é’Ÿã€ é˜¿é‡Œä¸‰é¢ä»è¿™ä¸€é¢å¼€å§‹é¢è¯•å®˜å°±æ˜¯é˜¿é‡Œ P9 äº†ï¼Œæ‰€ä»¥è¯´å®è¯å‹åŠ›è¿˜æ˜¯éå¸¸å¤§çš„ï¼Œè¿™ä¸€é¢è¿˜æ˜¯è·Ÿå‰é¢ä¸€æ ·æ˜¯ç”µè¯é¢ã€‚è¿™ä¸€é¢åŸºæœ¬ä¸Šæ²¡æœ‰é—®ä»»ä½•åŸºç¡€ï¼Œå…¨éƒ¨åœ¨è®²é¡¹ç›®ï¼Œå»ºè®®å¤§å®¶ä¸€å®šè¦æœ‰ä¸€ä¸ªè®²çš„å¾ˆæºœçš„é¡¹ç›®ï¼Œæˆ‘å› ä¸ºæåŠäº†ä¸€ä¸‹æ¯•è®¾ï¼Œç„¶åå°±è¢«ä¸€ç›´æŠ“ç€é—®ï¼Œè€Œè‡ªå·±æœ¬èº«å…¶å®æ˜¯æ²¡æœ‰å¥½å¥½å‡†å¤‡è¿™ä¸ªé¡¹ç›®çš„ï¼Œæ‰€ä»¥æœ‰äº›é—®é¢˜ç«Ÿç„¶è¢«é—®äº†åï¼Œç­”å¾—ä¸æ˜¯ç‰¹åˆ«ç†æƒ³ã€‚ä½†æ˜¯è¿˜å¥½ï¼Œç­”å¾—ä¹Ÿæ²¡æœ‰å¾ˆå·®ï¼Œåé¢çš„é¡¹ç›®ä»‹ç»çš„è¿˜æ˜¯è®©é¢è¯•å®˜å¾ˆæ»¡æ„çš„ã€‚ ä»‹ç»å®Œåï¼Œé¢è¯•å®˜å¯èƒ½è§‰å¾—æ‰åŠå°æ—¶ï¼Œäºæ˜¯å°±é—®äº†å‡ ä¸ªé—®é¢˜ï¼Œåªæ˜¯æ¢å¯»ä¸€ä¸‹æˆ‘çŸ¥è¯†çš„å¹¿åº¦å§ï¼Œå…¨éƒ¨æ²¡æœ‰æ·±å…¥ã€‚ ä¾‹å¦‚ï¼š äº†è§£ tomcat å—ï¼Ÿã€Œå½“ç„¶äº†è¿™æ˜¯æˆ‘åœ¨è®²åŒäº²å§”æ´¾æ¨¡å‹å¼•ç”³å‡ºæ¥çš„ã€ ç”¨è¿‡ nginx å—ï¼Ÿ spring ä¸­ç”¨è¿‡å—ï¼Ÿ è¿™äº›ï¼Œæˆ‘å› ä¸ºè¯´ä¸å¤ªäº†è§£ or ç”¨è¿‡æ²¡æ·±å…¥ï¼Œæ‰€ä»¥é¢è¯•å®˜ä¹Ÿå°±ç´¢æ€§æ²¡æœ‰é—®ä¸‹å»ã€‚ æœ€åï¼ŒèŠ±äº†10åˆ†é’Ÿä»‹ç»äº†ä¸‹è‡ªå·±çš„éƒ¨é—¨ï¼Œç„¶åå°±åˆ°äº†åè½¬ç¯èŠ‚äº†ï¼Œæˆ‘è§‰å¾—å¤§å®¶å¯ä»¥å¥½å¥½æŠ“ä½åè½¬ç¯èŠ‚ï¼Œå› ä¸ºæˆ‘ä»¬å¾€å¾€å¯ä»¥ä»è¿™ä¸ªç¯èŠ‚æ¢åˆ°é¢è¯•å®˜å¯¹æœ¬æ¬¡é¢è¯•çš„çœ‹æ³•ï¼Œæ¯”å¦‚ï¼Œæˆ‘é—®çš„ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼š â€æˆ‘è§‰å¾—ä»Šå¤©çš„è¡¨ç°ä¸æ˜¯å¾ˆå¥½ï¼Œç¬¬ä¸€ä¸ªé¡¹ç›®æ²¡è®²çš„éå¸¸æ¸…æ¥šï¼Œæ‚¨åé¢é—®çš„å‡ ä¸ªçŸ¥è¯†ç‚¹æˆ‘ä¹Ÿä¸å¤ªä¼šï¼Œæ²¡æ·±å…¥äº†è§£è¿‡ã€‚â€œ å¾ˆè®©æˆ‘æ„å¤–çš„æ˜¯ï¼Œé¢è¯•å®˜ç»™æˆ‘çš„å›ç­”è®©æˆ‘å¤‡å—é¼“èˆï¼š â€å‰é¢å¯èƒ½æ˜¯ä½ å¤ªç€æ€¥å¤ªç´§å¼ äº†ï¼Œæ‰€ä»¥è®²çš„ä¸æ˜¯å¾ˆå¥½ï¼Œä½†æ˜¯åé¢è®²çš„å¾ˆæ¸…æ¥šäº†ï¼Œä¹Ÿèƒ½å¬å¾—å‡ºæ¥å…¨æ˜¯è‡ªå·±ç”¨å¿ƒåšäº†çš„ï¼Œæˆ‘ä¹Ÿå¬æ˜ç™½äº†ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒï¼Œè‡³äºåé¢çš„çŸ¥è¯†ç‚¹ä¸ä¼šä¹Ÿéå¸¸æ­£å¸¸ï¼Œä½ è¿˜å¹´è½»çš„å¾ˆï¼Œä¸ä¼šæ˜¯éå¸¸æ­£å¸¸çš„ï¼Œä½ è¦éƒ½ä¼šäº†æˆ‘è¿˜éœ€è¦åœ¨è¿™å—ï¼Ÿä½ è¿˜å¹´è½»ï¼Œæ˜¯éå¸¸æœ‰æ½œåŠ›çš„ã€‚â€œ è‡³æ­¤ï¼Œå¼€å§‹æœŸå¾…å››é¢å“ˆå“ˆå“ˆå“ˆã€‚ 2020.4.01 23:04 - 00:05 ã€Œ61 åˆ†é’Ÿã€ é˜¿é‡Œå››é¢åœ¨å››é¢ä¹‹å‰ï¼Œå‡ºç°äº†ä¸ªå°æ’æ›²ã€‚å°±æ˜¯é¢è¯•å®˜ä¸Šåˆä¼°è®¡æ˜¯æœ‰è·Ÿæˆ‘æ‰“è¿‡ç”µè¯ï¼Œä½†æ˜¯è²Œä¼¼è·Ÿé¥¿äº†ä¹ˆçš„å¤–å–å‘˜è·Ÿæˆ‘æ‰“ç”µè¯å†²çªäº†ã€Œåº”è¯¥éƒ½æ˜¯èµ°çš„é˜¿é‡Œçš„ç”µè¯ç³»ç»Ÿã€ï¼Œå¯¼è‡´æˆ‘å‹æ ¹æ²¡æ¥åˆ°ç”µè¯ã€Œå¤–å–å‘˜è¿˜è¯´ç»™æˆ‘æ‰“ç”µè¯æˆ‘ä¸€ç›´ä¸æ¥ï¼Œæˆ‘è¯´æˆ‘å‹æ ¹æ²¡æ¥åˆ°ç”µè¯â€¦ã€ï¼Œæœ€åè¿˜æ˜¯ä¸‹åˆ5ç‚¹çš„æ—¶å€™äºŒé¢çš„é¢è¯•å®˜æ‰“ç”µè¯ç»™æˆ‘å«æˆ‘æ³¨æ„ä¸€ä¸‹ç”µè¯â€¦æˆ‘å½“æ—¶ä¸€è„¸æ‡µé€¼â€¦æ‰€ä»¥è¯´å…³é”®æ—¶åˆ»ä¸è¦ç‚¹é¥¿äº†ä¹ˆå¤–å–â€¦â€¦. ç„¶åçº¦çš„ 8 ç‚¹åŠï¼Œä½†æ˜¯æˆ‘å› ä¸ºæœ‰æºç¨‹çš„ç¬”è¯•æ¨åˆ°äº†æ™šä¸Š 10 ç‚¹åŠï¼Œç„¶å 10 ç‚¹æˆ‘å°±å¼€å§‹ååœ¨æ¡Œå‰ç­‰ï¼Œè¯´çœŸçš„æœ‰ç‚¹ç´§å¼ ï¼Œæ¯•ç«Ÿè¿™é¢æ˜¯äº¤å‰é¢ï¼Œåˆæ˜¯ä¸€ä¸ª P9 å¤§ä½¬â€¦ç­‰å•Šç­‰ï¼Œä¸€ç›´ç­‰åˆ°æ™šä¸Š 11 ç‚¹é¢è¯•å®˜éƒ½æ²¡æœ‰å‡ºç°ï¼Œæˆ‘ä¸€åº¦æ€€ç–‘æ˜¯æˆ‘å¬é”™äº†æ—¶é—´ï¼Œçªç„¶ï¼Œ11:04ï¼Œé¢è¯•å®˜éå¸¸æŠ±æ­‰çš„æ‰“å¼€æ—¶è§†é¢‘ï¼Œç»ˆäºçœ‹åˆ°äº†â€¦äºæ˜¯é¢è¯•æ­£å¼å¼€å§‹â€¦ è§†é¢‘é¢ã€‚æœ‰ç‚¹å¤ªæ™šäº†ï¼Œæ‰€ä»¥è‡ªå·±åœ¨é¢ä¹‹å‰ä¹Ÿæ˜¯æœ‰è·Ÿé¢è¯•å®˜äº¤ä»£ï¼Œå¯èƒ½ååº”ä¼šæ…¢ä¸€äº›â€¦é¢è¯•å®˜è¿˜æ˜¯éå¸¸ç†è§£çš„ï¼Œç„¶åè¿™ä¸€é¢å¯ä»¥è¯´æ˜¯è¿™åŠä¸ªå¤šæœˆæ¥é¢çš„æœ€æ£’çš„ä¸€æ¬¡äº†ï¼Œä¸‹é¢æ˜¯ä¸»è¦å†…å®¹ï¼š é¢è¯•ä¾æ—§æ˜¯ä»é¡¹ç›®å‡ºå‘ï¼Œæ³¨æ„ï¼Œé˜¿é‡Œåé¢å››é¢åŸºæœ¬ä¸Šå…¨éƒ¨å›´ç»•é¡¹ç›®å±•å¼€ï¼Œæ‰€ä»¥åŠ¡å¿…è¦æœ‰ä¸€ä¸ªåƒé€çš„é¡¹ç›®ï¼Œäº†è§£å…¶ä¸­ç”¨åˆ°çš„æŠ€æœ¯æ ˆï¼Œå¹¶ä¸”å»¶ä¼¸åˆ°æ“ä½œç³»ç»Ÿçº§åˆ«çš„è°ƒç”¨ï¼ŒåŒæ—¶è¦å…³æ³¨é¡¹ç›®ä¸­é‡åˆ°çš„éš¾ç‚¹ä»¥åŠè‡ªå·±æ˜¯å¦‚ä½•è§£å†³çš„ï¼Œè¿™æ˜¯æœ€æœ€æœ€é«˜é¢‘çš„é—®é¢˜äº†ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸€é¢çš„é¢è¯•å®˜éƒ½æœ‰é—®è¿™ä¸ªé—®é¢˜ã€‚ åŒæ—¶ï¼Œä¸€å®šè¦å°†é¡¹ç›®ä¸­çš„æŸäº›éƒ¨é—¨è½¬ç§»åˆ°è‡ªå·±æ“…é•¿çš„é¢†åŸŸï¼Œæ¯”å¦‚æˆ‘è®²çš„é¡¹ç›®ä¸­å…¶å®å°±æ˜¯ä¸€ä¸ªçˆ¬è™«é¡¹ç›®ï¼Œä½†æ˜¯å¯ä»¥æ‰©å±•çš„åœ°æ–¹å¤ªå¤šäº†ï¼Œæˆ‘å°±ä¸¾å‡ ä¸ªä¾‹å­ï¼š è®²åˆ°çˆ¬è™«ï¼Œé‚£åŠ¡å¿…è¦è®²åçˆ¬æªæ–½ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä»¥å±•å¼€çš„ç‚¹ï¼Œå¯ä»¥è®²å¾ˆä¹…ï¼Œè®²åçˆ¬å¦‚ä½•è§£å†³ï¼› ä¸­é—´ä»¶ç”¨åˆ°kafkaï¼Œè¿™åˆæ˜¯ä¸€å¤§å—å¯ä»¥è®²çš„ï¼Œkafka çš„é€šä¿¡æœºåˆ¶ï¼Œä»¥åŠå†…éƒ¨æ„é€ ï¼Œä»¥åŠé«˜å¯ç”¨æœºåˆ¶å’Œååé‡å¤§ï¼› è°ˆåˆ° kafka çš„ååé‡å¤§ï¼Œåˆå¯ä»¥æ€»ç»“ä¸€æ³¢ä¸ºä½•ååé‡å¤§ï¼Œç„¶åå»¶ä¼¸åˆ° NIO å’Œ é›¶æ‹·è´æŠ€æœ¯ï¼Œåˆå¯ä»¥è®²ä¸€å †ï¼› è®²åˆ° NIOï¼Œåˆå¯ä»¥è®² IO é‚£ä¸€å¤§å—çŸ¥è¯†ç‚¹ï¼ŒåŒæ—¶è°ˆåˆ° NIO å¿…å®šä¼šè°ˆåˆ° select/epollï¼Œè¿™æ ·åˆå¯ä»¥è®²å¾ˆå¤šã€‚ æ€»ä¹‹ï¼Œè¿™äº›çŸ¥è¯†ï¼Œè‡ªå·±éƒ½æ˜¯å¯ä»¥æå‰å‡†å¤‡å¥½çš„ï¼Œç„¶ååˆ°æ—¶å€™é¢è¯•æŠ›å‡ºæ¥å°±è¡Œäº†ï¼Œé¢è¯•å®˜ä¸€èˆ¬éƒ½ä¼šé¡ºç€ä½ çš„æ€è·¯è¿›è¡Œä¸‹å»çš„ï¼Œè¦æŠŠè¯è¯­æƒæŒæ¡åœ¨è‡ªå·±çš„æ‰‹ä¸Šï¼Œä¸€å®šè¦è®°å¾—ç‰¹æ„çš„æŠ›å‡ºæŸäº›çŸ¥è¯†ç‚¹ã€Œè¿™é‡Œçš„ç‰¹æ„æ˜¯æŒ‡è·Ÿä½ çš„é¡¹ç›®æŒ‚é’©çš„ã€ åŒæ—¶ï¼Œæˆ‘å‘ç°ä»ä¸‰é¢åˆ°å››é¢ï¼Œéƒ½æœ‰å»å…³å¿ƒï¼Œè‡ªå·±åœ¨é¡¹ç›®ä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼ä»¥åŠè‡ªå·±çœ‹æºç å‘ç°çš„ä¸€äº›è®¾è®¡æ¨¡å¼ã€‚ æˆ‘ä¹‹å‰åªå‡†å¤‡äº†ä¸‰ç§è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”è‡ªå·±äº²è‡ªå†™äº†ä¸€äº›å°demoï¼š å•ä¾‹æ¨¡å¼ï¼Œå››é¢å°±é—®äº†è¿™ä¸ªï¼Œè°ˆä»€ä¹ˆæ˜¯é¥¿æ±‰æ¨¡å¼å’Œæ‡’æ±‰æ¨¡å¼ï¼› 12345678910&gt; // é¥¿æ±‰&gt; public class Singleton &#123;&gt; // ç±»åŠ è½½æ—¶å°±åˆå§‹åŒ–&gt; private static final Singleton instance = new Singleton();&gt; private Singleton() &#123;&#125;&gt; public static Singleton getInstance()&#123;&gt; return instance;&gt; &#125;&gt; &#125;&gt; 123456789101112&gt; // æ‡’æ±‰&gt; public class Singleton &#123;&gt; private static Singleton instance;&gt; private Singleton () &#123;&#125;&gt; public static Singleton getInstance() &#123;&gt; if (instance == null) &#123;&gt; instance = new Singleton();&gt; &#125;&gt; return instance;&gt; &#125;&gt; &#125;&gt; æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œè¿™ä¸ªæ˜¯IOå»¶ä¼¸è¿‡æ¥çš„çŸ¥è¯†ç‚¹ï¼Œç„¶åæˆ‘é¡ºå¸¦æäº†ä¸€ä¸‹ AQSï¼› IO å’Œ AQS éƒ½ç”¨äº†æ¨¡æ¿æ–¹æ³•çš„è®¾è®¡æ¨¡å¼ã€‚ ä»£ç†æ¨¡å¼ï¼Œæäº†ä¸€ä¸‹åŠ¨æ€ä»£ç†ï¼Œä»¥åŠSpringä¸­çš„ AOPã€‚ ä¸Šé¢å·²ç»æ€»ç»“äº† ç„¶åå°±æ˜¯ä¸€äº›æ¯”è¾ƒç®€å•çš„é—®é¢˜ï¼š ä¸ºä½•è¦åˆ†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œå¦‚ä½•åŒºåˆ†çš„ï¼Ÿ è¿™ä¸ªæˆ‘åœ¨ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬”è®°ã€‹ä¸­æœ‰éå¸¸è¯¦ç»†çš„è°ˆåˆ°ï¼Œå¹¶ä¸”æˆ‘åœ¨ â€œè…¾è®¯äºŒé¢â€è¿™éƒ¨åˆ†ä¹Ÿæœ‰å¾ˆè¯¦ç»†çš„æ€»ç»“ï¼å¯ä»¥å¾€ä¸Šç¿»ç¿»çœ‹åˆ°ã€‚ Full gc å¦‚ä½•æ’æŸ¥ï¼Ÿ å…ˆçœ‹ä¸€ä¸‹ç›¸å…³çš„å›¾å½¢åŒ–ç•Œé¢ï¼Œçœ‹æ¯ä¸€æ¬¡ full gcåå¯¹è±¡çš„å­˜æ´»ç‡ å¦‚æœå­˜æ´»ç‡é«˜ï¼Œå¯èƒ½æ˜¯è€å¹´ä»£çš„å†…å­˜å¤ªå°äº†ï¼Œå¯¼è‡´å¾ˆå®¹æ˜“è§¦å‘ full gcï¼› å¦‚æœå­˜æ´»ç‡ä½ï¼Œè¯´æ˜å¯èƒ½æ˜¯å¾ˆå¤šå¤§å¯¹è±¡è¿›å…¥åˆ°è€å¹´ä»£åŒºåŸŸï¼Œä¸»è¦æ˜¯å¯èƒ½è‡ªå·±ä»£ç å†™çš„æœ‰ç‚¹é—®é¢˜ï¼Œæˆ–è€…è¯´æ˜å¯èƒ½æ˜¯ eden åŒºå¤ªå°äº†ï¼Œå¯¼è‡´å¹´è½»ä»£å¾ˆå®¹æ˜“å°±è¿›å…¥äº†è€å¹´ä»£åŒºåŸŸã€‚ è®²ä¸€è®² synchronized å’Œ Lock çš„åŒºåˆ«ï¼Œä»¥åŠ ThreadLocalï¼Ÿ Synchronized å’Œ lock æœ€å…¸å‹çš„å‡ ä¸ªåŒºåˆ«ï¼š synchronized å…³é”®å­—ï¼Œjvmå±‚é¢ï¼›lock æ˜¯ç±»ï¼Œjdkå±‚é¢ï¼› synchronized ä¸æ”¯æŒä¸­æ–­ï¼Œlockæ”¯æŒï¼› synchronizedå¦‚æœé˜»å¡äº†ä¼šä¸€ç›´ç­‰å¾…ï¼Œè€Œlockå¯ä»¥å®šæ—¶å–æ¶ˆç­‰å¾…ï¼› synchronizedåªèƒ½æœ‰ä¸€ä¸ªæ¡ä»¶é˜Ÿåˆ—ï¼Œè€Œlockå¯ä»¥æœ‰å¤šä¸ªã€‚ ThreadLocal ä¸»è¦è°ˆåˆ° ThreadLocalMapï¼Œæ³¨æ„å®ƒæ˜¯çº¿æ€§æ¢æµ‹æ³•è§£å†³çš„å†²çªï¼Œå¹¶ä¸”åŠ è½½å› å­ä¸º2/3ï¼Œåˆå§‹å€¼16ï¼Œå½“ç„¶è¿˜å¾—è°ˆåˆ°å…¶å†…å­˜æ³„æ¼é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨å¼±å¼•ç”¨ä»¥åŠç”¨ä¸€äº›æ–¹æ³•å¤„ç†è„ Entry ï¼Œå½“ç„¶å¹¶ä¸èƒ½å®Œå…¨é¿å…å†…å­˜æ³„æ¼ï¼Œä½†æ˜¯åªè¦ä½ ä¸å’Œçº¿ç¨‹æ± æåœ¨ä¸€å—å°±åº”è¯¥ä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚ ç½‘ç»œä¸­çš„åŠ å¯†ç®—æ³•æœ‰äº†è§£å—ï¼Ÿ å¿…é¡»äº†è§£ã€‚ ä»httpsã€Œä¸Šé¢å·²ç»è®²è¿‡äº†ã€ï¼Œåˆ° RSA åŠ å¯†ç®—æ³•ï¼Œå†åˆ°å¯¹ç§°éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå†åˆ° token ç­‰ç­‰ã€‚ è®²è®²éå¯¹ç§°å’Œå¯¹ç§°åŠ å¯†ç®—æ³•ã€Œè¿™å—æˆ‘è®²äº†md5ç®—æ˜¯ï¼Œå¾ˆæ˜æ˜¾é¢è¯•å®˜è¯´ä¸æ˜¯ã€ ä¸¥æ ¼æ¥è¯´ï¼šMD5ã€sha-1åªæ˜¯æ•£åˆ—ç®—æ³•ï¼Œæˆ–è€…å«æ‘˜è¦ç®—æ³•ï¼Œä¸èƒ½ç®—åŠ å¯†ç®—æ³•ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒMD5 æ˜¯ä¸å¯é€†çš„ï¼Œä½ æ ¹æœ¬è§£ä¸äº†ï¼Œè€Œå¯¹ç§°éå¯¹ç§°åŠ å¯†ç®—æ³•æ˜¯å¯é€†çš„ï¼Œå¯ä»¥é€šè¿‡å¯†æ–‡å¾—åˆ°æ˜æ–‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ˜æ–‡å¾—åˆ°å¯†æ–‡ã€‚ åŠ å¯†å¯¹åº”è§£å¯†ï¼Œå³åŠ å¯†åçš„å¯†æ–‡å¯ä»¥è§£å¯†æˆæ˜æ–‡ï¼Œä½†æ˜¯MD5æ— æ³•ä»å¯†æ–‡ï¼ˆæ•£åˆ—å€¼ï¼‰åè¿‡æ¥å¾—åˆ°åŸæ–‡ï¼Œå³æ²¡æœ‰è§£å¯†ç®—æ³•ã€‚ å¤§å®¶çŸ¥é“åŠ å¯†ç®—æ³•åˆ†ä¸ºå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ï¼Œä¸ç®¡å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ï¼Œéƒ½æ˜¯èƒ½å¤Ÿä»å¯†æ–‡è§£å¯†å¾—åˆ°æ˜æ–‡çš„ã€‚ä»è¿™ç‚¹ä¸Šè®²MD5ä¸æ˜¯åŠ å¯†ç®—æ³•ï¼Œæ›´è°ˆä¸ä¸Šå±äºå¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€‚æ‰€ä»¥ä¸è¦å†è®¨è®ºMD5æ˜¯å±äºå¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†äº†ï¼ŒMD5æ—¢ä¸å±äºå¯¹ç§°åŠ å¯†ä¹Ÿä¸å±äºéå¯¹ç§°åŠ å¯†ï¼ŒMD5æ ¹æœ¬å°±æ²¡æ³•è§£å¯†ï¼Œä¹Ÿæ²¡æœ‰ç§˜é’¥ï¼ˆåŠ ç›å¹¶ä¸æ˜¯ç§˜é’¥ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥è®¤ä¸ºMD5ä¸å±äºåŠ å¯†ç®—æ³•ã€‚ ä¸€äº›äººè®¤ä¸ºMD5å¤„ç†åçœ‹ä¸åˆ°åŸæ–‡ï¼Œå³å·²ç»å°†åŸæ–‡åŠ å¯†ï¼Œæ‰€ä»¥è®¤ä¸ºMD5å±äºåŠ å¯†ç®—æ³•ã€‚å¦‚æœè¿™ä¹ˆçœ‹çš„ï¼Œé‚£ä¹ˆæ±‚ä½™ä¹Ÿå¯ä»¥ç®—åŠ å¯†ç®—æ³•äº†ã€‚ ä½œè€…ï¼šGeCoderé“¾æ¥ï¼šhttps://www.zhihu.com/question/68735830/answer/327762693æ¥æºï¼šçŸ¥ä¹è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ æ‰€ä»¥ï¼Œmd5 å¹¶ä¸æ˜¯åŠ å¯†ç®—æ³•ï¼Œé‚£å…¸å‹çš„åŠ å¯†ç®—æ³•æœ‰å“ªäº›å‘¢ï¼Ÿ åŠ å¯†æŠ€æœ¯é€šå¸¸åˆ†ä¸ºä¸¤å¤§ç±»:â€å¯¹ç§°å¼â€å’Œâ€éå¯¹ç§°å¼â€ã€‚ å¯¹ç§°æ€§åŠ å¯†ç®—æ³•ï¼šå¯¹ç§°å¼åŠ å¯†å°±æ˜¯åŠ å¯†å’Œè§£å¯†ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥ã€‚ä¿¡æ¯æ¥æ”¶åŒæ–¹éƒ½éœ€äº‹å…ˆçŸ¥é“å¯†åŒ™å’ŒåŠ è§£å¯†ç®—æ³•ä¸”å…¶å¯†åŒ™æ˜¯ç›¸åŒçš„ï¼Œä¹‹åä¾¿æ˜¯å¯¹æ•°æ®è¿›è¡ŒåŠ è§£å¯†äº†ã€‚å¯¹ç§°åŠ å¯†ç®—æ³•ç”¨æ¥å¯¹æ•æ„Ÿæ•°æ®ç­‰ä¿¡æ¯è¿›è¡ŒåŠ å¯†ã€‚ éå¯¹ç§°ç®—æ³•ï¼šéå¯¹ç§°å¼åŠ å¯†å°±æ˜¯åŠ å¯†å’Œè§£å¯†æ‰€ä½¿ç”¨çš„ä¸æ˜¯åŒä¸€ä¸ªå¯†é’¥ï¼Œé€šå¸¸æœ‰ä¸¤ä¸ªå¯†é’¥ï¼Œç§°ä¸ºâ€å…¬é’¥â€å’Œâ€ç§é’¥â€ï¼Œå®ƒä»¬ä¸¤ä¸ªå¿…éœ€é…å¯¹ä½¿ç”¨ï¼Œå¦åˆ™ä¸èƒ½æ‰“å¼€åŠ å¯†æ–‡ä»¶ã€‚å‘é€åŒæ–¹A,Bäº‹å…ˆå‡ç”Ÿæˆä¸€å †å¯†åŒ™ï¼Œç„¶åAå°†è‡ªå·±çš„å…¬æœ‰å¯†åŒ™å‘é€ç»™Bï¼ŒBå°†è‡ªå·±çš„å…¬æœ‰å¯†åŒ™å‘é€ç»™Aï¼Œå¦‚æœAè¦ç»™Bå‘é€æ¶ˆæ¯ï¼Œåˆ™å…ˆéœ€è¦ç”¨Bçš„å…¬æœ‰å¯†åŒ™è¿›è¡Œæ¶ˆæ¯åŠ å¯†ï¼Œç„¶åå‘é€ç»™Bç«¯ï¼Œæ­¤æ—¶Bç«¯å†ç”¨è‡ªå·±çš„ç§æœ‰å¯†åŒ™è¿›è¡Œæ¶ˆæ¯è§£å¯†ï¼ŒBå‘Aå‘é€æ¶ˆæ¯æ—¶ä¸ºåŒæ ·çš„é“ç†ã€‚ æ•£åˆ—ç®—æ³•ï¼šæ•£åˆ—ç®—æ³•ï¼Œåˆç§°å“ˆå¸Œå‡½æ•°ï¼Œæ˜¯ä¸€ç§å•å‘åŠ å¯†ç®—æ³•ã€‚åœ¨ä¿¡æ¯å®‰å…¨æŠ€æœ¯ä¸­ï¼Œç»å¸¸éœ€è¦éªŒè¯æ¶ˆæ¯çš„å®Œæ•´æ€§ï¼Œæ•£åˆ—(Hash)å‡½æ•°æä¾›äº†è¿™ä¸€æœåŠ¡ï¼Œå®ƒå¯¹ä¸åŒé•¿åº¦çš„è¾“å…¥æ¶ˆæ¯ï¼Œäº§ç”Ÿå›ºå®šé•¿åº¦çš„è¾“å‡ºã€‚è¿™ä¸ªå›ºå®šé•¿åº¦çš„è¾“å‡ºç§°ä¸ºåŸè¾“å…¥æ¶ˆæ¯çš„â€æ•£åˆ—â€æˆ–â€æ¶ˆæ¯æ‘˜è¦â€(Message digest)ã€‚æ•£åˆ—ç®—æ³•ä¸ç®—åŠ å¯†ç®—æ³•ï¼Œå› ä¸ºå…¶ç»“æœæ˜¯ä¸å¯é€†çš„ï¼Œæ—¢ç„¶æ˜¯ä¸å¯é€†çš„ï¼Œé‚£ä¹ˆå½“ç„¶ä¸æ˜¯ç”¨æ¥åŠ å¯†çš„ï¼Œè€Œæ˜¯ç­¾åã€‚ å¯¹ç§°æ€§åŠ å¯†ç®—æ³•æœ‰ï¼šAESã€DESã€3DESç”¨é€”ï¼šå¯¹ç§°åŠ å¯†ç®—æ³•ç”¨æ¥å¯¹æ•æ„Ÿæ•°æ®ç­‰ä¿¡æ¯è¿›è¡ŒåŠ å¯† DESï¼ˆData Encryption Standardï¼‰ï¼šæ•°æ®åŠ å¯†æ ‡å‡†ï¼Œé€Ÿåº¦è¾ƒå¿«ï¼Œé€‚ç”¨äºåŠ å¯†å¤§é‡æ•°æ®çš„åœºåˆã€‚ 3DESï¼ˆTriple DESï¼‰ï¼šæ˜¯åŸºäºDESï¼Œå¯¹ä¸€å—æ•°æ®ç”¨ä¸‰ä¸ªä¸åŒçš„å¯†é’¥è¿›è¡Œä¸‰æ¬¡åŠ å¯†ï¼Œå¼ºåº¦æ›´é«˜ã€‚ AESï¼ˆAdvanced Encryption Standardï¼‰ï¼šé«˜çº§åŠ å¯†æ ‡å‡†ï¼Œæ˜¯ä¸‹ä¸€ä»£çš„åŠ å¯†ç®—æ³•æ ‡å‡†ï¼Œé€Ÿåº¦å¿«ï¼Œå®‰å…¨çº§åˆ«é«˜ï¼›AESæ˜¯ä¸€ä¸ªä½¿ç”¨128ä¸ºåˆ†ç»„å—çš„åˆ†ç»„åŠ å¯†ç®—æ³•ï¼Œåˆ†ç»„å—å’Œ128ã€192æˆ–256ä½çš„å¯†é’¥ä¸€èµ·ä½œä¸ºè¾“å…¥ï¼Œå¯¹4Ã—4çš„å­—èŠ‚æ•°ç»„ä¸Šè¿›è¡Œæ“ä½œã€‚ä¼—æ‰€å‘¨ä¹‹AESæ˜¯ç§ååˆ†é«˜æ•ˆçš„ç®—æ³•ï¼Œå°¤å…¶åœ¨8ä½æ¶æ„ä¸­ï¼Œè¿™æºäºå®ƒé¢å‘å­—èŠ‚çš„è®¾è®¡ã€‚AES é€‚ç”¨äº8ä½çš„å°å‹å•ç‰‡æœºæˆ–è€…æ™®é€šçš„32ä½å¾®å¤„ç†å™¨,å¹¶ä¸”é€‚åˆç”¨ä¸“é—¨çš„ç¡¬ä»¶å®ç°ï¼Œç¡¬ä»¶å®ç°èƒ½å¤Ÿä½¿å…¶ååé‡ï¼ˆæ¯ç§’å¯ä»¥åˆ°è¾¾çš„åŠ å¯†/è§£å¯†bitæ•°ï¼‰è¾¾åˆ°åäº¿é‡çº§ã€‚åŒæ ·ï¼Œå…¶ä¹Ÿé€‚ç”¨äºRFIDç³»ç»Ÿã€‚ éå¯¹ç§°æ€§ç®—æ³•æœ‰ï¼šRSAã€DSAã€ECC RSAï¼šç”± RSA å…¬å¸å‘æ˜ï¼Œæ˜¯ä¸€ä¸ªæ”¯æŒå˜é•¿å¯†é’¥çš„å…¬å…±å¯†é’¥ç®—æ³•ï¼Œéœ€è¦åŠ å¯†çš„æ–‡ä»¶å—çš„é•¿åº¦ä¹Ÿæ˜¯å¯å˜çš„ã€‚RSAåœ¨å›½å¤–æ—©å·²è¿›å…¥å®ç”¨é˜¶æ®µï¼Œå·²ç ”åˆ¶å‡ºå¤šç§é«˜é€Ÿçš„RSAçš„ä¸“ç”¨èŠ¯ç‰‡ã€‚ DSAï¼ˆDigital Signature Algorithmï¼‰ï¼šæ•°å­—ç­¾åç®—æ³•ï¼Œæ˜¯ä¸€ç§æ ‡å‡†çš„ DSSï¼ˆæ•°å­—ç­¾åæ ‡å‡†ï¼‰ï¼Œä¸¥æ ¼æ¥è¯´ä¸ç®—åŠ å¯†ç®—æ³•ã€‚ ECCï¼ˆElliptic Curves Cryptographyï¼‰ï¼šæ¤­åœ†æ›²çº¿å¯†ç ç¼–ç å­¦ã€‚ECCå’ŒRSAç›¸æ¯”ï¼Œå…·æœ‰å¤šæ–¹é¢çš„ç»å¯¹ä¼˜åŠ¿ï¼Œä¸»è¦æœ‰ï¼šæŠ—æ”»å‡»æ€§å¼ºã€‚ç›¸åŒçš„å¯†é’¥é•¿åº¦ï¼Œå…¶æŠ—æ”»å‡»æ€§è¦å¼ºå¾ˆå¤šå€ã€‚è®¡ç®—é‡å°ï¼Œå¤„ç†é€Ÿåº¦å¿«ã€‚ECCæ€»çš„é€Ÿåº¦æ¯”RSAã€DSAè¦å¿«å¾—å¤šã€‚å­˜å‚¨ç©ºé—´å ç”¨å°ã€‚ECCçš„å¯†é’¥å°ºå¯¸å’Œç³»ç»Ÿå‚æ•°ä¸RSAã€DSAç›¸æ¯”è¦å°å¾—å¤šï¼Œæ„å‘³ç€å®ƒæ‰€å çš„å­˜è´®ç©ºé—´è¦å°å¾—å¤šã€‚è¿™å¯¹äºåŠ å¯†ç®—æ³•åœ¨ICå¡ä¸Šçš„åº”ç”¨å…·æœ‰ç‰¹åˆ«é‡è¦çš„æ„ä¹‰ã€‚å¸¦å®½è¦æ±‚ä½ã€‚å½“å¯¹é•¿æ¶ˆæ¯è¿›è¡ŒåŠ è§£å¯†æ—¶ï¼Œä¸‰ç±»å¯†ç ç³»ç»Ÿæœ‰ç›¸åŒçš„å¸¦å®½è¦æ±‚ï¼Œä½†åº”ç”¨äºçŸ­æ¶ˆæ¯æ—¶ECCå¸¦å®½è¦æ±‚å´ä½å¾—å¤šã€‚å¸¦å®½è¦æ±‚ä½ä½¿ECCåœ¨æ— çº¿ç½‘ç»œé¢†åŸŸå…·æœ‰å¹¿æ³›çš„åº”ç”¨å‰æ™¯ã€‚ æ•£åˆ—ç®—æ³•ï¼ˆç­¾åç®—æ³•ï¼‰æœ‰ï¼šMD5ã€SHA1ã€HMACç”¨é€”ï¼šä¸»è¦ç”¨äºéªŒè¯ï¼Œé˜²æ­¢ä¿¡æ¯è¢«ä¿®ã€‚å…·ä½“ç”¨é€”å¦‚ï¼šæ–‡ä»¶æ ¡éªŒã€æ•°å­—ç­¾åã€é‰´æƒåè®® MD5ï¼šMD5æ˜¯ä¸€ç§ä¸å¯é€†çš„åŠ å¯†ç®—æ³•ï¼Œç›®å‰æ˜¯æœ€ç‰¢é çš„åŠ å¯†ç®—æ³•ä¹‹ä¸€ï¼Œå°šæ²¡æœ‰èƒ½å¤Ÿé€†è¿ç®—çš„ç¨‹åºè¢«å¼€å‘å‡ºæ¥ï¼Œå®ƒå¯¹åº”ä»»ä½•å­—ç¬¦ä¸²éƒ½å¯ä»¥åŠ å¯†æˆä¸€æ®µå”¯ä¸€çš„å›ºå®šé•¿åº¦çš„ä»£ç ã€‚ SHA1ï¼šæ˜¯ç”±NISTNSAè®¾è®¡ä¸ºåŒDSAä¸€èµ·ä½¿ç”¨çš„ï¼Œå®ƒå¯¹é•¿åº¦å°äº264çš„è¾“å…¥ï¼Œäº§ç”Ÿé•¿åº¦ä¸º160bitçš„æ•£åˆ—å€¼ï¼Œå› æ­¤æŠ—ç©·ä¸¾(brute-force)æ€§æ›´å¥½ã€‚SHA-1è®¾è®¡æ—¶åŸºäºå’ŒMD4ç›¸åŒåŸç†,å¹¶ä¸”æ¨¡ä»¿äº†è¯¥ç®—æ³•ã€‚SHA-1æ˜¯ç”±ç¾å›½æ ‡å‡†æŠ€æœ¯å±€ï¼ˆNISTï¼‰é¢å¸ƒçš„å›½å®¶æ ‡å‡†ï¼Œæ˜¯ä¸€ç§åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„Hashå‡½æ•°ç®—æ³•ï¼Œä¹Ÿæ˜¯ç›®å‰æœ€å…ˆè¿›çš„åŠ å¯†æŠ€æœ¯ï¼Œè¢«æ”¿åºœéƒ¨é—¨å’Œç§è¥ä¸šä¸»ç”¨æ¥å¤„ç†æ•æ„Ÿçš„ä¿¡æ¯ã€‚è€ŒSHA-1åŸºäºMD5ï¼ŒMD5åˆåŸºäºMD4ã€‚ HMACï¼šæ˜¯å¯†é’¥ç›¸å…³çš„å“ˆå¸Œè¿ç®—æ¶ˆæ¯è®¤è¯ç ï¼ˆHash-based Message Authentication Codeï¼‰,HMACè¿ç®—åˆ©ç”¨å“ˆå¸Œç®—æ³•ï¼Œä»¥ä¸€ä¸ªå¯†é’¥å’Œä¸€ä¸ªæ¶ˆæ¯ä¸ºè¾“å…¥ï¼Œç”Ÿæˆä¸€ä¸ªæ¶ˆæ¯æ‘˜è¦ä½œä¸ºè¾“å‡ºã€‚ä¹Ÿå°±æ˜¯è¯´HMACæ˜¯éœ€è¦ä¸€ä¸ªå¯†é’¥çš„ã€‚æ‰€ä»¥ï¼ŒHMAC_SHA1ä¹Ÿæ˜¯éœ€è¦ä¸€ä¸ªå¯†é’¥çš„ï¼Œè€ŒSHA1ä¸éœ€è¦ã€‚ å…¶ä»–å¸¸ç”¨ç®—æ³•ï¼š Base64ï¼šå…¶å®ä¸æ˜¯å®‰å…¨é¢†åŸŸä¸‹çš„åŠ å¯†è§£å¯†ç®—æ³•ï¼Œåªèƒ½ç®—æ˜¯ä¸€ä¸ªç¼–ç ç®—æ³•ï¼Œé€šå¸¸ç”¨äºæŠŠäºŒè¿›åˆ¶æ•°æ®ç¼–ç ä¸ºå¯å†™çš„å­—ç¬¦å½¢å¼çš„æ•°æ®ï¼Œå¯¹æ•°æ®å†…å®¹è¿›è¡Œç¼–ç æ¥é€‚åˆä¼ è¾“(å¯ä»¥å¯¹imgå›¾åƒç¼–ç ç”¨äºä¼ è¾“)ã€‚è¿™æ˜¯ä¸€ç§å¯é€†çš„ç¼–ç æ–¹å¼ã€‚ HTTPSï¼ˆå…¨ç§°ï¼šHypertext Transfer Protocol over Secure Socket Layerï¼‰ï¼Œæ˜¯ä»¥å®‰å…¨ä¸ºç›®æ ‡çš„HTTPé€šé“ï¼Œç®€å•è®²æ˜¯HTTPçš„å®‰å…¨ç‰ˆã€‚å³HTTPä¸‹åŠ å…¥SSLå±‚ï¼ŒHTTPSçš„å®‰å…¨åŸºç¡€æ˜¯SSL(SSLä½¿ç”¨40 ä½å…³é”®å­—ä½œä¸ºRC4æµåŠ å¯†ç®—æ³•ï¼Œè¿™å¯¹äºå•†ä¸šä¿¡æ¯çš„åŠ å¯†æ˜¯åˆé€‚çš„ã€‚)ï¼Œå› æ­¤åŠ å¯†çš„è¯¦ç»†å†…å®¹å°±éœ€è¦SSLã€‚https:URLè¡¨æ˜å®ƒä½¿ç”¨äº†HTTPï¼Œä½†HTTPSå­˜åœ¨ä¸åŒäºHTTPçš„é»˜è®¤ç«¯å£åŠä¸€ä¸ªåŠ å¯†/èº«ä»½éªŒè¯å±‚ï¼ˆåœ¨HTTPä¸TCPä¹‹é—´ï¼‰ï¼Œæä¾›äº†èº«ä»½éªŒè¯ä¸åŠ å¯†é€šè®¯æ–¹æ³•ï¼Œç°åœ¨å®ƒè¢«å¹¿æ³›ç”¨äºä¸‡ç»´ç½‘ä¸Šå®‰å…¨æ•æ„Ÿçš„é€šè®¯ï¼Œä¾‹å¦‚äº¤æ˜“æ”¯ä»˜æ–¹é¢ã€‚å®ƒçš„ä¸»è¦ä½œç”¨å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šä¸€ç§æ˜¯å»ºç«‹ä¸€ä¸ªä¿¡æ¯å®‰å…¨é€šé“ï¼Œæ¥ä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨ï¼›å¦ä¸€ç§å°±æ˜¯ç¡®è®¤ç½‘ç«™çš„çœŸå®æ€§ã€‚Https å°±å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„å¯¹ç§°åŠ å¯†ç®—æ³•å’Œéå¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡Œæ¶ˆæ¯çš„åŠ å¯†ã€‚ é¡¹ç›®åº”ç”¨æ€»ç»“ï¼š åŠ å¯†ç®—æ³•æ˜¯å¯é€†çš„ï¼Œç”¨æ¥å¯¹æ•æ„Ÿæ•°æ®è¿›è¡Œä¿æŠ¤ã€‚æ•£åˆ—ç®—æ³•(ç­¾åç®—æ³•ã€å“ˆå¸Œç®—æ³•)æ˜¯ä¸å¯é€†çš„ï¼Œä¸»è¦ç”¨äºèº«ä»½éªŒè¯ã€‚ å¯¹ç§°åŠ å¯†ç®—æ³•ä½¿ç”¨åŒä¸€ä¸ªå¯†åŒ™åŠ å¯†å’Œè§£å¯†ï¼Œé€Ÿåº¦å¿«ï¼Œé€‚åˆç»™å¤§é‡æ•°æ®åŠ å¯†ã€‚å¯¹ç§°åŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½¿ç”¨åŒä¸€ä¸ªå¯†åŒ™ï¼Œå­˜åœ¨è¢«æŠ“åŒ…ç ´è§£çš„é£é™©ã€‚ éå¯¹ç§°åŠ å¯†ç®—æ³•ä½¿ç”¨å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼Œç§é’¥ç­¾åï¼Œå…¬é’¥éªŒç­¾ã€‚å®‰å…¨æ€§æ¯”å¯¹ç§°åŠ å¯†é«˜ï¼Œä½†é€Ÿåº¦è¾ƒæ…¢ã€‚éå¯¹ç§°åŠ å¯†ä½¿ç”¨ä¸¤ä¸ªå¯†åŒ™ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å¯†åŒ™ä¸ä¸€æ ·ï¼Œç§é’¥æ”¾åœ¨æœåŠ¡ç«¯ï¼Œé»‘å®¢ä¸€èˆ¬æ˜¯æ‹¿ä¸åˆ°çš„ï¼Œå®‰å…¨æ€§é«˜ã€‚ Base64ä¸æ˜¯å®‰å…¨é¢†åŸŸä¸‹çš„åŠ è§£å¯†ç®—æ³•ï¼Œåªæ˜¯ä¸€ä¸ªç¼–ç ç®—æ³•ï¼Œé€šå¸¸ç”¨äºæŠŠäºŒè¿›åˆ¶æ•°æ®ç¼–ç ä¸ºå¯å†™çš„å­—ç¬¦å½¢å¼çš„æ•°æ®ï¼Œç‰¹åˆ«é€‚åˆåœ¨httpï¼Œmimeåè®®ä¸‹çš„ç½‘ç»œå¿«é€Ÿä¼ è¾“æ•°æ®ã€‚UTF-8å’ŒGBKä¸­æ–‡çš„Base64ç¼–ç ç»“æœæ˜¯ä¸åŒçš„ã€‚é‡‡ç”¨Base64ç¼–ç ä¸ä»…æ¯”è¾ƒç®€çŸ­ï¼ŒåŒæ—¶ä¹Ÿå…·æœ‰ä¸å¯è¯»æ€§ï¼Œå³æ‰€ç¼–ç çš„æ•°æ®ä¸ä¼šè¢«äººç”¨è‚‰çœ¼æ‰€ç›´æ¥çœ‹åˆ°ï¼Œä½†è¿™ç§æ–¹å¼å¾ˆåˆçº§ï¼Œå¾ˆç®€å•ã€‚Base64å¯ä»¥å¯¹å›¾ç‰‡æ–‡ä»¶è¿›è¡Œç¼–ç ä¼ è¾“ã€‚ httpsåè®®å¹¿æ³›ç”¨äºä¸‡ç»´ç½‘ä¸Šå®‰å…¨æ•æ„Ÿçš„é€šè®¯ï¼Œä¾‹å¦‚äº¤æ˜“æ”¯ä»˜æ–¹é¢ã€‚å®ƒçš„ä¸»è¦ä½œç”¨å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šä¸€ç§æ˜¯å»ºç«‹ä¸€ä¸ªä¿¡æ¯å®‰å…¨é€šé“ï¼Œæ¥ä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨ï¼›å¦ä¸€ç§å°±æ˜¯ç¡®è®¤ç½‘ç«™çš„çœŸå®æ€§ã€‚ å¤§é‡æ•°æ®åŠ å¯†å»ºè®®é‡‡ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæé«˜åŠ è§£å¯†é€Ÿåº¦ï¼›å°é‡çš„æœºå¯†æ•°æ®ï¼Œå¯ä»¥é‡‡ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚åœ¨å®é™…çš„æ“ä½œè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸é‡‡ç”¨çš„æ–¹å¼æ˜¯ï¼šé‡‡ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ç®¡ç†å¯¹ç§°ç®—æ³•çš„å¯†é’¥ï¼Œç„¶åç”¨å¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†æ•°æ®ï¼Œè¿™æ ·æˆ‘ä»¬å°±é›†æˆäº†ä¸¤ç±»åŠ å¯†ç®—æ³•çš„ä¼˜ç‚¹ï¼Œæ—¢å®ç°äº†åŠ å¯†é€Ÿåº¦å¿«çš„ä¼˜ç‚¹ï¼Œåˆå®ç°äº†å®‰å…¨æ–¹ä¾¿ç®¡ç†å¯†é’¥çš„ä¼˜ç‚¹ã€‚ MD5æ ‡å‡†å¯†é’¥é•¿åº¦128ä½ï¼ˆ128ä½æ˜¯æŒ‡äºŒè¿›åˆ¶ä½ã€‚äºŒè¿›åˆ¶å¤ªé•¿ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½æ”¹å†™æˆ16è¿›åˆ¶ï¼Œæ¯ä¸€ä½16è¿›åˆ¶æ•°å¯ä»¥ä»£æ›¿4ä½äºŒè¿›åˆ¶æ•°ï¼Œæ‰€ä»¥128ä½äºŒè¿›åˆ¶æ•°å†™æˆ16è¿›åˆ¶å°±å˜æˆäº†128/4=32ä½ã€‚16ä½åŠ å¯†å°±æ˜¯ä»32ä½MD5æ•£åˆ—ä¸­æŠŠä¸­é—´16ä½æå–å‡ºæ¥ï¼‰ï¼›sha1æ ‡å‡†å¯†é’¥é•¿åº¦60ä½(æ¯”MD5æ‘˜è¦é•¿32ä½)ï¼ŒBase64è½¬æ¢åçš„å­—ç¬¦ä¸²ç†è®ºä¸Šå°†è¦æ¯”åŸæ¥çš„é•¿1/3ã€‚ ä»¥ä¸Šå†…å®¹æ¥è‡ªäºï¼šhttps://www.cnblogs.com/sochishun/p/7028056.html ä¸ªäººç†è§£çš„å¯¹ç§°åŠ å¯†ç®—æ³•çš„è¿‡ç¨‹ï¼š A ä¸ B å•†å®šå¥½åŠ å¯†ç®—æ³•ï¼Œç„¶å A å¦‚æœç»™ B å‘æ¶ˆæ¯ï¼Œä¼šå…ˆè¿ç”¨åŠ å¯†ç®—æ³•ï¼Œè¿›è¡ŒåŠ å¯†ï¼ŒB æ”¶åˆ°åï¼Œä¼šè¿ç”¨é€†åŠ å¯†ç®—æ³•ï¼Œè¿›è¡Œè§£å¯†ï¼Œä¹Ÿå°±æ˜¯å…¶å¯†é’¥æ˜¯ä¸€æ ·çš„ã€‚ ä¸ªäººç†è§£çš„éå¯¹ç§°åŠ å¯†ç®—æ³•çš„è¿‡ç¨‹ï¼š A å’Œ B å„è‡ªæ‹¥æœ‰ä¸€å¯¹å…¬é’¥å’Œç§é’¥ï¼Œä¹Ÿå°±æ˜¯è¯´äºŒè€…å‘é€æ¶ˆæ¯çš„åŠ å¯†ç®—æ³•å¯ä»¥äº’ä¸ç›¸åŒï¼Œä¸”å¯¹æ–¹å¯ä»¥ä¸ç”¨çŸ¥é“ã€‚ä¾‹å¦‚ A è¦ç»™ B å‘æ¶ˆæ¯ï¼Œè¦æ‹¿åˆ° B çš„å…¬é’¥ï¼Œç„¶åè¿›è¡ŒåŠ å¯†å³å¯ï¼ŒB æ”¶åˆ°åç”¨è‡ªå·±çš„ç§é’¥å°±å¯ä»¥è§£å¼€äº†ã€‚ ä»‹ç»BIOã€NIOã€AIO è¿™ä¸ªç®€å•â€¦è¯¦ç»†çš„å™è¿°è§æˆ‘ ã€Šé›¶æ‹·è´åŠå…¶å‘¨è¾¹ã€‹ BIOï¼šæ™®é€šçš„åŒæ­¥é˜»å¡ I/O NIOï¼šåŒæ­¥éé˜»å¡ I/O AIO ï¼šå¼‚æ­¥éé˜»å¡ I/O è™šæ‹Ÿå†…å­˜ è¿™ä¸ªæ˜¯çŸ¥è¯†ç›²åŒºï¼Œéœ€è¦å¥½å¥½ç§‘æ™®ä¸€ä¸‹ã€‚ æˆ‘çš„å¤©å•Šï¼ï¼ï¼ï¼è‡ªå·±çš„ã€Šé›¶æ‹·è´åŠå…¶å‘¨è¾¹ã€‹æ—©å°±ä»‹ç»è¿‡è™šæ‹Ÿå†…å­˜ï¼Œé¢è¯•çš„æ—¶å€™ç«Ÿç„¶æ²¡æœ‰æƒ³èµ·æ¥ï¼Œè¿˜çŸ¥è¯†ç›²åŒºå‘¢ï¼Ÿï¼Ÿï¼ŸçœŸçš„æ˜¯æ™ºéšœå•Šå•Šå•Šå•Šã€‚ã€‚ã€‚ã€‚ã€‚è¿™ä¸ªæ²¡ç­”ä¸Šæ¥çœŸçš„å¤ªå¯æƒœäº†ï¼Œä¸è¿‡è¿˜å¥½é¢è¯•å®˜æ²¡æœ‰æ·±ç©¶â€¦ è™šæ‹Ÿå†…å­˜ è™šæ‹Ÿå†…å­˜æ˜¯è®¡ç®—æœºç³»ç»Ÿå†…å­˜ç®¡ç†çš„ä¸€ç§æŠ€æœ¯ã€‚ å®ƒä½¿å¾—åº”ç”¨ç¨‹åºè®¤ä¸ºå®ƒæ‹¥æœ‰è¿ç»­çš„å¯ç”¨çš„å†…å­˜ï¼ˆä¸€ä¸ªè¿ç»­å®Œæ•´çš„åœ°å€ç©ºé—´ï¼‰ã€‚è€Œå®é™…ä¸Šï¼Œè™šæ‹Ÿå†…å­˜é€šå¸¸æ˜¯è¢«åˆ†éš”æˆå¤šä¸ªç‰©ç†å†…å­˜ç¢ç‰‡ï¼Œè¿˜æœ‰éƒ¨åˆ†æš‚æ—¶å­˜å‚¨åœ¨å¤–éƒ¨ç£ç›˜å­˜å‚¨å™¨ä¸Šï¼Œåœ¨éœ€è¦æ—¶è¿›è¡Œæ•°æ®äº¤æ¢ï¼ŒåŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­æ¥ã€‚ ç›®å‰ï¼Œå¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½ä½¿ç”¨äº†è™šæ‹Ÿå†…å­˜ï¼Œå¦‚ Windows ç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ã€Linux ç³»ç»Ÿçš„äº¤æ¢ç©ºé—´ç­‰ç­‰ã€‚ ç¦»å¼€è¿›ç¨‹è°ˆè™šæ‹Ÿå†…å­˜æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œä¸åŒè¿›ç¨‹é‡Œçš„åŒä¸€ä¸ªè™šæ‹Ÿåœ°å€æŒ‡å‘çš„ç‰©ç†åœ°å€æ˜¯ä¸ä¸€æ ·çš„ã€‚æ¯ä¸ªç”¨æˆ·è¿›ç¨‹ç»´æŠ¤äº†ä¸€ä¸ªå•ç‹¬çš„é¡µè¡¨ï¼ˆPage Tableï¼‰ï¼Œè™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜å°±æ˜¯é€šè¿‡è¿™ä¸ªé¡µè¡¨å®ç°åœ°å€ç©ºé—´çš„æ˜ å°„çš„ï¼Œé¡µè¡¨ï¼ˆPage Tableï¼‰é‡Œé¢çš„æ•°æ®ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ã€‚ å¼•å…¥è™šæ‹Ÿå†…å­˜çš„å¥½å¤„ åœ¨è¿›ç¨‹å’Œç‰©ç†å†…å­˜ä¹‹é—´ï¼ŒåŠ äº†ä¸€å±‚è™šæ‹Ÿå†…å­˜çš„æ¦‚å¿µï¼Œå¥½å¤„æœ‰ï¼š æä¾›æ›´å¤§çš„åœ°å€ç©ºé—´ï¼Œå› ä¸ºè™šæ‹Ÿå†…å­˜è¿˜å¯ä»¥æ”¾åœ¨ç£ç›˜ä¸Šæˆ–è€…å¯„å­˜å™¨ä¸­ï¼Œè€Œç‰©ç†å†…å­˜å¹¶ä¸è¡Œï¼Œè€Œä¸”è™šæ‹Ÿåœ°å€ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ“å¿ƒå…·ä½“æ˜¯å¦‚ä½•å­˜æ”¾çš„ï¼Œæ“ä½œç³»ç»Ÿä¼šå¸®æˆ‘ä»¬æ˜ å°„å¥½ï¼› å®‰å…¨æ€§æ›´å¥½ï¼Œè™šæ‹Ÿå†…å­˜è®¾æœ‰è¯»å†™å±æ€§ï¼Œå¹¶ä¸”ä¸åŒè¿›ç¨‹äº’ä¸å½±å“ï¼› å¯ä»¥æ‡’åŠ è½½ï¼Œåªæœ‰åœ¨éœ€è¦è¯»ç›¸åº”çš„æ–‡ä»¶çš„æ—¶å€™ï¼Œæ‰å°†å®ƒçœŸæ­£çš„ä»ç£ç›˜ä¸ŠåŠ è½½åˆ°å†…å­˜ä¸­æ¥ï¼Œè€Œåœ¨å†…å­˜åƒç´§çš„æ—¶å€™åˆå¯ä»¥å°†è¿™éƒ¨åˆ†å†…å­˜æ¸…ç©ºæ‰ï¼Œæé«˜ç‰©ç†å†…å­˜åˆ©ç”¨æ•ˆç‡ï¼Œå¹¶ä¸”æ‰€æœ‰è¿™äº›å¯¹åº”ç”¨ç¨‹åºæ˜¯éƒ½é€æ˜çš„ï¼› å¯ä»¥å…±äº«å†…å­˜ï¼ŒåŠ¨æ€åº“åªéœ€è¦åœ¨å†…å­˜ä¸­å­˜ä¸€ä»½å°±å¤Ÿäº†ï¼Œç„¶åå°†å®ƒæ˜ å°„åˆ°ä¸åŒè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼Œè®©è¿›ç¨‹è§‰å¾—è‡ªå·±ç‹¬å äº†è¿™ä¸ªæ–‡ä»¶ã€‚è¿›ç¨‹é—´çš„å†…å­˜å…±äº«ä¹Ÿå¯ä»¥é€šè¿‡æ˜ å°„åŒä¸€å—ç‰©ç†å†…å­˜åˆ°è¿›ç¨‹çš„ä¸åŒè™šæ‹Ÿåœ°å€ç©ºé—´æ¥å®ç°å…±äº«ã€‚ å¦‚æœæƒ³äº†è§£æ›´åº•å±‚çš„è¯ï¼Œæˆ³é“¾æ¥ï¼šhttps://sylvanassun.github.io/2017/10/29/2017-10-29-virtual_memory/#comments è¯è¯´æœ€æ‹¿æ‰‹çš„æ•°æ®åº“ç«Ÿç„¶ä¸€ç‚¹éƒ½æ²¡é—®ï¼Œæ„Ÿè§‰æœ‰ç‚¹æ„çŠ¹æœªå°½å“ˆå“ˆå“ˆå“ˆå“ˆâ€¦ 2020.4.06 17:30 - 17:45 ã€Œ15 åˆ†é’Ÿã€ è…¾è®¯ hr é¢ è‡ªæˆ‘ä»‹ç» é¡¹ç›®ä¸­é‡åˆ°çš„æœ€å¤§çš„å›°éš¾ä»¥åŠå¦‚ä½•è§£å†³çš„ é¡¹ç›®ä¸­å¦‚ä½•åˆ†å·¥ æœªæ¥ 3-5 å¹´çš„è§„åˆ’ ä¼˜ç¼ºç‚¹ ç°åœ¨é¢è¯•äº†å‡ å®¶å…¬å¸ï¼Œå„è‡ªå…·ä½“æµç¨‹æ˜¯ä»€ä¹ˆ å¦‚æœç»™ä½ å‘offerï¼Œä½ ä¼šæ€ä¹ˆé€‰ 2020.4.08 14:30 - 15:00 ã€Œ30 åˆ†é’Ÿã€é˜¿é‡Œ hr é¢å°±æ˜¯æ­£å¸¸çš„èŠå¤© è‡ªæˆ‘ä»‹ç» åšçš„é¡¹ç›®è®²ä¸€ä¸‹ï¼Œåœ¨é‡Œé¢çš„èŒè´£ ç„¶åå°±æ˜¯ä»‹ç»æˆ‘è¦å»çš„éƒ¨é—¨å’Œæ¶æ„ç»„äº† ç­‰offerï¼Œå¸Œæœ›ä¸€åˆ‡å¥½è¿ï¼ï¼ï¼ ç¥å¤§å®¶éƒ½èƒ½å¤Ÿæ‰¾åˆ°å¿ƒä»ªçš„å®ä¹ å§ï¼ï¼åŠ æ²¹å„ä½ï¼ï¼ï¼]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æµ…å…¥æµ…å‡º NIO]]></title>
    <url>%2F2020%2F03%2F15%2F%E6%B5%85%E5%85%A5%E6%B5%85%E5%87%BA%20NIO.html</url>
    <content type="text"><![CDATA[å¼•å­æœ¬æ–‡ä»æœ€åŸºæœ¬çš„ IO å‡ºå‘ï¼Œå¼•å‡ºé›¶æ‹·è´æŠ€æœ¯ï¼Œç»§è€Œå‘æ•£åˆ°ç”¨åˆ°é›¶æ‹·è´æŠ€æœ¯çš„ NIOï¼Œè°ˆåŠ NIOï¼Œå°±å¿…é¡»è°ˆä¸€è°ˆè‘—åçš„ç½‘ç»œé€šä¿¡æ¡†æ¶ Netty äº†ï¼Œè€Œ Netty åˆæ˜¯ metaQã€HSFç­‰ç†ŸçŸ¥æŠ€æœ¯æ ˆçš„åŸºç¡€ï¼Œæœ¬æ–‡æ—¨åœ¨ä»¥ NIO ä¸ºæ ¸å¿ƒï¼Œè¾å°„åˆ°å…¶ç›¸å…³çš„çŸ¥è¯†ç‚¹ã€‚ Zero Copy è¿™ä¸€éƒ¨åˆ†åŸºæœ¬ä¸Šå‚è€ƒï¼šæ·±å…¥å‰–æLinux IOåŸç†å’Œå‡ ç§é›¶æ‹·è´æœºåˆ¶çš„å®ç° é¢„è¯»çŸ¥è¯†ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜ç‰©ç†å†…å­˜ç‰©ç†å†…å­˜æŒ‡é€šè¿‡ç‰©ç†å†…å­˜æ¡è€Œè·å¾—çš„å†…å­˜ç©ºé—´ã€‚ è™šæ‹Ÿå†…å­˜è™šæ‹Ÿå†…å­˜æ˜¯è®¡ç®—æœºç³»ç»Ÿå†…å­˜ç®¡ç†çš„ä¸€ç§æŠ€æœ¯ã€‚ å®ƒä½¿å¾—åº”ç”¨ç¨‹åºè®¤ä¸ºå®ƒæ‹¥æœ‰è¿ç»­çš„å¯ç”¨çš„å†…å­˜ï¼ˆä¸€ä¸ªè¿ç»­å®Œæ•´çš„åœ°å€ç©ºé—´ï¼‰ã€‚è€Œå®é™…ä¸Šï¼Œè™šæ‹Ÿå†…å­˜é€šå¸¸æ˜¯è¢«åˆ†éš”æˆå¤šä¸ªç‰©ç†å†…å­˜ç¢ç‰‡ï¼Œè¿˜æœ‰éƒ¨åˆ†æš‚æ—¶å­˜å‚¨åœ¨å¤–éƒ¨ç£ç›˜å­˜å‚¨å™¨ä¸Šï¼Œåœ¨éœ€è¦æ—¶è¿›è¡Œæ•°æ®äº¤æ¢ï¼ŒåŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­æ¥ã€‚ ç›®å‰ï¼Œå¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½ä½¿ç”¨äº†è™šæ‹Ÿå†…å­˜ï¼Œå¦‚ Windows ç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ã€Linux ç³»ç»Ÿçš„äº¤æ¢ç©ºé—´ç­‰ç­‰ã€‚ ç¦»å¼€è¿›ç¨‹è°ˆè™šæ‹Ÿå†…å­˜æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œä¸åŒè¿›ç¨‹é‡Œçš„åŒä¸€ä¸ªè™šæ‹Ÿåœ°å€æŒ‡å‘çš„ç‰©ç†åœ°å€æ˜¯ä¸ä¸€æ ·çš„ã€‚æ¯ä¸ªç”¨æˆ·è¿›ç¨‹ç»´æŠ¤äº†ä¸€ä¸ªå•ç‹¬çš„é¡µè¡¨ï¼ˆPage Tableï¼‰ï¼Œè™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜å°±æ˜¯é€šè¿‡è¿™ä¸ªé¡µè¡¨å®ç°åœ°å€ç©ºé—´çš„æ˜ å°„çš„ï¼Œé¡µè¡¨ï¼ˆPage Tableï¼‰é‡Œé¢çš„æ•°æ®ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ã€‚ å¼•å…¥è™šæ‹Ÿå†…å­˜çš„å¥½å¤„åœ¨è¿›ç¨‹å’Œç‰©ç†å†…å­˜ä¹‹é—´ï¼ŒåŠ äº†ä¸€å±‚è™šæ‹Ÿå†…å­˜çš„æ¦‚å¿µï¼Œå¥½å¤„æœ‰ï¼š æä¾›æ›´å¤§çš„åœ°å€ç©ºé—´ï¼Œå› ä¸ºè™šæ‹Ÿå†…å­˜è¿˜å¯ä»¥æ”¾åœ¨ç£ç›˜ä¸Šæˆ–è€…å¯„å­˜å™¨ä¸­ï¼Œè€Œç‰©ç†å†…å­˜å¹¶ä¸è¡Œï¼Œè€Œä¸”è™šæ‹Ÿåœ°å€ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ“å¿ƒå…·ä½“æ˜¯å¦‚ä½•å­˜æ”¾çš„ï¼Œæ“ä½œç³»ç»Ÿä¼šå¸®æˆ‘ä»¬æ˜ å°„å¥½ï¼› å®‰å…¨æ€§æ›´å¥½ï¼Œè™šæ‹Ÿå†…å­˜è®¾æœ‰è¯»å†™å±æ€§ï¼Œå¹¶ä¸”ä¸åŒè¿›ç¨‹äº’ä¸å½±å“ï¼› å¯ä»¥æ‡’åŠ è½½ï¼Œåªæœ‰åœ¨éœ€è¦è¯»ç›¸åº”çš„æ–‡ä»¶çš„æ—¶å€™ï¼Œæ‰å°†å®ƒçœŸæ­£çš„ä»ç£ç›˜ä¸ŠåŠ è½½åˆ°å†…å­˜ä¸­æ¥ï¼Œè€Œåœ¨å†…å­˜åƒç´§çš„æ—¶å€™åˆå¯ä»¥å°†è¿™éƒ¨åˆ†å†…å­˜æ¸…ç©ºæ‰ï¼Œæé«˜ç‰©ç†å†…å­˜åˆ©ç”¨æ•ˆç‡ï¼Œå¹¶ä¸”æ‰€æœ‰è¿™äº›å¯¹åº”ç”¨ç¨‹åºæ˜¯éƒ½é€æ˜çš„ï¼› å¯ä»¥å…±äº«å†…å­˜ï¼ŒåŠ¨æ€åº“åªéœ€è¦åœ¨å†…å­˜ä¸­å­˜ä¸€ä»½å°±å¤Ÿäº†ï¼Œç„¶åå°†å®ƒæ˜ å°„åˆ°ä¸åŒè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼Œè®©è¿›ç¨‹è§‰å¾—è‡ªå·±ç‹¬å äº†è¿™ä¸ªæ–‡ä»¶ã€‚è¿›ç¨‹é—´çš„å†…å­˜å…±äº«ä¹Ÿå¯ä»¥é€šè¿‡æ˜ å°„åŒä¸€å—ç‰©ç†å†…å­˜åˆ°è¿›ç¨‹çš„ä¸åŒè™šæ‹Ÿåœ°å€ç©ºé—´æ¥å®ç°å…±äº«ã€‚ Tipï¼šæˆ‘ä»¬åæ–‡è®²çš„ï¼Œéƒ½æ˜¯è™šæ‹Ÿå†…å­˜å“¦ã€‚ å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ä¸ºäº†é¿å…ç”¨æˆ·ç›´æ¥æ“ä½œå†…æ ¸ã€Œå¯ä»¥æ“ä½œä¸€åˆ‡ï¼Œç‰›é€¼å¾—å¾ˆã€ï¼Œä¿è¯å†…æ ¸å®‰å…¨ï¼Œæ‰€ä»¥å°†è™šæ‹Ÿå†…å­˜åˆ’åˆ†ä¸ºç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ï¼Œè¿›ç¨‹åœ¨è®¿é—®åˆ°è¿™ä¸¤ä¸ªç©ºé—´çš„æ—¶å€™éœ€è¦è¿›è¡ŒçŠ¶æ€çš„è½¬å˜ï¼ˆå†…æ ¸æ€ã€ç”¨æˆ·æ€ï¼‰ã€‚ åƒæˆ‘ä»¬åœ¨ jvm ä¸­è°ˆåˆ°çš„ï¼Œå †ã€æ ˆã€æ–¹æ³•åŒºç­‰ç­‰éƒ½æ˜¯é»˜è®¤æ˜¯ç”¨æˆ·ç©ºé—´ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®çš„åˆ°ã€‚ å†…æ ¸æ€ &amp; ç”¨æˆ·æ€å†…æ ¸æ€å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œè°ƒç”¨ç³»ç»Ÿçš„ä¸€åˆ‡èµ„æºï¼Œè€Œç”¨æˆ·æ€åªèƒ½æ‰§è¡Œç®€å•çš„è¿ç®—ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ç³»ç»Ÿèµ„æºã€‚ç”¨æˆ·æ€å¿…é¡»é€šè¿‡ç³»ç»Ÿæ¥å£ï¼ˆSystem Callï¼‰ï¼Œæ‰èƒ½å‘å†…æ ¸å‘å‡ºæŒ‡ä»¤ã€‚æ¯”å¦‚ï¼Œå½“ç”¨æˆ·è¿›ç¨‹å¯åŠ¨ä¸€ä¸ª bash æ—¶ï¼Œå®ƒä¼šé€šè¿‡ getpid() å¯¹å†…æ ¸çš„ pid æœåŠ¡å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œè·å–å½“å‰ç”¨æˆ·è¿›ç¨‹çš„ IDï¼›å½“ç”¨æˆ·è¿›ç¨‹é€šè¿‡ cat å‘½ä»¤æŸ¥çœ‹ä¸»æœºé…ç½®æ—¶ï¼Œå®ƒä¼šå¯¹å†…æ ¸çš„æ–‡ä»¶å­ç³»ç»Ÿå‘èµ·ç³»ç»Ÿè°ƒç”¨ã€‚ I/O è¯»å†™æ–¹å¼CPU è½®è¯¢CPU å¯¹ I/O ç«¯å£è¿›è¡Œä¸æ–­åœ°æ£€æµ‹ï¼Œç›´åˆ°æ•°æ®å‡†å¤‡å¥½äº†ï¼Œè¿™ä¸ªå°±å¾ˆåƒ cpuï¼Œpassï¼ I/O ä¸­æ–­åœ¨ DMA æŠ€æœ¯å‡ºç°ä¹‹å‰ï¼Œåº”ç”¨ç¨‹åºä¸ç£ç›˜ä¹‹é—´çš„ I/O æ“ä½œéƒ½æ˜¯é€šè¿‡ CPU çš„ä¸­æ–­å®Œæˆçš„ã€‚æ¯æ¬¡ç”¨æˆ·è¿›ç¨‹è¯»å–ç£ç›˜æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦ CPU ä¸­æ–­ï¼Œç„¶åå‘èµ· I/O è¯·æ±‚ç­‰å¾…æ•°æ®è¯»å–å’Œæ‹·è´å®Œæˆï¼Œç­‰æ•°æ®å‡†å¤‡å®Œæ¯•ä¹‹åï¼Œå‘èµ· I/O ä¸­æ–­ä¿¡å·ï¼Œæé†’ CPU æ•°æ®å·²ç»å‡†å¤‡å¥½äº†ã€‚ ç”¨æˆ·è¿›ç¨‹å‘ CPU å‘èµ· read ç³»ç»Ÿè°ƒç”¨è¯»å–æ•°æ®ï¼Œç”±ç”¨æˆ·æ€åˆ‡æ¢ä¸ºå†…æ ¸æ€ï¼Œç„¶åä¸€ç›´é˜»å¡ç­‰å¾…æ•°æ®çš„è¿”å›ã€‚ CPU åœ¨æ¥æ”¶åˆ°æŒ‡ä»¤ä»¥åå¯¹ç£ç›˜å‘èµ· I/O è¯·æ±‚ï¼Œå°†ç£ç›˜æ•°æ®å…ˆæ”¾å…¥ç£ç›˜æ§åˆ¶å™¨ç¼“å†²åŒºã€‚ æ•°æ®å‡†å¤‡å®Œæˆä»¥åï¼Œç£ç›˜å‘ CPU å‘èµ· I/O ä¸­æ–­ã€‚ CPU æ”¶åˆ° I/O ä¸­æ–­ä»¥åå°†ç£ç›˜ç¼“å†²åŒºä¸­çš„æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œç„¶åå†ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºã€‚ ç”¨æˆ·è¿›ç¨‹ç”±å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ï¼Œè§£é™¤é˜»å¡çŠ¶æ€ï¼Œç„¶åç­‰å¾… CPU çš„ä¸‹ä¸€ä¸ªæ‰§è¡Œæ—¶é—´é’Ÿã€‚ DMAä¼ è¾“åŸç†DMAï¼ˆDirect Memory Accessï¼‰ï¼Œåˆç§°ç›´æ¥å†…å­˜å­˜å–ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ç¡¬ä»¶ç›´æ¥è®¿é—®ä¸»å†…å­˜ï¼Œä¸éœ€è¦é€šè¿‡ cpuï¼Œæœ‰ç‚¹åƒåå¤„ç†å™¨ï¼Œç›®å‰å¤§å¤šæ•°çš„ç¡¬ä»¶éƒ½æ”¯æŒ DMAï¼Œä¾‹å¦‚ç½‘å¡ã€æ˜¾å¡ã€å£°å¡ã€ç£ç›˜ç­‰ç­‰ã€‚ æœ‰äº† DMAï¼ŒCPUå°±ä¸ç”¨å»å¤„ç†å°†æ•°æ®ä»ç£ç›˜ç¼“å†²åŒºè¯»åˆ°å†…æ ¸ç¼“å†²åŒºã€Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆè€—æ—¶çš„ã€äº†ï¼Œç›´æ¥äº¤ç”± DMA æ“ä½œå°±è¡Œäº†ã€‚ å»ºç«‹åœ¨ DMA ä¼ è¾“ä¸Šçš„è¯»å†™çš„ä¸€èˆ¬æ­¥éª¤åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œä¼ ç»Ÿçš„è®¿é—®æ–¹å¼æ˜¯é€šè¿‡ write() å’Œ read() ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨å®ç°çš„ï¼Œé€šè¿‡ read() å‡½æ•°è¯»å–æ–‡ä»¶åˆ°åˆ°ç¼“å­˜åŒºä¸­ï¼Œç„¶åé€šè¿‡ write() æ–¹æ³•æŠŠç¼“å­˜ä¸­çš„æ•°æ®è¾“å‡ºåˆ°ç½‘ç»œç«¯å£ã€‚ å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š ç”¨æˆ·ç©ºé—´è°ƒç”¨ read() æ–¹æ³•ï¼Œä¼šè§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼Œè¿›ç¨‹ç”±ç”¨æˆ·æ€è½¬ä¸ºå†…æ ¸æ€ï¼› ç„¶å DMA ä¼šå°†ç£ç›˜ç¼“å†²åŒºçš„æ•°æ®åŠ è½½åˆ°å†…æ ¸ç¼“å†²åŒºä¸­ï¼› CPU ä¼šå°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ® COPY åˆ°ç”¨æˆ·ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶è¿›ç¨‹ç”±å†…æ ¸æ€è½¬ä¸ºç”¨æˆ·æ€ï¼› ç„¶åç”¨æˆ·ç©ºé—´è°ƒç”¨ write() æ–¹æ³•ï¼Œä¼šè§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼ŒCPU ä¼šå°†ç”¨æˆ·ç¼“å†²åŒºçš„æ•°æ® COPY åˆ° Socket ç¼“å†²åŒºä¸­ã€Œåœ¨å†…æ ¸ç©ºé—´ä¸­ã€ï¼Œæ­¤æ—¶è¿›ç¨‹ç”±ç”¨æˆ·æ€è½¬æˆå†…æ ¸æ€ï¼› ç„¶å Socketç¼“å†²åŒºä¸­çš„æ•°æ®ä¼šé€šè¿‡ DMA çš„æ–¹å¼ COPYåˆ°ç½‘å¡å¤„ï¼Œä¼ é€å®Œæˆï¼› æ­¤æ—¶ CPU ä¼šå†æ¬¡ç”±å†…æ ¸æ€åˆ‡å›åˆ°ç”¨æˆ·æ€ï¼Œæ–¹ä¾¿ä¸‹ä¸€æ¬¡çš„å·¥ä½œã€‚ ç”±æ­¤å¯çŸ¥ï¼Œä¸€å…±æœ‰ 4 æ¬¡æ‹·è´è¿‡ç¨‹ï¼Œå…¶ä¸­ 2 æ¬¡ CPU å‚ä¸å·¥ä½œï¼Œ 2 æ¬¡DMAå‚ä¸å·¥ä½œï¼Œæœ€è¦å‘½çš„æ˜¯æœ‰ 4 æ¬¡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ è‡ªæ­¤ï¼Œæˆ‘ä»¬çš„é¢„è¯»çŸ¥è¯†å‘Šä¸€æ®µè½ï¼Œè¿™é‡Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†æ™®é€šçš„è¯»å†™è¿‡ç¨‹ï¼Œåˆ‡æ¢ä¸Šä¸‹æ–‡çš„æ¬¡æ•°å’Œæ‹·è´æ•°æ®çš„æ¬¡æ•°å¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘ä»¬æ€¥éœ€æ”¹è¿›ï¼Œç”±æ­¤ï¼Œé›¶æ‹·è´æŠ€æœ¯è¿åº”è€Œç”Ÿã€‚ é›¶æ‹·è´æŠ€æœ¯é›¶æ‹·è´æŠ€æœ¯æ˜¯æŒ‡åœ¨è®¡ç®—æœºæ‰§è¡Œæ“ä½œæ—¶ï¼Œå‡å°‘ CPU å°†æ•°æ®ä»ä¸€ä¸ªå†…å­˜åŒºåŸŸå¤åˆ¶åˆ°å¦ä¸€ä¸ªå†…å­˜åŒºåŸŸçš„æ¬¡æ•°ã€‚ é›¶æ‹·è´å¸¦æ¥çš„æ˜¾è€Œæ˜“è§çš„å¥½å¤„å°±æ˜¯å¯ä»¥å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ã€Œç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´åˆ‡æ¢å¯¼è‡´çš„å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´çš„åˆ‡æ¢ã€ä»¥åŠ CPU çš„æ‹·è´æ¬¡æ•°ã€‚ å®ç°é›¶æ‹·è´ç”¨åˆ°çš„æœ€ä¸»è¦æŠ€æœ¯æ˜¯ DMA æ•°æ®ä¼ è¾“æŠ€æœ¯å’Œ å†…å­˜åŒºåŸŸæ˜ å°„æŠ€æœ¯ã€‚ç”±æ­¤ï¼Œæˆ‘ä»¬ä»‹ç»å››ç§é›¶æ‹·è´çš„å®ç°æ€è·¯ï¼š ç”¨æˆ·æ€ç›´æ¥ I/Oï¼šåº”ç”¨ç¨‹åºå¯ä»¥ç›´æ¥è®¿é—®ç¡¬ä»¶å­˜å‚¨ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸åªæ˜¯è¾…åŠ©æ•°æ®ä¼ è¾“ã€‚è¿™ç§æ–¹å¼ä¾æ—§å­˜åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç¡¬ä»¶ä¸Šçš„æ•°æ®ç›´æ¥æ‹·è´è‡³äº†ç”¨æˆ·ç©ºé—´ï¼Œä¸ç»è¿‡å†…æ ¸ç©ºé—´ã€‚å› æ­¤ï¼Œç›´æ¥ I/O ä¸å­˜åœ¨å†…æ ¸ç©ºé—´ç¼“å†²åŒºå’Œç”¨æˆ·ç©ºé—´ç¼“å†²åŒºä¹‹é—´çš„æ•°æ®æ‹·è´ã€‚ mmap + writeï¼šç›´æ¥å°†å†…æ ¸ç©ºé—´ä¸­çš„å†…æ ¸ç¼“å†²åŒºå’Œç”¨æˆ·ç©ºé—´ä¸­çš„ç”¨æˆ·ç¼“å†²åŒºåšä¸€ä¸ªåœ°å€æ˜ å°„ï¼Œè¿™æ ·å°±çœå»äº†åœ¨ read è¿‡ç¨‹ä¸­å°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ® COPY åˆ°ç”¨æˆ·ç¼“å†²åŒºä¸­ã€‚å¾ˆé€‚åˆæ–‡ä»¶çš„ä¿®æ”¹è¯»å†™ã€‚ sendfileï¼šä¸ä»…å°† CPU å‚ä¸çš„æ‹·è´æ¬¡æ•°å‡å°‘äº†ï¼Œè€Œä¸”ç›´æ¥å‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ï¼Œå› ä¸ºåœ¨ç”¨æˆ·ç¼“å†²åŒºæ ¹æœ¬å°±ä¸ä¼šæœ‰æ•°æ®ï¼Œå½“ç„¶åå¤„ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯æ— æ³•ä¿®æ”¹æ•°æ®ï¼Œåªèƒ½è¿›è¡Œä¼ è¾“ï¼Œæ‰€ä»¥å¾ˆé€‚åˆå¤§æ–‡ä»¶çš„ä¼ é€ã€‚ å½“ç„¶äº†ï¼Œè¿˜ä¼šè®²åˆ° sendfile çš„å‡çº§ç‰ˆã€‚ spliceï¼šå°±æ˜¯åœ¨å†…æ ¸ç¼“å†²åŒºå’ŒSocketç¼“å†²åŒºä¹‹é—´å»ºç«‹ç®¡é“ã€‚ ç”¨æˆ·æ€ç›´æ¥I/Oè¿›ç¨‹ç›´æ¥åœ¨ç”¨æˆ·æ€è®¿é—®ç¡¬ä»¶è®¾å¤‡ã€Œè¿™ä¸ªæˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯æ€ä¹ˆåšåˆ°çš„â€¦ã€ï¼Œè¿™ç±»è¿›ç¨‹ç§°ä¸ºè‡ªç¼“å­˜åº”ç”¨ç¨‹åºã€‚ ç›´æ¥ I/O è®¿é—®æ–‡ä»¶æ–¹å¼å¯ä»¥å‡å°‘ CPU çš„ä½¿ç”¨ç‡ä»¥åŠå†…å­˜å¸¦å®½çš„å ç”¨ï¼Œä½†æ˜¯ç›´æ¥ I/O æœ‰æ—¶å€™ä¹Ÿä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨ç›´æ¥ I/O ä¹‹å‰ä¸€å®šè¦å¯¹åº”ç”¨ç¨‹åºæœ‰ä¸€ä¸ªå¾ˆæ¸…é†’çš„è®¤è¯†ï¼Œåªæœ‰åœ¨ç¡®å®šäº†è®¾ç½®ç¼“å†² I/O çš„å¼€é”€éå¸¸å·¨å¤§çš„æƒ…å†µä¸‹ï¼Œæ‰è€ƒè™‘ä½¿ç”¨ç›´æ¥ I/Oã€‚ç›´æ¥ I/O ç»å¸¸éœ€è¦è·Ÿå¼‚æ­¥ I/O ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œå› ä¸ºCPU å’Œç£ç›˜ I/O ä¹‹é—´çš„æ‰§è¡Œæ—¶é—´å·®è·ï¼Œä¼šé€ æˆå¤§é‡çš„æµªè´¹ã€‚ mmap + writemmapï¼Œç§°ä¸ºå†…å­˜åœ°å€æ˜ å°„ï¼Œå¯ä»¥å°†å†…æ ¸ç¼“å†²åŒºçš„åœ°å€æ˜ å°„åˆ°ç”¨æˆ·ç¼“å†²åŒºã€‚ å¦‚å›¾æ‰€ç¤ºï¼ŒåŸºæœ¬å’Œä¼ ç»Ÿçš„è¯»å†™å·®ä¸å¤šï¼Œåªæ˜¯å‡å°‘äº†ä¸€æ¬¡ CPU çš„ COPY å·¥ä½œï¼Œä½†æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°æ²¡æœ‰å˜åŒ–ï¼Œä¾æ—§æ˜¯ 4 æ¬¡ã€‚mmap ä¸»è¦çš„ç”¨å¤„æ˜¯æé«˜ I/O æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹å¤§æ–‡ä»¶ã€‚å¯¹äºå°æ–‡ä»¶ï¼Œå†…å­˜æ˜ å°„æ–‡ä»¶åè€Œä¼šå¯¼è‡´ç¢ç‰‡ç©ºé—´çš„æµªè´¹ï¼Œå› ä¸ºå†…å­˜æ˜ å°„æ€»æ˜¯è¦å¯¹é½é¡µè¾¹ç•Œï¼Œæœ€å°å•ä½æ˜¯ 4 KBï¼Œä¸€ä¸ª 5 KB çš„æ–‡ä»¶å°†ä¼šæ˜ å°„å ç”¨ 8 KB å†…å­˜ï¼Œä¹Ÿå°±ä¼šæµªè´¹ 3 KB å†…å­˜ã€‚ sendfileæ•°æ®å¯ä»¥ç›´æ¥åœ¨å†…æ ¸ç©ºé—´å†…éƒ¨è¿›è¡Œ I/O ä¼ è¾“ï¼Œä»è€Œçœå»äº†æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´çš„æ¥å›æ‹·è´ã€‚ä¸ mmap å†…å­˜æ˜ å°„æ–¹å¼ä¸åŒçš„æ˜¯ï¼Œ sendfile è°ƒç”¨ä¸­ I/O æ•°æ®å¯¹ç”¨æˆ·ç©ºé—´æ˜¯å®Œå…¨ä¸å¯è§çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯ä¸€æ¬¡å®Œå…¨æ„ä¹‰ä¸Šçš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ã€‚ ç›¸æ¯”è¾ƒäº mmap å†…å­˜æ˜ å°„çš„æ–¹å¼ï¼Œsendfile å°‘äº† 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†æ˜¯ä»ç„¶æœ‰ 1 æ¬¡ CPU æ‹·è´æ“ä½œã€‚sendfile å­˜åœ¨çš„é—®é¢˜æ˜¯ç”¨æˆ·ç¨‹åºä¸èƒ½å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œè€Œåªæ˜¯å•çº¯åœ°å®Œæˆäº†ä¸€æ¬¡æ•°æ®ä¼ è¾“è¿‡ç¨‹ã€‚ sendfile + DMA gather copyLinux 2.4 ç‰ˆæœ¬çš„å†…æ ¸å¯¹ sendfile ç³»ç»Ÿè°ƒç”¨è¿›è¡Œä¿®æ”¹ï¼Œä¸º DMA æ‹·è´å¼•å…¥äº† gather æ“ä½œã€‚å®ƒå°†å†…æ ¸ç©ºé—´ï¼ˆkernel spaceï¼‰çš„è¯»ç¼“å†²åŒºï¼ˆread bufferï¼‰ä¸­å¯¹åº”çš„æ•°æ®æè¿°ä¿¡æ¯ï¼ˆå†…å­˜åœ°å€ã€åœ°å€åç§»é‡ï¼‰è®°å½•åˆ°ç›¸åº”çš„ç½‘ç»œç¼“å†²åŒºï¼ˆ socket bufferï¼‰ä¸­ï¼Œç”± DMA æ ¹æ®å†…å­˜åœ°å€ã€åœ°å€åç§»é‡å°†æ•°æ®æ‰¹é‡åœ°ä»è¯»ç¼“å†²åŒºï¼ˆread bufferï¼‰æ‹·è´åˆ°ç½‘å¡è®¾å¤‡ä¸­ï¼Œè¿™æ ·å°±çœå»äº†å†…æ ¸ç©ºé—´ä¸­ä»…å‰©çš„ 1 æ¬¡ CPU æ‹·è´æ“ä½œã€‚ åœ¨ç¡¬ä»¶çš„æ”¯æŒä¸‹ï¼Œsendfile æ‹·è´æ–¹å¼ä¸å†ä»å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ° socket ç¼“å†²åŒºï¼Œå–è€Œä»£ä¹‹çš„ä»…ä»…æ˜¯ç¼“å†²åŒºæ–‡ä»¶æè¿°ç¬¦å’Œæ•°æ®é•¿åº¦çš„æ‹·è´ï¼Œè¿™æ · DMA å¼•æ“ç›´æ¥åˆ©ç”¨ gather æ“ä½œå°†é¡µç¼“å­˜ä¸­æ•°æ®æ‰“åŒ…å‘é€åˆ°ç½‘ç»œä¸­å³å¯ï¼Œæœ¬è´¨å°±æ˜¯å’Œè™šæ‹Ÿå†…å­˜æ˜ å°„çš„æ€è·¯ç±»ä¼¼ã€‚ sendfile + DMA gather copy æ‹·è´æ–¹å¼åŒæ ·å­˜åœ¨ç”¨æˆ·ç¨‹åºä¸èƒ½å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„é—®é¢˜ï¼Œè€Œä¸”æœ¬èº«éœ€è¦ç¡¬ä»¶çš„æ”¯æŒï¼Œå®ƒåªé€‚ç”¨äºå°†æ•°æ®ä»æ–‡ä»¶æ‹·è´åˆ° socket å¥—æ¥å­—ä¸Šçš„ä¼ è¾“è¿‡ç¨‹ã€‚ splicesplice ç³»ç»Ÿè°ƒç”¨å¯ä»¥åœ¨å†…æ ¸ç©ºé—´çš„è¯»ç¼“å†²åŒºï¼ˆread bufferï¼‰å’Œç½‘ç»œç¼“å†²åŒºï¼ˆsocket bufferï¼‰ä¹‹é—´å»ºç«‹ç®¡é“ï¼ˆpipelineï¼‰ï¼Œä»è€Œé¿å…äº†ä¸¤è€…ä¹‹é—´çš„ CPU æ‹·è´æ“ä½œã€‚splice æ‹·è´æ–¹å¼ä¹ŸåŒæ ·å­˜åœ¨ç”¨æˆ·ç¨‹åºä¸èƒ½å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„é—®é¢˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒä½¿ç”¨äº† Linux çš„ç®¡é“ç¼“å†²æœºåˆ¶ï¼Œå¯ä»¥ç”¨äºä»»æ„ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸­ä¼ è¾“æ•°æ®ï¼Œä½†æ˜¯å®ƒçš„ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦å‚æ•°ä¸­æœ‰ä¸€ä¸ªå¿…é¡»æ˜¯ç®¡é“è®¾å¤‡ã€‚ ä¸€å¥è¯å½’çº³ï¼Œå°±æ˜¯ç›´æ¥åœ¨å†…æ ¸ç¼“å†²åŒºå’ŒSocketç¼“å­˜åŒºä¹‹é—´å»ºç«‹ç®¡é“ã€‚ æ€»ç»“ æ‹·è´æ–¹å¼ CPUæ‹·è´æ¬¡æ•° DMAæ‹·è´æ¬¡æ•° ç³»ç»Ÿè°ƒç”¨ ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•° ä¼ ç»Ÿæ–¹å¼ï¼ˆread + writeï¼‰ 2 2 read + write 4 å†…å­˜æ˜ å°„ï¼ˆmmap + writeï¼‰ 1 2 mmap + write 4 sendfile 1 2 sendfile 2 sendfile + DMA gather copy 0 2 sendfile 2 splice 0 2 splice 2 NIO ç¼–ç¨‹æ–°è¯´ï¼Œå°±æ˜¯è¿™ç¯‡æ–‡ç« æŠŠæˆ‘æ‹‰å…¥äº† NIO çš„æ·±å‘ ä¸€æ®µä¸€æ®µå¼ï¼Œä¸ªäººè§‰å¾—å¯è¯»æ€§å¾ˆå¼º Java3y è·Ÿæˆ‘æƒ³çš„ä¸€æ ·ï¼Œæ–‡ä»¶I/O ä¸»è¦ä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯ï¼Œè€Œç½‘ç»œ I/O ä¸»è¦ä½¿ç”¨ I/O å¤ç”¨æŠ€æœ¯ ç®€å•çš„æ€»ç»“ï¼Œè¨€ç®€æ„èµ…ï¼Œå¯æƒœæ²¡æœ‰ä»£ç demo è¿™é‡Œï¼Œæˆ‘åˆ†ä¸‰éƒ¨åˆ†è®²ï¼š å…ˆä»‹ç»ä¸€ä¸‹ NIO çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸»è¦æ˜¯ä¸‰å‰‘å®¢ã€ŒSelectorã€Bufferã€Channelã€ï¼› ç„¶åè®²ä¸€ä¸‹ NIO ä¸­ç”¨åˆ°çš„é›¶æ‹·è´æŠ€æœ¯ï¼› æœ€åå†è°ˆä¸€ä¸‹ NIO ä¸­æœ€ä¸ºé‡è¦çš„ SocketChannel ç”¨åˆ°çš„ I/O å¤ç”¨æŠ€æœ¯ã€‚ æˆ‘å»ºè®®å­¦ä¹  NIO çš„è·¯çº¿æ˜¯ï¼š å…ˆç³»ç»Ÿäº†è§£å„ä¸ªæ¦‚å¿µï¼Œæœ‰ä»€ä¹ˆï¼šJava NIO ç³»ç»Ÿæ•™ç¨‹ï¼Œæ€»å…±æœ‰ 17 è®² ç„¶åçœ‹ Java3y çš„æ€»ç»“ï¼Œä¸ªäººè§‰å¾—æ€»ç»“çš„å¾ˆåˆ°ä½ï¼Œå°¤å…¶æ˜¯å°† NIO åˆ†è§£æˆä¸¤å¤§å—æŠ€æœ¯ã€Œé›¶æ‹·è´æŠ€æœ¯ &amp; I/O å¤ç”¨æŠ€æœ¯ã€ï¼Œè™½ç„¶ä»–æ²¡æœ‰ç»†è‡´çš„è°ˆåˆ°æ–‡ä»¶ I/O ä½¿ç”¨çš„æŠ€æœ¯ã€Œè¿™æ˜¯ä¸€å¤§ç¼ºé™·ã€ï¼Œä½†æ˜¯æœ‰åœ¨é‡ç‚¹å¼ºè°ƒ Selector å¸¦æ¥çš„åŒæ­¥éé˜»å¡çš„ I/O è¯»å†™æ–¹å¼ï¼Œè¿™ç‚¹æ˜¯å¾ˆå¥½çš„ï¼Œé“¾æ¥ï¼šå¦‚ä½•å­¦ä¹ Javaçš„NIOï¼Ÿ - Java3yçš„å›ç­” - çŸ¥ä¹ å¯ä»¥å†å¥½å¥½è¡¥å……ä¸‹è¿™ä¸¤é¡¹æŠ€æœ¯çš„å…·ä½“åº”ç”¨ï¼Œé¦–å…ˆæ˜¯æ–‡ä»¶ I/O ä¸­çš„é›¶æ‹·è´æŠ€æœ¯ï¼Œä¸»è¦å°±æ˜¯é€šè¿‡ FileChannel ä¸­çš„ map() ä½¿ç”¨äº† mmapï¼ŒtransferTo() &amp; transferFrom() ä½¿ç”¨äº† sendfileã€‚ã€Œä¸ºäº†æ›´å¥½åœ°ç†è§£æµç¨‹ï¼Œå¯ä»¥ç®€å•çš„å°† Buffer çœ‹ä½œæ˜¯ç”¨æˆ·ç¼“å†²åŒºï¼ŒChannel çœ‹ä½œæ˜¯å†…æ ¸ç¼“å†²åŒºã€ï¼Œå°¤å…¶æ˜¯ mmap çš„åœ¨è¿™é‡Œé¢çš„ä½¿ç”¨ï¼Œå¯ä»¥å‚è§è¿™ä¸ªåšå®¢é‡Œé¢çš„ demoï¼Œæµ…æ˜¾æ˜“æ‡‚ï¼Œä¸‹é¢æˆ‘ä¹Ÿä¼šå…·ä½“è®²çš„ï¼šmmapåœ¨ NIO ä¸­çš„å…·ä½“ä½¿ç”¨ å…¶æ¬¡å°±æ˜¯ç½‘ç»œ I/O ä¸­ä½¿ç”¨åˆ°çš„ I/O å¤ç”¨æŠ€æœ¯äº†ï¼Œè¿™ä¸ªåœ¨å¾ˆå¤šåœ°æ–¹éƒ½æœ‰æåŠåˆ°ï¼Œç”šè‡³å¤§å®¶è®¤ä¸º NIO æ˜¯ (Non-Blocking I/O)çš„æ„æ€ï¼Œå¯è§å¤§å®¶å¯¹ NIO ä¸­è¿™é¡¹æŠ€æœ¯çš„é‡è§†ç¨‹åº¦ã€Œè™½ç„¶æˆ‘è®¤ä¸º NIO æ˜¯ New I/O çš„æ„æ€ï¼Œå› ä¸ºé›¶æ‹·è´çš„å®ç°ä¹Ÿå¾ˆç‰›é€¼å•Šï¼ã€ï¼Œè¿™é‡Œå‘¢ï¼Œè¿˜æ˜¯å»ºè®®å¤§å®¶çœ‹å­¦ä¹ è·¯çº¿çš„ç¬¬ä¸€ä¸ªé“¾æ¥ï¼Œé‡Œé¢å…¶å®ä¹Ÿæœ‰è®¸å¤šå° demoçš„ï¼Œå½“ç„¶äº†ï¼Œå¦‚æœæƒ³çœ‹å…·ä½“çš„å¥—æ¥å­—ä¼ è¾“çš„ demoï¼Œæˆ‘æ¨èï¼šç¼–ç¨‹æ–°è¯´ï¼Œå°±æ˜¯è¿™ç¯‡æ–‡ç« å¸¦æˆ‘å…¥çš„å‘ï¼Œé‡Œé¢è¿˜æåŠäº† AIO å“¦ åŸºæœ¬æ¦‚å¿µè¿™ç©æ„æ˜¯ä»€ä¹ˆJava NIOæ˜¯ Java 1.4ä¹‹åæ–°å‡ºçš„ä¸€å¥—IOæ¥å£ï¼Œè¿™é‡Œçš„çš„æ–°æ˜¯ç›¸å¯¹äºåŸæœ‰æ ‡å‡†çš„Java IOå’ŒJava Networkingæ¥å£ã€‚NIOæä¾›äº†ä¸€ç§å®Œå…¨ä¸åŒçš„æ“ä½œæ–¹å¼ã€‚ Non-Blocking I/O or New I/O New åœ¨å“ªé‡Œï¼Œç‰¹ç‚¹æ˜¯å•¥ æ ‡å‡†çš„IOç¼–ç¨‹æ¥å£æ˜¯é¢å‘å­—èŠ‚æµå’Œå­—ç¬¦æµçš„ã€‚è€ŒNIOæ˜¯é¢å‘é€šé“å’Œç¼“å†²åŒºçš„ï¼Œæ•°æ®æ€»æ˜¯ä»é€šé“ä¸­è¯»åˆ°bufferç¼“å†²åŒºå†…ï¼Œæˆ–è€…ä»bufferå†™å…¥åˆ°é€šé“ä¸­ã€‚ã€ŒçŸ¥è¯†æ˜¯ç›¸é€šçš„ï¼Œè¿™å—è·Ÿé›¶æ‹·è´æŠ€æœ¯ä¸­çš„ç”¨æˆ·ç¼“å†²åŒºå’Œå†…æ ¸ç¼“å†²åŒºçš„å½¢å¼ä¸€æ¨¡ä¸€æ ·ï¼Œç”¨æˆ·ç¼“å†²åŒºå°±æ˜¯ Bufferï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œæ“ä½œæ•°æ®ï¼Œè€Œå†…æ ¸ç¼“å†²åŒºæ•°æ®å°±æ˜¯ Channelï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¸èƒ½å»æ“ä½œæ•°æ®ï¼Œä½†æ˜¯å¯ä»¥ä¼ è¾“æ•°æ®ã€‚ã€è¿™ä¸ªç‰¹ç‚¹åœ¨ æ–‡ä»¶I/O å’Œ ç½‘ç»œ I/O ä¸­éƒ½æœ‰å¾ˆå¤§çš„ç”¨å¤„ï¼Œåœ¨æ–‡ä»¶ I/O ä¸­æˆ‘å·²ç»è®²è¿‡äº†å¥½å¤„äº†ï¼Œå°±æ˜¯å¯ä»¥å’Œé›¶æ‹·è´é‚£ä¸€å¥—ç»“åˆä¸Šï¼Œåœ¨ç½‘ç»œ I/O ä¸­ï¼Œè¿™ä¸ªç‰¹ç‚¹å¯ä»¥å¾ˆå¥½çš„æ§åˆ¶æ•°æ®ï¼Œæ¯•ç«Ÿç¼“å†²åŒºç›¸å¯¹å­—èŠ‚å­—ç¬¦æµæ¥è¯´è¦å¼ºå¾—å¤šã€‚ Non-Blocking I/Oã€‚æˆ‘ä»¬å¯ä»¥è¿›è¡Œéé˜»å¡IOæ“ä½œã€‚æ¯”å¦‚è¯´ï¼Œå•çº¿ç¨‹ä¸­ä»é€šé“è¯»å–æ•°æ®åˆ°bufferï¼ŒåŒæ—¶å¯ä»¥ç»§ç»­åšåˆ«çš„äº‹æƒ…ï¼Œå½“æ•°æ®è¯»å–åˆ°bufferä¸­åï¼Œçº¿ç¨‹å†ç»§ç»­å¤„ç†æ•°æ®ã€‚å†™æ•°æ®ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å°±æ˜¯ç”¨ Selector å®ç°çš„ã€‚ ä¸‰å‰‘å®¢ã€ŒChannelã€Bufferã€Selectorã€channelç”¨æ¥è¿è¾“æ•°æ®çš„ï¼Œæ˜¯å…¨åŒå·¥çš„ï¼ŒåŒå‘éƒ½å¯ä»¥ï¼Œå¦‚æœè§‰å¾—ä¸å¥½ç†è§£çš„è¯ï¼Œå°±çœ‹æˆå†…æ ¸ç¼“å†²åŒºå°±è¡Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç¨‹åºä¸­æƒ³è¦ç”¨åˆ°æ•°æ®çš„è¯å¿…é¡»æ­é… bufferï¼Œchannel ä» buffer ä¸­è¯»æ•°æ®ï¼Œç›¸å½“äºå†…æ ¸ç¼“å†²åŒºä¸­çš„æ•°æ®ä¼ é€åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼Œbuffer å†™æ•°æ®è‡³ channelï¼Œç›¸å½“äºç”¨æˆ·ç¼“å†²åŒºä¸­çš„æ•°æ®ä¼ é€åˆ° channelã€‚ ä¸»è¦çš„ channel æœ‰ï¼š FileChannel ã€Œæ–‡ä»¶ I/O ç”¨åˆ°çš„ã€ DatagramChannel ã€Œç½‘ç»œ I/O ç”¨åˆ°ï¼Œudpä¼ è¾“ã€ SocketChannel ã€Œç½‘ç»œ I/O ç”¨åˆ°ï¼Œtcpä¼ è¾“ã€ ServerSocketChannel ã€Œç½‘ç»œ I/O ç”¨åˆ°ï¼Œç”¨äºå»ºç«‹ tcpè¿æ¥çš„channelã€ bufferbufferæœ¬è´¨ä¸Šå°±æ˜¯ä¸€å—å†…å­˜åŒºï¼Œå¯ä»¥ç”¨æ¥å†™å…¥æ•°æ®ï¼Œå¹¶åœ¨ç¨åè¯»å–å‡ºæ¥ã€‚è¿™å—å†…å­˜è¢«NIO BufferåŒ…è£¹èµ·æ¥ï¼Œå¯¹å¤–æä¾›ä¸€ç³»åˆ—çš„è¯»å†™æ–¹ä¾¿å¼€å‘çš„æ¥å£ã€‚å°±æ˜¯ç”¨æ¥è·Ÿ channel äº¤äº’çš„ï¼Œæˆ‘ä»¬å¯¹æ•°æ®çš„æ“ä½œéƒ½æ˜¯åœ¨è¿™é‡Œå®Œæˆçš„ï¼Œbufferåº”è¯¥æ˜¯ä¸‰å‰‘å®¢ä¸­æœ€å€¼å¾—è®²çš„ã€‚ åˆ†ç±»Java NIOæœ‰å¦‚ä¸‹å…·ä½“çš„Bufferç±»å‹ï¼š ByteBuffer MappedByteBuffer CharBuffer DoubleBuffer FloatBuffer IntBuffer LongBuffer ShortBuffer æ­£å¦‚ä½ çœ‹åˆ°çš„ï¼ŒBufferçš„ç±»å‹ä»£è¡¨äº†ä¸åŒæ•°æ®ç±»å‹ï¼Œæ¢å¥è¯è¯´ï¼ŒBufferä¸­çš„æ•°æ®å¯ä»¥æ˜¯ä¸Šè¿°çš„åŸºæœ¬ç±»å‹ï¼› å…¶ä¸­æœ€ä¸ºé‡è¦çš„å°±æ˜¯ ByteBufferï¼Œåœ¨ç½‘ç»œ I/O ä¸­æˆ‘ä»¬åŸºæœ¬ä¸Šå°±æ˜¯ä½¿ç”¨ ByteBuffer äº†ï¼Œåœ¨æ–‡ä»¶ I/O ä¸­ç”±äºå¯ä»¥ä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯ï¼Œæ‰€ä»¥ä¸»è¦ç”¨çš„æ˜¯ç”¨åˆ°mmapçš„ MappedByteBufferï¼Œèªæ˜çš„ä½ è‚¯å®šå·²ç»çŸ¥é“æ€ä¹ˆç”¨è¿™ä¸ªMappedByteBufferäº†ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥è®© MappedByteBuffer ä¸ FileChannel å½¢æˆå†…å­˜åœ°å€æ˜ å°„ã€Œç±»æ¯”ç”¨æˆ·ç¼“å†²åŒºå’Œå†…æ ¸ç¼“å†²åŒºåšåœ°å€æ˜ å°„ã€ï¼Œå‡å°‘æ‹·è´æ¬¡æ•°ã€‚ æ•°æ®ç»“æ„æˆ‘ä»¬æ¥å¥½å¥½äº†è§£ä¸€ä¸‹ bufferï¼Œå…ˆæ¥çœ‹ä¸»è¦çš„å±æ€§ 12345// Invariants: mark &lt;= position &lt;= limit &lt;= capacityprivate int mark = -1; // é»˜è®¤ -1ï¼Œæ ‡è®°ï¼Œå¯ä»¥é…åˆ mark()ã€reset()æ–¹æ³•ä½¿ç”¨private int position = 0; private int limit;private int capacity; å®¹é‡ï¼ˆCapacityï¼‰ ä½œä¸ºä¸€å—å†…å­˜ï¼Œbufferæœ‰ä¸€ä¸ªå›ºå®šçš„å¤§å°ï¼Œå«åšcapacityå®¹é‡ã€‚ä¸€æ—¦bufferå†™æ»¡äº†å°±éœ€è¦æ¸…ç©ºå·²è¯»æ•°æ®ä»¥ä¾¿ä¸‹æ¬¡ç»§ç»­å†™å…¥æ–°çš„æ•°æ®ã€‚ ä½ç½®ï¼ˆPositionï¼‰ å½“å†™å…¥æ•°æ®åˆ°Bufferçš„æ—¶å€™éœ€è¦ä¸­ä¸€ä¸ªç¡®å®šçš„ä½ç½®å¼€å§‹ï¼Œé»˜è®¤åˆå§‹åŒ–æ—¶è¿™ä¸ªä½ç½®positionä¸º0ï¼Œä¸€æ—¦å†™å…¥äº†æ•°æ®æ¯”å¦‚ä¸€ä¸ªå­—èŠ‚ï¼Œæ•´å‹æ•°æ®ï¼Œé‚£ä¹ˆpositionçš„å€¼å°±ä¼šæŒ‡å‘æ•°æ®ä¹‹åçš„ä¸€ä¸ªå•å…ƒï¼Œpositionæœ€å¤§å¯ä»¥åˆ°capacity-1. å½“ä»Bufferè¯»å–æ•°æ®æ—¶ï¼Œä¹Ÿéœ€è¦ä»ä¸€ä¸ªç¡®å®šçš„ä½ç½®å¼€å§‹ã€‚bufferä»å†™å…¥æ¨¡å¼å˜ä¸ºè¯»å–æ¨¡å¼æ—¶ï¼Œpositionä¼šå½’é›¶ï¼Œæ¯æ¬¡è¯»å–åï¼Œpositionå‘åç§»åŠ¨ã€‚ ä¸Šé™ï¼ˆLimitï¼‰ åœ¨å†™æ¨¡å¼ï¼Œlimitçš„å«ä¹‰æ˜¯æˆ‘ä»¬æ‰€èƒ½å†™å…¥çš„æœ€å¤§æ•°æ®é‡ã€‚å®ƒç­‰åŒäºbufferçš„å®¹é‡ã€‚ ä¸€æ—¦åˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œlimitåˆ™ä»£è¡¨æˆ‘ä»¬æ‰€èƒ½è¯»å–çš„æœ€å¤§æ•°æ®é‡ï¼Œä»–çš„å€¼ç­‰åŒäºå†™æ¨¡å¼ä¸‹positionçš„ä½ç½®ã€‚ æ•°æ®è¯»å–çš„ä¸Šé™æ—¶bufferä¸­å·²æœ‰çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯limitçš„ä½ç½®ï¼ˆåŸpositionæ‰€æŒ‡çš„ä½ç½®ï¼‰ã€‚ è¯»æ¨¡å¼å’Œå†™æ¨¡å¼åœ¨è¯»æ¨¡å¼å’Œå†™æ¨¡å¼ä¸‹ï¼Œpositionã€markã€limitçš„å€¼éƒ½ä¼šå˜åŒ–ã€‚å¦‚æœä¸æ˜¾ç¤ºè°ƒç”¨ mark() å‡½æ•°ï¼Œmarkå€¼ä¸ä¼šå˜ï¼Œå¦‚æœæ˜¾å¼è°ƒç”¨ï¼Œé‚£ä¹ˆ mark ä¼šç­‰äº å½“å‰çš„ positionï¼Œå¦‚æœè°ƒç”¨ flip()ï¼Œç”±å†™æ¨¡å¼åˆ‡æ¢æˆè¯»æ¨¡å¼ï¼Œæ­¤æ—¶ä¸ä»…positionå’Œlimitä¼šå‘ç”Ÿå˜åŒ–ï¼Œmark ä¹Ÿä¼šå˜ä¸º -1ã€‚å½“ç„¶äº†ï¼Œclear ä¹Ÿä¼šå°† mark ç½®ä¸ºåˆå§‹çŠ¶æ€ -1ã€‚ 123456789101112public final Buffer flip() &#123; limit = position; position = 0; mark = -1; return this;&#125;public final Buffer clear() &#123; position = 0; limit = capacity; mark = -1; return this;&#125; åŸºæœ¬ç”¨æ³•åˆ©ç”¨Bufferè¯»å†™æ•°æ®ï¼Œé€šå¸¸éµå¾ªå››ä¸ªæ­¥éª¤ï¼š æŠŠæ•°æ®å†™å…¥bufferï¼› è°ƒç”¨flipï¼› ä»Bufferä¸­è¯»å–æ•°æ®ï¼› è°ƒç”¨buffer.clear()æˆ–è€…buffer.compact() å½“å†™å…¥æ•°æ®åˆ°bufferä¸­æ—¶ï¼Œbufferä¼šè®°å½•å·²ç»å†™å…¥çš„æ•°æ®å¤§å°ã€‚å½“éœ€è¦è¯»æ•°æ®æ—¶ï¼Œé€šè¿‡flip()æ–¹æ³•æŠŠbufferä»å†™æ¨¡å¼è°ƒæ•´ä¸ºè¯»æ¨¡å¼ï¼›åœ¨è¯»æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¯»å–æ‰€æœ‰å·²ç»å†™å…¥çš„æ•°æ®ã€‚ å½“è¯»å–å®Œæ•°æ®åï¼Œéœ€è¦æ¸…ç©ºbufferï¼Œä»¥æ»¡è¶³åç»­å†™å…¥æ“ä½œã€‚æ¸…ç©ºbufferæœ‰ä¸¤ç§æ–¹å¼ï¼šè°ƒç”¨clear()æˆ–compact()æ–¹æ³•ã€‚clearä¼šæ¸…ç©ºæ•´ä¸ªbufferï¼Œcompactåˆ™åªæ¸…ç©ºå·²è¯»å–çš„æ•°æ®ï¼Œæœªè¢«è¯»å–çš„æ•°æ®ä¼šè¢«ç§»åŠ¨åˆ°bufferçš„å¼€å§‹ä½ç½®ï¼Œå†™å…¥ä½ç½®åˆ™è¿‘è·Ÿç€æœªè¯»æ•°æ®ä¹‹åã€‚ 123456789101112131415161718192021222324252627282930313233public class Buffer_Demo &#123; public static void main(String[] args) throws IOException &#123; RandomAccessFile aFile = new RandomAccessFile("file.txt", "rw"); FileChannel inChannel = aFile.getChannel(); //create buffer with capacity of 48 bytes ByteBuffer buf = ByteBuffer.allocate(48); // è°ƒç”¨ channel çš„ read or writeï¼Œå°±ç›¸å½“äºåœ¨å†…æ ¸æ€ç³»ç»Ÿè°ƒç”¨ä¸€æ · // è‡³äºæ˜¯ read è¿˜æ˜¯ write å–å†³äº new çš„æ—¶å€™æ–‡ä»¶æ˜¯ æºæ–‡ä»¶è¿˜æ˜¯ç›®çš„æ–‡ä»¶ // å¦‚æœæ˜¯æºæ–‡ä»¶ï¼Œé‚£å°±æ˜¯ read åˆ° éšä¾¿ä¸€ä¸ªåœ°æ–¹ // å¦‚æœæ˜¯ç›®çš„æ–‡ä»¶ï¼Œé‚£å°±æ˜¯éšä¾¿å°†ä¸œè¥¿ write åˆ° ç›®çš„æ–‡ä»¶ int bytesRead = inChannel.read(buf); //read into buffer. int count = 0 ; while (bytesRead != -1) &#123; buf.flip(); // åˆ‡æ¢åˆ°è¯»æ¨¡å¼ count++; System.out.println(count); while(buf.hasRemaining())&#123; System.out.print((char) buf.get()); // read 1 byte at a time &#125; buf.clear(); //make buffer ready for writing // è¿™ä¸€è¡Œä¸€å®šè¦åœ¨ä¸€å®šByteBuffer.clear()ä¹‹åï¼Œå› ä¸ºå¦‚æœ position == limitï¼Œå°±ä»£è¡¨ByteBufferä¸èƒ½å­˜å…¥ä¸œè¥¿äº†, // å› æ­¤è¿æµç»ˆæ­¢ä¿¡æ¯éƒ½ä¸èƒ½æ¥å—ï¼Œä¸è¿”å›-1ï¼Œè€Œæ˜¯è¿”å› 0 // è€Œclearä¼šå°† position ç½®ä¸º 0ï¼Œä¸ä¼šæœ‰ position == limitï¼Œå¹¶ä¸” buf å·²ç»è¯»å®Œäº†ï¼Œæ•…ä¼šè¿”å› -1. // å†ä¸‰æé†’ï¼Œè°ƒç”¨ read() æ–¹æ³•ï¼Œä¼šåˆ¤æ–­æ˜¯å¦è¯»å®Œäº†ï¼Œå¦‚æœè¯»å®Œäº†å°±ä¼šè¿”å› -1ï¼Œæ‰€ä»¥æ–‡ä»¶è¯»å–åªä¼šè¯»ä¸€éï¼Œä½†æ˜¯bufferå¯ä»¥è¯»å¤šé bytesRead = inChannel.read(buf); &#125; aFile.close(); &#125;&#125; å…¶ä»–ä¸€äº›å‡½æ•°çš„ç”¨æ³• mark() &amp; reset() 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455/** * ç”¨äºå¯¹markå±æ€§çš„æµ‹è¯• * è°ƒç”¨buffer.remak()æ—¶ï¼Œä¼šå°†å½“å‰çš„positionå€¼èµ‹ç»™remakå±æ€§ï¼Œ * ä¿å­˜å½“å‰æ“ä½œçš„çŠ¶æ€ï¼Œç„¶ågetç»§ç»­æ‰§è¡Œï¼Œå½“è°ƒç”¨buffer.resetï¼ˆï¼‰æ—¶ï¼Œä¼šå°†ä¹‹å‰å½“å‰çš„remarkå€¼èµ‹äºˆposition, * å®ç°çŠ¶æ€çš„æ¢å¤. * flip clear ( reset mark ) rewind * @author lenovo * */class BufferMark &#123; public static void main(String[] args) &#123; // TODO Auto-generated method stub IntBuffer intBuffer = IntBuffer.allocate(10); for(int i = 0;i&lt;intBuffer.capacity();i++) &#123; int b = new SecureRandom().nextInt(20); //æ­¤æ–¹æ³•ä¸ºç›¸å¯¹æ–¹æ³•(relative),ä»–ä¼šå¯¼è‡´positionçš„å˜åŒ– intBuffer.put(b); //æ­¤æ–¹æ³•æ˜¯ç»å¯¹æ–¹æ³•ï¼ˆabsolute),ä»–çš„ä½¿ç”¨åªä¼šè®²å¯¹åº”ä½ç½®çš„å€¼æ›¿æ¢åˆ°ï¼Œå¹¶ä¸ä¼šæ›´æ”¹position //intBuffer.put(i,new SecureRandom().nextInt(20)); System.out.print(b+" "); &#125; //ç¿»è½¬buffer intBuffer.flip(); System.out.println(""); System.out.println("è¯»å–åˆ°çš„æ•°æ®ï¼š"+intBuffer.get()); System.out.println("è¯»å–åˆ°çš„æ•°æ®ï¼š"+intBuffer.get()); System.out.println("1:buffer position="+intBuffer.position()+" limit="+intBuffer.limit()); //æ ‡è®°bufferçŠ¶æ€ intBuffer.mark(); System.out.println("2: buffer position="+intBuffer.position()+" limit="+intBuffer.limit()); System.out.println("è¯»å–åˆ°çš„æ•°æ®ï¼š"+intBuffer.get()); System.out.println("è¯»å–åˆ°çš„æ•°æ®ï¼š"+intBuffer.get()); System.out.println("3: buffer position="+intBuffer.position()+" limit="+intBuffer.limit()); //æ¢å¤bufferçŠ¶æ€ intBuffer.reset(); System.out.println("è¯»å–åˆ°çš„æ•°æ®ï¼š"+intBuffer.get()); System.out.println("è¯»å–åˆ°çš„æ•°æ®ï¼š"+intBuffer.get()); System.out.println("4: buffer position="+intBuffer.position()+" limit="+intBuffer.limit()); /** * 4 10 3 11 17 5 18 10 2 6 è¯»å–åˆ°çš„æ•°æ®ï¼š4 è¯»å–åˆ°çš„æ•°æ®ï¼š10 1: buffer position=2 limit=10 2: buffer position=2 limit=10 è¯»å–åˆ°çš„æ•°æ®ï¼š3 è¯»å–åˆ°çš„æ•°æ®ï¼š11 3: buffer position=4 limit=10 è¯»å–åˆ°çš„æ•°æ®ï¼š3 è¯»å–åˆ°çš„æ•°æ®ï¼š11 4: buffer position=4 limit=10 */ &#125;&#125; buffer.get() è¯»å–ç¼“å†²åŒºçš„æ•°æ®ï¼Œé»˜è®¤æŒ‰ å­—èŠ‚ è¯»å–ï¼› rewind() Buffer.rewind()æ–¹æ³•å°†positionç½®ä¸º0ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é‡å¤è¯»å–bufferä¸­çš„æ•°æ®ã€‚limitä¿æŒä¸å˜ã€‚ clear() &amp; compact() ä¸€æ—¦æˆ‘ä»¬ä»bufferä¸­è¯»å–å®Œæ•°æ®ï¼Œéœ€è¦å¤ç”¨bufferä¸ºä¸‹æ¬¡å†™æ•°æ®åšå‡†å¤‡ã€‚åªéœ€è¦è°ƒç”¨clearæˆ–compactæ–¹æ³•ã€‚ clearæ–¹æ³•ä¼šé‡ç½®positionä¸º0ï¼Œlimitä¸ºcapacityï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªBufferæ¸…ç©ºã€‚å®é™…ä¸ŠBufferä¸­æ•°æ®å¹¶æ²¡æœ‰æ¸…ç©ºï¼Œæˆ‘ä»¬åªæ˜¯æŠŠæ ‡è®°ä¸ºä¿®æ”¹äº†ã€‚ å¦‚æœBufferè¿˜æœ‰ä¸€äº›æ•°æ®æ²¡æœ‰è¯»å–å®Œï¼Œè°ƒç”¨clearå°±ä¼šå¯¼è‡´è¿™éƒ¨åˆ†æ•°æ®è¢«â€œé—å¿˜â€ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰æ ‡è®°è¿™éƒ¨åˆ†æ•°æ®æœªè¯»ã€‚ é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¦‚æœéœ€è¦ä¿ç•™æœªè¯»æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨compactã€‚ å› æ­¤compactå’Œclearçš„åŒºåˆ«å°±åœ¨äºå¯¹æœªè¯»æ•°æ®çš„å¤„ç†ï¼Œæ˜¯ä¿ç•™è¿™éƒ¨åˆ†æ•°æ®è¿˜æ˜¯ä¸€èµ·æ¸…ç©ºã€‚ selectorSelectoræ˜¯Java NIOä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ªNIO Channelçš„çŠ¶æ€æ˜¯å¦å¤„äºå¯è¯»ã€å¯å†™ã€‚å¦‚æ­¤å¯ä»¥å®ç°å•çº¿ç¨‹ç®¡ç†å¤šä¸ªchannels,ä¹Ÿå°±æ˜¯å¯ä»¥ç®¡ç†å¤šä¸ªç½‘ç»œé“¾æ¥ã€‚è¿™ä¹Ÿæ˜¯ I/O å¤ç”¨æŠ€æœ¯çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯æ•´ä¸ª NIO æœ€æ ¸å¿ƒçš„ç»„ä»¶ã€‚åœ¨ I/O å¤ç”¨æŠ€æœ¯å†å±•å¼€å§ã€‚ ç”¨åˆ°çš„é›¶æ‹·è´æŠ€æœ¯NIOä¸­é€šè¿‡FileChannelæ¥æä¾›Zero-Copyçš„æ”¯æŒï¼Œåˆ†åˆ«æ˜¯ FileChannel.map: å°†æ–‡ä»¶çš„ä¸€éƒ¨åˆ†æ˜ å°„åˆ°å†…å­˜ FileChannel.transferTo: å°†æœ¬Channelçš„æ–‡ä»¶å­—èŠ‚è½¬ç§»åˆ°æŒ‡å®šçš„å¯å†™Channel mmap12345678910111213141516171819202122232425262728293031323334/** * æµ‹è¯•FileChannelçš„ç”¨æ³• * * @author sound2gd * */public class FileChannnelTest &#123; public static void main(String[] args) &#123; File file = new File("src/com/cris/chapter15/f6/FileChannnelTest.java"); try ( // FileInputStreamæ‰“å¼€çš„FileChannelåªèƒ½è¯»å– FileChannel fc = new FileInputStream(file).getChannel(); // FileOutputStreamæ‰“å¼€çš„FileChannelåªèƒ½å†™å…¥ FileChannel fo = new FileOutputStream("src/com/cris/chapter15/f6/a.txt").getChannel();) &#123; // å°†FileChannelçš„æ•°æ®å…¨éƒ¨æ˜ å°„æˆByteBuffer MappedByteBuffer mbb = fc.map(MapMode.READ_ONLY, 0, file.length()); // ä½¿ç”¨UTF-8çš„å­—ç¬¦é›†æ¥åˆ›å»ºè§£ç å™¨ Charset charset = Charset.forName("UTF-8"); // ç›´æ¥å°†bufferé‡Œçš„æ•°æ®å…¨éƒ¨è¾“å‡º fo.write(mbb); mbb.clear(); // åˆ›å»ºè§£ç å™¨ CharsetDecoder decoder = charset.newDecoder(); // ä½¿ç”¨è§£ç å™¨å°†byteBufferè½¬æ¢ä¸ºCharBuffer CharBuffer decode = decoder.decode(mbb); System.out.println(decode); &#125; catch (Exception e) &#123; &#125; &#125;&#125; æ›´å¤šè¯¦ç»†æºç è§£æè§ï¼šhttps://zhuanlan.zhihu.com/p/83398714 sendfile transferTo() å’Œ transferFrom() æ–¹æ³•çš„åº•å±‚å®ç°åŸç†ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ java.nio.channels.FileChannel çš„æŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±» sun.nio.ch.FileChannelImpl.java å®ç°ã€‚transferTo() å’Œ transferFrom() åº•å±‚éƒ½æ˜¯åŸºäº sendfile å®ç°æ•°æ®ä¼ è¾“çš„ã€‚è¿™é‡Œå°±æ˜¯ Channel ä¹‹é—´çš„ä¼ è¾“ã€‚ I/O å¤ç”¨æŠ€æœ¯å…¶å®è¯´ç™½äº†ï¼Œå°±æ˜¯ä¸€ä¸ª Selector å¯¹åº”å¤šä¸ª Channelï¼Œå¯ä»¥ä¸“é—¨ç”¨ä¸€ä¸ªç®¡ç†å¤šä¸ªï¼Œå°±æ˜¯ I/O å¤ç”¨ã€‚ ä¸‹é¢ç›´æ¥æ”¾ä¸€ä¸ª Socket I/O å®ä¾‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151package NIO.ç¼–ç¨‹æ–°è¯´;import java.io.IOException;import java.net.InetSocketAddress;import java.net.Socket;import java.nio.ByteBuffer;import java.nio.channels.SelectionKey;import java.nio.channels.Selector;import java.nio.channels.ServerSocketChannel;import java.nio.channels.SocketChannel;import java.text.SimpleDateFormat;import java.util.Date;import java.util.Iterator;import java.util.Random;import java.util.Set;import java.util.concurrent.atomic.AtomicInteger;public class NIO &#123;&#125;/** * @author yang * @since 2020-03-21 */class Client2 &#123; public static void main(String[] args) &#123; try &#123; for (int i = 0; i &lt; 20; i++) &#123; Socket s = new Socket(); s.connect(new InetSocketAddress("127.0.0.1", 27771)); processWithNewThread(s, i); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; static void processWithNewThread(Socket s, int i) &#123; Runnable run = () -&gt; &#123; try &#123; //ç¡çœ éšæœºçš„5-10ç§’ï¼Œæ¨¡æ‹Ÿæ•°æ®å°šæœªå°±ç»ª Thread.sleep((new Random().nextInt(6) + 5) * 1000); //å†™1Mæ•°æ®ï¼Œä¸ºäº†æ‹‰é•¿æœåŠ¡å™¨ç«¯è¯»æ•°æ®çš„è¿‡ç¨‹ s.getOutputStream().write(prepareBytes()); //ç¡çœ 1ç§’ï¼Œè®©æœåŠ¡å™¨ç«¯æŠŠæ•°æ®è¯»å®Œ Thread.sleep(1000); s.close(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;; new Thread(run).start(); &#125; static byte[] prepareBytes() &#123; byte[] bytes = new byte[1024*1024*1]; for (int i = 0; i &lt; bytes.length; i++) &#123; bytes[i] = 1; &#125; return bytes; &#125;&#125;/** * @author yang * @since 2020-03-21 */class NioServer2 &#123; static int clientCount = 0; static AtomicInteger counter = new AtomicInteger(0); static SimpleDateFormat sdf = new SimpleDateFormat("HH:mm:ss"); public static void main(String[] args) &#123; try &#123; Selector selector = Selector.open(); ServerSocketChannel ssc = ServerSocketChannel.open(); ssc.configureBlocking(false); ssc.register(selector, SelectionKey.OP_ACCEPT); ssc.bind(new InetSocketAddress("127.0.0.1", 27771)); while (true) &#123; selector.select(); Set&lt;SelectionKey&gt; keys = selector.selectedKeys(); Iterator&lt;SelectionKey&gt; iterator = keys.iterator(); while (iterator.hasNext()) &#123; SelectionKey key = iterator.next(); iterator.remove(); if (key.isAcceptable()) &#123; ServerSocketChannel ssc1 = (ServerSocketChannel)key.channel(); SocketChannel sc = null; while ((sc = ssc1.accept()) != null) &#123; sc.configureBlocking(false); sc.register(selector, SelectionKey.OP_READ); InetSocketAddress rsa = (InetSocketAddress)sc.socket().getRemoteSocketAddress(); System.out.println(time() + "-&gt;" + rsa.getHostName() + ":" + rsa.getPort() + "-&gt;" + Thread.currentThread().getId() + ":" + (++clientCount)); &#125; &#125; else if (key.isReadable()) &#123; //å…ˆå°†â€œè¯»â€ä»æ„Ÿå…´è¶£æ“ä½œç§»å‡ºï¼Œå¾…æŠŠæ•°æ®ä»é€šé“ä¸­è¯»å®Œåï¼Œå†æŠŠâ€œè¯»â€æ·»åŠ åˆ°æ„Ÿå…´è¶£æ“ä½œä¸­ //å¦åˆ™ï¼Œè¯¥é€šé“ä¼šä¸€ç›´è¢«é€‰å‡ºæ¥ key.interestOps(key.interestOps() &amp; (~ SelectionKey.OP_READ)); processWithNewThread((SocketChannel)key.channel(), key); &#125; &#125; &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; static void processWithNewThread(SocketChannel sc, SelectionKey key) &#123; Runnable run = () -&gt; &#123; counter.incrementAndGet(); try &#123; String result = readBytes(sc); //æŠŠâ€œè¯»â€åŠ è¿›å» key.interestOps(key.interestOps() | SelectionKey.OP_READ); System.out.println(time() + "-&gt;" + result + "-&gt;" + Thread.currentThread().getId() + ":" + counter.get()); sc.close(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; counter.decrementAndGet(); &#125;; new Thread(run).start(); &#125; static String readBytes(SocketChannel sc) throws Exception &#123; long start = 0; int total = 0; int count = 0; ByteBuffer bb = ByteBuffer.allocate(1024); //å¼€å§‹è¯»æ•°æ®çš„æ—¶é—´ long begin = System.currentTimeMillis(); while ((count = sc.read(bb)) &gt; -1) &#123; if (start &lt; 1) &#123; //ç¬¬ä¸€æ¬¡è¯»åˆ°æ•°æ®çš„æ—¶é—´ start = System.currentTimeMillis(); &#125; total += count; bb.clear(); &#125; //è¯»å®Œæ•°æ®çš„æ—¶é—´ long end = System.currentTimeMillis(); return "wait=" + (start - begin) + "ms,read=" + (end - start) + "ms,total=" + total + "bs"; &#125; static String time() &#123; return sdf.format(new Date()); &#125;&#125; å…·ä½“çš„è¯­å¥å«ä¹‰æˆ‘è¿™é‡Œå°±ä¸å†å•ç‹¬è¯´æ˜äº†ï¼Œå¯ä»¥ç§»æ­¥ï¼šhttps://wiki.jikexueyuan.com/project/java-nio-zh/java-nio-selector.htmlï¼Œè¿™é‡Œæœ‰è¯´æ˜ä¸€äº›å…·ä½“å‡½æ•°çš„ç”¨æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬çŸ¥é“æ€æƒ³å°±å¥½äº†ã€‚ å¯¹è¾“å…¥è¾“å‡ºæµçš„ä¸€äº›çœ‹æ³•åœ¨å†™ä¸Šé¢çš„ä¸€äº›demoçš„æ—¶å€™ï¼Œçªç„¶åˆå¯¹è¾“å…¥æµè¾“å‡ºæµæœ‰ç‚¹å›°æƒ‘ï¼Œåˆ°åº•ä»€ä¹ˆæ—¶å€™è¯¥è¾“å…¥æµï¼Œä»€ä¹ˆæ—¶å€™è¯¥è¾“å‡ºæµï¼Œåˆä¸ºä»€ä¹ˆéœ€è¦åˆ†è¾“å‡ºæµè¾“å…¥æµå‘¢ï¼Ÿ ä¸ºä»€ä¹ˆè¦åˆ†è¾“å…¥è¾“å‡ºæµï¼Ÿ å› ä¸ºç›®çš„ä¸ä¸€æ ·ï¼Œè¾“å…¥æµæ˜¯è¡¨ç¤ºä»å¤–éƒ¨è¾“å…¥åˆ°å†…å­˜ä¸­å»ï¼Œå…³æ³¨çš„é‡ç‚¹åœ¨å­—èŠ‚æµä»å“ªé‡Œæ¥ï¼Œè€Œè¾“å‡ºæµæ˜¯è¡¨ç¤ºå°†å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åˆ°å¤–éƒ¨å»ï¼Œå…³æ³¨çš„é‡ç‚¹æ˜¯å­—èŠ‚æµåˆ°å“ªå»ï¼Œåˆ†å¼€å°±æ˜¯ä¸ºäº†åˆ†å·¥æ˜ç¡®ã€‚äºŒè€…æ“ä½œçš„å¯¹è±¡ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯æºæ–‡ä»¶ã€Œè¾“å…¥æµã€ï¼Œä¸€ä¸ªæ˜¯ç›®æ ‡æ–‡ä»¶ã€Œè¾“å‡ºæµã€ã€‚ è¾“å…¥æµå’Œè¾“å‡ºæµä½•æ—¶ç”¨ï¼Ÿ åªè¦ç¡®å®šäº†è¦æ“ä½œçš„æ–‡ä»¶æ˜¯æºæ–‡ä»¶è¿˜æ˜¯ç›®çš„æ–‡ä»¶ï¼Œå°±èƒ½å¾ˆæ¸…æ¥šçš„çŸ¥é“è¾“å…¥è¾“å‡ºæµåº”è¯¥å¦‚ä½•é€‰æ‹©ï¼Œåƒæœ€ç®€å•çš„ FileOutputStream å’Œ FileInputStream ï¼Œåœ¨ä½¿ç”¨æ—¶åˆ†åˆ«ä¼šå…ˆæŒ‡å®šç›®çš„æ–‡ä»¶å’Œæºæ–‡ä»¶ï¼Œè‡³äº fos.write()å…·ä½“å†™å•¥æˆ‘ä»¬å¹¶ä¸å…³å¿ƒï¼Œè‡³äº fis.read()ï¼Œè¯»åˆ°å“ªé‡Œå»æˆ‘ä»¬ä¹Ÿå¹¶ä¸å…³å¿ƒã€‚ æœ€åï¼Œç”±äºè¿™ç¯‡æ–‡ç« ä¹Ÿä¸æ˜¯ä¸»è¦å†™ I/O æµçš„ï¼Œè¿˜æ˜¯è¯¥æ”¶å°±æ”¶å§ï¼Œæœ€åæ”¾ä¸€ä¸ªå¤§æ‹›é“¾æ¥ï¼Œæ²¡äº‹çš„æ—¶å€™å¤šçœ‹çœ‹ï¼Œå¯ä»¥åŠ æ·±å¯¹ I/O æµçš„ç†è§£ã€‚ æœ€è¯¦å°½çš„ I/O æµå¤§å…¨ ç®€è¿°è¾“å…¥è¾“å‡ºæµ æå…·äº‰è®®çš„ä¸€ä¸ªè¯é¢˜è¿™å°±æ˜¯ NIO åˆ°åº•æ˜¯åŒæ­¥é˜»å¡ï¼Œè¿˜æ˜¯åŒæ­¥éé˜»å¡ï¼Œè¿˜æ˜¯å¼‚æ­¥éé˜»å¡å‘¢ï¼Ÿ æˆ‘çœ‹è¿‡å¾ˆå¤šç­”æ¡ˆï¼Œä¹Ÿçœ‹äº†å¾ˆå¤šè§£é‡Šï¼ŒçœŸçš„äº‘é‡Œé›¾é‡Œâ€¦ æˆ‘å…ˆè¡¨æ˜æˆ‘çš„è§‚ç‚¹ï¼Œæˆ‘è®¤ä¸ºæ˜¯åŒæ­¥éé˜»å¡çš„ã€‚åŒæ­¥éåŒæ­¥ï¼Œæˆ‘è§‰å¾—çœ‹çš„æ˜¯æ¶ˆæ¯æ¥äº†ï¼Œä½ æ˜¯ä¸æ˜¯æŒ‰åºæ¥æ”¶ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ç¨‹åºåœ¨ä¸€ä¸ªçº¿ç¨‹å†…è‚¯å®šæ˜¯åŒæ­¥çš„ï¼Œå› ä¸ºä»–æ˜¯æŒ‰åºè¿›è¡Œçš„ï¼Œå†æ¯”å¦‚åœ¨ node js ä¸­æ‰€æœ‰çš„è¯­å¥éƒ½ä¸æ˜¯æŒ‰åºæ¥çš„ï¼Œè¿™ä¸ªå°±ç®—åšå¼‚æ­¥ï¼Œä»è¿™ä¸ªè§’åº¦çœ‹ï¼ŒNIO æ˜¯åŒæ­¥çš„ï¼Œå› ä¸º Selector è¦ä¸€ä¸ªä¸€ä¸ªè½®è¯¢ï¼Œæ¯ä¸ªæœ‰è¯·æ±‚çš„I/O éƒ½æ˜¯éœ€è¦æŒ‰åºæ¥æ¥æ”¶çš„ã€‚å†æ¥è°ˆè°ˆéé˜»å¡ï¼Œæˆ‘è§‰å¾—è°ˆé˜»å¡éé˜»å¡ç„¦ç‚¹åœ¨äºè¿™ä¸ªçº¿ç¨‹çš„çŠ¶æ€ï¼Œå¦‚æœä»–æ¥æ”¶æ¶ˆæ¯åï¼Œè‡ªå·±å»å¿™ç€å¤„ç†ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰ä½ å¤„ç†å®Œ I/O æ“ä½œç„¶åä¸€ç›´ç­‰ç€ï¼Œè¿™ä¸ªå°±è‚¯å®šæ˜¯é˜»å¡äº†ã€‚åœ¨ NIO ä¸­æ¯«æ— ç–‘é—®æ˜¯éé˜»å¡çš„ï¼Œå› ä¸º Selector åœ¨æ¥æ”¶åˆ° I/O è¯»å†™å‡†å¤‡å¥½äº†ä¹‹åï¼Œä¼šèµ·ä¸€ä¸ªçº¿ç¨‹å»å¤„ç† I/O è¯»å†™ï¼Œä¸ä¼šè®©è¿™ä¸ª Selector å»å¤„ç†ï¼Œå…¶ä»–I/O è¯·æ±‚ä¹Ÿå°±ä¸ç”¨é˜»å¡ç­‰å¾…ã€‚ åœ¨çŸ¥ä¹ä¸Šï¼Œæœ‰äººè¿™ä¹ˆæ€»ç»“ï¼š åŒæ­¥å’Œå¼‚æ­¥è¯´çš„æ˜¯æ¶ˆæ¯çš„é€šçŸ¥æœºåˆ¶ã€ŒåŒæ­¥å°±æ˜¯éœ€è¦çº¿ç¨‹ä¸»åŠ¨è¯¢é—®ï¼Œå¼‚æ­¥å°±æ˜¯å‹æ ¹ä¸éœ€è¦çº¿ç¨‹ä¸»åŠ¨è¯¢é—®ã€ï¼Œé˜»å¡å’Œéé˜»å¡è¯´çš„æ˜¯çº¿ç¨‹çš„çŠ¶æ€ã€‚ æˆ‘è®¤ä¸ºå‹‰å¼ºååŠå¥ okayï¼Œå‰åŠå¥å¤šå°‘æœ‰äº›å‹‰å¼ºã€Œä¸è¿‡ä¹Ÿèƒ½è¯´å¾—è¿‡å»ï¼Œä¸‹é¢æˆ‘ä¼šè§£é‡Šã€ï¼Œä½ åœ¨ node js ä¸­è°ˆåŒæ­¥å¼‚æ­¥çš„æ—¶å€™æœ‰å»è€ƒè™‘ä»€ä¹ˆæ¶ˆæ¯çš„é€šçŸ¥æœºåˆ¶å—ï¼Ÿä¸è¿‡è¯è¯´å›æ¥ï¼Œä¸»åŠ¨è¯¢é—®çš„ä»£ä»·å°±æ˜¯å¾—ä¸€ä¸ªä¸€ä¸ªè¯¢é—®ï¼Œæ‰€ä»¥è‚¯å®šåŒæ­¥ï¼Œä¸éœ€è¦å»è¯¢é—®ï¼Œæ¯ä¸ª I/O è¯·æ±‚è‡ªå·±å»è¿›è¡Œå¤„ç†ï¼Œé‚£è¿™ä¸ªä¹Ÿå°±ä¸å­˜åœ¨ä¸€ä¸ªä¸€ä¸ªå¤„ç†è¯·æ±‚çš„é—®é¢˜äº†ï¼Œå¿…ç„¶æ˜¯å¼‚æ­¥äº†ã€‚æ‰€ä»¥æˆ‘è§‰å¾—ï¼ŒåŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Œçœ‹çš„æ˜¯ I/O è¯·æ±‚æ¥äº†æ˜¯ä¸æ˜¯æŒ‰åºå»å¤„ç†çš„ï¼Œè¿™é‡Œè‚¯å®šæ˜¯æŒ‰åºå¤„ç†ï¼Œå› ä¸ºéƒ½æ˜¯ç”± Selector å»æ¥æ”¶ï¼Œæ‰€ä»¥æ˜¯åŒæ­¥ã€‚é˜»å¡è¿˜æ˜¯éé˜»å¡ï¼Œå°±çœ‹è¿™ä¸ª I/O è¯·æ±‚æœ‰æ²¡æœ‰å¯¼è‡´çº¿ç¨‹é˜»å¡äº†ï¼Œå®é™…ä¸Šæ˜¯æ²¡æœ‰ï¼Œå› ä¸ºä»–æ‰¾äº† worker çº¿ç¨‹å»å¤„ç†äº†ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯éé˜»å¡ã€‚ å†è¡¥å……ä¸¤å¥å§ï¼ŒåŒæ­¥å¼‚æ­¥æˆ‘è®¤ä¸ºå§‹ç»ˆæ˜¯è¦ä»¥é¡ºåºä¸ºä¸­å¿ƒè¦ä¹‰çš„ï¼Œnode jsä¸­æˆ‘ä»¬è°ˆåŒæ­¥å¼‚æ­¥ï¼Œå§‹ç»ˆéƒ½æ˜¯çœ‹æ‰§è¡Œè¯­å¥çš„é¡ºåºï¼Œè¿™é‡Œæˆ‘è§‰å¾—ä¹Ÿæ˜¯ä¸€æ ·ã€‚åœ¨è¿™é‡Œåªä¸è¿‡æ˜¯æ¶ˆæ¯çš„é€šçŸ¥æœºåˆ¶çš„ä¸åŒå¸¦æ¥äº†é¡ºåºçš„å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—å› æœå…³ç³»è¿˜æ˜¯è¦ç¡®å®šå¥½ï¼ŒåŒæ­¥å¼‚æ­¥çš„æ¦‚å¿µæˆ‘è®¤ä¸ºä¸å¯èƒ½ç”¨æ¶ˆæ¯é€šçŸ¥æœºåˆ¶æ¥è¡¡é‡ï¼Œæˆ‘ä»¬åœ¨è®²åŒæ­¥ä»£ç å—ä¸­æœ‰æåˆ°è¿‡ä»€ä¹ˆé€šçŸ¥æœºåˆ¶çš„æ¦‚å¿µå—ï¼Ÿæˆ‘ä»¬å§‹ç»ˆéƒ½æ˜¯åœ¨å¼ºè°ƒæ‰§è¡Œçš„é¡ºåºï¼Œä»¥æ­¤æ¥è¡¡é‡åŒæ­¥å¼‚æ­¥ã€‚ ç»¼åˆæ¥è¯´ï¼ŒNIO å°±æ˜¯åŒæ­¥éé˜»å¡çš„ã€‚ è‡³äº AIO ã€Œjdk1.7 å¼•å…¥ã€é‡‡ç”¨çš„æ˜¯å¼‚æ­¥éé˜»å¡ï¼Œé€šè¿‡æˆ‘ä¸Šé¢çš„æ–¹å¼å»ç†è§£å°±å¾ˆå¥½ç†è§£äº†ã€‚é‡‡ç”¨çš„æ˜¯å›è°ƒæœºåˆ¶ï¼ŒI/O è¯·æ±‚æ¥äº†ï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦å»ç®¡ï¼Œä¹Ÿå°±ä¸å­˜åœ¨è¯·æ±‚æŒ‰åºå¤„ç†çš„æƒ…å†µäº†ï¼Œç›´æ¥ç”±æ“ä½œç³»ç»Ÿè‡ªå·±å¤„ç†ï¼Œç­‰åˆ°æ•°æ®okayäº†ï¼Œç›´æ¥é€šçŸ¥æˆ‘å°±å¥½äº†ï¼Œå…¨ç¨‹éƒ½æ˜¯å¼‚æ­¥éé˜»å¡çš„çŠ¶æ€ã€‚ å½“ç„¶äº† AIO è¿™ä¹ˆå¥½ä¸ºå•¥æˆ‘ä»¬è¿˜åœ¨ç”¨ NIO å‘¢ï¼Ÿæˆ‘è§‰å¾—æœ‰å‡ ä¸ªåŸå› å§ï¼Œä¸€ä¸ªæ˜¯è¿™ä¸ª AIO æ”¯æŒçš„å¤ªå°‘äº†ï¼Œè¿˜æ²¡å®Œå…¨å‘å±•èµ·æ¥ï¼Œä¸€ä¸ªæ˜¯ä¸æ”¯æŒ udpï¼Œåªæ”¯æŒ tcpã€‚ NIOåº•å±‚ä¹‹å¥‡å¦™çš„ä¸‰å…„å¼Ÿæˆ‘æ“¦ï¼Œå°±ä¸€ç‚¹åŠäº†â€¦æ˜å¤©æ¥ç€å†™ï¼Œé€éœ²ä¸‹ï¼Œå°±æ˜¯ select/poll/epollã€‚ å›æ¥äº†ï¼Œå›æ¥äº†ï¼Œæ¥ç€æ˜¨å¤©çš„å½©è›‹ï¼Œæˆ‘ä»¬ä»Šå¤©æ¥è®²ä¸€è®² select/poll/epollã€‚ å…¶å®è¿™ä¸ª select/poll/epoll å’Œ é›¶æ‹·è´æ²¡æœ‰å…³ç³»ï¼Œä½†æ˜¯ è·Ÿ NIO ç´§å¯†ç›¸è¿ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒNIO ä¸­æ€»å…±å°±æ˜¯ä½¿ç”¨äº†ä¸¤ä¸ªæŠ€æœ¯ï¼šI/O å¤ç”¨æŠ€æœ¯ã€Œç½‘ç»œ I/Oã€å’Œé›¶æ‹·è´æŠ€æœ¯ã€Œæ–‡ä»¶ I/Oã€ï¼Œæˆ‘åœ¨ä¸Šé¢å…¶å®ä¹Ÿæœ‰è®²ï¼ŒNIO ä¸­æœ€é‡è¦çš„æŠ€æœ¯å°±æ˜¯ I/O å¤ç”¨æŠ€æœ¯ï¼Œé‚£å®ƒæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿæ²¡é”™ï¼Œåº•å±‚å°±æ˜¯ select/poll/epollã€‚ è¿™ä¸‰å…„å¼Ÿæ˜¯å•¥ å‚è€ƒï¼š https://zhuanlan.zhihu.com/p/95872805 https://mp.weixin.qq.com/s?__biz=MzUyNzgyNzAwNg==&amp;mid=2247483925&amp;idx=1&amp;sn=1ac3e863594745c7466b0e88a688b203&amp;scene=21#wechat_redirect selectã€pollã€epolléƒ½æ˜¯I/Oå¤šè·¯å¤ç”¨çš„æœºåˆ¶ã€‚I/Oå¤šè·¯å¤ç”¨å°±æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆè¯»å°±ç»ªæˆ–å†™å°±ç»ªï¼‰ï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œ ã€‚ ä½†æ˜¯ï¼Œselectï¼Œpollï¼Œepollæœ¬è´¨è¿˜æ˜¯åŒæ­¥I/Oï¼ˆI/Oå¤šè·¯å¤ç”¨æœ¬èº«å°±æ˜¯åŒæ­¥IOï¼‰çš„èŒƒç•´ï¼Œå› ä¸ºå®ƒä»¬éƒ½éœ€è¦åœ¨è¯»å†™äº‹ä»¶å°±ç»ªåçº¿ç¨‹è‡ªå·±è¿›è¡Œè¯»å†™ï¼Œè¯»å†™çš„è¿‡ç¨‹é˜»å¡çš„ã€‚è€Œå¼‚æ­¥I/Oçš„å®ç°æ˜¯ç³»ç»Ÿä¼šæŠŠè´Ÿè´£æŠŠæ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œæ— éœ€çº¿ç¨‹è‡ªå·±å†è¿›è¡Œé˜»å¡çš„è¯»å†™ï¼Œå†…æ ¸å·²ç»å‡†å¤‡å®Œæˆã€‚ Tipï¼šlinuxä¸­ socket çš„ fd æ˜¯ä»€ä¹ˆï¼Ÿ è¿™ä¸ªFDå°±æ˜¯File Discriptor ä¸­æ–‡ç¿»è¯‘ä¸ºæ–‡ä»¶æè¿°ç¬¦ã€‚ Socketèµ·æºäºunixï¼ŒUnixä¸­æŠŠæ‰€æœ‰çš„èµ„æºéƒ½çœ‹ä½œæ˜¯æ–‡ä»¶ï¼ŒåŒ…æ‹¬è®¾å¤‡ï¼Œæ¯”å¦‚ç½‘å¡ã€æ‰“å°æœºç­‰ç­‰ï¼Œæ‰€ä»¥ï¼Œé’ˆå¯¹Socketé€šä¿¡ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ç½‘å¡ï¼Œç½‘å¡åˆå¤„ç†Nå¤šé“¾æ¥ï¼Œæ¯ä¸ªé“¾æ¥éƒ½éœ€è¦ä¸€ä¸ªå¯¹åº”çš„æè¿°ï¼Œä¹Ÿå°±æ˜¯æƒŸä¸€çš„IDï¼Œå³å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç®€å•ç‚¹è¯´ä¹Ÿå°±æ˜¯ int fd = socket(AF_INET,SOCK_STREAM, 0); å‡½æ•°socket()è¿”å›çš„å°±æ˜¯è¿™ä¸ªæè¿°ç¬¦ã€‚åœ¨ä¼ è¾“ä¸­æˆ‘ä»¬éƒ½è¦ä½¿ç”¨è¿™ä¸ªæƒŸä¸€çš„IDæ¥ç¡®å®šè¦å¾€å“ªä¸ªé“¾æ¥ä¸Šä¼ è¾“æ•°æ®ã€‚ SelectAPIç®€ä»‹linuxç³»ç»Ÿä¸­/usr/include/sys/select.hæ–‡ä»¶ä¸­å¯¹selectæ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526/* fd_set for select and pselect. */typedef struct &#123; /* XPG4.2 requires this member name. Otherwise avoid the name from the global namespace. */ #ifdef __USE_XOPEN __fd_mask fds_bits[__FD_SETSIZE / __NFDBITS]; # define __FDS_BITS(set) ((set)-&gt;fds_bits) #else __fd_mask __fds_bits[__FD_SETSIZE / __NFDBITS]; # define __FDS_BITS(set) ((set)-&gt;__fds_bits) #endif &#125; fd_set;/* Check the first NFDS descriptors each in READFDS (if not NULL) for read readiness, in WRITEFDS (if not NULL) for write readiness, and in EXCEPTFDS (if not NULL) for exceptional conditions. If TIMEOUT is not NULL, time out after waiting the interval specified therein. Returns the number of ready descriptors, or -1 for errors. This function is a cancellation point and therefore not marked with __THROW. */extern int select (int __nfds, fd_set *__restrict __readfds, fd_set *__restrict __writefds, fd_set *__restrict __exceptfds, struct timeval *__restrict __timeout); int __nfdsæ˜¯fd_setä¸­æœ€å¤§çš„æè¿°ç¬¦+1ï¼Œå½“è°ƒç”¨selectæ—¶ï¼Œå†…æ ¸æ€ä¼šåˆ¤æ–­fd_setä¸­æè¿°ç¬¦æ˜¯å¦å°±ç»ªï¼Œ__nfdså‘Šè¯‰å†…æ ¸æœ€å¤šåˆ¤æ–­åˆ°å“ªä¸€ä¸ªæè¿°ç¬¦ã€‚ readfdsã€writefdsã€__exceptfdséƒ½æ˜¯ç»“æ„ä½“fd_setï¼Œfd_setå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªæè¿°ç¬¦çš„é›†åˆã€‚ selectå‡½æ•°ä¸­å­˜åœ¨ä¸‰ä¸ªfd_seté›†åˆï¼Œåˆ†åˆ«ä»£è¡¨ä¸‰ç§äº‹ä»¶ï¼Œreadfdsè¡¨ç¤ºè¯»æè¿°ç¬¦é›†åˆï¼Œwritefdsè¡¨ç¤ºè¯»æè¿°ç¬¦é›†åˆï¼Œexceptfdsè¡¨ç¤ºå¼‚å¸¸æè¿°ç¬¦é›†åˆã€‚å½“å¯¹åº”çš„fd_set = NULLæ—¶ï¼Œè¡¨ç¤ºä¸ç›‘å¬è¯¥ç±»æè¿°ç¬¦ã€‚ timeval __timeoutç”¨æ¥æŒ‡å®šselectçš„å·¥ä½œæ–¹å¼ï¼Œå³å½“æ–‡ä»¶æè¿°ç¬¦å°šæœªå°±ç»ªæ—¶ï¼Œselectæ˜¯æ°¸è¿œç­‰ä¸‹å»ï¼Œè¿˜æ˜¯ç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œæˆ–è€…æ˜¯ç›´æ¥è¿”å› å‡½æ•°è¿”å›å€¼intè¡¨ç¤ºï¼š å°±ç»ªæè¿°ç¬¦çš„æ•°é‡ï¼Œå¦‚æœä¸º-1è¡¨ç¤ºäº§ç”Ÿé”™è¯¯ ã€‚ è¿è¡Œæœºåˆ¶Selectä¼šå°†å…¨éƒ¨fd_setã€æ–‡ä»¶æè¿°ç¬¦ã€ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œå¹¶æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œ åœ¨å†…æ ¸æ€ç©ºé—´æ¥åˆ¤æ–­æ¯ä¸ªè¯·æ±‚æ˜¯å¦å‡†å¤‡å¥½æ•°æ® ã€‚selectåœ¨æ²¡æœ‰æŸ¥è¯¢åˆ°æœ‰æ–‡ä»¶æè¿°ç¬¦å°±ç»ªçš„æƒ…å†µä¸‹ï¼Œå°†ä¸€ç›´é˜»å¡ï¼ˆselectæ˜¯ä¸€ä¸ªé˜»å¡å‡½æ•°ï¼‰ã€‚å¦‚æœæœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªæè¿°ç¬¦å°±ç»ªï¼Œselect ä¼šå»è½®è¯¢æ•´ä¸ª fd_setã€Œæ— å·®åˆ«è½®è¯¢ã€ã€‚ Selectçš„ç¼ºé™· æ¯æ¬¡è°ƒç”¨selectï¼Œéƒ½éœ€è¦æŠŠfdé›†åˆä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œfdè¶Šå¤šå¼€é”€åˆ™è¶Šå¤§ï¼› æ¯æ¬¡è°ƒç”¨selectï¼Œéƒ½éœ€è¦åœ¨å†…æ ¸éå†ä¼ é€’è¿›æ¥çš„æ‰€æœ‰fdï¼Œè¿™ä¸ªå¼€é”€åœ¨fdå¾ˆå¤šæ—¶ä¹Ÿå¾ˆå¤§ selectæ”¯æŒçš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡æœ‰é™ï¼Œé»˜è®¤æ˜¯1024ã€‚å‚è§/usr/include/linux/posix_types.hä¸­çš„å®šä¹‰ï¼š 1# define __FD_SETSIZE 1024 pollAPIç®€ä»‹linuxç³»ç»Ÿä¸­/usr/include/sys/poll.hæ–‡ä»¶ä¸­å¯¹pollæ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š 1234567891011121314151617/* Data structure describing a polling request. */struct pollfd &#123; int fd; /* File descriptor to poll. */ short int events; /* Types of events poller cares about. */ short int revents; /* Types of events that actually occurred. */ &#125;;/* Poll the file descriptors described by the NFDS structures starting at FDS. If TIMEOUT is nonzero and not -1, allow TIMEOUT milliseconds for an event to occur; if TIMEOUT is -1, block until an event occurs. Returns the number of file descriptors with events, zero if timed out, or -1 for errors. This function is a cancellation point and therefore not marked with __THROW. */extern int poll (struct pollfd *__fds, nfds_t __nfds, int __timeout); __fdså‚æ•°æ—¶Pollæœºåˆ¶ä¸­å®šä¹‰çš„ç»“æ„ä½“pollfdï¼Œç”¨æ¥æŒ‡å®šä¸€ä¸ªéœ€è¦ç›‘å¬çš„æè¿°ç¬¦ã€‚ç»“æ„ä½“ä¸­fdä¸ºéœ€è¦ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œeventsä¸ºéœ€è¦ç›‘å¬çš„äº‹ä»¶ç±»å‹ï¼Œè€Œreventsä¸ºç»è¿‡pollè°ƒç”¨ä¹‹åè¿”å›çš„äº‹ä»¶ç±»å‹ï¼Œåœ¨è°ƒç”¨pollçš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šä¼ å…¥ä¸€ä¸ªpollfdçš„ç»“æ„ä½“æ•°ç»„ï¼Œæ•°ç»„çš„å…ƒç´ ä¸ªæ•°è¡¨ç¤ºç›‘æ§çš„æè¿°ç¬¦ä¸ªæ•°ã€‚ __nfdså’Œ__timeoutå‚æ•°éƒ½å’ŒSelectæœºåˆ¶ä¸­çš„åŒåå‚æ•°å«ä¹‰ç±»ä¼¼ è¿è¡Œæœºåˆ¶pollçš„å®ç°å’Œselectéå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯æè¿°fdé›†åˆçš„æ–¹å¼ä¸åŒï¼Œpollä½¿ç”¨pollfd ç»“æ„ä»£æ›¿selectçš„fd_setï¼ˆç½‘ä¸Šè®²ï¼šç±»ä¼¼äºä½å›¾ï¼‰ç»“æ„ï¼Œå…¶ä»–çš„æœ¬è´¨ä¸Šéƒ½å·®ä¸å¤šã€‚æ‰€ä»¥Pollæœºåˆ¶çªç ´äº†Selectæœºåˆ¶ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡æœ€å¤§ä¸º1024çš„é™åˆ¶ã€‚ Pollçš„ç¼ºé™·Pollæœºåˆ¶ç›¸è¾ƒäºSelectæœºåˆ¶ä¸­ï¼Œè§£å†³äº†æ–‡ä»¶æè¿°ç¬¦æ•°é‡ä¸Šé™ä¸º1024çš„ç¼ºé™·ã€‚ä½†å¦å¤–ä¸¤ç‚¹ç¼ºé™·ä¾ç„¶å­˜åœ¨ï¼š æ¯æ¬¡è°ƒç”¨pollï¼Œéƒ½éœ€è¦æŠŠfdé›†åˆä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œfdè¶Šå¤šå¼€é”€åˆ™è¶Šå¤§ï¼› æ¯æ¬¡è°ƒç”¨pollï¼Œéƒ½éœ€è¦åœ¨å†…æ ¸éå†ä¼ é€’è¿›æ¥çš„æ‰€æœ‰fdï¼Œè¿™ä¸ªå¼€é”€åœ¨fdå¾ˆå¤šæ—¶ä¹Ÿå¾ˆå¤§ epollEpollåœ¨Linux2.6å†…æ ¸æ­£å¼æå‡ºï¼Œæ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„I/Oæ–¹å¼ã€‚ç›¸å¯¹äºselectæ¥è¯´ï¼Œepollæ²¡æœ‰æè¿°ç¬¦ä¸ªæ•°é™åˆ¶ï¼›ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦ï¼Œå°†ç”¨æˆ·å…³å¿ƒçš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œé€šè¿‡å†…å­˜æ˜ å°„ï¼Œä½¿å…¶åœ¨ç”¨æˆ·ç©ºé—´ä¹Ÿå¯ç›´æ¥è®¿é—®ï¼Œçœå»äº†æ‹·è´å¸¦æ¥çš„èµ„æºæ¶ˆè€—ã€‚ APIç®€ä»‹linuxç³»ç»Ÿä¸­/usr/include/sys/epoll.hæ–‡ä»¶ä¸­æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627/* Creates an epoll instance. Returns an fd for the new instance. The "size" parameter is a hint specifying the number of file descriptors to be associated with the new instance. The fd returned by epoll_create() should be closed with close(). */extern int epoll_create (int __size) __THROW;/* Manipulate an epoll instance "epfd". Returns 0 in case of success, -1 in case of error ( the "errno" variable will contain the specific error code ) The "op" parameter is one of the EPOLL_CTL_* constants defined above. The "fd" parameter is the target of the operation. The "event" parameter describes which events the caller is interested in and any associated user data. */extern int epoll_ctl (int __epfd, int __op, int __fd, struct epoll_event *__event) __THROW;/* Wait for events on an epoll instance "epfd". Returns the number of triggered events returned in "events" buffer. Or -1 in case of error with the "errno" variable set to the specific error code. The "events" parameter is a buffer that will contain triggered events. The "maxevents" is the maximum number of events to be returned ( usually size of "events" ). The "timeout" parameter specifies the maximum wait time in milliseconds (-1 == infinite). This function is a cancellation point and therefore not marked with __THROW. */extern int epoll_wait (int __epfd, struct epoll_event *__events, int __maxevents, int __timeout); epoll_createå‡½æ•°ï¼šåˆ›å»ºä¸€ä¸ªepollå®ä¾‹å¹¶è¿”å›ï¼Œè¯¥å®ä¾‹å¯ä»¥ç”¨äºç›‘æ§__sizeä¸ªæ–‡ä»¶æè¿°ç¬¦ epoll_ctlå‡½æ•°ï¼šå‘epollä¸­æ³¨å†Œäº‹ä»¶ï¼Œè¯¥å‡½æ•°å¦‚æœè°ƒç”¨æˆåŠŸè¿”å›0ï¼Œå¦åˆ™è¿”å›-1ã€‚ç”¨çº¢é»‘æ ‘æ¥ç®¡ç†è¿™äº›äº‹ä»¶ï¼Œæ¯æ–°å¢ä¸€ä¸ªäº‹ä»¶ï¼Œå°±æ–°å¢ä¸€ä¸ªçº¢é»‘æ ‘èŠ‚ç‚¹ã€‚ __epfdä¸ºepoll_createè¿”å›çš„epollå®ä¾‹ __opè¡¨ç¤ºè¦è¿›è¡Œçš„æ“ä½œ __fdä¸ºè¦è¿›è¡Œç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦ __eventè¦ç›‘æ§çš„äº‹ä»¶ epoll_waitå‡½æ•°ï¼šç±»ä¼¼ä¸selectæœºåˆ¶ä¸­çš„selectå‡½æ•°ã€pollæœºåˆ¶ä¸­çš„pollå‡½æ•°ï¼Œç­‰å¾…å†…æ ¸è¿”å›ç›‘å¬æè¿°ç¬¦çš„äº‹ä»¶äº§ç”Ÿã€‚è¯¥å‡½æ•°è¿”å›å·²ç»å°±ç»ªçš„äº‹ä»¶çš„æ•°é‡ï¼Œå¦‚æœä¸º-1è¡¨ç¤ºå‡ºé”™ã€‚ __epfdä¸ºepoll_createè¿”å›çš„epollå®ä¾‹ __eventsæ•°ç»„ä¸º epoll_waitè¦è¿”å›çš„å·²ç»äº§ç”Ÿçš„äº‹ä»¶é›†åˆ maxeventsä¸ºå¸Œæœ›è¿”å›çš„æœ€å¤§çš„äº‹ä»¶æ•°é‡ï¼ˆé€šå¸¸ä¸ºeventsçš„å¤§å°ï¼‰ __timeoutå’Œselectã€pollæœºåˆ¶ä¸­çš„åŒåå‚æ•°å«ä¹‰ç›¸åŒ è¿è¡Œæœºåˆ¶ epoll å°†ç­‰å¾…é˜Ÿåˆ—å’Œå°±ç»ªé˜Ÿåˆ—åˆ†å¼€ï¼Œçº¢é»‘æ ‘å­˜å‚¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ï¼Œè€Œä¸€æ—¦ I/O å°±ç»ªå°±å°†çº¢é»‘æ ‘èŠ‚ç‚¹è½¬ç§»åˆ°é“¾è¡¨ï¼Œæ‰€ä»¥åªè¦çœ‹åˆ°é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ï¼Œå°±èƒ½çŸ¥é“å“ªäº›äº‹ä»¶å‡†å¤‡å¥½äº†ã€‚ epollæ“ä½œè¿‡ç¨‹éœ€è¦ä¸Šè¿°ä¸‰ä¸ªå‡½æ•°ï¼Œä¹Ÿæ­£æ˜¯é€šè¿‡ä¸‰ä¸ªå‡½æ•°å®ŒæˆSelectæœºåˆ¶ä¸­ä¸€ä¸ªå‡½æ•°å®Œæˆçš„äº‹æƒ…ï¼Œè§£å†³äº†Selectæœºåˆ¶çš„ä¸‰å¤§ç¼ºé™·ã€‚epollçš„å·¥ä½œæœºåˆ¶æ›´ä¸ºå¤æ‚ï¼Œæˆ‘ä»¬å°±è§£é‡Šä¸€ä¸‹ï¼Œå®ƒæ˜¯å¦‚ä½•è§£å†³Selectæœºåˆ¶çš„ä¸‰å¤§ç¼ºé™·çš„ã€‚ å¯¹äºç¬¬ä¸€ä¸ªç¼ºç‚¹ï¼Œepollçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šå®ƒçš„fdæ˜¯å…±äº«åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„ï¼Œæ‰€ä»¥å¯ä»¥ä¸å¿…è¿›è¡Œä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„ä¸€ä¸ªæ‹·è´ï¼Œå¤§å¤§èŠ‚çº¦ç³»ç»Ÿèµ„æºã€‚è‡³äºå¦‚ä½•åšåˆ°ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Œå¤§å®¶å¯ä»¥æŸ¥ä¸€ä¸‹â€œmmapâ€ï¼Œå®ƒæ˜¯ä¸€ç§å†…å­˜æ˜ å°„çš„æ–¹æ³•ã€‚ å¯¹äºç¬¬äºŒä¸ªç¼ºç‚¹ï¼Œepollçš„è§£å†³æ–¹æ¡ˆä¸åƒselectæˆ–pollä¸€æ ·æ¯æ¬¡éƒ½æŠŠå½“å‰çº¿ç¨‹è½®æµåŠ å…¥fdå¯¹åº”çš„è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œè€Œåªåœ¨epoll_ctlæ—¶æŠŠå½“å‰çº¿ç¨‹æŒ‚ä¸€éï¼ˆè¿™ä¸€éå¿…ä¸å¯å°‘ï¼‰ï¼Œå¹¶ä¸ºæ¯ä¸ªfdæŒ‡å®šä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚å½“è®¾å¤‡å°±ç»ªï¼Œå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸Šçš„ç­‰å¾…è€…æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ï¼Œè€Œè¿™ä¸ªå›è°ƒå‡½æ•°ä¼šæŠŠå°±ç»ªçš„fdåŠ å…¥ä¸€ä¸ªå°±ç»ªé“¾è¡¨ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬è°ƒç”¨epoll_waitæ—¶ï¼Œepoll_waitåªéœ€è¦æ£€æŸ¥é“¾è¡¨ä¸­æ˜¯å¦æœ‰å­˜åœ¨å°±ç»ªçš„fdå³å¯ï¼Œæ•ˆç‡éå¸¸å¯è§‚ã€‚ å¯¹äºç¬¬ä¸‰ä¸ªç¼ºç‚¹ï¼Œfdæ•°é‡çš„é™åˆ¶ï¼Œä¹Ÿåªæœ‰Selectå­˜åœ¨ï¼ŒPollå’ŒEpolléƒ½ä¸å­˜åœ¨ã€‚ç”±äºEpollæœºåˆ¶ä¸­åªå…³å¿ƒå°±ç»ªçš„fdï¼Œå®ƒç›¸è¾ƒäºPolléœ€è¦å…³å¿ƒæ‰€æœ‰fdï¼Œåœ¨è¿æ¥è¾ƒå¤šçš„åœºæ™¯ä¸‹ï¼Œæ•ˆç‡æ›´é«˜ã€‚åœ¨1GBå†…å­˜çš„æœºå™¨ä¸Šå¤§çº¦æ˜¯10ä¸‡å·¦å³ï¼Œä¸€èˆ¬æ¥è¯´è¿™ä¸ªæ•°ç›®å’Œç³»ç»Ÿå†…å­˜å…³ç³»å¾ˆå¤§ã€‚ å·¥ä½œæ¨¡å¼ç›¸è¾ƒäºSelectå’ŒPollï¼ŒEpollå†…éƒ¨è¿˜åˆ†ä¸ºä¸¤ç§å·¥ä½œæ¨¡å¼ï¼š LTæ°´å¹³è§¦å‘ï¼ˆlevel triggerï¼‰å’ŒETè¾¹ç¼˜è§¦å‘ï¼ˆedge triggerï¼‰ã€‚ LTæ¨¡å¼ï¼š é»˜è®¤çš„å·¥ä½œæ¨¡å¼ï¼Œå³å½“epoll_waitæ£€æµ‹åˆ°æŸæè¿°ç¬¦äº‹ä»¶å°±ç»ªå¹¶é€šçŸ¥åº”ç”¨ç¨‹åºæ—¶ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ï¼›äº‹ä»¶ä¼šè¢«æ”¾å›åˆ°å°±ç»ªé“¾è¡¨ä¸­ï¼Œä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¼šå†æ¬¡é€šçŸ¥æ­¤äº‹ä»¶ã€‚ ETæ¨¡å¼ï¼š å½“epoll_waitæ£€æµ‹åˆ°æŸæè¿°ç¬¦äº‹ä»¶å°±ç»ªå¹¶é€šçŸ¥åº”ç”¨ç¨‹åºæ—¶ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚å¦‚æœä¸å¤„ç†ï¼Œä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¸ä¼šå†æ¬¡å“åº”å¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚ ç”±äºä¸Šè¿°ä¸¤ç§å·¥ä½œæ¨¡å¼çš„åŒºåˆ«ï¼ŒLTæ¨¡å¼åŒæ—¶æ”¯æŒblockå’Œno-block socketä¸¤ç§ï¼Œè€ŒETæ¨¡å¼ä¸‹ä»…æ”¯æŒno-block socketã€‚å³epollå·¥ä½œåœ¨ETæ¨¡å¼çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨éé˜»å¡å¥—æ¥å£ï¼Œä»¥é¿å…ç”±äºä¸€ä¸ªfdçš„é˜»å¡I/Oæ“ä½œæŠŠå¤šä¸ªå¤„ç†å…¶ä»–æ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚ETæ¨¡å¼åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†epolläº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯”LTæ¨¡å¼é«˜ã€‚ Epollçš„ä¼˜ç‚¹ æ–‡ä»¶æè¿°ç¬¦æ•°é‡ä¸å†å—é™ã€‚ epoll æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ select å’Œ poll ä¸æ˜¯ã€‚ epoll å†…éƒ¨ä½¿ç”¨äº† mmap å…±äº«äº†ç”¨æˆ·å’Œå†…æ ¸çš„éƒ¨åˆ†ç©ºé—´ï¼Œé¿å…äº†æ•°æ®çš„æ¥å›æ‹·è´ã€‚ selectã€pollé‡‡ç”¨è½®è¯¢çš„æ–¹å¼æ¥æ£€æŸ¥æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å¤„äºå°±ç»ªæ€ï¼Œè€Œepollé‡‡ç”¨å›è°ƒæœºåˆ¶ã€‚é€ æˆçš„ç»“æœå°±æ˜¯ï¼Œéšç€fdçš„å¢åŠ ï¼Œselectå’Œpollçš„æ•ˆç‡ä¼šçº¿æ€§é™ä½ï¼Œè€Œepollä¸ä¼šå—åˆ°å¤ªå¤§å½±å“ï¼Œé™¤éæ´»è·ƒçš„socketå¾ˆå¤šã€‚ epoll åŸºäºäº‹ä»¶é©±åŠ¨ï¼Œepoll_ctl æ³¨å†Œäº‹ä»¶å¹¶æ³¨å†Œ callback å›è°ƒå‡½æ•°ï¼Œepoll_wait åªè¿”å›å‘ç”Ÿçš„äº‹ä»¶é¿å…äº†åƒ select å’Œ poll å¯¹äº‹ä»¶çš„æ•´ä¸ªè½®è¯¢æ“ä½œã€‚ è™½ç„¶epollçš„æ€§èƒ½æœ€å¥½ï¼Œä½†æ˜¯åœ¨è¿æ¥æ•°å°‘å¹¶ä¸”è¿æ¥éƒ½ååˆ†æ´»è·ƒçš„æƒ…å†µä¸‹ï¼Œselectå’Œpollçš„æ€§èƒ½å¯èƒ½æ¯”epollå¥½ï¼Œæ¯•ç«Ÿepollçš„é€šçŸ¥æœºåˆ¶éœ€è¦å¾ˆå¤šå‡½æ•°å›è°ƒã€‚ ä¸‰è€…æ¯”è¾ƒ1. ç”¨æˆ·æ€å°†æ–‡ä»¶æè¿°ç¬¦ä¼ å…¥å†…æ ¸çš„æ–¹å¼ selectï¼šåˆ›å»º3ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†å¹¶æ‹·è´åˆ°å†…æ ¸ä¸­ï¼Œåˆ†åˆ«ç›‘å¬è¯»ã€å†™ã€å¼‚å¸¸åŠ¨ä½œã€‚è¿™é‡Œå—åˆ°å•ä¸ªè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„fdæ•°é‡é™åˆ¶ï¼Œé»˜è®¤æ˜¯1024ã€‚ pollï¼šå°†ä¼ å…¥çš„struct pollfdç»“æ„ä½“æ•°ç»„æ‹·è´åˆ°å†…æ ¸ä¸­è¿›è¡Œç›‘å¬ã€‚ epollï¼šæ‰§è¡Œepoll_createä¼šåœ¨å†…æ ¸çš„é«˜é€ŸcacheåŒºä¸­å»ºç«‹ä¸€é¢—çº¢é»‘æ ‘ä»¥åŠå°±ç»ªé“¾è¡¨(è¯¥é“¾è¡¨å­˜å‚¨å·²ç»å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦)ã€‚æ¥ç€ç”¨æˆ·æ‰§è¡Œçš„epoll_ctlå‡½æ•°æ·»åŠ æ–‡ä»¶æè¿°ç¬¦ä¼šåœ¨çº¢é»‘æ ‘ä¸Šå¢åŠ ç›¸åº”çš„ç»“ç‚¹ã€‚ 2. å†…æ ¸æ€æ£€æµ‹æ–‡ä»¶æè¿°ç¬¦è¯»å†™çŠ¶æ€çš„æ–¹å¼ selectï¼šé‡‡ç”¨è½®è¯¢æ–¹å¼ï¼Œéå†æ‰€æœ‰fdï¼Œæœ€åè¿”å›ä¸€ä¸ªæè¿°ç¬¦è¯»å†™æ“ä½œæ˜¯å¦å°±ç»ªçš„maskæ©ç ï¼Œæ ¹æ®è¿™ä¸ªæ©ç ç»™fd_setèµ‹å€¼ã€‚ pollï¼šåŒæ ·é‡‡ç”¨è½®è¯¢æ–¹å¼ï¼ŒæŸ¥è¯¢æ¯ä¸ªfdçš„çŠ¶æ€ï¼Œå¦‚æœå°±ç»ªåˆ™åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­åŠ å…¥ä¸€é¡¹å¹¶ç»§ç»­éå†ã€‚ epollï¼šé‡‡ç”¨å›è°ƒæœºåˆ¶ã€‚åœ¨æ‰§è¡Œepoll_ctlçš„addæ“ä½œæ—¶ï¼Œä¸ä»…å°†æ–‡ä»¶æè¿°ç¬¦æ”¾åˆ°çº¢é»‘æ ‘ä¸Šï¼Œè€Œä¸”ä¹Ÿæ³¨å†Œäº†å›è°ƒå‡½æ•°ï¼Œå†…æ ¸åœ¨æ£€æµ‹åˆ°æŸæ–‡ä»¶æè¿°ç¬¦å¯è¯»/å¯å†™æ—¶ä¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°å°†æ–‡ä»¶æè¿°ç¬¦æ”¾åœ¨å°±ç»ªé“¾è¡¨ä¸­ã€‚ 3. æ‰¾åˆ°å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦å¹¶ä¼ é€’ç»™ç”¨æˆ·æ€çš„æ–¹å¼ selectï¼šå°†ä¹‹å‰ä¼ å…¥çš„fd_setæ‹·è´ä¼ å‡ºåˆ°ç”¨æˆ·æ€å¹¶è¿”å›å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ€»æ•°ã€‚ç”¨æˆ·æ€å¹¶ä¸çŸ¥é“æ˜¯å“ªäº›æ–‡ä»¶æè¿°ç¬¦å¤„äºå°±ç»ªæ€ï¼Œéœ€è¦éå†æ¥åˆ¤æ–­ã€‚ pollï¼šå°†ä¹‹å‰ä¼ å…¥çš„fdæ•°ç»„æ‹·è´ä¼ å‡ºç”¨æˆ·æ€å¹¶è¿”å›å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ€»æ•°ã€‚ç”¨æˆ·æ€å¹¶ä¸çŸ¥é“æ˜¯å“ªäº›æ–‡ä»¶æè¿°ç¬¦å¤„äºå°±ç»ªæ€ï¼Œéœ€è¦éå†æ¥åˆ¤æ–­ã€‚ epollï¼šepoll_waitåªç”¨è§‚å¯Ÿå°±ç»ªé“¾è¡¨ä¸­æœ‰æ— æ•°æ®å³å¯ï¼Œæœ€åå°†é“¾è¡¨çš„æ•°æ®è¿”å›ç»™æ•°ç»„å¹¶è¿”å›å°±ç»ªçš„æ•°é‡ã€‚å†…æ ¸å°†å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ”¾åœ¨ä¼ å…¥çš„æ•°ç»„ä¸­ï¼Œæ‰€ä»¥åªç”¨éå†ä¾æ¬¡å¤„ç†å³å¯ã€‚è¿™é‡Œè¿”å›çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯é€šè¿‡mmapè®©å†…æ ¸å’Œç”¨æˆ·ç©ºé—´å…±äº«åŒä¸€å—å†…å­˜å®ç°ä¼ é€’çš„ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„æ‹·è´ã€‚ 4. é‡å¤ç›‘å¬çš„å¤„ç†æ–¹å¼ selectï¼šå°†æ–°çš„ç›‘å¬æ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´ä¼ å…¥å†…æ ¸ä¸­ï¼Œç»§ç»­ä»¥ä¸Šæ­¥éª¤ã€‚ pollï¼šå°†æ–°çš„struct pollfdç»“æ„ä½“æ•°ç»„æ‹·è´ä¼ å…¥å†…æ ¸ä¸­ï¼Œç»§ç»­ä»¥ä¸Šæ­¥éª¤ã€‚ epollï¼šæ— éœ€é‡æ–°æ„å»ºçº¢é»‘æ ‘ï¼Œç›´æ¥æ²¿ç”¨å·²å­˜åœ¨çš„å³å¯ã€‚ NIO å¦‚ä½•ä½¿ç”¨çš„è¿™ä¸‰å…„å¼Ÿ å…·ä½“çš„ demo åˆ†æå¯ä»¥çœ‹ï¼šhttps://blog.csdn.net/nieyanshun_me/article/details/52397153 åœ¨ windows ä¸‹ï¼Œåªæ”¯æŒ selectï¼Œä¸æ”¯æŒ epollï¼Œè€Œ linux 2.6æ˜¯æ”¯æŒ epollçš„ï¼Œä» demo ä¸­å¯ä»¥çŸ¥é“ selector.select(); è¿™ä¸€æ­¥è°ƒç”¨äº† epoll ç³»ç»Ÿè°ƒç”¨ã€Œå¤æ‚åº¦ O(1)ã€ï¼Œåªè¦å®¢æˆ·ç«¯å‡†å¤‡å¥½äº†æ•°æ®ï¼Œå°±ä¼šå»å‘ŠçŸ¥ Selector æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå¯ä»¥è¿›è¡Œ I/O è¯»å†™äº†ï¼Œè€Œä¸æ˜¯åƒ select ã€Œå¤æ‚åº¦ O(n)ã€ï¼ŒçŸ¥é“æœ‰æ•°æ®å‡†å¤‡å¥½äº†ä¹‹åï¼ŒæŠŠæ‰€æœ‰çš„è¿æ¥å…¨éƒ¨è½®ä¸€éï¼Œçœ‹çœ‹æ˜¯è°å‡†å¤‡å¥½äº†â€¦è´¹æ—¶è´¹åŠ›ã€‚æ‰€ä»¥è¯´å•Šï¼Œè¿˜æ˜¯äº‹åŠ¡é©±åŠ¨å¥½å•Šï¼Œå°±è·Ÿæˆ‘ä»¬å­¦ä¹ ä¸€æ ·ï¼Œè¿˜æ˜¯ä¸€è¾¹é¢è¯•ä¸€è¾¹å­¦æŸäº›çŸ¥è¯†ä¼šæ›´å¿«ä¸€ç‚¹ï¼Œselect å°±åƒæˆ‘ä»¬è‡ªå·±çœ‹ä¹¦ä¸€æ ·ï¼ŒçŸ¥é“è‡ªå·±æœ‰ä¸è¶³äº†ï¼Œä½†æ˜¯ä¸çŸ¥é“å“ªå—ä¸è¡Œï¼Œäºæ˜¯å°±æŠŠæ‰€æœ‰çŸ¥è¯†å…¨éƒ¨å¤ä¹ ä¸€éï¼Œepoll å°±ç›¸å½“äºé¢è¯•çš„æ—¶å€™é¢è¯•å®˜ç›´æ¥å‘Šè¯‰ä½ å“ªå—èœçš„ä¸è¡Œï¼Œç„¶åä½ å°±èƒ½å¯¹ç—‡ä¸‹è¯å¹¶ä¸”æœ€å¿«æ•ˆç‡çš„è¡¥é½è‡ªå·±çš„çŸ­æ¿ã€‚ ä» NIO çœ‹ Nettyåœ¨ NIO ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä¸»è¦æ˜¯ä»‹ç»äº†ä¸‹å…¶æ–‡ä»¶ IO ç”¨åˆ°çš„é›¶æ‹·è´æŠ€æœ¯ä»¥åŠ IO å¤ç”¨æŠ€æœ¯ï¼Œè¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä¼šä» NIO çš„è§’åº¦ï¼Œä¸€çª¥è‘—åçš„ Nettyã€‚ Netty äº§ç”Ÿçš„ç¼˜ç”± JDK çš„ NIO ç¼–ç¨‹å¤æ‚ã€‚æ¨¡å‹ä¸å‹å¥½ï¼ŒByteBuffer çš„ api åäººç±»ï¼› æ²¡æœ‰å®ç°çº¿ç¨‹æ¨¡å‹ï¼Œè¿è‡ªå®šä¹‰åè®®æ‹†åŒ…éƒ½éœ€è¦è‡ªå·±å®ç°ï¼› JDK çš„ NIOï¼Œbug å¤ªå¤šï¼Œç»´æŠ¤æˆæœ¬è¿‡é«˜ã€‚ æ‰€ä»¥ï¼Œä¸ä¹‹å¯¹åº”ï¼ŒNetty çš„å¥½å¤„åœ¨äºï¼š Nettyåº•å±‚IOæ¨¡å‹éšæ„å¯åˆ‡æ¢ï¼› è‡ªå¸¦æ‹†åŒ…è§£åŒ…ï¼Œå¼‚å¸¸æ£€æµ‹ç­‰æœºåˆ¶ï¼Œåªéœ€è¦å…³å¿ƒä¸šåŠ¡é€»è¾‘ï¼› Netty çš„çº¿ç¨‹æ¨¡å‹ä¼˜åŒ–çš„å¥½ï¼Œç²¾å¿ƒè®¾è®¡çš„ Reactor æ¨¡å‹å¯ä»¥åšåˆ°éå¸¸é«˜æ•ˆï¼› è‡ªå¸¦å„ç§åè®®æ ˆï¼› ç¤¾åŒºæ´»è·ƒã€dubboã€hsfã€kafkaã€metaQéƒ½åœ¨ä½¿ç”¨ï¼Œå¥å£®æ€§ç»å—è€ƒéªŒã€‚ åŸºæœ¬æ¦‚å¿µ Netty is an asynchronous event-driven network application framework for rapid development of maintainable high performance protocol servers &amp; clients. ä»å®˜ç½‘ä¸Šçš„ä»‹ç»å¯ä»¥çœ‹åˆ°ï¼ŒNetty æ˜¯ä¸€ä¸ªç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œæä¾›äº†å¼‚æ­¥äº‹ä»¶é©±åŠ¨ çš„æ–¹å¼ï¼Œä½¿ç”¨ Netty å¯ä»¥å¿«é€Ÿå¼€å‘å‡ºä¸€ä¸ªé«˜æ€§èƒ½çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£æˆ Netty æ˜¯ä¸€å¥—åœ¨ java NIO çš„åŸºç¡€ä¸Šå°è£…çš„ä¾¿äºç”¨æˆ·å¼€å‘ç½‘ç»œåº”ç”¨ç¨‹åºçš„ api ã€‚ æ•´ä½“æ¶æ„è®©æˆ‘ä»¬æ¥çœ‹çœ‹ Netty çš„æ•´ä½“æ¶æ„ï¼š å¯ä»¥çœ‹åˆ°ï¼ŒNetty ä¸»è¦åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š åº•å±‚çš„é›¶æ‹·è´æŠ€æœ¯ã€äº‹ä»¶é©±åŠ¨æ¨¡å‹ä»¥åŠç»Ÿä¸€çš„é€šä¿¡æ¨¡å‹â€”Reactorï¼› åŸºäº JVM å®ç°çš„ä¼ è¾“å±‚ï¼› å¸¸ç”¨åè®®çš„æ”¯æŒï¼Œå¦‚ HTTPã€SSLã€gzipç­‰ç­‰ã€‚ é‡æ–°å®ç° ByteBufferNetty é‡æ–°å®ç°äº† NIO ä¸­çš„ ByteBufferï¼Œå¯ä»¥æ›´å¥½çš„è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œä¾‹å¦‚åŠåŒ…ã€ç²˜åŒ…ã€‚ åŠåŒ…ï¼šæ¥æ”¶ç«¯å°†ä¸€ä¸ªå‘é€ç«¯çš„ ByteBuffer â€œæ‹†å¼€â€ äº†ï¼Œæ”¶åˆ°äº†å¤šä¸ªç ´ç¢çš„åŒ…ï¼› ç²˜åŒ…ï¼šæ¥æ”¶ç«¯æ”¶åˆ°äº†å¤šä¸ª ByteBufferã€‚ è§£å†³æ€è·¯å°±æ˜¯æ ¹æ®è‡ªå®šä¹‰åè®®ï¼Œå°†æ•°æ®è¯»å–åˆ°ç¼“å†²åŒºè¿›è¡ŒäºŒæ¬¡æ‹¼è£…ï¼Œé‡æ–°ç»„è£…å¾—åˆ°æˆ‘ä»¬åº”ç”¨å±‚çš„æ•°æ®åŒ…ã€‚ ç»Ÿä¸€çš„ I/O æ¥å£Netty æœ‰ Channel è¿™ä¸ªç»Ÿä¸€çš„ç¼–ç¨‹æ¥å£ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¼ è¾“å±‚è¿›è¡Œå®ç°çš„åˆ‡æ¢ï¼Œä¾‹å¦‚å¯ä»¥å°† Socket åˆ‡æ¢æˆ Datagramï¼Œè¿˜å¯ä»¥çµæ´»çš„åœ¨ NIO å’Œ BIO ä¸­è¿›è¡Œåˆ‡æ¢ï¼Œç”±äºæ ¸å¿ƒ API å…·æœ‰é«˜åº¦çš„å¯æ‰©å±•æ€§ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„å®šåˆ¶è‡ªå·±çš„ä¼ è¾“å®ç°ã€‚ é«˜çº§ç»„ä»¶Netty æä¾›äº†ä¸€ç³»åˆ—é«˜çº§ç»„ä»¶ï¼Œå¦‚ SSL/TLS æ”¯æŒã€HTTPå®ç°ç­‰ç­‰ã€‚ åŸºäºæ‹¦æˆªé“¾æ¨¡å¼çš„äº‹ä»¶æ¨¡å‹ä¸€ä¸ªå®šä¹‰è‰¯å¥½å¹¶å…·æœ‰æ‰©å±•èƒ½åŠ›çš„äº‹ä»¶æ¨¡å‹æ˜¯äº‹ä»¶é©±åŠ¨å¼€å‘çš„å¿…è¦æ¡ä»¶ã€‚Netty å…·æœ‰å®šä¹‰è‰¯å¥½çš„ I/O äº‹ä»¶æ¨¡å‹ã€‚ç”±äºä¸¥æ ¼çš„å±‚æ¬¡ç»“æ„åŒºåˆ†äº†ä¸åŒçš„äº‹ä»¶ç±»å‹ï¼Œå› æ­¤ Netty ä¹Ÿå…è®¸ä½ åœ¨ä¸ç ´åç°æœ‰ä»£ç çš„æƒ…å†µä¸‹å®ç°è‡ªå·±çš„äº‹ä»¶ç±»å‹ã€‚è¿™æ˜¯ä¸å…¶ä»–æ¡†æ¶ç›¸æ¯”å¦ä¸€ä¸ªä¸åŒçš„åœ°æ–¹ã€‚å¾ˆå¤š NIO æ¡†æ¶æ²¡æœ‰æˆ–è€…ä»…æœ‰æœ‰é™çš„äº‹ä»¶æ¨¡å‹æ¦‚å¿µï¼›åœ¨ä½ è¯•å›¾æ·»åŠ ä¸€ä¸ªæ–°çš„äº‹ä»¶ç±»å‹çš„æ—¶å€™å¸¸å¸¸éœ€è¦ä¿®æ”¹å·²æœ‰çš„ä»£ç ï¼Œæˆ–è€…æ ¹æœ¬å°±ä¸å…è®¸ä½ è¿›è¡Œè¿™ç§æ‰©å±•ã€‚ è¿™å—æš‚æ—¶æ²¡å•¥ä½“æ„Ÿâ€¦ å¼‚æ­¥äº‹ä»¶é©±åŠ¨ â€” Reactor æ¨¡å‹ ä¸»è¦å‚è€ƒï¼šhttps://cloud.tencent.com/developer/article/1488120 è¿™é‡Œé‡‡ç”¨çš„â€œå¼‚æ­¥äº‹ä»¶é©±åŠ¨â€ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šæ–‡è®²çš„ IO å¤ç”¨æŠ€æœ¯ï¼Œä¹Ÿå¯ä»¥æ¢ä¸ªåå­—ï¼Œå°±æ˜¯ reactor æ¨¡å‹ã€‚ä¹Ÿç§°ä¸º Dispatcher æ¨¡å‹ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºåŒæ­¥éé˜»å¡æ¨¡å‹ã€‚ æœ‰äººå¯èƒ½ä¼šå¥‡æ€ªï¼Œè¿™é‡Œæ˜æ˜è°ˆåˆ°çš„æ˜¯ â€œå¼‚æ­¥äº‹ä»¶é©±åŠ¨â€ï¼Œæ€ä¹ˆåˆæ˜¯ â€œåŒæ­¥éé˜»å¡æ¨¡å‹â€ï¼Œè¿™é‡Œæˆ‘å°±è¦ç¨å¾®è§£é‡Šä¸€ä¸‹äº†ï¼Œåœ¨ â€œåŒæ­¥éé˜»å¡â€ ä¸­ï¼Œå…¶å®ä¹Ÿæœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ç§æ˜¯éäº‹ä»¶é©±åŠ¨ï¼Œçº¿ç¨‹ä¸»åŠ¨å»è¯¢é—®æ•°æ®æ˜¯å¦å‡†å¤‡å¥½äº†ã€Œselectã€ï¼Œå¦å¤–ä¸€ç§å‘¢ï¼Œå°±æ˜¯äº‹ä»¶é©±åŠ¨ï¼Œæ•°æ®å‡†å¤‡å¥½äº†ä¹‹åä¸»åŠ¨å‘ŠçŸ¥å¯¹åº”çš„çº¿ç¨‹ã€Œepollã€ï¼Œè¿™é‡Œçš„ â€œå¼‚æ­¥â€ ï¼ŒæŒ‡çš„å°±æ˜¯çº¿ç¨‹æ— éœ€ä¸»åŠ¨çš„å»è¯¢é—®æ•°æ®æ˜¯å¦å‡†å¤‡å¥½äº†ï¼Œè€Œæ˜¯å¯ä»¥å»å¹²å…¶ä»–äº‹æƒ…ï¼Œæ­¤æ—¶çš„çº¿ç¨‹å’Œæ•°æ®å‡†å¤‡çš„ç¡®æ˜¯å¼‚æ­¥çš„ã€‚ ä¸¾ä¸ªç”Ÿæ´»ä¸­æ›´å¸¸è§çš„ä¾‹å­ï¼Œä¸€ä¸ªæ˜¯ï¼š å¦‚æœä½ æƒ³åƒä¸€ä»½å¤è‚‰é¥­ï¼Œåœ¨é¥­é¦†ç‚¹å®Œé¤ï¼Œå°±å»é›ç‹—äº†ã€‚ä¸è¿‡é›ä¸€ä¼šå„¿ï¼Œå°±å›é¥­é¦†å–Šä¸€å£°ï¼šå¥½äº†æ²¡å•Šï¼â€”â€“ éäº‹ä»¶é©±åŠ¨ å¦‚æœä½ æƒ³åƒä¸€ä»½å¤è‚‰é¥­ï¼Œåœ¨é¥­é¦†ç‚¹å®Œé¤ï¼Œå°±å»é›ç‹—äº†ï¼Œé›ç‹—çš„æ—¶å€™ï¼Œæ¥åˆ°é¥­é¦†ç”µè¯ï¼Œè¯´é¥­åšå¥½äº†ï¼Œè®©æ‚¨äº²è‡ªå»æ‹¿ã€‚â€” äº‹ä»¶é©±åŠ¨ è¿™é‡Œèƒ½çœ‹åˆ°æˆ‘ä»¬åœ¨é›ç‹—çš„æ—¶å€™æ— éœ€å›å»é—®é¥­æ˜¯å¦åšå¥½äº†ï¼Œå¼‚æ­¥çš„æ¦‚å¿µå°±å¾ˆæ˜æ˜¾äº†ï¼ è€ŒåŒæ­¥éé˜»å¡ï¼Œåˆ™æ˜¯ä»æ•´ä¸ªIOä¼ è¾“çš„è§’åº¦çœ‹ï¼Œåœ¨æ•°æ®å‡†å¤‡å°±ç»ªä¹‹åï¼Œä¾æ—§éœ€è¦å†…æ ¸æ¥è°ƒåº¦æ–°çš„çº¿ç¨‹æ¥è¿›è¡ŒIOä¼ è¾“ï¼Œè¿™æ ·æ˜æ˜¾æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥è¯´ï¼ŒäºŒè€…çš„åŒæ­¥å¼‚æ­¥çš„èŒƒå›´ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯ä»…ä»…èšç„¦äºIOå‡†å¤‡å°±ç»ªï¼Œä¸€ä¸ªæ˜¯èšç„¦äºæ•´ä¸ªçš„IOä¼ è¾“ã€‚ æ¦‚è¿°Reactoræ¨¡å‹ä¸­å®šä¹‰çš„ä¸‰ç§è§’è‰²ï¼š Reactorï¼šè´Ÿè´£ç›‘å¬å’Œåˆ†é…äº‹ä»¶ï¼Œå°†I/Oäº‹ä»¶åˆ†æ´¾ç»™å¯¹åº”çš„Handlerã€‚æ–°çš„äº‹ä»¶åŒ…å«è¿æ¥å»ºç«‹å°±ç»ªã€è¯»å°±ç»ªã€å†™å°±ç»ªç­‰ã€‚ä¹Ÿå°±æ˜¯ä¸Šæ–‡ä»£ç ä¸­çš„ â€œselectâ€ è§’è‰²ï¼› Acceptorï¼šå¤„ç†å®¢æˆ·ç«¯æ–°è¿æ¥ï¼Œå¹¶åˆ†æ´¾è¯·æ±‚åˆ°å¤„ç†å™¨é“¾ä¸­ã€‚å°±æ˜¯ä¸Šæ–‡ä»£ç ä¸­è§¦å‘ â€œacceptâ€ è¯­ä¹‰ã€‚ Handlerï¼šå°†è‡ªèº«ä¸äº‹ä»¶ç»‘å®šï¼Œæ‰§è¡Œéé˜»å¡è¯»/å†™ä»»åŠ¡ï¼Œå®Œæˆchannelçš„è¯»å…¥ï¼Œå®Œæˆå¤„ç†ä¸šåŠ¡é€»è¾‘åï¼Œè´Ÿè´£å°†ç»“æœå†™å‡ºchannelã€‚å¯ç”¨èµ„æºæ± æ¥ç®¡ç†ã€‚å°±æ˜¯ä¸Šæ–‡ä»£ç ä¸­è§¦å‘ â€œreadâ€è¯­ä¹‰ã€‚ Reactorå¤„ç†è¯·æ±‚çš„æµç¨‹ï¼š è¯»å–æ“ä½œï¼š åº”ç”¨ç¨‹åºæ³¨å†Œè¯»å°±ç»ªäº‹ä»¶å’Œç›¸å…³è”çš„äº‹ä»¶å¤„ç†å™¨ï¼› äº‹ä»¶åˆ†ç¦»å™¨ç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿï¼› å½“å‘ç”Ÿè¯»å°±ç»ªäº‹ä»¶çš„æ—¶å€™ï¼Œäº‹ä»¶åˆ†ç¦»å™¨è°ƒç”¨ç¬¬ä¸€æ­¥æ³¨å†Œçš„äº‹ä»¶å¤„ç†å™¨ï¼› å†™å…¥æ“ä½œç±»ä¼¼äºè¯»å–æ“ä½œï¼Œåªä¸è¿‡ç¬¬ä¸€æ­¥æ³¨å†Œçš„æ˜¯å†™å°±ç»ªäº‹ä»¶ã€‚ å• Reactor å•çº¿ç¨‹æ¨¡å‹Reactorçº¿ç¨‹è´Ÿè´£å¤šè·¯åˆ†ç¦»å¥—æ¥å­—ï¼Œacceptæ–°è¿æ¥ï¼Œå¹¶åˆ†æ´¾è¯·æ±‚åˆ°handlerã€‚Redisä½¿ç”¨å•Reactorå•è¿›ç¨‹çš„æ¨¡å‹ã€‚ æ¶ˆæ¯å¤„ç†æµç¨‹ï¼š Reactorå¯¹è±¡é€šè¿‡selectç›‘æ§è¿æ¥äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡dispatchè¿›è¡Œè½¬å‘ã€‚ å¦‚æœæ˜¯è¿æ¥å»ºç«‹çš„äº‹ä»¶ï¼Œåˆ™ç”±acceptoræ¥å—è¿æ¥ï¼Œå¹¶åˆ›å»ºhandlerå¤„ç†åç»­äº‹ä»¶ã€‚ å¦‚æœä¸æ˜¯å»ºç«‹è¿æ¥äº‹ä»¶ï¼Œåˆ™Reactorä¼šåˆ†å‘è°ƒç”¨Handleræ¥å“åº”ã€‚ handlerä¼šå®Œæˆread-&gt;ä¸šåŠ¡å¤„ç†-&gt;sendçš„å®Œæ•´ä¸šåŠ¡æµç¨‹ã€‚ è¿™é‡Œçš„ handler æ²¡æœ‰å¼‚æ­¥ï¼Œæ‰€ä»¥å¯¹äºé«˜è´Ÿè½½ã€å¤§å¹¶å‘çš„åº”ç”¨åœºæ™¯å¹¶ä¸åˆé€‚ã€‚ Tip: è¿™é‡Œç…§åº”ä¸Šé¢çš„ä¾‹å­ï¼Œå• Reactor å•çº¿ç¨‹æ¨¡å‹å…¶å®å°±ç›¸å½“äºåªæœ‰ä¸€ä¸ªä¸“é—¨è´Ÿè´£æ¥å¾…çš„æœåŠ¡å‘˜ï¼Œä»–ä¸ä»…è¦è´Ÿè´£è¯¢é—®æˆ‘ä»¬æ˜¯å¦è¦è¿›åº—ã€Œæ³¨å†Œå¥—æ¥å­—ï¼Œç»‘å®šç«¯å£ã€ï¼Œè¿˜è¦è´Ÿè´£å‘Šè¯‰å¼•å¯¼å‘˜å°†é¡¾å®¢å¸¦å…¥ç›¸åº”çš„åº§ä½ã€Œacceptoræ¥å—è¿æ¥ï¼Œå‡†å¤‡è¿›è¡Œè¯»å–ã€ï¼Œæœ€åè¿˜è¦è´Ÿè´£é€šçŸ¥ä¸Šèœå‘˜ä¸Šèœã€Œhandlerï¼Œä¼ è¾“æ•°æ®ã€ å• Reactor å¤šçº¿ç¨‹æ¨¡å‹ä¸å•çº¿ç¨‹æ¨¡å‹ç›¸æ¯”ï¼Œè¿™é‡Œå¼•å…¥äº† worker çº¿ç¨‹æ± è¿›è¡Œä¸šåŠ¡æµç¨‹çš„å¤„ç†ã€‚ æ¶ˆæ¯å¤„ç†æµç¨‹ï¼š Reactorå¯¹è±¡é€šè¿‡Selectç›‘æ§å®¢æˆ·ç«¯è¯·æ±‚äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡dispatchè¿›è¡Œåˆ†å‘ã€‚ å¦‚æœæ˜¯å»ºç«‹è¿æ¥è¯·æ±‚äº‹ä»¶ï¼Œåˆ™ç”±acceptoré€šè¿‡acceptå¤„ç†è¿æ¥è¯·æ±‚ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªHandlerå¯¹è±¡å¤„ç†è¿æ¥å®Œæˆåç»­çš„å„ç§äº‹ä»¶ã€‚ å¦‚æœä¸æ˜¯å»ºç«‹è¿æ¥äº‹ä»¶ï¼Œåˆ™Reactorä¼šåˆ†å‘è°ƒç”¨è¿æ¥å¯¹åº”çš„Handleræ¥å“åº”ã€‚ Handleråªè´Ÿè´£å“åº”äº‹ä»¶ï¼Œä¸åšå…·ä½“ä¸šåŠ¡å¤„ç†ï¼Œé€šè¿‡Readè¯»å–æ•°æ®åï¼Œä¼šåˆ†å‘ç»™åé¢çš„Workerçº¿ç¨‹æ± è¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚ Workerçº¿ç¨‹æ± ä¼šåˆ†é…ç‹¬ç«‹çš„çº¿ç¨‹å®ŒæˆçœŸæ­£çš„ä¸šåŠ¡å¤„ç†ï¼Œå¦‚ä½•å°†å“åº”ç»“æœå‘ç»™Handlerè¿›è¡Œå¤„ç†ã€‚ Handleræ”¶åˆ°å“åº”ç»“æœåé€šè¿‡sendå°†å“åº”ç»“æœè¿”å›ç»™Clientã€‚ Tip: è¿™é‡Œç…§åº”ä¸Šé¢çš„ä¾‹å­ï¼Œå• Reactor å¤šçº¿ç¨‹æ¨¡å‹å…¶å®å°±ç›¸å½“äºæœ€åæ‹¿èµ°èœå•çš„é‚£ä¸ªäººå›åˆ°å¨æˆ¿ï¼Œç„¶åæœ‰å¾ˆå¤šäººä¸Šèœã€‚ å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„ reactorã€acceptã€handleréƒ½ä¸“æ³¨äºåˆ†å‘äº†ï¼Œä¸šåŠ¡å¤„ç†äº¤ç”± worker çº¿ç¨‹æ± å»å¤„ç†äº†ï¼Œè¿™æ ·æ•´ä¸ªç³»ç»Ÿçš„ååå°±ä¸Šå»äº†ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªæ¨¡å‹è¿˜æ˜¯å­˜åœ¨ä¸¤ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„é—®é¢˜ï¼š å¦‚æœå­çº¿ç¨‹å®Œæˆä¸šåŠ¡å¤„ç†åï¼ŒæŠŠç»“æœä¼ é€’ç»™ä¸»çº¿ç¨‹Reactorè¿›è¡Œå‘é€ï¼Œå°±ä¼šæ¶‰åŠå…±äº«æ•°æ®çš„äº’æ–¥å’Œä¿æŠ¤æœºåˆ¶ã€‚ Reactoræ‰¿æ‹…æ‰€æœ‰äº‹ä»¶çš„ç›‘å¬å’Œå“åº”ï¼Œåªåœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œï¼Œå¯èƒ½ä¼šå­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚ä¾‹å¦‚å¹¶å‘ç™¾ä¸‡å®¢æˆ·ç«¯è¿æ¥ï¼Œæˆ–è€…æœåŠ¡ç«¯éœ€è¦å¯¹å®¢æˆ·ç«¯æ¡æ‰‹è¿›è¡Œå®‰å…¨è®¤è¯ï¼Œä½†æ˜¯è®¤è¯æœ¬èº«éå¸¸æŸè€—æ€§èƒ½ã€‚ ä¸€å¥è¯æ¥è¯´ï¼Œå°±æ˜¯ä¸“é—¨è´Ÿè´£æ¥å¾…çš„æœåŠ¡å‘˜å¤ªå¿™äº†ï¼Œæ‰€æœ‰é€šçŸ¥çš„æ´»éƒ½è¦ä»–æ¥å¹²â€¦ ä¸»ä» Reactor å¤šçº¿ç¨‹æ¨¡å‹æ¯”èµ·ç¬¬äºŒç§æ¨¡å‹ï¼Œå®ƒæ˜¯å°†Reactoråˆ†æˆä¸¤éƒ¨åˆ†ï¼š mainReactorè´Ÿè´£ç›‘å¬server socketï¼Œç”¨æ¥å¤„ç†ç½‘ç»œIOè¿æ¥å»ºç«‹æ“ä½œï¼Œå°†å»ºç«‹çš„socketChannelæŒ‡å®šæ³¨å†Œç»™subReactorã€‚ subReactorã€Œè¿™é‡Œä¹Ÿå¯ä»¥æ˜¯å¤šçº¿ç¨‹ã€ä¸»è¦åšå’Œå»ºç«‹èµ·æ¥çš„socketåšæ•°æ®äº¤äº’å’Œäº‹ä»¶ä¸šåŠ¡å¤„ç†æ“ä½œã€‚é€šå¸¸ï¼ŒsubReactorä¸ªæ•°ä¸Šå¯ä¸CPUä¸ªæ•°ç­‰åŒã€‚ é€šä¿—ç‚¹æ¥è¯´ï¼Œå°±æ˜¯è´Ÿè´£æ¥å¾…çš„æœåŠ¡å‘˜åªéœ€è¦ç«™åœ¨é—¨å£ï¼Œé—®åˆ«äººæ˜¯å¦è¦è¿›æ¥å°±é¤ï¼Œå‰©ä¸‹çš„äº‹æƒ…ï¼Œå¦‚å°†å…¶å¼•å¯¼åˆ°ç›¸åº”çš„ä½ç½®ã€Œç›¸å½“äºå»ºç«‹è¿æ¥ã€ã€å‘ŠçŸ¥é¡¾å®¢èœå…¨éƒ¨ä¸Šå®Œäº†ã€Œç›¸å½“äºworkerå¹²å®Œäº†ï¼Œéœ€è¦é€šçŸ¥ç»™clientã€ï¼Œå°±ç”± subReactoræ¥å…¨éƒ¨å®Œæˆäº†ã€‚è¿™ä¹Ÿå¯¹åº”äº†æˆ‘ä»¬ç°åœ¨é¥­åº—çš„æ¨¡å‹ï¼šæœ‰ä¸“é—¨çš„ä¸€ä¸ªäººåœ¨é—¨å£è´Ÿè´£è¯¢é—®é¡¾å®¢æ˜¯å¦è¦è¿›æ¥å°±é¤ï¼Œé¡¾å®¢è¿›å…¥é¤å…åï¼Œæœ‰ä¸“äººè´Ÿè´£å¼•å¯¼åˆ°åº§ä½ï¼Œé¡¾å®¢ç‚¹é¤å®Œåï¼Œå¯¹åº”çš„è´Ÿè´£äººçœ‹åˆ°åé€šçŸ¥åå¨åšèœï¼Œç„¶åæœ‰å¤šäººåˆ†åˆ«ç»™é¡¾å®¢ç«¯èœï¼Œæœ€åèœä¸Šé½äº†ï¼Œè´Ÿè´£äººå‘ŠçŸ¥é¡¾å®¢ä¸Šé½äº†ï¼Œæœ€åå¼•å¯¼é¡¾å®¢ç»“è´¦â€¦ Netty çº¿ç¨‹æ¨¡å‹Nettyçš„çº¿ç¨‹æ¨¡å‹ï¼Œå°±æ˜¯ä¸»ä» Reactor å¤šçº¿ç¨‹æ¨¡å‹ï¼Œå½“ç„¶äº†ï¼ŒNetty å¯ä»¥åœ¨ä»¥ä¸Šä¸‰ç§ Reactor æ¨¡å‹ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚ æ‰©å……ï¼šAIO ä¸­ä½¿ç”¨çš„ Proactor æ¨¡å‹ç”±å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼š Procator Initiatorè´Ÿè´£åˆ›å»ºProcatorå’ŒHandlerï¼Œå¹¶å°†Procatorå’ŒHandleréƒ½é€šè¿‡Asynchronous operation processoræ³¨å†Œåˆ°å†…æ ¸ã€‚ Asynchronous operation processorè´Ÿè´£å¤„ç†æ³¨å†Œè¯·æ±‚ï¼Œå¹¶å®ŒæˆIOæ“ä½œã€‚å®ŒæˆIOæ“ä½œåä¼šé€šçŸ¥procatorã€‚ procatoræ ¹æ®ä¸åŒçš„äº‹ä»¶ç±»å‹å›è°ƒä¸åŒçš„handlerè¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚handlerå®Œæˆä¸šåŠ¡å¤„ç†ï¼Œhandlerä¹Ÿå¯ä»¥æ³¨å†Œæ–°çš„handleråˆ°å†…æ ¸è¿›ç¨‹ã€‚ Reactor å®ç°äº†ä¸€ä¸ªè¢«åŠ¨çš„äº‹ä»¶åˆ†ç¦»å’Œåˆ†å‘æ¨¡å‹ï¼ŒæœåŠ¡ç­‰å¾…è¯·æ±‚äº‹ä»¶çš„åˆ°æ¥ï¼Œå†é€šè¿‡ä¸å—é—´æ–­çš„åŒæ­¥å¤„ç†äº‹ä»¶ï¼Œä»è€Œåšå‡ºååº”ï¼Œé€‚ç”¨äºåŒæ—¶æ¥æ”¶å¤šä¸ªæœåŠ¡è¯·æ±‚ï¼Œå¹¶ä¸”ä¾æ¬¡åŒæ­¥çš„å¤„ç†å®ƒä»¬çš„äº‹ä»¶é©±åŠ¨ç¨‹åºï¼› Proactor å®ç°äº†ä¸€ä¸ªä¸»åŠ¨çš„äº‹ä»¶åˆ†ç¦»å’Œåˆ†å‘æ¨¡å‹ï¼›è¿™ç§è®¾è®¡å…è®¸å¤šä¸ªä»»åŠ¡å¹¶å‘çš„æ‰§è¡Œï¼Œä»è€Œæé«˜ååé‡ï¼›å¹¶å¯æ‰§è¡Œè€—æ—¶é•¿çš„ä»»åŠ¡ï¼ˆå„ä¸ªä»»åŠ¡é—´äº’ä¸å½±å“ï¼‰ï¼Œå¼‚æ­¥æ¥æ”¶å’ŒåŒæ—¶å¤„ç†å¤šä¸ªæœåŠ¡è¯·æ±‚çš„äº‹ä»¶é©±åŠ¨ç¨‹åºã€‚ Proactor å®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºéœ€è¦å†…æ ¸çš„æ·±åº¦å‚ä¸ï¼ŒåŒæ—¶ç¼“å†²åŒºåœ¨è¯»æˆ–å†™æ“ä½œçš„æ—¶é—´æ®µå†…å¿…é¡»ä¿æŒä½ï¼Œå¯èƒ½é€ æˆæŒç»­çš„ä¸ç¡®å®šæ€§ï¼Œå¹¶ä¸”æ¯ä¸ªå¹¶å‘æ“ä½œéƒ½è¦æ±‚æœ‰ç‹¬ç«‹çš„ç¼“å­˜ï¼Œç›¸æ¯”Reactoræ¨¡å‹ï¼Œåœ¨Socketå·²ç»å‡†å¤‡å¥½è¯»æˆ–å†™å‰ï¼Œæ˜¯ä¸è¦æ±‚å¼€è¾Ÿç¼“å­˜çš„ã€‚ç°åœ¨é«˜å¹¶å‘ç½‘ç»œç¼–ç¨‹åŸºæœ¬ä¸Šè¿˜æ˜¯éƒ½é‡‡ç”¨ Reactor æ¨¡å‹ã€‚ ä» Netty çœ‹ HSF/Dubboæœ‰äº† Nettyï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå·±å»å®ç°ä¸€ä¸ª rpc æ¡†æ¶äº†ï¼Œå…¶å®æœ€ä¸ºè‘—åçš„å°±æ˜¯ HSFã€Dubboäº†ï¼ŒäºŒè€…éƒ½æ˜¯é‡‡ç”¨äº† Netty + Hessionã€‚ HSF æ¡†æ¶ä¸­é‡‡ç”¨å¦‚ä»Šæµè¡Œçš„ç½‘ç»œé€šä¿¡æ¡†æ¶ Netty åŠ ä¸Š Hession æ•°æ®åºåˆ—åŒ–åè®®å®ç° HSF æœåŠ¡é—´çš„äº¤äº’ï¼Œä¸»è¦è€ƒè™‘ç‚¹æ˜¯åœ¨å¤§å¹¶å‘é‡æ—¶ï¼ŒæœåŠ¡äº¤äº’æ€§èƒ½è¾¾åˆ°æœ€ä½³ã€‚è¿™ç±» RPC åè®®é‡‡ç”¨å¤šè·¯å¤ç”¨çš„ TCP é•¿è¿æ¥æ–¹å¼ï¼Œåœ¨æœåŠ¡æä¾›è€…å’Œè°ƒç”¨è€…é—´æœ‰å¤šä¸ªæœåŠ¡è¯·æ±‚åŒæ—¶è°ƒç”¨æ—¶ä¼šå…±ç”¨åŒä¸€ä¸ªé•¿è¿æ¥ï¼Œå³ä¸€ä¸ªè¿æ¥äº¤æ›¿ä¼ è¾“ä¸åŒè¯·æ±‚çš„å­—èŠ‚å—ã€‚å®ƒæ—¢é¿å…äº†åå¤å»ºç«‹è¿æ¥å¼€é”€ï¼Œä¹Ÿé¿å…äº†è¿æ¥çš„ç­‰å¾…é—²ç½®ä»è€Œå‡å°‘äº†ç³»ç»Ÿè¿æ¥æ€»æ•°ï¼ŒåŒæ—¶è¿˜é¿å…äº† TCP é¡ºåºä¼ è¾“ä¸­çš„çº¿å¤´é˜»å¡ï¼ˆhead-of-line blockingï¼‰é—®é¢˜ã€‚ Hessian æ˜¯ HSF æ¡†æ¶ä¸­é»˜è®¤ä½¿ç”¨çš„æ•°æ®åºåˆ—åŒ–åè®®ï¼Œåœ¨æ•°æ®é‡è¾ƒå°æ—¶æ€§èƒ½è¡¨ç°å‡ºä¼—ï¼ŒHessian çš„ä¼˜ç‚¹æ˜¯ç²¾ç®€é«˜æ•ˆï¼ŒåŒæ—¶å¯ä»¥è·¨è¯­è¨€ä½¿ç”¨ï¼Œç›®å‰æ”¯æŒ Java, C++, .net, Python, ruby ç­‰è¯­è¨€ã€‚å¦å¤– Hessian å¯ä»¥å……åˆ†åˆ©ç”¨ Web å®¹å™¨çš„æˆç†ŸåŠŸèƒ½ï¼Œåœ¨å¤„ç†å¤§é‡ç”¨æˆ·è®¿é—®æ—¶å¾ˆæœ‰ä¼˜åŠ¿ï¼Œåœ¨èµ„æºåˆ†é…ã€çº¿ç¨‹æ’é˜Ÿã€å¼‚å¸¸å¤„ç†ç­‰æ–¹é¢éƒ½å¯ä»¥ç”± Web å®¹å™¨ä¿è¯ã€‚ HSF æ¡†æ¶åŒæ—¶ä¹Ÿæ”¯æŒåˆ‡æ¢ä½¿ç”¨ Java åºåˆ—åŒ–ï¼ŒHession ç›¸æ¯” JDK æ ‡å‡†çš„åºåˆ—åŒ–æ–¹å¼ï¼ˆå³åŸºäº Serializable æ¥å£çš„æ ‡å‡†åºåˆ—åŒ–ï¼‰ï¼Œåœ¨å…¸å‹åœºæ™¯ä¸­ï¼Œå…¶åºåˆ—åŒ–æ—¶é—´å¼€é”€å¯èƒ½ç¼©çŸ­ 20 å€ã€‚è™½ç„¶ Hessian ä¸æ˜¯æœ€å¿«çš„åºåˆ—åŒ–åè®®ï¼Œä½†å®ƒå¯¹äºå¤æ‚ä¸šåŠ¡å¯¹è±¡çš„åºåˆ—åŒ–æ­£ç¡®ç‡ã€å‡†ç¡®æ€§ç›¸è¾ƒäºæœ€ç¨³å®šçš„ Java åºåˆ—åŒ–å¹¶ä¸é€Šè‰²å¤ªå¤šã€‚ ä¸šç•Œè¿˜æœ‰ä¸€äº›æ¯” Hessian æ›´å¿«çš„åºåˆ—åŒ–åè®®ï¼Œä½†å®ƒä»¬ç›¸å¯¹äº Hessian åœ¨å¤æ‚åœºæ™¯ä¸‹çš„å¤„ç†èƒ½åŠ›è¿˜æ˜¯ä¼šå·®ä¸€äº›ï¼Œæ‰€ä»¥ Hessian æ˜¯åœ¨æ€§èƒ½å’Œç¨³å®šæ€§åŒæ—¶è€ƒè™‘ä¸‹æœ€ä¼˜çš„åºåˆ—åŒ–åè®®ã€‚ é˜¿é‡Œå·´å·´å½“æ—¶åœ¨å¯¹å¤šç§é€šä¿¡åè®®å’Œæ•°æ®åºåˆ—åŒ–ç»„ä»¶ç­‰æµ‹è¯•ä¸­ï¼ŒNetty + Hession çš„ç»„åˆåœ¨äº’è”ç½‘é«˜å¹¶å‘é‡çš„åœºæ™¯ä¸‹,ç‰¹åˆ«æ˜¯åœ¨ TPS ä¸Šè¾¾åˆ° 10w ä»¥ä¸Šæ—¶ï¼Œæ€§èƒ½å’Œæ•ˆç‡è¿œæ¯” REST æˆ–è€… Web Service é«˜ã€‚ ä» Netty çœ‹ kafka/metaQ ä¸»è¦å¼•ç”¨ï¼š kafkaä¹‹æ‰€ä»¥å¿«çš„å…­å¤§åŸå›  è®²åˆ°äº†kafkaå¿«çš„ä¸¤ä¸ªåŸå› ï¼šé¡µç¼“å­˜æŠ€æœ¯+ç£ç›˜é¡ºåºå†™+é›¶æ‹·è´ Kafkaä¸­çš„NIOç½‘ç»œé€šä¿¡æ¨¡å‹ å…ˆæ¥å›ç­”é‚£ä¸ªè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜ï¼Œkafkaä¸ºä½•è¿™ä¹ˆååé‡å¤§è€Œä¸”è¿˜å¿«ï¼Ÿ æˆ‘è®¤ä¸ºä¸»è¦æ˜¯ä»¥ä¸‹å‡ ç‚¹ï¼š ä½¿ç”¨äº† NIO çš„ç½‘ç»œ I/O é€šä¿¡æ¨¡å‹ï¼Œå°±æ˜¯ I/O å¤ç”¨ï¼Œæ‰€ä»¥å‡å»äº†ç­‰å¾…æ•°æ®å‡†å¤‡çš„æ—¶é—´ï¼ŒåŠ å¿«é€Ÿåº¦ï¼› ä½¿ç”¨é¡µç¼“å­˜æŠ€æœ¯ã€ŒPage Cacheã€ã€ç£ç›˜é¡ºåºå†™ä»¥åŠ sendfile çš„é›¶æ‹·è´æŠ€æœ¯åŠ å¿«è½ç›˜é€Ÿåº¦å’Œä¼ é€é€Ÿåº¦ï¼Œå› ä¸º Kafka ä¸­å­˜åœ¨å¤§é‡çš„ç½‘ç»œæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜å’Œç£ç›˜æ–‡ä»¶é€šè¿‡ç½‘ç»œå‘é€çš„è¿‡ç¨‹ï¼› åˆ†åŒºåˆ†æ®µ + ç´¢å¼•ï¼Œæ‰¹é‡è¯»å†™ã€æ‰¹é‡å‹ç¼©ã€‚ kafka ä¸­çš„ NIO ç½‘ç»œé€šä¿¡æ¨¡å‹Kafkaçš„ç½‘ç»œé€šä¿¡æ¨¡å‹æ˜¯åŸºäºNIOçš„ä¸»ä»Reactorå¤šçº¿ç¨‹æ¨¡å‹æ¥è®¾è®¡çš„ã€‚å°±æ˜¯æˆ‘åœ¨ Netty ä¸€èŠ‚ä¸­æåŠåˆ°çš„ï¼Œè¿™é‡Œå†æ¬¡æ¥å›é¡¾ä¸€æ¬¡ï¼Œå…ˆå¼•ç”¨Kafkaæºç ä¸­æ³¨é‡Šçš„ä¸€æ®µè¯ï¼š An NIO socket server. The threading model is 1 Acceptor thread that handles new connections. Acceptor has N Processor threads that each have their own selector and read requests from sockets. M Handler threads that handle requests and produce responses back to the processor threads for writing. ç›¸ä¿¡å¤§å®¶çœ‹äº†ä¸Šé¢çš„è¿™æ®µå¼•æ–‡æ³¨é‡Šåï¼Œå¤§è‡´å¯ä»¥äº†è§£åˆ°Kafkaçš„ç½‘ç»œé€šä¿¡å±‚æ¨¡å‹ï¼Œä¸»è¦é‡‡ç”¨äº†1ï¼ˆ1ä¸ªAcceptorçº¿ç¨‹ï¼‰+Nï¼ˆNä¸ªProcessorçº¿ç¨‹ï¼‰+Mï¼ˆMä¸ªä¸šåŠ¡å¤„ç†çº¿ç¨‹ï¼‰ã€‚ä¸‹é¢çš„è¡¨æ ¼ç®€è¦çš„åˆ—ä¸¾äº†ä¸‹ï¼ˆè¿™é‡Œå…ˆç®€å•çš„çœ‹ä¸‹åé¢è¿˜ä¼šè¯¦ç»†è¯´æ˜ï¼‰ï¼šã€Acceptor å°±æ˜¯ NIO ä¸­çš„ Selectorã€ çº¿ç¨‹æ•° çº¿ç¨‹å çº¿ç¨‹å…·ä½“è¯´æ˜ 1 kafka-socket-acceptor_%x Acceptorçº¿ç¨‹ï¼Œè´Ÿè´£ç›‘å¬Clientç«¯å‘èµ·çš„è¯·æ±‚ N kafka-network-thread_%d Processorçº¿ç¨‹ï¼Œè´Ÿè´£å¯¹Socketè¿›è¡Œè¯»å†™ M kafka-request-handler-_%d Workerçº¿ç¨‹ï¼Œå¤„ç†å…·ä½“çš„ä¸šåŠ¡é€»è¾‘å¹¶ç”ŸæˆResponseè¿”å› Kafkaç½‘ç»œé€šä¿¡å±‚çš„å®Œæ•´æ¡†æ¶å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™é‡Œå¯ä»¥ç®€å•æ€»ç»“ä¸€ä¸‹å…¶ç½‘ç»œé€šä¿¡æ¨¡å‹ä¸­çš„å‡ ä¸ªé‡è¦æ¦‚å¿µï¼š ï¼ˆ1ï¼‰Acceptorï¼š1ä¸ªæ¥æ”¶çº¿ç¨‹ï¼Œè´Ÿè´£ç›‘å¬æ–°çš„è¿æ¥è¯·æ±‚ï¼ŒåŒæ—¶æ³¨å†ŒOP_ACCEPT äº‹ä»¶ï¼Œå°†æ–°çš„è¿æ¥æŒ‰ç…§â€œround robinâ€æ–¹å¼äº¤ç»™å¯¹åº”çš„ Processor çº¿ç¨‹å¤„ç†ï¼› ï¼ˆ2ï¼‰Processorï¼šNä¸ªå¤„ç†å™¨çº¿ç¨‹ï¼Œå…¶ä¸­æ¯ä¸ª Processor éƒ½æœ‰è‡ªå·±çš„ selectorï¼Œå®ƒä¼šå‘ Acceptor åˆ†é…çš„ SocketChannel æ³¨å†Œç›¸åº”çš„ OP_READ äº‹ä»¶ï¼ŒN çš„å¤§å°ç”±â€œnum.networker.threadsâ€å†³å®šï¼› ï¼ˆ3ï¼‰KafkaRequestHandlerï¼šMä¸ªè¯·æ±‚å¤„ç†çº¿ç¨‹ï¼ŒåŒ…å«åœ¨çº¿ç¨‹æ± â€”KafkaRequestHandlerPoolå†…éƒ¨ï¼Œä»RequestChannelçš„å…¨å±€è¯·æ±‚é˜Ÿåˆ—â€”requestQueueä¸­è·å–è¯·æ±‚æ•°æ®å¹¶äº¤ç»™KafkaApiså¤„ç†ï¼ŒMçš„å¤§å°ç”±â€œnum.io.threadsâ€å†³å®šï¼› ï¼ˆ4ï¼‰RequestChannelï¼šå…¶ä¸ºKafkaæœåŠ¡ç«¯çš„è¯·æ±‚é€šé“ï¼Œè¯¥æ•°æ®ç»“æ„ä¸­åŒ…å«äº†ä¸€ä¸ªå…¨å±€çš„è¯·æ±‚é˜Ÿåˆ— requestQueueå’Œå¤šä¸ªä¸Processorå¤„ç†å™¨ç›¸å¯¹åº”çš„å“åº”é˜Ÿåˆ—responseQueueï¼Œæä¾›ç»™Processorä¸è¯·æ±‚å¤„ç†çº¿ç¨‹KafkaRequestHandlerå’ŒKafkaApisäº¤æ¢æ•°æ®çš„åœ°æ–¹ï¼› ï¼ˆ5ï¼‰NetworkClientï¼šå…¶åº•å±‚æ˜¯å¯¹ Java NIO è¿›è¡Œç›¸åº”çš„å°è£…ï¼Œä½äºKafkaçš„ç½‘ç»œæ¥å£å±‚ã€‚Kafkaæ¶ˆæ¯ç”Ÿäº§è€…å¯¹è±¡â€”KafkaProducerçš„sendæ–¹æ³•ä¸»è¦è°ƒç”¨NetworkClientå®Œæˆæ¶ˆæ¯å‘é€ï¼› ï¼ˆ6ï¼‰SocketServerï¼šå…¶æ˜¯ä¸€ä¸ªNIOçš„æœåŠ¡ï¼Œå®ƒåŒæ—¶å¯åŠ¨ä¸€ä¸ªAcceptoræ¥æ”¶çº¿ç¨‹å’Œå¤šä¸ªProcessorå¤„ç†å™¨çº¿ç¨‹ã€‚æä¾›äº†ä¸€ç§å…¸å‹çš„Reactorå¤šçº¿ç¨‹æ¨¡å¼ï¼Œå°†æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚å’Œå¤„ç†è¯·æ±‚ç›¸åˆ†ç¦»ï¼› ï¼ˆ7ï¼‰KafkaServerï¼šä»£è¡¨äº†ä¸€ä¸ªKafka Brokerçš„å®ä¾‹ï¼›å…¶startupæ–¹æ³•ä¸ºå®ä¾‹å¯åŠ¨çš„å…¥å£ï¼› ï¼ˆ8ï¼‰KafkaApisï¼šKafkaçš„ä¸šåŠ¡é€»è¾‘å¤„ç†Apiï¼Œè´Ÿè´£å¤„ç†ä¸åŒç±»å‹çš„è¯·æ±‚ï¼›æ¯”å¦‚â€œå‘é€æ¶ˆæ¯â€ã€â€œè·å–æ¶ˆæ¯åç§»é‡â€”offsetâ€å’Œâ€œå¤„ç†å¿ƒè·³è¯·æ±‚â€ç­‰ï¼› Page Cache(é¡µç¼“å­˜æŠ€æœ¯)ä»€ä¹ˆæ˜¯é¡µç¼“å­˜æ“ä½œç³»ç»Ÿæœ¬èº«æœ‰ä¸€å±‚ç¼“å­˜ï¼Œå«åšpage cacheï¼Œæ˜¯åœ¨å†…å­˜é‡Œçš„ç¼“å­˜ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºos cacheï¼Œæ„æ€å°±æ˜¯æ“ä½œç³»ç»Ÿè‡ªå·±ç®¡ç†çš„ç¼“å­˜ã€‚ å¥½å¤„æ˜¯ä»€ä¹ˆè¿™ç§æ–¹å¼ç›¸å½“äºè¯»å†™å†…å­˜ï¼Œä¸æ˜¯åœ¨è¯»å†™ç£ç›˜ï¼Œä¸ªäººè§‰å¾—æœ‰ç‚¹ç±»ä¼¼äºç›´æ¥å°†ç£ç›˜å’Œå†…æ ¸ç¼“å†²åŒºæ”¾ä¸€å—äº†ã€Œæˆ‘ä»¬å¹³å¸¸çš„ I/O å°±æ˜¯ç”¨ DMA å°† å†…æ ¸ç¼“å†²åŒºå’Œç£ç›˜è¿æ¥ã€ï¼Œæ—¢ç„¶æ˜¯è¯»å†™å†…å­˜ï¼Œå¥½å¤„å°±æ˜¯å¾ˆå¿«å¾ˆå¿«ã€‚ å¦‚ä½•ä½¿ç”¨é¡µç¼“å­˜ä½ åœ¨å†™ç£ç›˜æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥å†™å…¥os cache ä¸­ï¼Œä¹Ÿå°±æ˜¯ä»…ä»…å†™å…¥å†…å­˜ä¸­ï¼Œæ¥ä¸‹æ¥ç”±æ“ä½œç³»ç»Ÿè‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™æŠŠos cache é‡Œçš„æ•°æ®çœŸçš„åˆ·å…¥åˆ°ç£ç›˜ä¸­ã€Œåˆ·ç›˜å…¶å®å°±æ˜¯ç”¨ç›´æ¥åœ¨æœ«å°¾è¿½åŠ ï¼Œä¹Ÿå¿«çš„ä¸€æ‰¹ã€ã€‚ ä¸ºä½•ä¸ä½¿ç”¨ jvm ä¸­çš„å†…å­˜ é¿å…Objectæ¶ˆè€—ï¼šå¦‚æœæ˜¯ä½¿ç”¨ Java å †ï¼ŒJavaå¯¹è±¡çš„å†…å­˜æ¶ˆè€—æ¯”è¾ƒå¤§ï¼Œé€šå¸¸æ˜¯æ‰€å­˜å‚¨æ•°æ®çš„ä¸¤å€ç”šè‡³æ›´å¤šï¼› é¿å…GCé—®é¢˜ï¼šéšç€JVMä¸­æ•°æ®ä¸æ–­å¢å¤šï¼Œåƒåœ¾å›æ”¶å°†ä¼šå˜å¾—å¤æ‚ä¸ç¼“æ…¢ï¼Œä½¿ç”¨ç³»ç»Ÿç¼“å­˜å°±ä¸ä¼šå­˜åœ¨GCé—®é¢˜ï¼› æ“ä½œç³»ç»Ÿå¯¹é¡µç¼“å­˜æœ‰å¾ˆå¤šä¼˜åŒ–ï¼Œæä¾›äº† write-behindã€read-aheadä»¥åŠflushç­‰å¤šç§æœºåˆ¶ã€‚ ç£ç›˜é¡ºåºå†™ç£ç›˜é¡ºåºå†™ï¼Œä»…ä»…å°†æ•°æ®è¿½åŠ åˆ°æ–‡ä»¶çš„æœ«å°¾(append)ï¼Œè€Œä¸æ˜¯åœ¨æ–‡ä»¶çš„éšæœºä½ç½®æ¥ä¿®æ”¹æ•°æ®ã€‚å‡å»äº†å¯»å€çš„æ—¶é—´ï¼Œæ€§èƒ½ç”šè‡³æ¯”å†…å­˜éšæœºè¯»å†™è¦å¿«ï¼Œè¿™æ ·å°±æå¤§çš„åŠ å¿«äº† os cache è½ç›˜çš„é€Ÿåº¦ï¼Œååé‡æ›´å¤§äº†ã€‚ ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªç¼ºé™·â€”â€” æ²¡æœ‰åŠæ³•åˆ é™¤æ•°æ® ï¼Œæ‰€ä»¥Kafkaæ˜¯ä¸ä¼šåˆ é™¤æ•°æ®çš„ï¼Œå®ƒä¼šæŠŠæ‰€æœ‰çš„æ•°æ®éƒ½ä¿ç•™ä¸‹æ¥ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰å¯¹æ¯ä¸ªTopicéƒ½æœ‰ä¸€ä¸ªoffsetç”¨æ¥è¡¨ç¤ºè¯»å–åˆ°äº†ç¬¬å‡ æ¡æ•°æ® ã€‚ å¦‚æœä¸åˆ é™¤ç¡¬ç›˜è‚¯å®šä¼šè¢«æ’‘æ»¡ï¼Œæ‰€ä»¥Kakfaæä¾›äº†ä¸¤ç§ç­–ç•¥æ¥åˆ é™¤æ•°æ®ã€‚ä¸€æ˜¯åŸºäºæ—¶é—´ï¼ŒäºŒæ˜¯åŸºäºpartitionæ–‡ä»¶å¤§å°ã€‚ sendfile çš„é›¶æ‹·è´æŠ€æœ¯å…è®¸æ“ä½œç³»ç»Ÿå°†æ•°æ®ä»Page Cache ç›´æ¥å‘é€åˆ°ç½‘ç»œï¼Œåªéœ€è¦æœ€åä¸€æ­¥çš„copyæ“ä½œå°†æ•°æ®å¤åˆ¶åˆ° NIC ç¼“å†²åŒºï¼Œ è¿™æ ·é¿å…é‡æ–°å¤åˆ¶æ•°æ® ã€‚é€šè¿‡è¿™ç§ â€œé›¶æ‹·è´â€ çš„æœºåˆ¶ï¼ŒPage Cache ç»“åˆ sendfile æ–¹æ³•ï¼ŒKafkaæ¶ˆè´¹ç«¯çš„æ€§èƒ½ä¹Ÿå¤§å¹…æå‡ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ‰æ—¶å€™æ¶ˆè´¹ç«¯åœ¨ä¸æ–­æ¶ˆè´¹æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰çœ‹åˆ°ç£ç›˜ioæ¯”è¾ƒé«˜ï¼Œæ­¤åˆ»æ­£æ˜¯æ“ä½œç³»ç»Ÿç¼“å­˜åœ¨æä¾›æ•°æ®ã€‚ è¿™é‡Œæ‹“å±•ä¸€ä¸‹ï¼š RocketMQ é€‰æ‹©äº† mmap + write è¿™ç§é›¶æ‹·è´æ–¹å¼ï¼Œé€‚ç”¨äºä¸šåŠ¡çº§æ¶ˆæ¯è¿™ç§å°å—æ–‡ä»¶çš„æ•°æ®æŒä¹…åŒ–å’Œä¼ è¾“ï¼›è€Œ Kafka é‡‡ç”¨çš„æ˜¯ sendfile è¿™ç§é›¶æ‹·è´æ–¹å¼ï¼Œé€‚ç”¨äºç³»ç»Ÿæ—¥å¿—æ¶ˆæ¯è¿™ç§é«˜ååé‡çš„å¤§å—æ–‡ä»¶çš„æ•°æ®æŒä¹…åŒ–å’Œä¼ è¾“ã€‚ä½†æ˜¯å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒKafka çš„ç´¢å¼•æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ mmap + write æ–¹å¼ï¼Œæ•°æ®æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ sendfile æ–¹å¼ã€‚ åˆ†åŒºåˆ†æ®µ + ç´¢å¼• kafkaä¸­çš„ message æ˜¯æŒ‰ topic å­˜å‚¨çš„ï¼Œæ¯ä¸ª topic åˆå¯ä»¥æœ‰å¤šä¸ªåˆ†åŒº partitionã€Œæ¯ä¸ªpartition éƒ½æœ‰ä¸€ä¸ª leaderï¼Œè‹¥å¹²ä¸ª followerã€ï¼Œæ¯ä¸ªpartitionå¯¹åº”äº†æ“ä½œç³»ç»Ÿä¸Šçš„ä¸€ä¸ªæ–‡ä»¶å¤¹ã€Œä¹Ÿå°±æ˜¯å•ä¸ªbrokerä¸Šã€ï¼Œç„¶å partition åˆç”±å¤šä¸ª segment ç»„æˆï¼Œåˆ†åŒºåˆ†æ®µï¼Œè¿™æ ·æ‰«æèµ·æ¥æ€§èƒ½æ›´å¿«ï¼Œå› ä¸ºæ“ä½œæ–‡ä»¶åªéœ€è¦æ“ä½œä¸€ä¸ª segment å°±å¯ä»¥äº†ï¼Œç»†ç²’åº¦åŒ–äº†ï¼› ä¸ºäº†æ›´å¿«çš„æ£€ç´¢ segmentï¼Œä½¿ç”¨äº†ç´¢å¼•æ–‡ä»¶ï¼Œè€Œä¸ºäº†ç´¢å¼•æ–‡ä»¶æ›´å¿«çš„è¯»å–ï¼Œåˆé‡‡ç”¨äº†é›¶æ‹·è´æŠ€æœ¯ä¸­çš„ mmap + writeã€‚ã€Œæ˜¯ä¸æ˜¯æŒºç‰›é€¼ï¼ã€ è¿™ç§åˆ†åŒºåˆ†æ®µ+ç´¢å¼•çš„è®¾è®¡ï¼Œä¸ä»…æå‡äº†æ•°æ®è¯»å–çš„æ•ˆç‡ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†æ•°æ®æ“ä½œçš„å¹¶è¡Œåº¦ã€‚ æ‰¹é‡è¯»å†™Kafkaæ•°æ®è¯»å†™ä¹Ÿæ˜¯æ‰¹é‡çš„è€Œä¸æ˜¯å•æ¡çš„ã€‚ é™¤äº†åˆ©ç”¨åº•å±‚çš„æŠ€æœ¯å¤–ï¼ŒKafkaè¿˜åœ¨åº”ç”¨ç¨‹åºå±‚é¢æä¾›äº†ä¸€äº›æ‰‹æ®µæ¥æå‡æ€§èƒ½ã€‚æœ€æ˜æ˜¾çš„å°±æ˜¯ä½¿ç”¨æ‰¹æ¬¡ã€‚åœ¨å‘Kafkaå†™å…¥æ•°æ®æ—¶ï¼Œå¯ä»¥å¯ç”¨æ‰¹æ¬¡å†™å…¥ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨ç½‘ç»œä¸Šé¢‘ç¹ä¼ è¾“å•ä¸ªæ¶ˆæ¯å¸¦æ¥çš„å»¶è¿Ÿå’Œå¸¦å®½å¼€é”€ã€‚å‡è®¾ç½‘ç»œå¸¦å®½ä¸º10MB/Sï¼Œä¸€æ¬¡æ€§ä¼ è¾“10MBçš„æ¶ˆæ¯æ¯”ä¼ è¾“1KBçš„æ¶ˆæ¯10000ä¸‡æ¬¡æ˜¾ç„¶è¦å¿«å¾—å¤šã€‚ æ‰¹é‡å‹ç¼©åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç³»ç»Ÿçš„ç“¶é¢ˆä¸æ˜¯CPUæˆ–ç£ç›˜ï¼Œè€Œæ˜¯ç½‘ç»œIOï¼Œå¯¹äºéœ€è¦åœ¨å¹¿åŸŸç½‘ä¸Šçš„æ•°æ®ä¸­å¿ƒä¹‹é—´å‘é€æ¶ˆæ¯çš„æ•°æ®æµæ°´çº¿å°¤å…¶å¦‚æ­¤ã€‚è¿›è¡Œæ•°æ®å‹ç¼©ä¼šæ¶ˆè€—å°‘é‡çš„CPUèµ„æº,ä¸è¿‡å¯¹äºkafkaè€Œè¨€,ç½‘ç»œIOæ›´åº”è¯¥éœ€è¦è€ƒè™‘ï¼Œæ”¯æŒå¤šç§å‹ç¼©ï¼Œæˆ‘è‡ªå·±æœ‰åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ gzipï¼Œçš„ç¡®æ˜¯æœ‰åŠ é€Ÿï¼Œå¹¶ä¸”æ¶ˆè´¹ç«¯æ— éœ€è‡ªå·±è§£å‹ï¼Œè‡ªåŠ¨è§£å‹ã€‚ æ€»ç»“kafkaå¿«çš„åŸå› ï¼šã€Œä»æµç¨‹ä¸Šè¯´ã€ Producer å‘é€æ¶ˆæ¯æ—¶è¿›è¡Œæ‰¹é‡çš„å‘é€å¹¶ä¸”æ‰¹é‡å‹ç¼©ï¼Œå‡è½» ç½‘ç»œ I/O å‹åŠ›ï¼Œç„¶åæ˜¯ä½¿ç”¨äº† NIO ä¸­çš„ ç½‘ç»œI/O æ¨¡å‹ï¼Œé‡‡ç”¨ I/O å¤ç”¨æœºåˆ¶ï¼Œç”¨ Selector å»è½®è¯¢æ˜¯å¦å‡†å¤‡å¥½äº†å‘é€çš„æ•°æ®ï¼Œé¿å…çš„å…¶ä»–çº¿ç¨‹çš„æ— æ•ˆç­‰å¾…ï¼Œç­‰åˆ°æ•°æ®ä¼ é€åˆ°æœåŠ¡å™¨æ—¶ï¼Œä¼šé¦–å…ˆç”¨ç´¢å¼•å»æ‰¾åˆ°å¯¹åº”çš„segmentï¼Œç´¢å¼•æ–‡ä»¶é‡‡ç”¨äº† mmap + write å‡å°‘ cpu æ‹·è´æ¬¡æ•°åŠ å¿«è®¿é—®é€Ÿåº¦ï¼Œæ‰¾åˆ°å¯¹åº”çš„ segment ä¹‹åï¼Œä¼šå°†æ•°æ®å‘é€åˆ° Page Cacheï¼ŒPage Cache ä¼šåœ¨åˆé€‚çš„æ—¶å€™è¿›è¡Œåˆ·ç›˜ï¼Œåˆ·ç›˜æ˜¯é¡ºåºè¯»å†™ç£ç›˜ï¼Œæ‰€ä»¥åˆ·ç›˜ä¹Ÿå¾ˆå¿«ï¼Œç„¶åæ¶ˆè´¹è€…è¦æ¶ˆè´¹æ—¶ï¼Œåˆ©ç”¨ sendfile çš„é›¶æ‹·è´æŠ€æœ¯ç›´æ¥ä» Page Cache å‘é€åˆ° SocketChannelï¼Œæ— éœ€è¿›è¡Œå¤šä½™çš„æ‹·è´å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç›´æ¥åœ¨å†…æ ¸æ€ä¸­å®Œæˆï¼Œè‡ªæ­¤ï¼Œæ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>é›¶æ‹·è´</tag>
        <tag>NIO</tag>
        <tag>Netty</tag>
        <tag>HSF</tag>
        <tag>Kafka</tag>
        <tag>metaQ</tag>
        <tag>Dubbo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysql å¤ä¹ ]]></title>
    <url>%2F2020%2F03%2F13%2FMysql%20%E5%86%8D%E5%BA%A6%E5%87%BA%E5%8F%91.html</url>
    <content type="text"><![CDATA[ç›®å½•ï¼š/MySQLå®æˆ˜45è®² [161.8M] â”£â”â”01è®²åŸºç¡€æ¶æ„ï¼šä¸€æ¡SQLæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„.html [54.2K] â”£â”â”02è®²æ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡SQLæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„.html [65K] â”£â”â”03è®²äº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§.html [56.8K] â”£â”â”04è®²æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰.html [59.9K] â”£â”â”05è®²æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰.html [63.2K] â”£â”â”06è®²å…¨å±€é”å’Œè¡¨é”ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢.html [63.9K] â”£â”â”07è®²è¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“.html [60.9K] â”£â”â”08è®²äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„.html [69K] â”£â”â”09è®²æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œåº”è¯¥æ€ä¹ˆé€‰æ‹©.html [70K] â”£â”â”10è®²MySQLä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•.html [67.1K] â”£â”â”11è®²æ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•.html [54.6K] â”£â”â”12è®²ä¸ºä»€ä¹ˆæˆ‘çš„MySQLä¼šâ€œæŠ–â€ä¸€ä¸‹.html [62K] â”£â”â”13è®²ä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜.html [60.2K] â”£â”â”14è®²countè¿™ä¹ˆæ…¢ï¼Œæˆ‘è¯¥æ€ä¹ˆåŠ.html [64.2K] â”£â”â”15è®²ç­”ç–‘æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šæ—¥å¿—å’Œç´¢å¼•ç›¸å…³é—®é¢˜.html [73.4K] â”£â”â”16è®²â€œorderbyâ€æ˜¯æ€ä¹ˆå·¥ä½œçš„.html [74.3K] â”£â”â”17è®²å¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯.html [63.5K] â”£â”â”18è®²ä¸ºä»€ä¹ˆè¿™äº›SQLè¯­å¥é€»è¾‘ç›¸åŒï¼Œæ€§èƒ½å´å·®å¼‚å·¨å¤§.html [62.1K] â”£â”â”19è®²ä¸ºä»€ä¹ˆæˆ‘åªæŸ¥ä¸€è¡Œçš„è¯­å¥ï¼Œä¹Ÿæ‰§è¡Œè¿™ä¹ˆæ…¢.html [59.6K] â”£â”â”20è®²å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜.html [67.2K] â”£â”â”21è®²ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤š.html [68.7K] â”£â”â”22è®²MySQLæœ‰å“ªäº›â€œé¥®é¸©æ­¢æ¸´â€æé«˜æ€§èƒ½çš„æ–¹æ³•.html [75.2K] â”£â”â”23è®²MySQLæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„.html [65.4K] â”£â”â”24è®²MySQLæ˜¯æ€ä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„.html [66.4K] â”£â”â”25è®²MySQLæ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„.html [68.4K] â”£â”â”26è®²å¤‡åº“ä¸ºä»€ä¹ˆä¼šå»¶è¿Ÿå¥½å‡ ä¸ªå°æ—¶.html [67.5K] â”£â”â”27è®²ä¸»åº“å‡ºé—®é¢˜äº†ï¼Œä»åº“æ€ä¹ˆåŠ.html [63.3K] â”£â”â”28è®²è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘.html [67.1K] â”£â”â”29è®²å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†.html [49.4K] â”£â”â”30è®²ç­”ç–‘æ–‡ç« ï¼ˆäºŒï¼‰ï¼šç”¨åŠ¨æ€çš„è§‚ç‚¹çœ‹åŠ é”.html [38.9K] â”£â”â”31è®²è¯¯åˆ æ•°æ®åé™¤äº†è·‘è·¯ï¼Œè¿˜èƒ½æ€ä¹ˆåŠ.html [65.1K] â”£â”â”32è®²ä¸ºä»€ä¹ˆè¿˜æœ‰killä¸æ‰çš„è¯­å¥.html [59.4K] â”£â”â”33è®²æˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®ï¼Œä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†.html [61.1K] â”£â”â”34è®²åˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨join.html [37.2K] â”£â”â”35è®²joinè¯­å¥æ€ä¹ˆä¼˜åŒ–.html [67.4K] â”£â”â”36è®²ä¸ºä»€ä¹ˆä¸´æ—¶è¡¨å¯ä»¥é‡å.html [55.3K] â”£â”â”37è®²ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨.html [57.2K] â”£â”â”38è®²éƒ½è¯´InnoDBå¥½ï¼Œé‚£è¿˜è¦ä¸è¦ä½¿ç”¨Memoryå¼•æ“.html [52.1K] â”£â”â”39è®²è‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„.html [50.6K] â”£â”â”40è®²insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤š.html [53.8K] â”£â”â”41è®²æ€ä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨.html [34K] â”£â”â”42è®²grantä¹‹åè¦è·Ÿç€flushprivilegeså—.html [51.4K] â”£â”â”43è®²è¦ä¸è¦ä½¿ç”¨åˆ†åŒºè¡¨.html [51.2K] â”£â”â”44è®²ç­”ç–‘æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šè¯´ä¸€è¯´è¿™äº›å¥½é—®é¢˜.html [53.1K] â”£â”â”å¼€ç¯‡è¯è®²è¿™ä¸€æ¬¡ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥ææ‡‚MySQL.html [40.6K] â”—â”â”ç›´æ’­å›é¡¾è®²æ—æ™“æ–Œï¼šæˆ‘çš„MySQLå¿ƒè·¯å†ç¨‹.html [51.7K] 1. ä¸€æ¡è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ä»¥æŸ¥è¯¢è¯­å¥ä¸ºä¾‹ï¼Œä¸€æ¡æŸ¥è¯¢è¯­å¥è¦ç»è¿‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š è¿æ¥å™¨ã€‚é¦–å…ˆä¼šåœ¨ Server ç«¯éªŒè¯è¿æ¥çš„æ­£ç¡®æ€§ï¼Œåˆ¤æ–­ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®ï¼Œè¿›è¡Œè¿æ¥ç®¡ç†ï¼› æŸ¥è¯¢ç¼“å­˜ã€‚è¿™ä¸ªåœ¨ Mysql 8.0 ä¹‹åå°±æ²¡æœ‰äº†ï¼Œå› ä¸ºç¼“å­˜å‘½ä¸­ç‡ä¸€å‘å¾ˆä½ï¼Œåªè¦ä¿®æ”¹äº†è¡¨å°±ä¼šå¯¼è‡´ç¼“å­˜çš„å¤±æ•ˆï¼› åˆ†æå™¨ã€‚ä¸»è¦è¿›è¡Œè¯æ³•è¯­æ³•çš„åˆ†æï¼Œåˆ¤æ–­è¯­å¥æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œè¯­å¥ä¸­çš„è¡¨ä»¥åŠå­—æ®µåœ¨è¡¨ä¸­æ˜¯å¦æ­£ç¡®ï¼› ä¼˜åŒ–å™¨ã€‚å¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œä¼˜åŒ–ï¼Œä¸»è¦æ˜¯ç´¢å¼•çš„é€‰æ‹©ï¼› æ‰§è¡Œå™¨ã€‚è¿™ä¸€æ­¥æ‰çœŸæ­£å¼€å§‹æ‰“å¼€è¡¨æ¥æ“ä½œï¼Œéœ€è¦é¦–å…ˆéªŒè¯æ˜¯å¦å¯ä»¥æœ‰æ“ä½œè¡¨çš„æƒé™ï¼Œç„¶åè°ƒç”¨InnoDB ç­‰å­˜å‚¨å¼•æ“çš„è¯»å†™æ¥å£æ¥å®Œæˆè¯­å¥çš„æ“ä½œï¼Œæœ€åè¿”å›ç»“æœï¼› å­˜å‚¨å¼•æ“ã€‚ä¸»è¦è´Ÿè´£å­˜å‚¨æ•°æ®ä»¥åŠæä¾›æ•°æ®è¯»å†™çš„æ¥å£ã€‚ 2. è®²æ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡ SQL æ›´æ–°è¯­å¥çš„æ‰§è¡Œã€ŒMySQLé‡Œç»å¸¸è¯´åˆ°çš„WALæŠ€æœ¯ï¼ŒWALçš„å…¨ç§°æ˜¯Write-Ahead Loggingï¼Œå®ƒçš„å…³é”®ç‚¹å°±æ˜¯å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜ã€ InnoDBä¸­ç‰¹æœ‰çš„æ—¥å¿— redo-logï¼š åœ¨ InnoDB ä¸­å¯ä»¥ä¿è¯å³ä½¿æ•°æ®åº“å‘ç”Ÿäº†é‡å¯ï¼Œä¹‹å‰æäº¤çš„è®°å½•å¹¶ä¸ä¼šä¸¢å¤±ï¼Œè¿™ä¸ªèƒ½åŠ›ç§°ä¸º â€œcrash-safeâ€ã€Œæä¾›å´©æºƒæ¢å¤åŠŸèƒ½ã€ï¼› æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œè¿™ä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆæ”¹å˜â€ï¼Œä¸å­˜å‚¨å¼•æ“çš„ä½œç”¨ç›¸ç¬¦ï¼Œä¸»è¦æ˜¯å¤„ç†å­˜å‚¨æ–¹é¢çš„åŠŸèƒ½ï¼› æ˜¯å¾ªç¯å†™çš„ï¼Œç©ºé—´å›ºå®šä¼šç”¨å®Œçš„ã€‚ç”¨å®Œäº†å°±æŠŠä¹‹å‰çš„æ“¦é™¤ï¼Œç„¶åç»§ç»­å†™ï¼Œç”¨ä¸¤ä¸ªæŒ‡é’ˆæ¥æ§åˆ¶ã€‚ Server å±‚ç‹¬æœ‰çš„æ—¥å¿— binlogï¼š æ˜¯ Server å±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ï¼› ä½œç”¨æ˜¯ç”¨äºå½’æ¡£ï¼Œè®°å½•çš„æ˜¯â€œåšäº†ä»€ä¹ˆé€»è¾‘æ“ä½œâ€ï¼Œé‡ç‚¹åœ¨æ‰§è¡Œé€»è¾‘ä¸Šï¼Œä¸åœ¨å­˜å‚¨ï¼Œå› ä¸º Server å°±æ˜¯è´Ÿè´£ Mysql åŠŸèƒ½æ–¹é¢ï¼› æ˜¯å¯ä»¥è¿½åŠ å†™çš„ï¼Œå†™å®Œä¸€é¡µæ¢ä¸€é¡µï¼Œä¸ä¼šæ“¦é™¤ä»¥å‰çš„ã€‚ mysql&gt; update T set c=c+1 where ID=2; ä¸Šè¿°çš„ update è¯­å¥æ‰§è¡Œé¡ºåºå¤§ä½“å’Œ 1 ä¸­ä¸€æ ·ï¼Œå…·ä½“çš„æ‰§è¡Œå™¨çš„æµç¨‹å¦‚ä¸‹ï¼š æ‰§è¡Œå™¨å…ˆæ‰¾å¼•æ“ï¼Œè·å– ID = 2 è¿™ä¸€è¡Œï¼ŒID æ˜¯ä¸»é”®ï¼Œå¼•æ“ä¼šç›´æ¥ç”¨ç´¢å¼•æ ‘å®šä½åˆ°è¿™ä¸€è¡Œçš„æ•°æ®ï¼Œå¦‚æœè¿™ä¸€è¡Œçš„æ•°æ®åœ¨å†…å­˜ä¸­ï¼Œé‚£ç›´æ¥è¿”å›å°±å¥½äº†ï¼Œå¦‚æœä¸åœ¨ï¼Œåˆ™éœ€è¦å»ç£ç›˜ä¸­è¯»å–å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åè¿”å›ç»™æ‰§è¡Œå™¨ï¼› æ‰§è¡Œå™¨æ‹¿åˆ°äº†è¿™ä¸€è¡Œçš„æ•°æ®ï¼Œå°† c è‡ªåŠ ä¸€ï¼Œç„¶åè°ƒç”¨å¼•æ“å»å†™å…¥æ•°æ®ï¼› å¼•æ“ä¼šå…ˆå°†è¿™ä¸ªæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶ä¸”å»å†™ redo-logï¼Œæ­¤æ—¶æ³¨æ„ï¼Œredo-log å¹¶æœªæäº¤ï¼Œè€Œæ˜¯å¤„äº prepare çŠ¶æ€ï¼Œç„¶åå‘ŠçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤äº‹åŠ¡ï¼› æ‰§è¡Œå™¨æ”¶åˆ°äº†å­˜å‚¨å¼•æ“çš„æ¶ˆæ¯åï¼Œå°±å¼€å§‹å†™å…¥ bin-logï¼Œå¹¶æŠŠ bin-logå†™å…¥ç£ç›˜ï¼› æ‰§è¡Œå™¨å†™å…¥å®Œæ¯•åï¼Œè°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå¼•æ“æŠŠåˆšåˆšå†™å…¥çš„ redo-log æ”¹æˆ commit çŠ¶æ€ï¼Œæäº¤äº‹åŠ¡ã€‚ ä¸Šè¿°å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ redo-log æ˜¯ ä¸¤é˜¶æ®µæäº¤ï¼Œä¹Ÿå°±æ˜¯ å…ˆ prepare å† commitã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆåšçš„åŸå› æ˜¯ä¸ºäº†è®©ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸€è‡´ã€‚ è¦æ³¨æ„ï¼Œç°é˜¶æ®µçš„æ•°æ®æ¢å¤è¿˜æ˜¯é ç€ binlog + æ•´åº“å¤‡ä»½å»å®Œæˆçš„ï¼ŒæŒ‰ç†è¯´ redo-log ä¹Ÿèƒ½å®Œæˆè€Œä¸”é€Ÿåº¦è‚¯å®šè¦æ¯” bin-log å¿«å¾—å¤šï¼Œä½†æ˜¯ç”±äº redo-log æ˜¯ä¼šæ“¦é™¤çš„ï¼Œä¸å…·å¤‡bin-log çš„å½’æ¡£åŠŸèƒ½ï¼Œæ‰€ä»¥ç°é˜¶æ®µè¿˜æ˜¯æ²¡åŠæ³•ã€‚ æ€è€ƒé¢˜ï¼šå®šæœŸå…¨é‡å¤‡ä»½çš„å‘¨æœŸâ€œå–å†³äºç³»ç»Ÿé‡è¦æ€§ï¼Œæœ‰çš„æ˜¯ä¸€å¤©ä¸€å¤‡ï¼Œæœ‰çš„æ˜¯ä¸€å‘¨ä¸€å¤‡â€ã€‚é‚£ä¹ˆåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ï¼Œä¸€å¤©ä¸€å¤‡ä¼šæ¯”ä¸€å‘¨ä¸€å¤‡æ›´æœ‰ä¼˜åŠ¿å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œå®ƒå½±å“äº†è¿™ä¸ªæ•°æ®åº“ç³»ç»Ÿçš„å“ªä¸ªæŒ‡æ ‡ï¼Ÿ ä¸€å¤©ä¸€å¤‡ï¼šå¥½å¤„æ˜¯â€œæœ€é•¿æ¢å¤æ—¶é—´â€æ›´çŸ­ã€‚åœ¨ä¸€å¤©ä¸€å¤‡çš„æ¨¡å¼é‡Œï¼Œæœ€åæƒ…å†µä¸‹éœ€è¦åº”ç”¨ä¸€å¤©çš„binlogã€‚æ¯”å¦‚ï¼Œä½ æ¯å¤©0ç‚¹åšä¸€æ¬¡å…¨é‡å¤‡ä»½ï¼Œè€Œè¦æ¢å¤å‡ºä¸€ä¸ªåˆ°æ˜¨å¤©æ™šä¸Š23ç‚¹çš„å¤‡ä»½ã€‚ä½†æ˜¯åå¤„ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå°±æ˜¯ä½ éœ€è¦å¤§é‡çš„å­˜å‚¨ã€‚ ä¸€å‘¨ä¸€å¤‡æœ€åæƒ…å†µå°±è¦åº”ç”¨ä¸€å‘¨çš„binlogäº†ã€‚è¿™ä¸ªæ¢å¤æ—¶é—´é•¿ï¼Œä½†æ˜¯æ˜æ˜¾å­˜å‚¨çš„æ¶ˆè€—å°±å°å¾—å¤šäº†ã€‚ 3. äº‹åŠ¡éš”ç¦»äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼š åŸå­æ€§ã€‚è¦ä¹ˆä¸åšï¼Œè¦ä¹ˆå…¨åšï¼› ä¸€è‡´æ€§ã€‚åœ¨å¤„ç†äº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œä¿è¯æ•°æ®åº“çŠ¶æ€å’Œå…¶ä»–ä¸šåŠ¡è§„åˆ™ä¿æŒä¸€è‡´ï¼Œæ¯”å¦‚è½¬è´¦ï¼Œå‰åä¸¤è€…çš„è´¦æ¹–æ€»é¢ä¸å˜ï¼› éš”ç¦»æ€§ã€‚ä¸åŒäº‹åŠ¡ä¹‹é—´äº’ä¸å½±å“ï¼› æŒä¹…æ€§ã€‚äº‹åŠ¡æäº¤ä¹‹åéœ€è¦æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­å»ï¼Œå³ä½¿å´©æºƒï¼Œä¹Ÿèƒ½æ¢å¤ã€‚ äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼š è¯»æœªæäº¤ã€‚åˆ«äººè¿˜æ²¡æäº¤çš„ä¸œè¥¿ï¼Œå°±èƒ½è¯»å–åˆ°ï¼Œä¼šäº§ç”Ÿå¹»è¯»ã€ä¸å¯é‡å¤è¯»ã€è„è¯»çš„é—®é¢˜ï¼›ã€Œä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°ã€‚ã€ è¯»æäº¤ã€‚åˆ«äººæäº¤çš„ä¸œè¥¿ï¼Œå°±èƒ½è¯»å–åˆ°ã€‚ä¼šäº§ç”Ÿå¹»è¯»ã€ä¸å¯é‡å¤è¯»ï¼›ã€Œä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰ä¼šè¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ã€‚ã€ å¯é‡å¤è¯»ã€‚åœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œåˆ«äººå°±ç®—æäº¤äº†ä¸œè¥¿å¹¶æ”¹åŠ¨äº†ï¼Œå½“å‰äº‹åŠ¡çœ‹ä¸åˆ°ï¼Œä¸ä¼šå»è¯»æœ€æ–°çš„ï¼Œè¿˜æ˜¯å¯èƒ½ä¼šäº§ç”Ÿå¹»è¯»çš„æƒ…å†µï¼›ã€Œä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚å½“ç„¶åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæœªæäº¤å˜æ›´å¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„ã€‚ã€ åºåˆ—åŒ–ã€‚åŠ é”ï¼Œç‰›é€¼ã€‚ã€Œé¡¾åæ€ä¹‰æ˜¯å¯¹äºåŒä¸€è¡Œè®°å½•ï¼Œâ€œå†™â€ä¼šåŠ â€œå†™é”â€ï¼Œâ€œè¯»â€ä¼šåŠ â€œè¯»é”â€ã€‚å½“å‡ºç°è¯»å†™é”å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ã€ å…¶ä¸­ï¼Œæœ€éš¾ç†è§£çš„å°±æ˜¯å¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼Œè¿™ä¹Ÿæ˜¯mysqlçš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼š å°±æ˜¯ä½¿ç”¨çš„å›æ»šæŠ€æœ¯ï¼Œåœ¨MySQLä¸­ï¼Œå®é™…ä¸Šæ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™éƒ½ä¼šåŒæ—¶è®°å½•ä¸€æ¡å›æ»šæ“ä½œã€‚è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œé€šè¿‡å›æ»šæ“ä½œï¼Œéƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼ã€‚ã€Œç”±undo logå®Œæˆçš„ã€ å¦‚å›¾æ‰€ç¤ºï¼Œè¿™ä¹Ÿæ˜¯ æ•°æ®åº“çš„å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶çš„åŸºç¡€ï¼Œé‡‡ç”¨å›æ»šæœºåˆ¶ã€‚å½“ç„¶äº†ï¼Œå›æ»šæ—¥å¿—ä¸èƒ½ä¸€ç›´ä¿ç•™ï¼Œæ‰€ä»¥åœ¨å¿…è¦çš„æ—¶å€™åˆ é™¤ï¼Œåˆ é™¤çš„æ—¶é—´ç‚¹å°±æ˜¯å½“æ²¡æœ‰äº‹åŠ¡å†éœ€è¦ç”¨åˆ°è¿™äº›å›æ»šæ—¥å¿—æ—¶ï¼Œå›æ»šæ—¥å¿—ä¼šè¢«åˆ é™¤ã€‚æ‰€ä»¥æˆ‘ä»¬æœ€å¥½ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡ï¼Œè¿™æ ·ä¼šå¯¼è‡´å›æ»šçš„æ•°æ®å¾ˆå¤šå¾ˆå¤šã€‚é™¤äº†å¯¹å›æ»šæ®µçš„å½±å“ï¼Œé•¿äº‹åŠ¡è¿˜å ç”¨é”èµ„æºï¼Œä¹Ÿå¯èƒ½æ‹–å®æ•´ä¸ªåº“ã€‚ å¦‚ä½•é¿å…é•¿äº‹åŠ¡å¯¹ä¸šåŠ¡çš„å½±å“ï¼Ÿ è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä»åº”ç”¨å¼€å‘ç«¯å’Œæ•°æ®åº“ç«¯æ¥çœ‹ã€‚ é¦–å…ˆï¼Œä»åº”ç”¨å¼€å‘ç«¯æ¥çœ‹ï¼š ç¡®è®¤æ˜¯å¦ä½¿ç”¨äº†set autocommit=0ã€‚è¿™ä¸ªç¡®è®¤å·¥ä½œå¯ä»¥åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¼€å±•ï¼ŒæŠŠMySQLçš„general_logå¼€èµ·æ¥ï¼Œç„¶åéšä¾¿è·‘ä¸€ä¸ªä¸šåŠ¡é€»è¾‘ï¼Œé€šè¿‡general_logçš„æ—¥å¿—æ¥ç¡®è®¤ã€‚ä¸€èˆ¬æ¡†æ¶å¦‚æœä¼šè®¾ç½®è¿™ä¸ªå€¼ï¼Œä¹Ÿå°±ä¼šæä¾›å‚æ•°æ¥æ§åˆ¶è¡Œä¸ºï¼Œä½ çš„ç›®æ ‡å°±æ˜¯æŠŠå®ƒæ”¹æˆ1ã€‚ ç¡®è®¤æ˜¯å¦æœ‰ä¸å¿…è¦çš„åªè¯»äº‹åŠ¡ã€‚æœ‰äº›æ¡†æ¶ä¼šä¹ æƒ¯ä¸ç®¡ä»€ä¹ˆè¯­å¥å…ˆç”¨begin/commitæ¡†èµ·æ¥ã€‚æˆ‘è§è¿‡æœ‰äº›æ˜¯ä¸šåŠ¡å¹¶æ²¡æœ‰è¿™ä¸ªéœ€è¦ï¼Œä½†æ˜¯ä¹ŸæŠŠå¥½å‡ ä¸ªselectè¯­å¥æ”¾åˆ°äº†äº‹åŠ¡ä¸­ã€‚è¿™ç§åªè¯»äº‹åŠ¡å¯ä»¥å»æ‰ã€‚ ä¸šåŠ¡è¿æ¥æ•°æ®åº“çš„æ—¶å€™ï¼Œæ ¹æ®ä¸šåŠ¡æœ¬èº«çš„é¢„ä¼°ï¼Œé€šè¿‡SET MAX_EXECUTION_TIMEå‘½ä»¤ï¼Œæ¥æ§åˆ¶æ¯ä¸ªè¯­å¥æ‰§è¡Œçš„æœ€é•¿æ—¶é—´ï¼Œé¿å…å•ä¸ªè¯­å¥æ„å¤–æ‰§è¡Œå¤ªé•¿æ—¶é—´ã€‚ï¼ˆä¸ºä»€ä¹ˆä¼šæ„å¤–ï¼Ÿåœ¨åç»­çš„æ–‡ç« ä¸­ä¼šæåˆ°è¿™ç±»æ¡ˆä¾‹ï¼‰ å…¶æ¬¡ï¼Œä»æ•°æ®åº“ç«¯æ¥çœ‹ï¼š ç›‘æ§ information_schema.Innodb_trxè¡¨ï¼Œè®¾ç½®é•¿äº‹åŠ¡é˜ˆå€¼ï¼Œè¶…è¿‡å°±æŠ¥è­¦/æˆ–è€…killï¼› Perconaçš„pt-killè¿™ä¸ªå·¥å…·ä¸é”™ï¼Œæ¨èä½¿ç”¨ï¼› åœ¨ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•é˜¶æ®µè¦æ±‚è¾“å‡ºæ‰€æœ‰çš„general_logï¼Œåˆ†ææ—¥å¿—è¡Œä¸ºæå‰å‘ç°é—®é¢˜ï¼› å¦‚æœä½¿ç”¨çš„æ˜¯MySQL 5.6æˆ–è€…æ›´æ–°ç‰ˆæœ¬ï¼ŒæŠŠinnodb_undo_tablespacesè®¾ç½®æˆ2ï¼ˆæˆ–æ›´å¤§çš„å€¼ï¼‰ã€‚å¦‚æœçœŸçš„å‡ºç°å¤§äº‹åŠ¡å¯¼è‡´å›æ»šæ®µè¿‡å¤§ï¼Œè¿™æ ·è®¾ç½®åæ¸…ç†èµ·æ¥æ›´æ–¹ä¾¿ã€‚ 4. æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰ä¸ºä½•ä¸ä½¿ç”¨ å“ˆå¸Œè¡¨ã€æ•°ç»„ã€B æ ‘ã€äºŒå‰æœç´¢æ ‘ï¼Œè€Œé‡‡ç”¨äº† B+ï¼Ÿ ä¸ºä½•ä¸ç”¨å“ˆå¸Œè¡¨ï¼Ÿ å“ˆå¸Œè¡¨è¿›è¡Œç­‰å€¼æŸ¥è¯¢çš„ç¡®å¾ˆå¿«ï¼ŒO(1) çš„æ—¶é—´å¤æ‚åº¦ï¼Œä½†æ˜¯å…¶è¿›è¡ŒèŒƒå›´æŸ¥è¯¢å°±å¿…é¡»éå†å…¨è¡¨ï¼Œå¹¶ä¸”å¦‚æœç›¸åŒçš„å€¼å¤ªå¤šï¼Œå°±å®¹æ˜“å¯¼è‡´å“ˆå¸Œå†²çªï¼Œæ€§èƒ½è¿›ä¸€æ­¥ä¸‹é™ã€‚ ä¸ºä½•ä¸ç”¨æ•°ç»„ï¼Ÿ æ•°ç»„çš„ç¡®å¯ä»¥å¾ˆå¿«çš„è¿›è¡Œç­‰å€¼æŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢ï¼Œä½†æ˜¯å…¶æ›´æ–°å¾ˆéº»çƒ¦ï¼Œå¦‚æœä¸­é—´éœ€è¦åˆ é™¤ï¼Œé‚£å°±è¦ç§»åŠ¨åé¢æ‰€æœ‰æ•°æ®ï¼Œæ‰€ä»¥åªé€‚ç”¨äºé™æ€å­˜å‚¨å¼•æ“ã€‚ ä¸ºä½•ä¸ç”¨ B æ ‘ï¼Ÿ B æ ‘æœ€å¤§çš„é—®é¢˜å°±æ˜¯éå¶å­èŠ‚ç‚¹æœ‰ä¸€ä¸ª Data åŸŸï¼Œæˆ‘ä»¬çŸ¥é“æ•°æ®åº“çš„æ€§èƒ½ä¸»è¦å–å†³äºç£ç›˜ I/O çš„æ¬¡æ•°ï¼Œmysql é‡‡ç”¨äº†ç£ç›˜é¢„è¯»çš„æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªæ ‘çš„èŠ‚ç‚¹éƒ½ç”³è¯·ä¸€é¡µçš„å­˜å‚¨ç©ºé—´ï¼Œè¿™æ ·æ–¹ä¾¿è¯»å†™ï¼Œå°±æ˜¯å› ä¸º B æ ‘å­˜å‚¨äº† Data åŸŸï¼Œç›¸æ¯”ä¹‹ä¸‹è‚¯å®šå°±åªèƒ½å­˜æ›´å°‘çš„æŒ‡é’ˆåŸŸäº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æ•´ä¸ªæ ‘çš„é«˜åº¦æ‹‰é«˜ï¼Œç£ç›˜ I/O æ¬¡æ•°å¢åŠ ï¼ŒäºŒå‰æœç´¢æ ‘åŒæ ·å¦‚æ­¤ï¼Œæ ‘é«˜è¿‡é«˜å¯¼è‡´ç£ç›˜ I/O æ¬¡æ•°å¢åŠ ã€‚ ä¸ºä½•ç”¨ B+ æ ‘ï¼Ÿ æˆ‘è§‰å¾—ç¬¬ä¸€ç‚¹å°±æ˜¯å› ä¸ºå…¶æ ‘ä½ï¼Œæ¯ä¸ªéå¶å­èŠ‚ç‚¹åªå­˜å‚¨äº†æŒ‡é’ˆåŸŸå’Œä¸»é”®ï¼ˆè¿™é‡Œè¯´çš„æ˜¯èšé›†ç´¢å¼•ï¼‰ï¼› å¶å­èŠ‚ç‚¹æœ‰é“¾è¡¨ï¼Œæ–¹ä¾¿èŒƒå›´æŸ¥è¯¢ï¼› æŸ¥è¯¢æ•ˆç‡å¾ˆç¨³å®šã€‚ ä¸ºä½•æœ€å¥½ä½¿ç”¨è‡ªå¢ä¸»é”®ï¼Ÿ å› ä¸ºè¿™æ ·å°±å¯ä»¥å‡å°‘ç»´æŠ¤ç´¢å¼•æœ‰åºæ€§å¸¦æ¥çš„å¼€é”€ï¼Œå¦‚æœä¸é‡‡ç”¨è‡ªå¢ä¸»é”®ï¼Œé‚£ä¹ˆåœ¨æ’å…¥çš„æ—¶å€™å¯èƒ½ä¼šåœ¨ä¸­é—´ï¼Œé€ æˆä¸€ä¸ªé¡µåˆ†è£‚çš„è¿‡ç¨‹ï¼Œå¼€é”€å¾ˆå¤§ï¼Œä¼šå¯¼è‡´å­˜å‚¨çš„ç¢ç‰‡åŒ–ã€‚ 5. æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰ ä»€ä¹ˆå«å›è¡¨ï¼Ÿ æ™®é€šç´¢å¼•åœ¨æ‰¾åˆ°ä¸»é”®åï¼Œå›åˆ°ä¸»é”®ç´¢å¼•æ ‘æœç´¢çš„è¿‡ç¨‹ï¼Œç§°ä¸ºå›è¡¨ã€‚ å¦‚ä½•å‡å°‘å›è¡¨çš„æ¬¡æ•°å‘¢ï¼Ÿ è¦†ç›–ç´¢å¼•ã€‚è¦†ç›–ç´¢å¼•å¯ä»¥å‡å°‘æ ‘çš„æœç´¢æ¬¡æ•°ï¼Œæ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œæ‰€ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µã€‚å…¶å®å°±æ˜¯è”åˆç´¢å¼•ï¼Œç„¶åç¬¦åˆè¦†ç›–çš„è¦æ±‚å°±ç§°ä¹‹ä¸ºè¦†ç›–ç´¢å¼•ï¼Œå°±æ˜¯å¤šä¸ªå­—æ®µæ‹¼æˆä¸€ä¸ªç´¢å¼•ï¼Œç„¶åå¯¹åº”ä¸»é”®çš„æ˜ å°„ã€‚ æœ€å·¦å‰ç¼€è§„åˆ™ã€‚åªè¦æ»¡è¶³æœ€å·¦å‰ç¼€ï¼Œå°±å¯ä»¥åˆ©ç”¨ç´¢å¼•æ¥åŠ é€Ÿæ£€ç´¢ã€‚è¿™ä¸ªæœ€å·¦å‰ç¼€å¯ä»¥æ˜¯è”åˆç´¢å¼•çš„æœ€å·¦Nä¸ªå­—æ®µï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç´¢å¼•çš„æœ€å·¦Mä¸ªå­—ç¬¦ã€‚ åŸºäºä¸Šé¢å¯¹æœ€å·¦å‰ç¼€ç´¢å¼•çš„è¯´æ˜ï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸ªé—®é¢˜ï¼šåœ¨å»ºç«‹è”åˆç´¢å¼•çš„æ—¶å€™ï¼Œå¦‚ä½•å®‰æ’ç´¢å¼•å†…çš„å­—æ®µé¡ºåºã€‚ è¿™é‡Œæˆ‘ä»¬çš„è¯„ä¼°æ ‡å‡†æ˜¯ï¼Œç´¢å¼•çš„å¤ç”¨èƒ½åŠ›ã€‚å› ä¸ºå¯ä»¥æ”¯æŒæœ€å·¦å‰ç¼€ï¼Œæ‰€ä»¥å½“å·²ç»æœ‰äº†(a,b)è¿™ä¸ªè”åˆç´¢å¼•åï¼Œä¸€èˆ¬å°±ä¸éœ€è¦å•ç‹¬åœ¨aä¸Šå»ºç«‹ç´¢å¼•äº†ã€‚å› æ­¤ï¼Œç¬¬ä¸€åŸåˆ™æ˜¯ï¼Œå¦‚æœé€šè¿‡è°ƒæ•´é¡ºåºï¼Œå¯ä»¥å°‘ç»´æŠ¤ä¸€ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡ºåºå¾€å¾€å°±æ˜¯éœ€è¦ä¼˜å…ˆè€ƒè™‘é‡‡ç”¨çš„ã€‚é‚£å¦‚æœæ—¢æœ‰è”åˆç´¢å¼•ï¼Œåˆæœ‰åŸºäº aã€b å„è‡ªçš„ç´¢å¼•å‘¢ï¼Ÿé‚£å°±è€ƒè™‘ç©ºé—´é—®é¢˜äº†ï¼Œå¦‚æœ a çš„å­—æ®µæ˜æ˜¾æ¯” b çš„é•¿ï¼Œåˆ™ä¸€é¡µä¸‹å¯ä»¥å®¹çº³æ›´å¤šçš„ bï¼Œé‚£è‚¯å®šå°±åˆ›å»ºä¸€ä¸ªï¼ˆa,b)çš„è”åˆç´¢å¼•å’Œä¸€ä¸ª(b)çš„å•å­—æ®µç´¢å¼•ã€‚ ç´¢å¼•ä¸‹æ¨ã€‚åœ¨MySQL 5.6ä¹‹å‰ï¼Œåªèƒ½ä»ID3å¼€å§‹ä¸€ä¸ªä¸ªå›è¡¨ã€‚åˆ°ä¸»é”®ç´¢å¼•ä¸Šæ‰¾å‡ºæ•°æ®è¡Œï¼Œå†å¯¹æ¯”å­—æ®µå€¼ã€‚ è€ŒMySQL 5.6 å¼•å…¥çš„ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–ï¼ˆindex condition pushdown)ï¼Œ å¯ä»¥åœ¨ç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œå¯¹ç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µå…ˆåšåˆ¤æ–­ï¼Œç›´æ¥è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°ã€‚ 6. å…¨å±€é”å’Œè¡¨çº§é”æ ¹æ®åŠ é”èŒƒå›´ï¼šMySQLé‡Œé¢çš„é”å¯ä»¥åˆ†ä¸ºï¼šå…¨å±€é”ã€è¡¨çº§é”ã€è¡Œçº§é” ä¸€ã€å…¨å±€é”ï¼šå¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ã€‚MySQLæä¾›åŠ å…¨å±€è¯»é”çš„æ–¹æ³•ï¼šFlush tables with read lock(FTWRL) FTWRLçš„å¯åŠ¨æ—¶é—´ç‚¹ï¼š FTWRL å‰æœ‰è¯»å†™çš„è¯ ,FTWRL éƒ½ä¼šç­‰å¾… è¯»å†™æ‰§è¡Œå®Œæ¯•åæ‰æ‰§è¡Œï¼› FTWRL æ‰§è¡Œçš„æ—¶å€™è¦åˆ·è„é¡µçš„æ•°æ®åˆ°ç£ç›˜,å› ä¸ºè¦ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ ï¼Œç†è§£çš„æ‰§è¡ŒFTWRLæ—¶å€™æ˜¯ æ‰€æœ‰äº‹åŠ¡ éƒ½æäº¤å®Œæ¯•çš„æ—¶å€™ã€‚ è¿™ä¸ªå‘½ä»¤å¯ä»¥ä½¿æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ã€‚ä½¿ç”¨è¯¥å‘½ä»¤ä¹‹åï¼Œæ•°æ®æ›´æ–°è¯­å¥ã€æ•°æ®å®šä¹‰è¯­å¥å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ç­‰æ“ä½œéƒ½ä¼šè¢«é˜»å¡ã€‚ä½¿ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ã€‚é£é™©ï¼š1.å¦‚æœåœ¨ä¸»åº“å¤‡ä»½ï¼Œåœ¨å¤‡ä»½æœŸé—´ä¸èƒ½æ›´æ–°ï¼Œä¸šåŠ¡åœæ‘†2.å¦‚æœåœ¨ä»åº“å¤‡ä»½ï¼Œå¤‡ä»½æœŸé—´ä¸èƒ½æ‰§è¡Œä¸»åº“åŒæ­¥çš„binlogï¼Œå¯¼è‡´ä¸»ä»å»¶è¿Ÿå®˜æ–¹è‡ªå¸¦çš„é€»è¾‘å¤‡ä»½å·¥å…·mysqldumpï¼Œå½“mysqldumpä½¿ç”¨å‚æ•°â€“single-transactionçš„æ—¶å€™ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œç¡®ä¿æ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾ã€‚è€Œç”±äºMVCCçš„æ”¯æŒï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ•°æ®æ˜¯å¯ä»¥æ­£å¸¸æ›´æ–°çš„ã€‚ ä¸€è‡´æ€§è¯»æ˜¯å¥½ï¼Œä½†æ˜¯å‰ææ˜¯å¼•æ“è¦æ”¯æŒè¿™ä¸ªéš”ç¦»çº§åˆ«ã€‚å¦‚æœè¦å…¨åº“åªè¯»ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨set global readonly=trueçš„æ–¹å¼ï¼Ÿ1.åœ¨æœ‰äº›ç³»ç»Ÿä¸­ï¼Œreadonlyçš„å€¼ä¼šè¢«ç”¨æ¥åšå…¶ä»–é€»è¾‘ï¼Œæ¯”å¦‚åˆ¤æ–­ä¸»å¤‡åº“ã€‚æ‰€ä»¥ä¿®æ”¹globalå˜é‡çš„æ–¹å¼å½±å“å¤ªå¤§ã€‚2.åœ¨å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸Šæœ‰å·®å¼‚ã€‚å¦‚æœæ‰§è¡ŒFTWRLå‘½ä»¤ä¹‹åç”±äºå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸æ–­å¼€ï¼Œé‚£ä¹ˆMySQLä¼šè‡ªåŠ¨é‡Šæ”¾è¿™ä¸ªå…¨å±€é”ï¼Œæ•´ä¸ªåº“å›åˆ°å¯ä»¥æ­£å¸¸æ›´æ–°çš„çŠ¶æ€ã€‚è€Œå°†æ•´ä¸ªåº“è®¾ç½®ä¸ºreadonlyä¹‹åï¼Œå¦‚æœå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æ•°æ®åº“å°±ä¼šä¸€ç›´ä¿æŒreadonlyçŠ¶æ€ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ•´ä¸ªåº“é•¿æ—¶é—´å¤„äºä¸å¯å†™çŠ¶æ€ï¼Œé£é™©è¾ƒé«˜ã€‚äºŒã€è¡¨çº§é”MySQLé‡Œé¢è¡¨çº§é”æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯è¡¨é”ï¼Œä¸€ç§æ˜¯å…ƒæ•°æ®é”(meta data lock,MDL)è¡¨é”çš„è¯­æ³•æ˜¯:lock tables â€¦ read/writeå¯ä»¥ç”¨unlock tablesä¸»åŠ¨é‡Šæ”¾é”ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯æ–­å¼€çš„æ—¶å€™è‡ªåŠ¨é‡Šæ”¾ã€‚lock tablesè¯­æ³•é™¤äº†ä¼šé™åˆ¶åˆ«çš„çº¿ç¨‹çš„è¯»å†™å¤–ï¼Œä¹Ÿé™å®šäº†æœ¬çº¿ç¨‹æ¥ä¸‹æ¥çš„æ“ä½œå¯¹è±¡ã€‚å¯¹äºInnoDBè¿™ç§æ”¯æŒè¡Œé”çš„å¼•æ“ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨lock tableså‘½ä»¤æ¥æ§åˆ¶å¹¶å‘ï¼Œæ¯•ç«Ÿé”ä½æ•´ä¸ªè¡¨çš„å½±å“é¢è¿˜æ˜¯å¤ªå¤§ã€‚MDLï¼šä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šã€‚Server å±‚é¢å®ç°çš„ï¼ï¼ï¼ï¼MDLçš„ä½œç”¨ï¼šä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚åœ¨å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥ï¼ˆDMLï¼‰æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLè¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´ï¼ˆDDLï¼‰æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLå†™é”ã€‚è¯»é”ä¹‹é—´ä¸äº’æ–¥ã€‚å› ä¸ºæœ‰éš”ç¦»çº§åˆ«åœ¨ï¼Œmvccï¼Œæ‰€ä»¥è¯»é”ä¹‹é—´æ— éœ€å¤åˆ¶å³å¯ï¼Œè¯»å†™é”ä¹‹é—´ï¼Œå†™é”ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œç”¨æ¥ä¿è¯å˜æ›´è¡¨ç»“æ„æ“ä½œçš„å®‰å…¨æ€§ã€‚MDL ä¼šç›´åˆ°äº‹åŠ¡æäº¤æ‰ä¼šé‡Šæ”¾ï¼Œåœ¨åšè¡¨ç»“æ„å˜æ›´çš„æ—¶å€™ï¼Œä¸€å®šè¦å°å¿ƒä¸è¦å¯¼è‡´é”ä½çº¿ä¸ŠæŸ¥è¯¢å’Œæ›´æ–°ã€‚æ‰€ä»¥å°å¿ƒåœ¨ç»™å°è¡¨åš DDL æ—¶æŠŠè¿™ä¸ªåº“æå´©ã€‚ æ•°æ®åº“å››ç§è¯­è¨€ï¼š DDL ï¼ˆData Definition Languageï¼‰ï¼šæ•°æ®å®šä¹‰è¯­è¨€ï¼Œæ— éœ€æäº¤å°±å¯ä»¥æ‰§è¡Œçš„ï¼Œä¸»è¦æœ‰ CREATEã€ALTERã€DROPç­‰ç­‰ï¼› DMLï¼ˆData Manipulation Languageï¼‰ï¼šæ•°æ®æ“ä½œè¯­è¨€ï¼Œè¿™ä¸ªä¹Ÿæ˜¯éœ€è¦æäº¤äº‹åŠ¡çš„å“¦ï¼ŒINSERTã€UPDATEã€DELETEã€TRUNCATEã€SELECTã€ä»¥åŠ LOCK TABLEã€CALLã€EXPLAIN PLAN DCLï¼ˆData Control Languageï¼‰ï¼šæ•°æ®æ§åˆ¶è¯­è¨€ï¼ŒåŒ…æ‹¬ GRANTã€REVOKE TCLï¼ˆTransaction Control Languageï¼‰ï¼šäº‹åŠ¡æ§åˆ¶è¯­è¨€ï¼ŒåŒ…æ‹¬ ROLLBACKã€COMMITã€SAVEPOINTã€SET TRANSACTIONã€‚ ä»Šæ—¥æ€è€ƒé¢˜ï¼šå¤‡ä»½ä¸€èˆ¬éƒ½ä¼šåœ¨å¤‡åº“ä¸Šæ‰§è¡Œï¼Œä½ åœ¨ç”¨â€“single-transactionæ–¹æ³•åšé€»è¾‘å¤‡ä»½çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸»åº“ä¸Šçš„ä¸€ä¸ªå°è¡¨åšäº†ä¸€ä¸ªDDLï¼Œæ¯”å¦‚ç»™ä¸€ä¸ªè¡¨ä¸ŠåŠ äº†ä¸€åˆ—ã€‚è¿™æ—¶å€™ï¼Œä»å¤‡åº“ä¸Šä¼šçœ‹åˆ°ä»€ä¹ˆç°è±¡å‘¢ï¼Ÿ å‡è®¾è¿™ä¸ªDDLæ˜¯é’ˆå¯¹è¡¨t1çš„ï¼Œ è¿™é‡Œæˆ‘æŠŠå¤‡ä»½è¿‡ç¨‹ä¸­å‡ ä¸ªå…³é”®çš„è¯­å¥åˆ—å‡ºæ¥ï¼š 12345678910111213&gt;Q1:SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;&gt;Q2:START TRANSACTION WITH CONSISTENT SNAPSHOTï¼›&gt;/* other tables */&gt;Q3:SAVEPOINT sp;&gt;/* æ—¶åˆ» 1 */&gt;Q4:show create table `t1`;&gt;/* æ—¶åˆ» 2 */&gt;Q5:SELECT * FROM `t1`;&gt;/* æ—¶åˆ» 3 */&gt;Q6:ROLLBACK TO SAVEPOINT sp;&gt;/* æ—¶åˆ» 4 */&gt;/* other tables */&gt; åœ¨å¤‡ä»½å¼€å§‹çš„æ—¶å€™ï¼Œä¸ºäº†ç¡®ä¿RRï¼ˆå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«ï¼Œå†è®¾ç½®ä¸€æ¬¡RRéš”ç¦»çº§åˆ«(Q1); å¯åŠ¨äº‹åŠ¡ï¼Œè¿™é‡Œç”¨ WITH CONSISTENT SNAPSHOTç¡®ä¿è¿™ä¸ªè¯­å¥æ‰§è¡Œå®Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªä¸€è‡´æ€§è§†å›¾ï¼ˆQ2)ï¼› è®¾ç½®ä¸€ä¸ªä¿å­˜ç‚¹ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼ˆQ3ï¼‰ï¼› show create æ˜¯ä¸ºäº†æ‹¿åˆ°è¡¨ç»“æ„(Q4)ï¼Œç„¶åæ­£å¼å¯¼æ•°æ® ï¼ˆQ5ï¼‰ï¼Œå›æ»šåˆ°SAVEPOINT spï¼Œåœ¨è¿™é‡Œçš„ä½œç”¨æ˜¯é‡Šæ”¾ t1çš„MDLé” ï¼ˆQ6ã€‚å½“ç„¶è¿™éƒ¨åˆ†å±äºâ€œè¶…çº²â€ï¼Œä¸Šæ–‡æ­£æ–‡é‡Œé¢éƒ½æ²¡æåˆ°ã€‚ DDLä»ä¸»åº“ä¼ è¿‡æ¥çš„æ—¶é—´æŒ‰ç…§æ•ˆæœä¸åŒï¼Œæˆ‘æ‰“äº†å››ä¸ªæ—¶åˆ»ã€‚é¢˜ç›®è®¾å®šä¸ºå°è¡¨ï¼Œæˆ‘ä»¬å‡å®šåˆ°è¾¾åï¼Œå¦‚æœå¼€å§‹æ‰§è¡Œï¼Œåˆ™å¾ˆå¿«èƒ½å¤Ÿæ‰§è¡Œå®Œæˆã€‚ å‚è€ƒç­”æ¡ˆå¦‚ä¸‹ï¼š å¦‚æœåœ¨Q4è¯­å¥æ‰§è¡Œä¹‹å‰åˆ°è¾¾ï¼Œç°è±¡ï¼šæ²¡æœ‰å½±å“ï¼Œå¤‡ä»½æ‹¿åˆ°çš„æ˜¯DDLåçš„è¡¨ç»“æ„ã€‚ å¦‚æœåœ¨â€œæ—¶åˆ» 2â€åˆ°è¾¾ï¼Œåˆ™è¡¨ç»“æ„è¢«æ”¹è¿‡ï¼ŒQ5æ‰§è¡Œçš„æ—¶å€™ï¼ŒæŠ¥ Table definition has changed, please retry transactionï¼Œç°è±¡ï¼šmysqldumpç»ˆæ­¢ï¼› å¦‚æœåœ¨â€œæ—¶åˆ»2â€å’Œâ€œæ—¶åˆ»3â€ä¹‹é—´åˆ°è¾¾ï¼Œmysqldumpå ç€t1çš„MDLè¯»é”ï¼Œbinlogè¢«é˜»å¡ï¼Œç°è±¡ï¼šä¸»ä»å»¶è¿Ÿï¼Œç›´åˆ°Q6æ‰§è¡Œå®Œæˆã€‚ ä»â€œæ—¶åˆ»4â€å¼€å§‹ï¼Œmysqldumpé‡Šæ”¾äº†MDLè¯»é”ï¼Œç°è±¡ï¼šæ²¡æœ‰å½±å“ï¼Œå¤‡ä»½æ‹¿åˆ°çš„æ˜¯DDLå‰çš„è¡¨ç»“æ„ã€‚ 7. è®²è¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“è¡Œé”æ˜¯åœ¨å­˜å‚¨å¼•æ“çº§åˆ«å®ç°çš„ï¼Œå¹¶ä¸æ˜¯åƒå…¨å±€é”å’Œè¡¨çº§é”ä¸€æ ·åœ¨ Server ç«¯å®ç°ã€‚ InnoDB æ”¯æŒè¡Œé”ï¼Œä¸æ”¯æŒåˆ—é”ï¼Œå¹¶ä¸” innodb è¡Œçº§é”æ˜¯é€šè¿‡é”ç´¢å¼•è®°å½•å®ç°çš„ï¼Œå¦‚æœæ›´æ–°çš„åˆ—æ²¡å»ºç´¢å¼•æ˜¯ä¼šé”ä½æ•´ä¸ªè¡¨çš„ã€‚å› ä¸ºä¸èµ°ç´¢å¼•ï¼Œæ‰€ä»¥å¿…é¡»éå†æ•´ä¸ªè¡¨ï¼Œé‚£ä¹ˆå°±ä¼šè¯»å–ä¸€è¡Œï¼Œé”ä¸€è¡Œï¼Œåˆå› ä¸ºæ˜¯ä¸¤é˜¶æ®µé”ï¼Œåªæœ‰æ›´æ–°æˆåŠŸï¼Œäº‹åŠ¡æäº¤ä¹‹åæ‰ä¼šé‡Šæ”¾é”ã€‚ MyISAM æœ€å°çš„é”ç²’åº¦æ˜¯è¡¨ï¼Œå¹¶ä¸”ç”±äºè¡¨é”çš„å­˜åœ¨ï¼ŒåŒæ—¶åˆ»åªèƒ½æ˜¯å•ä¸ªçº¿ç¨‹å¯¹è¡¨è¿›è¡Œæ“ä½œï¼Œè¿™å¾ˆå¤§ç¨‹åº¦ä¸Šé™åˆ¶äº†å¹¶å‘åº¦ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ InnoDB å–ä»£ MyISAM çš„é‡è¦åŸå› å§ã€‚ ä¸¤é˜¶æ®µé”çš„æ¦‚å¿µæ˜¯ä»€ä¹ˆ? å¯¹äº‹åŠ¡ä½¿ç”¨æœ‰ä»€ä¹ˆå¸®åŠ©? ä¸¤é˜¶æ®µé”æ˜¯æŒ‡è¡Œé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™åŠ é”ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯åœ¨ä¸ç”¨äº†ä¹‹åå°±é‡Šæ”¾é”ï¼Œè€Œæ˜¯ç­‰åˆ°äº‹åŠ¡æäº¤æ‰é‡Šæ”¾é”ï¼Œè¿™ä¸€ç‚¹è·Ÿ MDL ï¼ˆå…ƒæ•°æ®é”ï¼‰å¾ˆåƒï¼› å¯¹äº‹åŠ¡çš„å¸®åŠ©å°±æ˜¯ï¼šä¸€å®šè¦å°†å¹¶å‘åº¦é«˜ã€æ—¶é—´è¾ƒé•¿çš„æ“ä½œçš„è¡Œæ”¾åˆ°äº‹åŠ¡æäº¤å‰ï¼Œé˜²æ­¢è¿‡å¤šçš„çº¿ç¨‹ç­‰å¾…é”ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸¤é˜¶æ®µé”åè®®ï¼Œä¸ºä½•ä¸åœ¨äº‹åŠ¡å¯åŠ¨æ—¶å°±åŠ é”ï¼Œåˆä¸ºä»€ä¹ˆä¸åœ¨è¯­å¥æ‰§è¡Œå®Œå°±è§£é”å‘¢ï¼Ÿ é¦–å…ˆå›ç­”ä¸€ä¸‹ä¸ºä»€ä¹ˆä¸åœ¨äº‹åŠ¡å¯åŠ¨æ—¶å°±åŠ é”ï¼Œæˆ‘è§‰å¾—åŸå› æœ‰ä¸¤ä¸ªï¼š å‡å°é”çš„ç²’åº¦å’ŒåŠ é”æ—¶é•¿ï¼Œæé«˜å¹¶å‘åº¦ã€‚ äº‹åŠ¡å¯åŠ¨çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰æ˜ç¡®è¯´æ˜éœ€è¦ä¿®æ”¹ä»€ä¹ˆè¡Œï¼Œæ­¤æ—¶å¦‚æœè¦é”å®šè¡Œå¿…é¡»é”å®šæ•´ä¸ªè¡¨æ‰è¡Œã€‚ å†å›ç­”ä¸€ä¸‹ä¸ºä»€ä¹ˆä¸åœ¨è¯­å¥æ‰§è¡Œå®Œå°±è§£é”ã€‚ å› ä¸ºè¿™æ ·äº‹åŠ¡å¦‚æœå›æ»šçš„è¯ï¼Œå°±ä¼šæœ‰é—®é¢˜äº†ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ç§æƒ…å†µï¼š å¦‚æœäº‹åŠ¡ A å›æ»šï¼Œé‚£è‚¯å®šæ— æ³•å›æ»šäº†ï¼Œå› ä¸ºå·²ç»æœ‰å¤šä¸ªäº‹åŠ¡ä¿®æ”¹äº†è¿™ä¸ªå€¼ï¼Œå¹¶ä¸”äººå®¶å·²ç»æäº¤äº†ï¼Œæ— æ³•å›æ»šã€‚ æ­»é”çš„æ¦‚å¿µæ˜¯ä»€ä¹ˆ? ä¸¾ä¾‹è¯´æ˜å‡ºç°æ­»é”çš„æƒ…å†µã€‚ ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹åœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºçš„è¿‡ç¨‹ç§°ä¸ºæ­»é”çŠ¶æ€ï¼Œå‡ºç°æ­»é”çš„æƒ…å†µä¸€èˆ¬éƒ½æ˜¯åµŒå¥—é”ï¼ˆè·Ÿå¤šçº¿ç¨‹ä¸­åµŒå¥—åŒæ­¥ä»£ç å—ä¸€æ ·ï¼‰ã€‚ æ‰€ä»¥æˆ‘çš„å»ºè®®æ˜¯åœ¨åŠ é”çš„æ—¶å€™ä¸€èˆ¬éƒ½åšåˆ°é¡ºåºåŠ é”ï¼Œè¿™æ ·å°±èƒ½é˜²æ­¢é”äº’ç›¸åµŒå¥—é—®é¢˜ã€‚ æ­»é”çš„å¤„ç†ç­–ç•¥æœ‰å“ªä¸¤ç§? åœ¨æ•°æ®åº“ä¸­ï¼Œæ­»é”çš„å¤„ç†ç­–ç•¥æœ‰ï¼š æœ‰ä¸ªè¶…æ—¶æœºåˆ¶ï¼Œè¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡å‚æ•°innodb_lock_wait_timeoutæ¥è®¾ç½®ã€‚æ—¶é—´åˆ°äº†è‡ªåŠ¨é‡Šæ”¾é”ï¼Œå¹¶ä¸”å›æ»šå½“å‰äº‹åŠ¡ï¼Œè¿™ä¸ªé»˜è®¤æ˜¯ 50sï¼Œæ—¶é—´å¤ªé•¿ï¼Œä¸€èˆ¬ä¸è€ƒè™‘ï¼› å‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•°innodb_deadlock_detectè®¾ç½®ä¸ºonï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚è¿™ä¸ªé»˜è®¤æ˜¯å¼€å¯çš„ï¼Œä½†æ˜¯å§ï¼Œè¿™ä¸ªå¾ˆæ¶ˆè€—èµ„æºã€‚ æœ‰å“ªäº›æ€è·¯å¯ä»¥è§£å†³çƒ­ç‚¹æ›´æ–°å¯¼è‡´çš„å¹¶å‘é—®é¢˜? çƒ­ç‚¹æ›´æ–°å¯¼è‡´çš„å¹¶å‘é—®é¢˜ï¼Œç—‡ç»“å°±åœ¨äºæ­»é”æ£€æµ‹éå¸¸çš„æ¶ˆè€—èµ„æºï¼Œæ‰€ä»¥å¯ä»¥æœ‰ä»¥ä¸‹è§£å†³æªæ–½ï¼š å°½é‡é¿å…æ­»é”ï¼Œæ¯”å¦‚ä¸Šæ–‡è¯´çš„åŠ é”æŒ‰é¡ºåºï¼Œç„¶åç›´æ¥å°†æ­»é”æ£€æµ‹å…³é—­ï¼Œä½†æ˜¯è¿™æ ·å®¹æ˜“é€ æˆä¸šåŠ¡æœ‰æŸï¼Œä¸€èˆ¬æ­»é”æ£€æµ‹è™½ç„¶æµªè´¹èµ„æºä½†æ˜¯æ˜¯ä¸šåŠ¡æ— æŸçš„ï¼Œæ‰€ä»¥å…³é—­å¯èƒ½ä¸æ˜¯ç‰¹åˆ«å¯å–ï¼› æ§åˆ¶å¹¶å‘åº¦ï¼Œå¯¹åº”ç›¸åŒè¡Œçš„æ›´æ–°ï¼Œåœ¨è¿›å…¥å¼•æ“ä¹‹å‰æ’é˜Ÿã€‚è¿™æ ·åœ¨InnoDBå†…éƒ¨å°±ä¸ä¼šæœ‰å¤§é‡çš„æ­»é”æ£€æµ‹å·¥ä½œäº†ï¼› å°†çƒ­ç‚¹ç»†åˆ†ï¼Œæ¯”å¦‚è´­ä¹°ç”µå½±ç¥¨ï¼ŒæŠŠå½±é™¢çš„è´¦æˆ·æ€»é¢æ‹†æˆ10æ¡è®°å½•æ¥å­˜å‚¨ï¼Œå…¶10æ¡è®°å½•çš„å’Œç­‰äºå½±é™¢è´¦æˆ·ä½™é¢ï¼Œè¿™æ ·èƒ½å°½é‡å‡å°‘æ­»é”çš„æƒ…å†µã€‚ ä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œæ­»é”æ£€æµ‹ï¼Ÿä¸€æ—¦è§¦å‘æ­»é”æ£€æµ‹æ˜¯æ£€æµ‹æ‰€æœ‰äº‹åŠ¡å—ï¼Ÿ å¦‚æœä»–è¦åŠ é”è®¿é—®çš„è¡Œä¸Šæœ‰é”ï¼Œä»–æ‰è¦æ£€æµ‹ã€‚ ä¸æ˜¯æ¯æ¬¡æ­»é”æ£€æµ‹éƒ½éƒ½è¦æ‰«æ‰€æœ‰äº‹åŠ¡ã€‚æ¯”å¦‚æŸä¸ªæ—¶åˆ»ï¼Œäº‹åŠ¡ç­‰å¾…çŠ¶æ€æ˜¯è¿™æ ·çš„ï¼š Båœ¨ç­‰Aï¼ŒDåœ¨ç­‰Cï¼Œç°åœ¨æ¥äº†ä¸€ä¸ªEï¼Œå‘ç°Eéœ€è¦ç­‰Dï¼Œé‚£ä¹ˆEå°±åˆ¤æ–­è·ŸDã€Cæ˜¯å¦ä¼šå½¢æˆæ­»é”ï¼Œè¿™ä¸ªæ£€æµ‹ä¸ç”¨ç®¡Bå’ŒA ä»Šæ—¥é¢è¯•é¢˜ï¼š å¦‚æœä½ è¦åˆ é™¤ä¸€ä¸ªè¡¨é‡Œé¢çš„å‰10000è¡Œæ•°æ®ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•å¯ä»¥åšåˆ°ï¼š ç¬¬ä¸€ç§ï¼Œç›´æ¥æ‰§è¡Œdelete from T limit 10000; ç¬¬äºŒç§ï¼Œåœ¨ä¸€ä¸ªè¿æ¥ä¸­å¾ªç¯æ‰§è¡Œ20æ¬¡ delete from T limit 500; ç¬¬ä¸‰ç§ï¼Œåœ¨20ä¸ªè¿æ¥ä¸­åŒæ—¶æ‰§è¡Œdelete from T limit 500ã€‚ ä½ ä¼šé€‰æ‹©å“ªä¸€ç§æ–¹æ³•å‘¢ï¼Ÿä¸ºä»€ä¹ˆå‘¢ï¼Ÿ åœ¨ä¸€ä¸ªè¿æ¥ä¸­å¾ªç¯æ‰§è¡Œ20æ¬¡ delete from T limit 500ã€‚ ç¡®å®æ˜¯è¿™æ ·çš„ï¼Œç¬¬äºŒç§æ–¹å¼æ˜¯ç›¸å¯¹è¾ƒå¥½çš„ã€‚ ç¬¬ä¸€ç§æ–¹å¼ï¼ˆå³ï¼šç›´æ¥æ‰§è¡Œdelete from T limit 10000ï¼‰é‡Œé¢ï¼Œå•ä¸ªè¯­å¥å ç”¨æ—¶é—´é•¿ï¼Œé”çš„æ—¶é—´ä¹Ÿæ¯”è¾ƒé•¿ï¼›è€Œä¸”å¤§äº‹åŠ¡è¿˜ä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿã€‚ ç¬¬ä¸‰ç§æ–¹å¼ï¼ˆå³ï¼šåœ¨20ä¸ªè¿æ¥ä¸­åŒæ—¶æ‰§è¡Œdelete from T limit 500ï¼‰ï¼Œä¼šäººä¸ºé€ æˆé”å†²çªã€‚ ç¡®å®æ˜¯è¿™æ ·çš„ï¼Œç¬¬äºŒç§æ–¹å¼æ˜¯ç›¸å¯¹è¾ƒå¥½çš„ã€‚ ç¬¬ä¸€ç§æ–¹å¼ï¼ˆå³ï¼šç›´æ¥æ‰§è¡Œdelete from T limit 10000ï¼‰é‡Œé¢ï¼Œå•ä¸ªè¯­å¥å ç”¨æ—¶é—´é•¿ï¼Œé”çš„æ—¶é—´ä¹Ÿæ¯”è¾ƒé•¿ï¼›è€Œä¸”å¤§äº‹åŠ¡è¿˜ä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿã€‚ ç¬¬ä¸‰ç§æ–¹å¼ï¼ˆå³ï¼šåœ¨20ä¸ªè¿æ¥ä¸­åŒæ—¶æ‰§è¡Œdelete from T limit 500ï¼‰ï¼Œä¼šäººä¸ºé€ æˆé”å†²çªã€‚ 8. äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»è¿˜æ˜¯ä¸éš”ç¦»çš„è¿™ç« çŸ¥è¯†ç‚¹å¾ˆå¤šï¼Œéš¾åº¦æ¯”è¾ƒå¤§ï¼ å…ˆå›é¡¾ä¸€ä¸‹ä»€ä¹ˆæ˜¯ MVCCï¼Œå¦‚ä½•å®ç°çš„ï¼Ÿ MVCCï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œåœ¨æŸ¥è¯¢è®°å½•çš„æ—¶å€™ï¼Œä¸åŒæ—¶åˆ»å¯åŠ¨çš„äº‹åŠ¡ä¼šæœ‰ä¸åŒçš„read-viewã€‚å¦‚å›¾ä¸­çœ‹åˆ°çš„ï¼Œåœ¨è§†å›¾Aã€Bã€Cé‡Œé¢ï¼Œè¿™ä¸€ä¸ªè®°å½•çš„å€¼åˆ†åˆ«æ˜¯1ã€2ã€4ï¼ŒåŒä¸€æ¡è®°å½•åœ¨ç³»ç»Ÿä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªç‰ˆæœ¬ã€‚ã€Œå­˜å‚¨åœ¨undo log æ—¥å¿—ä¸­ã€ ä»€ä¹ˆæ˜¯ read-viewï¼Ÿ ä¸€è‡´æ€§è§†å›¾ï¼Œå…¨ç§°æ˜¯ consistent read-viewï¼Œè¿™é‡Œç¨å¾®è¡¥å……ä¸€ä¸‹ï¼Œåœ¨ mysqlä¸­æœ‰ä¸¤ç§è§†å›¾ï¼š ä¸€ä¸ªæ˜¯viewã€‚å®ƒæ˜¯ä¸€ä¸ªç”¨æŸ¥è¯¢è¯­å¥å®šä¹‰çš„è™šæ‹Ÿè¡¨ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™æ‰§è¡ŒæŸ¥è¯¢è¯­å¥å¹¶ç”Ÿæˆç»“æœã€‚åˆ›å»ºè§†å›¾çš„è¯­æ³•æ˜¯create view â€¦ ï¼Œè€Œå®ƒçš„æŸ¥è¯¢æ–¹æ³•ä¸è¡¨ä¸€æ ·ã€‚ å¦ä¸€ä¸ªæ˜¯InnoDBåœ¨å®ç°MVCCæ—¶ç”¨åˆ°çš„ä¸€è‡´æ€§è¯»è§†å›¾ï¼Œå³consistent read viewï¼Œç”¨äºæ”¯æŒRCï¼ˆRead Committedï¼Œè¯»æäº¤ï¼‰å’ŒRRï¼ˆRepeatable Readï¼Œå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«çš„å®ç°ã€‚ åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦ç”¨åˆ° read-viewçš„ï¼Œä½†æ˜¯åœ¨ update çš„æ—¶å€™ï¼Œæ˜¯å¿…é¡»åªèƒ½è¯»å½“å‰æœ€æ–°å€¼å“¦ï¼ï¼ï¼ã€Œè¿™é‡Œçš„æœ€æ–°å€¼è‚¯å®šæ˜¯å·²ç»æäº¤çš„äº‹åŠ¡å»åšçš„ï¼Œå¦‚æœæœªæäº¤çš„äº‹åŠ¡å»æ“ä½œè¿™ä¸ªå€¼ï¼Œé‚£è‚¯å®šæ˜¯åŠ äº†è¡Œé”ä¸­çš„ç‹¬å é”å•¦ï¼Œæ‰€ä»¥ä½ åœ¨ update çš„è¯å¿…é¡»ç­‰å…¶ä»–äº‹åŠ¡é‡Šæ”¾é”ã€‚ã€ è¯´äº†è¿™ä¹ˆå¤šï¼Œå›åˆ°é—®é¢˜ï¼Œread-viewå…¶å®å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªäº‹åŠ¡æˆ–è€…è¯­å¥éƒ½æœ‰çš„ä¸€ä¸ªæ•°ç»„ï¼Œåªä¸è¿‡è¿™ä¸ªæ•°ç»„æœ‰ç‚¹ç‰¹æ®Šã€‚ InnoDBä¸ºæ¯ä¸ªäº‹åŠ¡æ„é€ äº†ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥ä¿å­˜è¿™ä¸ªäº‹åŠ¡å¯åŠ¨ç¬é—´ï¼Œå½“å‰æ­£åœ¨â€œæ´»è·ƒâ€çš„æ‰€æœ‰äº‹åŠ¡IDã€‚â€œæ´»è·ƒâ€æŒ‡çš„å°±æ˜¯ï¼Œå¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤ã€‚ æ•°ç»„é‡Œé¢äº‹åŠ¡IDçš„æœ€å°å€¼è®°ä¸ºä½æ°´ä½ï¼Œå½“å‰ç³»ç»Ÿé‡Œé¢å·²ç»åˆ›å»ºè¿‡çš„äº‹åŠ¡IDçš„æœ€å¤§å€¼åŠ 1è®°ä¸ºé«˜æ°´ä½ã€‚ è¿™ä¸ªè§†å›¾æ•°ç»„å’Œé«˜æ°´ä½ï¼Œå°±ç»„æˆäº†å½“å‰äº‹åŠ¡çš„ä¸€è‡´æ€§è§†å›¾ï¼ˆread-viewï¼‰ã€‚ æŸ¥è¯¢çš„æ—¶å€™ï¼Œæ˜¯å¦‚ä½•ç”¨åˆ° read-view çš„ï¼Ÿ InnoDBçš„è¡Œæ•°æ®æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªæ•°æ®ç‰ˆæœ¬æœ‰è‡ªå·±çš„row trx_idï¼Œæ¯ä¸ªäº‹åŠ¡æˆ–è€…è¯­å¥æœ‰è‡ªå·±çš„ä¸€è‡´æ€§è§†å›¾ã€‚æ™®é€šæŸ¥è¯¢è¯­å¥æ˜¯ä¸€è‡´æ€§è¯»ï¼Œä¸€è‡´æ€§è¯»ä¼šæ ¹æ®row trx_idå’Œä¸€è‡´æ€§è§†å›¾ï¼ˆread-viewï¼‰ç¡®å®šæ•°æ®ç‰ˆæœ¬çš„å¯è§æ€§ã€‚ å¯¹äºå¯é‡å¤è¯»ï¼ŒæŸ¥è¯¢åªæ‰¿è®¤åœ¨äº‹åŠ¡å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®ï¼›ã€Œå› ä¸ºå¯¹äºå¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ï¼Œä¸€è‡´æ€§è§†å›¾æ˜¯åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™è¿›è¡Œå…¨åº“å¿«ç…§ç”Ÿæˆçš„ã€ å¯¹äºè¯»æäº¤ï¼ŒæŸ¥è¯¢åªæ‰¿è®¤åœ¨è¯­å¥å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®ï¼›ã€Œå› ä¸ºå¯¹äºè¯»æäº¤çš„éš”ç¦»çº§åˆ«æ¥è¯´ï¼Œä¸€è‡´æ€§è§†å›¾æ˜¯åœ¨æ¯ä¸€æ¬¡æ‰§è¡Œè¯­å¥çš„æ—¶å€™ç”Ÿæˆçš„ï¼Œè·Ÿäº‹åŠ¡æ²¡æœ‰å…³ç³»ã€ æ€»ç»“ä¸Šè¿°ä¸¤ç§æƒ…å†µï¼Œå°±æ˜¯åªæœ‰è§†å›¾ç”Ÿæˆå‰äº‹åŠ¡æäº¤äº†çš„æ•°æ®æˆ‘èƒ½çœ‹åˆ°ï¼Œå…¶ä»–çš„æˆ‘éƒ½çœ‹ä¸åˆ°ã€‚ è€Œå½“å‰è¯»ï¼Œæ€»æ˜¯è¯»å–å·²ç»æäº¤å®Œæˆçš„æœ€æ–°ç‰ˆæœ¬ã€‚ã€Œç¬¬ 2 ä¸ªé—®é¢˜å·²ç»è®²äº†è¿™ä¸ªäº†ã€ ä¸Šé¢ä¸€ç›´å¼ºè°ƒçš„ï¼Œå½“å‰è¯»ï¼Œä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°å½“å‰è¯»çš„æƒ…å†µï¼Ÿ é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ï¼Œå½“å‰è¯»ï¼Œå¿…é¡»è¦è¯»çš„æ˜¯è¯¥è¡Œçš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ­¤æ—¶çš„è§†å›¾å¿«ç…§å·²ç»å¤±æ•ˆäº†ï¼Œè€Œä¸”ä½ è¦æƒ³è¯»è¯¥è¡Œçš„æœ€æ–°ç‰ˆæœ¬ï¼Œå°±å¿…é¡»å»åŠ é”ï¼ï¼ï¼ï¼ã€Œæ„æ€å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯ å½“å‰è¯» == ç»™è¯¥è¡ŒåŠ é”ã€ æ‰€ä»¥ï¼Œä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°è¡Œçš„å½“å‰è¯»å‘¢ï¼Ÿé‚£å°±æ˜¯ç»™è¯¥è¡ŒåŠ é”ã€æ‚²è§‚é”ã€äº†ï¼Œé‚£é—®é¢˜å°±è½¬åŒ–æˆäº†ä»€ä¹ˆæ—¶å€™ä¼šç»™è¡ŒåŠ é”å‘¢ï¼Ÿ é‚£è¿™ä¸ªé—®é¢˜å°±éå¸¸ç®€å•äº†ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µä¼šä½¿å¾—å½“å‰è¡ŒåŠ ä¸Šæ‚²è§‚é”ï¼š SELECT â€¦ FROM â€¦ LOCK IN SHARE MODEï¼Œselect çš„æ—¶å€™å¼ºè¡ŒåŠ ä¸Šå…±äº«é”ï¼Œå¦‚æœä¸åŠ å…¶å®å°±æ˜¯é»˜è®¤çš„å¿«ç…§è¯»ï¼› SELECT â€¦ FROM â€¦ FOR UPDATEï¼Œselect çš„æ—¶å€™å¼ºè¡ŒåŠ ä¸Šç‹¬å é”ï¼› UPDATE â€¦ WHERE â€¦ ï¼Œç‹¬å é”ï¼› DELETE FROM â€¦ WHERE â€¦ ï¼Œç‹¬å é”ï¼› INSERT è¯­å¥å°†åœ¨æ’å…¥çš„è®°å½•ä¸ŠåŠ ä¸€æŠŠæ’ä»–é”ã€Œç‹¬å é”ã€ã€‚ å¥½å§ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ select å•¥éƒ½ä¸åŠ ä¼šå¯¼è‡´ä¸ç»™è¡Œé”åŠ æ‚²è§‚é”ï¼Œå…¶ä»–çš„éƒ½ä¼šåŠ çš„ï¼Œæ„å‘³ç€éƒ½æ˜¯è¦å»è¯»å½“å‰å€¼ï¼Œæ„å‘³ç€è¿™ä¸ª rc çº§åˆ«çš„éš”ç¦»å°±æ— æ•ˆäº†ï¼Œä¸è¿‡è¯è¯´å›æ¥ï¼Œäººå®¶ rc æœ¬èº«å°±æ˜¯ å¯é‡å¤è¯» çš„éš”ç¦»çº§åˆ«ï¼Œæœ¬èº«å°±æ˜¯ç”¨äº æ•°æ®ä¿®æ”¹äº†æˆ‘ä¸å»è¯» ã€‚ http://www.fordba.com/locks-set-by-different-sql-statements-in-innodb.html è¿™ç¯‡æ–‡ç« å¯¹ sql è¯­å¥åŠ é”åˆ†æçš„æˆ‘è§‰å¾—æ˜¯æˆ‘çœ‹åˆ°çš„æœ€å¥½çš„äº†ï¼Œå—ç›ŠåŒªæµ…ï¼ ç¬¬ 4 ä¸ªé—®é¢˜ä¸­æåˆ°çš„â€œlock in shared modeâ€ â€œfor updateâ€æ˜¯ä»€ä¹ˆé”ï¼Ÿ è¿™ä¸ªå¾ˆç®€å•å•¦ï¼Œå°±æ˜¯ mysql ä¸­çš„æ‚²è§‚é”ä¸­çš„å…±äº«é”å’Œç‹¬å é”ã€‚ æ—¢ç„¶è°ˆåˆ°é”äº†ï¼Œé‚£ä½ å†å›é¡¾ä¸€ä¸‹ç°åœ¨æ¥è§¦åˆ°çš„æ‰€æœ‰é”å§ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ‹“å±•ä¸€ä¸‹ï¼ å…¶å®ï¼Œä¸Šé¢è®²åˆ°çš„é”éƒ½æ˜¯å¯ä»¥è·Ÿ lock ä½“ç³»å¯¹åº”ä¸Šçš„ï¼Œæ¯”å¦‚è¯´ä¸Šæ–‡çš„ä¹è§‚é”æ‚²è§‚é”ï¼Œå¯¹åº”çš„å°±æ˜¯ lock ä½“ç³»çš„ä¹è§‚é”æ‚²è§‚é”ï¼Œä¹è§‚é”å°±æ˜¯åº•å±‚æ˜¯ CASï¼ŒCAS ä¸­æœ‰ä¸‰ä¸ªå€¼ï¼šå½“å‰å†…å­˜å€¼ã€é¢„è¯»çš„å€¼ã€æƒ³ä¿®æ”¹çš„å€¼ï¼Œå¦‚æœå½“å‰å€¼å’Œé¢„è¯»å€¼ä¸€æ ·ï¼Œæˆ‘å°±é»˜è®¤æ²¡è¢«ä¿®æ”¹è¿‡ï¼Œç›´æ¥ä¿®æ”¹æˆæƒ³ä¿®æ”¹çš„å€¼ï¼Œå½“ç„¶è¿™æ ·ä¼šé€ æˆä¸€ä¸ªé—®é¢˜ï¼šABA é—®é¢˜ï¼Œåœ¨ mysql ä¸­æœ€ä¸»è¦çš„æ–¹æ³•æ˜¯åŠ ä¸€ä¸ª version å­—æ®µï¼Œç”¨ version å­—æ®µå»åˆ¤æ–­æ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼Œåœ¨ lock ä½“ç³»ä¸­ï¼Œæœ€ä¸»è¦çš„æ–¹æ³•æ˜¯åŠ ä¸€ä¸ª stampï¼Œç±»ä¼¼äºæ—¶é—´æˆ³è¿™æ ·çš„ä¸œè¥¿ï¼Œåœ¨ StampedLock é‡Œé¢æœ‰å»ç”¨åˆ°ã€‚å½“ç„¶äº†ï¼ŒCAS è¿˜ä¼šæœ‰å¦å¤–ä¸¤ä¸ªé—®é¢˜ï¼šä¸€ä¸ªæ˜¯è‡ªæ—‹ä¼šé€ æˆcpuèµ„æºçš„æµªè´¹ï¼Œä¸€ä¸ªæ˜¯åªèƒ½ä¿è¯å•ä¸ªå˜é‡çš„åŸå­æ€§ã€Œä½ å¦‚æœæƒ³ä¿è¯å¤šä¸ªçš„è¯å°±ç›´æ¥å†™åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­å°±å®Œäº‹äº†ã€ã€‚ å›åˆ°æ­£é¢˜ï¼Œä¸Šé¢è®²å®Œä¹è§‚é”ï¼Œç°åœ¨è®²è®²æ‚²è§‚é”å§ï¼Œmysql ä¸­çš„ç‹¬å é”å’Œå…±äº«é”å’Œ AQS ä¸­çš„å®Œå…¨ä¸€è‡´ï¼Œè¿™ä¸¤æ€æƒ³ä¹Ÿå®Œå…¨ä¸€æ ·ï¼Œè‡³äº mysql ä¸­å†…éƒ¨å¦‚ä½•å®ç°çš„æˆ‘ä¸å¤ªæ¸…æ¥šï¼Œå› ä¸ºè²Œä¼¼æ˜¯ç”¨ c å†™çš„ï¼Œçœ‹çš„å…´è¶£ä¸å¤§ï¼Œ AQS çš„åº•å±‚æºç æ˜¯æœ‰çœ‹è¿‡çš„ï¼ŒAQS å°±æ˜¯ç”¨çš„æ¨¡æ¿æ–¹æ³•çš„è®¾è®¡æ€æƒ³å˜›ï¼Œå¯¹å¤–æˆ‘ä»¬æƒ³è¦å»å®ç°è¯»å†™é”çš„è¯åªéœ€è¦ç»§æ‰¿å‡ ä¸ªæ–¹æ³•å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚ç‹¬å é” ReentrantLock åªéœ€è¦ç»§æ‰¿ tryacquired()ã€tryRealease()ã€isHeldExclusive()â€¦ã€Œè¯´ä¸å®šä¼šè®©æˆ‘æ‰‹åŠ¨å»å®ç°ä¸€ä¸ªï¼Œè¿™ä¸ªæˆ‘å¾—æ³¨æ„ä¸€ä¸‹ï¼Œæå‰å†™ä¸€ä¸ªï¼Œåˆšæ‰å†™çš„è¿‡ç¨‹ä¸­ï¼Œåˆå‘ç°äº† transient è¿™ä¸ªå…³é”®è¯ï¼ŒçœŸçš„ç‰›çš®ï¼Œè¿™ä¸ªåšå®¢è®²çš„çœŸçš„å¥½ï¼šhttps://juejin.im/post/5dda467051882572f8249f11#heading-10ã€ã€‚ã€‚ã€‚ã€‚æ‡’å¾—è®²äº†ã€‚ã€‚ã€‚ 9. æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œåº”è¯¥å¦‚ä½•é€‰æ‹© åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­ï¼Œæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„æ€§èƒ½åŸºæœ¬ä¸€æ ·ï¼Œä½†æ˜¯åœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè®°å½•ä¸åœ¨å†…å­˜ä¸­ï¼Œé‚£æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„æ€§èƒ½å·®è·å°±å¾ˆå¤§äº†ï¼Œå› ä¸ºæ™®é€šç´¢å¼•å¯ä»¥ä½¿ç”¨ changebufferï¼Œè€Œå”¯ä¸€ç´¢å¼•å› ä¸ºæœ‰å”¯ä¸€æ€§çº¦æŸï¼Œéœ€è¦å°†æ‰€æœ‰æ•°æ®è¯»å…¥åˆ°å†…å­˜ä¸­ï¼Œè¿™æ ·å°±å¤±å»äº† changebuffer çš„æ„ä¹‰ï¼Œæ‰€ä»¥é€Ÿåº¦å¾ˆæ…¢ã€‚ changebufferï¼šå­˜å‚¨ç”¨æˆ·æ›´æ–°çš„è¯­å¥ã€‚åœ¨ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œæ‰å°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œæ‰§è¡Œ change bufferä¸­ä¸è¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œï¼Œæ³¨æ„å“¦ï¼Œchange bufferæ˜¯å¯ä»¥æŒä¹…åŒ–ï¼Œå°†change bufferä¸­çš„æ“ä½œåº”ç”¨åˆ°åŸæ•°æ®é¡µï¼Œå¾—åˆ°æœ€æ–°ç»“æœçš„è¿‡ç¨‹ç§°ä¸ºmergeã€‚é™¤äº†è®¿é—®è¿™ä¸ªæ•°æ®é¡µä¼šè§¦å‘mergeå¤–ï¼Œç³»ç»Ÿæœ‰åå°çº¿ç¨‹ä¼šå®šæœŸmergeã€‚åœ¨æ•°æ®åº“æ­£å¸¸å…³é—­ï¼ˆshutdownï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ‰§è¡Œmergeæ“ä½œã€‚æ˜¾ç„¶ï¼Œå¦‚æœèƒ½å¤Ÿå°†æ›´æ–°æ“ä½œå…ˆè®°å½•åœ¨change bufferï¼Œå‡å°‘è¯»ç£ç›˜ï¼Œè¯­å¥çš„æ‰§è¡Œé€Ÿåº¦ä¼šå¾—åˆ°æ˜æ˜¾çš„æå‡ã€‚è€Œä¸”ï¼Œæ•°æ®è¯»å…¥å†…å­˜æ˜¯éœ€è¦å ç”¨buffer poolçš„ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼è¿˜èƒ½å¤Ÿé¿å…å ç”¨å†…å­˜ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡ã€‚ æ•… changebuffer é€‚åˆå†™å¤šè¯»å°‘çš„åœºæ™¯ï¼Œè¿™æ ·èƒ½æœ€å¤§é™åº¦çš„åŠ å¿«å†™å…¥çš„é€Ÿåº¦ï¼Œæ‰€ä»¥è¯´ changebuffer å¯ä»¥é¿å…å†™å…¥çš„æ—¶å€™éšæœºå»è¯»å–æ•°æ®åˆ°å†…å­˜ä¸­ï¼ŒèŠ‚çœçš„æ˜¯éšæœºè¯»ç£ç›˜çš„ IO æ¶ˆè€—ã€‚ redo log ä¸»è¦èŠ‚çœçš„æ˜¯éšæœºå†™ç£ç›˜çš„IOæ¶ˆè€—ï¼ˆè½¬æˆé¡ºåºå†™ï¼‰ï¼Œè€Œchange bufferä¸»è¦èŠ‚çœçš„åˆ™æ˜¯éšæœºè¯»ç£ç›˜çš„IOæ¶ˆè€—ã€‚ tip: ä¸ºä»€ä¹ˆè¯´ redo log æ˜¯å°†ç£ç›˜çš„éšæœºå†™å˜æˆé¡ºåºå†™ï¼Ÿ å¦‚æœæ²¡æœ‰ redo logï¼Œé‚£ä¹ˆæ¯æ¬¡æ•°æ®æ¥äº†æˆ‘ä»¬éƒ½è¦ç›´æ¥å»è½ç›˜ï¼Œæ¯ä¸€æ¬¡æ•°æ®æˆ‘ä»¬éƒ½éœ€è¦å»è¿›è¡Œç£ç›˜éšæœºè¯»å†™ï¼Œè€Œæœ‰äº† redo logæˆ‘ä»¬å¯ä»¥å…ˆå°†æ•°æ®é¡ºåºç›´æ¥è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ã€Œredo logæ–‡ä»¶çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥å¯ä»¥æ˜¯é¡ºåºå†™ã€ï¼Œç„¶åredo logå†åœ¨ä¹‹åè¿›è¡Œè½ç›˜ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬çš„æ•°æ®å°±æ˜¯ç›¸å½“äºé¡ºåºå†™å…¥ç£ç›˜äº†ã€‚ kafka çš„é¡ºåºå†™å…¶å®å’Œmysql é¡ºåºå†™æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯é‡‡ç”¨äº†æ—¥å¿—ï¼Œkafkaä¸­ä½¿ç”¨ logï¼Œè€Œ mysql ä¸­é‡‡ç”¨ redo-logï¼Œæ•°æ®æ¥äº†å…ˆé¡ºåºè¿½åŠ åˆ°æ—¥å¿—ä¸­ï¼Œæ¯”å¦‚è¯´æ—¥å¿—æ˜¯ 4 gå¤§å°ï¼Œé‚£è¿™ 4 g æ˜¯ä¸€èµ·è½ç›˜çš„ï¼Œæ‰€ä»¥è¯´è¿™4gå°±æ˜¯é¡ºåºå†™å…¥ç£ç›˜çš„ï¼Œå› ä¸ºä»–ä»¬æ˜¯åœ¨ä¸€å—çš„ï¼Œä¸éœ€è¦å¤šæ¬¡ç£ç›˜å¯»å€å†™å…¥ã€‚ è¿™ä¸ªå†™çš„è¿˜å¯ä»¥å§: æµ…æMySQLäº‹åŠ¡ä¸­çš„redoä¸undo 10. Mysql ä¸ºä»€ä¹ˆä¼šé€‰é”™ç´¢å¼• é€‰ç´¢å¼•çš„ä»»åŠ¡ï¼Œæ˜¯äº¤ç»™äº†ä¼˜åŒ–å™¨å»åšçš„ï¼Œè€Œä¼˜åŒ–å™¨é€‰æ‹©ç´¢å¼•çš„æœ€ä¼˜æ–¹æ¡ˆä¸»è¦æ˜¯çœ‹æ‰«æè¡Œæ•°ã€Œé€šè¿‡å–æ ·å»åˆ¤æ–­ï¼Œæ‰€ä»¥è¿™å—å¯èƒ½ä¼šé€ æˆè¯¯å·®ã€ã€ä¸´æ—¶è¡¨å’Œæ’åºç­‰ç­‰ï¼› å¦‚æœé€‰é”™äº†ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥å¼ºåˆ¶ä½¿ç”¨ force indexï¼Œç„¶åå¦‚æœæ›´å¿«çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ explain æ‹¿åˆ° rows çš„å¤§å°ï¼Œç„¶åä½¿ç”¨ analyze table t å‘½ä»¤é‡æ–°ç»Ÿè®¡ç´¢å¼•ä¿¡æ¯ï¼Œè¿™æ ·ä¸‹æ¬¡å°±ä¸ä¼šé€‰é”™äº†ã€‚ 11. æ€ä¹ˆç»™å­—ç¬¦ä¸²åŠ ç´¢å¼• ç›´æ¥åˆ›å»ºå®Œæ•´ç´¢å¼•ï¼Œä½†æ˜¯è¿™æ ·æ¯”è¾ƒå ç”¨ç©ºé—´ï¼› åˆ›å»ºå‰ç¼€ç´¢å¼•ï¼ŒèŠ‚çœç©ºé—´ï¼Œä½†æ˜¯å®¹æ˜“å¯¼è‡´å›è¡¨æ¬¡æ•°å¢å¤šï¼Œå¹¶ä¸”æ— æ³•ä½¿ç”¨èŒƒå›´æŸ¥è¯¢ï¼› å€’åºå­˜å‚¨ï¼Œä¸»è¦ç”¨æ¥è§£å†³å­—ç¬¦ä¸²æœ¬èº«çš„å‰ç¼€åŒºåˆ†åº¦ä¸é«˜ï¼Œä¾‹å¦‚èº«ä»½è¯å·ï¼› åˆ›å»ºhashå­—æ®µç´¢å¼•ï¼ŒæŸ¥è¯¢ç¨³å®šï¼Œä½†æ˜¯ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ŒåŒæ—¶å› ä¸ºè¦é¢å¤–å¢åŠ å­—æ®µå’Œç´¢å¼•ï¼Œæ¶ˆè€—èµ„æºã€‚ 12. ä¸ºä»€ä¹ˆ Mysql ä¼š â€æŠ–â€œ ä¸€ä¸‹ï¼Ÿæˆ‘ä»¬åœ¨ç¬¬ 9 èŠ‚çš„å†…å®¹å…¶å®è·Ÿè¿™èŠ‚ä¹Ÿæœ‰ç‚¹å…³ç³»ï¼Œå› ä¸ºéƒ½æ˜¯æœ‰å…³äº redo logï¼Œæˆ‘ä»¬åœ¨ç¬¬ 9 èŠ‚è°ˆåˆ°ï¼Œredo logçš„å‡ºç°ï¼Œå°†æˆ‘ä»¬éšæœºå†™ç£ç›˜å˜ä¸ºäº†é¡ºåºå†™ç£ç›˜ã€Œå½“ç„¶ redo logè¿˜æœ‰crash-safeçš„åŠŸèƒ½ã€ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸€ç›´æ²¡æœ‰å»è°ˆå†™å®Œ redo logä¹‹åæ•°æ®ï¼Œå€Ÿæ­¤æœºä¼šï¼Œæˆ‘è¿˜æ˜¯å¸Œæœ›èƒ½å¤Ÿå¥½å¥½åœ°å›é¡¾ä¸€ä¸‹æ•´ä¸ªæ•°æ®åº“æ›´æ–°çš„è¿‡ç¨‹ã€‚ å‰æï¼šå‡è®¾æˆ‘è¦å°† id = 2 ä¸­çš„ c ï¼‹ 1 ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š æˆ‘ä»¬æ¥ç»†è‡´åˆ†æä¸€ä¸‹åœ¨ å†™å…¥ redo logï¼Œå’Œæäº¤äº‹åŠ¡åˆ†åˆ«å‘ç”Ÿäº†ä»€ä¹ˆã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œredo log åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šredo log buffer å’Œ redo log fileï¼Œä¸€ä¸ªæ˜¯åœ¨å†…å­˜ä¸­ï¼Œä¸€ä¸ªæ˜¯åœ¨ç£ç›˜ä¸­ï¼Œåœ¨å†™å…¥ redo log çš„æ—¶å€™ï¼Œæ˜¯å…ˆå°†æ•°æ®å†™è‡³ redo log bufferï¼Œç„¶åå†å°† redo log buffer ä¸­çš„æ•°æ®é¡ºåºå†™å…¥åˆ°redo log fileï¼Œå†™å®Œåå¤„äº prepare çŠ¶æ€ï¼Œåœ¨æäº¤äº‹åŠ¡ä¹‹å‰ï¼Œå°±å·²ç»å°† binlog å†™å…¥æ–‡ä»¶äº†ï¼Œæ‰€ä»¥å½“æäº¤äº‹åŠ¡çš„æ—¶å€™ï¼Œredo log å’Œ binlog å…¨éƒ¨æŒä¹…åŒ–ã€‚ ç°åœ¨å›åˆ°æ ‡é¢˜çš„é—®é¢˜ã€‚ ä»€ä¹ˆå«â€æŠ–â€œä¸€ä¸‹ï¼Ÿ ä¸€æ¡SQLè¯­å¥ï¼Œæ­£å¸¸æ‰§è¡Œçš„æ—¶å€™ç‰¹åˆ«å¿«ï¼Œä½†æ˜¯æœ‰æ—¶ä¹Ÿä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œå®ƒå°±ä¼šå˜å¾—ç‰¹åˆ«æ…¢ï¼Œå¹¶ä¸”è¿™æ ·çš„åœºæ™¯å¾ˆéš¾å¤ç°ï¼Œå®ƒä¸åªéšæœºï¼Œè€Œä¸”æŒç»­æ—¶é—´è¿˜å¾ˆçŸ­ã€‚å¯ä»¥è®¤ä¸ºæ˜¯â€æŠ–â€œäº†ä¸€ä¸‹ã€‚ ä¸ºä»€ä¹ˆ Mysql ä¼šç»å¸¸æŠ–ä¸€ä¸‹ï¼Ÿ æ ¹æœ¬åŸå› æ˜¯æ•°æ®åº“æ­¤æ—¶åœ¨å¤§é‡åˆ·è„é¡µ ä»€ä¹ˆæ˜¯è„é¡µï¼Ÿ å†…å­˜é¡µä¸ç£ç›˜é¡µä¸ä¸€è‡´çš„é¡µç§°ä¸ºè„é¡µ ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ·è„é¡µï¼Ÿ redo log æ»¡äº†ï¼Œéœ€è¦å°†è„é¡µè½ç›˜ï¼› å†…å­˜ä¸­ buffer pool æ»¡äº†ï¼Œéœ€è¦å°†è„é¡µè½ç›˜ï¼Œå˜æˆå¹²å‡€é¡µï¼› Mysql ç©ºé—²ï¼Œåå°è¿›è¡Œåˆ·è„é¡µï¼› Mysql æ­£å¸¸å…³é—­å‰ï¼Œè¿›è¡Œåˆ·è„é¡µã€‚ è¿™å››ç§æƒ…å†µçš„åˆ·è„é¡µï¼Œå¯¹ç³»ç»Ÿå½±å“å¦‚ä½•ï¼Ÿ redo log å†™æ»¡å†åˆ·è„é¡µï¼Œå¯¹ç³»ç»Ÿå½±å“å¾ˆå¤§ï¼Œå› ä¸ºæ­¤æ—¶ç³»ç»Ÿä¸èƒ½è¿›è¡Œæ›´æ–°äº†ï¼Œä¼šé˜»å¡ï¼› buffer pool æ»¡äº†åˆ·è„é¡µï¼Œæ˜¯å¾ˆå¸¸è§çš„ï¼Œä½†æ˜¯å¦‚æœè„é¡µå¤šäº†ï¼Œæ¸…ç†èµ·æ¥å¾ˆæ…¢ï¼› Mysql ç©ºé—²æ—¶åˆ·è„é¡µï¼Œå¯¹ç³»ç»Ÿä¸ä¼šæœ‰å•¥æ€§èƒ½ä¸Šçš„å½±å“ï¼› Mysql æ­£å¸¸å…³é—­å‰åˆ·è„é¡µåŒæ ·å¯¹ç³»ç»Ÿä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ã€‚ é‚£åº”è¯¥å¦‚ä½•é¿å…åˆ·è„é¡µå¸¦æ¥çš„æ€§èƒ½å½±å“å‘¢ï¼Ÿ æ§åˆ¶è„é¡µæ¯”ä¾‹ï¼Œåˆ·ç›˜é€Ÿåº¦ä¸èƒ½è¿‡æ…¢ï¼Œå¯ä»¥é€šè¿‡ inno_io_capacityæ¥æ§åˆ¶é€Ÿåº¦ï¼Œå½“ç„¶è¿‡å¿«ä¹Ÿæ²¡æœ‰å¿…è¦ï¼Œå› ä¸ºè¿™æ ·åŠ¿å¿…ä¼šæ¶ˆè€—æ›´å¤šçš„èµ„æºå¯¼è‡´ç”¨æˆ·ä½¿ç”¨èµ„æºå˜å°‘äº†ã€‚ æ€»ç»“ï¼šè™½ç„¶ redo log å¯ä»¥å¸¦æ¥ crash-safe å’Œå°†éšæœºå†™å˜ä¸ºé¡ºåºå†™è¿™ä¸¤å¤§åŠŸèƒ½ï¼Œä½†æ˜¯å…¶ä¹Ÿå¸¦æ¥äº†å†…å­˜è„é¡µçš„é—®é¢˜ã€‚ 13. ä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜ è¡¨ç©ºæ´é—®é¢˜ delete å‘½ä»¤åˆ é™¤è¡Œæ˜¯ä¸èƒ½å›æ”¶è¡¨ç©ºé—´çš„ï¼Œåªæ˜¯å½“å‰é¡µè¢«æ ‡è®°ä¸ºâ€å¯å¤ç”¨â€œï¼Œä¾‹å¦‚300 400 500ï¼Œåˆ é™¤äº†400ä¹‹åï¼Œ400è¿™ä¸ªæ•°æ®é¡µå°±å¯ä»¥è¢«å¤ç”¨ï¼Œæ¯”å¦‚ 401 å°±å¯ä»¥æ’å…¥åˆ°å…¶ä¸­ï¼Œä½†æ˜¯å¦‚æœä¸‹ä¸€ä¸ªæ˜¯ 800ï¼Œé‚£ 400 è¿™ä¸ªæ•°æ®é¡µå°±åªèƒ½è¢«æµªè´¹äº†ï¼Œæˆä¸ºç©ºæ´ã€‚ ä¸æ­¢æ˜¯åˆ é™¤æ•°æ®ä¼šå¯¼è‡´ç©ºæ´ï¼Œæ’å…¥æ•°æ®ä¹Ÿä¼šã€‚å½“éšæœºæ’å…¥æ•°æ®æ—¶ï¼Œä¼šé€ æˆç´¢å¼•çš„æ•°æ®é¡µåˆ†è£‚ã€‚ä¾‹å¦‚å½“ 300 500 600æ˜¯ä¸€é¡µçš„æ—¶å€™ï¼Œæ­¤æ—¶æ¥äº†ä¸ª 550ï¼Œé‚£ä¹ˆå°±ä¸å¾—ä¸ç”³è¯·ä¸€ä¸ªæ–°çš„é¡µé¢æ¥ä¿å­˜æ•°æ®äº†ï¼Œæ­¤æ—¶ 550 ä¼šåœ¨æ–°çš„æ•°æ®é¡µä¸­ï¼Œè€Œ 600 ç´§éšå…¶åï¼Œæ­¤æ—¶åŸæ¥çš„é¡µå°±åªå‰©ä¸‹äº† 300 500 äº†ï¼Œè¿™æ ·å°±é€ æˆäº†æ•°æ®é¡µç©ºæ´ã€‚ã€Œè¿™ä¹Ÿæ˜¯ç£ç›˜æŒ‰é¡µåˆ†é…æŒ‰é¡µé¢„è¯»çš„åå¤„å§..ã€ å¦‚ä½•è§£å†³è¡¨ç©ºæ´é—®é¢˜ï¼Ÿ é‡å»ºè¡¨ã€‚ä¾‹å¦‚è¡¨ A å­˜åœ¨ç©ºæ´æƒ…å†µï¼Œå¯ä»¥æ–°å»ºä¸€ä¸ªä¸è¡¨ A ç»“æ„ç›¸åŒçš„è¡¨ Bï¼Œç„¶åæŒ‰ç…§ä¸»é”® ID é€’å¢çš„é¡ºåºå°†æ•°æ®ä¸€è¡Œä¸€è¡Œçš„æ’å…¥åˆ° B ä¸­ï¼Œä¹Ÿå°±æ˜¯å°† B å˜æˆä¸´æ—¶è¡¨ï¼Œæœ€åå°† A æ›¿æ¢å³å¯ã€‚ ç›´æ¥ä½¿ç”¨ â€œalter table A engine=InnoDBâ€å³å¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆè½¬å­˜æ•°æ®ã€äº¤æ¢è¡¨åã€åˆ é™¤æ—§è¡¨çš„æ“ä½œï¼Œè€Œå…¶ä¸­æœ€æ…¢çš„æ­¥éª¤å°±æ˜¯å¾€ä¸´æ—¶è¡¨æ’å…¥æ•°æ®çš„è¿‡ç¨‹ï¼Œåœ¨ MySQL 5.6ç‰ˆæœ¬ä¹‹å‰ï¼Œä¸èƒ½ä¸€è¾¹å¾€ä¸´æ—¶è¡¨æ’å…¥æ•°æ®ä¸€è¾¹å¯¹åŸè¡¨ A è¿›è¡Œæ›´æ–°ï¼Œä½†æ˜¯åœ¨ MySQL 5.6 ä¹‹åï¼Œå¯ä»¥è¿›è¡Œ Online DDLã€‚ Online DDL çš„æµç¨‹ï¼Ÿ å»ºç«‹ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œæ‰«æ A ä¸»é”®çš„æ‰€æœ‰æ•°æ®é¡µï¼› ç”¨æ•°æ®é¡µä¸­è¡¨ A çš„è®°å½•ç”Ÿæˆ B+ æ ‘ï¼Œå­˜å‚¨åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼› ç”Ÿæˆä¸´æ—¶æ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ‰€æœ‰å¯¹ A çš„æ“ä½œè®°å½•åœ¨ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¯¹åº”çš„æ˜¯å›¾ä¸­ state2 çš„çŠ¶æ€ï¼› ä¸´æ—¶æ–‡ä»¶ç”Ÿæˆåï¼Œå°†æ—¥å¿—æ–‡ä»¶ä¸­çš„æ“ä½œåº”ç”¨åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œå¾—åˆ°ä¸€ä¸ªé€»è¾‘æ•°æ®ä¸Šå’Œ A ç›¸åŒçš„æ•°æ®æ–‡ä»¶ï¼Œå¯¹åº”çš„å°±æ˜¯ state3 çš„çŠ¶æ€ï¼› ç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢ A çš„æ•°æ®æ–‡ä»¶ã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯ç”¨äº†ä¸€ä¸ª row log æ¥ä¿è¯ Online çš„ã€‚ optimize tableã€analyze tableã€alter tableè¿™ä¸‰ç§é‡å»ºè¡¨çš„åŒºåˆ« Alter table å°±æ˜¯ä¸Šé¢çš„æ­¥éª¤å•¦ï¼Œè½¬å­˜æ•°æ®ã€äº¤æ¢è¡¨åã€åˆ é™¤æ—§è¡¨ï¼› analyze table å…¶å®ä¸æ˜¯é‡å»ºè¡¨ï¼Œåªæ˜¯å¯¹è¡¨çš„ç´¢å¼•ä¿¡æ¯åšä¸€ä¸ªé‡æ–°ç»Ÿè®¡ï¼Œæ²¡æœ‰ä¿®æ”¹æ•°æ®ï¼Œæ¯”å¦‚ä¹‹å‰ä¿®æ”¹ä¼˜åŒ–å™¨ç»Ÿè®¡çš„éå†çš„ row æ•°ï¼› optimize table ç­‰äº recreate + analyze 14. count è¿™ä¹ˆæ…¢ï¼Œæˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿ ä¸ºä»€ä¹ˆ InnoDB ä¸åƒ MyISAM ä¸€æ ·ï¼Œä¸“é—¨æ¥è®°å½• count å€¼ï¼Ÿ å› ä¸º InnoDB çš„éš”ç¦»çº§åˆ«æ˜¯ rr çº§åˆ«ï¼Œå¯é‡å¤è¯»ï¼Œæ‰€ä»¥åœ¨ä¸åŒäº‹åŠ¡ä¸‹ï¼Œç”±äºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶çš„åŸå› ï¼ˆMVCCï¼‰ï¼Œæ¯ä¸€è¡Œè®°å½•éƒ½è¦åˆ¤æ–­è‡ªå·±æ˜¯å¦å¯¹è¿™ä¸ªä¼šè¯å¯ç°ï¼Œå› æ­¤å¯¹äº count(*) æ¥è¯´ï¼Œåªå¥½æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œçš„è¯»å‡ºå¹¶è¿›è¡Œåˆ¤æ–­ã€‚ é‚£è¿™ç§æ–¹æ³•å¤ªè ¢äº†ï¼Œæ²¡æœ‰ä¼˜åŒ–å—ï¼Ÿ ä½ éƒ½çŸ¥é“è ¢äº†ï¼Œå½“ç„¶å°±æœ‰ä¼˜åŒ–å•Šï¼Œä½ æƒ³æƒ³ï¼ŒInnoDB æ˜¯ç´¢å¼•ç»„ç»‡è¡¨ï¼Œä¸»é”®ç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯æ•°æ®ï¼Œè€Œæ™®é€šç´¢å¼•æ ‘ä¸Šçš„å¶å­ç»“ç‚¹åˆ™æ˜¯ä¸»é”®å€¼ï¼Œæ‰€ä»¥æ™®é€šç´¢å¼•æ ‘æ¯”ä¸»é”®ç´¢å¼•æ ‘è‚¯å®šè¦å°å¾ˆå¤šï¼Œè€Œä¸ç®¡éå†å“ªä¸ªç´¢å¼•æ ‘å…¶å®ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ Mysql ä¼šæ‰¾åˆ°æœ€å°çš„é‚£æ£µæ ‘è¿›è¡Œéå†ã€‚ åœ¨ä¿è¯é€»è¾‘æ­£ç¡®çš„å‰æä¸‹ï¼Œå°½é‡å‡å°‘æ‰«æçš„æ•°æ®é‡ï¼Œæ˜¯æ•°æ®åº“è®¾è®¡çš„é€šç”¨æ³•åˆ™ä¹‹ä¸€ã€‚ é‚£æˆ‘ä»¬ä¹‹å‰åœ¨ç¬¬ 10 èŠ‚è°ˆåˆ°çš„ â€show table statusâ€œ å‘½ä»¤ä¸­çš„ row numbers èƒ½ç”¨å—ï¼Ÿ å½“ç„¶ä¸èƒ½å•Šï¼Œé‚£åªæ˜¯ä¸€ä¸ªé¢„ä¼°å€¼ï¼Œå®˜æ–¹è¯´è¿™ä¸ªè¯¯å·®å¯ä»¥è¾¾åˆ° 40% ï¼Œæ‰€ä»¥è‚¯å®šä¸è¡Œå•Šã€‚ é‚£å¦‚æœæˆ‘æœ‰ä¸€ä¸ªæ€»æ˜¯è¦ç»Ÿæ€»æ•°çš„ä¸šåŠ¡ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ æå‡ºè¿™ä¸ªé—®é¢˜ï¼Œè¯´æ˜ä½ è‚¯å®šè§‰å¾—ä¼˜åŒ–åçš„æ–¹æ³•ä¾æ—§å¾ˆæ…¢ï¼Œæ˜¯çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½è‡ªå·±å»æ“ä½œã€‚ æŠŠ count è¿™ä¸ªè®¡æ•°ç›´æ¥æ”¾åˆ°æ•°æ®åº“é‡Œå•ç‹¬çš„ä¸€å¼ è®¡æ•°è¡¨ C ä¸­ï¼Œä¸€æ˜¯è§£å†³äº†å´©æºƒä¸¢å¤±çš„é—®é¢˜ï¼Œå› ä¸ºInnoDBæ”¯æŒå´©æºƒæ¢å¤ï¼ŒäºŒæ˜¯è§£å†³äº†äº‹åŠ¡å¯¼è‡´çš„æ— æ³•ç²¾ç¡®ç»Ÿè®¡countçš„é—®é¢˜ï¼Œç›´æ¥å°†è¡¨Cä¸­çš„è®¡æ•°å€¼è¿™ä¸ªæ“ä½œä¹ŸåŠ å…¥åˆ°äº‹åŠ¡ä¸­å°±å¾ˆokayäº†ã€‚ count(å­—æ®µ)ã€count(ä¸»é”®id)ã€count(1)ã€count(*)çš„åŒºåˆ« count(*)ã€count(ä¸»é”®id)å’Œcount(1) éƒ½è¡¨ç¤ºè¿”å›æ»¡è¶³æ¡ä»¶çš„ç»“æœé›†çš„æ€»è¡Œæ•°ï¼›è€Œcount(å­—æ®µï¼‰ï¼Œåˆ™è¡¨ç¤ºè¿”å›æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œé‡Œé¢ï¼Œå‚æ•°â€œå­—æ®µâ€ä¸ä¸ºNULLçš„æ€»ä¸ªæ•°ã€‚ è‡³äºåˆ†ææ€§èƒ½å·®åˆ«çš„æ—¶å€™ï¼Œä½ å¯ä»¥è®°ä½è¿™ä¹ˆå‡ ä¸ªåŸåˆ™ï¼š serverå±‚è¦ä»€ä¹ˆå°±ç»™ä»€ä¹ˆï¼› InnoDBåªç»™å¿…è¦çš„å€¼ï¼› ç°åœ¨çš„ä¼˜åŒ–å™¨åªä¼˜åŒ–äº†count(*)çš„è¯­ä¹‰ä¸ºâ€œå–è¡Œæ•°â€ï¼Œå…¶ä»–â€œæ˜¾è€Œæ˜“è§â€çš„ä¼˜åŒ–å¹¶æ²¡æœ‰åšã€‚ è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€ä¸ªä¸ªåœ°æ¥çœ‹çœ‹ã€‚ å¯¹äºcount(ä¸»é”®id)æ¥è¯´ï¼ŒInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œçš„idå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™serverå±‚ã€‚serverå±‚æ‹¿åˆ°idåï¼Œåˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºç©ºçš„ï¼Œå°±æŒ‰è¡Œç´¯åŠ ã€‚ å¯¹äºcount(1)æ¥è¯´ï¼ŒInnoDBå¼•æ“éå†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚serverå±‚å¯¹äºè¿”å›çš„æ¯ä¸€è¡Œï¼Œæ”¾ä¸€ä¸ªæ•°å­—â€œ1â€è¿›å»ï¼Œåˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºç©ºçš„ï¼ŒæŒ‰è¡Œç´¯åŠ ã€‚ å•çœ‹è¿™ä¸¤ä¸ªç”¨æ³•çš„å·®åˆ«çš„è¯ï¼Œä½ èƒ½å¯¹æ¯”å‡ºæ¥ï¼Œcount(1)æ‰§è¡Œå¾—è¦æ¯”count(ä¸»é”®id)å¿«ã€‚å› ä¸ºä»å¼•æ“è¿”å›idä¼šæ¶‰åŠåˆ°è§£ææ•°æ®è¡Œï¼Œä»¥åŠæ‹·è´å­—æ®µå€¼çš„æ“ä½œã€‚ å¯¹äºcount(å­—æ®µ)æ¥è¯´ï¼š å¦‚æœè¿™ä¸ªâ€œå­—æ®µâ€æ˜¯å®šä¹‰ä¸ºnot nullçš„è¯ï¼Œä¸€è¡Œè¡Œåœ°ä»è®°å½•é‡Œé¢è¯»å‡ºè¿™ä¸ªå­—æ®µï¼Œåˆ¤æ–­ä¸èƒ½ä¸ºnullï¼ŒæŒ‰è¡Œç´¯åŠ ï¼› å¦‚æœè¿™ä¸ªâ€œå­—æ®µâ€å®šä¹‰å…è®¸ä¸ºnullï¼Œé‚£ä¹ˆæ‰§è¡Œçš„æ—¶å€™ï¼Œåˆ¤æ–­åˆ°æœ‰å¯èƒ½æ˜¯nullï¼Œè¿˜è¦æŠŠå€¼å–å‡ºæ¥å†åˆ¤æ–­ä¸€ä¸‹ï¼Œä¸æ˜¯nullæ‰ç´¯åŠ ã€‚ ä¹Ÿå°±æ˜¯å‰é¢çš„ç¬¬ä¸€æ¡åŸåˆ™ï¼Œserverå±‚è¦ä»€ä¹ˆå­—æ®µï¼ŒInnoDBå°±è¿”å›ä»€ä¹ˆå­—æ®µã€‚ ä½†æ˜¯count(*)æ˜¯ä¾‹å¤–ï¼Œå¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ã€‚count(*)è‚¯å®šä¸æ˜¯nullï¼ŒæŒ‰è¡Œç´¯åŠ ã€‚ çœ‹åˆ°è¿™é‡Œï¼Œä½ ä¸€å®šä¼šè¯´ï¼Œä¼˜åŒ–å™¨å°±ä¸èƒ½è‡ªå·±åˆ¤æ–­ä¸€ä¸‹å—ï¼Œä¸»é”®idè‚¯å®šéç©ºå•Šï¼Œä¸ºä»€ä¹ˆä¸èƒ½æŒ‰ç…§count(*)æ¥å¤„ç†ï¼Œå¤šä¹ˆç®€å•çš„ä¼˜åŒ–å•Šã€‚ å½“ç„¶ï¼ŒMySQLä¸“é—¨é’ˆå¯¹è¿™ä¸ªè¯­å¥è¿›è¡Œä¼˜åŒ–ï¼Œä¹Ÿä¸æ˜¯ä¸å¯ä»¥ã€‚ä½†æ˜¯è¿™ç§éœ€è¦ä¸“é—¨ä¼˜åŒ–çš„æƒ…å†µå¤ªå¤šäº†ï¼Œè€Œä¸”MySQLå·²ç»ä¼˜åŒ–è¿‡count(*)äº†ï¼Œä½ ç›´æ¥ä½¿ç”¨è¿™ç§ç”¨æ³•å°±å¯ä»¥äº†ã€‚ æ‰€ä»¥ç»“è®ºæ˜¯ï¼šæŒ‰ç…§æ•ˆç‡æ’åºçš„è¯ï¼Œcount(å­—æ®µ)&lt;count(ä¸»é”®id)&lt;count(1)â‰ˆcount(*)ï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä½ ï¼Œå°½é‡ä½¿ç”¨count(*)ã€‚ 15. æ—¥å¿—å’Œç´¢å¼•ç›¸å…³é—®é¢˜åœ¨ç¬¬ 2 è®²ä¸­ï¼Œæœ‰æåˆ° redo log å’Œ binlog çš„ä¸¤é˜¶æ®µæäº¤ï¼Œè¿™ä¹Ÿæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸ç”¨çš„æ‰‹æ®µã€‚ å…¶ä¸­ï¼Œæ—¶åˆ» A å¦‚æœ crash äº†ï¼Œæ­¤æ—¶è¿˜æ²¡å†™ binlogï¼Œæ‰€ä»¥å´©æºƒæ¢å¤è‚¯å®šå°±å°† redo log ä¸­çš„æ•°æ®è¿›è¡Œå›æ»šå°±è¡Œäº†ï¼Œæ—¶åˆ» B æƒ…å†µï¼Œä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™æœ‰ä¸‰ç§æƒ…å†µï¼š binlog å†™å®Œäº†å¹¶ä¸”redo log å·²ç»æœ‰äº† commit æ ‡å¿—ï¼Œé‚£è¿™ä¸ªæ—¶å€™è‚¯å®šå°±ç›´æ¥æäº¤å°±å¥½äº†ï¼› binlog æ²¡å†™å®Œï¼Œredo log æ­¤æ—¶åªæœ‰ prepare æ ‡å¿—ï¼Œé‚£è¿™ä¸ªæ—¶å€™è‚¯å®šå¾—å›æ»šäº†ï¼Œå› ä¸ºbinlogæ²¡å†™å®Œï¼› binlogæœ‰å†™å®Œäº†çš„æ ‡å¿—ï¼Œä½†æ˜¯ redo log æ­¤æ—¶åªæœ‰ prepare æ ‡å¿—ï¼Œæ²¡é—®é¢˜ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥ç›´æ¥æäº¤ã€‚ è¿½é—®ï¼š binlog å¦‚ä½•åˆ¤æ–­å†™å®Œäº†ï¼Ÿ ä¸€ä¸ªäº‹åŠ¡çš„binlogæ˜¯æœ‰å®Œæ•´æ ¼å¼çš„ï¼š statementæ ¼å¼çš„binlogï¼Œæœ€åä¼šæœ‰COMMITï¼› rowæ ¼å¼çš„binlogï¼Œæœ€åä¼šæœ‰ä¸€ä¸ªXID eventã€‚ redo log å¦‚ä½•çŸ¥æ™“binlog å†™å®Œäº†ï¼Œç„¶åå°†çŠ¶æ€ä» prepare å˜ä¸º commitï¼Œåˆæ˜¯å¦‚ä½•æ‰«æ prepare or commit æ ‡å¿—ï¼Œç„¶åæäº¤çš„å‘¢ï¼Ÿ å®ƒä»¬æœ‰ä¸€ä¸ªå…±åŒçš„æ•°æ®å­—æ®µï¼Œå«XIDã€‚binlog å†™å®Œåï¼Œæœ‰ç›¸åº”çš„é€šçŸ¥æœºåˆ¶ï¼Œæ­¤æ—¶redo log å¯¹åº”çš„ XID çŠ¶æ€å˜åŒ–ã€‚ å´©æºƒæ¢å¤çš„æ—¶å€™ï¼Œä¼šæŒ‰é¡ºåºæ‰«æredo logï¼š å¦‚æœç¢°åˆ°æ—¢æœ‰prepareã€åˆæœ‰commitçš„redo logï¼Œå°±ç›´æ¥æäº¤ï¼› å¦‚æœç¢°åˆ°åªæœ‰parepareã€è€Œæ²¡æœ‰commitçš„redo logï¼Œå°±æ‹¿ç€XIDå»binlogæ‰¾å¯¹åº”çš„äº‹åŠ¡ã€‚ åªè¦binlogä¸å¯ä»¥å—ï¼Œä¹Ÿå¯ä»¥æä¾›é¡ºåºå†™ç£ç›˜çš„åŠŸèƒ½ï¼Œå¦‚æœ binlog ä¹ŸåŠ ä¸€ä¸ª crash-safe çš„åŠŸèƒ½ï¼Œé‚£ä¸æ˜¯æ—¢èƒ½å½’æ¡£ï¼Œåˆèƒ½å´©æºƒæ¢å¤å—ï¼Ÿ binlogå­˜å‚¨çš„æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè€Œä¸”å¹¶æ²¡æœ‰æ ‡è®°è¯»åˆ°å“ªäº†ï¼Œå¹¶ä¸èƒ½è®°å½•æ•°æ®é¡µçš„æ›´æ”¹ï¼Œæ‰€ä»¥ä¸èƒ½åšåˆ°å´©æºƒæ¢å¤ã€‚ é‚£èƒ½ä¸èƒ½åªè¦ redo logï¼Œä¸è¦ binlogï¼Ÿ ä»é€»è¾‘ä¸Šå¯ä»¥ï¼Œå› ä¸º redo log é™¤äº†ä¸èƒ½å½’æ¡£ï¼Œå…¶ä»–éƒ½èƒ½åšã€‚ ä½†æ˜¯ï¼Œå¦‚æœä½ äº†è§£ä¸€ä¸‹ä¸šç•Œå„ä¸ªå…¬å¸çš„ä½¿ç”¨åœºæ™¯çš„è¯ï¼Œå°±ä¼šå‘ç°åœ¨æ­£å¼çš„ç”Ÿäº§åº“ä¸Šï¼Œbinlogéƒ½æ˜¯å¼€ç€çš„ã€‚å› ä¸ºbinlogæœ‰ç€redo logæ— æ³•æ›¿ä»£çš„åŠŸèƒ½ã€‚ ä¸€ä¸ªæ˜¯å½’æ¡£ã€‚redo logæ˜¯å¾ªç¯å†™ï¼Œå†™åˆ°æœ«å°¾æ˜¯è¦å›åˆ°å¼€å¤´ç»§ç»­å†™çš„ã€‚è¿™æ ·å†å²æ—¥å¿—æ²¡æ³•ä¿ç•™ï¼Œredo logä¹Ÿå°±èµ·ä¸åˆ°å½’æ¡£çš„ä½œç”¨ã€‚ ä¸€ä¸ªå°±æ˜¯MySQLç³»ç»Ÿä¾èµ–äºbinlogã€‚binlogä½œä¸ºMySQLä¸€å¼€å§‹å°±æœ‰çš„åŠŸèƒ½ï¼Œè¢«ç”¨åœ¨äº†å¾ˆå¤šåœ°æ–¹ã€‚å…¶ä¸­ï¼ŒMySQLç³»ç»Ÿé«˜å¯ç”¨çš„åŸºç¡€ï¼Œå°±æ˜¯binlogå¤åˆ¶ã€‚ è¿˜æœ‰å¾ˆå¤šå…¬å¸æœ‰å¼‚æ„ç³»ç»Ÿï¼ˆæ¯”å¦‚ä¸€äº›æ•°æ®åˆ†æç³»ç»Ÿï¼‰ï¼Œè¿™äº›ç³»ç»Ÿå°±é æ¶ˆè´¹MySQLçš„binlogæ¥æ›´æ–°è‡ªå·±çš„æ•°æ®ã€‚å…³æ‰binlogçš„è¯ï¼Œè¿™äº›ä¸‹æ¸¸ç³»ç»Ÿå°±æ²¡æ³•è¾“å…¥äº†ã€‚ æ€»ä¹‹ï¼Œç”±äºç°åœ¨åŒ…æ‹¬MySQLé«˜å¯ç”¨åœ¨å†…çš„å¾ˆå¤šç³»ç»Ÿæœºåˆ¶éƒ½ä¾èµ–äºbinlogï¼Œæ‰€ä»¥â€œé¸ å é¹Šå·¢â€redo logè¿˜åšä¸åˆ°ã€‚ä½ çœ‹ï¼Œå‘å±•ç”Ÿæ€æ˜¯å¤šä¹ˆé‡è¦ã€‚ æ•°æ®çš„æœ€ç»ˆè½ç›˜ï¼Œæ˜¯ä» redo logæ›´æ–°çš„è¿˜æ˜¯ä» buffer pool æ›´æ–°çš„å‘¢ï¼Ÿ å®é™…ä¸Šï¼Œredo logå¹¶æ²¡æœ‰è®°å½•æ•°æ®é¡µçš„å®Œæ•´æ•°æ®ï¼Œæ‰€ä»¥å®ƒå¹¶æ²¡æœ‰èƒ½åŠ›è‡ªå·±å»æ›´æ–°ç£ç›˜æ•°æ®é¡µï¼Œä¹Ÿå°±ä¸å­˜åœ¨â€œæ•°æ®æœ€ç»ˆè½ç›˜ï¼Œæ˜¯ç”±redo logæ›´æ–°è¿‡å»â€çš„æƒ…å†µã€‚ å¦‚æœæ˜¯æ­£å¸¸è¿è¡Œçš„å®ä¾‹çš„è¯ï¼Œæ•°æ®é¡µè¢«ä¿®æ”¹ä»¥åï¼Œè·Ÿç£ç›˜çš„æ•°æ®é¡µä¸ä¸€è‡´ï¼Œç§°ä¸ºè„é¡µã€‚æœ€ç»ˆæ•°æ®è½ç›˜ï¼Œå°±æ˜¯æŠŠå†…å­˜ä¸­çš„æ•°æ®é¡µå†™ç›˜ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œç”šè‡³ä¸redo logæ¯«æ— å…³ç³»ã€‚ åœ¨å´©æºƒæ¢å¤åœºæ™¯ä¸­ï¼ŒInnoDBå¦‚æœåˆ¤æ–­åˆ°ä¸€ä¸ªæ•°æ®é¡µå¯èƒ½åœ¨å´©æºƒæ¢å¤çš„æ—¶å€™ä¸¢å¤±äº†æ›´æ–°ï¼Œå°±ä¼šå°†å®ƒè¯»åˆ°å†…å­˜ï¼Œç„¶åè®©redo logæ›´æ–°å†…å­˜å†…å®¹ã€‚æ›´æ–°å®Œæˆåï¼Œå†…å­˜é¡µå˜æˆè„é¡µï¼Œå°±å›åˆ°äº†ç¬¬ä¸€ç§æƒ…å†µçš„çŠ¶æ€ã€‚ åœ¨æˆ‘ä»¬ç¬¬ 12 è®²çš„ï¼Œå¦‚æœ redo log æ»¡äº†ï¼Œä¹Ÿæ˜¯è¦åˆ·è„é¡µçš„ï¼Œæ­¤æ—¶ä¼šå°† redo logå¯¹åº”çš„å†…å­˜ä¸­çš„è„é¡µåˆ·å…¥ç£ç›˜ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œå…¶å® redo log å°±æ˜¯ä¸€ä¸ªä¸­é—´è€…ï¼Œæ¯”å¦‚10 åˆ° 19ï¼Œredo log åªæ˜¯è®°å½•çš„ +9ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯ä»buffer pool ä¸­æ›´æ–°çš„æ•°æ®ã€‚ redo log buffer æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å…ˆä¿®æ”¹å†…å­˜ï¼Œè¿˜æ˜¯å…ˆå†™ redo log æ–‡ä»¶ï¼Ÿ Redo log æ˜¯åˆ†ä¸ºä¸¤å—çš„ï¼šä¸€å—å°±æ˜¯ redo log bufferï¼Œä¸€å—å°±æ˜¯ redo log æ–‡ä»¶ï¼Œæ­£å¸¸è‚¯å®šæ˜¯å…ˆåˆ°ç¼“å­˜ï¼Œå†åˆ°æ–‡ä»¶ä¸­å•¦ã€‚è¿™é‡Œçš„å†™æ–‡ä»¶æ˜¯ä¸€ä¸ªé¡ºåºå†™çš„è¿‡ç¨‹ã€‚ç­‰ä¸å¿™çš„æ—¶å€™å†æ‰§è¡Œ redo log æ–‡ä»¶ï¼Œè¿›è¡Œæœ€ç»ˆçš„è½ç›˜ã€‚ã€Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰ä¸€ç›´æåˆ°çš„åˆ·è„é¡µã€ 16. â€order byâ€œ æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ order by æ˜¯ Mysql ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ æœ‰ä¸¤ç§ç®—æ³•æ‰§è¡Œ order byã€‚ å…¨å­—æ®µæ’åºï¼› rowid æ’åºã€‚ ç§‘æ™®ï¼š MySQLä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå†…å­˜ï¼ˆsort_bufferï¼‰ç”¨äºæ’åºè¯¥å†…å­˜å¤§å°ä¸ºsort_buffer_size å¦‚æœæ’åºçš„æ•°æ®é‡å°äºsort_buffer_sizeï¼Œæ’åºå°†ä¼šåœ¨å†…å­˜ä¸­å®Œæˆå¦‚æœæ’åºæ•°æ®é‡å¾ˆå¤§ï¼Œå†…å­˜ä¸­æ— æ³•å­˜ä¸‹è¿™ä¹ˆå¤šæ•°æ®ï¼Œåˆ™ä¼šä½¿ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶æ¥è¾…åŠ©æ’åºï¼Œä¹Ÿç§°å¤–éƒ¨æ’åº åœ¨ä½¿ç”¨å¤–éƒ¨æ’åºæ—¶ï¼ŒMySQLä¼šåˆ†æˆå¥½å‡ ä»½å•ç‹¬çš„ä¸´æ—¶æ–‡ä»¶ç”¨æ¥å­˜æ”¾æ’åºåçš„æ•°æ®ï¼Œç„¶ååœ¨å°†è¿™äº›æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¤§æ–‡ä»¶ mysqlä¼šé€šè¿‡éå†ç´¢å¼•å°†æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¯»å–åˆ°sort_bufferï¼Œå¹¶ä¸”æŒ‰ç…§æ’åºå­—æ®µè¿›è¡Œå¿«é€Ÿæ’åº å¦‚æœæŸ¥è¯¢çš„å­—æ®µä¸åŒ…å«åœ¨è¾…åŠ©ç´¢å¼•ä¸­ï¼Œéœ€è¦æŒ‰ç…§è¾…åŠ©ç´¢å¼•è®°å½•çš„ä¸»é”®è¿”å›èšé›†ç´¢å¼•å–å‡ºæ‰€éœ€å­—æ®µ è¯¥æ–¹å¼ä¼šé€ æˆéšæœºIOï¼Œåœ¨MySQL5.6æä¾›äº†MRRçš„æœºåˆ¶ï¼Œä¼šå°†è¾…åŠ©ç´¢å¼•åŒ¹é…è®°å½•çš„ä¸»é”®å–å‡ºæ¥åœ¨å†…å­˜ä¸­è¿›è¡Œæ’åºï¼Œç„¶ååœ¨å›è¡¨ æŒ‰ç…§æƒ…å†µå»ºç«‹è”åˆç´¢å¼•æ¥é¿å…æ’åºæ‰€å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œå…è®¸çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥å»ºç«‹è¦†ç›–ç´¢å¼•æ¥é¿å…å›è¡¨ å…¨å­—æ®µæ’åºè¿‡ç¨‹ï¼š é€šè¿‡ç´¢å¼•å°†æ‰€éœ€çš„å­—æ®µå…¨éƒ¨è¯»å–åˆ°sort_bufferä¸­ æŒ‰ç…§æ’åºå­—æ®µè¿›è¡Œæ’åº å°†ç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ ä¼˜ç‚¹ï¼š MySQLè®¤ä¸ºå†…å­˜è¶³å¤Ÿå¤§æ—¶ä¼šä¼˜å…ˆé€‰æ‹©å…¨å­—æ®µæ’åºï¼Œå› ä¸ºè¿™ç§æ–¹å¼æ¯”rowid æ’åºé¿å…äº†ä¸€æ¬¡å›è¡¨æ“ä½œ ç¼ºç‚¹ï¼š é€ æˆsort_bufferä¸­å­˜æ”¾ä¸ä¸‹å¾ˆå¤šæ•°æ®ï¼Œå› ä¸ºé™¤äº†æ’åºå­—æ®µè¿˜å­˜æ”¾å…¶ä»–å­—æ®µï¼Œå¯¹sort_bufferçš„åˆ©ç”¨æ•ˆç‡ä¸é«˜ å½“æ‰€éœ€æ’åºæ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œä¼šæœ‰å¾ˆå¤šçš„ä¸´æ—¶æ–‡ä»¶ï¼Œæ’åºæ€§èƒ½ä¹Ÿä¼šå¾ˆå·® rowid æ’åº é€šè¿‡æ§åˆ¶æ’åºçš„è¡Œæ•°æ®çš„é•¿åº¦æ¥è®©sort_bufferä¸­å°½å¯èƒ½å¤šçš„å­˜æ”¾æ•°æ®ï¼Œmax_length_for_sort_data åªå°†éœ€è¦æ’åºçš„å­—æ®µå’Œä¸»é”®è¯»å–åˆ°sort_bufferä¸­ï¼Œå¹¶æŒ‰ç…§æ’åºå­—æ®µè¿›è¡Œæ’åº æŒ‰ç…§æ’åºåçš„é¡ºåºï¼Œå–idè¿›è¡Œå›è¡¨å–å‡ºæƒ³è¦è·å–çš„æ•°æ® å°†ç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ ä¼˜ç‚¹ï¼šæ›´å¥½çš„åˆ©ç”¨å†…å­˜çš„sort_bufferè¿›è¡Œæ’åºæ“ä½œï¼Œå°½é‡å‡å°‘å¯¹ç£ç›˜çš„è®¿é—® ç¼ºç‚¹ï¼šå›è¡¨çš„æ“ä½œæ˜¯éšæœºIOï¼Œä¼šé€ æˆå¤§é‡çš„éšæœºè¯»ï¼Œä¸ä¸€å®šå°±æ¯”å…¨å­—æ®µæ’åºå‡å°‘å¯¹ç£ç›˜çš„è®¿é—® ä¸¤ç§ç®—æ³•çš„åº”ç”¨åœºæ™¯ï¼Ÿ å¦‚æœMySQLå®åœ¨æ˜¯æ‹…å¿ƒæ’åºå†…å­˜å¤ªå°ï¼Œä¼šå½±å“æ’åºæ•ˆç‡ï¼Œæ‰ä¼šé‡‡ç”¨rowidæ’åºç®—æ³•ï¼Œè¿™æ ·æ’åºè¿‡ç¨‹ä¸­ä¸€æ¬¡å¯ä»¥æ’åºæ›´å¤šè¡Œï¼Œä½†æ˜¯éœ€è¦å†å›åˆ°åŸè¡¨å»å–æ•°æ®ã€‚ å¦‚æœMySQLè®¤ä¸ºå†…å­˜è¶³å¤Ÿå¤§ï¼Œä¼šä¼˜å…ˆé€‰æ‹©å…¨å­—æ®µæ’åºï¼ŒæŠŠéœ€è¦çš„å­—æ®µéƒ½æ”¾åˆ°sort_bufferä¸­ï¼Œè¿™æ ·æ’åºåå°±ä¼šç›´æ¥ä»å†…å­˜é‡Œé¢è¿”å›æŸ¥è¯¢ç»“æœäº†ï¼Œä¸ç”¨å†å›åˆ°åŸè¡¨å»å–æ•°æ®ã€‚ è¿™ä¹Ÿå°±ä½“ç°äº†MySQLçš„ä¸€ä¸ªè®¾è®¡æ€æƒ³ï¼šå¦‚æœå†…å­˜å¤Ÿï¼Œå°±è¦å¤šåˆ©ç”¨å†…å­˜ï¼Œå°½é‡å‡å°‘ç£ç›˜è®¿é—®ã€‚ å¯¹äºInnoDBè¡¨æ¥è¯´ï¼Œrowidæ’åºä¼šè¦æ±‚å›è¡¨å¤šé€ æˆç£ç›˜è¯»ï¼Œå› æ­¤ä¸ä¼šè¢«ä¼˜å…ˆé€‰æ‹©ã€‚ è¿™ä¸ªç»“è®ºçœ‹ä¸Šå»æœ‰ç‚¹åºŸè¯çš„æ„Ÿè§‰ï¼Œä½†æ˜¯ä½ è¦è®°ä½å®ƒï¼Œä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å°±ä¼šç”¨åˆ°ã€‚ çœ‹åˆ°è¿™é‡Œï¼Œä½ å°±äº†è§£äº†ï¼ŒMySQLåšæ’åºæ˜¯ä¸€ä¸ªæˆæœ¬æ¯”è¾ƒé«˜çš„æ“ä½œã€‚é‚£ä¹ˆä½ ä¼šé—®ï¼Œæ˜¯ä¸æ˜¯æ‰€æœ‰çš„order byéƒ½éœ€è¦æ’åºæ“ä½œå‘¢ï¼Ÿå¦‚æœä¸æ’åºå°±èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œé‚£å¯¹ç³»ç»Ÿçš„æ¶ˆè€—ä¼šå°å¾ˆå¤šï¼Œè¯­å¥çš„æ‰§è¡Œæ—¶é—´ä¹Ÿä¼šå˜å¾—æ›´çŸ­ã€‚ å…¶å®ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„order byè¯­å¥ï¼Œéƒ½éœ€è¦æ’åºæ“ä½œçš„ã€‚ä»ä¸Šé¢åˆ†æçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒMySQLä¹‹æ‰€ä»¥éœ€è¦ç”Ÿæˆä¸´æ—¶è¡¨ï¼Œå¹¶ä¸”åœ¨ä¸´æ—¶è¡¨ä¸Šåšæ’åºæ“ä½œï¼Œå…¶åŸå› æ˜¯åŸæ¥çš„æ•°æ®éƒ½æ˜¯æ— åºçš„ã€‚ é‚£å¦‚æœåŸæ¥çš„æ•°æ®å°±æ˜¯æœ‰åºçš„ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ä¸ç”¨æ’åºäº†ï¼Ÿå¦‚ä½•åšåˆ°æœ‰åºå‘¢ï¼Ÿ æ˜¯çš„ï¼Œå¦‚æœæ•°æ®æœ¬èº«å°±æ˜¯æœ‰åºçš„ï¼Œå°±æ— é¡»æ’åºäº†ã€‚ è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨è¦†ç›–ç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•æœ¬èº«å°±æ˜¯æœ‰åºçš„ï¼Œè¿™æ ·å°±ä¸éœ€è¦é¢å¤–æ’åºå¸¦æ¥ç³»ç»Ÿçš„æ¶ˆè€—äº†ï¼Œä½†æ˜¯åŒæ ·çš„ç»´æŠ¤ç´¢å¼•ä¹Ÿæ˜¯æœ‰ç»´æŠ¤ä»£ä»·çš„ã€‚ 17. å¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯MySQLå¯¹ä¸´æ—¶è¡¨æ’åºçš„æ‰§è¡Œè¿‡ç¨‹ã€‚ å¦‚æœä½ ç›´æ¥ä½¿ç”¨order by rand()ï¼Œè¿™ä¸ªè¯­å¥éœ€è¦Using temporary å’Œ Using filesortï¼ŒæŸ¥è¯¢çš„æ‰§è¡Œä»£ä»·å¾€å¾€æ˜¯æ¯”è¾ƒå¤§çš„ã€‚æ‰€ä»¥ï¼Œåœ¨è®¾è®¡çš„æ—¶å€™ä½ è¦å°½é‡é¿å¼€è¿™ç§å†™æ³•ã€‚ 18. ä¸ºä»€ä¹ˆè¿™äº›SQLè¯­å¥é€»è¾‘ç›¸åŒï¼Œæ€§èƒ½å´å·®å¼‚å·¨å¤§ æ¡ä»¶å­—æ®µå‡½æ•°æ“ä½œ å¯¹ç´¢å¼•å­—æ®µåšå‡½æ•°æ“ä½œï¼Œå¯èƒ½ä¼šç ´åç´¢å¼•å€¼çš„æœ‰åºæ€§ï¼Œå› æ­¤ä¼˜åŒ–å™¨å°±å†³å®šæ”¾å¼ƒèµ°æ ‘æœç´¢åŠŸèƒ½ã€‚ ä¼šéå†å…¨è¡¨ï¼Œæ‰€ä»¥å¾ˆæ…¢â€¦ éšå¼ç±»å‹è½¬æ¢ mysql&gt; select * from tradelog where tradeid=110717; ä¾‹å¦‚ä¸Šé¢è¿™æ¡è¯­å¥ï¼Œ tradeid æ˜¯ varchar ç±»å‹ï¼Œä½†æ˜¯ä¼ è¿›æ¥æ•´æ•°å‹ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šç±»å‹è½¬æ¢ï¼Œå¯¼è‡´ä¸èƒ½èµ°ç´¢å¼•äº†ã€‚ å…¶å®ç±»å‹è½¬æ¢å°±æ˜¯ç›¸å½“äºå‡½æ•°æ“ä½œäº†ï¼Œæ‰€ä»¥ä¼šèµ°å…¨è¡¨è€Œä¸æ˜¯èµ°ç´¢å¼•ã€‚ éšå¼å­—ç¬¦ç¼–ç è½¬æ¢ å­—ç¬¦é›†ä¸åŒåªæ˜¯æ¡ä»¶ä¹‹ä¸€ï¼Œè¿æ¥è¿‡ç¨‹ä¸­è¦æ±‚åœ¨è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•å­—æ®µä¸ŠåŠ å‡½æ•°æ“ä½œï¼Œæ˜¯ç›´æ¥å¯¼è‡´å¯¹è¢«é©±åŠ¨è¡¨åšå…¨è¡¨æ‰«æçš„åŸå› ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œè¿™äº› sql è¯­å¥ä¹‹æ‰€ä»¥æ‰§è¡Œæ…¢ï¼Œå°±æ˜¯å› ä¸ºåŠ äº†åœ¨æ¡ä»¶ä¸­åŠ äº†å‡½æ•°æ“ä½œã€‚ 19. ä¸ºä»€ä¹ˆæˆ‘åªæŸ¥ä¸€è¡Œçš„è¯­å¥ï¼Œä¹Ÿæ‰§è¡Œè¿™ä¹ˆæ…¢æ–¹æ³•ï¼šæ‰§è¡Œä¸€ä¸‹show processlistå‘½ä»¤ï¼Œçœ‹çœ‹å½“å‰è¯­å¥å¤„äºä»€ä¹ˆçŠ¶æ€ã€‚ åŸå› å¯èƒ½æœ‰ï¼š ç¬¬ä¸€ç±»ï¼šæŸ¥è¯¢ä¸€æ¡æ•°æ®é•¿æ—¶é—´ä¸è¿”å› ç­‰ MDL é”ã€‚ä½¿ç”¨show processlistå‘½ä»¤ï¼Œå‘ç°æ˜¯ Waiting for table metadata lockã€‚å‡ºç°è¿™ä¸ªçŠ¶æ€è¡¨ç¤ºçš„æ˜¯ï¼Œç°åœ¨æœ‰ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¡¨tä¸Šè¯·æ±‚æˆ–è€…æŒæœ‰MDLå†™é”ï¼ŒæŠŠselectè¯­å¥å µä½äº†ã€‚ ç­‰è¡Œé”ã€‚ ç¬¬äºŒç±»ï¼šæŸ¥è¯¢æ…¢ ä¸€è‡´æ€§è¯»çš„é—®é¢˜ï¼Œéœ€è¦ä¸æ–­å›æ»šundo logï¼Œæ‰€ä»¥æ…¢ã€‚è¿™é‡Œå› ä¸ºåªæ˜¯æŸ¥ä¸€è¡Œï¼Œæ‰€ä»¥ä¸èƒ½ç®—æ˜¯æ…¢æŸ¥è¯¢ï¼Œåªèƒ½ç®—åæŸ¥è¯¢ï¼Œç­‰æ•°æ®é‡ä¸Šå»äº†ï¼Œå°±å˜æˆæ…¢æŸ¥è¯¢äº†ã€‚ 20. å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿã€Œæœªè®¤çœŸç ”è¯»ã€ å¹»è¯»æ˜¯ä»€ä¹ˆï¼Ÿ å¹»è¯»æŒ‡çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨å‰åä¸¤æ¬¡æŸ¥è¯¢åŒä¸€ä¸ªèŒƒå›´çš„æ—¶å€™ï¼Œåä¸€æ¬¡æŸ¥è¯¢çœ‹åˆ°äº†å‰ä¸€æ¬¡æŸ¥è¯¢æ²¡æœ‰çœ‹åˆ°çš„è¡Œã€‚ è¿™é‡Œï¼Œæˆ‘éœ€è¦å¯¹â€œå¹»è¯»â€åšä¸€ä¸ªè¯´æ˜ï¼š åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ™®é€šçš„æŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œæ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„ã€‚å› æ­¤ï¼Œå¹»è¯»åœ¨â€œå½“å‰è¯»â€ä¸‹æ‰ä¼šå‡ºç°ã€‚ã€ŒåŠ è¡Œé”è¯»çš„æ—¶å€™æ‰ä¼šå‡ºç°ï¼Œç ´åmvccï¼Œä¾‹å¦‚updateã€insertã€ å¹»è¯»ä»…ä¸“æŒ‡â€œæ–°æ’å…¥çš„è¡Œâ€ã€‚ å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ é¦–å…ˆæ˜¯è¯­ä¹‰ä¸Šæœ‰é—®é¢˜ã€‚session Aåœ¨T1æ—¶åˆ»å°±å£°æ˜äº†ï¼Œâ€œæˆ‘è¦æŠŠæ‰€æœ‰d=5çš„è¡Œé”ä½ï¼Œä¸å‡†åˆ«çš„äº‹åŠ¡è¿›è¡Œè¯»å†™æ“ä½œâ€ã€‚è€Œå®é™…ä¸Šï¼Œè¿™ä¸ªè¯­ä¹‰è¢«ç ´åäº†ã€‚ æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ å³ä½¿æŠŠæ‰€æœ‰çš„è®°å½•éƒ½åŠ ä¸Šé”ï¼Œè¿˜æ˜¯é˜»æ­¢ä¸äº†æ–°æ’å…¥çš„è®°å½• é‚£è¿™ä¹ˆéš¾å¯¹ä»˜ï¼ŒMysql æ˜¯å¦‚ä½•è§£å†³å‘¢ï¼Ÿ äº§ç”Ÿå¹»è¯»çš„åŸå› æ˜¯ï¼Œè¡Œé”åªèƒ½é”ä½è¡Œï¼Œä½†æ˜¯æ–°æ’å…¥è®°å½•è¿™ä¸ªåŠ¨ä½œï¼Œè¦æ›´æ–°çš„æ˜¯è®°å½•ä¹‹é—´çš„â€œé—´éš™â€ã€‚å› æ­¤ï¼Œä¸ºäº†è§£å†³å¹»è¯»é—®é¢˜ï¼ŒInnoDBåªå¥½å¼•å…¥æ–°çš„é”ï¼Œä¹Ÿå°±æ˜¯é—´éš™é”(Gap Lock)ã€‚ é—´éš™é”å’Œè¡Œé”åˆç§°next-key lockï¼Œæ¯ä¸ªnext-key lockæ˜¯å‰å¼€åé—­åŒºé—´ã€‚ é—´éš™é”å’Œnext-key lockçš„å¼•å…¥ï¼Œå¸®æˆ‘ä»¬è§£å†³äº†å¹»è¯»çš„é—®é¢˜ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›â€œå›°æ‰°â€ã€‚ é—´éš™é”çš„å¼•å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŒæ ·çš„è¯­å¥é”ä½æ›´å¤§çš„èŒƒå›´ï¼Œè¿™å…¶å®æ˜¯å½±å“äº†å¹¶å‘åº¦çš„ 21. ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤šã€Œæœªç ”è¯»ã€æœ‰ç‚¹éš¾â€¦æœ‰æ—¶é—´å†ç ”è¯» 22. MySQLæœ‰å“ªäº›â€œé¥®é¸©æ­¢æ¸´â€æé«˜æ€§èƒ½çš„æ–¹æ³• é¢å¯¹çŸ­è¿æ¥é£æš´æ—¶ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ ç¬¬ä¸€ç§æ–¹æ³•ï¼šå…ˆå¤„ç†æ‰é‚£äº›å ç€è¿æ¥ä½†æ˜¯ä¸å·¥ä½œçš„çº¿ç¨‹ã€‚ ç¬¬äºŒç§æ–¹æ³•ï¼šå‡å°‘è¿æ¥è¿‡ç¨‹çš„æ¶ˆè€—ã€‚æœ‰çš„ä¸šåŠ¡ä»£ç ä¼šåœ¨çŸ­æ—¶é—´å†…å…ˆå¤§é‡ç”³è¯·æ•°æ®åº“è¿æ¥åšå¤‡ç”¨ï¼Œå¦‚æœç°åœ¨æ•°æ®åº“ç¡®è®¤æ˜¯è¢«è¿æ¥è¡Œä¸ºæ‰“æŒ‚äº†ï¼Œé‚£ä¹ˆä¸€ç§å¯èƒ½çš„åšæ³•ï¼Œæ˜¯è®©æ•°æ®åº“è·³è¿‡æƒé™éªŒè¯é˜¶æ®µã€‚ è·³è¿‡æƒé™éªŒè¯çš„æ–¹æ³•æ˜¯ï¼šé‡å¯æ•°æ®åº“ï¼Œå¹¶ä½¿ç”¨â€“skip-grant-tableså‚æ•°å¯åŠ¨ã€‚è¿™æ ·ï¼Œæ•´ä¸ªMySQLä¼šè·³è¿‡æ‰€æœ‰çš„æƒé™éªŒè¯é˜¶æ®µï¼ŒåŒ…æ‹¬è¿æ¥è¿‡ç¨‹å’Œè¯­å¥æ‰§è¡Œè¿‡ç¨‹åœ¨å†…ã€‚ æ…¢æŸ¥è¯¢é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ åœ¨MySQLä¸­ï¼Œä¼šå¼•å‘æ€§èƒ½é—®é¢˜çš„æ…¢æŸ¥è¯¢ï¼Œå¤§ä½“æœ‰ä»¥ä¸‹ä¸‰ç§å¯èƒ½ï¼š ç´¢å¼•æ²¡æœ‰è®¾è®¡å¥½ï¼› SQLè¯­å¥æ²¡å†™å¥½ï¼› MySQLé€‰é”™äº†ç´¢å¼•ã€‚ å¯¼è‡´æ…¢æŸ¥è¯¢çš„ç¬¬ä¸€ç§å¯èƒ½æ˜¯ï¼Œç´¢å¼•æ²¡æœ‰è®¾è®¡å¥½ã€‚è¿™ç§åœºæ™¯ä¸€èˆ¬å°±æ˜¯é€šè¿‡ç´§æ€¥åˆ›å»ºç´¢å¼•æ¥è§£å†³ã€‚MySQL 5.6ç‰ˆæœ¬ä»¥åï¼Œåˆ›å»ºç´¢å¼•éƒ½æ”¯æŒOnline DDLäº†ï¼Œå¯¹äºé‚£ç§é«˜å³°æœŸæ•°æ®åº“å·²ç»è¢«è¿™ä¸ªè¯­å¥æ‰“æŒ‚äº†çš„æƒ…å†µï¼Œæœ€é«˜æ•ˆçš„åšæ³•å°±æ˜¯ç›´æ¥æ‰§è¡Œalter table è¯­å¥ã€‚æ¯”è¾ƒç†æƒ³çš„æ˜¯èƒ½å¤Ÿåœ¨å¤‡åº“å…ˆæ‰§è¡Œã€‚å‡è®¾ä½ ç°åœ¨çš„æœåŠ¡æ˜¯ä¸€ä¸»ä¸€å¤‡ï¼Œä¸»åº“Aã€å¤‡åº“Bï¼Œè¿™ä¸ªæ–¹æ¡ˆçš„å¤§è‡´æµç¨‹æ˜¯è¿™æ ·çš„ï¼š åœ¨å¤‡åº“Bä¸Šæ‰§è¡Œ set sql_log_bin=offï¼Œä¹Ÿå°±æ˜¯ä¸å†™binlogï¼Œç„¶åæ‰§è¡Œalter table è¯­å¥åŠ ä¸Šç´¢å¼•ï¼› æ‰§è¡Œä¸»å¤‡åˆ‡æ¢ï¼› è¿™æ—¶å€™ä¸»åº“æ˜¯Bï¼Œå¤‡åº“æ˜¯Aã€‚åœ¨Aä¸Šæ‰§è¡Œ set sql_log_bin=offï¼Œç„¶åæ‰§è¡Œalter table è¯­å¥åŠ ä¸Šç´¢å¼•ã€‚ è¿™æ˜¯ä¸€ä¸ªâ€œå¤è€â€çš„DDLæ–¹æ¡ˆã€‚å¹³æ—¶åœ¨åšå˜æ›´çš„æ—¶å€™ï¼Œä½ åº”è¯¥è€ƒè™‘ç±»ä¼¼gh-ostè¿™æ ·çš„æ–¹æ¡ˆï¼Œæ›´åŠ ç¨³å¦¥ã€‚ä½†æ˜¯åœ¨éœ€è¦ç´§æ€¥å¤„ç†æ—¶ï¼Œä¸Šé¢è¿™ä¸ªæ–¹æ¡ˆçš„æ•ˆç‡æ˜¯æœ€é«˜çš„ã€‚ å¯¼è‡´æ…¢æŸ¥è¯¢çš„ç¬¬äºŒç§å¯èƒ½æ˜¯ï¼Œè¯­å¥æ²¡å†™å¥½ã€‚ è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å†™SQLè¯­å¥æ¥å¤„ç†ã€‚MySQL 5.7æä¾›äº†query_rewriteåŠŸèƒ½ï¼Œå¯ä»¥æŠŠè¾“å…¥çš„ä¸€ç§è¯­å¥æ”¹å†™æˆå¦å¤–ä¸€ç§æ¨¡å¼ã€‚ æ¯”å¦‚ï¼Œè¯­å¥è¢«é”™è¯¯åœ°å†™æˆäº† select * from t where id + 1 = 10000ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼ï¼Œå¢åŠ ä¸€ä¸ªè¯­å¥æ”¹å†™è§„åˆ™ã€‚ 1234&gt; mysql&gt; insert into query_rewrite.rewrite_rules(pattern, replacement, pattern_database) values ("select * from t where id + 1 = ?", "select * from t where id = ? - 1", "db1");&gt; &gt; call query_rewrite.flush_rewrite_rules();&gt; è¿™é‡Œï¼Œcall query_rewrite.flush_rewrite_rules()è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼Œæ˜¯è®©æ’å…¥çš„æ–°è§„åˆ™ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„â€œæŸ¥è¯¢é‡å†™â€ã€‚ å¯¼è‡´æ…¢æŸ¥è¯¢çš„ç¬¬ä¸‰ç§å¯èƒ½ï¼Œå°±æ˜¯MySQLé€‰é”™äº†ç´¢å¼•ã€‚ è¿™æ—¶å€™ï¼Œåº”æ€¥æ–¹æ¡ˆå°±æ˜¯ç»™è¿™ä¸ªè¯­å¥åŠ ä¸Šforce indexã€‚ å¦‚ä½•é¿å…æ…¢æŸ¥è¯¢å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Ÿ ä¸Šé¢æˆ‘å’Œä½ è®¨è®ºçš„ç”±æ…¢æŸ¥è¯¢å¯¼è‡´æ€§èƒ½é—®é¢˜çš„ä¸‰ç§å¯èƒ½æƒ…å†µï¼Œå®é™…ä¸Šå‡ºç°æœ€å¤šçš„æ˜¯å‰ä¸¤ç§ï¼Œå³ï¼šç´¢å¼•æ²¡è®¾è®¡å¥½å’Œè¯­å¥æ²¡å†™å¥½ã€‚è€Œè¿™ä¸¤ç§æƒ…å†µï¼Œæ°æ°æ˜¯å®Œå…¨å¯ä»¥é¿å…çš„ã€‚æ¯”å¦‚ï¼Œé€šè¿‡ä¸‹é¢è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é¢„å…ˆå‘ç°é—®é¢˜ã€‚ ä¸Šçº¿å‰ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒï¼ŒæŠŠæ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow logï¼‰æ‰“å¼€ï¼Œå¹¶ä¸”æŠŠlong_query_timeè®¾ç½®æˆ0ï¼Œç¡®ä¿æ¯ä¸ªè¯­å¥éƒ½ä¼šè¢«è®°å½•å…¥æ…¢æŸ¥è¯¢æ—¥å¿—ï¼› åœ¨æµ‹è¯•è¡¨é‡Œæ’å…¥æ¨¡æ‹Ÿçº¿ä¸Šçš„æ•°æ®ï¼Œåšä¸€éå›å½’æµ‹è¯•ï¼› è§‚å¯Ÿæ…¢æŸ¥è¯¢æ—¥å¿—é‡Œæ¯ç±»è¯­å¥çš„è¾“å‡ºï¼Œç‰¹åˆ«ç•™æ„Rows_examinedå­—æ®µæ˜¯å¦ä¸é¢„æœŸä¸€è‡´ã€‚ ä¸è¦åå•¬è¿™æ®µèŠ±åœ¨ä¸Šçº¿å‰çš„â€œé¢å¤–â€æ—¶é—´ï¼Œå› ä¸ºè¿™ä¼šå¸®ä½ çœä¸‹å¾ˆå¤šæ•…éšœå¤ç›˜çš„æ—¶é—´ã€‚ 23 - 28 è®² åç»­ç« èŠ‚æš‚æ—¶æ„Ÿè§‰æ²¡æœ‰å¤ªå¤šçœ‹çš„å¿…è¦ï¼Œæœ€åä»¥ä¸€é“é¢˜ç»“æŸæœ¬ç¯‡æ–‡ç« ã€‚ æˆ‘ä»¬å‡è®¾åŸæ¥çš„å¤§è¡¨æœ‰10000è¡Œæ•°æ®ï¼Œè€Œç¬¦åˆæ¡ä»¶çš„æ•°æ®æœ‰100è¡Œï¼Œæˆ‘ä»¬æœ€åçš„ç»“æœé›†æ˜¯åªè¦10è¡Œ æˆ‘ä»¬çŸ¥é“ï¼Œlimitæ˜¯ä¸€ä¸ªè¯­å¥æœ€åæ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šå…ˆæŠŠç¬¦åˆæ¡ä»¶çš„æ•°æ®å…¨éƒ¨æ‰¾åˆ°ï¼Œæœ€åå†è¿›è¡Œ limitã€‚ åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸­ï¼Œä¼šå…ˆå»éèšé›†ç´¢å¼•ä¸­æ‰¾ç¬¦åˆæ¡ä»¶çš„ä¸»é”®å€¼ï¼Œç„¶åè¿›è¡Œå›è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œä¼šéå†å¤§è¡¨10000è¡Œï¼Œå›è¡¨100æ¬¡ï¼Œæœ€åæ•°æ®å…¨éƒ¨æ‹¿åˆ°ä¹‹åï¼Œä¼šè¿›è¡Œ limitï¼› è€Œåœ¨ç¬¬äºŒç§æƒ…å†µï¼Œä¼šç›´æ¥å…ˆå»éèšé›†ç´¢å¼•ä¸­æ‰¾ç¬¦åˆæ¡ä»¶çš„ä¸»é”®å€¼ï¼Œè¿™ä¸€æ­¥å’Œç¬¬ä¸€ç§æƒ…å†µæ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿæ˜¯ä¼šéå†å¤§è¡¨10000è¡Œï¼Œä½†æ˜¯æ³¨æ„ï¼Œè¿™é‡Œåœ¨å†…éƒ¨æœ‰è¿›è¡Œ limitï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰¾åˆ°äº†ç¬¦åˆæ¡ä»¶çš„ä¸»é”®å€¼ï¼Œå°±ç›´æ¥ limitäº†ï¼Œè¿™æ ·å°±ä¼šåªå‰©ä¸‹ 10 ä¸ªæœ‰æ•ˆçš„ä¸»é”®å€¼ï¼Œç„¶åå†å»å›è¡¨ï¼Œä¹Ÿæ˜¯ç›¸å½“äºåªä¼šå›è¡¨åæ¬¡ã€‚æ‰€ä»¥åº”è¯¥å¿«çš„åŸå› åœ¨è¿™äº†â€¦.ä¸€ä¸ªå›è¡¨100æ¬¡ï¼Œä¸€ä¸ªå›è¡¨ 10 æ¬¡ï¼Œè¿™è¿˜åªæ˜¯åœ¨ç¬¦åˆæ¡ä»¶çš„æ•°æ®åªæœ‰100è¡Œçš„æƒ…å†µä¸‹ï¼Œå¦‚æœç¬¦åˆæ¡ä»¶çš„æ•°æ®æ˜¯1000000è¡Œï¼Œé‚£è¿™ä¸ªå›è¡¨çš„æ¬¡æ•°å‡å°‘çš„å¯å°±å¾ˆææ€–äº†ã€‚ã€‚ã€‚ ä¸€å¼€å§‹è‡ªå·±çš„æƒ³æ³•ä»¥ä¸ºæ˜¯ right join å¸¦æ¥çš„æ€§èƒ½çš„å·¨å¤§æå‡ï¼Œåé¢å‘ç°å¹¶ä¸æ˜¯ï¼Œä½†æ˜¯ä¹Ÿé¡ºå¸¦çœ‹äº†ä¸€é join æå‡æ€§èƒ½çš„ä¸€äº›æ–¹æ³•ã€‚ ã€Œç¬¬34ã€35è®²ã€ ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šèƒ½ä¸èƒ½ä½¿ç”¨joinè¯­å¥ï¼Ÿ å¦‚æœå¯ä»¥ä½¿ç”¨Index Nested-Loop Joinç®—æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç”¨ä¸Šè¢«é©±åŠ¨è¡¨ä¸Šçš„ç´¢å¼•ï¼Œå…¶å®æ˜¯æ²¡é—®é¢˜çš„ï¼› å¦‚æœä½¿ç”¨Block Nested-Loop Joinç®—æ³•ï¼Œæ‰«æè¡Œæ•°å°±ä¼šè¿‡å¤šã€‚å°¤å…¶æ˜¯åœ¨å¤§è¡¨ä¸Šçš„joinæ“ä½œï¼Œè¿™æ ·å¯èƒ½è¦æ‰«æè¢«é©±åŠ¨è¡¨å¾ˆå¤šæ¬¡ï¼Œä¼šå ç”¨å¤§é‡çš„ç³»ç»Ÿèµ„æºã€‚æ‰€ä»¥è¿™ç§joinå°½é‡ä¸è¦ç”¨ã€‚ æ‰€ä»¥ä½ åœ¨åˆ¤æ–­è¦ä¸è¦ä½¿ç”¨joinè¯­å¥æ—¶ï¼Œå°±æ˜¯çœ‹explainç»“æœé‡Œé¢ï¼ŒExtraå­—æ®µé‡Œé¢æœ‰æ²¡æœ‰å‡ºç°â€œBlock Nested Loopâ€å­—æ ·ã€‚ ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼šå¦‚æœè¦ä½¿ç”¨joinï¼Œåº”è¯¥é€‰æ‹©å¤§è¡¨åšé©±åŠ¨è¡¨è¿˜æ˜¯é€‰æ‹©å°è¡¨åšé©±åŠ¨è¡¨ï¼Ÿ å¦‚æœæ˜¯Index Nested-Loop Joinç®—æ³•ï¼Œåº”è¯¥é€‰æ‹©å°è¡¨åšé©±åŠ¨è¡¨ï¼› å¦‚æœæ˜¯Block Nested-Loop Joinç®—æ³•ï¼š åœ¨join_buffer_sizeè¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œæ˜¯ä¸€æ ·çš„ï¼› åœ¨join_buffer_sizeä¸å¤Ÿå¤§çš„æ—¶å€™ï¼ˆè¿™ç§æƒ…å†µæ›´å¸¸è§ï¼‰ï¼Œåº”è¯¥é€‰æ‹©å°è¡¨åšé©±åŠ¨è¡¨ã€‚ æ‰€ä»¥ï¼Œè¿™ä¸ªé—®é¢˜çš„ç»“è®ºå°±æ˜¯ï¼Œæ€»æ˜¯åº”è¯¥ä½¿ç”¨å°è¡¨åšé©±åŠ¨è¡¨ã€‚ æ€»ç»“åç»­å…¶å®è¿˜æœ‰10å¤šèŠ‚æœªçœ‹ï¼Œä½†æ˜¯ç¨å¾®ç•¥è¯»äº†ä¸‹ï¼Œæ„Ÿè§‰å¯è¯»æ€§ä¸æ˜¯å¾ˆå¼ºäº†ï¼Œæ¯•ç«Ÿä¸æ˜¯ä¸“ä¸š DBAï¼Œæš‚æ—¶ MySQL å‘Šä¸€æ®µè½äº†â€¦]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“ä¸“é¢˜å¤ä¹ ]]></title>
    <url>%2F2020%2F03%2F03%2F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%8D%E4%B9%A0.html</url>
    <content type="text"><![CDATA[è‡ªå·±éƒ¨åˆ†æ€»ç»“Qï¼šäº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼Ÿ ACID åŸå­æ€§ Atomicityã€‚äº‹åŠ¡ä¸­æ‰€æœ‰æ“ä½œæ˜¯ä¸å¯å†åˆ†å‰²çš„åŸå­å•ä½ï¼Œæ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¤±è´¥ã€‚ ä¸€è‡´æ€§ Consistencyã€‚äº‹åŠ¡æ‰§è¡Œåï¼Œæ•°æ®åº“çŠ¶æ€ä¸å…¶å®ƒä¸šåŠ¡è§„åˆ™ä¿æŒä¸€è‡´ã€‚å¦‚è½¬è´¦ä¸šåŠ¡ï¼Œæ— è®ºäº‹åŠ¡æ‰§è¡ŒæˆåŠŸä¸å¦ï¼Œå‚ä¸è½¬è´¦çš„ä¸¤ä¸ªè´¦å·ä½™é¢ä¹‹å’Œåº”è¯¥æ˜¯ä¸å˜çš„ã€‚ éš”ç¦»æ€§ Isolationã€‚åœ¨å¹¶å‘æ“ä½œä¸­ï¼Œä¸åŒäº‹åŠ¡ä¹‹é—´åº”è¯¥éš”ç¦»å¼€æ¥ï¼Œä½¿æ¯ä¸ªå¹¶å‘ä¸­çš„äº‹åŠ¡ä¸ä¼šç›¸äº’å¹²æ‰°ã€‚ æŒä¹…æ€§ Durabilityã€‚ä¸€æ—¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œäº‹åŠ¡ä¸­æ‰€æœ‰çš„æ•°æ®æ“ä½œéƒ½å¿…é¡»è¢«æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼Œå³ä½¿æäº¤äº‹åŠ¡åï¼Œæ•°æ®åº“é©¬ä¸Šå´©æºƒï¼Œåœ¨æ•°æ®åº“é‡å¯æ—¶ï¼Œä¹Ÿå¿…é¡»èƒ½ä¿è¯é€šè¿‡æŸç§æœºåˆ¶æ¢å¤æ•°æ®ã€‚ Qï¼šæ•°æ®åº“éš”ç¦»çº§åˆ«ï¼Ÿ https://www.cnblogs.com/newsouls/p/4936842.html æ•°æ®åº“äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰4ä¸ªï¼Œç”±ä½åˆ°é«˜ä¾æ¬¡ä¸º Read uncommitted è¯»æœªæäº¤ Read committed è¯»æäº¤ Repeatable read é‡å¤è¯»ï¼ˆé»˜è®¤ï¼‰ Serializable åºåˆ—åŒ– è¿™å››ä¸ªçº§åˆ«å¯ä»¥é€ä¸ªè§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»è¿™å‡ ç±»é—®é¢˜ã€‚ è„è¯»: å¯¹äºä¸¤ä¸ªäº‹ç‰© T1, T2, T1 è¯»å–äº†å·²ç»è¢« T2 æ›´æ–°ä½†è¿˜æ²¡æœ‰è¢«æäº¤çš„å­—æ®µ. ä¹‹å, è‹¥ T2 å›æ»š, T1è¯»å–çš„å†…å®¹å°±æ˜¯ä¸´æ—¶ä¸”æ— æ•ˆçš„ã€‚ ä¸å¯é‡å¤è¯»: å¯¹äºä¸¤ä¸ªäº‹ç‰© T1, T2, T1 è¯»å–äº†ä¸€ä¸ªå­—æ®µ, ç„¶å T2 æ›´æ–°äº†è¯¥å­—æ®µ. ä¹‹å, T1å†æ¬¡è¯»å–åŒä¸€ä¸ªå­—æ®µ, å€¼å°±ä¸åŒäº†ã€‚ å¹»è¯»: å¯¹äºä¸¤ä¸ªäº‹ç‰© T1, T2, T1 ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–äº†ä¸€ä¸ªå­—æ®µ, ç„¶å T2 åœ¨è¯¥è¡¨ä¸­æ’å…¥äº†ä¸€äº›æ–°çš„è¡Œ. ä¹‹å, å¦‚æœ T1 å†æ¬¡è¯»å–åŒä¸€ä¸ªè¡¨, å°±ä¼šå¤šå‡ºå‡ è¡Œã€‚ âˆš: å¯èƒ½å‡ºç° Ã—: ä¸ä¼šå‡ºç° è„è¯» ä¸å¯é‡å¤è¯» å¹»è¯» Read uncommitted âˆš âˆš âˆš Read committed Ã— âˆš âˆš Repeatable read Ã— Ã— âˆš Serializable Ã— Ã— Ã— Qï¼šMYSQLçš„ä¸¤ç§å­˜å‚¨å¼•æ“åŒºåˆ«ï¼ˆäº‹åŠ¡ã€é”çº§åˆ«ç­‰ç­‰ï¼‰ï¼Œå„è‡ªçš„é€‚ç”¨åœºæ™¯ https://segmentfault.com/a/1190000008227211 MyISAM VS InnoDB ä¸åŒç‚¹ï¼š å­˜å‚¨æ–¹å¼ã€‚MyISAM çš„ç´¢å¼•æ–‡ä»¶ï¼ˆ.MYIï¼‰å’Œæ•°æ®æ–‡ä»¶ï¼ˆ.MYDï¼‰åˆ†å¼€æ”¾ï¼Œè€Œ InnoDB å­˜æ”¾åœ¨ä¸€èµ·ã€‚ äº‹åŠ¡æ”¯æŒã€‚MyISAM ä¸æ”¯æŒäº‹åŠ¡ï¼Œä½†æ“ä½œå…·å¤‡åŸå­æ€§ï¼ŒInnoDB æ”¯æŒäº‹åŠ¡ã€‚ è¡¨é”å·®å¼‚ã€‚ MyISAM åªæ”¯æŒè¡¨çº§é”ï¼Œç”¨æˆ·åœ¨æ“ä½œmyisamè¡¨æ—¶ï¼Œselectï¼Œupdateï¼Œdeleteï¼Œinsertè¯­å¥éƒ½ä¼šç»™è¡¨è‡ªåŠ¨åŠ é”ï¼ŒåŒæ—¶ï¼Œè¿™ç§è¡¨çº§é”åŸºæœ¬å°±æ˜¯ ReentrantReadWriteLock çš„å˜ä½“ï¼Œè¯»é”å…±äº«ï¼Œå†™é”äº’æ–¥ï¼Œè¯»-å†™ä¹Ÿäº’æ–¥ï¼Œå¹¶ä¸”æœ‰ä¸ªç‰¹æ®Šç‚¹ï¼Œå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹è¯·æ±‚æŸä¸ªMyISAMè¡¨çš„è¯»é”ï¼ŒåŒæ—¶å¦ä¸€ä¸ªè¿›ç¨‹ä¹Ÿè¯·æ±‚åŒä¸€è¡¨çš„å†™é”ï¼ŒMySQLå¦‚ä½•å¤„ç†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å†™è¿›ç¨‹å…ˆè·å¾—é”ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå³ä½¿è¯»è¯·æ±‚å…ˆåˆ°é”ç­‰å¾…é˜Ÿåˆ—ï¼Œå†™è¯·æ±‚ååˆ°ï¼Œå†™é”ä¹Ÿä¼šæ’åˆ°è¯»é”è¯·æ±‚ä¹‹å‰ï¼è¿™æ˜¯å› ä¸ºMySQLè®¤ä¸ºå†™è¯·æ±‚ä¸€èˆ¬æ¯”è¯»è¯·æ±‚è¦é‡è¦ã€‚è¿™ä¹Ÿæ­£æ˜¯MyISAMè¡¨ä¸å¤ªé€‚åˆäºæœ‰å¤§é‡æ›´æ–°æ“ä½œå’ŒæŸ¥è¯¢æ“ä½œåº”ç”¨çš„åŸå› ï¼Œå› ä¸ºï¼Œå¤§é‡çš„æ›´æ–°æ“ä½œä¼šé€ æˆæŸ¥è¯¢æ“ä½œå¾ˆéš¾è·å¾—è¯»é”ï¼Œä»è€Œå¯èƒ½æ°¸è¿œé˜»å¡ã€‚è¿™ç§æƒ…å†µæœ‰æ—¶å¯èƒ½ä¼šå˜å¾—éå¸¸ç³Ÿç³•ï¼ æ”¯æŒè¡Œé”ï¼Œé”ç²’åº¦ç»†åŒ–ï¼Œå› æ­¤å¯ä»¥æ”¯æŒå†™å¹¶å‘ã€‚ æ˜¯å¦æœ‰å¤–é”®ã€‚MyISAM æ²¡æœ‰å¤–é”®ï¼ŒInnoDB æœ‰å¤–é”®ã€‚ ç´¢å¼•ç±»å‹ã€‚MyISAM é‡‡ç”¨çš„æ˜¯éèšé›†ç´¢å¼•ï¼Œè€Œ InnoDB é‡‡ç”¨äº†èšé›†ç´¢å¼•ã€‚MyISAM å¶èŠ‚ç‚¹ä¿å­˜çš„æ˜¯æŒ‡å‘æ•°æ®æ–‡ä»¶çš„æŒ‡é’ˆï¼Œè€Œ InnoDB ä¿å­˜çš„å°±æ˜¯æ•°æ®æœ¬èº«ã€‚ ã€Œ https://www.cnblogs.com/rgever/p/9736374.htmlã€ å­˜å‚¨æ€»è¡Œæ•°ã€‚MyISAM ç›´æ¥å­˜å‚¨æ€»è¡Œæ•°ï¼Œè€Œ InnoDBä¸€ä¸ªä¸ªå¿…é¡»éå†ã€‚ å¯¹äºAUTO_INCREMENTç±»å‹çš„å­—æ®µï¼Œåœ¨MyISAMè¡¨ä¸­ï¼Œå¯ä»¥å’Œå…¶ä»–å­—æ®µä¸€èµ·å»ºç«‹è”åˆç´¢å¼•ã€‚è€ŒInnoDBä¸­å¿…é¡»åŒ…å«åªæœ‰è¯¥å­—æ®µçš„ç´¢å¼•ã€‚ å…¨æ–‡ç´¢å¼•ã€‚MyISAM æ”¯æŒ fulltext å…¨æ–‡ç´¢å¼•ï¼Œè€Œ InnoDB ä¸æ”¯æŒã€‚ ç”±äºç´¢å¼•ç±»å‹çš„åŒºåˆ«ï¼Œæ‰€ä»¥åœ¨æ˜¯å¦å¿…é¡»è¦æœ‰ä¸»é”®ä¸Šä¹Ÿæœ‰å·®è·ã€‚ MyISAMï¼šå…è®¸æ²¡æœ‰ä»»ä½•ç´¢å¼•å’Œä¸»é”®çš„è¡¨å­˜åœ¨ï¼Œç´¢å¼•éƒ½æ˜¯ä¿å­˜è¡Œçš„åœ°å€ã€‚ InnoDBï¼šå¦‚æœæ²¡æœ‰è®¾å®šä¸»é”®æˆ–è€…éç©ºå”¯ä¸€ç´¢å¼•ï¼Œå°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª6å­—èŠ‚çš„ä¸»é”®(ç”¨æˆ·ä¸å¯è§)ï¼Œæ•°æ®æ˜¯ä¸»ç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼Œé™„åŠ ç´¢å¼•ä¿å­˜çš„æ˜¯ä¸»ç´¢å¼•çš„å€¼ã€‚ é€‚ç”¨åœºæ™¯ï¼š é‡‡ç”¨MyISAMå¼•æ“ R/W &gt; 100:1 ä¸”updateç›¸å¯¹è¾ƒå°‘ å¹¶å‘ä¸é«˜ è¡¨æ•°æ®é‡å° ç¡¬ä»¶èµ„æºæœ‰é™ é‡‡ç”¨InnoDBå¼•æ“ R/Wæ¯”è¾ƒå°ï¼Œé¢‘ç¹æ›´æ–°å¤§å­—æ®µ è¡¨æ•°æ®é‡è¶…è¿‡1000ä¸‡ï¼Œå¹¶å‘é«˜ å®‰å…¨æ€§å’Œå¯ç”¨æ€§è¦æ±‚é«˜ é‡‡ç”¨Memoryå¼•æ“ æœ‰è¶³å¤Ÿçš„å†…å­˜ å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸é«˜ï¼Œå¦‚åœ¨çº¿äººæ•°å’Œsessionç­‰åº”ç”¨ éœ€è¦å®šæœŸå½’æ¡£æ•°æ® Qï¼šç´¢å¼•æœ‰ B+ ç´¢å¼• å’Œ Hash ç´¢å¼•ï¼ŒäºŒè€…æœ‰ä½•å¼‚åŒï¼Œä¸ºä½•ä¸»æµçš„æ•°æ®åº“å¼•æ“éƒ½æ˜¯ä½¿ç”¨çš„ B+ ç´¢å¼•ï¼Ÿ ç´¢å¼• åŒºåˆ« Hash ç­‰å€¼æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œä½†æ˜¯ä¸èƒ½æ’åº(é”®å€¼ç»è¿‡å“ˆå¸Œå˜æˆæ— åº)ï¼Œä¸èƒ½è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œä¸æ”¯æŒå¤šåˆ—è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…è§„åˆ™ï¼Œåœ¨æœ‰å¤§é‡é‡å¤é”®å€¼æƒ…å†µä¸‹ï¼Œå“ˆå¸Œç´¢å¼•çš„æ•ˆç‡ä¹Ÿæ˜¯æä½çš„ï¼Œå› ä¸ºå­˜åœ¨æ‰€è°“çš„å“ˆå¸Œç¢°æ’é—®é¢˜ã€‚ B+ å¹³è¡¡çš„å¤šå‰æ ‘ï¼Œæ•°æ®æœ‰åºï¼Œå¯èŒƒå›´æŸ¥è¯¢ Qï¼šèšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•çš„åŒºåˆ«ï¼Ÿ https://www.cnblogs.com/s-b-b/p/8334593.html èšé›†ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ï¼‰ï¼šæ•°æ®è¡Œçš„ç‰©ç†é¡ºåºä¸åˆ—å€¼ï¼ˆä¸€èˆ¬æ˜¯ä¸»é”®çš„é‚£ä¸€åˆ—ï¼‰çš„é€»è¾‘é¡ºåºç›¸åŒï¼Œä¸€ä¸ªè¡¨ä¸­åªèƒ½æ‹¥æœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ã€‚ éèšé›†ç´¢å¼•ï¼šè¯¥ç´¢å¼•ä¸­ç´¢å¼•çš„é€»è¾‘é¡ºåºä¸ç£ç›˜ä¸Šè¡Œçš„ç‰©ç†å­˜å‚¨é¡ºåºä¸åŒï¼Œä¸€ä¸ªè¡¨ä¸­å¯ä»¥æ‹¥æœ‰å¤šä¸ªéèšé›†ç´¢å¼•ã€‚ ä½¿ç”¨èšé›†ç´¢å¼•çš„æŸ¥è¯¢æ•ˆç‡è¦æ¯”éèšé›†ç´¢å¼•çš„æ•ˆç‡è¦é«˜ï¼Œä½†æ˜¯å¦‚æœéœ€è¦é¢‘ç¹å»æ”¹å˜èšé›†ç´¢å¼•çš„å€¼ï¼Œå†™å…¥æ€§èƒ½å¹¶ä¸é«˜ï¼Œå› ä¸ºéœ€è¦ç§»åŠ¨å¯¹åº”æ•°æ®çš„ç‰©ç†ä½ç½®ã€‚ éèšé›†ç´¢å¼•åœ¨æŸ¥è¯¢çš„æ—¶å€™å¯ä»¥çš„è¯å°±é¿å…äºŒæ¬¡æŸ¥è¯¢ï¼Œè¿™æ ·æ€§èƒ½ä¼šå¤§å¹…æå‡ã€‚ ä¸æ˜¯æ‰€æœ‰çš„è¡¨éƒ½é€‚åˆå»ºç«‹ç´¢å¼•ï¼Œåªæœ‰æ•°æ®é‡å¤§è¡¨æ‰é€‚åˆå»ºç«‹ç´¢å¼•ï¼Œä¸”å»ºç«‹åœ¨é€‰æ‹©æ€§é«˜çš„åˆ—ä¸Šé¢æ€§èƒ½ä¼šæ›´å¥½ã€‚ Qï¼šç´¢å¼•çš„ä¼˜ç¼ºç‚¹ï¼Œå·²ç»ç´¢å¼•çš„é€‚ç”¨åœºæ™¯ï¼Ÿ ç´¢å¼•æœ€å¤§çš„å¥½å¤„æ˜¯æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œ ç¼ºç‚¹æ˜¯æ›´æ–°æ•°æ®æ—¶æ•ˆç‡ä½ï¼Œå› ä¸ºè¦åŒæ—¶æ›´æ–°ç´¢å¼•. å¯¹æ•°æ®è¿›è¡Œé¢‘ç¹æŸ¥è¯¢è¿›å»ºç«‹ç´¢å¼•ï¼Œå¦‚æœè¦é¢‘ç¹æ›´æ”¹æ•°æ®ä¸å»ºè®®ä½¿ç”¨ç´¢å¼•ã€‚ Qï¼šæ•°æ®åº“å¼•æ“åº•å±‚å®ç°ä¸ºä½•ä¸ç”¨ B æ ‘å’Œçº¢é»‘æ ‘ã€AVLå‘¢ï¼Ÿ é¦–å…ˆå›ç­”ä¸ºä½•ä¸ç”¨ B æ ‘ B æ ‘åœ¨æ¯ä¸ªç´¢å¼•èŠ‚ç‚¹éƒ½ä¼šä¿å­˜ Data åŸŸï¼Œè¦çŸ¥é“è¡¡é‡ Mysql çš„æŸ¥è¯¢æ•ˆç‡å°±æ˜¯å–å†³äºç£ç›˜ I/O æ¬¡æ•°ï¼ŒB æ ‘åœ¨æ¯ä¸ªç´¢å¼•èŠ‚ç‚¹éƒ½ä¿å­˜ Data åŸŸï¼Œæ„å‘³ç€æ¯ä¸ªç´¢å¼•æ‰€å çš„ç©ºé—´å°±å˜å¤§äº†ï¼Œç£ç›˜ I/O æ˜¯æŒ‰é¡µï¼ˆ16kbï¼‰è¯»å–çš„ï¼Œé‚£ä¹ˆæ¯é¡µçš„ç´¢å¼•æ•°é‡å°±è‡ªç„¶ä¼šå˜å°‘ï¼Œè¿™æ ·å°±æ„å‘³ç€éœ€è¦æ›´å¤šçš„ I/O æ¬¡æ•°ï¼Œè€Œå¯¹æ¯” B+ï¼Œåªåœ¨å¶å­èŠ‚ç‚¹æ‰æœ‰æ‰€æœ‰çš„æ•°æ®ï¼Œå…¶ä»–çš„ç´¢å¼•èŠ‚ç‚¹æ‰€å ç©ºé—´å¾ˆå°ï¼Œæ‰€ä»¥è¿™æ˜¯ B+ çš„ä¸€ä¸ªä¼˜ç‚¹ï¼› å…¶æ¬¡ï¼ŒB+ çš„å¶å­ç»“ç‚¹æœ‰ä½¿ç”¨é“¾è¡¨è¿æ¥ï¼Œéå¸¸é€‚ç”¨äºèŒƒå›´æŸ¥è¯¢ï¼Œç›¸æ¯”æ¥è¯´ B æ ‘å°±æ²¡æœ‰ï¼› æœ€åï¼ŒB+ çš„æŸ¥è¯¢æ•ˆç‡éå¸¸ç¨³å®šï¼Œéƒ½æ˜¯è¦éå†åˆ°å¶å­ç»“ç‚¹ï¼Œè€Œ B æ ‘çš„æŸ¥è¯¢æ•ˆç‡å°±ä¸ç¨³å®šäº†ã€‚ å†å›ç­”ä¸ºä½•ä¸ç”¨çº¢é»‘æ ‘ã€AVL? çº¢é»‘æ ‘å’Œ AVL ç›¸æ¯” B+ æ¥è¯´ï¼Œæ ‘è¿‡é«˜ï¼Œè¿™æ ·å¸¦æ¥çš„ç›´æ¥å½±å“å°±æ˜¯ç£ç›˜ I/O æ¬¡æ•°çš„å¢å¤šã€‚ æ‹“å±•ï¼šæ•°æ®åº“ç³»ç»Ÿçš„è®¾è®¡è€…å·§å¦™åˆ©ç”¨äº†ç£ç›˜é¢„è¯»åŸç†ï¼Œå°†ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ä¸ºç­‰äºä¸€ä¸ªé¡µï¼Œè¿™æ ·æ¯ä¸ªèŠ‚ç‚¹åªéœ€è¦ä¸€æ¬¡I/Oå°±å¯ä»¥å®Œå…¨è½½å…¥ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œåœ¨å®é™…å®ç°B-Treeè¿˜éœ€è¦ä½¿ç”¨å¦‚ä¸‹æŠ€å·§ï¼šæ¯æ¬¡æ–°å»ºèŠ‚ç‚¹æ—¶ï¼Œç›´æ¥ç”³è¯·ä¸€ä¸ªé¡µçš„ç©ºé—´ï¼Œè¿™æ ·å°±ä¿è¯ä¸€ä¸ªèŠ‚ç‚¹ç‰©ç†ä¸Šä¹Ÿå­˜å‚¨åœ¨ä¸€ä¸ªé¡µé‡Œï¼ŒåŠ ä¹‹è®¡ç®—æœºå­˜å‚¨åˆ†é…éƒ½æ˜¯æŒ‰é¡µå¯¹é½çš„ï¼Œå°±å®ç°äº†ä¸€ä¸ªnodeåªéœ€ä¸€æ¬¡I/Oã€‚ å‰©ä¸‹çš„æ˜¯ç›´æ¥å¤åˆ¶åˆ«äººçš„åšå®¢ï¼š https://www.cnblogs.com/wenxiaofei/p/9853682.html åšå®¢å›­ https://www.nowcoder.com/discuss/135748?order=4&amp;pos=23&amp;type=0 ç‰›å®¢ç½‘ ä¸¤ä¸ªéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸ºäº†çœ‹å¾—æ›´æ–¹ä¾¿ï¼Œç›´æ¥å¤åˆ¶åˆ°æœ¬åœ°äº†ã€‚ æ•°æ®åº“é¢è¯•çŸ¥è¯†ç‚¹æ±‡æ€»ä¸€ã€åŸºæœ¬æ¦‚å¿µ1.ä¸»é”®ã€å¤–é”®ã€è¶…é”®ã€å€™é€‰é”® è¶…é”®ï¼šåœ¨å…³ç³»ä¸­èƒ½å”¯ä¸€æ ‡è¯†å…ƒç»„çš„å±æ€§é›†ç§°ä¸ºå…³ç³»æ¨¡å¼çš„è¶…é”®ã€‚ä¸€ä¸ªå±æ€§å¯ä»¥ä¸ºä½œä¸ºä¸€ä¸ªè¶…é”®ï¼Œå¤šä¸ªå±æ€§ç»„åˆåœ¨ä¸€èµ·ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªè¶…é”®ã€‚è¶…é”®åŒ…å«å€™é€‰é”®å’Œä¸»é”®ã€‚ å€™é€‰é”®ï¼šæ˜¯æœ€å°è¶…é”®ï¼Œå³æ²¡æœ‰å†—ä½™å…ƒç´ çš„è¶…é”®ã€‚ ä¸»é”®ï¼šæ•°æ®åº“è¡¨ä¸­å¯¹å‚¨å­˜æ•°æ®å¯¹è±¡äºˆä»¥å”¯ä¸€å’Œå®Œæ•´æ ‡è¯†çš„æ•°æ®åˆ—æˆ–å±æ€§çš„ç»„åˆã€‚ä¸€ä¸ªæ•°æ®åˆ—åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œä¸”ä¸»é”®çš„å–å€¼ä¸èƒ½ç¼ºå¤±ï¼Œå³ä¸èƒ½ä¸ºç©ºå€¼ï¼ˆNullï¼‰ã€‚ å¤–é”®ï¼šåœ¨ä¸€ä¸ªè¡¨ä¸­å­˜åœ¨çš„å¦ä¸€ä¸ªè¡¨çš„ä¸»é”®ç§°æ­¤è¡¨çš„å¤–é”®ã€‚ 2.ä¸ºä»€ä¹ˆç”¨è‡ªå¢åˆ—ä½œä¸ºä¸»é”® å¦‚æœæˆ‘ä»¬å®šä¹‰äº†ä¸»é”®(PRIMARY KEY)ï¼Œé‚£ä¹ˆInnoDBä¼šé€‰æ‹©ä¸»é”®ä½œä¸ºèšé›†ç´¢å¼•ã€ å¦‚æœæ²¡æœ‰æ˜¾å¼å®šä¹‰ä¸»é”®ï¼Œåˆ™InnoDBä¼šé€‰æ‹©ç¬¬ä¸€ä¸ªä¸åŒ…å«æœ‰NULLå€¼çš„å”¯ä¸€ç´¢å¼•ä½œä¸ºä¸»é”®ç´¢å¼•ã€ å¦‚æœä¹Ÿæ²¡æœ‰è¿™æ ·çš„å”¯ä¸€ç´¢å¼•ï¼Œåˆ™InnoDBä¼šé€‰æ‹©å†…ç½®6å­—èŠ‚é•¿çš„ROWIDä½œä¸ºéšå«çš„èšé›†ç´¢å¼•(ROWIDéšç€è¡Œè®°å½•çš„å†™å…¥è€Œä¸»é”®é€’å¢ï¼Œè¿™ä¸ªROWIDä¸åƒORACLEçš„ROWIDé‚£æ ·å¯å¼•ç”¨ï¼Œæ˜¯éšå«çš„)ã€‚ æ•°æ®è®°å½•æœ¬èº«è¢«å­˜äºä¸»ç´¢å¼•ï¼ˆä¸€é¢—B+Treeï¼‰çš„å¶å­èŠ‚ç‚¹ä¸Šã€‚è¿™å°±è¦æ±‚åŒä¸€ä¸ªå¶å­èŠ‚ç‚¹å†…ï¼ˆå¤§å°ä¸ºä¸€ä¸ªå†…å­˜é¡µæˆ–ç£ç›˜é¡µï¼‰çš„å„æ¡æ•°æ®è®°å½•æŒ‰ä¸»é”®é¡ºåºå­˜æ”¾ï¼Œå› æ­¤æ¯å½“æœ‰ä¸€æ¡æ–°çš„è®°å½•æ’å…¥æ—¶ï¼ŒMySQLä¼šæ ¹æ®å…¶ä¸»é”®å°†å…¶æ’å…¥é€‚å½“çš„èŠ‚ç‚¹å’Œä½ç½®ï¼Œå¦‚æœé¡µé¢è¾¾åˆ°è£…è½½å› å­ï¼ˆInnoDBé»˜è®¤ä¸º15/16ï¼‰ï¼Œåˆ™å¼€è¾Ÿä¸€ä¸ªæ–°çš„é¡µï¼ˆèŠ‚ç‚¹ï¼‰ å¦‚æœè¡¨ä½¿ç”¨è‡ªå¢ä¸»é”®ï¼Œé‚£ä¹ˆæ¯æ¬¡æ’å…¥æ–°çš„è®°å½•ï¼Œè®°å½•å°±ä¼šé¡ºåºæ·»åŠ åˆ°å½“å‰ç´¢å¼•èŠ‚ç‚¹çš„åç»­ä½ç½®ï¼Œå½“ä¸€é¡µå†™æ»¡ï¼Œå°±ä¼šè‡ªåŠ¨å¼€è¾Ÿä¸€ä¸ªæ–°çš„é¡µ å¦‚æœä½¿ç”¨éè‡ªå¢ä¸»é”®ï¼ˆå¦‚æœèº«ä»½è¯å·æˆ–å­¦å·ç­‰ï¼‰ï¼Œç”±äºæ¯æ¬¡æ’å…¥ä¸»é”®çš„å€¼è¿‘ä¼¼äºéšæœºï¼Œå› æ­¤æ¯æ¬¡æ–°çºªå½•éƒ½è¦è¢«æ’åˆ°ç°æœ‰ç´¢å¼•é¡µå¾—ä¸­é—´æŸä¸ªä½ç½®ï¼Œæ­¤æ—¶MySQLä¸å¾—ä¸ä¸ºäº†å°†æ–°è®°å½•æ’åˆ°åˆé€‚ä½ç½®è€Œç§»åŠ¨æ•°æ®ï¼Œç”šè‡³ç›®æ ‡é¡µé¢å¯èƒ½å·²ç»è¢«å›å†™åˆ°ç£ç›˜ä¸Šè€Œä»ç¼“å­˜ä¸­æ¸…æ‰ï¼Œæ­¤æ—¶åˆè¦ä»ç£ç›˜ä¸Šè¯»å›æ¥ï¼Œè¿™å¢åŠ äº†å¾ˆå¤šå¼€é”€ï¼ŒåŒæ—¶é¢‘ç¹çš„ç§»åŠ¨ã€åˆ†é¡µæ“ä½œé€ æˆäº†å¤§é‡çš„ç¢ç‰‡ï¼Œå¾—åˆ°äº†ä¸å¤Ÿç´§å‡‘çš„ç´¢å¼•ç»“æ„ï¼Œåç»­ä¸å¾—ä¸é€šè¿‡OPTIMIZE TABLEæ¥é‡å»ºè¡¨å¹¶ä¼˜åŒ–å¡«å……é¡µé¢ã€‚ 3.è§¦å‘å™¨çš„ä½œç”¨ï¼Ÿ è§¦å‘å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„å­˜å‚¨è¿‡ç¨‹ï¼Œä¸»è¦æ˜¯é€šè¿‡äº‹ä»¶æ¥è§¦å‘è€Œè¢«æ‰§è¡Œçš„ã€‚å®ƒå¯ä»¥å¼ºåŒ–çº¦æŸï¼Œæ¥ç»´æŠ¤æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œå¯ä»¥è·Ÿè¸ªæ•°æ®åº“å†…çš„æ“ä½œä»è€Œä¸å…è®¸æœªç»è®¸å¯çš„æ›´æ–°å’Œå˜åŒ–ã€‚å¯ä»¥è”çº§è¿ç®—ã€‚å¦‚ï¼ŒæŸè¡¨ä¸Šçš„è§¦å‘å™¨ä¸ŠåŒ…å«å¯¹å¦ä¸€ä¸ªè¡¨çš„æ•°æ®æ“ä½œï¼Œè€Œè¯¥æ“ä½œåˆä¼šå¯¼è‡´è¯¥è¡¨è§¦å‘å™¨è¢«è§¦å‘ã€‚ 4.ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿç”¨ä»€ä¹ˆæ¥è°ƒç”¨ï¼Ÿ å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€ä¸ªé¢„ç¼–è¯‘çš„SQLè¯­å¥ï¼Œä¼˜ç‚¹æ˜¯å…è®¸æ¨¡å—åŒ–çš„è®¾è®¡ï¼Œå°±æ˜¯è¯´åªéœ€åˆ›å»ºä¸€æ¬¡ï¼Œä»¥ååœ¨è¯¥ç¨‹åºä¸­å°±å¯ä»¥è°ƒç”¨å¤šæ¬¡ã€‚å¦‚æœæŸæ¬¡æ“ä½œéœ€è¦æ‰§è¡Œå¤šæ¬¡SQLï¼Œä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ¯”å•çº¯SQLè¯­å¥æ‰§è¡Œè¦å¿«ã€‚ è°ƒç”¨ï¼š 1ï¼‰å¯ä»¥ç”¨ä¸€ä¸ªå‘½ä»¤å¯¹è±¡æ¥è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ã€‚ 2ï¼‰å¯ä»¥ä¾›å¤–éƒ¨ç¨‹åºè°ƒç”¨ï¼Œæ¯”å¦‚ï¼šjavaç¨‹åºã€‚ 5.å­˜å‚¨è¿‡ç¨‹çš„ä¼˜ç¼ºç‚¹ï¼Ÿ ä¼˜ç‚¹ï¼š 1ï¼‰å­˜å‚¨è¿‡ç¨‹æ˜¯é¢„ç¼–è¯‘è¿‡çš„ï¼Œæ‰§è¡Œæ•ˆç‡é«˜ã€‚ 2ï¼‰å­˜å‚¨è¿‡ç¨‹çš„ä»£ç ç›´æ¥å­˜æ”¾äºæ•°æ®åº“ä¸­ï¼Œé€šè¿‡å­˜å‚¨è¿‡ç¨‹åç›´æ¥è°ƒç”¨ï¼Œå‡å°‘ç½‘ç»œé€šè®¯ã€‚ 3ï¼‰å®‰å…¨æ€§é«˜ï¼Œæ‰§è¡Œå­˜å‚¨è¿‡ç¨‹éœ€è¦æœ‰ä¸€å®šæƒé™çš„ç”¨æˆ·ã€‚ 4ï¼‰å­˜å‚¨è¿‡ç¨‹å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œå¯å‡å°‘æ•°æ®åº“å¼€å‘äººå‘˜çš„å·¥ä½œé‡ã€‚ ç¼ºç‚¹ï¼šç§»æ¤æ€§å·® 6.å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°çš„åŒºåˆ« 7.ä»€ä¹ˆå«è§†å›¾ï¼Ÿæ¸¸æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ è§†å›¾ï¼š æ˜¯ä¸€ç§è™šæ‹Ÿçš„è¡¨ï¼Œå…·æœ‰å’Œç‰©ç†è¡¨ç›¸åŒçš„åŠŸèƒ½ã€‚å¯ä»¥å¯¹è§†å›¾è¿›è¡Œå¢ï¼Œæ”¹ï¼ŒæŸ¥ï¼Œæ“ä½œï¼Œè¯•å›¾é€šå¸¸æ˜¯æœ‰ä¸€ä¸ªè¡¨æˆ–è€…å¤šä¸ªè¡¨çš„è¡Œæˆ–åˆ—çš„å­é›†ã€‚å¯¹è§†å›¾çš„ä¿®æ”¹ä¼šå½±å“åŸºæœ¬è¡¨ã€‚å®ƒä½¿å¾—æˆ‘ä»¬è·å–æ•°æ®æ›´å®¹æ˜“ï¼Œç›¸æ¯”å¤šè¡¨æŸ¥è¯¢ã€‚ æ¸¸æ ‡ï¼š æ˜¯å¯¹æŸ¥è¯¢å‡ºæ¥çš„ç»“æœé›†ä½œä¸ºä¸€ä¸ªå•å…ƒæ¥æœ‰æ•ˆçš„å¤„ç†ã€‚æ¸¸æ ‡å¯ä»¥å®šåœ¨è¯¥å•å…ƒä¸­çš„ç‰¹å®šè¡Œï¼Œä»ç»“æœé›†çš„å½“å‰è¡Œæ£€ç´¢ä¸€è¡Œæˆ–å¤šè¡Œã€‚å¯ä»¥å¯¹ç»“æœé›†å½“å‰è¡Œåšä¿®æ”¹ã€‚ä¸€èˆ¬ä¸ä½¿ç”¨æ¸¸æ ‡ï¼Œä½†æ˜¯éœ€è¦é€æ¡å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œæ¸¸æ ‡æ˜¾å¾—ååˆ†é‡è¦ã€‚ 8.è§†å›¾çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š 1å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œå› ä¸ºè§†å›¾å¯ä»¥æœ‰é€‰æ‹©æ€§çš„é€‰å–æ•°æ®åº“é‡Œçš„ä¸€éƒ¨åˆ†ã€‚ 2)ç”¨æˆ·é€šè¿‡ç®€å•çš„æŸ¥è¯¢å¯ä»¥ä»å¤æ‚æŸ¥è¯¢ä¸­å¾—åˆ°ç»“æœã€‚ 3)ç»´æŠ¤æ•°æ®çš„ç‹¬ç«‹æ€§ï¼Œè¯•å›¾å¯ä»å¤šä¸ªè¡¨æ£€ç´¢æ•°æ®ã€‚ 4)å¯¹äºç›¸åŒçš„æ•°æ®å¯äº§ç”Ÿä¸åŒçš„è§†å›¾ã€‚ ç¼ºç‚¹ï¼š æ€§èƒ½ï¼šæŸ¥è¯¢è§†å›¾æ—¶ï¼Œå¿…é¡»æŠŠè§†å›¾çš„æŸ¥è¯¢è½¬åŒ–æˆå¯¹åŸºæœ¬è¡¨çš„æŸ¥è¯¢ï¼Œå¦‚æœè¿™ä¸ªè§†å›¾æ˜¯ç”±ä¸€ä¸ªå¤æ‚çš„å¤šè¡¨æŸ¥è¯¢æ‰€å®šä¹‰ï¼Œé‚£ä¹ˆï¼Œé‚£ä¹ˆå°±æ— æ³•æ›´æ”¹æ•°æ® 9.dropã€truncateã€ deleteåŒºåˆ« æœ€åŸºæœ¬ï¼š dropç›´æ¥åˆ æ‰è¡¨ã€‚ truncateåˆ é™¤è¡¨ä¸­æ•°æ®ï¼Œå†æ’å…¥æ—¶è‡ªå¢é•¿idåˆä»1å¼€å§‹ã€‚ deleteåˆ é™¤è¡¨ä¸­æ•°æ®ï¼Œå¯ä»¥åŠ whereå­—å¥ã€‚ ï¼ˆ1ï¼‰ DELETEè¯­å¥æ‰§è¡Œåˆ é™¤çš„è¿‡ç¨‹æ˜¯æ¯æ¬¡ä»è¡¨ä¸­åˆ é™¤ä¸€è¡Œï¼Œå¹¶ä¸”åŒæ—¶å°†è¯¥è¡Œçš„åˆ é™¤æ“ä½œä½œä¸ºäº‹åŠ¡è®°å½•åœ¨æ—¥å¿—ä¸­ä¿å­˜ä»¥ä¾¿è¿›è¡Œè¿›è¡Œå›æ»šæ“ä½œã€‚TRUNCATE TABLE åˆ™ä¸€æ¬¡æ€§åœ°ä»è¡¨ä¸­åˆ é™¤æ‰€æœ‰çš„æ•°æ®å¹¶ä¸æŠŠå•ç‹¬çš„åˆ é™¤æ“ä½œè®°å½•è®°å…¥æ—¥å¿—ä¿å­˜ï¼Œåˆ é™¤è¡Œæ˜¯ä¸èƒ½æ¢å¤çš„ã€‚å¹¶ä¸”åœ¨åˆ é™¤çš„è¿‡ç¨‹ä¸­ä¸ä¼šæ¿€æ´»ä¸è¡¨æœ‰å…³çš„åˆ é™¤è§¦å‘å™¨ã€‚æ‰§è¡Œé€Ÿåº¦å¿«ã€‚ ï¼ˆ2ï¼‰ è¡¨å’Œç´¢å¼•æ‰€å ç©ºé—´ã€‚å½“è¡¨è¢«TRUNCATE åï¼Œè¿™ä¸ªè¡¨å’Œç´¢å¼•æ‰€å ç”¨çš„ç©ºé—´ä¼šæ¢å¤åˆ°åˆå§‹å¤§å°ï¼Œè€ŒDELETEæ“ä½œä¸ä¼šå‡å°‘è¡¨æˆ–ç´¢å¼•æ‰€å ç”¨çš„ç©ºé—´ã€‚dropè¯­å¥å°†è¡¨æ‰€å ç”¨çš„ç©ºé—´å…¨é‡Šæ”¾æ‰ã€‚ ï¼ˆ3ï¼‰ ä¸€èˆ¬è€Œè¨€ï¼Œdrop &gt; truncate &gt; delete ï¼ˆ4ï¼‰ åº”ç”¨èŒƒå›´ã€‚TRUNCATE åªèƒ½å¯¹TABLEï¼›DELETEå¯ä»¥æ˜¯tableå’Œview ï¼ˆ5ï¼‰ TRUNCATE å’ŒDELETEåªåˆ é™¤æ•°æ®ï¼Œè€ŒDROPåˆ™åˆ é™¤æ•´ä¸ªè¡¨ï¼ˆç»“æ„å’Œæ•°æ®ï¼‰ã€‚ ï¼ˆ6ï¼‰ truncateä¸ä¸å¸¦whereçš„delete ï¼šåªåˆ é™¤æ•°æ®ï¼Œè€Œä¸åˆ é™¤è¡¨çš„ç»“æ„ï¼ˆå®šä¹‰ï¼‰dropè¯­å¥å°†åˆ é™¤è¡¨çš„ç»“æ„è¢«ä¾èµ–çš„çº¦æŸï¼ˆconstrain),è§¦å‘å™¨ï¼ˆtrigger)ç´¢å¼•ï¼ˆindex);ä¾èµ–äºè¯¥è¡¨çš„å­˜å‚¨è¿‡ç¨‹/å‡½æ•°å°†è¢«ä¿ç•™ï¼Œä½†å…¶çŠ¶æ€ä¼šå˜ä¸ºï¼šinvalidã€‚ ï¼ˆ7ï¼‰ deleteè¯­å¥ä¸ºDMLï¼ˆdata maintain Language),è¿™ä¸ªæ“ä½œä¼šè¢«æ”¾åˆ° rollback segmentä¸­,äº‹åŠ¡æäº¤åæ‰ç”Ÿæ•ˆã€‚å¦‚æœæœ‰ç›¸åº”çš„ tigger,æ‰§è¡Œçš„æ—¶å€™å°†è¢«è§¦å‘ã€‚ ï¼ˆ8ï¼‰ truncateã€dropæ˜¯DLLï¼ˆdata define language),æ“ä½œç«‹å³ç”Ÿæ•ˆï¼ŒåŸæ•°æ®ä¸æ”¾åˆ° rollback segmentä¸­ï¼Œä¸èƒ½å›æ»šã€‚ ï¼ˆ9ï¼‰ åœ¨æ²¡æœ‰å¤‡ä»½æƒ…å†µä¸‹ï¼Œè°¨æ…ä½¿ç”¨ drop ä¸ truncateã€‚è¦åˆ é™¤éƒ¨åˆ†æ•°æ®è¡Œé‡‡ç”¨deleteä¸”æ³¨æ„ç»“åˆwhereæ¥çº¦æŸå½±å“èŒƒå›´ã€‚å›æ»šæ®µè¦è¶³å¤Ÿå¤§ã€‚è¦åˆ é™¤è¡¨ç”¨drop;è‹¥æƒ³ä¿ç•™è¡¨è€Œå°†è¡¨ä¸­æ•°æ®åˆ é™¤ï¼Œå¦‚æœäºäº‹åŠ¡æ— å…³ï¼Œç”¨truncateå³å¯å®ç°ã€‚å¦‚æœå’Œäº‹åŠ¡æœ‰å…³ï¼Œæˆ–è€å¸ˆæƒ³è§¦å‘trigger,è¿˜æ˜¯ç”¨deleteã€‚ ï¼ˆ10ï¼‰ Truncate table è¡¨å é€Ÿåº¦å¿«,è€Œä¸”æ•ˆç‡é«˜,å› ä¸º:truncate table åœ¨åŠŸèƒ½ä¸Šä¸ä¸å¸¦ WHERE å­å¥çš„ DELETE è¯­å¥ç›¸åŒï¼šäºŒè€…å‡åˆ é™¤è¡¨ä¸­çš„å…¨éƒ¨è¡Œã€‚ä½† TRUNCATE TABLE æ¯” DELETE é€Ÿåº¦å¿«ï¼Œä¸”ä½¿ç”¨çš„ç³»ç»Ÿå’Œäº‹åŠ¡æ—¥å¿—èµ„æºå°‘ã€‚DELETE è¯­å¥æ¯æ¬¡åˆ é™¤ä¸€è¡Œï¼Œå¹¶åœ¨äº‹åŠ¡æ—¥å¿—ä¸­ä¸ºæ‰€åˆ é™¤çš„æ¯è¡Œè®°å½•ä¸€é¡¹ã€‚TRUNCATE TABLE é€šè¿‡é‡Šæ”¾å­˜å‚¨è¡¨æ•°æ®æ‰€ç”¨çš„æ•°æ®é¡µæ¥åˆ é™¤æ•°æ®ï¼Œå¹¶ä¸”åªåœ¨äº‹åŠ¡æ—¥å¿—ä¸­è®°å½•é¡µçš„é‡Šæ”¾ã€‚ ï¼ˆ11ï¼‰ TRUNCATE TABLE åˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œä½†è¡¨ç»“æ„åŠå…¶åˆ—ã€çº¦æŸã€ç´¢å¼•ç­‰ä¿æŒä¸å˜ã€‚æ–°è¡Œæ ‡è¯†æ‰€ç”¨çš„è®¡æ•°å€¼é‡ç½®ä¸ºè¯¥åˆ—çš„ç§å­ã€‚å¦‚æœæƒ³ä¿ç•™æ ‡è¯†è®¡æ•°å€¼ï¼Œè¯·æ”¹ç”¨ DELETEã€‚å¦‚æœè¦åˆ é™¤è¡¨å®šä¹‰åŠå…¶æ•°æ®ï¼Œè¯·ä½¿ç”¨ DROP TABLE è¯­å¥ã€‚ ï¼ˆ12ï¼‰ å¯¹äºç”± FOREIGN KEY çº¦æŸå¼•ç”¨çš„è¡¨ï¼Œä¸èƒ½ä½¿ç”¨ TRUNCATE TABLEï¼Œè€Œåº”ä½¿ç”¨ä¸å¸¦ WHERE å­å¥çš„ DELETE è¯­å¥ã€‚ç”±äº TRUNCATE TABLE ä¸è®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œæ‰€ä»¥å®ƒä¸èƒ½æ¿€æ´»è§¦å‘å™¨ã€‚ 10.ä»€ä¹ˆæ˜¯ä¸´æ—¶è¡¨ï¼Œä¸´æ—¶è¡¨ä»€ä¹ˆæ—¶å€™åˆ é™¤? ä¸´æ—¶è¡¨å¯ä»¥æ‰‹åŠ¨åˆ é™¤ï¼šDROP TEMPORARY TABLE IF EXISTS temp_tb; ä¸´æ—¶è¡¨åªåœ¨å½“å‰è¿æ¥å¯è§ï¼Œå½“å…³é—­è¿æ¥æ—¶ï¼ŒMySQLä¼šè‡ªåŠ¨åˆ é™¤è¡¨å¹¶é‡Šæ”¾æ‰€æœ‰ç©ºé—´ã€‚å› æ­¤åœ¨ä¸åŒçš„è¿æ¥ä¸­å¯ä»¥åˆ›å»ºåŒåçš„ä¸´æ—¶è¡¨ï¼Œå¹¶ä¸”æ“ä½œå±äºæœ¬è¿æ¥çš„ä¸´æ—¶è¡¨ã€‚åˆ›å»ºä¸´æ—¶è¡¨çš„è¯­æ³•ä¸åˆ›å»ºè¡¨è¯­æ³•ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„æ˜¯å¢åŠ å…³é”®å­—TEMPORARYï¼Œ å¦‚ï¼š CREATE TEMPORARY TABLE tmp_table ( NAME VARCHAR (10) NOT NULL, time date NOT NULL); select * from tmp_table; 11.éå…³ç³»å‹æ•°æ®åº“å’Œå…³ç³»å‹æ•°æ®åº“åŒºåˆ«ï¼Œä¼˜åŠ¿æ¯”è¾ƒ? éå…³ç³»å‹æ•°æ®åº“çš„ä¼˜åŠ¿ï¼š æ€§èƒ½ï¼šNOSQLæ˜¯åŸºäºé”®å€¼å¯¹çš„ï¼Œå¯ä»¥æƒ³è±¡æˆè¡¨ä¸­çš„ä¸»é”®å’Œå€¼çš„å¯¹åº”å…³ç³»ï¼Œè€Œä¸”ä¸éœ€è¦ç»è¿‡SQLå±‚çš„è§£æï¼Œæ‰€ä»¥æ€§èƒ½éå¸¸é«˜ã€‚ å¯æ‰©å±•æ€§ï¼šåŒæ ·ä¹Ÿæ˜¯å› ä¸ºåŸºäºé”®å€¼å¯¹ï¼Œæ•°æ®ä¹‹é—´æ²¡æœ‰è€¦åˆæ€§ï¼Œæ‰€ä»¥éå¸¸å®¹æ˜“æ°´å¹³æ‰©å±•ã€‚ å…³ç³»å‹æ•°æ®åº“çš„ä¼˜åŠ¿ï¼š å¤æ‚æŸ¥è¯¢ï¼šå¯ä»¥ç”¨SQLè¯­å¥æ–¹ä¾¿çš„åœ¨ä¸€ä¸ªè¡¨ä»¥åŠå¤šä¸ªè¡¨ä¹‹é—´åšéå¸¸å¤æ‚çš„æ•°æ®æŸ¥è¯¢ã€‚ äº‹åŠ¡æ”¯æŒï¼šä½¿å¾—å¯¹äºå®‰å…¨æ€§èƒ½å¾ˆé«˜çš„æ•°æ®è®¿é—®è¦æ±‚å¾—ä»¥å®ç°ã€‚ å…¶ä»–ï¼š 1.å¯¹äºè¿™ä¸¤ç±»æ•°æ®åº“ï¼Œå¯¹æ–¹çš„ä¼˜åŠ¿å°±æ˜¯è‡ªå·±çš„å¼±åŠ¿ï¼Œåä¹‹äº¦ç„¶ã€‚ 2.NOSQLæ•°æ®åº“æ…¢æ…¢å¼€å§‹å…·å¤‡SQLæ•°æ®åº“çš„ä¸€äº›å¤æ‚æŸ¥è¯¢åŠŸèƒ½ï¼Œæ¯”å¦‚MongoDBã€‚ 3.å¯¹äºäº‹åŠ¡çš„æ”¯æŒä¹Ÿå¯ä»¥ç”¨ä¸€äº›ç³»ç»Ÿçº§çš„åŸå­æ“ä½œæ¥å®ç°ä¾‹å¦‚ä¹è§‚é”ä¹‹ç±»çš„æ–¹æ³•æ¥æ›²çº¿æ•‘å›½ï¼Œæ¯”å¦‚Redis set nxã€‚ 12.æ•°æ®åº“èŒƒå¼ï¼Œæ ¹æ®æŸä¸ªåœºæ™¯è®¾è®¡æ•°æ®è¡¨? ç¬¬ä¸€èŒƒå¼:(ç¡®ä¿æ¯åˆ—ä¿æŒåŸå­æ€§)æ‰€æœ‰å­—æ®µå€¼éƒ½æ˜¯ä¸å¯åˆ†è§£çš„åŸå­å€¼ã€‚ ç¬¬ä¸€èŒƒå¼æ˜¯æœ€åŸºæœ¬çš„èŒƒå¼ã€‚å¦‚æœæ•°æ®åº“è¡¨ä¸­çš„æ‰€æœ‰å­—æ®µå€¼éƒ½æ˜¯ä¸å¯åˆ†è§£çš„åŸå­å€¼ï¼Œå°±è¯´æ˜è¯¥æ•°æ®åº“è¡¨æ»¡è¶³äº†ç¬¬ä¸€èŒƒå¼ã€‚ç¬¬ä¸€èŒƒå¼çš„åˆç†éµå¾ªéœ€è¦æ ¹æ®ç³»ç»Ÿçš„å®é™…éœ€æ±‚æ¥å®šã€‚æ¯”å¦‚æŸäº›æ•°æ®åº“ç³»ç»Ÿä¸­éœ€è¦ç”¨åˆ°â€œåœ°å€â€è¿™ä¸ªå±æ€§ï¼Œæœ¬æ¥ç›´æ¥å°†â€œåœ°å€â€å±æ€§è®¾è®¡æˆä¸€ä¸ªæ•°æ®åº“è¡¨çš„å­—æ®µå°±è¡Œã€‚ä½†æ˜¯å¦‚æœç³»ç»Ÿç»å¸¸ä¼šè®¿é—®â€œåœ°å€â€å±æ€§ä¸­çš„â€œåŸå¸‚â€éƒ¨åˆ†ï¼Œé‚£ä¹ˆå°±éè¦å°†â€œåœ°å€â€è¿™ä¸ªå±æ€§é‡æ–°æ‹†åˆ†ä¸ºçœä»½ã€åŸå¸‚ã€è¯¦ç»†åœ°å€ç­‰å¤šä¸ªéƒ¨åˆ†è¿›è¡Œå­˜å‚¨ï¼Œè¿™æ ·åœ¨å¯¹åœ°å€ä¸­æŸä¸€éƒ¨åˆ†æ“ä½œçš„æ—¶å€™å°†éå¸¸æ–¹ä¾¿ã€‚è¿™æ ·è®¾è®¡æ‰ç®—æ»¡è¶³äº†æ•°æ®åº“çš„ç¬¬ä¸€èŒƒå¼ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚ä¸Šè¡¨æ‰€ç¤ºçš„ç”¨æˆ·ä¿¡æ¯éµå¾ªäº†ç¬¬ä¸€èŒƒå¼çš„è¦æ±‚ï¼Œè¿™æ ·åœ¨å¯¹ç”¨æˆ·ä½¿ç”¨åŸå¸‚è¿›è¡Œåˆ†ç±»çš„æ—¶å€™å°±éå¸¸æ–¹ä¾¿ï¼Œä¹Ÿæé«˜äº†æ•°æ®åº“çš„æ€§èƒ½ã€‚ ç¬¬äºŒèŒƒå¼:(ç¡®ä¿è¡¨ä¸­çš„æ¯åˆ—éƒ½å’Œä¸»é”®ç›¸å…³)åœ¨ä¸€ä¸ªæ•°æ®åº“è¡¨ä¸­ï¼Œä¸€ä¸ªè¡¨ä¸­åªèƒ½ä¿å­˜ä¸€ç§æ•°æ®ï¼Œä¸å¯ä»¥æŠŠå¤šç§æ•°æ®ä¿å­˜åœ¨åŒä¸€å¼ æ•°æ®åº“è¡¨ä¸­ã€‚ ç¬¬äºŒèŒƒå¼åœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¹‹ä¸Šæ›´è¿›ä¸€å±‚ã€‚ç¬¬äºŒèŒƒå¼éœ€è¦ç¡®ä¿æ•°æ®åº“è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å’Œä¸»é”®ç›¸å…³ï¼Œè€Œä¸èƒ½åªä¸ä¸»é”®çš„æŸä¸€éƒ¨åˆ†ç›¸å…³ï¼ˆä¸»è¦é’ˆå¯¹è”åˆä¸»é”®è€Œè¨€ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€ä¸ªæ•°æ®åº“è¡¨ä¸­ï¼Œä¸€ä¸ªè¡¨ä¸­åªèƒ½ä¿å­˜ä¸€ç§æ•°æ®ï¼Œä¸å¯ä»¥æŠŠå¤šç§æ•°æ®ä¿å­˜åœ¨åŒä¸€å¼ æ•°æ®åº“è¡¨ä¸­ã€‚æ¯”å¦‚è¦è®¾è®¡ä¸€ä¸ªè®¢å•ä¿¡æ¯è¡¨ï¼Œå› ä¸ºè®¢å•ä¸­å¯èƒ½ä¼šæœ‰å¤šç§å•†å“ï¼Œæ‰€ä»¥è¦å°†è®¢å•ç¼–å·å’Œå•†å“ç¼–å·ä½œä¸ºæ•°æ®åº“è¡¨çš„è”åˆä¸»é”®ã€‚ ç¬¬ä¸‰èŒƒå¼:(ç¡®ä¿æ¯åˆ—éƒ½å’Œä¸»é”®åˆ—ç›´æ¥ç›¸å…³,è€Œä¸æ˜¯é—´æ¥ç›¸å…³) æ•°æ®è¡¨ä¸­çš„æ¯ä¸€åˆ—æ•°æ®éƒ½å’Œä¸»é”®ç›´æ¥ç›¸å…³ï¼Œè€Œä¸èƒ½é—´æ¥ç›¸å…³ã€‚ ç¬¬ä¸‰èŒƒå¼éœ€è¦ç¡®ä¿æ•°æ®è¡¨ä¸­çš„æ¯ä¸€åˆ—æ•°æ®éƒ½å’Œä¸»é”®ç›´æ¥ç›¸å…³ï¼Œè€Œä¸èƒ½é—´æ¥ç›¸å…³ã€‚æ¯”å¦‚åœ¨è®¾è®¡ä¸€ä¸ªè®¢å•æ•°æ®è¡¨çš„æ—¶å€™ï¼Œå¯ä»¥å°†å®¢æˆ·ç¼–å·ä½œä¸ºä¸€ä¸ªå¤–é”®å’Œè®¢å•è¡¨å»ºç«‹ç›¸åº”çš„å…³ç³»ã€‚è€Œä¸å¯ä»¥åœ¨è®¢å•è¡¨ä¸­æ·»åŠ å…³äºå®¢æˆ·å…¶å®ƒä¿¡æ¯ï¼ˆæ¯”å¦‚å§“åã€æ‰€å±å…¬å¸ç­‰ï¼‰çš„å­—æ®µã€‚ BCNF:ç¬¦åˆ3NFï¼Œå¹¶ä¸”ï¼Œä¸»å±æ€§ä¸ä¾èµ–äºä¸»å±æ€§ã€‚ è‹¥å…³ç³»æ¨¡å¼å±äºç¬¬äºŒèŒƒå¼ï¼Œä¸”æ¯ä¸ªå±æ€§éƒ½ä¸ä¼ é€’ä¾èµ–äºé”®ç ï¼Œåˆ™Rå±äºBCèŒƒå¼ã€‚é€šå¸¸BCèŒƒå¼çš„æ¡ä»¶æœ‰å¤šç§ç­‰ä»·çš„è¡¨è¿°ï¼šæ¯ä¸ªéå¹³å‡¡ä¾èµ–çš„å·¦è¾¹å¿…é¡»åŒ…å«é”®ç ï¼›æ¯ä¸ªå†³å®šå› ç´ å¿…é¡»åŒ…å«é”®ç ã€‚BCèŒƒå¼æ—¢æ£€æŸ¥éä¸»å±æ€§ï¼Œåˆæ£€æŸ¥ä¸»å±æ€§ã€‚å½“åªæ£€æŸ¥éä¸»å±æ€§æ—¶ï¼Œå°±æˆäº†ç¬¬ä¸‰èŒƒå¼ã€‚æ»¡è¶³BCèŒƒå¼çš„å…³ç³»éƒ½å¿…ç„¶æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ã€‚è¿˜å¯ä»¥è¿™ä¹ˆè¯´ï¼šè‹¥ä¸€ä¸ªå…³ç³»è¾¾åˆ°äº†ç¬¬ä¸‰èŒƒå¼ï¼Œå¹¶ä¸”å®ƒåªæœ‰ä¸€ä¸ªå€™é€‰ç ï¼Œæˆ–è€…å®ƒçš„æ¯ä¸ªå€™é€‰ç éƒ½æ˜¯å•å±æ€§ï¼Œåˆ™è¯¥å…³ç³»è‡ªç„¶è¾¾åˆ°BCèŒƒå¼ã€‚ä¸€èˆ¬ï¼Œä¸€ä¸ªæ•°æ®åº“è®¾è®¡ç¬¦åˆ3NFæˆ–BCNFå°±å¯ä»¥äº†ã€‚ ç¬¬å››èŒƒå¼:è¦æ±‚æŠŠåŒä¸€è¡¨å†…çš„å¤šå¯¹å¤šå…³ç³»åˆ é™¤ã€‚ ç¬¬äº”èŒƒå¼:ä»æœ€ç»ˆç»“æ„é‡æ–°å»ºç«‹åŸå§‹ç»“æ„ã€‚ 13.ä»€ä¹ˆæ˜¯ å†…è¿æ¥ã€å¤–è¿æ¥ã€äº¤å‰è¿æ¥ã€ç¬›å¡å°”ç§¯ç­‰? å†…è¿æ¥: åªè¿æ¥åŒ¹é…çš„è¡Œ å·¦å¤–è¿æ¥: åŒ…å«å·¦è¾¹è¡¨çš„å…¨éƒ¨è¡Œï¼ˆä¸ç®¡å³è¾¹çš„è¡¨ä¸­æ˜¯å¦å­˜åœ¨ä¸å®ƒä»¬åŒ¹é…çš„è¡Œï¼‰ï¼Œä»¥åŠå³è¾¹è¡¨ä¸­å…¨éƒ¨åŒ¹é…çš„è¡Œ å³å¤–è¿æ¥: åŒ…å«å³è¾¹è¡¨çš„å…¨éƒ¨è¡Œï¼ˆä¸ç®¡å·¦è¾¹çš„è¡¨ä¸­æ˜¯å¦å­˜åœ¨ä¸å®ƒä»¬åŒ¹é…çš„è¡Œï¼‰ï¼Œä»¥åŠå·¦è¾¹è¡¨ä¸­å…¨éƒ¨åŒ¹é…çš„è¡Œ ä¾‹å¦‚1ï¼šSELECT a.,b. FROM luntan LEFT JOIN usertable as b ON a.username=b.username ä¾‹å¦‚2ï¼šSELECT a.,b. FROM city as a FULL OUTER JOIN user as b ON a.username=b.username å…¨å¤–è¿æ¥: åŒ…å«å·¦ã€å³ä¸¤ä¸ªè¡¨çš„å…¨éƒ¨è¡Œï¼Œä¸ç®¡å¦å¤–ä¸€è¾¹çš„è¡¨ä¸­æ˜¯å¦å­˜åœ¨ä¸å®ƒä»¬åŒ¹é…çš„è¡Œã€‚ äº¤å‰è¿æ¥: ç”Ÿæˆç¬›å¡å°”ç§¯ï¼å®ƒä¸ä½¿ç”¨ä»»ä½•åŒ¹é…æˆ–è€…é€‰å–æ¡ä»¶ï¼Œè€Œæ˜¯ç›´æ¥å°†ä¸€ä¸ªæ•°æ®æºä¸­çš„æ¯ä¸ªè¡Œä¸å¦ä¸€ä¸ªæ•°æ®æºçš„æ¯ä¸ªè¡Œéƒ½ä¸€ä¸€åŒ¹é… ä¾‹å¦‚ï¼šSELECT type,pub_name FROM titles CROSS JOIN publishers ORDER BY type æ³¨æ„ï¼š å¾ˆå¤šå…¬å¸éƒ½åªæ˜¯è€ƒå¯Ÿæ˜¯å¦çŸ¥é“å…¶æ¦‚å¿µï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šå…¬å¸éœ€è¦ä¸ä»…ä»…çŸ¥é“æ¦‚å¿µï¼Œè¿˜éœ€è¦åŠ¨æ‰‹å†™sql,ä¸€èˆ¬éƒ½æ˜¯ç®€å•çš„è¿æ¥æŸ¥è¯¢ï¼Œå…·ä½“å…³äºè¿æ¥æŸ¥è¯¢çš„sqlç»ƒä¹ ï¼Œå‚è§ä»¥ä¸‹é“¾æ¥ï¼š ç‰›å®¢ç½‘æ•°æ®åº“SQLå®æˆ˜ leetcodeä¸­æ–‡ç½‘ç«™æ•°æ®åº“ç»ƒä¹  14.varcharå’Œcharçš„ä½¿ç”¨åœºæ™¯? 1.charçš„é•¿åº¦æ˜¯ä¸å¯å˜çš„ï¼Œè€Œvarcharçš„é•¿åº¦æ˜¯å¯å˜çš„ã€‚ å®šä¹‰ä¸€ä¸ªchar[10]å’Œvarchar[10]ã€‚å¦‚æœå­˜è¿›å»çš„æ˜¯â€˜csdnâ€™,é‚£ä¹ˆcharæ‰€å çš„é•¿åº¦ä¾ç„¶ä¸º10ï¼Œé™¤äº†å­—ç¬¦â€˜csdnâ€™å¤–ï¼Œåé¢è·Ÿå…­ä¸ªç©ºæ ¼ï¼Œvarcharå°±ç«‹é©¬æŠŠé•¿åº¦å˜ä¸º4äº†ï¼Œå–æ•°æ®çš„æ—¶å€™ï¼Œcharç±»å‹çš„è¦ç”¨trim()å»æ‰å¤šä½™çš„ç©ºæ ¼ï¼Œè€Œvarcharæ˜¯ä¸éœ€è¦çš„ã€‚ 2.charçš„å­˜å–æ•°åº¦è¿˜æ˜¯è¦æ¯”varcharè¦å¿«å¾—å¤šï¼Œå› ä¸ºå…¶é•¿åº¦å›ºå®šï¼Œæ–¹ä¾¿ç¨‹åºçš„å­˜å‚¨ä¸æŸ¥æ‰¾ã€‚charä¹Ÿä¸ºæ­¤ä»˜å‡ºçš„æ˜¯ç©ºé—´çš„ä»£ä»·ï¼Œå› ä¸ºå…¶é•¿åº¦å›ºå®šï¼Œæ‰€ä»¥éš¾å…ä¼šæœ‰å¤šä½™çš„ç©ºæ ¼å ä½ç¬¦å æ®ç©ºé—´ï¼Œå¯è°“æ˜¯ä»¥ç©ºé—´æ¢å–æ—¶é—´æ•ˆç‡ã€‚varcharæ˜¯ä»¥ç©ºé—´æ•ˆç‡ä¸ºé¦–ä½ã€‚ 3.charçš„å­˜å‚¨æ–¹å¼æ˜¯ï¼šå¯¹è‹±æ–‡å­—ç¬¦ï¼ˆASCIIï¼‰å ç”¨1ä¸ªå­—èŠ‚ï¼Œå¯¹ä¸€ä¸ªæ±‰å­—å ç”¨ä¸¤ä¸ªå­—èŠ‚ã€‚varcharçš„å­˜å‚¨æ–¹å¼æ˜¯ï¼šå¯¹æ¯ä¸ªè‹±æ–‡å­—ç¬¦å ç”¨2ä¸ªå­—èŠ‚ï¼Œæ±‰å­—ä¹Ÿå ç”¨2ä¸ªå­—èŠ‚ã€‚ 4.ä¸¤è€…çš„å­˜å‚¨æ•°æ®éƒ½éunicodeçš„å­—ç¬¦æ•°æ®ã€‚ 15.SQLè¯­è¨€åˆ†ç±» SQLè¯­è¨€å…±åˆ†ä¸ºå››å¤§ç±»ï¼š æ•°æ®æŸ¥è¯¢è¯­è¨€DQL æ•°æ®æ“çºµè¯­è¨€DML æ•°æ®å®šä¹‰è¯­è¨€DDL æ•°æ®æ§åˆ¶è¯­è¨€DCLã€‚ 1. æ•°æ®æŸ¥è¯¢è¯­è¨€DQL æ•°æ®æŸ¥è¯¢è¯­è¨€DQLåŸºæœ¬ç»“æ„æ˜¯ç”±SELECTå­å¥ï¼ŒFROMå­å¥ï¼ŒWHEREå­å¥ç»„æˆçš„æŸ¥è¯¢å—ï¼š SELECTFROMWHERE 2 .æ•°æ®æ“çºµè¯­è¨€DML æ•°æ®æ“çºµè¯­è¨€DMLä¸»è¦æœ‰ä¸‰ç§å½¢å¼ï¼š 1) æ’å…¥ï¼šINSERT 2) æ›´æ–°ï¼šUPDATE 3) åˆ é™¤ï¼šDELETE 3. æ•°æ®å®šä¹‰è¯­è¨€DDL æ•°æ®å®šä¹‰è¯­è¨€DDLç”¨æ¥åˆ›å»ºæ•°æ®åº“ä¸­çš„å„ç§å¯¹è±¡â€”â€“è¡¨ã€è§†å›¾ã€ç´¢å¼•ã€åŒä¹‰è¯ã€èšç°‡ç­‰å¦‚ï¼šCREATE TABLE/VIEW/INDEX/SYN/CLUSTER è¡¨ è§†å›¾ ç´¢å¼• åŒä¹‰è¯ ç°‡ DDLæ“ä½œæ˜¯éšæ€§æäº¤çš„ï¼ä¸èƒ½rollback 4. æ•°æ®æ§åˆ¶è¯­è¨€DCL æ•°æ®æ§åˆ¶è¯­è¨€DCLç”¨æ¥æˆäºˆæˆ–å›æ”¶è®¿é—®æ•°æ®åº“çš„æŸç§ç‰¹æƒï¼Œå¹¶æ§åˆ¶æ•°æ®åº“æ“çºµäº‹åŠ¡å‘ç”Ÿçš„æ—¶é—´åŠæ•ˆæœï¼Œå¯¹æ•°æ®åº“å®è¡Œç›‘è§†ç­‰ã€‚å¦‚ï¼š 1) GRANTï¼šæˆæƒã€‚ 2) ROLLBACK [WORK] TO [SAVEPOINT]ï¼šå›é€€åˆ°æŸä¸€ç‚¹ã€‚å›æ»šâ€”ROLLBACKï¼›å›æ»šå‘½ä»¤ä½¿æ•°æ®åº“çŠ¶æ€å›åˆ°ä¸Šæ¬¡æœ€åæäº¤çš„çŠ¶æ€ã€‚å…¶æ ¼å¼ä¸ºï¼šSQL&gt;ROLLBACK; 3) COMMIT [WORK]ï¼šæäº¤ã€‚ åœ¨æ•°æ®åº“çš„æ’å…¥ã€åˆ é™¤å’Œä¿®æ”¹æ“ä½œæ—¶ï¼Œåªæœ‰å½“äº‹åŠ¡åœ¨æäº¤åˆ°æ•°æ®åº“æ—¶æ‰ç®—å®Œæˆã€‚åœ¨äº‹åŠ¡æäº¤å‰ï¼Œåªæœ‰æ“ä½œæ•°æ®åº“çš„è¿™ä¸ªäººæ‰èƒ½æœ‰æƒçœ‹åˆ°æ‰€åšçš„äº‹æƒ…ï¼Œåˆ«äººåªæœ‰åœ¨æœ€åæäº¤å®Œæˆåæ‰å¯ä»¥çœ‹åˆ°ã€‚æäº¤æ•°æ®æœ‰ä¸‰ç§ç±»å‹ï¼šæ˜¾å¼æäº¤ã€éšå¼æäº¤åŠè‡ªåŠ¨æäº¤ã€‚ä¸‹é¢åˆ†åˆ«è¯´æ˜è¿™ä¸‰ç§ç±»å‹ã€‚ (1) æ˜¾å¼æäº¤ç”¨COMMITå‘½ä»¤ç›´æ¥å®Œæˆçš„æäº¤ä¸ºæ˜¾å¼æäº¤ã€‚å…¶æ ¼å¼ä¸ºï¼šSQL&gt;COMMITï¼› (2) éšå¼æäº¤ç”¨SQLå‘½ä»¤é—´æ¥å®Œæˆçš„æäº¤ä¸ºéšå¼æäº¤ã€‚è¿™äº›å‘½ä»¤æ˜¯ï¼šALTERï¼ŒAUDITï¼ŒCOMMENTï¼ŒCONNECTï¼ŒCREATEï¼ŒDISCONNECTï¼ŒDROPï¼ŒEXITï¼ŒGRANTï¼ŒNOAUDITï¼ŒQUITï¼ŒREVOKEï¼ŒRENAMEã€‚ (3) è‡ªåŠ¨æäº¤è‹¥æŠŠAUTOCOMMITè®¾ç½®ä¸ºONï¼Œåˆ™åœ¨æ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤è¯­å¥æ‰§è¡Œåï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¿›è¡Œæäº¤ï¼Œè¿™å°±æ˜¯è‡ªåŠ¨æäº¤ã€‚å…¶æ ¼å¼ä¸ºï¼šSQL&gt;SET AUTOCOMMIT ONï¼› å‚è€ƒæ–‡ç« ï¼šhttps://www.cnblogs.com/study-s/p/5287529.html 16.like %å’Œ-çš„åŒºåˆ« é€šé…ç¬¦çš„åˆ†ç±»: %ç™¾åˆ†å·é€šé…ç¬¦:è¡¨ç¤ºä»»ä½•å­—ç¬¦å‡ºç°ä»»æ„æ¬¡æ•°(å¯ä»¥æ˜¯0æ¬¡). _ä¸‹åˆ’çº¿é€šé…ç¬¦:è¡¨ç¤ºåªèƒ½åŒ¹é…å•ä¸ªå­—ç¬¦,ä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘,å°±æ˜¯ä¸€ä¸ªå­—ç¬¦. likeæ“ä½œç¬¦: LIKEä½œç”¨æ˜¯æŒ‡ç¤ºmysqlåé¢çš„æœç´¢æ¨¡å¼æ˜¯åˆ©ç”¨é€šé…ç¬¦è€Œä¸æ˜¯ç›´æ¥ç›¸ç­‰åŒ¹é…è¿›è¡Œæ¯”è¾ƒ. æ³¨æ„: å¦‚æœåœ¨ä½¿ç”¨likeæ“ä½œç¬¦æ—¶,åé¢çš„æ²¡æœ‰ä½¿ç”¨é€šç”¨åŒ¹é…ç¬¦æ•ˆæœæ˜¯å’Œ=ä¸€è‡´çš„,SELECT * FROM products WHERE products.prod_name like â€˜1000â€™;åªèƒ½åŒ¹é…çš„ç»“æœä¸º1000,è€Œä¸èƒ½åŒ¹é…åƒJetPack 1000è¿™æ ·çš„ç»“æœ. %é€šé…ç¬¦ä½¿ç”¨: åŒ¹é…ä»¥â€yvesâ€å¼€å¤´çš„è®°å½•:(åŒ…æ‹¬è®°å½•â€yvesâ€) SELECT FROM products WHERE products.prod_name like â€˜yves%â€™;åŒ¹é…åŒ…å«â€yvesâ€çš„è®°å½•(åŒ…æ‹¬è®°å½•â€yvesâ€) SELECT FROM products WHERE products.prod_name like â€˜%yves%â€™;åŒ¹é…ä»¥â€yvesâ€ç»“å°¾çš„è®°å½•(åŒ…æ‹¬è®°å½•â€yvesâ€,ä¸åŒ…æ‹¬è®°å½•â€yves â€œ,ä¹Ÿå°±æ˜¯yvesåé¢æœ‰ç©ºæ ¼çš„è®°å½•,è¿™é‡Œéœ€è¦æ³¨æ„) SELECT * FROM products WHERE products.prod_name like â€˜%yvesâ€™; _é€šé…ç¬¦ä½¿ç”¨: SELECT FROM products WHERE products.prod_name like â€˜_yvesâ€™; åŒ¹é…ç»“æœä¸º: åƒâ€yyvesâ€è¿™æ ·è®°å½•.SELECT FROM products WHERE products.prodname like â€˜yves_â€˜; åŒ¹é…ç»“æœä¸º: åƒâ€yvesHeâ€è¿™æ ·çš„è®°å½•.(ä¸€ä¸ªä¸‹åˆ’çº¿åªèƒ½åŒ¹é…ä¸€ä¸ªå­—ç¬¦,ä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘) æ³¨æ„äº‹é¡¹: æ³¨æ„å¤§å°å†™,åœ¨ä½¿ç”¨æ¨¡ç³ŠåŒ¹é…æ—¶,ä¹Ÿå°±æ˜¯åŒ¹é…æ–‡æœ¬æ—¶,mysqlæ˜¯å¯èƒ½åŒºåˆ†å¤§å°çš„,ä¹Ÿå¯èƒ½æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„,è¿™ä¸ªç»“æœæ˜¯å–å†³äºç”¨æˆ·å¯¹MySQLçš„é…ç½®æ–¹å¼.å¦‚æœæ˜¯åŒºåˆ†å¤§å°å†™,é‚£ä¹ˆåƒYvesHeè¿™æ ·è®°å½•æ˜¯ä¸èƒ½è¢«â€yves__â€è¿™æ ·çš„åŒ¹é…æ¡ä»¶åŒ¹é…çš„. æ³¨æ„å°¾éƒ¨ç©ºæ ¼,â€%yvesâ€æ˜¯ä¸èƒ½åŒ¹é…â€heyves â€œè¿™æ ·çš„è®°å½•çš„. æ³¨æ„NULL,%é€šé…ç¬¦å¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦,ä½†æ˜¯ä¸èƒ½åŒ¹é…NULL,ä¹Ÿå°±æ˜¯è¯´SELECT * FROM products WHERE products.prod_name like â€˜%;æ˜¯åŒ¹é…ä¸åˆ°products.prod_nameä¸ºNULLçš„çš„è®°å½•. æŠ€å·§ä¸å»ºè®®: æ­£å¦‚æ‰€è§ï¼Œ MySQLçš„é€šé…ç¬¦å¾ˆæœ‰ç”¨ã€‚ä½†è¿™ç§åŠŸèƒ½æ˜¯æœ‰ä»£ä»·çš„ï¼šé€šé…ç¬¦æœç´¢çš„å¤„ç†ä¸€èˆ¬è¦æ¯”å‰é¢è®¨è®ºçš„å…¶ä»–æœç´¢æ‰€èŠ±æ—¶é—´æ›´é•¿ã€‚è¿™é‡Œç»™å‡ºä¸€äº›ä½¿ç”¨é€šé…ç¬¦è¦è®°ä½çš„æŠ€å·§ã€‚ ä¸è¦è¿‡åº¦ä½¿ç”¨é€šé…ç¬¦ã€‚å¦‚æœå…¶ä»–æ“ä½œç¬¦èƒ½è¾¾åˆ°ç›¸åŒçš„ç›®çš„ï¼Œåº”è¯¥ ä½¿ç”¨å…¶ä»–æ“ä½œç¬¦ã€‚ åœ¨ç¡®å®éœ€è¦ä½¿ç”¨é€šé…ç¬¦æ—¶ï¼Œé™¤éç»å¯¹æœ‰å¿…è¦ï¼Œå¦åˆ™ä¸è¦æŠŠå®ƒä»¬ç”¨ åœ¨æœç´¢æ¨¡å¼çš„å¼€å§‹å¤„ã€‚æŠŠé€šé…ç¬¦ç½®äºæœç´¢æ¨¡å¼çš„å¼€å§‹å¤„ï¼Œæœç´¢èµ· æ¥æ˜¯æœ€æ…¢çš„ã€‚ ä»”ç»†æ³¨æ„é€šé…ç¬¦çš„ä½ç½®ã€‚å¦‚æœæ”¾é”™åœ°æ–¹ï¼Œå¯èƒ½ä¸ä¼šè¿”å›æƒ³è¦çš„æ•°. å‚è€ƒåšæ–‡ï¼šhttps://blog.csdn.net/u011479200/article/details/78513632 17.count(*)ã€count(1)ã€count(column)çš„åŒºåˆ« count(*)å¯¹è¡Œçš„æ•°ç›®è¿›è¡Œè®¡ç®—,åŒ…å«NULL count(column)å¯¹ç‰¹å®šçš„åˆ—çš„å€¼å…·æœ‰çš„è¡Œæ•°è¿›è¡Œè®¡ç®—,ä¸åŒ…å«NULLå€¼ã€‚ count()è¿˜æœ‰ä¸€ç§ä½¿ç”¨æ–¹å¼,count(1)è¿™ä¸ªç”¨æ³•å’Œcount(*)çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ æ€§èƒ½é—®é¢˜: 1.ä»»ä½•æƒ…å†µä¸‹SELECT COUNT(*) FROM tablenameæ˜¯æœ€ä¼˜é€‰æ‹©; 2.å°½é‡å‡å°‘SELECT COUNT(*) FROM tablename WHERE COL = â€˜valueâ€™ è¿™ç§æŸ¥è¯¢; 3.æœç»SELECT COUNT(COL) FROM tablename WHERE COL2 = â€˜valueâ€™ çš„å‡ºç°ã€‚ å¦‚æœè¡¨æ²¡æœ‰ä¸»é”®,é‚£ä¹ˆcount(1)æ¯”count(*)å¿«ã€‚ å¦‚æœæœ‰ä¸»é”®,é‚£ä¹ˆcount(ä¸»é”®,è”åˆä¸»é”®)æ¯”count(*)å¿«ã€‚ å¦‚æœè¡¨åªæœ‰ä¸€ä¸ªå­—æ®µ,count(*)æœ€å¿«ã€‚ count(1)è·Ÿcount(ä¸»é”®)ä¸€æ ·,åªæ‰«æä¸»é”®ã€‚count(*)è·Ÿcount(éä¸»é”®)ä¸€æ ·,æ‰«ææ•´ä¸ªè¡¨ã€‚æ˜æ˜¾å‰è€…æ›´å¿«ä¸€äº›ã€‚ 18.æœ€å·¦å‰ç¼€åŸåˆ™ å¤šåˆ—ç´¢å¼•ï¼š ALTER TABLE people ADD INDEX lname_fname_age (lame,fname,age); ä¸ºäº†æé«˜æœç´¢æ•ˆç‡ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘è¿ç”¨å¤šåˆ—ç´¢å¼•,ç”±äºç´¢å¼•æ–‡ä»¶ä»¥Bï¼Treeæ ¼å¼ä¿å­˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ç”¨æ‰«æä»»ä½•è®°å½•ï¼Œå³å¯å¾—åˆ°æœ€ç»ˆç»“æœã€‚ æ³¨ï¼šåœ¨mysqlä¸­æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œåªèƒ½ä½¿ç”¨ä¸€ä¸ªç´¢å¼•ï¼Œå¦‚æœæˆ‘ä»¬åœ¨lname,fname,ageä¸Šåˆ†åˆ«å»ºç´¢å¼•,æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œåªèƒ½ä½¿ç”¨ä¸€ä¸ªç´¢å¼•ï¼Œmysqlä¼šé€‰æ‹©ä¸€ä¸ªæœ€ä¸¥æ ¼(è·å¾—ç»“æœé›†è®°å½•æ•°æœ€å°‘)çš„ç´¢å¼•ã€‚ æœ€å·¦å‰ç¼€åŸåˆ™ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æœ€å·¦ä¼˜å…ˆï¼Œä¸Šä¾‹ä¸­æˆ‘ä»¬åˆ›å»ºäº†lname_fname_ageå¤šåˆ—ç´¢å¼•,ç›¸å½“äºåˆ›å»ºäº†(lname)å•åˆ—ç´¢å¼•ï¼Œ(lname,fname)ç»„åˆç´¢å¼•ä»¥åŠ(lname,fname,age)ç»„åˆç´¢å¼•ã€‚ äºŒã€ç´¢å¼•1.ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ ä½•ä¸ºç´¢å¼•ï¼š æ•°æ®åº“ç´¢å¼•ï¼Œæ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ä¸€ä¸ªæ’åºçš„æ•°æ®ç»“æ„ï¼Œç´¢å¼•çš„å®ç°é€šå¸¸ä½¿ç”¨Bæ ‘åŠå…¶å˜ç§B+æ ‘ã€‚ åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ã€‚è¿™ç§æ•°æ®ç»“æ„ï¼Œå°±æ˜¯ç´¢å¼•ã€‚ 2.ç´¢å¼•çš„ä½œç”¨ï¼Ÿå®ƒçš„ä¼˜ç‚¹ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ ç´¢å¼•ä½œç”¨ï¼š ååŠ©å¿«é€ŸæŸ¥è¯¢ã€æ›´æ–°æ•°æ®åº“è¡¨ä¸­æ•°æ®ã€‚ ä¸ºè¡¨è®¾ç½®ç´¢å¼•è¦ä»˜å‡ºä»£ä»·çš„ï¼š ä¸€æ˜¯å¢åŠ äº†æ•°æ®åº“çš„å­˜å‚¨ç©ºé—´ äºŒæ˜¯åœ¨æ’å…¥å’Œä¿®æ”¹æ•°æ®æ—¶è¦èŠ±è´¹è¾ƒå¤šçš„æ—¶é—´(å› ä¸ºç´¢å¼•ä¹Ÿè¦éšä¹‹å˜åŠ¨)ã€‚ 3.ç´¢å¼•çš„ä¼˜ç¼ºç‚¹ï¼Ÿ åˆ›å»ºç´¢å¼•å¯ä»¥å¤§å¤§æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼ˆä¼˜ç‚¹ï¼‰ï¼š 1.é€šè¿‡åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ã€‚ 2.å¯ä»¥å¤§å¤§åŠ å¿«æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºç´¢å¼•çš„æœ€ä¸»è¦çš„åŸå› ã€‚ 3.å¯ä»¥åŠ é€Ÿè¡¨å’Œè¡¨ä¹‹é—´çš„è¿æ¥ï¼Œç‰¹åˆ«æ˜¯åœ¨å®ç°æ•°æ®çš„å‚è€ƒå®Œæ•´æ€§æ–¹é¢ç‰¹åˆ«æœ‰æ„ä¹‰ã€‚ 4.åœ¨ä½¿ç”¨åˆ†ç»„å’Œæ’åºå­å¥è¿›è¡Œæ•°æ®æ£€ç´¢æ—¶ï¼ŒåŒæ ·å¯ä»¥æ˜¾è‘—å‡å°‘æŸ¥è¯¢ä¸­åˆ†ç»„å’Œæ’åºçš„æ—¶é—´ã€‚ 5.é€šè¿‡ä½¿ç”¨ç´¢å¼•ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ä¼˜åŒ–éšè—å™¨ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚ å¢åŠ ç´¢å¼•ä¹Ÿæœ‰è®¸å¤šä¸åˆ©çš„æ–¹é¢(ç¼ºç‚¹)ï¼š 1.åˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•è¦è€—è´¹æ—¶é—´ï¼Œè¿™ç§æ—¶é—´éšç€æ•°æ®é‡çš„å¢åŠ è€Œå¢åŠ ã€‚ 2.ç´¢å¼•éœ€è¦å ç‰©ç†ç©ºé—´ï¼Œé™¤äº†æ•°æ®è¡¨å æ•°æ®ç©ºé—´ä¹‹å¤–ï¼Œæ¯ä¸€ä¸ªç´¢å¼•è¿˜è¦å ä¸€å®šçš„ç‰©ç†ç©ºé—´ï¼Œå¦‚æœè¦å»ºç«‹èšç°‡ç´¢å¼•ï¼Œé‚£ä¹ˆéœ€è¦çš„ç©ºé—´å°±ä¼šæ›´å¤§ã€‚ 3.å½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€çš„ç»´æŠ¤ï¼Œè¿™æ ·å°±é™ä½äº†æ•°æ®çš„ç»´æŠ¤é€Ÿåº¦ã€‚ 4.å“ªäº›åˆ—é€‚åˆå»ºç«‹ç´¢å¼•ã€å“ªäº›ä¸é€‚åˆå»ºç´¢å¼•ï¼Ÿ ç´¢å¼•æ˜¯å»ºç«‹åœ¨æ•°æ®åº“è¡¨ä¸­çš„æŸäº›åˆ—çš„ä¸Šé¢ã€‚åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™ï¼Œåº”è¯¥è€ƒè™‘åœ¨å“ªäº›åˆ—ä¸Šå¯ä»¥åˆ›å»ºç´¢å¼•ï¼Œåœ¨å“ªäº›åˆ—ä¸Šä¸èƒ½åˆ›å»ºç´¢å¼•ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œåº”è¯¥åœ¨è¿™äº›åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼š ï¼ˆ1ï¼‰åœ¨ç»å¸¸éœ€è¦æœç´¢çš„åˆ—ä¸Šï¼Œå¯ä»¥åŠ å¿«æœç´¢çš„é€Ÿåº¦ï¼› ï¼ˆ2ï¼‰åœ¨ä½œä¸ºä¸»é”®çš„åˆ—ä¸Šï¼Œå¼ºåˆ¶è¯¥åˆ—çš„å”¯ä¸€æ€§å’Œç»„ç»‡è¡¨ä¸­æ•°æ®çš„æ’åˆ—ç»“æ„ï¼› ï¼ˆ3ï¼‰åœ¨ç»å¸¸ç”¨åœ¨è¿æ¥çš„åˆ—ä¸Šï¼Œè¿™äº›åˆ—ä¸»è¦æ˜¯ä¸€äº›å¤–é”®ï¼Œå¯ä»¥åŠ å¿«è¿æ¥çš„é€Ÿåº¦ï¼› ï¼ˆ4ï¼‰åœ¨ç»å¸¸éœ€è¦æ ¹æ®èŒƒå›´è¿›è¡Œæœç´¢çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•å·²ç»æ’åºï¼Œå…¶æŒ‡å®šçš„èŒƒå›´æ˜¯è¿ç»­çš„ï¼› ï¼ˆ5ï¼‰åœ¨ç»å¸¸éœ€è¦æ’åºçš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•å·²ç»æ’åºï¼Œè¿™æ ·æŸ¥è¯¢å¯ä»¥åˆ©ç”¨ç´¢å¼•çš„æ’åºï¼ŒåŠ å¿«æ’åºæŸ¥è¯¢æ—¶é—´ï¼› ï¼ˆ6ï¼‰åœ¨ç»å¸¸ä½¿ç”¨åœ¨WHEREå­å¥ä¸­çš„åˆ—ä¸Šé¢åˆ›å»ºç´¢å¼•ï¼ŒåŠ å¿«æ¡ä»¶çš„åˆ¤æ–­é€Ÿåº¦ã€‚ å¯¹äºæœ‰äº›åˆ—ä¸åº”è¯¥åˆ›å»ºç´¢å¼•ï¼š ï¼ˆ1ï¼‰å¯¹äºé‚£äº›åœ¨æŸ¥è¯¢ä¸­å¾ˆå°‘ä½¿ç”¨æˆ–è€…å‚è€ƒçš„åˆ—ä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚ è¿™æ˜¯å› ä¸ºï¼Œæ—¢ç„¶è¿™äº›åˆ—å¾ˆå°‘ä½¿ç”¨åˆ°ï¼Œå› æ­¤æœ‰ç´¢å¼•æˆ–è€…æ— ç´¢å¼•ï¼Œå¹¶ä¸èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚ç›¸åï¼Œç”±äºå¢åŠ äº†ç´¢å¼•ï¼Œåè€Œé™ä½äº†ç³»ç»Ÿçš„ç»´æŠ¤é€Ÿåº¦å’Œå¢å¤§äº†ç©ºé—´éœ€æ±‚ã€‚ ï¼ˆ2ï¼‰å¯¹äºé‚£äº›åªæœ‰å¾ˆå°‘æ•°æ®å€¼çš„åˆ—ä¹Ÿä¸åº”è¯¥å¢åŠ ç´¢å¼•ã€‚ è¿™æ˜¯å› ä¸ºï¼Œç”±äºè¿™äº›åˆ—çš„å–å€¼å¾ˆå°‘ï¼Œä¾‹å¦‚äººäº‹è¡¨çš„æ€§åˆ«åˆ—ï¼Œåœ¨æŸ¥è¯¢çš„ç»“æœä¸­ï¼Œç»“æœé›†çš„æ•°æ®è¡Œå äº†è¡¨ä¸­æ•°æ®è¡Œçš„å¾ˆå¤§æ¯”ä¾‹ï¼Œå³éœ€è¦åœ¨è¡¨ä¸­æœç´¢çš„æ•°æ®è¡Œçš„æ¯”ä¾‹å¾ˆå¤§ã€‚å¢åŠ ç´¢å¼•ï¼Œå¹¶ä¸èƒ½æ˜æ˜¾åŠ å¿«æ£€ç´¢é€Ÿåº¦ã€‚ ï¼ˆ3ï¼‰å¯¹äºé‚£äº›å®šä¹‰ä¸ºtext, imageå’Œbitæ•°æ®ç±»å‹çš„åˆ—ä¸åº”è¯¥å¢åŠ ç´¢å¼•ã€‚ è¿™æ˜¯å› ä¸ºï¼Œè¿™äº›åˆ—çš„æ•°æ®é‡è¦ä¹ˆç›¸å½“å¤§ï¼Œè¦ä¹ˆå–å€¼å¾ˆå°‘ã€‚ (4)å½“ä¿®æ”¹æ€§èƒ½è¿œè¿œå¤§äºæ£€ç´¢æ€§èƒ½æ—¶ï¼Œä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚ è¿™æ˜¯å› ä¸ºï¼Œä¿®æ”¹æ€§èƒ½å’Œæ£€ç´¢æ€§èƒ½æ˜¯äº’ç›¸çŸ›ç›¾çš„ã€‚å½“å¢åŠ ç´¢å¼•æ—¶ï¼Œä¼šæé«˜æ£€ç´¢æ€§èƒ½ï¼Œä½†æ˜¯ä¼šé™ä½ä¿®æ”¹æ€§èƒ½ã€‚å½“å‡å°‘ç´¢å¼•æ—¶ï¼Œä¼šæé«˜ä¿®æ”¹æ€§èƒ½ï¼Œé™ä½æ£€ç´¢æ€§èƒ½ã€‚å› æ­¤ï¼Œå½“ä¿®æ”¹æ€§èƒ½è¿œè¿œå¤§äºæ£€ç´¢æ€§èƒ½æ—¶ï¼Œä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚ 5.ä»€ä¹ˆæ ·çš„å­—æ®µé€‚åˆå»ºç´¢å¼• å”¯ä¸€ã€ä¸ä¸ºç©ºã€ç»å¸¸è¢«æŸ¥è¯¢çš„å­—æ®µ 6.MySQL B+Treeç´¢å¼•å’ŒHashç´¢å¼•çš„åŒºåˆ«? Hashç´¢å¼•å’ŒB+æ ‘ç´¢å¼•çš„ç‰¹ç‚¹ï¼š Hashç´¢å¼•ç»“æ„çš„ç‰¹æ®Šæ€§ï¼Œå…¶æ£€ç´¢æ•ˆç‡éå¸¸é«˜ï¼Œç´¢å¼•çš„æ£€ç´¢å¯ä»¥ä¸€æ¬¡å®šä½; B+æ ‘ç´¢å¼•éœ€è¦ä»æ ¹èŠ‚ç‚¹åˆ°æèŠ‚ç‚¹ï¼Œæœ€åæ‰èƒ½è®¿é—®åˆ°é¡µèŠ‚ç‚¹è¿™æ ·å¤šæ¬¡çš„IOè®¿é—®; ä¸ºä»€ä¹ˆä¸éƒ½ç”¨Hashç´¢å¼•è€Œä½¿ç”¨B+æ ‘ç´¢å¼•ï¼Ÿ Hashç´¢å¼•ä»…ä»…èƒ½æ»¡è¶³â€=â€,â€INâ€å’Œâ€â€æŸ¥è¯¢ï¼Œä¸èƒ½ä½¿ç”¨èŒƒå›´æŸ¥è¯¢,å› ä¸ºç»è¿‡ç›¸åº”çš„Hashç®—æ³•å¤„ç†ä¹‹åçš„Hashå€¼çš„å¤§å°å…³ç³»ï¼Œå¹¶ä¸èƒ½ä¿è¯å’ŒHashè¿ç®—å‰å®Œå…¨ä¸€æ ·ï¼› Hashç´¢å¼•æ— æ³•è¢«ç”¨æ¥é¿å…æ•°æ®çš„æ’åºæ“ä½œï¼Œå› ä¸ºHashå€¼çš„å¤§å°å…³ç³»å¹¶ä¸ä¸€å®šå’ŒHashè¿ç®—å‰çš„é”®å€¼å®Œå…¨ä¸€æ ·ï¼› Hashç´¢å¼•ä¸èƒ½åˆ©ç”¨éƒ¨åˆ†ç´¢å¼•é”®æŸ¥è¯¢ï¼Œå¯¹äºç»„åˆç´¢å¼•ï¼ŒHashç´¢å¼•åœ¨è®¡ç®—Hashå€¼çš„æ—¶å€™æ˜¯ç»„åˆç´¢å¼•é”®åˆå¹¶åå†ä¸€èµ·è®¡ç®—Hashå€¼ï¼Œè€Œä¸æ˜¯å•ç‹¬è®¡ç®—Hashå€¼ï¼Œæ‰€ä»¥é€šè¿‡ç»„åˆç´¢å¼•çš„å‰é¢ä¸€ä¸ªæˆ–å‡ ä¸ªç´¢å¼•é”®è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼ŒHashç´¢å¼•ä¹Ÿæ— æ³•è¢«åˆ©ç”¨ï¼› Hashç´¢å¼•åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸èƒ½é¿å…è¡¨æ‰«æï¼Œç”±äºä¸åŒç´¢å¼•é”®å­˜åœ¨ç›¸åŒHashå€¼ï¼Œæ‰€ä»¥å³ä½¿å–æ»¡è¶³æŸä¸ªHashé”®å€¼çš„æ•°æ®çš„è®°å½•æ¡æ•°ï¼Œä¹Ÿæ— æ³•ä»Hashç´¢å¼•ä¸­ç›´æ¥å®ŒæˆæŸ¥è¯¢ï¼Œè¿˜æ˜¯è¦å›è¡¨æŸ¥è¯¢æ•°æ®ï¼› Hashç´¢å¼•é‡åˆ°å¤§é‡Hashå€¼ç›¸ç­‰çš„æƒ…å†µåæ€§èƒ½å¹¶ä¸ä¸€å®šå°±ä¼šæ¯”B+æ ‘ç´¢å¼•é«˜ã€‚ è¡¥å……ï¼š 1.MySQLä¸­ï¼Œåªæœ‰HEAP/MEMORYå¼•æ“æ‰æ˜¾ç¤ºæ”¯æŒHashç´¢å¼•ã€‚ 2.å¸¸ç”¨çš„InnoDBå¼•æ“ä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯B+æ ‘ç´¢å¼•ï¼Œå®ƒä¼šå®æ—¶ç›‘æ§è¡¨ä¸Šç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœè®¤ä¸ºå»ºç«‹å“ˆå¸Œç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œåˆ™è‡ªåŠ¨åœ¨å†…å­˜ä¸­çš„â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ç¼“å†²åŒºâ€å»ºç«‹å“ˆå¸Œç´¢å¼•ï¼ˆåœ¨InnoDBä¸­é»˜è®¤å¼€å¯è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼‰ï¼Œé€šè¿‡è§‚å¯Ÿæœç´¢æ¨¡å¼ï¼ŒMySQLä¼šåˆ©ç”¨index keyçš„å‰ç¼€å»ºç«‹å“ˆå¸Œç´¢å¼•ï¼Œå¦‚æœä¸€ä¸ªè¡¨å‡ ä¹å¤§éƒ¨åˆ†éƒ½åœ¨ç¼“å†²æ± ä¸­ï¼Œé‚£ä¹ˆå»ºç«‹ä¸€ä¸ªå“ˆå¸Œç´¢å¼•èƒ½å¤ŸåŠ å¿«ç­‰å€¼æŸ¥è¯¢ã€‚B+æ ‘ç´¢å¼•å’Œå“ˆå¸Œç´¢å¼•çš„æ˜æ˜¾åŒºåˆ«æ˜¯ï¼š 3.å¦‚æœæ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œé‚£ä¹ˆå“ˆå¸Œç´¢å¼•æ˜æ˜¾æœ‰ç»å¯¹ä¼˜åŠ¿ï¼Œå› ä¸ºåªéœ€è¦ç»è¿‡ä¸€æ¬¡ç®—æ³•å³å¯æ‰¾åˆ°ç›¸åº”çš„é”®å€¼ï¼›å½“ç„¶äº†ï¼Œè¿™ä¸ªå‰ææ˜¯ï¼Œé”®å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚å¦‚æœé”®å€¼ä¸æ˜¯å”¯ä¸€çš„ï¼Œå°±éœ€è¦å…ˆæ‰¾åˆ°è¯¥é”®æ‰€åœ¨ä½ç½®ï¼Œç„¶åå†æ ¹æ®é“¾è¡¨å¾€åæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°ç›¸åº”çš„æ•°æ®ï¼› 4.å¦‚æœæ˜¯èŒƒå›´æŸ¥è¯¢æ£€ç´¢ï¼Œè¿™æ—¶å€™å“ˆå¸Œç´¢å¼•å°±æ¯«æ— ç”¨æ­¦ä¹‹åœ°äº†ï¼Œå› ä¸ºåŸå…ˆæ˜¯æœ‰åºçš„é”®å€¼ï¼Œç»è¿‡å“ˆå¸Œç®—æ³•åï¼Œæœ‰å¯èƒ½å˜æˆä¸è¿ç»­çš„äº†ï¼Œå°±æ²¡åŠæ³•å†åˆ©ç”¨ç´¢å¼•å®ŒæˆèŒƒå›´æŸ¥è¯¢æ£€ç´¢ï¼›åŒç†ï¼Œå“ˆå¸Œç´¢å¼•æ²¡åŠæ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºï¼Œä»¥åŠlike â€˜xxx%â€™ è¿™æ ·çš„éƒ¨åˆ†æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆè¿™ç§éƒ¨åˆ†æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå…¶å®æœ¬è´¨ä¸Šä¹Ÿæ˜¯èŒƒå›´æŸ¥è¯¢ï¼‰ï¼› 5.å“ˆå¸Œç´¢å¼•ä¹Ÿä¸æ”¯æŒå¤šåˆ—è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…è§„åˆ™ï¼› 6.B+æ ‘ç´¢å¼•çš„å…³é”®å­—æ£€ç´¢æ•ˆç‡æ¯”è¾ƒå¹³å‡ï¼Œä¸åƒBæ ‘é‚£æ ·æ³¢åŠ¨å¹…åº¦å¤§ï¼Œåœ¨æœ‰å¤§é‡é‡å¤é”®å€¼æƒ…å†µä¸‹ï¼Œå“ˆå¸Œç´¢å¼•çš„æ•ˆç‡ä¹Ÿæ˜¯æä½çš„ï¼Œå› ä¸ºå­˜åœ¨æ‰€è°“çš„å“ˆå¸Œç¢°æ’é—®é¢˜ã€‚ 7.åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œéƒ½ä¼šæœ‰èŒƒå›´æŸ¥è¯¢ã€æ’åºã€åˆ†ç»„ç­‰æŸ¥è¯¢ç‰¹å¾ï¼Œç”¨B+æ ‘ç´¢å¼•å°±å¯ä»¥äº†ã€‚ 7.Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ« Bæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å­˜å‚¨keyå’Œdataï¼Œæ‰€æœ‰èŠ‚ç‚¹ç»„æˆè¿™æ£µæ ‘ï¼Œå¹¶ä¸”å¶å­èŠ‚ç‚¹æŒ‡é’ˆä¸ºnulï¼Œå¶å­ç»“ç‚¹ä¸åŒ…å«ä»»ä½•å…³é”®å­—ä¿¡æ¯ã€‚ B+æ ‘ï¼Œæ‰€æœ‰çš„å¶å­ç»“ç‚¹ä¸­åŒ…å«äº†å…¨éƒ¨å…³é”®å­—çš„ä¿¡æ¯ï¼ŒåŠæŒ‡å‘å«æœ‰è¿™äº›å…³é”®å­—è®°å½•çš„æŒ‡é’ˆï¼Œä¸”å¶å­ç»“ç‚¹æœ¬èº«ä¾å…³é”®å­—çš„å¤§å°è‡ªå°è€Œå¤§çš„é¡ºåºé“¾æ¥ï¼Œæ‰€æœ‰çš„éç»ˆç«¯ç»“ç‚¹å¯ä»¥çœ‹æˆæ˜¯ç´¢å¼•éƒ¨åˆ†ï¼Œç»“ç‚¹ä¸­ä»…å«æœ‰å…¶å­æ ‘æ ¹ç»“ç‚¹ä¸­æœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰å…³é”®å­—ã€‚ (è€ŒB æ ‘çš„éç»ˆèŠ‚ç‚¹ä¹ŸåŒ…å«éœ€è¦æŸ¥æ‰¾çš„æœ‰æ•ˆä¿¡æ¯) 8.ä¸ºä»€ä¹ˆè¯´B+æ¯”Bæ ‘æ›´é€‚åˆå®é™…åº”ç”¨ä¸­æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç´¢å¼•å’Œæ•°æ®åº“ç´¢å¼•ï¼Ÿ 1.B+çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½ B+çš„å†…éƒ¨ç»“ç‚¹å¹¶æ²¡æœ‰æŒ‡å‘å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆã€‚å› æ­¤å…¶å†…éƒ¨ç»“ç‚¹ç›¸å¯¹Bæ ‘æ›´å°ã€‚å¦‚æœæŠŠæ‰€æœ‰åŒä¸€å†…éƒ¨ç»“ç‚¹çš„å…³é”®å­—å­˜æ”¾åœ¨åŒä¸€ç›˜å—ä¸­ï¼Œé‚£ä¹ˆç›˜å—æ‰€èƒ½å®¹çº³çš„å…³é”®å­—æ•°é‡ä¹Ÿè¶Šå¤šã€‚ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ä¸­çš„éœ€è¦æŸ¥æ‰¾çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤šã€‚ç›¸å¯¹æ¥è¯´IOè¯»å†™æ¬¡æ•°ä¹Ÿå°±é™ä½äº†ã€‚ 2.B+treeçš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®š ç”±äºéç»ˆç»“ç‚¹å¹¶ä¸æ˜¯æœ€ç»ˆæŒ‡å‘æ–‡ä»¶å†…å®¹çš„ç»“ç‚¹ï¼Œè€Œåªæ˜¯å¶å­ç»“ç‚¹ä¸­å…³é”®å­—çš„ç´¢å¼•ã€‚æ‰€ä»¥ä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾å¿…é¡»èµ°ä¸€æ¡ä»æ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯ã€‚æ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå¯¼è‡´æ¯ä¸€ä¸ªæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ã€‚ 9.èšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•åŒºåˆ«? èšåˆç´¢å¼•(clustered index): èšé›†ç´¢å¼•è¡¨è®°å½•çš„æ’åˆ—é¡ºåºå’Œç´¢å¼•çš„æ’åˆ—é¡ºåºä¸€è‡´ï¼Œæ‰€ä»¥æŸ¥è¯¢æ•ˆç‡å¿«ï¼Œåªè¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªç´¢å¼•å€¼è®°å½•ï¼Œå…¶ä½™å°±è¿ç»­æ€§çš„è®°å½•åœ¨ç‰©ç†ä¹Ÿä¸€æ ·è¿ç»­å­˜æ”¾ã€‚èšé›†ç´¢å¼•å¯¹åº”çš„ç¼ºç‚¹å°±æ˜¯ä¿®æ”¹æ…¢ï¼Œå› ä¸ºä¸ºäº†ä¿è¯è¡¨ä¸­è®°å½•çš„ç‰©ç†å’Œç´¢å¼•é¡ºåºä¸€è‡´ï¼Œåœ¨è®°å½•æ’å…¥çš„æ—¶å€™ï¼Œä¼šå¯¹æ•°æ®é¡µé‡æ–°æ’åºã€‚èšé›†ç´¢å¼•ç±»ä¼¼äºæ–°åå­—å…¸ä¸­ç”¨æ‹¼éŸ³å»æŸ¥æ‰¾æ±‰å­—ï¼Œæ‹¼éŸ³æ£€ç´¢è¡¨äºä¹¦è®°é¡ºåºéƒ½æ˜¯æŒ‰ç…§a~zæ’åˆ—çš„ï¼Œå°±åƒç›¸åŒçš„é€»è¾‘é¡ºåºäºç‰©ç†é¡ºåºä¸€æ ·ï¼Œå½“ä½ éœ€è¦æŸ¥æ‰¾a,aiä¸¤ä¸ªè¯»éŸ³çš„å­—ï¼Œæˆ–æ˜¯æƒ³ä¸€æ¬¡å¯»æ‰¾å¤šä¸ªå‚»(sha)çš„åŒéŸ³å­—æ—¶ï¼Œä¹Ÿè®¸å‘åç¿»å‡ é¡µï¼Œæˆ–ç´§æ¥ç€ä¸‹ä¸€è¡Œå°±å¾—åˆ°ç»“æœäº†ã€‚ éèšåˆç´¢å¼•(nonclustered index): éèšé›†ç´¢å¼•æŒ‡å®šäº†è¡¨ä¸­è®°å½•çš„é€»è¾‘é¡ºåºï¼Œä½†æ˜¯è®°å½•çš„ç‰©ç†å’Œç´¢å¼•ä¸ä¸€å®šä¸€è‡´ï¼Œä¸¤ç§ç´¢å¼•éƒ½é‡‡ç”¨B+æ ‘ç»“æ„ï¼Œéèšé›†ç´¢å¼•çš„å¶å­å±‚å¹¶ä¸å’Œå®é™…æ•°æ®é¡µç›¸é‡å ï¼Œè€Œé‡‡ç”¨å¶å­å±‚åŒ…å«ä¸€ä¸ªæŒ‡å‘è¡¨ä¸­çš„è®°å½•åœ¨æ•°æ®é¡µä¸­çš„æŒ‡é’ˆæ–¹å¼ã€‚éèšé›†ç´¢å¼•å±‚æ¬¡å¤šï¼Œä¸ä¼šé€ æˆæ•°æ®é‡æ’ã€‚éèšé›†ç´¢å¼•ç±»ä¼¼åœ¨æ–°åå­—å…¸ä¸Šé€šè¿‡åæ—éƒ¨é¦–æ¥æŸ¥è¯¢æ±‰å­—ï¼Œæ£€ç´¢è¡¨ä¹Ÿè®¸æ˜¯æŒ‰ç…§æ¨ªã€ç«–ã€æ’‡æ¥æ’åˆ—çš„ï¼Œä½†æ˜¯ç”±äºæ­£æ–‡ä¸­æ˜¯a~zçš„æ‹¼éŸ³é¡ºåºï¼Œæ‰€ä»¥å°±ç±»ä¼¼äºé€»è¾‘åœ°å€äºç‰©ç†åœ°å€çš„ä¸å¯¹åº”ã€‚åŒæ—¶é€‚ç”¨çš„æƒ…å†µå°±åœ¨äºåˆ†ç»„ï¼Œå¤§æ•°ç›®çš„ä¸åŒå€¼ï¼Œé¢‘ç¹æ›´æ–°çš„åˆ—ä¸­ï¼Œè¿™äº›æƒ…å†µå³ä¸é€‚åˆèšé›†ç´¢å¼•ã€‚ æ ¹æœ¬åŒºåˆ«ï¼š èšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•çš„æ ¹æœ¬åŒºåˆ«æ˜¯è¡¨è®°å½•çš„æ’åˆ—é¡ºåºå’Œä¸ç´¢å¼•çš„æ’åˆ—é¡ºåºæ˜¯å¦ä¸€è‡´ã€‚ ä¸‰ã€äº‹åŠ¡1.ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ äº‹åŠ¡æ˜¯å¯¹æ•°æ®åº“ä¸­ä¸€ç³»åˆ—æ“ä½œè¿›è¡Œç»Ÿä¸€çš„å›æ»šæˆ–è€…æäº¤çš„æ“ä½œï¼Œä¸»è¦ç”¨æ¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚ 2.äº‹åŠ¡å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§? åŸå­æ€§ï¼ˆAtomicityï¼‰:åŸå­æ€§æ˜¯æŒ‡äº‹åŠ¡åŒ…å«çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šï¼Œå› æ­¤äº‹åŠ¡çš„æ“ä½œå¦‚æœæˆåŠŸå°±å¿…é¡»è¦å®Œå…¨åº”ç”¨åˆ°æ•°æ®åº“ï¼Œå¦‚æœæ“ä½œå¤±è´¥åˆ™ä¸èƒ½å¯¹æ•°æ®åº“æœ‰ä»»ä½•å½±å“ã€‚ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰:äº‹åŠ¡å¼€å§‹å‰å’Œç»“æŸåï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´åã€‚æ¯”å¦‚Aå‘Bè½¬è´¦ï¼Œä¸å¯èƒ½Aæ‰£äº†é’±ï¼ŒBå´æ²¡æ”¶åˆ°ã€‚ éš”ç¦»æ€§ï¼ˆIsolationï¼‰:éš”ç¦»æ€§æ˜¯å½“å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œæ¯”å¦‚æ“ä½œåŒä¸€å¼ è¡¨æ—¶ï¼Œæ•°æ®åº“ä¸ºæ¯ä¸€ä¸ªç”¨æˆ·å¼€å¯çš„äº‹åŠ¡ï¼Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡çš„æ“ä½œæ‰€å¹²æ‰°ï¼Œå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´è¦ç›¸äº’éš”ç¦»ã€‚åŒä¸€æ—¶é—´ï¼Œåªå…è®¸ä¸€ä¸ªäº‹åŠ¡è¯·æ±‚åŒä¸€æ•°æ®ï¼Œä¸åŒçš„äº‹åŠ¡ä¹‹é—´å½¼æ­¤æ²¡æœ‰ä»»ä½•å¹²æ‰°ã€‚æ¯”å¦‚Aæ­£åœ¨ä»ä¸€å¼ é“¶è¡Œå¡ä¸­å–é’±ï¼Œåœ¨Aå–é’±çš„è¿‡ç¨‹ç»“æŸå‰ï¼ŒBä¸èƒ½å‘è¿™å¼ å¡è½¬è´¦ã€‚ æŒä¹…æ€§ï¼ˆDurabilityï¼‰:æŒä¹…æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤äº†ï¼Œé‚£ä¹ˆå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå³ä¾¿æ˜¯åœ¨æ•°æ®åº“ç³»ç»Ÿé‡åˆ°æ•…éšœçš„æƒ…å†µä¸‹ä¹Ÿä¸ä¼šä¸¢å¤±æäº¤äº‹åŠ¡çš„æ“ä½œã€‚ 3.äº‹åŠ¡çš„å¹¶å‘?äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œæ¯ä¸ªçº§åˆ«ä¼šå¼•å‘ä»€ä¹ˆé—®é¢˜ï¼ŒMySQLé»˜è®¤æ˜¯å“ªä¸ªçº§åˆ«? ä»ç†è®ºä¸Šæ¥è¯´, äº‹åŠ¡åº”è¯¥å½¼æ­¤å®Œå…¨éš”ç¦», ä»¥é¿å…å¹¶å‘äº‹åŠ¡æ‰€å¯¼è‡´çš„é—®é¢˜ï¼Œç„¶è€Œ, é‚£æ ·ä¼šå¯¹æ€§èƒ½äº§ç”Ÿæå¤§çš„å½±å“, å› ä¸ºäº‹åŠ¡å¿…é¡»æŒ‰é¡ºåºè¿è¡Œï¼Œ åœ¨å®é™…å¼€å‘ä¸­, ä¸ºäº†æå‡æ€§èƒ½, äº‹åŠ¡ä¼šä»¥è¾ƒä½çš„éš”ç¦»çº§åˆ«è¿è¡Œï¼Œ äº‹åŠ¡çš„éš”ç¦»çº§åˆ«å¯ä»¥é€šè¿‡éš”ç¦»äº‹åŠ¡å±æ€§æŒ‡å®šã€‚äº‹åŠ¡çš„å¹¶å‘é—®é¢˜ 1ã€è„è¯»ï¼šäº‹åŠ¡Aè¯»å–äº†äº‹åŠ¡Bæ›´æ–°çš„æ•°æ®ï¼Œç„¶åBå›æ»šæ“ä½œï¼Œé‚£ä¹ˆAè¯»å–åˆ°çš„æ•°æ®æ˜¯è„æ•°æ® 2ã€ä¸å¯é‡å¤è¯»ï¼šäº‹åŠ¡ A å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œäº‹åŠ¡ B åœ¨äº‹åŠ¡Aå¤šæ¬¡è¯»å–çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ•°æ®ä½œäº†æ›´æ–°å¹¶æäº¤ï¼Œå¯¼è‡´äº‹åŠ¡Aå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®æ—¶ï¼Œç»“æœå› æ­¤æœ¬äº‹åŠ¡å…ˆåä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®ç»“æœä¼šä¸ä¸€è‡´ã€‚ 3ã€å¹»è¯»ï¼šå¹»è¯»è§£å†³äº†ä¸é‡å¤è¯»ï¼Œä¿è¯äº†åŒä¸€ä¸ªäº‹åŠ¡é‡Œï¼ŒæŸ¥è¯¢çš„ç»“æœéƒ½æ˜¯äº‹åŠ¡å¼€å§‹æ—¶çš„çŠ¶æ€ï¼ˆä¸€è‡´æ€§ï¼‰ã€‚ ä¾‹å¦‚ï¼šäº‹åŠ¡T1å¯¹ä¸€ä¸ªè¡¨ä¸­æ‰€æœ‰çš„è¡Œçš„æŸä¸ªæ•°æ®é¡¹åšäº†ä»â€œ1â€ä¿®æ”¹ä¸ºâ€œ2â€çš„æ“ä½œ è¿™æ—¶äº‹åŠ¡T2åˆå¯¹è¿™ä¸ªè¡¨ä¸­æ’å…¥äº†ä¸€è¡Œæ•°æ®é¡¹ï¼Œè€Œè¿™ä¸ªæ•°æ®é¡¹çš„æ•°å€¼è¿˜æ˜¯ä¸ºâ€œ1â€å¹¶ä¸”æäº¤ç»™æ•°æ®åº“ã€‚ è€Œæ“ä½œäº‹åŠ¡T1çš„ç”¨æˆ·å¦‚æœå†æŸ¥çœ‹åˆšåˆšä¿®æ”¹çš„æ•°æ®ï¼Œä¼šå‘ç°è¿˜æœ‰è·Ÿæ²¡æœ‰ä¿®æ”¹ä¸€æ ·ï¼Œå…¶å®è¿™è¡Œæ˜¯ä»äº‹åŠ¡T2ä¸­æ·»åŠ çš„ï¼Œå°±å¥½åƒäº§ç”Ÿå¹»è§‰ä¸€æ ·ï¼Œè¿™å°±æ˜¯å‘ç”Ÿäº†å¹»è¯»ã€‚å°ç»“ï¼šä¸å¯é‡å¤è¯»çš„å’Œå¹»è¯»å¾ˆå®¹æ˜“æ··æ·†ï¼Œä¸å¯é‡å¤è¯»ä¾§é‡äºä¿®æ”¹ï¼Œå¹»è¯»ä¾§é‡äºæ–°å¢æˆ–åˆ é™¤ã€‚è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜åªéœ€é”ä½æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œè§£å†³å¹»è¯»éœ€è¦é”è¡¨ã€‚ äº‹åŠ¡çš„éš”ç¦»çº§åˆ« è¯»æœªæäº¤ï¼šå¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†æ•°æ®ï¼Œä½†å°šæœªæäº¤ï¼Œè€Œæœ¬äº‹åŠ¡ä¸­çš„SELECTä¼šè¯»åˆ°è¿™äº›æœªè¢«æäº¤çš„æ•°æ®è„è¯» ä¸å¯é‡å¤è¯»ï¼šäº‹åŠ¡ A å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œäº‹åŠ¡ B åœ¨äº‹åŠ¡Aå¤šæ¬¡è¯»å–çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ•°æ®ä½œäº†æ›´æ–°å¹¶æäº¤ï¼Œå¯¼è‡´äº‹åŠ¡Aå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®æ—¶ï¼Œç»“æœå› æ­¤æœ¬äº‹åŠ¡å…ˆåä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®ç»“æœä¼šä¸ä¸€è‡´ã€‚ å¯é‡å¤è¯»ï¼šåœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œï¼ŒSELECTçš„ç»“æœæ˜¯äº‹åŠ¡å¼€å§‹æ—¶æ—¶é—´ç‚¹çš„çŠ¶æ€ï¼Œå› æ­¤ï¼ŒåŒæ ·çš„SELECTæ“ä½œè¯»åˆ°çš„ç»“æœä¼šæ˜¯ä¸€è‡´çš„ã€‚ä½†æ˜¯ï¼Œä¼šæœ‰å¹»è¯»ç°è±¡ ä¸²è¡ŒåŒ–ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œåœ¨è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•å¼‚å¸¸ã€‚å¹¶å‘çš„äº‹åŠ¡ï¼Œå°±åƒäº‹åŠ¡æ˜¯åœ¨ä¸€ä¸ªä¸ªæŒ‰ç…§é¡ºåºæ‰§è¡Œä¸€æ · ç‰¹åˆ«æ³¨æ„ï¼š MySQLé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºrepeatable-read MySQL æ”¯æŒ 4 ç§äº‹åŠ¡éš”ç¦»çº§åˆ«. äº‹åŠ¡çš„éš”ç¦»çº§åˆ«è¦å¾—åˆ°åº•å±‚æ•°æ®åº“å¼•æ“çš„æ”¯æŒ, è€Œä¸æ˜¯åº”ç”¨ç¨‹åºæˆ–è€…æ¡†æ¶çš„æ”¯æŒ. Oracle æ”¯æŒçš„ 2 ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼šREAD_COMMITED , SERIALIZABLE SQLè§„èŒƒæ‰€è§„å®šçš„æ ‡å‡†ï¼Œä¸åŒçš„æ•°æ®åº“å…·ä½“çš„å®ç°å¯èƒ½ä¼šæœ‰äº›å·®å¼‚ MySQLä¸­é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯â€œå¯é‡å¤è¯»â€æ—¶å¹¶ä¸ä¼šé”ä½è¯»å–åˆ°çš„è¡Œ äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼šæœªæäº¤è¯»æ—¶ï¼Œå†™æ•°æ®åªä¼šé”ä½ç›¸åº”çš„è¡Œã€‚ äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºï¼šå¯é‡å¤è¯»æ—¶ï¼Œå†™æ•°æ®ä¼šé”ä½æ•´å¼ è¡¨ã€‚ äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºï¼šä¸²è¡ŒåŒ–æ—¶ï¼Œè¯»å†™æ•°æ®éƒ½ä¼šé”ä½æ•´å¼ è¡¨ã€‚ éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œè¶Šèƒ½ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œä½†æ˜¯å¯¹å¹¶å‘æ€§èƒ½çš„å½±å“ä¹Ÿè¶Šå¤§ï¼Œé±¼å’Œç†ŠæŒä¸å¯å…¼å¾—å•Šã€‚å¯¹äºå¤šæ•°åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘æŠŠæ•°æ®åº“ç³»ç»Ÿçš„éš”ç¦»çº§åˆ«è®¾ä¸ºRead Committedï¼Œå®ƒèƒ½å¤Ÿé¿å…è„è¯»å–ï¼Œè€Œä¸”å…·æœ‰è¾ƒå¥½çš„å¹¶å‘æ€§èƒ½ã€‚å°½ç®¡å®ƒä¼šå¯¼è‡´ä¸å¯é‡å¤è¯»ã€å¹»è¯»è¿™äº›å¹¶å‘é—®é¢˜ï¼Œåœ¨å¯èƒ½å‡ºç°è¿™ç±»é—®é¢˜çš„ä¸ªåˆ«åœºåˆï¼Œå¯ä»¥ç”±åº”ç”¨ç¨‹åºé‡‡ç”¨æ‚²è§‚é”æˆ–ä¹è§‚é”æ¥æ§åˆ¶ã€‚ 4.äº‹åŠ¡ä¼ æ’­è¡Œä¸º 1.PROPAGATION_REQUIREDï¼šå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œè¯¥è®¾ç½®æ˜¯æœ€å¸¸ç”¨çš„è®¾ç½®ã€‚ 2.PROPAGATION_SUPPORTSï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ‰§è¡Œã€‚ 3.PROPAGATION_MANDATORYï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚ 4.PROPAGATION_REQUIRES_NEWï¼šåˆ›å»ºæ–°äº‹åŠ¡ï¼Œæ— è®ºå½“å‰å­˜ä¸å­˜åœ¨äº‹åŠ¡ï¼Œéƒ½åˆ›å»ºæ–°äº‹åŠ¡ã€‚ 5.PROPAGATION_NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ 6.PROPAGATION_NEVERï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ 7.PROPAGATION_NESTEDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ‰§è¡Œä¸PROPAGATION_REQUIREDç±»ä¼¼çš„æ“ä½œã€‚ 5.åµŒå¥—äº‹åŠ¡ ä»€ä¹ˆæ˜¯åµŒå¥—äº‹åŠ¡ï¼Ÿ åµŒå¥—æ˜¯å­äº‹åŠ¡å¥—åœ¨çˆ¶äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå­äº‹åŠ¡æ˜¯çˆ¶äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨è¿›å…¥å­äº‹åŠ¡ä¹‹å‰ï¼Œçˆ¶äº‹åŠ¡å»ºç«‹ä¸€ä¸ªå›æ»šç‚¹ï¼Œå«save pointï¼Œç„¶åæ‰§è¡Œå­äº‹åŠ¡ï¼Œè¿™ä¸ªå­äº‹åŠ¡çš„æ‰§è¡Œä¹Ÿç®—æ˜¯çˆ¶äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œç„¶åå­äº‹åŠ¡æ‰§è¡Œç»“æŸï¼Œçˆ¶äº‹åŠ¡ç»§ç»­æ‰§è¡Œã€‚é‡ç‚¹å°±åœ¨äºé‚£ä¸ªsave pointã€‚çœ‹å‡ ä¸ªé—®é¢˜å°±æ˜äº†äº†ï¼š å¦‚æœå­äº‹åŠ¡å›æ»šï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ çˆ¶äº‹åŠ¡ä¼šå›æ»šåˆ°è¿›å…¥å­äº‹åŠ¡å‰å»ºç«‹çš„save pointï¼Œç„¶åå°è¯•å…¶ä»–çš„äº‹åŠ¡æˆ–è€…å…¶ä»–çš„ä¸šåŠ¡é€»è¾‘ï¼Œçˆ¶äº‹åŠ¡ä¹‹å‰çš„æ“ä½œä¸ä¼šå—åˆ°å½±å“ï¼Œæ›´ä¸ä¼šè‡ªåŠ¨å›æ»šã€‚ å¦‚æœçˆ¶äº‹åŠ¡å›æ»šï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ çˆ¶äº‹åŠ¡å›æ»šï¼Œå­äº‹åŠ¡ä¹Ÿä¼šè·Ÿç€å›æ»šï¼ä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºçˆ¶äº‹åŠ¡ç»“æŸä¹‹å‰ï¼Œå­äº‹åŠ¡æ˜¯ä¸ä¼šæäº¤çš„ï¼Œæˆ‘ä»¬è¯´å­äº‹åŠ¡æ˜¯çˆ¶äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œæ­£æ˜¯è¿™ä¸ªé“ç†ã€‚é‚£ä¹ˆï¼š äº‹åŠ¡çš„æäº¤ï¼Œæ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ æ˜¯çˆ¶äº‹åŠ¡å…ˆæäº¤ï¼Œç„¶åå­äº‹åŠ¡æäº¤ï¼Œè¿˜æ˜¯å­äº‹åŠ¡å…ˆæäº¤ï¼Œçˆ¶äº‹åŠ¡å†æäº¤ï¼Ÿç­”æ¡ˆæ˜¯ç¬¬äºŒç§æƒ…å†µï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œå­äº‹åŠ¡æ˜¯çˆ¶äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œç”±çˆ¶äº‹åŠ¡ç»Ÿä¸€æäº¤ã€‚ å‚è€ƒæ–‡ç« ï¼šhttps://blog.csdn.net/liangxw1/article/details/51197560 å››ã€å­˜å‚¨å¼•æ“1.MySQLå¸¸è§çš„ä¸‰ç§å­˜å‚¨å¼•æ“ï¼ˆInnoDBã€MyISAMã€MEMORYï¼‰çš„åŒºåˆ«? ä¸¤ç§å­˜å‚¨å¼•æ“çš„å¤§è‡´åŒºåˆ«è¡¨ç°åœ¨ï¼š 1.InnoDBæ”¯æŒäº‹åŠ¡ï¼ŒMyISAMä¸æ”¯æŒï¼Œ è¿™ä¸€ç‚¹æ˜¯éå¸¸ä¹‹é‡è¦ã€‚äº‹åŠ¡æ˜¯ä¸€ç§é«˜çº§çš„å¤„ç†æ–¹å¼ï¼Œå¦‚åœ¨ä¸€äº›åˆ—å¢åˆ æ”¹ä¸­åªè¦å“ªä¸ªå‡ºé”™è¿˜å¯ä»¥å›æ»šè¿˜åŸï¼Œè€ŒMyISAMå°±ä¸å¯ä»¥äº†ã€‚ 2.MyISAMé€‚åˆæŸ¥è¯¢ä»¥åŠæ’å…¥ä¸ºä¸»çš„åº”ç”¨ã€‚ 3.InnoDBé€‚åˆé¢‘ç¹ä¿®æ”¹ä»¥åŠæ¶‰åŠåˆ°å®‰å…¨æ€§è¾ƒé«˜çš„åº”ç”¨ã€‚ 4.InnoDBæ”¯æŒå¤–é”®ï¼ŒMyISAMä¸æ”¯æŒã€‚ 5.ä»MySQL5.5.5ä»¥åï¼ŒInnoDBæ˜¯é»˜è®¤å¼•æ“ã€‚ 6.InnoDBä¸æ”¯æŒFULLTEXTç±»å‹çš„ç´¢å¼•ã€‚ 7.InnoDBä¸­ä¸ä¿å­˜è¡¨çš„è¡Œæ•°ï¼Œå¦‚select count() from tableæ—¶ï¼ŒInnoDBéœ€è¦æ‰«æä¸€éæ•´ä¸ªè¡¨æ¥è®¡ç®—æœ‰å¤šå°‘è¡Œï¼Œä½†æ˜¯MyISAMåªè¦ç®€å•çš„è¯»å‡ºä¿å­˜å¥½çš„è¡Œæ•°å³å¯ã€‚æ³¨æ„çš„æ˜¯ï¼Œå½“count()è¯­å¥åŒ…å«whereæ¡ä»¶æ—¶MyISAMä¹Ÿéœ€è¦æ‰«ææ•´ä¸ªè¡¨ã€‚ 8.å¯¹äºè‡ªå¢é•¿çš„å­—æ®µï¼ŒInnoDBä¸­å¿…é¡»åŒ…å«åªæœ‰è¯¥å­—æ®µçš„ç´¢å¼•ï¼Œä½†æ˜¯åœ¨MyISAMè¡¨ä¸­å¯ä»¥å’Œå…¶ä»–å­—æ®µä¸€èµ·å»ºç«‹è”åˆç´¢å¼•ã€‚ 9.DELETE FROM tableæ—¶ï¼ŒInnoDBä¸ä¼šé‡æ–°å»ºç«‹è¡¨ï¼Œè€Œæ˜¯ä¸€è¡Œä¸€è¡Œçš„ åˆ é™¤ï¼Œæ•ˆç‡éå¸¸æ…¢ã€‚MyISAMåˆ™ä¼šé‡å»ºè¡¨ã€‚ 10.InnoDBæ”¯æŒè¡Œé”ï¼ˆæŸäº›æƒ…å†µä¸‹è¿˜æ˜¯é”æ•´è¡¨ï¼Œå¦‚ update table set a=1 where user like â€˜%lee%â€™ã€‚ 2.MySQLå­˜å‚¨å¼•æ“MyISAMä¸InnoDBå¦‚ä½•é€‰æ‹© MySQLæœ‰å¤šç§å­˜å‚¨å¼•æ“ï¼Œæ¯ç§å­˜å‚¨å¼•æ“æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œå¯ä»¥æ‹©ä¼˜é€‰æ‹©ä½¿ç”¨ï¼šMyISAMã€InnoDBã€MERGEã€MEMORY(HEAP)ã€BDB(BerkeleyDB)ã€EXAMPLEã€FEDERATEDã€ARCHIVEã€CSVã€BLACKHOLEã€‚ è™½ç„¶MySQLé‡Œçš„å­˜å‚¨å¼•æ“ä¸åªæ˜¯MyISAMä¸InnoDBè¿™ä¸¤ä¸ªï¼Œä½†å¸¸ç”¨çš„å°±æ˜¯ä¸¤ä¸ªã€‚å…³äºMySQLæ•°æ®åº“æä¾›çš„ä¸¤ç§å­˜å‚¨å¼•æ“ï¼ŒMyISAMä¸InnoDBé€‰æ‹©ä½¿ç”¨ï¼š 1.INNODBä¼šæ”¯æŒä¸€äº›å…³ç³»æ•°æ®åº“çš„é«˜çº§åŠŸèƒ½ï¼Œå¦‚äº‹åŠ¡åŠŸèƒ½å’Œè¡Œçº§é”ï¼ŒMyISAMä¸æ”¯æŒã€‚ 2.MyISAMçš„æ€§èƒ½æ›´ä¼˜ï¼Œå ç”¨çš„å­˜å‚¨ç©ºé—´å°‘ï¼Œæ‰€ä»¥ï¼Œé€‰æ‹©ä½•ç§å­˜å‚¨å¼•æ“ï¼Œè§†å…·ä½“åº”ç”¨è€Œå®šã€‚ å¦‚æœä½ çš„åº”ç”¨ç¨‹åºä¸€å®šè¦ä½¿ç”¨äº‹åŠ¡ï¼Œæ¯«æ— ç–‘é—®ä½ è¦é€‰æ‹©INNODBå¼•æ“ã€‚ä½†è¦æ³¨æ„ï¼ŒINNODBçš„è¡Œçº§é”æ˜¯æœ‰æ¡ä»¶çš„ã€‚åœ¨whereæ¡ä»¶æ²¡æœ‰ä½¿ç”¨ä¸»é”®æ—¶ï¼Œç…§æ ·ä¼šé”å…¨è¡¨ã€‚æ¯”å¦‚DELETE FROM mytableè¿™æ ·çš„åˆ é™¤è¯­å¥ã€‚ å¦‚æœä½ çš„åº”ç”¨ç¨‹åºå¯¹æŸ¥è¯¢æ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œå°±è¦ä½¿ç”¨MyISAMäº†ã€‚MyISAMç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†å¼€çš„ï¼Œè€Œä¸”å…¶ç´¢å¼•æ˜¯å‹ç¼©çš„ï¼Œå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨å†…å­˜ã€‚æ‰€ä»¥å®ƒçš„æŸ¥è¯¢æ€§èƒ½æ˜æ˜¾ä¼˜äºINNODBã€‚å‹ç¼©åçš„ç´¢å¼•ä¹Ÿèƒ½èŠ‚çº¦ä¸€äº›ç£ç›˜ç©ºé—´ã€‚MyISAMæ‹¥æœ‰å…¨æ–‡ç´¢å¼•çš„åŠŸèƒ½ï¼Œè¿™å¯ä»¥æå¤§åœ°ä¼˜åŒ–LIKEæŸ¥è¯¢çš„æ•ˆç‡ã€‚ æœ‰äººè¯´MyISAMåªèƒ½ç”¨äºå°å‹åº”ç”¨ï¼Œå…¶å®è¿™åªæ˜¯ä¸€ç§åè§ã€‚å¦‚æœæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œè¿™æ˜¯éœ€è¦é€šè¿‡å‡çº§æ¶æ„æ¥è§£å†³ï¼Œæ¯”å¦‚åˆ†è¡¨åˆ†åº“ï¼Œè€Œä¸æ˜¯å•çº¯åœ°ä¾èµ–å­˜å‚¨å¼•æ“ã€‚ ç°åœ¨ä¸€èˆ¬éƒ½æ˜¯é€‰ç”¨innodbäº†ï¼Œä¸»è¦æ˜¯MyISAMçš„å…¨è¡¨é”ï¼Œè¯»å†™ä¸²è¡Œé—®é¢˜ï¼Œå¹¶å‘æ•ˆç‡é”è¡¨ï¼Œæ•ˆç‡ä½ï¼ŒMyISAMå¯¹äºè¯»å†™å¯†é›†å‹åº”ç”¨ä¸€èˆ¬æ˜¯ä¸ä¼šå»é€‰ç”¨çš„ã€‚MEMORYå­˜å‚¨å¼•æ“ MEMORYæ˜¯MySQLä¸­ä¸€ç±»ç‰¹æ®Šçš„å­˜å‚¨å¼•æ“ã€‚å®ƒä½¿ç”¨å­˜å‚¨åœ¨å†…å­˜ä¸­çš„å†…å®¹æ¥åˆ›å»ºè¡¨ï¼Œè€Œä¸”æ•°æ®å…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­ã€‚è¿™äº›ç‰¹æ€§ä¸å‰é¢çš„ä¸¤ä¸ªå¾ˆä¸åŒã€‚æ¯ä¸ªåŸºäºMEMORYå­˜å‚¨å¼•æ“çš„è¡¨å®é™…å¯¹åº”ä¸€ä¸ªç£ç›˜æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶çš„æ–‡ä»¶åä¸è¡¨åç›¸åŒï¼Œç±»å‹ä¸ºfrmç±»å‹ã€‚è¯¥æ–‡ä»¶ä¸­åªå­˜å‚¨è¡¨çš„ç»“æ„ã€‚è€Œå…¶æ•°æ®æ–‡ä»¶ï¼Œéƒ½æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¿™æ ·æœ‰åˆ©äºæ•°æ®çš„å¿«é€Ÿå¤„ç†ï¼Œæé«˜æ•´ä¸ªè¡¨çš„æ•ˆç‡ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡å™¨éœ€è¦æœ‰è¶³å¤Ÿçš„å†…å­˜æ¥ç»´æŒMEMORYå­˜å‚¨å¼•æ“çš„è¡¨çš„ä½¿ç”¨ã€‚å¦‚æœä¸éœ€è¦äº†ï¼Œå¯ä»¥é‡Šæ”¾å†…å­˜ï¼Œç”šè‡³åˆ é™¤ä¸éœ€è¦çš„è¡¨ã€‚ MEMORYé»˜è®¤ä½¿ç”¨å“ˆå¸Œç´¢å¼•ã€‚é€Ÿåº¦æ¯”ä½¿ç”¨Bå‹æ ‘ç´¢å¼•å¿«ã€‚å½“ç„¶å¦‚æœä½ æƒ³ç”¨Bå‹æ ‘ç´¢å¼•ï¼Œå¯ä»¥åœ¨åˆ›å»ºç´¢å¼•æ—¶æŒ‡å®šã€‚ æ³¨æ„ï¼ŒMEMORYç”¨åˆ°çš„å¾ˆå°‘ï¼Œå› ä¸ºå®ƒæ˜¯æŠŠæ•°æ®å­˜åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœå†…å­˜å‡ºç°å¼‚å¸¸å°±ä¼šå½±å“æ•°æ®ã€‚å¦‚æœé‡å¯æˆ–è€…å…³æœºï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¼šæ¶ˆå¤±ã€‚å› æ­¤ï¼ŒåŸºäºMEMORYçš„è¡¨çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼Œä¸€èˆ¬æ˜¯ä¸€æ¬¡æ€§çš„ã€‚ 3.MySQLçš„MyISAMä¸InnoDBä¸¤ç§å­˜å‚¨å¼•æ“åœ¨ï¼Œäº‹åŠ¡ã€é”çº§åˆ«ï¼Œå„è‡ªçš„é€‚ç”¨åœºæ™¯? äº‹åŠ¡å¤„ç†ä¸Šæ–¹é¢ MyISAMï¼šå¼ºè°ƒçš„æ˜¯æ€§èƒ½ï¼Œæ¯æ¬¡æŸ¥è¯¢å…·æœ‰åŸå­æ€§,å…¶æ‰§è¡Œæ•°åº¦æ¯”InnoDBç±»å‹æ›´å¿«ï¼Œä½†æ˜¯ä¸æä¾›äº‹åŠ¡æ”¯æŒã€‚ InnoDBï¼šæä¾›äº‹åŠ¡æ”¯æŒäº‹åŠ¡ï¼Œå¤–éƒ¨é”®ç­‰é«˜çº§æ•°æ®åº“åŠŸèƒ½ã€‚ å…·æœ‰äº‹åŠ¡(commit)ã€å›æ»š(rollback)å’Œå´©æºƒä¿®å¤èƒ½åŠ›(crash recovery capabilities)çš„äº‹åŠ¡å®‰å…¨(transaction-safe (ACID compliant))å‹è¡¨ã€‚ é”çº§åˆ« MyISAMï¼šåªæ”¯æŒè¡¨çº§é”ï¼Œç”¨æˆ·åœ¨æ“ä½œMyISAMè¡¨æ—¶ï¼Œselectï¼Œupdateï¼Œdeleteï¼Œinsertè¯­å¥éƒ½ä¼šç»™è¡¨è‡ªåŠ¨åŠ é”ï¼Œå¦‚æœåŠ é”ä»¥åçš„è¡¨æ»¡è¶³insertå¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨è¡¨çš„å°¾éƒ¨æ’å…¥æ–°çš„æ•°æ®ã€‚ InnoDBï¼šæ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”ï¼Œæ˜¯innodbçš„æœ€å¤§ç‰¹è‰²ã€‚è¡Œé”å¤§å¹…åº¦æé«˜äº†å¤šç”¨æˆ·å¹¶å‘æ“ä½œçš„æ–°èƒ½ã€‚ä½†æ˜¯InnoDBçš„è¡Œé”ï¼Œåªæ˜¯åœ¨WHEREçš„ä¸»é”®æ˜¯æœ‰æ•ˆçš„ï¼Œéä¸»é”®çš„WHEREéƒ½ä¼šé”å…¨è¡¨çš„ã€‚ å…³äºå­˜å‚¨å¼•æ“MyISAMå’ŒInnoDBçš„å…¶ä»–å‚è€ƒèµ„æ–™å¦‚ä¸‹ï¼š MySQLå­˜å‚¨å¼•æ“ä¸­çš„MyISAMå’ŒInnoDBåŒºåˆ«è¯¦è§£ MySQLå­˜å‚¨å¼•æ“ä¹‹MyISAMå’ŒInnodbæ€»ç»“æ€§æ¢³ç† äº”ã€ä¼˜åŒ–1.æŸ¥è¯¢è¯­å¥ä¸åŒå…ƒç´ ï¼ˆwhereã€jionã€limitã€group byã€havingç­‰ç­‰ï¼‰æ‰§è¡Œå…ˆåé¡ºåº? 1.æŸ¥è¯¢ä¸­ç”¨åˆ°çš„å…³é”®è¯ä¸»è¦åŒ…å«å…­ä¸ªï¼Œå¹¶ä¸”ä»–ä»¬çš„é¡ºåºä¾æ¬¡ä¸º selectâ€“fromâ€“whereâ€“group byâ€“havingâ€“order by å…¶ä¸­selectå’Œfromæ˜¯å¿…é¡»çš„ï¼Œå…¶ä»–å…³é”®è¯æ˜¯å¯é€‰çš„ï¼Œè¿™å…­ä¸ªå…³é”®è¯çš„æ‰§è¡Œé¡ºåº ä¸sqlè¯­å¥çš„ä¹¦å†™é¡ºåºå¹¶ä¸æ˜¯ä¸€æ ·çš„ï¼Œè€Œæ˜¯æŒ‰ç…§ä¸‹é¢çš„é¡ºåºæ¥æ‰§è¡Œ from:éœ€è¦ä»å“ªä¸ªæ•°æ®è¡¨æ£€ç´¢æ•°æ® where:è¿‡æ»¤è¡¨ä¸­æ•°æ®çš„æ¡ä»¶ group by:å¦‚ä½•å°†ä¸Šé¢è¿‡æ»¤å‡ºçš„æ•°æ®åˆ†ç»„ having:å¯¹ä¸Šé¢å·²ç»åˆ†ç»„çš„æ•°æ®è¿›è¡Œè¿‡æ»¤çš„æ¡ä»¶ select:æŸ¥çœ‹ç»“æœé›†ä¸­çš„å“ªä¸ªåˆ—ï¼Œæˆ–åˆ—çš„è®¡ç®—ç»“æœ order by :æŒ‰ç…§ä»€ä¹ˆæ ·çš„é¡ºåºæ¥æŸ¥çœ‹è¿”å›çš„æ•°æ® 2.fromåé¢çš„è¡¨å…³è”ï¼Œæ˜¯è‡ªå³å‘å·¦è§£æ è€Œwhereæ¡ä»¶çš„è§£æé¡ºåºæ˜¯è‡ªä¸‹è€Œä¸Šçš„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å†™SQLè¯­å¥çš„æ—¶å€™ï¼Œå°½é‡æŠŠæ•°æ®é‡å°çš„è¡¨æ”¾åœ¨æœ€å³è¾¹æ¥è¿›è¡Œå…³è”ï¼ˆç”¨å°è¡¨å»åŒ¹é…å¤§è¡¨ï¼‰ï¼Œè€ŒæŠŠèƒ½ç­›é€‰å‡ºå°é‡æ•°æ®çš„æ¡ä»¶æ”¾åœ¨whereè¯­å¥çš„æœ€å·¦è¾¹ ï¼ˆç”¨å°è¡¨å»åŒ¹é…å¤§è¡¨ï¼‰ å…¶ä»–å‚è€ƒèµ„æºï¼šhttp://www.cnblogs.com/huminxxl/p/3149097.html 2.ä½¿ç”¨explainä¼˜åŒ–sqlå’Œç´¢å¼•? å¯¹äºå¤æ‚ã€æ•ˆç‡ä½çš„sqlè¯­å¥ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯ä½¿ç”¨explain sql æ¥åˆ†æsqlè¯­å¥ï¼Œè¿™ä¸ªè¯­å¥å¯ä»¥æ‰“å°å‡ºï¼Œè¯­å¥çš„æ‰§è¡Œã€‚è¿™æ ·æ–¹ä¾¿æˆ‘ä»¬åˆ†æï¼Œè¿›è¡Œä¼˜åŒ– tableï¼šæ˜¾ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªå¼ è¡¨çš„ typeï¼šè¿™æ˜¯é‡è¦çš„åˆ—ï¼Œæ˜¾ç¤ºè¿æ¥ä½¿ç”¨äº†ä½•ç§ç±»å‹ã€‚ä»æœ€å¥½åˆ°æœ€å·®çš„è¿æ¥ç±»å‹ä¸ºconstã€eq_regã€refã€rangeã€indexå’ŒALL all:full table scan ;MySQLå°†éå†å…¨è¡¨ä»¥æ‰¾åˆ°åŒ¹é…çš„è¡Œï¼› index: index scan; index å’Œ allçš„åŒºåˆ«åœ¨äºindexç±»å‹åªéå†ç´¢å¼•ï¼› rangeï¼šç´¢å¼•èŒƒå›´æ‰«æï¼Œå¯¹ç´¢å¼•çš„æ‰«æå¼€å§‹äºæŸä¸€ç‚¹ï¼Œè¿”å›åŒ¹é…å€¼çš„è¡Œï¼Œå¸¸è§ä¸between ï¼Œç­‰æŸ¥è¯¢ï¼› refï¼šéå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œè¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œï¼Œå¸¸è§äºä½¿ç”¨éå”¯ä¸€ç´¢å¼•å³å”¯ä¸€ç´¢å¼•çš„éå”¯ä¸€å‰ç¼€è¿›è¡ŒæŸ¥æ‰¾ï¼› eq_refï¼šå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ä¸ä¹‹åŒ¹é…ï¼Œå¸¸ç”¨äºä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•æ‰«æï¼› constï¼Œsystemï¼šå½“MySQLå¯¹æŸæŸ¥è¯¢æŸéƒ¨åˆ†è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶è½¬ä¸ºä¸€ä¸ªå¸¸é‡æ—¶ï¼Œä½¿ç”¨è¿™äº›è®¿é—®ç±»å‹ã€‚å¦‚æœå°†ä¸»é”®ç½®äºwhereåˆ—è¡¨ä¸­ï¼ŒMySQLå°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬åŒ–ä¸ºä¸€ä¸ªå¸¸é‡ã€‚ possible_keysï¼šæ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸­çš„ç´¢å¼•ã€‚å¦‚æœä¸ºç©ºï¼Œæ²¡æœ‰å¯èƒ½çš„ç´¢å¼•ã€‚å¯ä»¥ä¸ºç›¸å…³çš„åŸŸä»WHEREè¯­å¥ä¸­é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„è¯­å¥ keyï¼š å®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚å¦‚æœä¸ºNULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚å¾ˆå°‘çš„æƒ…å†µä¸‹ï¼ŒMySQLä¼šé€‰æ‹©ä¼˜åŒ–ä¸è¶³çš„ç´¢å¼•ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨SELECTè¯­å¥ä¸­ä½¿ç”¨USE INDEXï¼ˆindexnameï¼‰æ¥å¼ºåˆ¶ä½¿ç”¨ä¸€ä¸ªç´¢å¼•æˆ–è€…ç”¨IGNORE INDEXï¼ˆindexnameï¼‰æ¥å¼ºåˆ¶MySQLå¿½ç•¥ç´¢å¼• key_lenï¼šä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ã€‚åœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ refï¼šæ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œæ˜¯ä¸€ä¸ªå¸¸æ•° rowsï¼šMySQLè®¤ä¸ºå¿…é¡»æ£€æŸ¥çš„ç”¨æ¥è¿”å›è¯·æ±‚æ•°æ®çš„è¡Œæ•° Extraï¼šå…³äºMySQLå¦‚ä½•è§£ææŸ¥è¯¢çš„é¢å¤–ä¿¡æ¯ã€‚å°†åœ¨è¡¨4.3ä¸­è®¨è®ºï¼Œä½†è¿™é‡Œå¯ä»¥çœ‹åˆ°çš„åçš„ä¾‹å­æ˜¯Using temporaryå’ŒUsing filesortï¼Œæ„æ€MySQLæ ¹æœ¬ä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œç»“æœæ˜¯æ£€ç´¢ä¼šå¾ˆæ…¢ã€‚ 3.MySQLæ…¢æŸ¥è¯¢æ€ä¹ˆè§£å†³? slow_query_log æ…¢æŸ¥è¯¢å¼€å¯çŠ¶æ€ã€‚ slow_query_log_file æ…¢æŸ¥è¯¢æ—¥å¿—å­˜æ”¾çš„ä½ç½®ï¼ˆè¿™ä¸ªç›®å½•éœ€è¦MySQLçš„è¿è¡Œå¸å·çš„å¯å†™æƒé™ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºMySQLçš„æ•°æ®å­˜æ”¾ç›®å½•ï¼‰ã€‚ long_query_time æŸ¥è¯¢è¶…è¿‡å¤šå°‘ç§’æ‰è®°å½•ã€‚ å…­ã€æ•°æ®åº“é”1.mysqléƒ½æœ‰ä»€ä¹ˆé”ï¼Œæ­»é”åˆ¤å®šåŸç†å’Œå…·ä½“åœºæ™¯ï¼Œæ­»é”æ€ä¹ˆè§£å†³? MySQLæœ‰ä¸‰ç§é”çš„çº§åˆ«ï¼šå…¨å±€é”ã€è¡¨çº§çº§ã€è¡Œçº§é”ã€‚ å…¨å±€é”ï¼šå¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ã€‚æä¾›åŠ å…¨å±€è¯»é”çš„æ–¹æ³•ï¼šFlush tables with read lock(FTWRL)ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥ä½¿æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ã€‚ä½¿ç”¨è¯¥å‘½ä»¤ä¹‹åï¼Œæ•°æ®æ›´æ–°è¯­å¥ã€æ•°æ®å®šä¹‰è¯­å¥å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ç­‰æ“ä½œéƒ½ä¼šè¢«é˜»å¡ã€‚ä½¿ç”¨åœºæ™¯æ˜¯å…¨åº“é€»è¾‘å¤‡ä»½ã€‚MySQLæä¾›åŠ å…¨å±€è¯»é”çš„æ–¹æ³•ï¼šFlush tables with read lock(FTWRL) è¡¨çº§é”ï¼šMySQLé‡Œé¢è¡¨çº§é”æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯è¡¨é”ï¼Œä¸€ç§æ˜¯å…ƒæ•°æ®é”(meta data lock,MDL)ï¼Œé”ä½æ•´ä¸ªè¡¨ï¼Œå…¶ä¸­ MDL ä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šã€‚Server å±‚é¢å®ç°çš„ï¼ï¼ï¼ï¼ è¡Œçº§é”ï¼šå­˜å‚¨å¼•æ“çº§åˆ«å®ç°çš„ï¼Œå…·ä½“å¯ä»¥çœ‹è‡ªå·±å†™çš„å¦å¤–ä¸€ç¯‡æ–‡ç«  ã€ŠMysql å†åº¦å‡ºå‘ã€‹ã€‚ ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ æ­»é”: æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ã€‚å› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡,è‹¥æ— å¤–åŠ›ä½œç”¨,å®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºæ­»é”çŠ¶æ€æˆ–ç³»ç»Ÿäº§ç”Ÿäº†æ­»é”,è¿™äº›æ°¸è¿œåœ¨äº’ç›¸ç­‰ç«ºçš„è¿›ç¨‹ç§°ä¸ºæ­»é”è¿›ç¨‹ã€‚ è¡¨çº§é”ä¸ä¼šäº§ç”Ÿæ­»é”.æ‰€ä»¥è§£å†³æ­»é”ä¸»è¦è¿˜æ˜¯é’ˆå¯¹äºæœ€å¸¸ç”¨çš„InnoDBã€‚ æ­»é”çš„å…³é”®åœ¨äºï¼šä¸¤ä¸ª(æˆ–ä»¥ä¸Š)çš„SessionåŠ é”çš„é¡ºåºä¸ä¸€è‡´ã€‚ é‚£ä¹ˆå¯¹åº”çš„è§£å†³æ­»é”é—®é¢˜çš„å…³é”®å°±æ˜¯ï¼šè®©ä¸åŒçš„sessionåŠ é”æœ‰æ¬¡åºã€‚ æ­»é”çš„è§£å†³åŠæ³•? 1.æŸ¥å‡ºçš„çº¿ç¨‹æ€æ­» killSELECT trx_MySQL_thread_id FROM information_schema.INNODB_TRX; 2.è®¾ç½®é”çš„è¶…æ—¶æ—¶é—´Innodb è¡Œé”çš„ç­‰å¾…æ—¶é—´ï¼Œå•ä½ç§’ã€‚å¯åœ¨ä¼šè¯çº§åˆ«è®¾ç½®ï¼ŒRDS å®ä¾‹è¯¥å‚æ•°çš„é»˜è®¤å€¼ä¸º 50ï¼ˆç§’ï¼‰ã€‚ ç”Ÿäº§ç¯å¢ƒä¸æ¨èä½¿ç”¨è¿‡å¤§çš„ innodb_lock_wait_timeoutå‚æ•°å€¼è¯¥å‚æ•°æ”¯æŒåœ¨ä¼šè¯çº§åˆ«ä¿®æ”¹ï¼Œæ–¹ä¾¿åº”ç”¨åœ¨ä¼šè¯çº§åˆ«å•ç‹¬è®¾ç½®æŸäº›ç‰¹æ®Šæ“ä½œçš„è¡Œé”ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼Œå¦‚ä¸‹ï¼šset innodb_lock_wait_timeout=1000; â€”è®¾ç½®å½“å‰ä¼šè¯ Innodb è¡Œé”ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ã€‚ 3.æŒ‡å®šè·å–é”çš„é¡ºåº 2.æœ‰å“ªäº›é”ï¼ˆä¹è§‚é”æ‚²è§‚é”ï¼‰ï¼Œselect æ—¶æ€ä¹ˆåŠ æ’å®ƒé”? æ‚²è§‚é”ï¼ˆPessimistic Lockï¼‰: æ‚²è§‚é”ç‰¹ç‚¹:å…ˆè·å–é”ï¼Œå†è¿›è¡Œä¸šåŠ¡æ“ä½œã€‚ å³â€œæ‚²è§‚â€çš„è®¤ä¸ºè·å–é”æ˜¯éå¸¸æœ‰å¯èƒ½å¤±è´¥çš„ï¼Œå› æ­¤è¦å…ˆç¡®ä¿è·å–é”æˆåŠŸå†è¿›è¡Œä¸šåŠ¡æ“ä½œã€‚é€šå¸¸æ‰€è¯´çš„â€œä¸€é”äºŒæŸ¥ä¸‰æ›´æ–°â€å³æŒ‡çš„æ˜¯ä½¿ç”¨æ‚²è§‚é”ã€‚é€šå¸¸æ¥è®²åœ¨æ•°æ®åº“ä¸Šçš„æ‚²è§‚é”éœ€è¦æ•°æ®åº“æœ¬èº«æä¾›æ”¯æŒï¼Œå³é€šè¿‡å¸¸ç”¨çš„select â€¦ for updateæ“ä½œæ¥å®ç°æ‚²è§‚é”ã€‚å½“æ•°æ®åº“æ‰§è¡Œselect for updateæ—¶ä¼šè·å–è¢«selectä¸­çš„æ•°æ®è¡Œçš„è¡Œé”ï¼Œå› æ­¤å…¶ä»–å¹¶å‘æ‰§è¡Œçš„select for updateå¦‚æœè¯•å›¾é€‰ä¸­åŒä¸€è¡Œåˆ™ä¼šå‘ç”Ÿæ’æ–¥ï¼ˆéœ€è¦ç­‰å¾…è¡Œé”è¢«é‡Šæ”¾ï¼‰ï¼Œå› æ­¤è¾¾åˆ°é”çš„æ•ˆæœã€‚select for updateè·å–çš„è¡Œé”ä¼šåœ¨å½“å‰äº‹åŠ¡ç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œå› æ­¤å¿…é¡»åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨ã€‚ è¡¥å……ï¼šä¸åŒçš„æ•°æ®åº“å¯¹select for updateçš„å®ç°å’Œæ”¯æŒéƒ½æ˜¯æœ‰æ‰€åŒºåˆ«çš„ï¼Œ oracleæ”¯æŒselect for update no waitï¼Œè¡¨ç¤ºå¦‚æœæ‹¿ä¸åˆ°é”ç«‹åˆ»æŠ¥é”™ï¼Œè€Œä¸æ˜¯ç­‰å¾…ï¼ŒMySQLå°±æ²¡æœ‰no waitè¿™ä¸ªé€‰é¡¹ã€‚ MySQLè¿˜æœ‰ä¸ªé—®é¢˜æ˜¯select for updateè¯­å¥æ‰§è¡Œä¸­æ‰€æœ‰æ‰«æè¿‡çš„è¡Œéƒ½ä¼šè¢«é”ä¸Šï¼Œè¿™ä¸€ç‚¹å¾ˆå®¹æ˜“é€ æˆé—®é¢˜ã€‚å› æ­¤å¦‚æœåœ¨MySQLä¸­ç”¨æ‚²è§‚é”åŠ¡å¿…è¦ç¡®å®šèµ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æã€‚ ä¹è§‚é”ï¼ˆOptimistic Lockï¼‰: 1.ä¹è§‚é”ï¼Œä¹Ÿå«ä¹è§‚å¹¶å‘æ§åˆ¶ï¼Œå®ƒå‡è®¾å¤šç”¨æˆ·å¹¶å‘çš„äº‹åŠ¡åœ¨å¤„ç†æ—¶ä¸ä¼šå½¼æ­¤äº’ç›¸å½±å“ï¼Œå„äº‹åŠ¡èƒ½å¤Ÿåœ¨ä¸äº§ç”Ÿé”çš„æƒ…å†µä¸‹å¤„ç†å„è‡ªå½±å“çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚åœ¨æäº¤æ•°æ®æ›´æ–°ä¹‹å‰ï¼Œæ¯ä¸ªäº‹åŠ¡ä¼šå…ˆæ£€æŸ¥åœ¨è¯¥äº‹åŠ¡è¯»å–æ•°æ®åï¼Œæœ‰æ²¡æœ‰å…¶ä»–äº‹åŠ¡åˆä¿®æ”¹äº†è¯¥æ•°æ®ã€‚å¦‚æœå…¶ä»–äº‹åŠ¡æœ‰æ›´æ–°çš„è¯ï¼Œé‚£ä¹ˆå½“å‰æ­£åœ¨æäº¤çš„äº‹åŠ¡ä¼šè¿›è¡Œå›æ»šã€‚ 2.ä¹è§‚é”çš„ç‰¹ç‚¹å…ˆè¿›è¡Œä¸šåŠ¡æ“ä½œï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²ä¸å»æ‹¿é”ã€‚å³â€œä¹è§‚â€çš„è®¤ä¸ºæ‹¿é”å¤šåŠæ˜¯ä¼šæˆåŠŸçš„ï¼Œå› æ­¤åœ¨è¿›è¡Œå®Œä¸šåŠ¡æ“ä½œéœ€è¦å®é™…æ›´æ–°æ•°æ®çš„æœ€åä¸€æ­¥å†å»æ‹¿ä¸€ä¸‹é”å°±å¥½ã€‚ä¹è§‚é”åœ¨æ•°æ®åº“ä¸Šçš„å®ç°å®Œå…¨æ˜¯é€»è¾‘çš„ï¼Œä¸éœ€è¦æ•°æ®åº“æä¾›ç‰¹æ®Šçš„æ”¯æŒã€‚ 3.ä¸€èˆ¬çš„åšæ³•æ˜¯åœ¨éœ€è¦é”çš„æ•°æ®ä¸Šå¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæˆ–è€…æ—¶é—´æˆ³ï¼Œ å®ç°æ–¹å¼ä¸¾ä¾‹å¦‚ä¸‹ï¼š ä¹è§‚é”ï¼ˆç»™è¡¨åŠ ä¸€ä¸ªç‰ˆæœ¬å·å­—æ®µï¼‰ è¿™ä¸ªå¹¶ä¸æ˜¯ä¹è§‚é”çš„å®šä¹‰ï¼Œç»™è¡¨åŠ ç‰ˆæœ¬å·ï¼Œæ˜¯æ•°æ®åº“å®ç°ä¹è§‚é”çš„ä¸€ç§æ–¹å¼ã€‚ SELECT data AS old_data, version AS old_version FROM â€¦; æ ¹æ®è·å–çš„æ•°æ®è¿›è¡Œä¸šåŠ¡æ“ä½œï¼Œå¾—åˆ°new_dataå’Œnew_version UPDATE SET data = new_data, version = new_version WHERE version = old_version if (updated row &gt; 0) { // ä¹è§‚é”è·å–æˆåŠŸï¼Œæ“ä½œå®Œæˆ } else { // ä¹è§‚é”è·å–å¤±è´¥ï¼Œå›æ»šå¹¶é‡è¯• } æ³¨æ„ï¼š ä¹è§‚é”åœ¨ä¸å‘ç”Ÿå–é”å¤±è´¥çš„æƒ…å†µä¸‹å¼€é”€æ¯”æ‚²è§‚é”å°ï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿå¤±è´¥å›æ»šå¼€é”€åˆ™æ¯”è¾ƒå¤§ï¼Œå› æ­¤é€‚åˆç”¨åœ¨å–é”å¤±è´¥æ¦‚ç‡æ¯”è¾ƒå°çš„åœºæ™¯ï¼Œå¯ä»¥æå‡ç³»ç»Ÿå¹¶å‘æ€§èƒ½ ä¹è§‚é”è¿˜é€‚ç”¨äºä¸€äº›æ¯”è¾ƒç‰¹æ®Šçš„åœºæ™¯ï¼Œä¾‹å¦‚åœ¨ä¸šåŠ¡æ“ä½œè¿‡ç¨‹ä¸­æ— æ³•å’Œæ•°æ®åº“ä¿æŒè¿æ¥ç­‰æ‚²è§‚é”æ— æ³•é€‚ç”¨çš„åœ°æ–¹ã€‚ æ€»ç»“ï¼šæ‚²è§‚é”å’Œä¹è§‚é”æ˜¯æ•°æ®åº“ç”¨æ¥ä¿è¯æ•°æ®å¹¶å‘å®‰å…¨é˜²æ­¢æ›´æ–°ä¸¢å¤±çš„ä¸¤ç§æ–¹æ³•ï¼Œä¾‹å­åœ¨select â€¦ for updateå‰åŠ ä¸ªäº‹åŠ¡å°±å¯ä»¥é˜²æ­¢æ›´æ–°ä¸¢å¤±ã€‚æ‚²è§‚é”å’Œä¹è§‚é”å¤§éƒ¨åˆ†åœºæ™¯ä¸‹å·®å¼‚ä¸å¤§ï¼Œä¸€äº›ç‹¬ç‰¹åœºæ™¯ä¸‹æœ‰ä¸€äº›å·®åˆ«ï¼Œä¸€èˆ¬æˆ‘ä»¬å¯ä»¥ä»å¦‚ä¸‹å‡ ä¸ªæ–¹é¢æ¥åˆ¤æ–­ã€‚ å“åº”é€Ÿåº¦ï¼š å¦‚æœéœ€è¦éå¸¸é«˜çš„å“åº”é€Ÿåº¦ï¼Œå»ºè®®é‡‡ç”¨ä¹è§‚é”æ–¹æ¡ˆï¼ŒæˆåŠŸå°±æ‰§è¡Œï¼Œä¸æˆåŠŸå°±å¤±è´¥ï¼Œä¸éœ€è¦ç­‰å¾…å…¶ä»–å¹¶å‘å»é‡Šæ”¾é”ã€‚â€™ å†²çªé¢‘ç‡ï¼š å¦‚æœå†²çªé¢‘ç‡éå¸¸é«˜ï¼Œå»ºè®®é‡‡ç”¨æ‚²è§‚é”ï¼Œä¿è¯æˆåŠŸç‡ï¼Œå¦‚æœå†²çªé¢‘ç‡å¤§ï¼Œä¹è§‚é”ä¼šéœ€è¦å¤šæ¬¡é‡è¯•æ‰èƒ½æˆåŠŸï¼Œä»£ä»·æ¯”è¾ƒå¤§ã€‚ é‡è¯•ä»£ä»·ï¼š å¦‚æœé‡è¯•ä»£ä»·å¤§ï¼Œå»ºè®®é‡‡ç”¨æ‚²è§‚é”ã€‚ ä¸ƒã€å…¶ä»–1.æ•°æ®åº“çš„ä¸»ä»å¤åˆ¶ ä¸»ä»å¤åˆ¶çš„å‡ ç§æ–¹å¼: åŒæ­¥å¤åˆ¶: æ‰€è°“çš„åŒæ­¥å¤åˆ¶ï¼Œæ„æ€æ˜¯masterçš„å˜åŒ–ï¼Œå¿…é¡»ç­‰å¾…slave-1,slave-2,â€¦,slave-nå®Œæˆåæ‰èƒ½è¿”å›ã€‚ è¿™æ ·ï¼Œæ˜¾ç„¶ä¸å¯å–ï¼Œä¹Ÿä¸æ˜¯MySQLå¤åˆ¶çš„é»˜è®¤è®¾ç½®ã€‚æ¯”å¦‚ï¼Œåœ¨WEBå‰ç«¯é¡µé¢ä¸Šï¼Œç”¨æˆ·å¢åŠ äº†æ¡è®°å½•ï¼Œéœ€è¦ç­‰å¾…å¾ˆé•¿æ—¶é—´ã€‚ å¼‚æ­¥å¤åˆ¶: å¦‚åŒAJAXè¯·æ±‚ä¸€æ ·ã€‚masteråªéœ€è¦å®Œæˆè‡ªå·±çš„æ•°æ®åº“æ“ä½œå³å¯ã€‚è‡³äºslavesæ˜¯å¦æ”¶åˆ°äºŒè¿›åˆ¶æ—¥å¿—ï¼Œæ˜¯å¦å®Œæˆæ“ä½œï¼Œä¸ç”¨å…³å¿ƒ,MySQLçš„é»˜è®¤è®¾ç½®ã€‚ åŠåŒæ­¥å¤åˆ¶: masteråªä¿è¯slavesä¸­çš„ä¸€ä¸ªæ“ä½œæˆåŠŸï¼Œå°±è¿”å›ï¼Œå…¶ä»–slaveä¸ç®¡ã€‚ è¿™ä¸ªåŠŸèƒ½ï¼Œæ˜¯ç”±googleä¸ºMySQLå¼•å…¥çš„ã€‚ 2.æ•°æ®åº“ä¸»ä»å¤åˆ¶åˆ†æçš„ 7 ä¸ªé—®é¢˜?é—®é¢˜1ï¼šmasterçš„å†™æ“ä½œï¼Œslavesè¢«åŠ¨çš„è¿›è¡Œä¸€æ ·çš„æ“ä½œï¼Œä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆslaveæ˜¯å¦å¯ä»¥ä¸»åŠ¨çš„è¿›è¡Œå†™æ“ä½œï¼Ÿ å‡è®¾slaveå¯ä»¥ä¸»åŠ¨çš„è¿›è¡Œå†™æ“ä½œï¼Œslaveåˆæ— æ³•é€šçŸ¥masterï¼Œè¿™æ ·å°±å¯¼è‡´äº†masterå’Œslaveæ•°æ®ä¸ä¸€è‡´äº†ã€‚å› æ­¤slaveä¸åº”è¯¥è¿›è¡Œå†™æ“ä½œï¼Œè‡³å°‘æ˜¯slaveä¸Šæ¶‰åŠåˆ°å¤åˆ¶çš„æ•°æ®åº“ä¸å¯ä»¥å†™ã€‚å®é™…ä¸Šï¼Œè¿™é‡Œå·²ç»æ­ç¤ºäº†è¯»å†™åˆ†ç¦»çš„æ¦‚å¿µã€‚ é—®é¢˜2ï¼šä¸»ä»å¤åˆ¶ä¸­ï¼Œå¯ä»¥æœ‰Nä¸ªslave,å¯æ˜¯è¿™äº›slaveåˆä¸èƒ½è¿›è¡Œå†™æ“ä½œï¼Œè¦ä»–ä»¬å¹²å˜›ï¼Ÿ å®ç°æ•°æ®å¤‡ä»½:ç±»ä¼¼äºé«˜å¯ç”¨çš„åŠŸèƒ½ï¼Œä¸€æ—¦masteræŒ‚äº†ï¼Œå¯ä»¥è®©slaveé¡¶ä¸Šå»ï¼ŒåŒæ—¶slaveæå‡ä¸ºmasterã€‚ å¼‚åœ°å®¹ç¾:æ¯”å¦‚masteråœ¨åŒ—äº¬ï¼Œåœ°éœ‡æŒ‚äº†ï¼Œé‚£ä¹ˆåœ¨ä¸Šæµ·çš„slaveè¿˜å¯ä»¥ç»§ç»­ã€‚ä¸»è¦ç”¨äºå®ç°scale out,åˆ†æ‹…è´Ÿè½½,å¯ä»¥å°†è¯»çš„ä»»åŠ¡åˆ†æ•£åˆ°slavesä¸Šã€‚ã€å¾ˆå¯èƒ½çš„æƒ…å†µæ˜¯ï¼Œä¸€ä¸ªç³»ç»Ÿçš„è¯»æ“ä½œè¿œè¿œå¤šäºå†™æ“ä½œï¼Œå› æ­¤å†™æ“ä½œå‘å‘masterï¼Œè¯»æ“ä½œå‘å‘slavesè¿›è¡Œæ“ä½œã€‘ é—®é¢˜3ï¼šä¸»ä»å¤åˆ¶ä¸­æœ‰master,slave1,slave2,â€¦ç­‰ç­‰è¿™ä¹ˆå¤šMySQLæ•°æ®åº“ï¼Œé‚£æ¯”å¦‚ä¸€ä¸ªJAVA WEBåº”ç”¨åˆ°åº•åº”è¯¥è¿æ¥å“ªä¸ªæ•°æ®åº“? æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­å¯ä»¥è¿™æ ·ï¼Œinsert/delete/updateè¿™äº›æ›´æ–°æ•°æ®åº“çš„æ“ä½œï¼Œç”¨connection(for master)è¿›è¡Œæ“ä½œï¼Œ selectç”¨connection(for slaves)è¿›è¡Œæ“ä½œã€‚é‚£æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè¿˜è¦å®Œæˆæ€ä¹ˆä»slavesé€‰æ‹©ä¸€ä¸ªæ¥æ‰§è¡Œselectï¼Œä¾‹å¦‚ä½¿ç”¨ç®€å•çš„è½®å¾ªç®—æ³•ã€‚ è¿™æ ·çš„è¯ï¼Œç›¸å½“äºåº”ç”¨ç¨‹åºå®Œæˆäº†SQLè¯­å¥çš„è·¯ç”±ï¼Œè€Œä¸”ä¸MySQLçš„ä¸»ä»å¤åˆ¶æ¶æ„éå¸¸å…³è”ï¼Œä¸€æ—¦masteræŒ‚äº†ï¼ŒæŸäº›slaveæŒ‚äº†ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºå°±è¦ä¿®æ”¹äº†ã€‚èƒ½ä¸èƒ½è®©åº”ç”¨ç¨‹åºä¸MySQLçš„ä¸»ä»å¤åˆ¶æ¶æ„æ²¡æœ‰ä»€ä¹ˆå¤ªå¤šå…³ç³»å‘¢ï¼Ÿæ‰¾ä¸€ä¸ªç»„ä»¶ï¼Œapplication programåªéœ€è¦ä¸å®ƒæ‰“äº¤é“ï¼Œç”¨å®ƒæ¥å®ŒæˆMySQLçš„ä»£ç†ï¼Œå®ç°SQLè¯­å¥çš„è·¯ç”±ã€‚MySQL proxyå¹¶ä¸è´Ÿè´£ï¼Œæ€ä¹ˆä»ä¼—å¤šçš„slavesæŒ‘ä¸€ä¸ªï¼Ÿå¯ä»¥äº¤ç»™å¦ä¸€ä¸ªç»„ä»¶(æ¯”å¦‚haproxy)æ¥å®Œæˆã€‚ è¿™å°±æ˜¯æ‰€è°“çš„MySQL READ WRITE SPLITEï¼ŒMySQLçš„è¯»å†™åˆ†ç¦»ã€‚ é—®é¢˜4ï¼šå¦‚æœMySQL proxy , direct , masterä»–ä»¬ä¸­çš„æŸäº›æŒ‚äº†æ€ä¹ˆåŠï¼Ÿ æ€»ç»Ÿä¸€èˆ¬éƒ½ä¼šå¼„ä¸ªå‰¯æ€»ç»Ÿï¼Œä»¥é˜²ä¸æµ‹ã€‚åŒæ ·çš„ï¼Œå¯ä»¥ç»™è¿™äº›å…³é”®çš„èŠ‚ç‚¹æ¥ä¸ªå¤‡ä»½ã€‚ é—®é¢˜5ï¼šå½“masterçš„äºŒè¿›åˆ¶æ—¥å¿—æ¯äº§ç”Ÿä¸€ä¸ªäº‹ä»¶ï¼Œéƒ½éœ€è¦å‘å¾€slaveï¼Œå¦‚æœæˆ‘ä»¬æœ‰Nä¸ªslave,é‚£æ˜¯å‘Næ¬¡ï¼Œè¿˜æ˜¯åªå‘ä¸€æ¬¡ï¼Ÿå¦‚æœåªå‘ä¸€æ¬¡ï¼Œå‘ç»™äº†slave-1ï¼Œé‚£slave-2,slave-3,â€¦å®ƒä»¬æ€ä¹ˆåŠï¼Ÿ æ˜¾ ç„¶ï¼Œåº”è¯¥å‘Næ¬¡ã€‚å®é™…ä¸Šï¼Œåœ¨MySQL masterå†…éƒ¨ï¼Œç»´æŠ¤Nä¸ªçº¿ç¨‹ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£å°†äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶å‘å¾€å¯¹åº”çš„slaveã€‚masteræ—¢è¦è´Ÿè´£å†™æ“ä½œï¼Œè¿˜çš„ç»´æŠ¤Nä¸ªçº¿ç¨‹ï¼Œè´Ÿæ‹…ä¼šå¾ˆé‡ã€‚å¯ä»¥è¿™æ ·ï¼Œslave-1æ˜¯masterçš„ä»ï¼Œslave-1åˆæ˜¯slave-2,slave-3,â€¦çš„ä¸»ï¼ŒåŒæ—¶slave-1ä¸å†è´Ÿè´£selectã€‚ slave-1å°†masterçš„å¤åˆ¶çº¿ç¨‹çš„è´Ÿæ‹…ï¼Œè½¬ç§»åˆ°è‡ªå·±çš„èº«ä¸Šã€‚è¿™å°±æ˜¯æ‰€è°“çš„å¤šçº§å¤åˆ¶çš„æ¦‚å¿µã€‚ é—®é¢˜6ï¼šå½“ä¸€ä¸ªselectå‘å¾€MySQL proxyï¼Œå¯èƒ½è¿™æ¬¡ç”±slave-2å“åº”ï¼Œä¸‹æ¬¡ç”±slave-3å“åº”ï¼Œè¿™æ ·çš„è¯ï¼Œå°±æ— æ³•åˆ©ç”¨æŸ¥è¯¢ç¼“å­˜äº†ã€‚ åº”è¯¥æ‰¾ä¸€ä¸ªå…±äº«å¼çš„ç¼“å­˜ï¼Œæ¯”å¦‚memcacheæ¥è§£å†³ã€‚å°†slave-2,slave-3,â€¦è¿™äº›æŸ¥è¯¢çš„ç»“æœéƒ½ç¼“å­˜è‡³mamcacheä¸­ã€‚ é—®é¢˜7ï¼šéšç€åº”ç”¨çš„æ—¥ç›Šå¢é•¿ï¼Œè¯»æ“ä½œå¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥æ‰©å±•slaveï¼Œä½†æ˜¯å¦‚æœmasteræ»¡è¶³ä¸äº†å†™æ“ä½œäº†ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ scale on ?æ›´å¥½çš„æœåŠ¡å™¨ï¼Ÿ æ²¡æœ‰æœ€å¥½çš„ï¼Œåªæœ‰æ›´å¥½çš„ï¼Œå¤ªè´µäº†ã€‚ã€‚ã€‚scale out ? ä¸»ä»å¤åˆ¶æ¶æ„å·²ç»æ»¡è¶³ä¸äº†ã€‚å¯ä»¥åˆ†åº“ã€å‚ç›´æ‹†åˆ†ã€‘ï¼Œåˆ†è¡¨ã€æ°´å¹³æ‹†åˆ†ã€‘ã€‚ 3.mysql é«˜å¹¶å‘ç¯å¢ƒè§£å†³æ–¹æ¡ˆ? MySQL é«˜å¹¶å‘ç¯å¢ƒè§£å†³æ–¹æ¡ˆï¼š åˆ†åº“ åˆ†è¡¨ åˆ†å¸ƒå¼ å¢åŠ äºŒçº§ç¼“å­˜ã€‚ã€‚ã€‚ã€‚ã€‚ éœ€æ±‚åˆ†æï¼šäº’è”ç½‘å•ä½ æ¯å¤©å¤§é‡æ•°æ®è¯»å–ï¼Œå†™å…¥ï¼Œå¹¶å‘æ€§é«˜ã€‚ ç°æœ‰è§£å†³æ–¹å¼ï¼šæ°´å¹³åˆ†åº“åˆ†è¡¨ï¼Œç”±å•ç‚¹åˆ†å¸ƒåˆ°å¤šç‚¹æ•°æ®åº“ä¸­ï¼Œä»è€Œé™ä½å•ç‚¹æ•°æ®åº“å‹åŠ›ã€‚ é›†ç¾¤æ–¹æ¡ˆï¼šè§£å†³DBå®•æœºå¸¦æ¥çš„å•ç‚¹DBä¸èƒ½è®¿é—®é—®é¢˜ã€‚ è¯»å†™åˆ†ç¦»ç­–ç•¥ï¼šæå¤§é™åº¦æé«˜äº†åº”ç”¨ä¸­Readæ•°æ®çš„é€Ÿåº¦å’Œå¹¶å‘é‡ã€‚æ— æ³•è§£å†³é«˜å†™å…¥å‹åŠ›ã€‚ 4.æ•°æ®åº“å´©æºƒæ—¶äº‹åŠ¡çš„æ¢å¤æœºåˆ¶ï¼ˆREDOæ—¥å¿—å’ŒUNDOæ—¥å¿—ï¼‰?è½¬è½½ï¼šMySQL REDOæ—¥å¿—å’ŒUNDOæ—¥å¿— Undo Log: Undo Logæ˜¯ä¸ºäº†å®ç°äº‹åŠ¡çš„åŸå­æ€§ï¼Œåœ¨MySQLæ•°æ®åº“InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œè¿˜ç”¨äº†Undo Logæ¥å®ç°å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(ç®€ç§°ï¼šMVCC)ã€‚ äº‹åŠ¡çš„åŸå­æ€§(Atomicity)äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆä¸åšä»»ä½•æ“ä½œï¼Œä¸èƒ½åªåšéƒ¨åˆ†æ“ä½œã€‚å¦‚æœåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ï¼Œè¦å›æ»š(Rollback)åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ã€‚åŸç†Undo Logçš„åŸç†å¾ˆç®€å•ï¼Œä¸ºäº†æ»¡è¶³äº‹åŠ¡çš„åŸå­æ€§ï¼Œåœ¨æ“ä½œä»»ä½•æ•°æ®ä¹‹å‰ï¼Œé¦–å…ˆå°†æ•°æ®å¤‡ä»½åˆ°ä¸€ä¸ªåœ°æ–¹ï¼ˆè¿™ä¸ªå­˜å‚¨æ•°æ®å¤‡ä»½çš„åœ°æ–¹ç§°ä¸ºUndoLogï¼‰ã€‚ç„¶åè¿›è¡Œæ•°æ®çš„ä¿®æ”¹ã€‚å¦‚æœå‡ºç°äº†é”™è¯¯æˆ–è€…ç”¨æˆ·æ‰§è¡Œäº†ROLLBACKè¯­å¥ï¼Œç³»ç»Ÿå¯ä»¥åˆ©ç”¨Undo Logä¸­çš„å¤‡ä»½å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚ ä¹‹æ‰€ä»¥èƒ½åŒæ—¶ä¿è¯åŸå­æ€§å’ŒæŒä¹…åŒ–ï¼Œæ˜¯å› ä¸ºä»¥ä¸‹ç‰¹ç‚¹ï¼š æ›´æ–°æ•°æ®å‰è®°å½•Undo logã€‚ä¸ºäº†ä¿è¯æŒä¹…æ€§ï¼Œå¿…é¡»å°†æ•°æ®åœ¨äº‹åŠ¡æäº¤å‰å†™åˆ°ç£ç›˜ã€‚åªè¦äº‹åŠ¡æˆåŠŸæäº¤ï¼Œæ•°æ®å¿…ç„¶å·²ç»æŒä¹…åŒ–ã€‚Undo logå¿…é¡»å…ˆäºæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚å¦‚æœåœ¨G,Hä¹‹é—´ç³»ç»Ÿå´©æºƒï¼Œundo logæ˜¯å®Œæ•´çš„ï¼Œ å¯ä»¥ç”¨æ¥å›æ»šäº‹åŠ¡ã€‚å¦‚æœåœ¨A-Fä¹‹é—´ç³»ç»Ÿå´©æºƒ,å› ä¸ºæ•°æ®æ²¡æœ‰æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚æ‰€ä»¥ç£ç›˜ä¸Šçš„æ•°æ®è¿˜æ˜¯ä¿æŒåœ¨äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ã€‚ ç¼ºé™·ï¼šæ¯ä¸ªäº‹åŠ¡æäº¤å‰å°†æ•°æ®å’ŒUndo Logå†™å…¥ç£ç›˜ï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„ç£ç›˜IOï¼Œå› æ­¤æ€§èƒ½å¾ˆä½ã€‚å¦‚æœèƒ½å¤Ÿå°†æ•°æ®ç¼“å­˜ä¸€æ®µæ—¶é—´ï¼Œå°±èƒ½å‡å°‘IOæé«˜æ€§èƒ½ã€‚ä½†æ˜¯è¿™æ ·å°±ä¼šä¸§å¤±äº‹åŠ¡çš„æŒä¹…æ€§ã€‚å› æ­¤å¼•å…¥äº†å¦å¤–ä¸€ç§æœºåˆ¶æ¥å®ç°æŒä¹…åŒ–ï¼Œå³Redo Logã€‚ Redo Log: åŸç†å’ŒUndo Logç›¸åï¼ŒRedo Logè®°å½•çš„æ˜¯æ–°æ•°æ®çš„å¤‡ä»½ã€‚åœ¨äº‹åŠ¡æäº¤å‰ï¼Œåªè¦å°†Redo LogæŒä¹…åŒ–å³å¯ï¼Œä¸éœ€è¦å°†æ•°æ®æŒä¹…åŒ–ã€‚å½“ç³»ç»Ÿå´©æºƒæ—¶ï¼Œè™½ç„¶æ•°æ®æ²¡æœ‰æŒä¹…åŒ–ï¼Œä½†æ˜¯Redo Logå·²ç»æŒä¹…åŒ–ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®Redo Logçš„å†…å®¹ï¼Œå°†æ‰€æœ‰æ•°æ®æ¢å¤åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“é¢è¯•é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šçº¿ç¨‹ï¼ˆå…«ï¼‰--- æ€»ç»“ & è¡¥å…… & api ä½¿ç”¨]]></title>
    <url>%2F2020%2F03%2F01%2F%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%88%E5%85%AB%EF%BC%89---%20%E6%80%BB%E7%BB%93%20%26%20api%20%E4%BD%BF%E7%94%A8%20%26%20%E8%A1%A5%E5%85%85.html</url>
    <content type="text"><![CDATA[å­¦ä¹ è·¯å¾„ è¡¥å……ä»¥ä¸ŠåŸºæœ¬ä¸Šæ¶µç›–äº†è‡ªå·±çœ‹çš„å¤šçº¿ç¨‹çš„å†…å®¹ï¼Œä½†æ˜¯å‘¢ï¼Œè¿˜æœ‰ä¸€äº› juc ä¸‹çš„ç±»æˆ‘æ²¡æœ‰æåŠåˆ°ï¼Œä½†æ˜¯åˆæ¯”è¾ƒé‡è¦ï¼Œä¸‹é¢æˆ‘ç¨å¾®å±•å¼€è¯´ä¸€ä¸‹ï¼Œå°±ä¸ä»æºç ä¸Šåˆ†æäº†ï¼Œå› ä¸ºéƒ½æ˜¯å¤§åŒå°å¼‚çš„ï¼Œä¸»è¦è¿˜æ˜¯ä»è·Ÿä»¥å‰è°ˆåˆ°çš„ç±»çš„å¼‚åŒç‚¹å‡ºå‘ï¼Œç„¶åè®²ä¸€ä¸‹å®é™…ç”¨é€”å’Œä½¿ç”¨æ–¹å¼ã€‚ StampedLockåœ¨å¤šçº¿ç¨‹ï¼ˆä¸€ï¼‰ï¼Œæˆ‘ä»¬å°±æåŠäº† ReentrantLock å’Œ ReentrantReadWriteLockï¼Œä»–ä»¬æ˜¯åœ¨ jdk 1. 5 å°±å¼•å…¥äº†ï¼Œè€Œè¿™ä¸ª StampedLock åˆ™æ˜¯åœ¨ jdk 1.8 å¼•å…¥çš„ï¼Œæ—¢ç„¶æ™šäº†å¥½å‡ å¹´æ‰æ¥ï¼Œè‚¯å®šæ˜¯æ›´åŠ ä¼˜ç§€äº†ï¼ç­”æ¡ˆä¹Ÿæ˜¯è‚¯å®šçš„ï¼ŒStampedLock ç»§æ‰¿äº†å‰è¾ˆä»¬çš„ä¼˜ç‚¹ã€‚ReentrantLock ç»§æ‰¿äº† AQS çš„ä¼˜ç‚¹ï¼Œå¼•å…¥è‡ªæ—‹é”å‡å°‘é”çš„æ¶ˆè€—ï¼ŒReentrantReadWriteLock åˆ™åœ¨ ReentrantLock åŸºç¡€ä¹‹ä¸Šï¼Œå¤§å¤§è§£å†³äº†è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹ï¼Œå¹¶å‘çš„æ•ˆç‡ã€‚è¯»-è¯»ä¹‹é—´ä¸äº’æ–¥ï¼Œå…±äº«ï¼Œå†™-è¯»ï¼Œå†™-å†™ä¾ç„¶äº’æ–¥ã€‚StampedLock åˆ™åœ¨ ReentrantReadWriteLock åŸºç¡€ä¸Šç»§ç»­æ‰©å±•ï¼Œä¸ºäº†è§£å†³è¯»å¤šå†™å°‘åœºæ™¯ä¸‹å†™é¥¥é¥¿çš„é—®é¢˜ï¼Œå¼•å…¥æ‚²è§‚è¯»é”å’Œä¹è§‚è¯»é”çš„æ¦‚å¿µï¼Œæ‰€è°“çš„æ‚²è§‚è¯»é”å°±æ˜¯ ReentrantReadWriteLock ä¸­çš„ readLockï¼Œå³æ¯æ¬¡è¯»æ•°æ®æ—¶éƒ½éœ€è¦åŠ é”ï¼Œä¸”è¯»-å†™äº’æ–¥ï¼Œè€Œä¹è§‚é”ä¸åŒï¼Œå½“æ•°æ®æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ˆåˆ¤æ–­ stamp æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼‰æ—¶ï¼Œå¯ä»¥ä¸åŠ é”ï¼Œç›´æ¥è¯»å–ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥åšåˆ° è¯»-å†™ä¸äº’æ–¥ã€Œå› ä¸ºäººå®¶è¯»å‹æ ¹æ²¡è¦é”â€¦åªæ˜¯å»è¯»äº†ä¸ª stamp è€Œå·²â€¦ã€ã€‚ éƒ¨åˆ†æ–¹æ³• å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä½“ä¸Šå…¶å® StampedLock å’Œ ReentrantReadWriteLock æ–¹æ³•å·®ä¸å¤šï¼Œå®ç°æ–¹å¼ä¹Ÿæ˜¯ä¸€æ ·ï¼Œéƒ½æ˜¯ç”¨äº† CLH é˜Ÿåˆ—æ­é…è‡ªæ—‹è§£å†³æ’é˜Ÿç­‰å¾…é—®é¢˜ï¼Œæœ€é‡è¦çš„è¿˜æ˜¯ä¹è§‚è¯»é”çš„åŠ å…¥ã€‚ã€Œç¨å¾®çœ‹äº†ä¸€çœ¼æºç ï¼Œè¿™é‡Œçš„é˜Ÿåˆ—å¥½åƒä¸æ˜¯ Node èŠ‚ç‚¹äº†ï¼Œè€Œæ˜¯ WNode èŠ‚ç‚¹ï¼ŒåŸå› æ˜¯åŠ äº†ä¸€ä¸ªå±æ€§â€”- stampã€‚ã€ æ‰€ä»¥æˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹å®˜æ–¹ç»™çš„ä¾‹å­ï¼Œä½“ä¼šä¸€ä¸‹ä¹è§‚è¯»é”å¦‚ä½•ä½¿ç”¨çš„ï¼š 12345678910111213141516171819202122232425262728293031323334public class Point &#123; private double x, y;//å†…éƒ¨å®šä¹‰è¡¨ç¤ºåæ ‡ç‚¹ private final StampedLock s1 = new StampedLock();//å®šä¹‰äº† StampedLock é” void move(double deltaX, double deltaY) &#123; // å†™ long stamp = s1.writeLock();//æ³¨æ„ StampedLock.writeLock()å¯æ²¡æœ‰å“åº”ä¸­æ–­å“¦ //å“åº”ä¸­æ–­éœ€è°ƒç”¨StampedLock.asWriteLock()ï¼Œç­‰åŒäºReentrantReadWriteLock.writeLock() try &#123; x += deltaX; y += deltaY; &#125; finally &#123; s1.unlockWrite(stamp);//é€€å‡ºä¸´ç•ŒåŒº,é‡Šæ”¾å†™é” &#125; &#125; double distanceFormOrigin() &#123;//åªè¯»æ–¹æ³• long stamp = s1.tryOptimisticRead(); //è¯•å›¾å°è¯•ä¸€æ¬¡ä¹è§‚è¯» è¿”å›ä¸€ä¸ªç±»ä¼¼äºæ—¶é—´æˆ³çš„é‚®æˆ³æ•´æ•°stamp è¿™ä¸ªstampå°±å¯ä»¥ä½œä¸ºè¿™ä¸€ä¸ªæ‰€è·å–çš„å‡­è¯ //---------------------------------- // è¿™é‡Œå°±æ˜¯å¼€å§‹è¯»å–å†…å®¹ double currentX = x, currentY = y;//è¯»å–xå’Œyçš„å€¼ //---------------------------------- // ç„¶ååˆ¤æ–­ä¸€ä¸‹è¯»çš„è¿‡ç¨‹ä¸­ï¼Œstamp æœ‰æ²¡æœ‰å˜åŒ–ï¼Œå°±æ˜¯è¯´æœŸé—´æœ‰æ²¡æœ‰å†™é”å·¥ä½œäº†ï¼Œåªæœ‰å†™é”æ”¹å˜ stamp if (!s1.validate(stamp)) &#123; stamp = s1.readLock(); // å˜æˆæ‚²è§‚è¯»é”ï¼Œæ³¨æ„è¿™é‡Œè·Ÿå†™é”ä¸€æ ·ä¸æ˜¯å¯ä¸­æ–­çš„ try &#123; currentX = x; currentY = y; &#125; finally &#123; s1.unlockRead(stamp);//é€€å‡ºä¸´ç•ŒåŒº,é‡Šæ”¾è¯»é” &#125; &#125; return Math.sqrt(currentX * currentX + currentY * currentY); &#125;&#125; æ€»ç»“ä¸€ä¸‹ï¼š StampedLock ä¸­çš„ asReadLock() å’Œ asWriteLock() ç­‰åŒäº ReentrantReadWriteLock ä¸­çš„ readLock() å’Œ writeLock()ï¼Œéƒ½æ˜¯å¯ä¸­æ–­çš„ï¼Œä½†æ˜¯ StampedLock() ä¹Ÿæä¾›äº† readLock() å’Œ writeLock()ï¼Œä½†è¿™æ˜¯ä¸å¯ä¸­æ–­çš„ã€‚ StampedLock ä¸­çš„è¯»æ˜¯å…ˆä¹è§‚è¯»ï¼Œåœ¨ä¹è§‚è¯»ä¹‹å‰ï¼Œå…ˆæ‹¿åˆ°å½“å‰çš„ stampï¼Œç„¶åå†è¯»å®Œä¹‹åéªŒè¯ä¸€éæ˜¯å¦ä¸­é€”æœ‰å†™é”æ”¹å˜äº† stampï¼Œé˜²æ­¢å‡ºç°è„è¯»ï¼Œå¦‚æœ stamp å˜åŒ–äº†ï¼Œåˆ™å‡çº§æˆæ‚²è§‚è¯»é”å†è¯»ä¸€éã€‚ æ³¨æ„ StampedLock.readLock() å’Œ Stamped.writeLock()çš„ç”¨æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ª long stampï¼Œç›´æ¥ Stamped.readLock() å°±æ˜¯è·å–é”å¹¶ä¸”è¿”å› stampï¼Œç„¶åè§£é”è¦å¸¦ç€è¿™ä¸ª stamp æ‰èƒ½è§£é”ã€‚ ä¸€äº›ç–‘æƒ‘é¦–å…ˆçœ‹åˆ°ç½‘ä¸Šè¯´çš„ï¼Œå› ä¸º Stamped.readLock()ä¸å¤„ç†ä¸­æ–­å¼‚å¸¸ï¼Œæ‰€ä»¥åœ¨çº¿ç¨‹æŒ‚èµ·åï¼Œæ‰‹åŠ¨æ·»åŠ ä¸­æ–­ï¼Œèƒ½å¤Ÿå°†æŒ‚èµ·çš„çº¿ç¨‹ä» wait â€”&gt; runningï¼Œç„¶åå¦‚æœæ­¤æ—¶æƒ³è¦è·å–çš„é”å¦‚æœä¸€ç›´è¢«å†™é”æŒæœ‰ï¼Œé‚£ä¹ˆè¯»é”å°±ä¼šä¸€ç›´è‡ªæ—‹ï¼Œä½¿å¾—CPU çˆ†ç‚¸â€¦ äºæ˜¯æˆ‘éå¸¸å¥½å¥‡çš„è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°å‡ºç°äº†ä¸€äº›é—®é¢˜ï¼Œå¦‚æœæˆ‘å°† StampedLock é€€åŒ–æˆ ReentrantReadWriteLockï¼Œå¹¶ä¸”æ‰‹åŠ¨è§¦å‘ä¸­æ–­å¹¶ä¸”ä¸å¤„ç†ä¸­æ–­ï¼Œçš„ç¡®ä¼šå¯¼è‡´ CPU å æ»¡ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package å¤šçº¿ç¨‹.è¡¥å……;import java.util.concurrent.TimeUnit;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.LockSupport;import java.util.concurrent.locks.StampedLock;public class StampedLockDemo &#123; static Thread[] holdCpuThreads = new Thread[3]; static final StampedLock lock = new StampedLock(); static Lock readLock = lock.asReadLock(); static Lock writeLock = lock.asWriteLock(); public static void main(String[] args) throws InterruptedException &#123; new Thread(() -&gt; &#123; writeLock.lock(); try &#123; TimeUnit.SECONDS.sleep(40); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; writeLock.unlock(); System.out.println("123"); &#125;).start(); Thread.sleep(2000); for (int i = 0; i &lt; 3; ++i) &#123; holdCpuThreads[i] = new Thread(new HoldCPUReadThread()); holdCpuThreads[i].start(); &#125; System.out.println("0------------"); Thread.sleep(10000); System.out.println("1------------"); for (int i = 0; i &lt; 3; i++) &#123; holdCpuThreads[i].interrupt(); &#125; &#125; private static class HoldCPUReadThread implements Runnable &#123; public void run() &#123; readLock.lock(); System.out.println(Thread.currentThread().getName() + " get read lock"); readLock.unlock(); System.out.println("--------------------------"); &#125; &#125;&#125; å¾ˆå®¹æ˜“çœ‹åˆ°ï¼Œåœ¨ä¸­æ–­ä¹‹å‰ï¼Œè¯»çº¿ç¨‹å…¨éƒ¨è¢«æŒ‚èµ·äº†ï¼Œæ‰€ä»¥å¹¶ä¸å ç”¨ cpu èµ„æºï¼Œä½†æ˜¯æ‰‹åŠ¨ä¸­æ–­åï¼Œpark()è¢«å”¤é†’ï¼Œç›´æ¥å¯¼è‡´è¯»çº¿ç¨‹ runningï¼Œä¸åœçš„è‡ªæ—‹è·å–é”ï¼Œä½†æ˜¯é”ä¸€ç›´è¢« write å æœ‰ï¼Œæ‰€ä»¥å°±æŠŠå•æ ¸ CPU å æ»¡ï¼Œæ‰€ä»¥æˆ‘è¿™ä¸ªåº”è¯¥æ˜¯4 æ ¸å¤„ç†å™¨ï¼Ÿè¯´å¥½çš„ 6 æ ¸å‘¢ï¼Ÿï¼Ÿ å¦‚æœä¸é€€åŒ–çš„è¯ï¼Œç»è¿‡æµ‹è¯•ï¼Œçš„ç¡®ä¹Ÿä¼šå‘ç”Ÿä¸€æ ·çš„æƒ…å†µã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package å¤šçº¿ç¨‹.è¡¥å……;import java.util.concurrent.TimeUnit;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.LockSupport;import java.util.concurrent.locks.StampedLock;public class StampedLockDemo &#123; static Thread[] holdCpuThreads = new Thread[3]; static final StampedLock lock = new StampedLock(); public static void main(String[] args) throws InterruptedException &#123; new Thread(() -&gt; &#123; long stamp1 = lock.writeLock(); try &#123; TimeUnit.SECONDS.sleep(40); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;// LockSupport.parkNanos(6100000000L); lock.unlockWrite(stamp1); System.out.println("123"); &#125;).start(); Thread.sleep(2000); for (int i = 0; i &lt; 3; ++i) &#123; holdCpuThreads[i] = new Thread(new HoldCPUReadThread()); holdCpuThreads[i].start(); &#125; System.out.println("0------------"); Thread.sleep(10000); System.out.println("1------------"); for (int i = 0; i &lt; 3; i++) &#123; holdCpuThreads[i].interrupt(); &#125; &#125; private static class HoldCPUReadThread implements Runnable &#123; public void run() &#123; long stamp2 = lock.readLock(); System.out.println(Thread.currentThread().getName() + " get read lock"); lock.unlockRead(stamp2); System.out.println("--------------------------"); &#125; &#125;&#125; ä¸­æ–­æ¥ä¹‹å‰çš„ CPUï¼š ä¸­æ–­æ¥äº†ä¹‹åï¼š ä½†æ˜¯ï¼Œä½†æ˜¯ï¼Œä½†æ˜¯ï¼ç½‘ä¸Šçš„ä¾‹å­å¤ªä¸é è°±äº†ï¼Œå¤§å®¶æ³¨æ„çœ‹ï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142package å¤šçº¿ç¨‹.è¡¥å……;import java.util.concurrent.TimeUnit;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.LockSupport;import java.util.concurrent.locks.StampedLock;public class StampedLockDemo &#123; static Thread[] holdCpuThreads = new Thread[3]; static final StampedLock lock = new StampedLock(); public static void main(String[] args) throws InterruptedException &#123; new Thread(() -&gt; &#123; long stamp1 = lock.writeLock(); // é—®é¢˜å‡ºåœ¨è¿™ LockSupport.parkNanos(6100000000L); lock.unlockWrite(stamp1); System.out.println("123"); &#125;).start(); Thread.sleep(2000); for (int i = 0; i &lt; 3; ++i) &#123; holdCpuThreads[i] = new Thread(new HoldCPUReadThread()); holdCpuThreads[i].start(); &#125; System.out.println("0------------"); Thread.sleep(10000); System.out.println("1------------"); for (int i = 0; i &lt; 3; i++) &#123; holdCpuThreads[i].interrupt(); &#125; &#125; private static class HoldCPUReadThread implements Runnable &#123; public void run() &#123; long stamp2 = lock.readLock(); System.out.println(Thread.currentThread().getName() + " get read lock"); lock.unlockRead(stamp2); System.out.println("--------------------------"); &#125; &#125;&#125; 1234567890------------123Thread-3 get read lockThread-2 get read lock----------------------------------------------------Thread-1 get read lock--------------------------1------------ CPU å…¨ç¨‹æ²¡æœ‰å˜åŒ–ï¼Œç»´æŒåœ¨ 2%ï¼Œè¯´æ˜æ²¡æœ‰å‘ç”Ÿè‡ªæ—‹ã€‚LockSupport.parkNanos(6100000000L);è¿™ä¸€è¡Œï¼Œæ„æ€æ˜¯è¯¥çº¿ç¨‹åªä¼šæŒ‚èµ· 6 ç§’ï¼Œç­‰ä½ 10ç§’åä¸­æ–­æ¥äº†çš„æ—¶å€™å†™é”æ—©å°±é‡Šæ”¾é”äº†ï¼Œæ­¤æ—¶è¢«å”¤é†’çš„è¯»é”è‡ªæ—‹èƒ½å¤Ÿç›´æ¥æ‹¿åˆ°é”ï¼Œä¸ä¼šæ­»å¾ªç¯ä¸€ç›´è‡ªæ—‹ï¼Œæ‰€ä»¥ CPU å‹æ ¹ä¸ä¼šå‘ç”Ÿå˜åŒ–â€¦çœ‹äº†ä¸‹ç½‘ä¸Šè¯´çš„ä¾‹å­ï¼ŒåŸºæœ¬ä¸Šå…¨æ˜¯é”™è¯¯çš„â€¦éš¾é“çœŸçš„å…¨éƒ¨éƒ½æ˜¯æŠ„æ¥æŠ„å»å˜›â€¦å¥½æ­¹éªŒè¯ä¸€ä¸‹å˜›â€¦ ConcurrentLinkedQueue Listå¯¹åº”çš„çº¿ç¨‹å®‰å…¨çš„æœ‰ CopyOnWriteArrayList Mapå¯¹åº”çš„çº¿ç¨‹å®‰å…¨çš„æœ‰ ConcurrentHashMap Queueå¯¹åº”çš„çº¿ç¨‹å®‰å…¨çš„åˆ™æ˜¯ ConcurrentLinkedQueue https://www.ibm.com/developerworks/cn/java/j-lo-concurrent/index.html ã€Œã€ https://blog.csdn.net/qq_38293564/article/details/80798310 éé˜»å¡ç®—æ³• ä¸€ä¸ªçº¿ç¨‹çš„å¤±è´¥å’ŒæŒ‚èµ·ä¸ä¼šå¼•èµ·å…¶ä»–äº›çº¿ç¨‹çš„å¤±è´¥å’ŒæŒ‚èµ·ï¼Œè¿™æ ·çš„ç®—æ³•ç§°ä¸ºéé˜»å¡ç®—æ³•ã€‚éé˜»å¡ç®—æ³•é€šè¿‡ä½¿ç”¨åº•å±‚æœºå™¨çº§åˆ«çš„åŸå­æŒ‡ä»¤æ¥å–ä»£é”ï¼Œä»è€Œä¿è¯æ•°æ®åœ¨å¹¶å‘è®¿é—®ä¸‹çš„ä¸€è‡´æ€§ã€‚ ConcurrentLinkedQueue çš„éé˜»å¡ç®—æ³•ç®€è¿°æœ¬æ–‡æ¥ä¸‹æ¥å°†åœ¨åˆ†æ ConcurrentLinkedQueue æºä»£ç å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œç©¿æ’è®²è§£éé˜»å¡ç®—æ³•çš„å…·ä½“å®ç°ã€‚ä¸ºäº†ä¾¿äºè¯»è€…ç†è§£æœ¬æ–‡ï¼Œé¦–å…ˆè®©æˆ‘ä»¬å¯¹å®ƒçš„å®ç°æœºåˆ¶åšä¸ªå…¨å±€æ€§çš„ç®€è¿°ã€‚ConcurrentLinkedQueue çš„éé˜»å¡ç®—æ³•å®ç°å¯æ¦‚æ‹¬ä¸ºä¸‹é¢ 5 ç‚¹ï¼š ä½¿ç”¨ CAS åŸå­æŒ‡ä»¤æ¥å¤„ç†å¯¹æ•°æ®çš„å¹¶å‘è®¿é—®ï¼Œè¿™æ˜¯éé˜»å¡ç®—æ³•å¾—ä»¥å®ç°çš„åŸºç¡€ã€‚ head/tail å¹¶éæ€»æ˜¯æŒ‡å‘é˜Ÿåˆ—çš„å¤´ / å°¾èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´å…è®¸é˜Ÿåˆ—å¤„äºä¸ä¸€è‡´çŠ¶æ€ã€‚ è¿™ä¸ªç‰¹æ€§æŠŠå…¥é˜Ÿ / å‡ºé˜Ÿæ—¶ï¼ŒåŸæœ¬éœ€è¦ä¸€èµ·åŸå­åŒ–æ‰§è¡Œçš„ä¸¤ä¸ªæ­¥éª¤åˆ†ç¦»å¼€æ¥ï¼Œä»è€Œç¼©å°äº†å…¥é˜Ÿ / å‡ºé˜Ÿæ—¶éœ€è¦åŸå­åŒ–æ›´æ–°å€¼çš„èŒƒå›´åˆ°å”¯ä¸€å˜é‡ã€‚è¿™æ˜¯éé˜»å¡ç®—æ³•å¾—ä»¥å®ç°çš„å…³é”®ã€‚ ç”±äºé˜Ÿåˆ—æœ‰æ—¶ä¼šå¤„äºä¸ä¸€è‡´çŠ¶æ€ã€‚ä¸ºæ­¤ï¼ŒConcurrentLinkedQueue ä½¿ç”¨ä¸‰ä¸ªä¸å˜å¼æ¥ç»´æŠ¤éé˜»å¡ç®—æ³•çš„æ­£ç¡®æ€§ã€‚ ä»¥æ‰¹å¤„ç†æ–¹å¼æ¥æ›´æ–° head/tailï¼Œä»æ•´ä½“ä¸Šå‡å°‘å…¥é˜Ÿ / å‡ºé˜Ÿæ“ä½œçš„å¼€é”€ã€‚ ä¸ºäº†æœ‰åˆ©äºåƒåœ¾æ”¶é›†ï¼Œé˜Ÿåˆ—ä½¿ç”¨ç‰¹æœ‰çš„ head æ›´æ–°æœºåˆ¶ï¼›ä¸ºäº†ç¡®ä¿ä»å·²åˆ é™¤èŠ‚ç‚¹å‘åéå†ï¼Œå¯åˆ°è¾¾æ‰€æœ‰çš„éåˆ é™¤èŠ‚ç‚¹ï¼Œé˜Ÿåˆ—ä½¿ç”¨äº†ç‰¹æœ‰çš„å‘åæ¨è¿›ç­–ç•¥ã€‚ ConcurrentLinkedQueue æœ‰æœºæ•´åˆäº†ä¸Šè¿° 5 ç‚¹æ¥å®ç°éé˜»å¡ç®—æ³•ã€‚ ä¸å˜å¼åœ¨åé¢çš„æºä»£ç åˆ†æä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°é˜Ÿåˆ—æœ‰æ—¶ä¼šå¤„äºä¸ä¸€è‡´çŠ¶æ€ã€‚ä¸ºæ­¤ï¼ŒConcurrentLinkedQueue ä½¿ç”¨ä¸‰ä¸ªä¸å˜å¼ ( åŸºæœ¬ä¸å˜å¼ï¼Œhead çš„ä¸å˜å¼å’Œ tail çš„ä¸å˜å¼ )ï¼Œæ¥çº¦æŸé˜Ÿåˆ—ä¸­æ–¹æ³•çš„æ‰§è¡Œã€‚é€šè¿‡è¿™ä¸‰ä¸ªä¸å˜å¼æ¥ç»´æŠ¤éé˜»å¡ç®—æ³•çš„æ­£ç¡®æ€§ã€‚ ä¸å˜å¼ï¼šå¹¶å‘å¯¹è±¡éœ€è¦ä¸€ç›´ä¿æŒçš„ç‰¹æ€§ã€‚ä¸å˜å¼æ˜¯å¹¶å‘å¯¹è±¡çš„å„ä¸ªæ–¹æ³•ä¹‹é—´å¿…é¡»éµå®ˆçš„â€œå¥‘çº¦â€ï¼Œæ¯ä¸ªæ–¹æ³•åœ¨è°ƒç”¨å‰å’Œè°ƒç”¨åéƒ½å¿…é¡»ä¿æŒä¸å˜å¼ã€‚é‡‡ç”¨ä¸å˜å¼ï¼Œå°±å¯ä»¥éš”ç¦»çš„åˆ†ææ¯ä¸ªæ–¹æ³•ï¼Œè€Œä¸ç”¨è€ƒè™‘å®ƒä»¬ä¹‹é—´æ‰€æœ‰å¯èƒ½çš„äº¤äº’ã€‚ åŸºæœ¬ä¸å˜å¼åœ¨æ‰§è¡Œæ–¹æ³•ä¹‹å‰å’Œä¹‹åï¼Œé˜Ÿåˆ—å¿…é¡»è¦ä¿æŒçš„ä¸å˜å¼ï¼š å½“å…¥é˜Ÿæ’å…¥æ–°èŠ‚ç‚¹ä¹‹åï¼Œé˜Ÿåˆ—ä¸­æœ‰ä¸€ä¸ª next åŸŸä¸º null çš„ï¼ˆæœ€åï¼‰èŠ‚ç‚¹ã€‚ ä» head å¼€å§‹éå†é˜Ÿåˆ—ï¼Œå¯ä»¥è®¿é—®æ‰€æœ‰ item åŸŸä¸ä¸º null çš„èŠ‚ç‚¹ã€‚ head çš„ä¸å˜å¼å’Œå¯å˜å¼åœ¨æ‰§è¡Œæ–¹æ³•ä¹‹å‰å’Œä¹‹åï¼Œhead å¿…é¡»ä¿æŒçš„ä¸å˜å¼ï¼š æ‰€æœ‰â€œæ´»ç€â€çš„èŠ‚ç‚¹ï¼ˆæŒ‡æœªåˆ é™¤èŠ‚ç‚¹ï¼‰ï¼Œéƒ½èƒ½ä» head é€šè¿‡è°ƒç”¨ succ() æ–¹æ³•éå†å¯è¾¾ã€‚ head ä¸èƒ½ä¸º nullã€‚ head èŠ‚ç‚¹çš„ next åŸŸä¸èƒ½å¼•ç”¨åˆ°è‡ªèº«ã€‚ åœ¨æ‰§è¡Œæ–¹æ³•ä¹‹å‰å’Œä¹‹åï¼Œhead çš„å¯å˜å¼ï¼š head èŠ‚ç‚¹çš„ item åŸŸå¯èƒ½ä¸º nullï¼Œä¹Ÿå¯èƒ½ä¸ä¸º nullã€‚ å…è®¸ tail æ»åï¼ˆlag behindï¼‰äº headï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šä» head å¼€å§‹éå†é˜Ÿåˆ—ï¼Œä¸ä¸€å®šèƒ½åˆ°è¾¾ tailã€‚ tail çš„ä¸å˜å¼å’Œå¯å˜å¼åœ¨æ‰§è¡Œæ–¹æ³•ä¹‹å‰å’Œä¹‹åï¼Œtail å¿…é¡»ä¿æŒçš„ä¸å˜å¼ï¼š é€šè¿‡ tail è°ƒç”¨ succ() æ–¹æ³•ï¼Œæœ€åèŠ‚ç‚¹æ€»æ˜¯å¯è¾¾çš„ã€‚ tail ä¸èƒ½ä¸º nullã€‚ åœ¨æ‰§è¡Œæ–¹æ³•ä¹‹å‰å’Œä¹‹åï¼Œtail çš„å¯å˜å¼ï¼š tail èŠ‚ç‚¹çš„ item åŸŸå¯èƒ½ä¸º nullï¼Œä¹Ÿå¯èƒ½ä¸ä¸º nullã€‚ å…è®¸ tail æ»åäº headï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šä» head å¼€å§‹éå†é˜Ÿåˆ—ï¼Œä¸ä¸€å®šèƒ½åˆ°è¾¾ tailã€‚ tail èŠ‚ç‚¹çš„ next åŸŸå¯ä»¥å¼•ç”¨åˆ°è‡ªèº«ã€‚ è¡¥å……Q1ï¼šhead/tail å¹¶éæ€»æ˜¯æŒ‡å‘é˜Ÿåˆ—çš„å¤´ / å°¾èŠ‚ç‚¹ï¼Œå…·ä½“æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ A1ï¼š ä¸æ˜¯æ¯æ¬¡å‡ºé˜Ÿæ—¶éƒ½æ›´æ–°headèŠ‚ç‚¹ï¼Œå½“headèŠ‚ç‚¹é‡Œæœ‰å…ƒç´ æ—¶ï¼Œç›´æ¥å¼¹å‡ºheadèŠ‚ç‚¹é‡Œçš„å…ƒç´ ï¼Œè€Œä¸ä¼šæ›´æ–°headèŠ‚ç‚¹ã€‚åªæœ‰å½“headèŠ‚ç‚¹é‡Œæ²¡æœ‰å…ƒç´ æ—¶ï¼Œå‡ºé˜Ÿæ“ä½œæ‰ä¼šæ›´æ–°headèŠ‚ç‚¹ã€‚é‡‡ç”¨è¿™ç§æ–¹å¼ä¹Ÿæ˜¯ä¸ºäº†å‡å°‘ä½¿ç”¨CASæ›´æ–°headèŠ‚ç‚¹çš„æ¶ˆè€—ï¼Œä»è€Œæé«˜å‡ºé˜Ÿæ•ˆç‡ã€‚æ‰€ä»¥headå…ƒç´ å¯èƒ½æ˜¯ nullï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯é˜Ÿåˆ—çš„å¤´ç»“ç‚¹ã€‚ tailèŠ‚ç‚¹å¹¶ä¸æ€»æ˜¯å°¾èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ¯æ¬¡å…¥é˜Ÿéƒ½å¿…é¡»å…ˆé€šè¿‡tailèŠ‚ç‚¹æ¥æ‰¾åˆ°å°¾èŠ‚ç‚¹ï¼Œå°¾èŠ‚ç‚¹å¯èƒ½å°±æ˜¯tailèŠ‚ç‚¹ï¼Œä¹Ÿå¯èƒ½æ˜¯tailèŠ‚ç‚¹çš„nextèŠ‚ç‚¹ã€‚doug leaä½¿ç”¨hopså˜é‡æ¥æ§åˆ¶å¹¶å‡å°‘tailèŠ‚ç‚¹çš„æ›´æ–°é¢‘ç‡ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡èŠ‚ç‚¹å…¥é˜Ÿåéƒ½å°† tailèŠ‚ç‚¹æ›´æ–°æˆå°¾èŠ‚ç‚¹ï¼Œè€Œæ˜¯å½“tailèŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹çš„è·ç¦»å¤§äºç­‰äºå¸¸é‡HOPSçš„å€¼ï¼ˆé»˜è®¤ç­‰äº1ï¼‰æ—¶æ‰æ›´æ–°tailèŠ‚ç‚¹ï¼Œtailå’Œå°¾èŠ‚ç‚¹çš„è·ç¦»è¶Šé•¿ä½¿ç”¨CASæ›´æ–°tailèŠ‚ç‚¹çš„æ¬¡æ•°å°±ä¼šè¶Šå°‘ï¼Œä½†æ˜¯è·ç¦»è¶Šé•¿å¸¦æ¥çš„è´Ÿé¢æ•ˆæœå°±æ˜¯æ¯æ¬¡å…¥é˜Ÿæ—¶å®šä½å°¾èŠ‚ç‚¹çš„æ—¶é—´å°±è¶Šé•¿ï¼Œå› ä¸ºå¾ªç¯ä½“éœ€è¦å¤šå¾ªç¯ä¸€æ¬¡æ¥å®šä½å‡ºå°¾èŠ‚ç‚¹ï¼Œä½†æ˜¯è¿™æ ·ä»ç„¶èƒ½æé«˜å…¥é˜Ÿçš„æ•ˆç‡ï¼Œå› ä¸ºä»æœ¬è´¨ä¸Šæ¥çœ‹å®ƒé€šè¿‡å¢åŠ å¯¹volatileå˜é‡çš„è¯»æ“ä½œæ¥å‡å°‘äº†å¯¹volatileå˜é‡çš„å†™æ“ä½œï¼Œè€Œå¯¹volatileå˜é‡çš„å†™æ“ä½œå¼€é”€è¦è¿œè¿œå¤§äºè¯»æ“ä½œï¼Œæ‰€ä»¥å…¥é˜Ÿæ•ˆç‡ä¼šæœ‰æ‰€æå‡ã€‚ æ‰€æœ‰çš„ BlockingQueueè®²å®Œäº†éé˜»å¡ç®—æ³•ï¼Œæ¥è®²è®²é˜»å¡é˜Ÿåˆ—æ¢æ¢å£å‘³ã€‚ é˜»å¡é˜Ÿåˆ—ä¸æ™®é€šé˜Ÿåˆ—çš„åŒºåˆ«åœ¨äºï¼Œå½“é˜Ÿåˆ—æ˜¯ç©ºçš„æ—¶ï¼Œä»é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„æ“ä½œå°†ä¼šè¢«é˜»å¡ï¼Œæˆ–è€…é˜Ÿåˆ—æ˜¯æ»¡æ—¶ï¼Œå¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„æ“ä½œä¼šè¢«é˜»å¡ã€‚è¯•å›¾ä»ç©ºçš„é˜»å¡é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å…¶ä»–çš„çº¿ç¨‹å¾€ç©ºçš„é˜Ÿåˆ—æ’å…¥æ–°çš„å…ƒç´ ã€‚åŒæ ·ï¼Œè¯•å›¾å¾€å·²æ»¡çš„é˜»å¡é˜Ÿåˆ—ä¸­æ·»åŠ æ–°å…ƒç´ çš„çº¿ç¨‹åŒæ ·ä¹Ÿä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å…¶ä»–çš„çº¿ç¨‹ä½¿é˜Ÿåˆ—é‡æ–°å˜å¾—ç©ºé—²èµ·æ¥ï¼Œå¦‚ä»é˜Ÿåˆ—ä¸­ç§»é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ï¼Œæˆ–è€…å®Œå…¨æ¸…ç©ºé˜Ÿåˆ—. å®ç° BlockingQueue æ¥å£çš„æœ‰ ArrayBlockingQueue DelayQueue LinkedBlockingDeque LinkedBlockingQueue LinkedTransferQueue PriorityBlockingQueue SynchronousQueue ArrayBlockingQueueArrayBlockingQueueæ˜¯ç”±æ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚è¯¥é˜Ÿåˆ—å‘½ä»¤å…ƒç´  FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ã€‚å› æ­¤ï¼Œå¯¹å¤´å…ƒç´ æ—¶é˜Ÿåˆ—ä¸­å­˜åœ¨æ—¶é—´æœ€é•¿çš„æ•°æ®å…ƒç´ ï¼Œè€Œå¯¹å°¾æ•°æ®åˆ™æ˜¯å½“å‰é˜Ÿåˆ—æœ€æ–°çš„æ•°æ®å…ƒç´ ã€‚ArrayBlockingQueue å¯ä½œä¸ºâ€œæœ‰ç•Œæ•°æ®ç¼“å†²åŒºâ€ï¼Œç”Ÿäº§è€…æ’å…¥æ•°æ®åˆ°é˜Ÿåˆ—å®¹å™¨ä¸­ï¼Œå¹¶ç”±æ¶ˆè´¹è€…æå–ã€‚ArrayBlockingQueue ä¸€æ—¦åˆ›å»ºï¼Œå®¹é‡ä¸èƒ½æ”¹å˜ã€‚ å½“é˜Ÿåˆ—å®¹é‡æ»¡æ—¶ï¼Œå°è¯•å°†å…ƒç´ æ”¾å…¥é˜Ÿåˆ—å°†å¯¼è‡´æ“ä½œé˜»å¡;å°è¯•ä»ä¸€ä¸ªç©ºé˜Ÿåˆ—ä¸­å–ä¸€ä¸ªå…ƒç´ ä¹Ÿä¼šåŒæ ·é˜»å¡ã€‚ ArrayBlockingQueue é»˜è®¤æƒ…å†µä¸‹ä¸èƒ½ä¿è¯çº¿ç¨‹è®¿é—®é˜Ÿåˆ—çš„å…¬å¹³æ€§ï¼Œæ‰€è°“å…¬å¹³æ€§æ˜¯æŒ‡ä¸¥æ ¼æŒ‰ç…§çº¿ç¨‹ç­‰å¾…çš„ç»å¯¹æ—¶é—´é¡ºåºï¼Œå³æœ€å…ˆç­‰å¾…çš„çº¿ç¨‹èƒ½å¤Ÿæœ€å…ˆè®¿é—®åˆ° ArrayBlockingQueueã€‚è€Œéå…¬å¹³æ€§åˆ™æ˜¯æŒ‡è®¿é—® ArrayBlockingQueue çš„é¡ºåºä¸æ˜¯éµå®ˆä¸¥æ ¼çš„æ—¶é—´é¡ºåºï¼Œæœ‰å¯èƒ½å­˜åœ¨ï¼Œä¸€æ—¦ ArrayBlockingQueue å¯ä»¥è¢«è®¿é—®æ—¶ï¼Œé•¿æ—¶é—´é˜»å¡çš„çº¿ç¨‹ä¾ç„¶æ— æ³•è®¿é—®åˆ° ArrayBlockingQueueã€‚å¦‚æœä¿è¯å…¬å¹³æ€§ï¼Œé€šå¸¸ä¼šé™ä½ååé‡ã€‚ DelayQueueDelayQueue æ˜¯ä¸€ä¸ªå­˜æ”¾å®ç° Delayed æ¥å£çš„æ•°æ®çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œåªæœ‰å½“æ•°æ®å¯¹è±¡çš„å»¶æ—¶æ—¶é—´è¾¾åˆ°æ—¶æ‰èƒ½æ’å…¥åˆ°é˜Ÿåˆ—è¿›è¡Œå­˜å‚¨ã€‚å¦‚æœå½“å‰æ‰€æœ‰çš„æ•°æ®éƒ½è¿˜æ²¡æœ‰è¾¾åˆ°åˆ›å»ºæ—¶æ‰€æŒ‡å®šçš„å»¶æ—¶æœŸï¼Œåˆ™é˜Ÿåˆ—æ²¡æœ‰é˜Ÿå¤´ï¼Œå¹¶ä¸”çº¿ç¨‹é€šè¿‡ poll ç­‰æ–¹æ³•è·å–æ•°æ®å…ƒç´ åˆ™è¿”å› nullã€‚æ‰€è°“æ•°æ®å»¶æ—¶æœŸæ»¡æ—¶ï¼Œåˆ™æ˜¯é€šè¿‡ Delayed æ¥å£çš„getDelay(TimeUnit.NANOSECONDS)æ¥è¿›è¡Œåˆ¤å®šï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›çš„æ˜¯å°äºç­‰äº 0 åˆ™è¯´æ˜è¯¥æ•°æ®å…ƒç´ çš„å»¶æ—¶æœŸå·²æ»¡ã€‚ LinkedBlockingDequeLinkedBlockingDeque æ˜¯åŸºäºé“¾è¡¨æ•°æ®ç»“æ„çš„æœ‰ç•Œé˜»å¡åŒç«¯é˜Ÿåˆ—ï¼Œå¦‚æœåœ¨åˆ›å»ºå¯¹è±¡æ—¶ä¸ºæŒ‡å®šå¤§å°æ—¶ï¼Œå…¶é»˜è®¤å¤§å°ä¸º Integer.MAX_VALUEã€‚ä¸ LinkedBlockingQueue ç›¸æ¯”ï¼Œä¸»è¦çš„ä¸åŒç‚¹åœ¨äºï¼ŒLinkedBlockingDeque å…·æœ‰åŒç«¯é˜Ÿåˆ—çš„ç‰¹æ€§ã€‚ LinkedBlockingQueueæ˜¯ç”¨é“¾è¡¨å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒåŒæ ·æ»¡è¶³ FIFO çš„ç‰¹æ€§ï¼Œä¸ ArrayBlockingQueue ç›¸æ¯”èµ·æ¥å…·æœ‰æ›´é«˜çš„ååé‡ï¼Œä¸ºäº†é˜²æ­¢ LinkedBlockingQueue å®¹é‡è¿…é€Ÿå¢ï¼ŒæŸè€—å¤§é‡å†…å­˜ã€‚é€šå¸¸åœ¨åˆ›å»º LinkedBlockingQueue å¯¹è±¡æ—¶ï¼Œä¼šæŒ‡å®šå…¶å¤§å°ï¼Œå¦‚æœæœªæŒ‡å®šï¼Œå®¹é‡ç­‰äº Integer.MAX_VALUEã€‚åœ¨ä¸Šæ–‡å¤šçº¿ç¨‹ï¼ˆä¸ƒï¼‰ä¸­æˆ‘ä»¬ä½¿ç”¨äº†è¯¥é˜Ÿåˆ—çš„æ€æƒ³å®Œæˆäº†ç”Ÿäº§è€…-æ¶ˆè´¹è€…åˆ†ç¦»ä¸¤æŠŠé”ï¼Œåˆ†åˆ«è¿›è¡Œé€šä¿¡ã€‚ è·Ÿ ArrayBlockingQueue ä¸€æ ·æä¾›äº† put() å’Œ take() æ–¹æ³•å¯ä»¥è¿›è¡Œé˜»å¡æ’å…¥å’Œç§»é™¤ã€‚ ArrayBlockingQueue ä¸ LinkedBlockingQueue çš„æ¯”è¾ƒ ç›¸åŒç‚¹ï¼šArrayBlockingQueue å’Œ LinkedBlockingQueue éƒ½æ˜¯é€šè¿‡ condition é€šçŸ¥æœºåˆ¶æ¥å®ç°å¯é˜»å¡å¼æ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼Œå¹¶æ»¡è¶³çº¿ç¨‹å®‰å…¨çš„ç‰¹æ€§ï¼› ä¸åŒç‚¹ï¼š ArrayBlockingQueue åº•å±‚æ˜¯é‡‡ç”¨çš„æ•°ç»„è¿›è¡Œå®ç°ï¼Œè€Œ LinkedBlockingQueue åˆ™æ˜¯é‡‡ç”¨é“¾è¡¨æ•°æ®ç»“æ„ï¼› ArrayBlockingQueue æ’å…¥å’Œåˆ é™¤æ•°æ®ï¼Œåªé‡‡ç”¨äº†ä¸€ä¸ª lockï¼Œè€Œ LinkedBlockingQueue åˆ™æ˜¯åœ¨æ’å…¥å’Œåˆ é™¤åˆ†åˆ«é‡‡ç”¨äº†putLockå’ŒtakeLockï¼Œè¿™æ ·å¯ä»¥é™ä½çº¿ç¨‹ç”±äºçº¿ç¨‹æ— æ³•è·å–åˆ° lock è€Œè¿›å…¥ WAITING çŠ¶æ€çš„å¯èƒ½æ€§ï¼Œä»è€Œæé«˜äº†çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æ•ˆç‡ã€‚ LinkedTransferQueueLinkedTransferQueue æ˜¯ä¸€ä¸ªç”±é“¾è¡¨æ•°æ®ç»“æ„æ„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œç”±äºè¯¥é˜Ÿåˆ—å®ç°äº† TransferQueue æ¥å£ï¼Œä¸å…¶ä»–é˜»å¡é˜Ÿåˆ—ç›¸æ¯”ä¸»è¦æœ‰ä»¥ä¸‹ä¸åŒçš„æ–¹æ³•ï¼š transfer(E e) å¦‚æœå½“å‰æœ‰çº¿ç¨‹ï¼ˆæ¶ˆè´¹è€…ï¼‰æ­£åœ¨è°ƒç”¨ take()æ–¹æ³•æˆ–è€…å¯å»¶æ—¶çš„ poll()æ–¹æ³•è¿›è¡Œæ¶ˆè´¹æ•°æ®æ—¶ï¼Œç”Ÿäº§è€…çº¿ç¨‹å¯ä»¥è°ƒç”¨ transfer æ–¹æ³•å°†æ•°æ®ä¼ é€’ç»™æ¶ˆè´¹è€…çº¿ç¨‹ã€‚å¦‚æœå½“å‰æ²¡æœ‰æ¶ˆè´¹è€…çº¿ç¨‹çš„è¯ï¼Œç”Ÿäº§è€…çº¿ç¨‹å°±ä¼šå°†æ•°æ®æ’å…¥åˆ°é˜Ÿå°¾ï¼Œç›´åˆ°æœ‰æ¶ˆè´¹è€…èƒ½å¤Ÿè¿›è¡Œæ¶ˆè´¹æ‰èƒ½é€€å‡ºã€‚ tryTransfer(E e) tryTransfer æ–¹æ³•å¦‚æœå½“å‰æœ‰æ¶ˆè´¹è€…çº¿ç¨‹ï¼ˆè°ƒç”¨ take æ–¹æ³•æˆ–è€…å…·æœ‰è¶…æ—¶ç‰¹æ€§çš„ poll æ–¹æ³•ï¼‰æ­£åœ¨æ¶ˆè´¹æ•°æ®çš„è¯ï¼Œè¯¥æ–¹æ³•å¯ä»¥å°†æ•°æ®ç«‹å³ä¼ é€ç»™æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œå¦‚æœå½“å‰æ²¡æœ‰æ¶ˆè´¹è€…çº¿ç¨‹æ¶ˆè´¹æ•°æ®çš„è¯ï¼Œå°±ç«‹å³è¿”å›falseã€‚å› æ­¤ï¼Œä¸ transfer æ–¹æ³•ç›¸æ¯”ï¼Œtransfer æ–¹æ³•æ˜¯å¿…é¡»ç­‰åˆ°æœ‰æ¶ˆè´¹è€…çº¿ç¨‹æ¶ˆè´¹æ•°æ®æ—¶ï¼Œç”Ÿäº§è€…çº¿ç¨‹æ‰èƒ½å¤Ÿè¿”å›ã€‚è€Œ tryTransfer æ–¹æ³•èƒ½å¤Ÿç«‹å³è¿”å›ç»“æœé€€å‡ºã€‚ tryTransfer(E e,long timeout,imeUnit unit) ä¸ transfer åŸºæœ¬åŠŸèƒ½ä¸€æ ·ï¼Œåªæ˜¯å¢åŠ äº†è¶…æ—¶ç‰¹æ€§ï¼Œå¦‚æœæ•°æ®æ‰è§„å®šçš„è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹çš„è¯ï¼Œå°±è¿”å›falseã€‚ PriorityBlockingQueuePriorityBlockingQueue æ˜¯ä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚é»˜è®¤æƒ…å†µä¸‹å…ƒç´ é‡‡ç”¨è‡ªç„¶é¡ºåºè¿›è¡Œæ’åºï¼Œä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ç±»å®ç° compareTo()æ–¹æ³•æ¥æŒ‡å®šå…ƒç´ æ’åºè§„åˆ™ï¼Œæˆ–è€…åˆå§‹åŒ–æ—¶é€šè¿‡æ„é€ å™¨å‚æ•° Comparator æ¥æŒ‡å®šæ’åºè§„åˆ™ã€‚ SynchronousQueueSynchronousQueue æ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œç›¸åº”çš„åˆ é™¤æ“ä½œï¼Œå› æ­¤ï¼ŒSynchronousQueue å®é™…ä¸Šæ²¡æœ‰å­˜å‚¨ä»»ä½•æ•°æ®å…ƒç´ ï¼Œå› ä¸ºåªæœ‰çº¿ç¨‹åœ¨åˆ é™¤æ•°æ®æ—¶ï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½æ’å…¥æ•°æ®ï¼ŒåŒæ ·çš„ï¼Œå¦‚æœå½“å‰æœ‰çº¿ç¨‹åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œçº¿ç¨‹æ‰èƒ½åˆ é™¤æ•°æ®ã€‚SynchronousQueue ä¹Ÿå¯ä»¥é€šè¿‡æ„é€ å™¨å‚æ•°æ¥ä¸ºå…¶æŒ‡å®šå…¬å¹³æ€§ã€‚ä¸¤ä¸ªçº¿ç¨‹åªæœ‰äº’ç›¸ç­‰åˆ°äº†æ‰èƒ½å·¥ä½œï¼Œæœ‰ç‚¹ç±»ä¼¼äº Exchanger()ã€‚ Q: https://www.ibm.com/developerworks/cn/java/j-lo-concurrent/index.html åŸºäºéé˜»å¡ç®—æ³•å®ç°çš„å¹¶å‘å®¹å™¨åŒ…æ‹¬ï¼šConcurrentLinkedQueueï¼ŒSynchronousQueueï¼ŒExchanger å’Œ ConcurrentSkipListMapã€‚ConcurrentLinkedQueue æ˜¯ä¸€ä¸ªåŸºäºé“¾æ¥èŠ‚ç‚¹çš„æ— ç•Œçº¿ç¨‹å®‰å…¨é˜Ÿåˆ—ã€‚SynchronousQueue æ˜¯ä¸€ä¸ªæ²¡æœ‰å®¹é‡çš„é˜»å¡é˜Ÿåˆ—ï¼Œå®ƒä½¿ç”¨åŒé‡æ•°æ®ç»“æ„ æ¥å®ç°éé˜»å¡ç®—æ³•ã€‚Exchanger æ˜¯ä¸€ä¸ªèƒ½å¯¹å…ƒç´ è¿›è¡Œé…å¯¹å’Œäº¤æ¢çš„äº¤æ¢å™¨ã€‚å®ƒä½¿ç”¨ æ¶ˆé™¤ æŠ€æœ¯æ¥å®ç°éé˜»å¡ç®—æ³• ã€‚ConcurrentSkipListMap æ˜¯ä¸€ä¸ªå¯ä»¥æ ¹æ® Key è¿›è¡Œæ’åºçš„å¯ä¼¸ç¼©çš„å¹¶å‘ Mapã€‚ è¿™å—æˆ‘è¿˜æœ‰ç‚¹ç–‘é—®â€¦ é˜»å¡é˜Ÿåˆ—æ˜¯ç”¨çš„éé˜»å¡ç®—æ³•å®ç°ï¼Ÿå¯èƒ½è¿™ä¸¤ä¸ªé˜»å¡çš„æ„æ€ä¸ä¸€æ ·ï¼Œå‰è€…æ˜¯æŒ‡é˜Ÿåˆ—æ»¡æˆ–è€…ç©ºé˜»å¡çš„é˜Ÿåˆ—ç§°ä¸ºé˜»å¡é˜Ÿåˆ—ï¼Œåè€…éé˜»å¡ç®—æ³•æŒ‡çš„æ˜¯ ä¸€ä¸ªçº¿ç¨‹çš„æŒ‚èµ·å’Œå¤±è´¥ä¸ä¼šå½±å“å¦ä¸€ä¸ªçº¿ç¨‹çš„æŒ‚èµ·å’Œå¤±è´¥ã€‚ï¼ˆä¹Ÿå°±æ˜¯åŸºäºCASå®ç°çš„é˜»å¡é˜Ÿåˆ—â€¦.ï¼‰ ä¹Ÿä¸çŸ¥é“ç†è§£çš„å¯¹ä¸å¯¹â€¦â€¦. Atomic åŸå­ç±»å…¨éƒ¨æ˜¯ CAS æ“ä½œçš„ï¼Œå…·æœ‰åŸå­æ€§ã€‚ é¢è¯•ä¸­å¥½åƒæ²¡è§åˆ°è¿‡â€¦ç•¥è¿‡â€¦ Fork-Join è½¬è‡ªï¼š https://www.liaoxuefeng.com/article/1146802219354112 å½“æˆ‘ä»¬éœ€è¦æ‰§è¡Œå¤§é‡çš„å°ä»»åŠ¡æ—¶ï¼Œæœ‰ç»éªŒçš„Javaå¼€å‘äººå‘˜éƒ½ä¼šé‡‡ç”¨çº¿ç¨‹æ± æ¥é«˜æ•ˆæ‰§è¡Œè¿™äº›å°ä»»åŠ¡ã€‚ç„¶è€Œï¼Œæœ‰ä¸€ç§ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼Œå¯¹è¶…è¿‡1000ä¸‡ä¸ªå…ƒç´ çš„æ•°ç»„è¿›è¡Œæ’åºï¼Œè¿™ç§ä»»åŠ¡æœ¬èº«å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œä½†å¦‚ä½•æ‹†è§£æˆå°ä»»åŠ¡éœ€è¦åœ¨ä»»åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­åŠ¨æ€æ‹†åˆ†ã€‚è¿™æ ·ï¼Œå¤§ä»»åŠ¡å¯ä»¥æ‹†æˆå°ä»»åŠ¡ï¼Œå°ä»»åŠ¡è¿˜å¯ä»¥ç»§ç»­æ‹†æˆæ›´å°çš„ä»»åŠ¡ï¼Œæœ€åæŠŠä»»åŠ¡çš„ç»“æœæ±‡æ€»åˆå¹¶ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœï¼Œè¿™ç§æ¨¡å‹å°±æ˜¯Fork/Joinæ¨¡å‹ã€‚ Java7å¼•å…¥äº†Fork/Joinæ¡†æ¶ï¼Œæˆ‘ä»¬é€šè¿‡RecursiveTaskè¿™ä¸ªç±»å°±å¯ä»¥æ–¹ä¾¿åœ°å®ç°Fork/Joinæ¨¡å¼ã€‚ ä¾‹å¦‚ï¼Œå¯¹ä¸€ä¸ªå¤§æ•°ç»„è¿›è¡Œå¹¶è¡Œæ±‚å’Œçš„RecursiveTaskï¼Œå°±å¯ä»¥è¿™æ ·ç¼–å†™ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041class SumTask extends RecursiveTask&lt;Long&gt; &#123; static final int THRESHOLD = 100; long[] array; int start; int end; SumTask(long[] array, int start, int end) &#123; this.array = array; this.start = start; this.end = end; &#125; @Override protected Long compute() &#123; if (end - start &lt;= THRESHOLD) &#123; // å¦‚æœä»»åŠ¡è¶³å¤Ÿå°,ç›´æ¥è®¡ç®—: long sum = 0; for (int i = start; i &lt; end; i++) &#123; sum += array[i]; &#125; try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; &#125; System.out.println(String.format("compute %d~%d = %d", start, end, sum)); return sum; &#125; // ä»»åŠ¡å¤ªå¤§,ä¸€åˆ†ä¸ºäºŒ: int middle = (end + start) / 2; System.out.println(String.format("split %d~%d ==&gt; %d~%d, %d~%d", start, end, start, middle, middle, end)); SumTask subtask1 = new SumTask(this.array, start, middle); SumTask subtask2 = new SumTask(this.array, middle, end); invokeAll(subtask1, subtask2); Long subresult1 = subtask1.join(); Long subresult2 = subtask2.join(); Long result = subresult1 + subresult2; System.out.println("result = " + subresult1 + " + " + subresult2 + " ==&gt; " + result); return result; &#125;&#125; ç¼–å†™è¿™ä¸ªFork/Joinä»»åŠ¡çš„å…³é”®åœ¨äºï¼Œåœ¨æ‰§è¡Œä»»åŠ¡çš„compute()æ–¹æ³•å†…éƒ¨ï¼Œå…ˆåˆ¤æ–­ä»»åŠ¡æ˜¯ä¸æ˜¯è¶³å¤Ÿå°ï¼Œå¦‚æœè¶³å¤Ÿå°ï¼Œå°±ç›´æ¥è®¡ç®—å¹¶è¿”å›ç»“æœï¼ˆæ³¨æ„æ¨¡æ‹Ÿäº†1ç§’å»¶æ—¶ï¼‰ï¼Œå¦åˆ™ï¼ŒæŠŠè‡ªèº«ä»»åŠ¡ä¸€æ‹†ä¸ºäºŒï¼Œåˆ†åˆ«è®¡ç®—ä¸¤ä¸ªå­ä»»åŠ¡ï¼Œå†è¿”å›ä¸¤ä¸ªå­ä»»åŠ¡çš„ç»“æœä¹‹å’Œã€‚ æœ€åå†™ä¸€ä¸ªmain()æ–¹æ³•æµ‹è¯•ï¼š 123456789101112public static void main(String[] args) throws Exception &#123; // åˆ›å»ºéšæœºæ•°ç»„æˆçš„æ•°ç»„: long[] array = new long[400]; fillRandom(array); // fork/join task: ForkJoinPool fjp = new ForkJoinPool(4); // æœ€å¤§å¹¶å‘æ•°4 ForkJoinTask&lt;Long&gt; task = new SumTask(array, 0, array.length); long startTime = System.currentTimeMillis(); Long result = fjp.invoke(task); long endTime = System.currentTimeMillis(); System.out.println("Fork/join sum: " + result + " in " + (endTime - startTime) + " ms.");&#125; å…³é”®ä»£ç æ˜¯fjp.invoke(task)æ¥æäº¤ä¸€ä¸ªFork/Joinä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼Œç„¶åè·å¾—å¼‚æ­¥æ‰§è¡Œçš„ç»“æœã€‚ æˆ‘ä»¬è®¾ç½®ä»»åŠ¡çš„æœ€å°é˜€å€¼æ˜¯100ï¼Œå½“æäº¤ä¸€ä¸ª400å¤§å°çš„ä»»åŠ¡æ—¶ï¼Œåœ¨4æ ¸CPUä¸Šæ‰§è¡Œï¼Œä¼šä¸€åˆ†ä¸ºäºŒï¼Œå†äºŒåˆ†ä¸ºå››ï¼Œæ¯ä¸ªæœ€å°å­ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æ˜¯1ç§’ï¼Œç”±äºæ˜¯å¹¶å‘4ä¸ªå­ä»»åŠ¡æ‰§è¡Œï¼Œæ•´ä¸ªä»»åŠ¡æœ€ç»ˆæ‰§è¡Œæ—¶é—´å¤§çº¦ä¸º1ç§’ã€‚ æ–°æ‰‹åœ¨ç¼–å†™Fork/Joinä»»åŠ¡æ—¶ï¼Œå¾€å¾€ç”¨æœç´¢å¼•æ“æœåˆ°ä¸€ä¸ªä¾‹å­ï¼Œç„¶åå°±ç…§ç€ä¾‹å­å†™å‡ºäº†ä¸‹é¢çš„ä»£ç ï¼š 123456789101112131415protected Long compute() &#123; if (ä»»åŠ¡è¶³å¤Ÿå°?) &#123; return computeDirect(); &#125; // ä»»åŠ¡å¤ªå¤§,ä¸€åˆ†ä¸ºäºŒ: SumTask subtask1 = new SumTask(...); SumTask subtask2 = new SumTask(...); // åˆ†åˆ«å¯¹å­ä»»åŠ¡è°ƒç”¨fork(): subtask1.fork(); subtask2.fork(); // åˆå¹¶ç»“æœ: Long subresult1 = subtask1.join(); Long subresult2 = subtask2.join(); return subresult1 + subresult2;&#125; å¾ˆé—æ†¾ï¼Œè¿™ç§å†™æ³•æ˜¯é”™ï¼è¯¯ï¼çš„ï¼è¿™æ ·å†™æ²¡æœ‰æ­£ç¡®ç†è§£Fork/Joinæ¨¡å‹çš„ä»»åŠ¡æ‰§è¡Œé€»è¾‘ã€‚ JDKç”¨æ¥æ‰§è¡ŒFork/Joinä»»åŠ¡çš„å·¥ä½œçº¿ç¨‹æ± å¤§å°ç­‰äºCPUæ ¸å¿ƒæ•°ã€‚åœ¨ä¸€ä¸ª4æ ¸CPUä¸Šï¼Œæœ€å¤šå¯ä»¥åŒæ—¶æ‰§è¡Œ4ä¸ªå­ä»»åŠ¡ã€‚å¯¹400ä¸ªå…ƒç´ çš„æ•°ç»„æ±‚å’Œï¼Œæ‰§è¡Œæ—¶é—´åº”è¯¥ä¸º1ç§’ã€‚ä½†æ˜¯ï¼Œæ¢æˆä¸Šé¢çš„ä»£ç ï¼Œæ‰§è¡Œæ—¶é—´å´æ˜¯ä¸¤ç§’ã€‚ è¿™æ˜¯å› ä¸ºæ‰§è¡Œcompute()æ–¹æ³•çš„çº¿ç¨‹æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªWorkerçº¿ç¨‹ï¼Œå½“å¯¹ä¸¤ä¸ªå­ä»»åŠ¡è°ƒç”¨fork()æ—¶ï¼Œè¿™ä¸ªWorkerçº¿ç¨‹å°±ä¼šæŠŠä»»åŠ¡åˆ†é…ç»™å¦å¤–ä¸¤ä¸ªWorkerï¼Œä½†æ˜¯å®ƒè‡ªå·±å´åœä¸‹æ¥ç­‰å¾…ä¸å¹²æ´»äº†ï¼è¿™æ ·å°±ç™½ç™½æµªè´¹äº†Fork/Joinçº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªWorkerçº¿ç¨‹ï¼Œå¯¼è‡´äº†4ä¸ªå­ä»»åŠ¡è‡³å°‘éœ€è¦7ä¸ªçº¿ç¨‹æ‰èƒ½å¹¶å‘æ‰§è¡Œã€‚ æ‰“ä¸ªæ¯”æ–¹ï¼Œå‡è®¾ä¸€ä¸ªé…’åº—æœ‰400ä¸ªæˆ¿é—´ï¼Œä¸€å…±æœ‰4åæ¸…æ´å·¥ï¼Œæ¯ä¸ªå·¥äººæ¯å¤©å¯ä»¥æ‰“æ‰«100ä¸ªæˆ¿é—´ï¼Œè¿™æ ·ï¼Œ4ä¸ªå·¥äººæ»¡è´Ÿè·å·¥ä½œæ—¶ï¼Œ400ä¸ªæˆ¿é—´å…¨éƒ¨æ‰“æ‰«å®Œæ­£å¥½éœ€è¦1å¤©ã€‚ Fork/Joinçš„å·¥ä½œæ¨¡å¼å°±åƒè¿™æ ·ï¼šé¦–å…ˆï¼Œå·¥äººç”²è¢«åˆ†é…äº†400ä¸ªæˆ¿é—´çš„ä»»åŠ¡ï¼Œä»–ä¸€çœ‹ä»»åŠ¡å¤ªå¤šäº†è‡ªå·±ä¸€ä¸ªäººä¸è¡Œï¼Œæ‰€ä»¥å…ˆæŠŠ400ä¸ªæˆ¿é—´æ‹†æˆä¸¤ä¸ª200ï¼Œç„¶åå«æ¥ä¹™ï¼ŒæŠŠå…¶ä¸­ä¸€ä¸ª200åˆ†ç»™ä¹™ã€‚ ç´§æ¥ç€ï¼Œç”²å’Œä¹™å†å‘ç°200ä¹Ÿæ˜¯ä¸ªå¤§ä»»åŠ¡ï¼Œäºæ˜¯ç”²ç»§ç»­æŠŠ200åˆ†æˆä¸¤ä¸ª100ï¼Œå¹¶æŠŠå…¶ä¸­ä¸€ä¸ª100åˆ†ç»™ä¸™ï¼Œç±»ä¼¼çš„ï¼Œä¹™ä¼šæŠŠå…¶ä¸­ä¸€ä¸ª100åˆ†ç»™ä¸ï¼Œè¿™æ ·ï¼Œæœ€ç»ˆ4ä¸ªäººæ¯äººåˆ†åˆ°100ä¸ªæˆ¿é—´ï¼Œå¹¶å‘æ‰§è¡Œæ­£å¥½æ˜¯1å¤©ã€‚ å¦‚æœæ¢ä¸€ç§å†™æ³•ï¼š 123// åˆ†åˆ«å¯¹å­ä»»åŠ¡è°ƒç”¨fork():subtask1.fork();subtask2.fork(); è¿™ä¸ªä»»åŠ¡å°±åˆ†ï¼é”™ï¼äº†ï¼ æ¯”å¦‚ç”²æŠŠ400åˆ†æˆä¸¤ä¸ª200åï¼Œè¿™ç§å†™æ³•ç›¸å½“äºç”²æŠŠä¸€ä¸ª200åˆ†ç»™ä¹™ï¼ŒæŠŠå¦ä¸€ä¸ª200åˆ†ç»™ä¸™ï¼Œç„¶åï¼Œç”²æˆäº†ç›‘å·¥ï¼Œä¸å¹²æ´»ï¼Œç­‰ä¹™å’Œä¸™å¹²å®Œäº†ä»–ç›´æ¥æ±‡æŠ¥å·¥ä½œã€‚ä¹™å’Œä¸™åœ¨æŠŠ200åˆ†æ‹†æˆä¸¤ä¸ª100çš„è¿‡ç¨‹ä¸­ï¼Œä»–ä¿©åˆæˆäº†ç›‘å·¥ï¼Œè¿™æ ·ï¼Œæœ¬æ¥åªéœ€è¦4ä¸ªå·¥äººçš„æ´»ï¼Œç°åœ¨éœ€è¦7ä¸ªå·¥äººæ‰èƒ½1å¤©å†…å®Œæˆï¼Œå…¶ä¸­æœ‰3ä¸ªæ˜¯ä¸å¹²æ´»çš„ã€‚ å…¶å®ï¼Œæˆ‘ä»¬æŸ¥çœ‹JDKçš„invokeAll()æ–¹æ³•çš„æºç å°±å¯ä»¥å‘ç°ï¼ŒinvokeAllçš„Nä¸ªä»»åŠ¡ä¸­ï¼Œå…¶ä¸­N-1ä¸ªä»»åŠ¡ä¼šä½¿ç”¨fork()äº¤ç»™å…¶å®ƒçº¿ç¨‹æ‰§è¡Œï¼Œä½†æ˜¯ï¼Œå®ƒè¿˜ä¼šç•™ä¸€ä¸ªä»»åŠ¡è‡ªå·±æ‰§è¡Œï¼Œè¿™æ ·ï¼Œå°±å……åˆ†åˆ©ç”¨äº†çº¿ç¨‹æ± ï¼Œä¿è¯æ²¡æœ‰ç©ºé—²çš„ä¸å¹²æ´»çš„çº¿ç¨‹ã€‚ éƒ¨åˆ† api ä½¿ç”¨ demoè¿™ä¸ªå’±ä»¥åæ…¢æ…¢è¡¥å……â€¦ æœªå®Œå¾…ç»­â€¦å¤šçº¿ç¨‹å‘Šä¸€æ®µè½â€¦æ¥ä¸‹æ¥è¿›è¡Œ jvm å’Œ é¢è¯•é¢˜å¤ä¹  é‡ç‚¹ï¼š jvm spring ç®—æ³•å¤ä¹  æ•°æ®åº“ â€” mysql &amp; mongo ##]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹è¡¥å……ç¯‡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šçº¿ç¨‹ï¼ˆä¸ƒï¼‰--- ä¸‰ç§æ–¹å¼å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…]]></title>
    <url>%2F2020%2F02%2F29%2F%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%88%E4%B8%83%EF%BC%89---%20%E4%B8%89%E7%A7%8D%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0%E7%94%9F%E4%BA%A7%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85.html</url>
    <content type="text"><![CDATA[ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼æ˜¯ä¸€ä¸ªååˆ†ç»å…¸çš„å¤šçº¿ç¨‹å¹¶å‘åä½œçš„æ¨¡å¼ï¼Œå¼„æ‡‚ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜èƒ½å¤Ÿè®©æˆ‘ä»¬å¯¹å¹¶å‘ç¼–ç¨‹çš„ç†è§£åŠ æ·±ã€‚æ‰€è°“ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ï¼Œå®é™…ä¸Šä¸»è¦æ˜¯åŒ…å«äº†ä¸¤ç±»çº¿ç¨‹ï¼Œä¸€ç§æ˜¯ç”Ÿäº§è€…çº¿ç¨‹ç”¨äºç”Ÿäº§æ•°æ®ï¼Œå¦ä¸€ç§æ˜¯æ¶ˆè´¹è€…çº¿ç¨‹ç”¨äºæ¶ˆè´¹æ•°æ®ï¼Œä¸ºäº†è§£è€¦ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å…³ç³»ï¼Œé€šå¸¸ä¼šé‡‡ç”¨å…±äº«çš„æ•°æ®åŒºåŸŸï¼Œå°±åƒæ˜¯ä¸€ä¸ªä»“åº“ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ•°æ®ä¹‹åç›´æ¥æ”¾ç½®åœ¨å…±äº«æ•°æ®åŒºä¸­ï¼Œå¹¶ä¸éœ€è¦å…³å¿ƒæ¶ˆè´¹è€…çš„è¡Œä¸ºï¼›è€Œæ¶ˆè´¹è€…åªéœ€è¦ä»å…±äº«æ•°æ®åŒºä¸­å»è·å–æ•°æ®ï¼Œå°±ä¸å†éœ€è¦å…³å¿ƒç”Ÿäº§è€…çš„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªå…±äº«æ•°æ®åŒºåŸŸä¸­åº”è¯¥å…·å¤‡è¿™æ ·çš„çº¿ç¨‹é—´å¹¶å‘åä½œçš„åŠŸèƒ½ï¼š å¦‚æœå…±äº«æ•°æ®åŒºå·²æ»¡çš„è¯ï¼Œé˜»å¡ç”Ÿäº§è€…ç»§ç»­ç”Ÿäº§æ•°æ®æ”¾ç½®å…¥å†…ï¼› å¦‚æœå…±äº«æ•°æ®åŒºä¸ºç©ºçš„è¯ï¼Œé˜»å¡æ¶ˆè´¹è€…ç»§ç»­æ¶ˆè´¹æ•°æ®ï¼› åœ¨å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜æ—¶ï¼Œå¯ä»¥é‡‡ç”¨ä¸‰ç§æ–¹å¼ï¼š 1.ä½¿ç”¨ Object çš„ wait/notify çš„æ¶ˆæ¯é€šçŸ¥æœºåˆ¶ï¼› 2.ä½¿ç”¨ Lock çš„ Condition çš„ await/signal çš„æ¶ˆæ¯é€šçŸ¥æœºåˆ¶ï¼› 3.ä½¿ç”¨ BlockingQueue å®ç°ã€‚æœ¬æ–‡ä¸»è¦å°†è¿™ä¸‰ç§å®ç°æ–¹å¼è¿›è¡Œæ€»ç»“å½’çº³ã€‚ 1. wait/notify æœºåˆ¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687package å¤šçº¿ç¨‹.Producer_Consumer;import java.util.LinkedList;import java.util.Map;import java.util.concurrent.TimeUnit;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;/** * æˆ‘æœ‰ä¸‰ä¸ªé—®é¢˜ï¼š * 1. ä¸ºä½•æ¯æ¬¡éƒ½æ˜¯ producer å’Œ consumer è¿ç€ä¸€èµ·ï¼Ÿæ˜¯ jvm å†…ç½®åå‘é”çš„åŸå› å—ï¼Ÿ * 2. ä¸ºä½• condition.await() é‚£å—ç”¨ if ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ç”¨ while å°±å¯ä»¥ï¼Ÿ * 3. æŒ‰é“ç†æ¥è¯´ï¼Œconsumer å’Œ producer ä¸åº”è¯¥æœ‰èµ„æºç«äº‰å…³ç³»ï¼Œæ‰€ä»¥åˆç†æ¥è¯´åº”è¯¥æ˜¯ä¸¤æŠŠé”ï¼Œå¦‚æœ consumer å’Œ producer åˆ†ä¸¤æŠŠé”æ¥æ“ä½œåˆå¦‚ä½•å®Œæˆé€šä¿¡å‘¢ï¼Ÿ * */public class wait_notify &#123; private final static Object a = 1; private final static LinkedList&lt;Long&gt; linkedList = new LinkedList&lt;&gt;(); private final static int MAX_CAPACITY = 10; public static void main(String[] args) &#123; System.out.println("wait/notify"); for (int i = 0; i &lt; 3; i++) &#123; new Thread(() -&gt; &#123; while (true) &#123; try &#123; wait_notify.producer(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; try &#123; TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; System.out.println("-----------------"); for (int i = 0; i &lt; 3; i++) &#123; new Thread(() -&gt; &#123; while (true) &#123; try &#123; wait_notify.consumer(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; try &#123; TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; &#125; static void producer() throws InterruptedException &#123; synchronized (a)&#123; while(linkedList.size() == MAX_CAPACITY)&#123; a.wait(); &#125; long value = System.currentTimeMillis(); System.out.println(Thread.currentThread().getName() + ":-------PRODUCER-------- " + value); linkedList.addLast(value); a.notifyAll(); &#125; &#125; static void consumer() throws InterruptedException &#123; synchronized (a)&#123; while (linkedList.size() == 0)&#123; a.wait(); &#125; long value = linkedList.pop(); System.out.println(Thread.currentThread().getName() + "::-------CONSUMER-------- " + value); a.notifyAll(); &#125; &#125;&#125; 2. await/signal æœºåˆ¶è¿™ä¸ªæˆ‘åœ¨ä¹‹å‰æœ‰å†™è¿‡ã€‚ä¸è¿‡å…¶å®æˆ‘è§‰å¾—ï¼Œproducer å’Œ consumer åº”è¯¥ä¸¤æŠŠé”ä¼šæ›´åŠ åˆé€‚ä¸€äº›ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸åº”è¯¥æœ‰èµ„æºå†²çªã€‚è€Œè¿™åˆšå¥½å°±æ˜¯ ArrayBlockingQueue å’Œ LinkedBlockingQueue çš„åŒºåˆ«ï¼Œå‰è€…æ˜¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å…±ä¸€æŠŠç‹¬å é”ï¼Œä½†æ˜¯åè€…æ˜¯åˆ†å¼€ï¼Œä¸¤æŠŠé”ï¼Œè¿™æ ·å¹¶å‘çš„æ•ˆç‡ä¹Ÿå°±è¶Šé«˜ï¼Œçº¿ç¨‹ç­‰å¾…çš„æœºä¼šä¼šæ›´å°‘ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677package å¤šçº¿ç¨‹.Producer_Consumer;import java.util.LinkedList;import java.util.concurrent.TimeUnit;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;public class await_signal &#123; private final static Lock lock = new ReentrantLock(); private final static Condition producer_condition = lock.newCondition(); private final static Condition consumer_condition = lock.newCondition(); private final static LinkedList&lt;Long&gt; linkedList = new LinkedList&lt;&gt;(); private final static int MAX_CAPACITY = 100; public static void main(String[] args) &#123; new Thread(() -&gt; &#123; for (int i = 0; i &lt; 10; i++) &#123; while (true) &#123; await_signal.producer(); try &#123; TimeUnit.SECONDS.sleep(5); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;).start(); new Thread(() -&gt; &#123; for (int i = 0; i &lt; 14; i++) &#123; while (true) &#123; await_signal.consumer(); try &#123; TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;).start(); &#125; private static void producer() &#123; try &#123; lock.lock(); if (linkedList.size() &gt; MAX_CAPACITY) &#123; producer_condition.await(); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; long value = System.currentTimeMillis(); System.out.println(Thread.currentThread().getName() + ":-------PRODUCER-------- " + value); linkedList.addLast(value); consumer_condition.signalAll(); lock.unlock(); &#125; &#125; private static void consumer() &#123; try &#123; lock.lock(); if (linkedList.size() == 0) &#123; consumer_condition.await(); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; long value = linkedList.pop(); System.out.println(Thread.currentThread().getName() + "::-------CONSUMER-------- " + value); producer_condition.signalAll(); lock.unlock(); &#125; &#125;&#125; ä¸Šé¢çš„ä»£ç å†™çš„æœ‰ç‚¹é—®é¢˜ï¼Œä¸ºäº†ä¿è¯æ€è€ƒçš„è¿‡ç¨‹å‘ˆç°ï¼Œæˆ‘å°±ä¸åˆ é™¤äº†ï¼š é¦–å…ˆæ˜¯ä¸»ç¨‹åº main ä¸­åˆ›å»ºçº¿ç¨‹å†™é”™äº†â€¦è¿™æ ·åªä¼šåˆ›å»ºä¸¤ä¸ªçº¿ç¨‹â€¦ä½çº§å¤±è¯¯ï¼› åœ¨ await æ—¶ï¼Œç”¨ if ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ç”¨ while æ²¡é—®é¢˜ã€‚ ç„¶åå†™å®Œä¹‹åæˆ‘å‘ç°è¾“å‡ºå¾ˆå¥‡æ€ªï¼Œå¹¶ä¸”åˆäº§ç”Ÿäº†æ–°çš„ç–‘é—®ï¼š ä¸ºä½•æ¯æ¬¡éƒ½æ˜¯ producer å’Œ consumer è¿ç€ä¸€èµ·ï¼Ÿ ä¸ºä½• await é‚£å—ç”¨ if ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ç”¨ while å°±å¯ä»¥ï¼Ÿ æŒ‰é“ç†æ¥è¯´ï¼Œconsumer å’Œ producer ä¸åº”è¯¥æœ‰èµ„æºç«äº‰å…³ç³»ï¼Œæ‰€ä»¥åˆç†æ¥è¯´åº”è¯¥æ˜¯ä¸¤æŠŠé”ï¼Œå¦‚æœ consumer å’Œ producer åˆ†ä¸¤æŠŠé”æ¥æ“ä½œåˆå¦‚ä½•å®Œæˆå‘¢ï¼Ÿ ä¸ºäº†æ›´å¥½åœ°è§£å†³ä»¥ä¸Šå‡ ä¸ªç–‘é—®ï¼Œæˆ‘ç®€åŒ–äº†ä¸€ä¸‹ä¾‹å­ï¼Œå°† producer çš„çº¿ç¨‹é™ä¸º 1 ä¸ªï¼Œå°† consumer çš„çº¿ç¨‹ é™ä¸º 3 ä¸ªã€‚ Q1ï¼šä¸ºä½•æ¯æ¬¡éƒ½æ˜¯ producer å’Œ consumer è¿ç€ä¸€èµ·ï¼Ÿç»è¿‡å¤šæ¬¡æµ‹è¯•å‘ç°ï¼Œä¸ä¼šæ€»æ˜¯ producer å’Œ consumer è¿åœ¨ä¸€èµ·å‡ºç°ï¼Œåªæ˜¯æœ€å¼€å§‹çš„æ—¶å€™ä¼šè¿åœ¨ä¸€èµ·å‡ºç°ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºåœ¨æœ€å¼€å§‹çš„æ—¶å€™ï¼Œproduceræ˜¯å…ˆå¯åŠ¨çš„ï¼Œé‚£ä¹ˆåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œproduceræ˜¯åœ¨å‰é¢çš„ï¼Œæ‰€ä»¥ç‡å…ˆæŠ¢åˆ°é”ï¼Œconsumerç­‰produceræŠ¢å®Œä¹‹åæ‰å¼€å§‹æŠ¢é”æ¶ˆè´¹ï¼Œä½†æ˜¯åæœŸç”±äºåå‘é”å’ŒConditionçš„åŸå› ï¼Œå°±ä¸ä¼š producerè¿ç€å‡ºç°çš„æƒ…å†µäº†ã€‚ Q2ï¼šä¸ºä½• await é‚£å—ç”¨ if ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ç”¨ while å°±å¯ä»¥ï¼Ÿä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ç‰¹æ„å°† producer çš„çº¿ç¨‹é™ä¸º 1 ä¸ªï¼Œå°† consumer çš„çº¿ç¨‹ é™ä¸º 3 ä¸ªï¼Œç»“æœæ˜¯ä¾ç„¶ä¼šæŠ¥é”™ã€‚ æ–°çš„ demo å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091package å¤šçº¿ç¨‹.Producer_Consumer;import java.util.LinkedList;import java.util.concurrent.TimeUnit;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;/** * æˆ‘æœ‰ä¸‰ä¸ªé—®é¢˜ï¼š * 1. ä¸ºä½•æ¯æ¬¡éƒ½æ˜¯ producer å’Œ consumer è¿ç€ä¸€èµ·ï¼Ÿæ˜¯ jvm å†…ç½®åå‘é”çš„åŸå› å—ï¼Ÿ * 2. ä¸ºä½• condition.await() é‚£å—ç”¨ if ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ç”¨ while å°±å¯ä»¥ï¼Ÿ * 3. æŒ‰é“ç†æ¥è¯´ï¼Œconsumer å’Œ producer ä¸åº”è¯¥æœ‰èµ„æºç«äº‰å…³ç³»ï¼Œæ‰€ä»¥åˆç†æ¥è¯´åº”è¯¥æ˜¯ä¸¤æŠŠé”ï¼Œå¦‚æœ consumer å’Œ producer åˆ†ä¸¤æŠŠé”æ¥æ“ä½œåˆå¦‚ä½•å®Œæˆé€šä¿¡å‘¢ï¼Ÿ * */public class await_signal &#123; private final static Lock lock = new ReentrantLock(); private final static Condition producer_condition = lock.newCondition(); private final static Condition consumer_condition = lock.newCondition(); private final static LinkedList&lt;Long&gt; linkedList = new LinkedList&lt;&gt;(); private final static int MAX_CAPACITY = 10; public static void main(String[] args) &#123; System.out.println("producer-consumer åŒä¸€æŠŠé”"); for (int i = 0; i &lt; 1; i++) &#123; new Thread(() -&gt; &#123; while (true) &#123; await_signal.producer(); try &#123; TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; System.out.println("-----------------"); for (int i = 0; i &lt; 3; i++) &#123; new Thread(() -&gt; &#123; while (true) &#123; await_signal.consumer(); try &#123; TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; &#125; static void producer() &#123; try &#123; lock.lock(); // ä¸ºä½•è¿™ä¸€å—ç”¨ if ä¸è¡Œï¼Ÿ if (linkedList.size() == MAX_CAPACITY) &#123; producer_condition.await(); &#125; long value = System.currentTimeMillis(); System.out.println(Thread.currentThread().getName() + ":-------PRODUCER-------- " + value); linkedList.addLast(value); consumer_condition.signalAll(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock.unlock(); &#125; &#125; static void consumer() &#123; try &#123; lock.lock(); // ä¸ºä½•è¿™ä¸€å—ç”¨ if ä¸è¡Œï¼Ÿ if (linkedList.size() == 0) &#123; consumer_condition.await(); &#125; long value = linkedList.pop(); System.out.println(Thread.currentThread().getName() + "::-------CONSUMER-------- " + value); producer_condition.signalAll(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock.unlock(); &#125; &#125;&#125; å¦‚ä¸Šï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ä¸ºä½•è¦ç”¨ whileï¼Œä¸‹é¢æˆ‘æŠŠç¨‹åºæ•´ä¸ªè¿è¡Œè¿‡ç¨‹è®²ä¸€éã€‚ é¦–å…ˆæˆ‘ä»¬æ¸…æ¥š Thread-0 æ˜¯ producerï¼ŒThread 1 ã€2ã€3 éƒ½æ˜¯ consumerï¼› åœ¨æœ€å¼€å§‹ï¼Œ Thread-0 æœ€å…ˆå¯åŠ¨ï¼Œæ‰€ä»¥å®ƒä¹Ÿç†æ‰€å½“ç„¶çš„ç¬¬ä¸€ä¸ªæŠ¢åˆ°äº†é” ä»å›¾ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œæ­¤æ—¶æŠ¢åˆ°é”çš„ exclusiveOwnerThread ä¸º Thread 0ï¼Œä»é˜Ÿåˆ—ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå‰©ä¸‹çš„ä¸‰ä¸ª Thread å·²ç»å…¨éƒ¨è¿›å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œä¸”é¡ºåºæ˜¯ Thread 3 - Thread 1 - Thread 2ï¼ˆåé¢é‚£ä¸ª 5 æ˜¯æŒ‡ä¼˜å…ˆçº§ï¼Œä¸ç”¨ç®¡ï¼‰ï¼Œä¸ºä»€ä¹ˆä¸å¯èƒ½è¿›å…¥åˆ°æ¡ä»¶é˜Ÿåˆ—å‘¢ï¼Ÿå› ä¸º nextWaiter = nullï¼Œä¸”ä» waitStatus = -1å¯çŸ¥ï¼Œä¸‰ä¸ªçº¿ç¨‹éƒ½åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«å”¤é†’ã€‚æ‰€ä»¥æˆ‘ä»¬é¢„æµ‹ä¸‹ä¸€ä¸ªæŠ¢åˆ°é”çš„ä¸€å®šæ˜¯ Thread 3,ä»–ä¼šå»æ¶ˆè´¹ Thread 0 åˆšåˆšç”Ÿäº§å‡ºçš„æ¶ˆæ¯ï¼Œè®©æˆ‘ä»¬æ¥ç€çœ‹ï¼› æ­£å¦‚æˆ‘ä»¬æ‰€æ–™ï¼ŒçœŸçš„æ˜¯ Thread 3æŠ¢åˆ°äº†é”ç„¶åå»æ¶ˆè´¹äº†ã€‚ 1234producer-consumer åŒä¸€æŠŠé”-----------------Thread-0:-------PRODUCER-------- 1583068539426Thread-3::-------CONSUMER-------- 1583068539426 æˆ‘ä»¬å†é€šè¿‡ debug çš„å˜é‡éªŒè¯ä¸€ä¸‹ã€‚ çœ‹ï¼ŒçœŸçš„ Thread 3 æŠ¢åˆ°é”äº†ã€‚ä¸ä¿¡ï¼Œç»§ç»­çœ‹ä¸‹é¢æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼š å¦‚å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒThread 3 æ¶ˆè´¹æ‰äº†æ¶ˆæ¯ï¼Œå¹¶ä¸”æ³¨æ„åˆ°åŒæ­¥é˜Ÿåˆ—ç°åœ¨å˜ä¸ºäº† Thread 1 - Thread 2 - Thread 0ï¼Œå¼€å§‹æ˜¯ 3 - 1 - 2,ç°åœ¨å°±å˜æˆäº† 1 - 2 - 0ï¼Œä½ è¿˜åˆ«è¯´ï¼Œè¿™ç§åŒæ­¥çœŸçš„é€Ÿåº¦æœ‰ç‚¹æ…¢ï¼ŒThread 0 éƒ½ä¼‘æ¯å®Œäº† 3 ç§’äº†ï¼Œå‰é¢é‚£ä¸¤è€å“¥è¿˜åœ¨ç­‰ç€å‘¢ï¼Œä¸è¿‡è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„åœ°æ–¹ï¼Œå°±æ˜¯ Thread 0 çš„ waitStatus = 0ï¼Œè¿™æ˜¯ä¸ºå•¥å‘¢ï¼Œå‡­å•¥åˆ«äººéƒ½æ˜¯ waitStatus = -1å‘¢ï¼Œå›é¡¾ä¸€ä¸‹ï¼ŒwatiStatus = -1æ„æ€å°±æ˜¯ç­‰å¾…è¢«å”¤é†’ï¼ŒwaitStatus = 0 æ„æ€å°±æ˜¯ä¸‹ä¸ªèŠ‚ç‚¹æ˜¯ nullï¼Œå½“ç„¶ä¹Ÿå¯èƒ½æ˜¯ä¸‹ä¸ªèŠ‚ç‚¹è¿˜æ²¡åˆå§‹åŒ–å®Œï¼Œä½†æ˜¯è¿™é‡Œæ˜¯ nullã€‚ è¿™ä¸‹æ€»è¯¥è‚¯å®šæ˜¯ Thread 3 æ¶ˆè´¹äº†å§ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚å½“ç„¶äº†ï¼Œæˆ‘ä»¬å…ˆé¢„æµ‹ä¸€æ³¢ï¼Œä¸‹é¢è¦æŠ¢é”çš„è‚¯å®šæ˜¯ 1å·è€å¤§å“¥ï¼Œç„¶åæ­¤æ—¶å·²ç»æ²¡æœ‰æ¶ˆæ¯ç»™ä»–æ¶ˆè´¹äº†ï¼Œé‚£ä»–å°±åªèƒ½æ‰å…¥ Condition çš„å¤§å‘äº†ï¼Œåªèƒ½ä»åŒæ­¥é˜Ÿåˆ—ç§»åˆ°æ¡ä»¶é˜Ÿåˆ—äº†ï¼Œå¥½è‹¦é€¼å•Šï¼Œç­‰äº†è¿™ä¹ˆä¹…ï¼Œè¿˜å¾—æ¢ä¸ªåœ°æ–¹æ¥ç€ç­‰ï¼ æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œç»“æœæ˜¯ä¸æ˜¯å¦‚æˆ‘ä»¬é¢„æ–™çš„ä¸€æ ·ã€‚ æœç„¶ï¼Œæ¥ç€å°±æ˜¯ 1 å·è€å¤§å“¥åœ¨è¿è¡Œï¼Œä¸ä¿¡æˆ‘ä»¬çœ‹ debug è¯¦ç»†çš„å‚æ•°ï¼š æ¡è‰ï¼Œæˆ‘è¢«æ‰“è„¸äº†â€¦è™½ç„¶æ­¤æ—¶çš„ç¡®æ˜¯ Thread 1 åœ¨æ‰§è¡Œï¼Œä½†æ˜¯ï¼ï¼ï¼ç›å¾·æ¡ä»¶é˜Ÿåˆ—ç«Ÿç„¶ä¸æ˜¯ 1å·è€å¤§å“¥ï¼Œæ˜¯åˆšåˆšæ¶ˆè´¹æ¶ˆæ¯çš„ 3 å·å°è€å¼Ÿï¼Œå®ƒåœ¨æä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿä»”ç»†æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬å¾—çŸ¥é“ jvm é»˜è®¤å¼€å¯äº†åå‘é”ï¼Œè‡³äºä»€ä¹ˆæ˜¯åå‘é”ï¼Œé‚£å°±å›åˆ°å¤šçº¿ç¨‹ï¼ˆä¸€ï¼‰å»å¤ä¹ å§ï¼Œ3 å·å°è€å¼Ÿä½¿ç”¨äº†å¤–æŒ‚â€”åå‘é”ã€Œé”™äº†ï¼ï¼ï¼ï¼çº æ­£ä¸€ä¸‹ï¼Œå‹æ ¹ä¸æ˜¯ç”¨çš„åå‘é”ï¼Œè¿™é‡Œæ—©å°±å‡çº§åˆ°äº†é‡é‡çº§é”ï¼Œå“ªé‡Œæ¥çš„åå‘é”ï¼ŒçœŸæ­£æ’é˜Ÿçš„åŸå› æ˜¯è¿™é‡Œæ˜¯éå…¬å¹³é”ï¼ï¼ï¼ï¼ï¼ã€ï¼Œäºæ˜¯å®ƒå¾ˆæ¶å¿ƒçš„æ’é˜Ÿäº†ï¼Œæœ¬æ¥æŒ‰é“ç†æ¥è¯´ï¼Œåº”è¯¥æ˜¯ 1å·è€å“¥æŠ¢åˆ°é”ï¼Œç„¶åå› ä¸ºæ²¡æœ‰æ¶ˆæ¯å¯ä»¥æ¶ˆè´¹ï¼Œæ‰€ä»¥å®ƒä»åŒæ­¥é˜Ÿåˆ—ç§»å…¥åˆ°æ¡ä»¶é˜Ÿåˆ—ä¸­ç­‰åˆ°è¢« signalï¼Œç„¶ååŒæ­¥é˜Ÿåˆ—ç†åº”å°±å‰©ä¸‹ 2 - 0ï¼Œç„¶åå¯èƒ½ 3 å·æ‰§è¡Œå®Œäº†æ¥åœ¨åé¢ã€‚ä½†æ˜¯ç°å®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé‚£å°±æ˜¯ 3 å·å°è€å¼Ÿä½¿ç”¨å¤–æŒ‚åå‘é”ï¼Œç›´æ¥æ’é˜Ÿï¼Œç‡å…ˆè·å–é”ï¼Œç”±äºæ²¡æœ‰æ¶ˆæ¯å¯ä»¥æ¶ˆè´¹ï¼Œæ‰€ä»¥å®ƒä»åŒæ­¥é˜Ÿåˆ—ç§»å…¥åˆ°äº†æ¡ä»¶é˜Ÿåˆ—ï¼Œå¼€å§‹ç­‰å¾…ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå›¾ä¸­ consumer_conditionçš„é˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ª Threadï¼Œé‚£å°±æ˜¯ 3 å·å°è€å¼Ÿï¼Œ3å·å°è€å¼Ÿåœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…ä¹‹åï¼Œæš‚æ—¶æ”¾å¼ƒäº†é”ï¼Œäºæ˜¯ç»ˆäºå°¼ç›è½®åˆ°æˆ‘ 1 å·è€å¤§å“¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶çš„ç¡®æ˜¯ 1å·å¼€å§‹è¿è¡Œï¼Œç„¶ååŒæ­¥é˜Ÿåˆ—ä¸­æ˜¯ 2 - 0 - nullï¼Œå³ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œè¿™çš„ç¡®æ˜¯ç¬¦åˆæˆ‘ä»¬ç°åœ¨çš„æƒ³æ³•ã€‚ è™½ç„¶åˆšæ‰é¢„æµ‹é”™äº†ï¼Œä½†æ˜¯é‚£æ˜¯å› ä¸º 3 å·ä½¿ç”¨äº†å¤–æŒ‚ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯æ¥ç€é¢„æµ‹å§ï¼Œæ¯•ç«Ÿæˆ‘é¢„æµ‹çš„å…¶å®è¿˜æ˜¯æŒºå‡†çš„ã€‚æ­¤æ—¶å› ä¸ºæ²¡æœ‰æ¶ˆæ¯å¯ä»¥æ¶ˆè´¹ï¼Œæ‰€ä»¥ 1 å·è€å¤§å“¥å¾ˆå¯æ€œï¼Œè·Ÿ 3 å·å°å¼Ÿä¸€æ ·çš„ä¸‹åœºï¼Œä»åŒæ­¥é˜Ÿåˆ—è½¬ç§»åˆ°æ¡ä»¶é˜Ÿåˆ—é˜Ÿå°¾ç»§ç»­ç­‰å¾…ï¼ŒæŒ‰é“ç†æ¥è¯´ 1 å·å°†è¦åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ï¼Œä¹Ÿå°±æ˜¯ 3 - 1ï¼Œç„¶åä»–è®©å‡ºé”ï¼Œç­‰å¾…è¢«å”¤é†’ï¼Œæ­¤æ—¶åŒæ­¥é˜Ÿåˆ—ä¸­é˜Ÿé¦–åº”è¯¥æ˜¯ 2 å·è€å“¥äº†ï¼Œç»ˆäºè½®åˆ°äººå®¶äº†â€¦å½“ç„¶å®ƒåº”è¯¥ä¹Ÿæ˜¯å¾ˆä¸å¹¸çš„ï¼Œåªèƒ½è·Ÿ 3 - 1ä¸€æ ·çš„ä¸‹åœºï¼Œå›åˆ°æ¡ä»¶é˜Ÿåˆ—é˜Ÿå°¾ç»§ç»­å¾…ç€â€¦é¢„æµ‹å®Œäº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹çœŸå®æƒ…å†µã€‚ çœ‹ç»“æœçš„ç¡®æ˜¯ 2 å·è€å“¥åœ¨è¿è¡Œç€ï¼š æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“çš„å‚æ•°ï¼ŒéªŒè¯ä¸€ä¸‹ï¼š å®Œç¾ï¼Œé¢„æµ‹çš„ä¸€æ¨¡ä¸€æ ·ã€‚2 å·æŠ¢åˆ°é”ä¹‹åï¼ŒåŒæ­¥é˜Ÿåˆ—å°±åªå‰©ä¸‹äº† 0 å·ï¼Œå¹¶ä¸” waitStatus = 0ï¼Œè¯´æ˜è¿™æ˜¯é˜Ÿå°¾äº†ï¼Œå†æé†’ä¸€ä¸‹å“ˆï¼Œå½“å‰èŠ‚ç‚¹çš„ waitStatus çš„å€¼æ˜¯è¡¨ç¤ºä¸‹ä¸€èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œæ¯”å¦‚è¯´ waitStatus = -1è¯´æ˜çš„æ˜¯è¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å·²ç»å‡†å¤‡å¥½è¢«å”¤é†’äº†ã€‚ç„¶åæˆ‘ä»¬å†çœ‹ä¸€ä¸‹æ¡ä»¶é˜Ÿåˆ—çš„æƒ…å†µï¼Œæƒ…å†µå’Œæˆ‘ä»¬æ€è€ƒçš„æ˜¯ä¸€æ ·çš„ï¼Œæ¡ä»¶é˜Ÿåˆ—ä¸­ç°åœ¨å°± 2 ä¸ª Threadï¼Œåˆ†åˆ«æ˜¯ 3 - 1ï¼Œå½“ç„¶äº†ï¼Œé©¬ä¸Š 2 å°±è¦åŠ å…¥ä»–ä»¬äº†ï¼Œå› ä¸ºæ­¤æ—¶è¿˜æ˜¯æ²¡æœ‰æ¶ˆæ¯å¯ä»¥æ¶ˆè´¹ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚ å•Šå•Šå•Šå•Šï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼Œå¯èƒ½æ˜¯æˆ‘ç‚¹é”™äº†ï¼Œçªç„¶å°±å‡ºç°äº†è¿™æ ·çš„ç»“æœã€‚ å¹¶ä¸”æ¡ä»¶é˜Ÿåˆ—ä¸ºç©ºã€‚ 1234567producer-consumer åŒä¸€æŠŠé”-----------------Thread-0:-------PRODUCER-------- 1583068539426Thread-3::-------CONSUMER-------- 1583068539426Thread-0:-------PRODUCER-------- 1583068539427Thread-3::-------CONSUMER-------- 1583068539427Exception in thread "Thread-1" ä¸è¦ç€æ€¥ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€æ³¢ï¼Œç”¨ç†è®ºæˆ˜èƒœé”™è¯¯ã€‚æˆ‘ä»¬åˆšæ‰æ˜¯è¿™æ ·çš„æƒ…å†µï¼Œè¾“å‡ºæ¡†æ˜¯ 1234producer-consumer åŒä¸€æŠŠé”-----------------Thread-0:-------PRODUCER-------- 1583068539426Thread-3::-------CONSUMER-------- 1583068539426 è¯´æ˜è¿™æœŸé—´æœ‰ä¸€æ¬¡ç”Ÿäº§ï¼Œæœ‰ä¸€æ¬¡æ¶ˆè´¹ï¼Œè€Œæ­¤æ—¶æˆ‘ä»¬çš„æ¡ä»¶é˜Ÿåˆ—åº”è¯¥æ˜¯ 3 - 1 - 2ï¼ŒåŒæ­¥é˜Ÿåˆ—åªå‰©ä¸‹ 0ã€‚æ‰€ä»¥æ­¤æ—¶åªå‰©ä¸‹ 0 å¯ä»¥æŠ¢é”äº†ï¼Œäºæ˜¯ 0 æ‹¿åˆ°äº†é”ï¼Œç„¶åç”Ÿäº§å‡ºäº†ä¸€æ¡æ¶ˆæ¯ï¼Œè¿™ä¸ªå¯ä»¥è¯´å¾—é€šï¼Œæ­¤æ—¶ç”Ÿäº§å®Œä¹‹åï¼Œå®ƒè°ƒç”¨ consumer_condition.signalall()ï¼ŒæŠŠæ¡ä»¶é˜Ÿåˆ—ä¸­çš„ 3 ä¸ªéƒ½ç»™å”¤é†’äº†ï¼Œ3 å·å°è€å¼Ÿç”±äºæ˜¯åœ¨æ¡ä»¶é˜Ÿåˆ—é˜Ÿé¦–ï¼Œæ‰€ä»¥å®ƒç¬¬ä¸€ä¸ªä»æ¡ä»¶é˜Ÿåˆ—ä¸­åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œ1 å· å’Œ 2 å· è€å¤§å“¥ç´§éšå…¶ååŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œäºæ˜¯ä»–ç¬¬ä¸€ä¸ªæŠ¢åˆ°é”ï¼Œç»§ç»­æ‰§è¡Œè‡ªå·±çš„é€»è¾‘ï¼Œæ³¨æ„ï¼Œæˆ‘ä»¬ç»ˆäºè¦è§£å†³ç¬¬äºŒä¸ªé—®é¢˜äº†ï¼ï¼ï¼ï¼ä»–å‘ç°æ­¤æ—¶æœ‰æ¶ˆæ¯å¯ä»¥æ¶ˆè´¹ï¼Œäºæ˜¯ä»–è¿›è¡Œäº†æ¶ˆè´¹ï¼Œæ­¤æ—¶å·²ç»æ²¡æœ‰æ¶ˆæ¯å¯ä»¥æ¶ˆè´¹äº†ï¼Œä½†æ˜¯ 1å·è€å¤§å“¥ä¸çŸ¥é“å•Šï¼Œå®ƒåˆšåˆšè¢«å”¤é†’ï¼Œå…´é«˜é‡‡çƒˆçš„ä»¥ä¸ºç»ˆäºå¯ä»¥æ¶ˆè´¹äº†ï¼Œå› ä¸ºæˆ‘ä»¬å†™çš„æ˜¯ ifï¼Œæ‰€ä»¥å®ƒä¸ä¼šå†å»åˆ¤æ–­æ˜¯å¦è¿˜è¦æ¶ˆæ¯å¯ä»¥æ¶ˆè´¹ï¼Œå› ä¸ºå®ƒä»¥ä¸ºè‚¯å®šæœ‰æ¶ˆæ¯å•Šå¯¹å§ï¼Œä¸ç„¶ä½ å”¤é†’æˆ‘å¹²å˜›ï¼äºæ˜¯ä»–å»æ¶ˆè´¹ï¼Œpoll()ä¸€ä¸ªç©ºlistï¼Œè¿™ä¸æ˜¯æ‰¾æŠ¥é”™å˜›â€¦æ‰€ä»¥ï¼Œå°±çœŸçš„æŠ¥é”™äº†ã€‚ æ‰€ä»¥è¯´ï¼Œé‡åˆ°é—®é¢˜ä¸è¦æ…Œï¼Œç†è®ºæŒæ¡çš„é€é€çš„ï¼Œä¸ä¼šå‡ºç°æ„å¤–æƒ…å†µçš„ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ç”¨ while è€Œä¸èƒ½ç”¨ ifï¼š è¢«å”¤é†’ä¹‹åï¼Œæ¡ä»¶é˜Ÿåˆ—ä¸­çš„ Thread ä¼šåŠ å…¥åˆ° åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœæ­¤æ—¶åŒæ­¥é˜Ÿåˆ—ä¸­è¿˜æœ‰ Threadï¼Œé‚£ä¹ˆæ¡ä»¶é˜Ÿåˆ—ä¸­è¢«å”¤é†’çš„ Thread å¿…é¡»è·Ÿåœ¨å®ƒä»¬çš„åé¢ï¼Œå¦‚æœæ­¤æ—¶åŒæ­¥é˜Ÿåˆ—ä¸­çš„ Thread æŠŠæ¶ˆæ¯æ¶ˆè´¹å®Œäº†ï¼Œæˆ‘åé¢çš„åˆšæ‰æ¡ä»¶é˜Ÿåˆ—ä¸­è¢«å”¤é†’çš„ Threadï¼Œæ ¹æœ¬æ— æ³•çŸ¥é“æ²¡æœ‰æ¶ˆæ¯äº†ï¼Œå› ä¸ºå®ƒä»¬ä¸€æ‹¿åˆ° lock å°±ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼› å½“ç„¶äº†ï¼Œåˆšæ‰æ˜¯ä¸¤æ‰¹äººçš„æˆ˜æ–—ï¼Œæ¡ä»¶é˜Ÿåˆ—ç®—ä¸€æ‰¹äººï¼ŒåŒæ­¥é˜Ÿåˆ—ç®—ä¸€æ‰¹äººï¼ŒåŒæ­¥é˜Ÿåˆ—çš„æŠŠäººå®¶æ¡ä»¶é˜Ÿåˆ—çš„äººç»™å®³äº†è¿˜ä¸å‘Šè¯‰äººå®¶ï¼Œæ¶å¿ƒï¼å½“ç„¶æœ€æ¶å¿ƒçš„è¿˜æ˜¯è‡ªå®¶äººçš„æ–—äº‰ï¼Œä¹Ÿå°±æ˜¯æ¡ä»¶é˜Ÿåˆ—ä¸­çš„ Thread çš„è‡ªç›¸æ®‹æ€ï¼Œæ¡ä»¶é˜Ÿåˆ—åé¢çš„å‹æ ¹ä¸çŸ¥é“å‰é¢çš„æ¶ˆè´¹å®Œäº†ï¼Œæ‰€ä»¥ä¹Ÿä¼šæŠ¥é”™ã€‚ å› æ­¤ï¼Œå°† if æ”¹ä¸º whileï¼Œæˆ‘åœ¨è¢«å”¤é†’ä¹‹åä¾æ—§å¯ä»¥é¦–å…ˆåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦è¿˜æœ‰æ¶ˆæ¯ï¼Œè¿™æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚ Q3ï¼šæ¶ˆè´¹è€…-ç”Ÿäº§è€…ä½¿ç”¨ä¸¤æŠŠé”ï¼Œåˆå¦‚ä½•å®Œæˆå‘¢ï¼Ÿçš„ç¡®ï¼Œæ¶ˆè´¹è€…å’Œç”Ÿäº§è€…æœ¬å°±ä¸åº”è¯¥æ”¾åˆ°ä¸€æŠŠé”ä¸­å»æ§åˆ¶ï¼Œæˆ‘æ¶ˆè´¹æˆ‘çš„ï¼Œä½ ç”Ÿäº§ä½ çš„ï¼Œåªæ˜¯å„æœ‰ä¸€ç§æƒ…å†µåœæ­¢è€Œå·²ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸¤æŠŠé”æ‰æ˜¯éå¸¸åˆç†çš„è®¾è®¡ï¼Œæˆ‘ä¹‹å‰ä¹Ÿæœ‰è¯´ï¼Œè¿™å°±æ˜¯ ArrayBlockingQueue å’Œ LinkedBlockingQueue æœ€å¤§çš„åŒºåˆ«ã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¸Œæœ›èƒ½å€ŸåŠ©äº LinkedBlockingQueue çš„æºç æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108package å¤šçº¿ç¨‹.Producer_Consumer;import java.util.LinkedList;import java.util.concurrent.TimeUnit;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;/** * æˆ‘æœ‰ä¸‰ä¸ªé—®é¢˜ï¼š * 1. ä¸ºä½•æ¯æ¬¡éƒ½æ˜¯ producer å’Œ consumer è¿ç€ä¸€èµ·ï¼Ÿæ˜¯ jvm å†…ç½®åå‘é”çš„åŸå› å—ï¼Ÿ * 2. ä¸ºä½• condition.await() é‚£å—ç”¨ if ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ç”¨ while å°±å¯ä»¥ï¼Ÿ * 3. æŒ‰é“ç†æ¥è¯´ï¼Œconsumer å’Œ producer ä¸åº”è¯¥æœ‰èµ„æºç«äº‰å…³ç³»ï¼Œæ‰€ä»¥åˆç†æ¥è¯´åº”è¯¥æ˜¯ä¸¤æŠŠé”ï¼Œå¦‚æœ consumer å’Œ producer åˆ†ä¸¤æŠŠé”æ¥æ“ä½œåˆå¦‚ä½•å®Œæˆé€šä¿¡å‘¢ï¼Ÿ * */public class await_signal &#123; private final static Lock lock1 = new ReentrantLock(); private final static Lock lock2 = new ReentrantLock(); private final static Condition producer_condition = lock1.newCondition(); private final static Condition consumer_condition = lock2.newCondition(); private final static LinkedList&lt;Long&gt; linkedList = new LinkedList&lt;&gt;(); private final static int MAX_CAPACITY = 5; public static void main(String[] args) &#123; System.out.println("producer-consumer ä¸¤æŠŠé”"); for (int i = 0; i &lt; 3; i++) &#123; new Thread(() -&gt; &#123; while (true) &#123; await_signal.producer(); try &#123; TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; System.out.println("-----------------"); for (int i = 0; i &lt; 3; i++) &#123; new Thread(() -&gt; &#123; while (true) &#123; await_signal.consumer(); try &#123; TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; &#125; static void producer() &#123; int size = 0; try &#123; lock1.lock(); while (linkedList.size() == MAX_CAPACITY) &#123; producer_condition.await(); &#125; size = linkedList.size(); long value = System.currentTimeMillis(); System.out.println(Thread.currentThread().getName() + ":-------PRODUCER-------- " + value); linkedList.addLast(value); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock1.unlock(); &#125; if(size == 0)&#123; try&#123; lock2.lock(); consumer_condition.signalAll(); &#125;finally &#123; lock2.unlock(); &#125; &#125; &#125; static void consumer() &#123; int size = 0; try &#123; lock2.lock(); while (linkedList.size() == 0) &#123; consumer_condition.await(); &#125; size = linkedList.size(); long value = linkedList.pop(); System.out.println(Thread.currentThread().getName() + "::-------CONSUMER-------- " + value); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock2.unlock(); &#125; if(size == MAX_CAPACITY)&#123; try&#123; lock1.lock(); producer_condition.signalAll(); &#125;finally &#123; lock1.unlock(); &#125; &#125; &#125;&#125; ä¸Šè¿°å°±æ˜¯å®Œå…¨å€Ÿé‰´äº LinkedBlockingQueueï¼Œä½†æ˜¯æºç é‡Œé¢æ ¹æœ¬æ²¡æœ‰è°ƒç”¨ signalAll()ï¼Œè€Œæ˜¯åˆ©ç”¨ä¸¤æŠŠé”çš„ä¼˜åŠ¿ï¼Œåªéœ€è¦å”¤é†’æ¡ä»¶é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªï¼Œç„¶åä¸€ä¸ªæ¥ä¸€ä¸ªå»å”¤é†’å°±å¯ä»¥äº†ï¼Œè¿™ä¸ªå°±å¾ˆå¦™ï¼ï¼ï¼ï¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110package å¤šçº¿ç¨‹.Producer_Consumer;import java.util.LinkedList;import java.util.concurrent.TimeUnit;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;/** * æˆ‘æœ‰ä¸‰ä¸ªé—®é¢˜ï¼š * 1. ä¸ºä½•æ¯æ¬¡éƒ½æ˜¯ producer å’Œ consumer è¿ç€ä¸€èµ·ï¼Ÿæ˜¯ jvm å†…ç½®åå‘é”çš„åŸå› å—ï¼Ÿ * 2. ä¸ºä½• condition.await() é‚£å—ç”¨ if ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ç”¨ while å°±å¯ä»¥ï¼Ÿ * 3. æŒ‰é“ç†æ¥è¯´ï¼Œconsumer å’Œ producer ä¸åº”è¯¥æœ‰èµ„æºç«äº‰å…³ç³»ï¼Œæ‰€ä»¥åˆç†æ¥è¯´åº”è¯¥æ˜¯ä¸¤æŠŠé”ï¼Œå¦‚æœ consumer å’Œ producer åˆ†ä¸¤æŠŠé”æ¥æ“ä½œåˆå¦‚ä½•å®Œæˆé€šä¿¡å‘¢ï¼Ÿ * */public class await_signal &#123; private final static Lock lock1 = new ReentrantLock(); private final static Lock lock2 = new ReentrantLock(); private final static Condition producer_condition = lock1.newCondition(); private final static Condition consumer_condition = lock2.newCondition(); private final static LinkedList&lt;Long&gt; linkedList = new LinkedList&lt;&gt;(); private final static int MAX_CAPACITY = 5; public static void main(String[] args) &#123; System.out.println("producer-consumer ä¸¤æŠŠé”"); for (int i = 0; i &lt; 3; i++) &#123; new Thread(() -&gt; &#123; while (true) &#123; await_signal.producer(); try &#123; TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; System.out.println("-----------------"); for (int i = 0; i &lt; 3; i++) &#123; new Thread(() -&gt; &#123; while (true) &#123; await_signal.consumer(); try &#123; TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; &#125; static void producer() &#123; int size = 0; try &#123; lock1.lock(); while (linkedList.size() == MAX_CAPACITY) &#123; producer_condition.await(); &#125; size = linkedList.size(); long value = System.currentTimeMillis(); System.out.println(Thread.currentThread().getName() + ":-------PRODUCER-------- " + value); linkedList.addLast(value); producer_condition.signal(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock1.unlock(); &#125; if(size == 0)&#123; try&#123; lock2.lock(); consumer_condition.signal(); &#125;finally &#123; lock2.unlock(); &#125; &#125; &#125; static void consumer() &#123; int size = 0; try &#123; lock2.lock(); while (linkedList.size() == 0) &#123; consumer_condition.await(); &#125; size = linkedList.size(); long value = linkedList.pop(); System.out.println(Thread.currentThread().getName() + "::-------CONSUMER-------- " + value); consumer_condition.signal(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock2.unlock(); &#125; if(size == MAX_CAPACITY)&#123; try&#123; lock1.lock(); producer_condition.signal(); &#125;finally &#123; lock1.unlock(); &#125; &#125; &#125;&#125; æ„Ÿæ…¨ä¸€å¥ï¼Œæºç å†™çš„çœŸçš„ç²¾å¦™å•Šï¼è¯»æºç çœŸçš„è®©è‡ªå·±å­¦åˆ°äº†å¾ˆå¤šï¼Œå°±æ˜¯æœ‰ç‚¹å¯æƒœç°åœ¨è¿˜ä¸å¤ªæ‡‚è®¾è®¡æ¨¡å¼ï¼Œå¯¼è‡´å¾ˆå¤šå¾ˆå¥½çš„æ€æƒ³è¿˜æ²¡æœ‰å­¦ä¼šã€‚ã€‚ã€‚ 3. BlockingQueue å®ç°åˆ«äººå†™çš„ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768package å¤šçº¿ç¨‹.Producer_Consumer;import java.util.Random;import java.util.concurrent.BlockingQueue;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.LinkedBlockingQueue;public class BlockingQueue_product_consumer &#123;&#125;class ProductorConsumer &#123; private static LinkedBlockingQueue&lt;Integer&gt; queue = new LinkedBlockingQueue&lt;&gt;(); public static void main(String[] args) &#123; ExecutorService service = Executors.newFixedThreadPool(15); for (int i = 0; i &lt; 5; i++) &#123; service.submit(new Producer(queue)); &#125; for (int i = 0; i &lt; 10; i++) &#123; service.submit(new Consumer(queue)); &#125; &#125; static class Producer implements Runnable &#123; private BlockingQueue queue; public Producer(BlockingQueue queue) &#123; this.queue = queue; &#125; @Override public void run() &#123; try &#123; while (true) &#123; Random random = new Random(); int i = random.nextInt(); System.out.println("ç”Ÿäº§è€…" + Thread.currentThread().getName() + "ç”Ÿäº§æ•°æ®" + i); queue.put(i); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; static class Consumer implements Runnable &#123; private BlockingQueue queue; public Consumer(BlockingQueue queue) &#123; this.queue = queue; &#125; @Override public void run() &#123; try &#123; while (true) &#123; Integer element = (Integer) queue.take(); System.out.println("æ¶ˆè´¹è€…" + Thread.currentThread().getName() + "æ­£åœ¨æ¶ˆè´¹æ•°æ®" + element); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; è‡ªå·±æ— èŠé‡å†™ä¸€ä¸ªå§ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748class BlockingQueue_product_consumer2 &#123; private static BlockingQueue&lt;Long&gt; blockingQueue = new LinkedBlockingQueue(5); public static void main(String[] args) &#123; System.out.println("BlockingQueue api ä½¿ç”¨"); ExecutorService executorService = Executors.newFixedThreadPool(10); for (int i = 0; i &lt; 5; i++) &#123; executorService.execute(() -&gt; &#123; while (true) &#123; long value = 0; try &#123; value = blockingQueue.take(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; System.out.println(Thread.currentThread().getName() + "::-------CONSUMER-------- " + value); &#125; &#125;); &#125; for (int i = 0; i &lt; 5; i++) &#123; executorService.execute(() -&gt; &#123; while (true) &#123; long value = System.currentTimeMillis(); System.out.println(Thread.currentThread().getName() + "::-------PRODUCER-------- " + value); try &#123; blockingQueue.put(value); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;); &#125; &#125;&#125;]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šçº¿ç¨‹ï¼ˆå…­ï¼‰--- å¹¶å‘å·¥å…·åŒ…]]></title>
    <url>%2F2020%2F02%2F28%2F%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%88%E5%85%AD%EF%BC%89---%20%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E5%8C%85.html</url>
    <content type="text"><![CDATA[CountDownLatch(å€’è®¡æ—¶å™¨)åœ¨å¤šçº¿ç¨‹åä½œå®Œæˆä¸šåŠ¡åŠŸèƒ½æ—¶ï¼Œæœ‰æ—¶å€™éœ€è¦ç­‰å¾…å…¶ä»–å¤šä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡ä¹‹åï¼Œä¸»çº¿ç¨‹æ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œä¸šåŠ¡åŠŸèƒ½ï¼Œåœ¨è¿™ç§çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨ Thread ç±»çš„ join æ–¹æ³•ï¼Œè®©ä¸»çº¿ç¨‹ç­‰å¾…è¢« join çš„çº¿ç¨‹æ‰§è¡Œå®Œä¹‹åï¼Œä¸»çº¿ç¨‹æ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚ ä½¿ç”¨çº¿ç¨‹é—´æ¶ˆæ¯é€šä¿¡æœºåˆ¶ä¹Ÿå¯ä»¥å®Œæˆã€‚ ä½¿ç”¨Executorä½“ç³»ä¸­çš„ FutureTask,ä¸»çº¿ç¨‹è°ƒç”¨å…¶ä»–çº¿ç¨‹ get() æ–¹æ³• å…¶å®ï¼Œjava å¹¶å‘å·¥å…·ç±»ä¸­ä¸ºæˆ‘ä»¬æä¾›äº†ç±»ä¼¼â€œå€’è®¡æ—¶â€è¿™æ ·çš„å·¥å…·ç±»ï¼Œå¯ä»¥ååˆ†æ–¹ä¾¿çš„å®Œæˆæ‰€è¯´çš„è¿™ç§ä¸šåŠ¡åœºæ™¯ã€‚ æ–¹æ³• 12345await() throws InterruptedException //è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹ç­‰åˆ°æ„é€ æ–¹æ³•ä¼ å…¥çš„ N å‡åˆ° 0 çš„æ—¶å€™ï¼Œæ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼›await(long timeout, TimeUnit unit) //ä¸ä¸Šé¢çš„ await æ–¹æ³•åŠŸèƒ½ä¸€è‡´ï¼Œåªä¸è¿‡è¿™é‡Œæœ‰äº†æ—¶é—´é™åˆ¶ï¼Œè°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹ç­‰åˆ°æŒ‡å®šçš„ timeout æ—¶é—´åï¼Œä¸ç®¡ N æ˜¯å¦å‡è‡³ä¸º 0ï¼Œéƒ½ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼›countDown() //ä½¿ CountDownLatch åˆå§‹å€¼ N å‡ 1ï¼›long getCount() //è·å–å½“å‰ CountDownLatch ç»´æŠ¤çš„å€¼ï¼›CountDownLatch() //å‚æ•°ä¸ºå€’è®¡æ—¶æ•°é‡ ä¸ºäº†èƒ½å¤Ÿç†è§£ CountDownLatchï¼Œä¸¾ä¸€ä¸ªå¾ˆé€šä¿—çš„ä¾‹å­ï¼Œè¿åŠ¨å‘˜è¿›è¡Œè·‘æ­¥æ¯”èµ›æ—¶ï¼Œå‡è®¾æœ‰ 6 ä¸ªè¿åŠ¨å‘˜å‚ä¸æ¯”èµ›ï¼Œè£åˆ¤å‘˜åœ¨ç»ˆç‚¹ä¼šä¸ºè¿™ 6 ä¸ªè¿åŠ¨å‘˜åˆ†åˆ«è®¡æ—¶ï¼Œå¯ä»¥æƒ³è±¡æ¯å½“ä¸€ä¸ªè¿åŠ¨å‘˜åˆ°è¾¾ç»ˆç‚¹çš„æ—¶å€™ï¼Œå¯¹äºè£åˆ¤å‘˜æ¥è¯´å°±å°‘äº†ä¸€ä¸ªè®¡æ—¶ä»»åŠ¡ã€‚ç›´åˆ°æ‰€æœ‰è¿åŠ¨å‘˜éƒ½åˆ°è¾¾ç»ˆç‚¹äº†ï¼Œè£åˆ¤å‘˜çš„ä»»åŠ¡ä¹Ÿæ‰å®Œæˆã€‚è¿™ 6 ä¸ªè¿åŠ¨å‘˜å¯ä»¥ç±»æ¯”æˆ 6 ä¸ªçº¿ç¨‹ï¼Œå½“çº¿ç¨‹è°ƒç”¨ CountDownLatch.countDown æ–¹æ³•æ—¶å°±ä¼šå¯¹è®¡æ•°å™¨çš„å€¼å‡ä¸€ï¼Œç›´åˆ°è®¡æ•°å™¨çš„å€¼ä¸º 0 çš„æ—¶å€™ï¼Œè£åˆ¤å‘˜ï¼ˆè°ƒç”¨ await æ–¹æ³•çš„çº¿ç¨‹ï¼‰æ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚ Demo1234567891011121314151617181920212223242526272829303132333435package å¤šçº¿ç¨‹.å¹¶å‘å·¥å…·åŒ…;import java.util.concurrent.CountDownLatch;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.TimeUnit;public class CountDownLatchDemo &#123; private static CountDownLatch startSignal = new CountDownLatch(1); //ç”¨æ¥è¡¨ç¤ºè£åˆ¤å‘˜éœ€è¦ç»´æŠ¤çš„æ˜¯6ä¸ªè¿åŠ¨å‘˜ private static CountDownLatch endSignal = new CountDownLatch(6); public static void main(String[] args) throws InterruptedException &#123; ExecutorService executorService = Executors.newFixedThreadPool(6); for (int i = 0; i &lt; 6; i++) &#123; executorService.execute(() -&gt; &#123; try &#123; System.out.println(Thread.currentThread().getName() + " è¿åŠ¨å‘˜ç­‰å¾…è£åˆ¤å‘˜å“å“¨ï¼ï¼ï¼"); startSignal.await(); System.out.println(Thread.currentThread().getName() + "æ­£åœ¨å…¨åŠ›å†²åˆº"); System.out.println(Thread.currentThread().getName() + " åˆ°è¾¾ç»ˆç‚¹"); endSignal.countDown(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); &#125; TimeUnit.SECONDS.sleep(3); System.out.println("è£åˆ¤å‘˜å‘å·æ–½ä»¤å•¦ï¼ï¼ï¼"); startSignal.countDown(); endSignal.await(); System.out.println("æ‰€æœ‰è¿åŠ¨å‘˜åˆ°è¾¾ç»ˆç‚¹ï¼Œæ¯”èµ›ç»“æŸï¼"); executorService.shutdown(); &#125;&#125; CyclicBarrier(å¾ªç¯æ …æ )CyclicBarrier ä¹Ÿæ˜¯ä¸€ç§å¤šçº¿ç¨‹å¹¶å‘æ§åˆ¶çš„å®ç”¨å·¥å…·ï¼Œå’Œ CountDownLatch ä¸€æ ·å…·æœ‰ç­‰å¾…è®¡æ•°çš„åŠŸèƒ½ï¼Œä½†æ˜¯ç›¸æ¯”äº CountDownLatch åŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚ å¾ªç¯æ …æ ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¸€ä¸ªä¸´ç•Œç‚¹ï¼Œæ‰€æœ‰äººåˆ°äº†è¿™ä¸ªä¸´ç•Œç‚¹ï¼Œæ‰å¯ä»¥ä¸€èµ·ç»§ç»­å·¥ä½œï¼Œç„¶åå†ç­‰ä¸‹ä¸€æ¬¡æ‰€æœ‰äººéƒ½åˆ°è¿™ä¸ªä¸´ç•Œç‚¹ï¼Œç»§ç»­å·¥ä½œâ€¦å¦‚æ­¤å¾ªç¯â€¦ Demo123456789101112131415161718192021222324252627282930package å¤šçº¿ç¨‹.å¹¶å‘å·¥å…·åŒ…;import java.util.concurrent.*;public class CyclicBarrierDemo &#123; //æŒ‡å®šå¿…é¡»æœ‰6ä¸ªè¿åŠ¨å‘˜åˆ°è¾¾æ‰è¡Œ private static CyclicBarrier barrier = new CyclicBarrier(6, () -&gt; &#123; // æ¯æ¬¡åˆ°äº†è¿™ä¸ªä¸´ç•Œç‚¹ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å¿…é¡»åœä¸‹ã€‚ System.out.println("è£åˆ¤å‘˜å‘å·æ–½ä»¤å•¦ï¼ï¼ï¼"); &#125;); public static void main(String[] args) &#123; System.out.println("è¿åŠ¨å‘˜å‡†å¤‡è¿›åœºï¼Œå…¨åœºæ¬¢å‘¼............"); ExecutorService service = Executors.newFixedThreadPool(6); for (int i = 0; i &lt; 6; i++) &#123; service.execute(() -&gt;&#123; try &#123; System.out.println(Thread.currentThread().getName() + "è¿åŠ¨å‘˜ç­‰å¾…è£åˆ¤å‘˜å“å“¨ï¼ï¼ï¼"); barrier.await(); System.out.println(Thread.currentThread().getName() + "è¿åŠ¨å‘˜å‡ºå‘"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (BrokenBarrierException e) &#123; e.printStackTrace(); &#125; &#125;); &#125; service.shutdown(); &#125;&#125; CountDownLatch ä¸ CyclicBarrier çš„æ¯”è¾ƒCountDownLatch ä¸ CyclicBarrier éƒ½æ˜¯ç”¨äºæ§åˆ¶å¹¶å‘çš„å·¥å…·ç±»ï¼Œéƒ½å¯ä»¥ç†è§£æˆç»´æŠ¤çš„å°±æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œä½†æ˜¯è¿™ä¸¤è€…è¿˜æ˜¯å„æœ‰ä¸åŒä¾§é‡ç‚¹çš„ï¼š CountDownLatch ä¸€èˆ¬ç”¨äºæŸä¸ªçº¿ç¨‹ A ç­‰å¾…è‹¥å¹²ä¸ªå…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åï¼Œå®ƒæ‰æ‰§è¡Œï¼Œæœ€é‡è¦çš„æ˜¯æœ‰ä¸€ä¸ªä¸»å¿ƒéª¨ï¼Œä¸»çº¿ç¨‹æ˜¯æ ¸å¿ƒï¼Œä»–ç­‰æ‰€æœ‰äººå¹²å®Œï¼›è€Œ CyclicBarrier ä¸€èˆ¬ç”¨äºä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ï¼Œç„¶åè¿™ä¸€ç»„çº¿ç¨‹å†åŒæ—¶æ‰§è¡Œï¼›CountDownLatch å¼ºè°ƒä¸€ä¸ªçº¿ç¨‹ç­‰å¤šä¸ªçº¿ç¨‹å®ŒæˆæŸä»¶äº‹æƒ…ã€‚CyclicBarrier æ˜¯å¤šä¸ªçº¿ç¨‹äº’ç­‰ï¼Œç­‰å¤§å®¶éƒ½å®Œæˆï¼Œå†æºæ‰‹å…±è¿›ã€‚æ‰€ä»¥ä¸¤è€… await çš„åœ°æ–¹ä¸ä¸€æ ·ï¼Œå‰è€…æ˜¯å¯¹ä¸»çº¿ç¨‹è¿›è¡Œ awaitï¼Œè€Œåè€…åˆ™æ˜¯æ‰€æœ‰ä¸€èµ·å·¥ä½œçš„è¿›è¡Œ awaitã€‚ CountDownLatch æ–¹æ³•æ¯”è¾ƒå°‘ï¼Œæ“ä½œæ¯”è¾ƒç®€å•ï¼Œè€Œ CyclicBarrier æä¾›çš„æ–¹æ³•æ›´å¤šï¼Œæ¯”å¦‚èƒ½å¤Ÿé€šè¿‡ getNumberWaiting()ï¼ŒisBroken()è¿™äº›æ–¹æ³•è·å–å½“å‰å¤šä¸ªçº¿ç¨‹çš„çŠ¶æ€ï¼Œå¹¶ä¸” CyclicBarrier çš„æ„é€ æ–¹æ³•å¯ä»¥ä¼ å…¥ barrierActionï¼ŒæŒ‡å®šå½“æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾æ—¶æ‰§è¡Œçš„ä¸šåŠ¡åŠŸèƒ½ã€‚ Semaphore(ä¿¡å·é‡)ä¿¡å·é‡ï¼Œçœ‹æºç å°±æ˜¯åŸºäº AQS å®ç°çš„ï¼Œç±»ä¼¼äºå…±äº«é”ï¼Œåªä¸è¿‡è¿™ä¸ªå…±äº«æ˜¯æœ‰é™åˆ¶çš„å…±äº«ï¼Œå®ƒèƒ½å¤Ÿæ§åˆ¶å…±äº«çš„çº¿ç¨‹æ•°é‡ã€‚Semaphore å°±ç›¸å½“äºä¸€ä¸ªè®¸å¯è¯ï¼Œçº¿ç¨‹éœ€è¦å…ˆé€šè¿‡ acquire æ–¹æ³•è·å–è¯¥è®¸å¯è¯ï¼Œè¯¥çº¿ç¨‹æ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå¦åˆ™åªèƒ½åœ¨è¯¥æ–¹æ³•å‡ºé˜»å¡ç­‰å¾…ã€‚å½“æ‰§è¡Œå®Œä¸šåŠ¡åŠŸèƒ½åï¼Œéœ€è¦é€šè¿‡release()æ–¹æ³•å°†è®¸å¯è¯å½’è¿˜ï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿè·å¾—è®¸å¯è¯ç»§ç»­æ‰§è¡Œã€‚ Semaphore å¯ä»¥ç”¨äºåšæµé‡æ§åˆ¶ï¼Œç‰¹åˆ«æ˜¯å…¬å…±èµ„æºæœ‰é™çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥ã€‚å‡å¦‚æœ‰å¤šä¸ªçº¿ç¨‹è¯»å–æ•°æ®åï¼Œéœ€è¦å°†æ•°æ®ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œè€Œå¯ç”¨çš„æœ€å¤§æ•°æ®åº“è¿æ¥åªæœ‰ 10 ä¸ªï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨ Semaphore æ¥æ§åˆ¶èƒ½å¤Ÿå¹¶å‘è®¿é—®åˆ°æ•°æ®åº“è¿æ¥èµ„æºçš„çº¿ç¨‹ä¸ªæ•°æœ€å¤šåªæœ‰ 10 ä¸ªã€‚åœ¨é™åˆ¶èµ„æºä½¿ç”¨çš„åº”ç”¨åœºæ™¯ä¸‹ï¼ŒSemaphore æ˜¯ç‰¹åˆ«åˆé€‚çš„ã€‚ è¿™é‡Œçš„é˜Ÿåˆ—å°±æ˜¯å°±æ˜¯å¾ˆç®€å•çš„ç”¨ ArrayList è¿›è¡Œå­˜å‚¨ï¼Œå­˜å‚¨é‚£äº›ç­‰å¾…è®¸å¯è¯çš„çº¿ç¨‹ï¼Œæ²¡æœ‰é˜»å¡ç„¶ååŠ å…¥é˜Ÿåˆ—ç„¶åå”¤é†’è¿™ä¹ˆéº»çƒ¦â€¦ 123456789101112131415161718192021222324252627282930package å¤šçº¿ç¨‹.å¹¶å‘å·¥å…·åŒ…;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.Semaphore;import java.util.concurrent.TimeUnit;public class SemaphoreDemo &#123; //è¡¨ç¤ºè€å¸ˆåªæœ‰5æ”¯ç¬” private static Semaphore semaphore = new Semaphore(5); public static void main(String[] args) &#123; //è¡¨ç¤º10ä¸ªå­¦ç”Ÿ ExecutorService service = Executors.newFixedThreadPool(10); for (int i = 0; i &lt; 10; i++) &#123; service.execute(() -&gt; &#123; try &#123; semaphore.acquire(); System.out.println(Thread.currentThread().getName() + " åŒå­¦è·å–åˆ°ç¬”ï¼Œå¡«è¡¨æ ¼"); TimeUnit.SECONDS.sleep(3); semaphore.release(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); &#125; service.shutdown(); &#125;&#125; Exchanger (äº¤æ¢å™¨)å¯ä»¥ç›´æ¥åœ¨æŸä¸ªä¸´ç•Œç‚¹ï¼Œä¸¤ä¸ªçº¿ç¨‹äº¤æ¢æ•°æ®ï¼Œä¸éœ€è¦ä½¿ç”¨ wait/notify æˆ–è€…æ˜¯ condition æœºåˆ¶ã€‚ å®ƒæä¾›äº†ä¸€ä¸ªäº¤æ¢çš„åŒæ­¥ç‚¹ï¼Œåœ¨è¿™ä¸ªåŒæ­¥ç‚¹ä¸¤ä¸ªçº¿ç¨‹èƒ½å¤Ÿäº¤æ¢æ•°æ®ã€‚å…·ä½“äº¤æ¢æ•°æ®æ˜¯é€šè¿‡ exchange æ–¹æ³•æ¥å®ç°çš„ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œ exchange æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä¼šåŒæ­¥ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿæ‰§è¡Œ exchange æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™ä¸¤ä¸ªçº¿ç¨‹å°±éƒ½è¾¾åˆ°äº†åŒæ­¥ç‚¹ï¼Œä¸¤ä¸ªçº¿ç¨‹å°±å¯ä»¥äº¤æ¢æ•°æ®ã€‚ 123456//å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿæ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå› æ­¤ä¸¤ä¸ªçº¿ç¨‹å°±éƒ½è¾¾åˆ°äº†åŒæ­¥ç‚¹//å°†æ•°æ®äº¤æ¢ç»™å¦ä¸€ä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶è¿”å›è·å–çš„æ•°æ®V exchange(V x) throws InterruptedException//åŒä¸Šä¸€ä¸ªæ–¹æ³•åŠŸèƒ½åŸºæœ¬ä¸€æ ·ï¼Œåªä¸è¿‡è¿™ä¸ªæ–¹æ³•åŒæ­¥ç­‰å¾…çš„æ—¶å€™ï¼Œå¢åŠ äº†è¶…æ—¶æ—¶é—´V exchange(V x, long timeout, TimeUnit unit)throws InterruptedException, TimeoutException 1234567891011121314151617181920212223242526272829303132333435363738package å¤šçº¿ç¨‹.å¹¶å‘å·¥å…·åŒ…;import java.util.concurrent.Exchanger;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.TimeUnit;public class ExchangerDemo &#123; private static Exchanger&lt;String&gt; exchanger = new Exchanger(); public static void main(String[] args) &#123; //ä»£è¡¨ç”·ç”Ÿå’Œå¥³ç”Ÿ ExecutorService service = Executors.newFixedThreadPool(2); service.execute(() -&gt; &#123; try &#123; //ç”·ç”Ÿå¯¹å¥³ç”Ÿè¯´çš„è¯ String girl = exchanger.exchange("æˆ‘å…¶å®æš—æ‹ä½ å¾ˆä¹…äº†......"); System.out.println("å¥³å­©å„¿è¯´ï¼š" + girl); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); service.execute(() -&gt; &#123; try &#123; System.out.println("å¥³ç”Ÿæ…¢æ…¢çš„ä»æ•™å®¤ä½ èµ°å‡ºæ¥......"); TimeUnit.SECONDS.sleep(3); //ç”·ç”Ÿå¯¹å¥³ç”Ÿè¯´çš„è¯ String boy = exchanger.exchange("æˆ‘ä¹Ÿå¾ˆå–œæ¬¢ä½ ......"); System.out.println("ç”·å­©å„¿è¯´ï¼š" + boy); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); &#125;&#125; 123å¥³ç”Ÿæ…¢æ…¢çš„ä»æ•™å®¤ä½ èµ°å‡ºæ¥......ç”·å­©å„¿è¯´ï¼šæˆ‘å…¶å®æš—æ‹ä½ å¾ˆä¹…äº†......å¥³å­©å„¿è¯´ï¼šæˆ‘ä¹Ÿå¾ˆå–œæ¬¢ä½ ...... ä¸¤å¥è¯äº¤æ¢äº†ï¼Œè¿™ä¸ªçœŸçš„ç‰›é€¼ï¼]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>å¹¶å‘å·¥å…·åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šçº¿ç¨‹ï¼ˆäº”ï¼‰--- FutureTask]]></title>
    <url>%2F2020%2F02%2F28%2F%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%88%E4%BA%94%EF%BC%89---%20FutureTask.html</url>
    <content type="text"><![CDATA[è½¬è‡ªï¼šhttp://www.ideabuffer.cn/2017/04/06/FutureTaskæºç è§£æ/ FutureTaskä»‹ç»FutureTaskæ˜¯ä¸€ç§å¯ä»¥å–æ¶ˆçš„å¼‚æ­¥çš„è®¡ç®—ä»»åŠ¡ã€‚å®ƒçš„è®¡ç®—æ˜¯é€šè¿‡Callableå®ç°çš„ï¼Œå¯ä»¥æŠŠå®ƒç†è§£ä¸ºæ˜¯å¯ä»¥è¿”å›ç»“æœçš„Runnableã€‚ ä½¿ç”¨FutureTaskçš„ä¼˜åŠ¿æœ‰ï¼š å¯ä»¥è·å–çº¿ç¨‹æ‰§è¡Œåçš„è¿”å›ç»“æœï¼› æä¾›äº†è¶…æ—¶æ§åˆ¶åŠŸèƒ½ã€‚ å®ƒå®ç°äº†Runnableæ¥å£å’ŒFutureæ¥å£ï¼š ä»€ä¹ˆæ˜¯å¼‚æ­¥è®¡ç®—å‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è®©è¯¥ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œä¸éœ€è¦ä¸€ç›´ç­‰å¾…å…¶è¿è¡Œç»“æŸè¿”å›ç»“æœï¼Œè€Œæ˜¯å¯ä»¥å…ˆå»å¤„ç†å…¶ä»–çš„äº‹æƒ…ï¼Œç„¶åå†è·å–è¿”å›ç»“æœã€‚ä¾‹å¦‚ä½ æƒ³ä¸‹è½½ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ï¼Œè¿™æ—¶å¾ˆè€—æ—¶çš„æ“ä½œï¼Œæ²¡å¿…è¦ä¸€ç›´ç­‰å¾…ç€æ–‡ä»¶ä¸‹è½½å®Œï¼Œä½ å¯ä»¥å…ˆå»åƒä¸ªé¥­ï¼Œç„¶åå†å›æ¥çœ‹ä¸‹æ–‡ä»¶æ˜¯å¦ä¸‹è½½å®Œæˆï¼Œå¦‚æœä¸‹è½½å®Œæˆå°±å¯ä»¥ä½¿ç”¨äº†ï¼Œå¦åˆ™è¿˜éœ€è¦ç»§ç»­ç­‰å¾…ã€‚ FutureTaskçš„å®ç°FutureTaskçš„çŠ¶æ€FutureTaskå†…éƒ¨æœ‰è¿™æ ·å‡ ç§çŠ¶æ€ï¼š 1234567private static final int NEW = 0;private static final int COMPLETING = 1;private static final int NORMAL = 2;private static final int EXCEPTIONAL = 3;private static final int CANCELLED = 4;private static final int INTERRUPTING = 5;private static final int INTERRUPTED = 6; çœ‹åå­—åº”è¯¥å¾ˆå¥½ç†è§£äº†ï¼Œå½“åˆ›å»ºä¸€ä¸ªFutureTaskå¯¹è±¡æ˜¯ï¼Œåˆå§‹çš„çŠ¶æ€æ˜¯NEWï¼Œåœ¨è¿è¡Œæ—¶çŠ¶æ€ä¼šè½¬æ¢ï¼Œæœ‰4ä¸­çŠ¶æ€çš„è½¬æ¢è¿‡ç¨‹ï¼š NEW -&gt; COMPLETING -&gt; NORMALï¼šæ­£å¸¸æ‰§è¡Œå¹¶è¿”å›ï¼› NEW -&gt; COMPLETING -&gt; EXCEPTIONALï¼šæ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ï¼› NEW -&gt; CANCELLEDï¼›æ‰§è¡Œå‰è¢«å–æ¶ˆï¼› NEW -&gt; INTERRUPTING -&gt; INTERRUPTEDï¼šå–æ¶ˆæ—¶è¢«ä¸­æ–­ã€‚ ä½¿ç”¨FutureTaskä¸‹é¢çœ‹ä¸€ä¸‹å…·ä½“çš„ä½¿ç”¨è¿‡ç¨‹ï¼š 123456789101112131415161718192021public class FutureTaskTest &#123; public static void main(String[] args) throws ExecutionException, InterruptedException &#123; ExecutorService executor = Executors.newSingleThreadExecutor(); FutureTask&lt;Integer&gt; future = new FutureTask&lt;&gt;(new Callable&lt;Integer&gt;() &#123; @Override public Integer call() throws Exception &#123; int result = 0; for (int i = 0; i &lt; 100; i++) &#123; result += i; &#125; return result; &#125; &#125;); executor.execute(future); System.out.println(future.get()); &#125;&#125; FutureTaskå†…éƒ¨ç»“æ„12345678910111213141516171819202122232425262728293031323334353637383940public class FutureTask&lt;V&gt; implements RunnableFuture&lt;V&gt; &#123; private volatile int state; private static final int NEW = 0; private static final int COMPLETING = 1; private static final int NORMAL = 2; private static final int EXCEPTIONAL = 3; private static final int CANCELLED = 4; private static final int INTERRUPTING = 5; private static final int INTERRUPTED = 6; /** The underlying callable; nulled out after running */ private Callable&lt;V&gt; callable; /** The result to return or exception to throw from get() */ private Object outcome; // non-volatile, protected by state reads/writes /** æ‰§è¡Œcallableçš„çº¿ç¨‹ **/ private volatile Thread runner; /** * Treiber stack of waiting threads * ä½¿ç”¨Treiberç®—æ³•å®ç°çš„æ— é˜»å¡çš„Stackï¼Œ * ç”¨äºå­˜æ”¾ç­‰å¾…çš„çº¿ç¨‹ */ private volatile WaitNode waiters; static final class WaitNode &#123; volatile Thread thread; volatile WaitNode next; WaitNode() &#123; thread = Thread.currentThread(); &#125; &#125; public V get() throws InterruptedException, ExecutionException &#123; ... &#125; public V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException &#123; ... &#125; ... è¿™é‡Œçš„waitersç†è§£ä¸ºä¸€ä¸ªstackï¼Œå› ä¸ºåœ¨è°ƒç”¨getæ–¹æ³•æ—¶ä»»åŠ¡å¯èƒ½è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œè¿™æ—¶éœ€è¦å°†è°ƒç”¨getæ–¹æ³•çš„çº¿ç¨‹æ”¾å…¥waitersä¸­ã€‚ æœ€é‡è¦çš„ä¸¤ä¸ªgetæ–¹æ³•ï¼Œç”¨äºè·å–è¿”å›ç»“æœï¼Œç¬¬äºŒç§æä¾›äº†è¶…æ—¶æ§åˆ¶åŠŸèƒ½ã€‚ FutureTaskæ„é€ æ–¹æ³•FutureTaskæœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼š 1234567891011public FutureTask(Callable&lt;V&gt; callable) &#123; if (callable == null) throw new NullPointerException(); this.callable = callable; this.state = NEW; // ensure visibility of callable&#125;public FutureTask(Runnable runnable, V result) &#123; this.callable = Executors.callable(runnable, result); this.state = NEW; // ensure visibility of callable&#125; ç¬¬äºŒç§æ„é€ æ–¹æ³•ä¼ å…¥ä¸€ä¸ªRunnableå¯¹è±¡å’Œä¸€ä¸ªè¿”å›å€¼å¯¹è±¡ï¼Œå› ä¸ºRunnableæ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼Œæ‰€ä»¥è¦é€šè¿‡resultå‚æ•°åœ¨æ‰§è¡Œå®Œä¹‹åè¿”å›ç»“æœã€‚ runæ–¹æ³•FutureTaskå®ç°äº†Runnableæ¥å£ï¼Œæ‰€ä»¥éœ€è¦å®ç°runæ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public void run() &#123; /* * é¦–å…ˆåˆ¤æ–­çŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯åˆå§‹çŠ¶æ€ï¼Œè¯´æ˜ä»»åŠ¡å·²ç»è¢«æ‰§è¡Œæˆ–å–æ¶ˆï¼› * runneræ˜¯FutureTaskçš„ä¸€ä¸ªå±æ€§ï¼Œç”¨äºä¿å­˜æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ï¼Œ * å¦‚æœä¸ä¸ºç©ºåˆ™è¡¨ç¤ºå·²ç»æœ‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œï¼Œè¿™é‡Œç”¨CASæ¥è®¾ç½®ï¼Œå¤±è´¥åˆ™è¿”å›ã€‚ */ if (state != NEW || !UNSAFE.compareAndSwapObject(this, runnerOffset, null, Thread.currentThread())) return; try &#123; Callable&lt;V&gt; c = callable; // åªæœ‰åˆå§‹çŠ¶æ€æ‰ä¼šæ‰§è¡Œ if (c != null &amp;&amp; state == NEW) &#123; V result; boolean ran; try &#123; // æ‰§è¡Œä»»åŠ¡ result = c.call(); // å¦‚æœæ²¡å‡ºç°å¼‚å¸¸ï¼Œåˆ™è¯´æ˜æ‰§è¡ŒæˆåŠŸäº† ran = true; &#125; catch (Throwable ex) &#123; result = null; ran = false; // è®¾ç½®å¼‚å¸¸ setException(ex); &#125; // å¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œåˆ™è®¾ç½®è¿”å›ç»“æœ if (ran) set(result); &#125; &#125; finally &#123; // runner must be non-null until state is settled to // prevent concurrent calls to run() // æ— è®ºæ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼ŒæŠŠrunnerè®¾ç½®ä¸ºnull runner = null; // state must be re-read after nulling runner to prevent // leaked interrupts int s = state; // å¦‚æœè¢«ä¸­æ–­ï¼Œåˆ™è¯´æ˜è°ƒç”¨çš„cancel(true)ï¼Œ // è¿™é‡Œè¦ä¿è¯åœ¨cancelæ–¹æ³•ä¸­æŠŠstateè®¾ç½®ä¸ºINTERRUPTED // å¦åˆ™å¯èƒ½åœ¨cancelæ–¹æ³•ä¸­è¿˜æ²¡æ‰§è¡Œä¸­æ–­ï¼Œé€ æˆä¸­æ–­çš„æ³„éœ² if (s &gt;= INTERRUPTING) handlePossibleCancellationInterrupt(s); &#125;&#125; æ€»ç»“ä¸€ä¸‹runæ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ åªæœ‰stateä¸ºNEWçš„æ—¶å€™æ‰æ‰§è¡Œä»»åŠ¡ï¼› æ‰§è¡Œå‰è¦è®¾ç½®runnerä¸ºå½“å‰çº¿ç¨‹ï¼Œä½¿ç”¨CASæ¥è®¾ç½®æ˜¯ä¸ºäº†é˜²æ­¢ç«äº‰ï¼› å¦‚æœä»»åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œä»»åŠ¡çŠ¶æ€ä»NEWè½¬æ¢ä¸ºCOMPLETINGï¼Œå¦‚æœæ‰§è¡Œæ­£å¸¸ï¼Œè®¾ç½®æœ€ç»ˆçŠ¶æ€ä¸ºNORMALï¼›å¦‚æœæ‰§è¡Œä¸­å‡ºç°äº†å¼‚å¸¸ï¼Œè®¾ç½®æœ€ç»ˆçŠ¶æ€ä¸ºEXCEPTIONALï¼› å”¤é†’å¹¶åˆ é™¤Treiber Stackä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼› å¦‚æœè°ƒç”¨äº†cancel(true)æ–¹æ³•è¿›è¡Œäº†ä¸­æ–­ï¼Œè¦ç¡®ä¿åœ¨runæ–¹æ³•æ‰§è¡Œç»“æŸå‰çš„çŠ¶æ€æ˜¯INTERRUPTEDã€‚ è¿™é‡Œæ¶‰åŠåˆ°3ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•ï¼šsetExceptionï¼Œsetå’ŒhandlePossibleCancellationInterruptã€‚ setExceptionæ–¹æ³•1234567protected void setException(Throwable t) &#123; if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) &#123; outcome = t; UNSAFE.putOrderedInt(this, stateOffset, EXCEPTIONAL); // final state finishCompletion(); &#125;&#125; å¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ˆä¹Ÿå°±æ˜¯è°ƒç”¨callæ–¹æ³•æ—¶ï¼‰å‡ºç°äº†å¼‚å¸¸ï¼Œåˆ™è¦æŠŠçŠ¶æ€å…ˆè®¾ç½®ä¸ºCOMPLETINGï¼Œå¦‚æœæˆåŠŸï¼Œè®¾ç½®outcome = tï¼Œoutcomeå¯¹è±¡æ˜¯Objectç±»å‹çš„ï¼Œç”¨æ¥ä¿å­˜å¼‚å¸¸æˆ–è€…è¿”å›ç»“æœå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ­£å¸¸çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ˆæ²¡æœ‰å¼‚å¸¸ï¼Œæ²¡æœ‰è°ƒç”¨cancelæ–¹æ³•ï¼‰ï¼Œoutcomeä¿å­˜ç€è¿”å›ç»“æœå¯¹è±¡ï¼Œä¼šè¢«è¿”å›ï¼Œå¦‚æœå‡ºç°äº†å¼‚å¸¸æˆ–è€…ä¸­æ–­ï¼Œåˆ™ä¸ä¼šè¿”å›å¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™ä¸ªåœ¨ä»‹ç»reportæ–¹æ³•æ—¶ä¼šè®²åˆ°ã€‚ æ¥ç€è®¾ç½®çŠ¶æ€ä¸ºEXCEPTIONALï¼Œè¿™ä¹Ÿæ˜¯æœ€ç»ˆçš„çŠ¶æ€ã€‚ finishCompletionæ–¹æ³•ç¨åå†åˆ†æã€‚ setæ–¹æ³•1234567protected void set(V v) &#123; if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) &#123; outcome = v; UNSAFE.putOrderedInt(this, stateOffset, NORMAL); // final state finishCompletion(); &#125;&#125; å¾ˆç®€å•ï¼Œä¸setExceptionç±»ä¼¼ï¼Œåªä¸è¿‡è¿™é‡Œçš„outcomeæ˜¯è¿”å›ç»“æœå¯¹è±¡ï¼ŒçŠ¶æ€å…ˆè®¾ç½®ä¸ºCOMPLETINGï¼Œç„¶åå†è®¾ç½®ä¸ºMORMALã€‚ handlePossibleCancellationInterruptæ–¹æ³•1234567891011121314151617private void handlePossibleCancellationInterrupt(int s) &#123; // It is possible for our interrupter to stall before getting a // chance to interrupt us. Let's spin-wait patiently. if (s == INTERRUPTING) while (state == INTERRUPTING) Thread.yield(); // wait out pending interrupt // assert state == INTERRUPTED; // We want to clear any interrupt we may have received from // cancel(true). However, it is permissible to use interrupts // as an independent mechanism for a task to communicate with // its caller, and there is no way to clear only the // cancellation interrupt. // // Thread.interrupted();&#125; handlePossibleCancellationInterruptæ–¹æ³•è¦ç¡®ä¿cancel(true)äº§ç”Ÿçš„ä¸­æ–­å‘ç”Ÿåœ¨runæˆ–runAndResetæ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ã€‚è¿™é‡Œä¼šå¾ªç¯çš„è°ƒç”¨Thread.yield()æ¥ç¡®ä¿çŠ¶æ€åœ¨cancelæ–¹æ³•ä¸­è¢«è®¾ç½®ä¸ºINTERRUPTEDã€‚ è¿™é‡Œä¸èƒ½å¤Ÿæ¸…é™¤ä¸­æ–­æ ‡è®°ï¼Œå› ä¸ºä¸èƒ½ç¡®å®šä¸­æ–­ä¸€å®šæ¥è‡ªäºcancelæ–¹æ³•ã€‚ finishCompletionæ–¹æ³•12345678910111213141516171819202122232425262728293031private void finishCompletion() &#123; // assert state &gt; COMPLETING; // æ‰§è¡Œè¯¥æ–¹æ³•æ—¶stateå¿…é¡»å¤§äºCOMPLETING // é€ä¸ªå”¤é†’waitersä¸­çš„çº¿ç¨‹ for (WaitNode q; (q = waiters) != null;) &#123; // è®¾ç½®æ ˆé¡¶èŠ‚ç‚¹ä¸ºnull if (UNSAFE.compareAndSwapObject(this, waitersOffset, q, null)) &#123; for (;;) &#123; Thread t = q.thread; // å”¤é†’çº¿ç¨‹ if (t != null) &#123; q.thread = null; LockSupport.unpark(t); &#125; // å¦‚æœnextä¸ºç©ºï¼Œè¯´æ˜æ ˆç©ºäº†ï¼Œè·³å‡ºå¾ªç¯ WaitNode next = q.next; if (next == null) break; // æ–¹ä¾¿gcå›æ”¶ q.next = null; // unlink to help gc // é‡æ–°è®¾ç½®æ ˆé¡¶node q = next; &#125; break; &#125; &#125; // é’©å­æ–¹æ³• done(); callable = null; // to reduce footprint&#125; åœ¨è°ƒç”¨getæ–¹æ³•æ—¶ï¼Œå¦‚æœä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œç»“æŸï¼Œåˆ™ä¼šé˜»å¡è°ƒç”¨çš„çº¿ç¨‹ï¼Œç„¶åæŠŠè°ƒç”¨çš„çº¿ç¨‹æ”¾å…¥waitersä¸­ï¼Œè¿™æ—¶ï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨äº†finishCompletionæ–¹æ³•ï¼Œwaitersä¼šä¾æ¬¡å‡ºæ ˆå¹¶é€ä¸ªå”¤é†’å¯¹åº”çš„çº¿ç¨‹ã€‚ ç”±æ­¤å¯ä»¥æƒ³åˆ°ï¼ŒWaitNodeä¸€å®šæ˜¯åœ¨getæ–¹æ³•ä¸­è¢«æ·»åŠ åˆ°æ ˆä¸­çš„ï¼Œä¸‹é¢æ¥çœ‹ä¸‹getæ–¹æ³•çš„å®ç°ã€‚ getæ–¹æ³•1234567891011121314151617public V get() throws InterruptedException, ExecutionException &#123; int s = state; if (s &lt;= COMPLETING) s = awaitDone(false, 0L); return report(s);&#125;public V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException &#123; if (unit == null) throw new NullPointerException(); int s = state; if (s &lt;= COMPLETING &amp;&amp; (s = awaitDone(true, unit.toNanos(timeout))) &lt;= COMPLETING) throw new TimeoutException(); return report(s);&#125; è¿™ä¸¤ä¸ªæ–¹æ³•ç±»ä¼¼ï¼Œé¦–å…ˆåˆ¤æ–­çŠ¶æ€ï¼Œå¦‚æœs &lt;= COMPLETINGï¼Œè¯´æ˜è¿˜æ˜¯æœªå®Œæˆçš„çŠ¶æ€ã€Œä¸Šæ–‡æœ‰è®²åªæœ‰å½“çŠ¶æ€å˜ä¸º normal/exceptional/interrupted/cancelled æ‰ç®—ç»“æŸã€ï¼Œè¿™æ—¶éœ€è¦å°†å½“å‰çº¿ç¨‹æ·»åŠ åˆ°waitersä¸­å¹¶é˜»å¡ã€‚ ç¬¬äºŒç§getæä¾›äº†è¶…æ—¶åŠŸèƒ½ï¼Œå¦‚æœåœ¨è§„å®šæ—¶é—´å†…ä»»åŠ¡è¿˜æœªæ‰§è¡Œå®Œæ¯•æˆ–è€…çŠ¶æ€è¿˜æ˜¯COMPLETINGï¼Œåˆ™è·å–ç»“æœè¶…æ—¶ï¼ŒæŠ›å‡ºTimeoutExceptionã€‚è€Œç¬¬ä¸€ç§getä¼šä¸€ç›´é˜»å¡ç›´åˆ°state &gt; COMPLETINGã€‚ awaitDoneæ–¹æ³•awaitDoneæ–¹æ³•çš„å·¥ä½œæ˜¯æ ¹æ®çŠ¶æ€æ¥åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿè¿”å›ç»“æœï¼Œå¦‚æœä»»åŠ¡è¿˜æœªè®¾ç½®ä¸ºæœ€ç»ˆçŠ¶æ€ï¼Œè¦æ·»åŠ åˆ°waitersä¸­å¹¶é˜»å¡ï¼Œå¦åˆ™è¿”å›çŠ¶æ€ã€‚ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647private int awaitDone(boolean timed, long nanos) throws InterruptedException &#123; // è®¡ç®—åˆ°æœŸæ—¶é—´ final long deadline = timed ? System.nanoTime() + nanos : 0L; WaitNode q = null; boolean queued = false; for (;;) &#123; // å¦‚æœè¢«ä¸­æ–­ï¼Œåˆ é™¤èŠ‚ç‚¹ï¼ŒæŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) &#123; removeWaiter(q); throw new InterruptedException(); &#125; int s = state; // å¦‚æœä»»åŠ¡æ‰§è¡Œå®Œæ¯•å¹¶ä¸”è®¾ç½®äº†æœ€ç»ˆçŠ¶æ€æˆ–è€…è¢«å–æ¶ˆï¼Œåˆ™è¿”å› if (s &gt; COMPLETING) &#123; if (q != null) q.thread = null; return s; &#125; // s == COMPLETINGæ—¶é€šè¿‡Thread.yield();è®©æ­¥å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œ // ä¸»è¦æ˜¯ä¸ºäº†è®©çŠ¶æ€æ”¹å˜ else if (s == COMPLETING) // cannot time out yet Thread.yield(); // åˆ›å»ºä¸€ä¸ªWaitNode else if (q == null) q = new WaitNode(); // CASè®¾ç½®æ ˆé¡¶èŠ‚ç‚¹ else if (!queued) queued = UNSAFE.compareAndSwapObject(this, waitersOffset, q.next = waiters, q); // å¦‚æœè®¾ç½®äº†è¶…æ—¶ï¼Œåˆ™è®¡ç®—æ˜¯å¦å·²ç»åˆ°äº†å¼€å§‹è®¾ç½®çš„åˆ°æœŸæ—¶é—´ else if (timed) &#123; nanos = deadline - System.nanoTime(); // å¦‚æœå·²ç»åˆ°äº†åˆ°æœŸæ—¶é—´ï¼Œåˆ é™¤èŠ‚ç‚¹ï¼Œè¿”å›çŠ¶æ€ if (nanos &lt;= 0L) &#123; removeWaiter(q); return state; &#125; // é˜»å¡åˆ°åˆ°æœŸæ—¶é—´ LockSupport.parkNanos(this, nanos); &#125; // å¦‚æœæ²¡æœ‰è®¾ç½®è¶…æ—¶ï¼Œä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°è¢«ä¸­æ–­æˆ–è€…è¢«å”¤é†’ else LockSupport.park(this); &#125;&#125; removeWaiteræ–¹æ³•12345678910111213141516171819202122232425262728293031private void removeWaiter(WaitNode node) &#123; if (node != null) &#123; // å°†threadè®¾ç½®ä¸ºnullæ˜¯å› ä¸ºä¸‹é¢è¦æ ¹æ®threadæ˜¯å¦ä¸ºnullåˆ¤æ–­æ˜¯å¦è¦æŠŠnodeç§»å‡º node.thread = null; // è¿™é‡Œè‡ªæ—‹ä¿è¯åˆ é™¤æˆåŠŸ retry: for (;;) &#123; // restart on removeWaiter race for (WaitNode pred = null, q = waiters, s; q != null; q = s) &#123; s = q.next; // q.thread != nullè¯´æ˜è¯¥qèŠ‚ç‚¹ä¸éœ€è¦ç§»é™¤ if (q.thread != null) pred = q; // å¦‚æœq.thread == nullï¼Œä¸”pred != nullï¼Œéœ€è¦åˆ é™¤qèŠ‚ç‚¹ else if (pred != null) &#123; // åˆ é™¤qèŠ‚ç‚¹ pred.next = s; // pred.thread == nullæ—¶è¯´æ˜åœ¨å¹¶å‘æƒ…å†µä¸‹è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†ï¼› // è¿”å›ç¬¬ä¸€ä¸ªforå¾ªç¯é‡è¯• if (pred.thread == null) // check for race continue retry; &#125; // å¦‚æœq.thread != nullä¸”pred == nullï¼Œè¯´æ˜qæ˜¯æ ˆé¡¶èŠ‚ç‚¹ // è®¾ç½®æ ˆé¡¶å…ƒç´ ä¸ºsèŠ‚ç‚¹ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å›é‡è¯• else if (!UNSAFE.compareAndSwapObject(this, waitersOffset, q, s)) continue retry; &#125; break; &#125; &#125;&#125; cancelæ–¹æ³•cancelæ–¹æ³•ç”¨äºå–æ¶ˆä»»åŠ¡ï¼Œè¿™é‡Œå¯èƒ½æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯ä»»åŠ¡å·²ç»æ‰§è¡Œäº†ï¼Œå¦ä¸€ç§æ˜¯è¿˜æœªæ‰§è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324public boolean cancel(boolean mayInterruptIfRunning) &#123; if (!(state == NEW &amp;&amp; UNSAFE.compareAndSwapInt(this, stateOffset, NEW, mayInterruptIfRunning ? INTERRUPTING : CANCELLED))) return false; try &#123; // in case call to interrupt throws exception // mayInterruptIfRunningå‚æ•°è¡¨ç¤ºæ˜¯å¦è¦è¿›è¡Œä¸­æ–­ if (mayInterruptIfRunning) &#123; try &#123; // runnerä¿å­˜ç€å½“å‰æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ Thread t = runner; // ä¸­æ–­çº¿ç¨‹ if (t != null) t.interrupt(); &#125; finally &#123; // final state // è®¾ç½®æœ€ç»ˆçŠ¶æ€ä¸ºINTERRUPTED UNSAFE.putOrderedInt(this, stateOffset, INTERRUPTED); &#125; &#125; &#125; finally &#123; finishCompletion(); &#125; return true;&#125; ç¬¬ä¸€ä¸ªifåˆ¤æ–­å¯èƒ½æœ‰äº›ä¸å¥½ç†è§£ï¼Œå…¶å®ç­‰ä»·äºå¦‚ä¸‹ä»£ç ï¼š 123if (!state == NEW || !UNSAFE.compareAndSwapInt(this, stateOffset, NEW, mayInterruptIfRunning ? INTERRUPTING : CANCELLED)) å¦‚æœçŠ¶æ€ä¸æ˜¯NEWï¼Œæˆ–è€…è®¾ç½®çŠ¶æ€ä¸ºINTERRUPTINGæˆ–CANCELLEDå¤±è´¥ï¼Œåˆ™å–æ¶ˆå¤±è´¥ï¼Œè¿”å›falseã€‚ ç®€å•æ¥è¯´æœ‰ä¸€ä¸‹ä¸¤ç§æƒ…å†µï¼š å¦‚æœå½“å‰ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œé‚£ä¹ˆstate == NEWï¼Œé‚£ä¹ˆä¼šå°è¯•è®¾ç½®çŠ¶æ€ï¼Œå¦‚æœè®¾ç½®çŠ¶æ€å¤±è´¥ä¼šè¿”å›falseï¼Œè¡¨ç¤ºå–æ¶ˆå¤±è´¥ï¼› å¦‚æœå½“å‰ä»»åŠ¡å·²ç»è¢«æ‰§è¡Œäº†ï¼Œé‚£ä¹ˆstate &gt; NEWï¼Œä¹Ÿå°±æ˜¯!state == NEWä¸ºtrueï¼Œç›´æ¥è¿”å›falseã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä»»åŠ¡ä¸€æ—¦ï¼ˆstate != NEWï¼‰ï¼Œæ„å‘³ç€å…¶å®ä»»åŠ¡å·²ç»æ‰§è¡Œå®Œäº†ï¼Œåªæ˜¯è¿˜åœ¨è¿”å›ç»“æœï¼Œé‚£ä¹ˆå°±ä¸èƒ½è¢«å–æ¶ˆã€‚å¦‚æœmayInterruptIfRunningä¸ºtrueï¼Œè¦ä¸­æ–­å½“å‰æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ã€‚ reportæ–¹æ³•getæ–¹æ³•åœ¨è°ƒç”¨awaitDoneæ–¹æ³•åï¼Œä¼šè°ƒç”¨reportæ–¹æ³•è¿›è¡Œè¿”å›ï¼š 12345678private V report(int s) throws ExecutionException &#123; Object x = outcome; if (s == NORMAL) return (V)x; if (s &gt;= CANCELLED) throw new CancellationException(); throw new ExecutionException((Throwable)x);&#125; å¾ˆç®€å•ï¼Œå¯ä»¥çœ‹åˆ°æœ‰3ä¸­æ‰§è¡Œæƒ…å†µï¼š å¦‚æœs == NORMALä¸ºtrueï¼Œè¯´æ˜æ˜¯æ­£å¸¸æ‰§è¡Œç»“æŸï¼Œé‚£ä¹ˆæ ¹æ®ä¸Šè¿°çš„åˆ†æï¼Œåœ¨æ­£å¸¸æ‰§è¡Œç»“æŸæ—¶outcomeå­˜æ”¾çš„æ˜¯è¿”å›ç»“æœï¼ŒæŠŠoutcomeè¿”å›ï¼› å¦‚æœs &gt;= CANCELLEDä¸ºtrueï¼Œè¯´æ˜æ˜¯è¢«å–æ¶ˆäº†ï¼ŒæŠ›å‡ºCancellationExceptionï¼› å¦‚æœs &lt; CANCELLEDï¼Œé‚£ä¹ˆçŠ¶æ€åªèƒ½æ˜¯æ˜¯EXCEPTIONALï¼Œè¡¨ç¤ºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ï¼ŒæŠ›å‡ºExecutionExceptionã€‚ runAndResetæ–¹æ³•è¯¥æ–¹æ³•å’Œrunæ–¹æ³•ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºè¿™ä¸ªæ–¹æ³•ä¸ä¼šè®¾ç½®ä»»åŠ¡çš„æ‰§è¡Œç»“æœå€¼ï¼Œæ‰€ä»¥åœ¨æ­£å¸¸æ‰§è¡Œæ—¶ï¼Œä¸ä¼šä¿®æ”¹stateï¼Œé™¤éå‘ç”Ÿäº†å¼‚å¸¸æˆ–è€…ä¸­æ–­ï¼Œæœ€åè¿”å›æ˜¯å¦æ­£ç¡®çš„æ‰§è¡Œå¹¶å¤ä½ï¼š 12345678910111213141516171819202122232425262728293031protected boolean runAndReset() &#123; if (state != NEW || !UNSAFE.compareAndSwapObject(this, runnerOffset, null, Thread.currentThread())) return false; boolean ran = false; int s = state; try &#123; Callable&lt;V&gt; c = callable; if (c != null &amp;&amp; s == NEW) &#123; try &#123; // ä¸è·å–å’Œè®¾ç½®è¿”å›å€¼ c.call(); // don't set result ran = true; &#125; catch (Throwable ex) &#123; setException(ex); &#125; &#125; &#125; finally &#123; // runner must be non-null until state is settled to // prevent concurrent calls to run() runner = null; // state must be re-read after nulling runner to prevent // leaked interrupts s = state; if (s &gt;= INTERRUPTING) handlePossibleCancellationInterrupt(s); &#125; // æ˜¯å¦æ­£ç¡®çš„æ‰§è¡Œå¹¶å¤ä½ return ran &amp;&amp; s == NEW;&#125; æ€»ç»“æœ¬æ–‡åˆ†æäº†FutureTaskçš„æ‰§è¡Œè¿‡ç¨‹å’Œè·å–è¿”å›å€¼çš„è¿‡ç¨‹ï¼Œè¦æ³¨æ„ä»¥ä¸‹å‡ ä¸ªåœ°æ–¹ï¼š FutureTaskæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å¤šçº¿ç¨‹ä¸‹ä»»åŠ¡ä¹Ÿåªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼› æ³¨æ„åœ¨æ‰§è¡Œæ—¶å„ç§çŠ¶æ€çš„åˆ‡æ¢ï¼› getæ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¦‚æœä»»åŠ¡æ²¡æœ‰ç»“æŸï¼Œè¦é˜»å¡å½“å‰çº¿ç¨‹ï¼Œè¢«é˜»å¡çš„çº¿ç¨‹ä¼šä¿å­˜åœ¨ä¸€ä¸ªTreiber Stackä¸­ï¼› getæ–¹æ³•è¶…æ—¶åŠŸèƒ½å¦‚æœè¶…æ—¶æœªè·å–æˆåŠŸï¼Œä¼šæŠ›å‡ºTimeoutExceptionï¼› æ³¨æ„åœ¨å–æ¶ˆæ—¶çš„çº¿ç¨‹ä¸­æ–­ï¼Œåœ¨runæ–¹æ³•ä¸­ä¸€å®šè¦ä¿è¯ç»“æŸæ—¶çš„çŠ¶æ€æ˜¯INTERRUPTEDï¼Œå¦åˆ™åœ¨cancelæ–¹æ³•ä¸­å¯èƒ½æ²¡æœ‰æ‰§è¡Œinterruptï¼Œé€ æˆä¸­æ–­çš„æ³„éœ²ã€‚]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>FutureTask</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šçº¿ç¨‹ï¼ˆå››ï¼‰--- çº¿ç¨‹æ± ]]></title>
    <url>%2F2020%2F02%2F28%2F%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89---%20%E7%BA%BF%E7%A8%8B%E6%B1%A0.html</url>
    <content type="text"><![CDATA[æ·±å…¥ç†è§£Javaçº¿ç¨‹æ± ï¼šThreadPoolExecutor ps:ä¸è¿‡è¯´å®è¯ï¼Œå†™çš„è´¥ç¬”å°±æ˜¯çº¿ç¨‹çŠ¶æ€è½¬æ¢é‚£ä¸€å—~ ç®€ç•¥ä»‹ç»çº¿ç¨‹æ±  è½¬ï¼šhttp://www.ideabuffer.cn/2017/04/04/æ·±å…¥ç†è§£Javaçº¿ç¨‹æ± ï¼šThreadPoolExecutor/#addWorkeræ–¹æ³• çº¿ç¨‹æ± ï¼ˆä¸€ï¼‰ï¼šThreadPoolExecutorçº¿ç¨‹æ± ä»‹ç»åœ¨webå¼€å‘ä¸­ï¼ŒæœåŠ¡å™¨éœ€è¦æ¥å—å¹¶å¤„ç†è¯·æ±‚ï¼Œæ‰€ä»¥ä¼šä¸ºä¸€ä¸ªè¯·æ±‚æ¥åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ¥è¿›è¡Œå¤„ç†ã€‚å¦‚æœæ¯æ¬¡è¯·æ±‚éƒ½æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„è¯å®ç°èµ·æ¥éå¸¸ç®€ä¾¿ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š å¦‚æœå¹¶å‘çš„è¯·æ±‚æ•°é‡éå¸¸å¤šï¼Œä½†æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´å¾ˆçŸ­ï¼Œè¿™æ ·å°±ä¼šé¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œå¦‚æ­¤ä¸€æ¥ä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„æ•ˆç‡ã€‚å¯èƒ½å‡ºç°æœåŠ¡å™¨åœ¨ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºæ–°çº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹ä¸ŠèŠ±è´¹çš„æ—¶é—´å’Œæ¶ˆè€—çš„ç³»ç»Ÿèµ„æºè¦æ¯”å¤„ç†å®é™…çš„ç”¨æˆ·è¯·æ±‚çš„æ—¶é—´å’Œèµ„æºæ›´å¤šã€‚ é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ä½¿æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸è¢«é”€æ¯ï¼Œè€Œæ˜¯å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡å‘¢ï¼Ÿ è¿™å°±æ˜¯çº¿ç¨‹æ± çš„ç›®çš„äº†ã€‚çº¿ç¨‹æ± ä¸ºçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„å¼€é”€å’Œèµ„æºä¸è¶³é—®é¢˜æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡å¯¹å¤šä¸ªä»»åŠ¡é‡ç”¨çº¿ç¨‹ï¼Œçº¿ç¨‹åˆ›å»ºçš„å¼€é”€è¢«åˆ†æ‘Šåˆ°äº†å¤šä¸ªä»»åŠ¡ä¸Šã€‚ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ å•ä¸ªä»»åŠ¡å¤„ç†æ—¶é—´æ¯”è¾ƒçŸ­ éœ€è¦å¤„ç†çš„ä»»åŠ¡æ•°é‡å¾ˆå¤§ ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ å¼•ç”¨è‡ª http://ifeve.com/java-threadpool/ çš„è¯´æ˜ï¼š é™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚ æé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦çš„ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚ æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚ Javaä¸­çš„çº¿ç¨‹æ± æ˜¯ç”¨ThreadPoolExecutorç±»æ¥å®ç°çš„. æœ¬æ–‡å°±ç»“åˆJDK 1.8å¯¹è¯¥ç±»çš„æºç æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªç±»å†…éƒ¨å¯¹äºçº¿ç¨‹çš„åˆ›å»º, ç®¡ç†ä»¥åŠåå°ä»»åŠ¡çš„è°ƒåº¦ç­‰æ–¹é¢çš„æ‰§è¡ŒåŸç†ã€‚ å…ˆçœ‹ä¸€ä¸‹çº¿ç¨‹æ± çš„ç±»å›¾ï¼š Executoræ¡†æ¶æ¥å£Executoræ¡†æ¶æ˜¯ä¸€ä¸ªæ ¹æ®ä¸€ç»„æ‰§è¡Œç­–ç•¥è°ƒç”¨ï¼Œè°ƒåº¦ï¼Œæ‰§è¡Œå’Œæ§åˆ¶çš„å¼‚æ­¥ä»»åŠ¡çš„æ¡†æ¶ï¼Œç›®çš„æ˜¯æä¾›ä¸€ç§å°†â€ä»»åŠ¡æäº¤â€ä¸â€ä»»åŠ¡å¦‚ä½•è¿è¡Œâ€åˆ†ç¦»å¼€æ¥çš„æœºåˆ¶ã€‚ J.U.Cä¸­æœ‰ä¸‰ä¸ªExecutoræ¥å£ï¼š Executorï¼šä¸€ä¸ªè¿è¡Œæ–°ä»»åŠ¡çš„ç®€å•æ¥å£ï¼› ExecutorServiceï¼šæ‰©å±•äº†Executoræ¥å£ã€‚æ·»åŠ äº†ä¸€äº›ç”¨æ¥ç®¡ç†æ‰§è¡Œå™¨ç”Ÿå‘½å‘¨æœŸå’Œä»»åŠ¡ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼› ScheduledExecutorServiceï¼šæ‰©å±•äº†ExecutorServiceã€‚æ”¯æŒFutureå’Œå®šæœŸæ‰§è¡Œä»»åŠ¡ã€‚ Executoræ¥å£123public interface Executor &#123; void execute(Runnable command);&#125; Executoræ¥å£åªæœ‰ä¸€ä¸ªexecuteæ–¹æ³•ï¼Œç”¨æ¥æ›¿ä»£é€šå¸¸åˆ›å»ºæˆ–å¯åŠ¨çº¿ç¨‹çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨Threadæ¥åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹çš„ä»£ç å¦‚ä¸‹ï¼š 12Thread t = new Thread();t.start(); ä½¿ç”¨Executoræ¥å¯åŠ¨çº¿ç¨‹æ‰§è¡Œä»»åŠ¡çš„ä»£ç å¦‚ä¸‹ï¼š 12Thread t = new Thread();executor.execute(t); å¯¹äºä¸åŒçš„Executorå®ç°ï¼Œexecute()æ–¹æ³•å¯èƒ½æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹å¹¶ç«‹å³å¯åŠ¨ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä½¿ç”¨å·²æœ‰çš„å·¥ä½œçº¿ç¨‹æ¥è¿è¡Œä¼ å…¥çš„ä»»åŠ¡ï¼Œä¹Ÿå¯èƒ½æ˜¯æ ¹æ®è®¾ç½®çº¿ç¨‹æ± çš„å®¹é‡æˆ–è€…é˜»å¡é˜Ÿåˆ—çš„å®¹é‡æ¥å†³å®šæ˜¯å¦è¦å°†ä¼ å…¥çš„çº¿ç¨‹æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­æˆ–è€…æ‹’ç»æ¥æ”¶ä¼ å…¥çš„çº¿ç¨‹ã€‚ ExecutorServiceæ¥å£ExecutorServiceæ¥å£ç»§æ‰¿è‡ªExecutoræ¥å£ï¼Œæä¾›äº†ç®¡ç†ç»ˆæ­¢çš„æ–¹æ³•ï¼Œä»¥åŠå¯ä¸ºè·Ÿè¸ªä¸€ä¸ªæˆ–å¤šä¸ªå¼‚æ­¥ä»»åŠ¡æ‰§è¡ŒçŠ¶å†µè€Œç”Ÿæˆ Future çš„æ–¹æ³•ã€‚å¢åŠ äº†shutDown()ï¼ŒshutDownNow()ï¼ŒinvokeAll()ï¼ŒinvokeAny()å’Œsubmit()ç­‰æ–¹æ³•ã€‚å¦‚æœéœ€è¦æ”¯æŒå³æ—¶å…³é—­ï¼Œä¹Ÿå°±æ˜¯shutDownNow()æ–¹æ³•ï¼Œåˆ™ä»»åŠ¡éœ€è¦æ­£ç¡®å¤„ç†ä¸­æ–­ã€‚ ScheduledExecutorServiceæ¥å£ScheduledExecutorServiceæ‰©å±•ExecutorServiceæ¥å£å¹¶å¢åŠ äº†scheduleæ–¹æ³•ã€‚è°ƒç”¨scheduleæ–¹æ³•å¯ä»¥åœ¨æŒ‡å®šçš„å»¶æ—¶åæ‰§è¡Œä¸€ä¸ªRunnableæˆ–è€…Callableä»»åŠ¡ã€‚ScheduledExecutorServiceæ¥å£è¿˜å®šä¹‰äº†æŒ‰ç…§æŒ‡å®šæ—¶é—´é—´éš”å®šæœŸæ‰§è¡Œä»»åŠ¡çš„scheduleAtFixedRate()æ–¹æ³•å’ŒscheduleWithFixedDelay()æ–¹æ³•ã€‚ ThreadPoolExecutoråˆ†æThreadPoolExecutorç»§æ‰¿è‡ªAbstractExecutorServiceï¼Œä¹Ÿæ˜¯å®ç°äº†ExecutorServiceæ¥å£ã€‚ å‡ ä¸ªé‡è¦çš„å­—æ®µ12345678910private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));private static final int COUNT_BITS = Integer.SIZE - 3;private static final int CAPACITY = (1 &lt;&lt; COUNT_BITS) - 1;// runState is stored in the high-order bitsprivate static final int RUNNING = -1 &lt;&lt; COUNT_BITS;private static final int SHUTDOWN = 0 &lt;&lt; COUNT_BITS;private static final int STOP = 1 &lt;&lt; COUNT_BITS;private static final int TIDYING = 2 &lt;&lt; COUNT_BITS;private static final int TERMINATED = 3 &lt;&lt; COUNT_BITS; ctlæ˜¯å¯¹çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€å’Œçº¿ç¨‹æ± ä¸­æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡è¿›è¡Œæ§åˆ¶çš„ä¸€ä¸ªå­—æ®µï¼Œ å®ƒåŒ…å«ä¸¤éƒ¨åˆ†çš„ä¿¡æ¯: çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ (runState) å’Œçº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ (workerCount)ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨äº†Integerç±»å‹æ¥ä¿å­˜ï¼Œé«˜3ä½ä¿å­˜runStateï¼Œä½29ä½ä¿å­˜workerCountã€‚COUNT_BITS å°±æ˜¯29ï¼ŒCAPACITYå°±æ˜¯1å·¦ç§»29ä½å‡1ï¼ˆ29ä¸ª1ï¼‰ï¼Œè¿™ä¸ªå¸¸é‡è¡¨ç¤ºworkerCountçš„ä¸Šé™å€¼ï¼Œå¤§çº¦æ˜¯5äº¿ã€‚ ä¸‹é¢å†ä»‹ç»ä¸‹çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€. çº¿ç¨‹æ± ä¸€å…±æœ‰äº”ç§çŠ¶æ€, åˆ†åˆ«æ˜¯: RUNNING ï¼šèƒ½æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼› SHUTDOWNï¼šå…³é—­çŠ¶æ€ï¼Œä¸å†æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†å´å¯ä»¥ç»§ç»­å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­å·²ä¿å­˜çš„ä»»åŠ¡ã€‚åœ¨çº¿ç¨‹æ± å¤„äº RUNNING çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ shutdown()æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€ã€‚ï¼ˆfinalize() æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¹Ÿä¼šè°ƒç”¨shutdown()æ–¹æ³•è¿›å…¥è¯¥çŠ¶æ€ï¼‰ï¼›ã€Œæ³¨æ„shutdownå¯èƒ½ä¼šå‡ºç°æœ‰çº¿ç¨‹æ­£åœ¨ç­‰é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¿‡æ¥ï¼Œä½†æ˜¯çªç„¶shutdownï¼Œä¸ä¼šæœ‰ä»»åŠ¡å†æ¥äº†ï¼Œé‚£çº¿ç¨‹å°±ä¼šä¸€ç›´é˜»å¡ï¼Œå¯¼è‡´æ— æ³•å›æ”¶ï¼Œæ‰€ä»¥ shutdown()æ–¹æ³•ä¸­æœ‰è°ƒç”¨interruptIdleWorkers()ã€‚ã€ STOPï¼šä¸èƒ½æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œä¼šä¸­æ–­æ­£åœ¨å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ã€‚åœ¨çº¿ç¨‹æ± å¤„äº RUNNING æˆ– SHUTDOWN çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ shutdownNow() æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€ï¼› TIDYINGï¼šå¦‚æœæ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»ˆæ­¢äº†ï¼ŒworkerCount (æœ‰æ•ˆçº¿ç¨‹æ•°) ä¸º0ï¼Œçº¿ç¨‹æ± è¿›å…¥è¯¥çŠ¶æ€åä¼šè°ƒç”¨ terminated() æ–¹æ³•è¿›å…¥TERMINATED çŠ¶æ€ã€‚ TERMINATEDï¼šåœ¨terminated() æ–¹æ³•æ‰§è¡Œå®Œåè¿›å…¥è¯¥çŠ¶æ€ï¼Œé»˜è®¤terminated()æ–¹æ³•ä¸­ä»€ä¹ˆä¹Ÿæ²¡æœ‰åšã€‚ çº¿ç¨‹æ± ä¸æ˜¯RUNNINGçŠ¶æ€ï¼› çº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯TIDYINGçŠ¶æ€æˆ–TERMINATEDçŠ¶æ€ï¼› å¦‚æœçº¿ç¨‹æ± çŠ¶æ€æ˜¯SHUTDOWNå¹¶ä¸”workerQueueä¸ºç©ºï¼› workerCountä¸º0ï¼› è®¾ç½®TIDYINGçŠ¶æ€æˆåŠŸã€‚ ä¸‹å›¾ä¸ºçº¿ç¨‹æ± çš„çŠ¶æ€è½¬æ¢è¿‡ç¨‹ï¼š ctlç›¸å…³æ–¹æ³•è¿™é‡Œè¿˜æœ‰å‡ ä¸ªå¯¹ctlè¿›è¡Œè®¡ç®—çš„æ–¹æ³•ï¼š 123private static int runStateOf(int c) &#123; return c &amp; ~CAPACITY; &#125;private static int workerCountOf(int c) &#123; return c &amp; CAPACITY; &#125;private static int ctlOf(int rs, int wc) &#123; return rs | wc; &#125; runStateOfï¼šè·å–è¿è¡ŒçŠ¶æ€ï¼› workerCountOfï¼šè·å–æ´»åŠ¨çº¿ç¨‹æ•°ï¼› ctlOfï¼šè·å–è¿è¡ŒçŠ¶æ€å’Œæ´»åŠ¨çº¿ç¨‹æ•°çš„å€¼ã€‚ ThreadPoolExecutoræ„é€ æ–¹æ³•123456789101112131415161718192021public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) &#123; if (corePoolSize &lt; 0 || maximumPoolSize &lt;= 0 || maximumPoolSize &lt; corePoolSize || keepAliveTime &lt; 0) throw new IllegalArgumentException(); if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime); this.threadFactory = threadFactory; this.handler = handler;&#125; æ„é€ æ–¹æ³•ä¸­çš„å­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼Œå½“æœ‰æ–°ä»»åŠ¡åœ¨execute()æ–¹æ³•æäº¤æ—¶ï¼Œä¼šæ‰§è¡Œä»¥ä¸‹åˆ¤æ–­ï¼š å¦‚æœè¿è¡Œçš„çº¿ç¨‹å°‘äº corePoolSizeï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œå³ä½¿çº¿ç¨‹æ± ä¸­çš„å…¶ä»–çº¿ç¨‹æ˜¯ç©ºé—²çš„ï¼› å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äº corePoolSize ä¸”å°äº maximumPoolSizeï¼Œåˆ™åªæœ‰å½“workQueueæ»¡æ—¶æ‰åˆ›å»ºæ–°çš„çº¿ç¨‹å»å¤„ç†ä»»åŠ¡ï¼› å¦‚æœè®¾ç½®çš„corePoolSize å’Œ maximumPoolSizeç›¸åŒï¼Œåˆ™åˆ›å»ºçš„çº¿ç¨‹æ± çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œè¿™æ—¶å¦‚æœæœ‰æ–°ä»»åŠ¡æäº¤ï¼Œè‹¥workQueueæœªæ»¡ï¼Œåˆ™å°†è¯·æ±‚æ”¾å…¥workQueueä¸­ï¼Œç­‰å¾…æœ‰ç©ºé—²çš„çº¿ç¨‹å»ä»workQueueä¸­å–ä»»åŠ¡å¹¶å¤„ç†ï¼› å¦‚æœè¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äºmaximumPoolSizeï¼Œè¿™æ—¶å¦‚æœworkQueueå·²ç»æ»¡äº†ï¼Œåˆ™é€šè¿‡handleræ‰€æŒ‡å®šçš„ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡ï¼› æ‰€ä»¥ï¼Œä»»åŠ¡æäº¤æ—¶ï¼Œåˆ¤æ–­çš„é¡ºåºä¸º corePoolSize â€“&gt; workQueue â€“&gt; maximumPoolSizeã€‚ maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°é‡ï¼› workQueueï¼šç­‰å¾…é˜Ÿåˆ—ï¼Œå½“ä»»åŠ¡æäº¤æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äºcorePoolSizeçš„æ—¶å€™ï¼ŒæŠŠè¯¥ä»»åŠ¡å°è£…æˆä¸€ä¸ªWorkerå¯¹è±¡æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå½“æäº¤ä¸€ä¸ªæ–°çš„ä»»åŠ¡åˆ°çº¿ç¨‹æ± ä»¥å, çº¿ç¨‹æ± ä¼šæ ¹æ®å½“å‰çº¿ç¨‹æ± ä¸­æ­£åœ¨è¿è¡Œç€çš„çº¿ç¨‹çš„æ•°é‡æ¥å†³å®šå¯¹è¯¥ä»»åŠ¡çš„å¤„ç†æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ BlockingQueue çš„é€‰æ‹©ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§å¤„ç†æ–¹å¼: ç›´æ¥åˆ‡æ¢ï¼šè¿™ç§æ–¹å¼å¸¸ç”¨çš„é˜Ÿåˆ—æ˜¯SynchronousQueueï¼Œä½†ç°åœ¨è¿˜æ²¡æœ‰ç ”ç©¶è¿‡è¯¥é˜Ÿåˆ—ï¼Œè¿™é‡Œæš‚æ—¶è¿˜æ²¡æ³•ä»‹ç»ï¼› ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼šä¸€èˆ¬ä½¿ç”¨åŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—LinkedBlockingQueueã€‚å¦‚æœä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¸­èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°å°±æ˜¯corePoolSizeï¼Œè€ŒmaximumPoolSizeå°±ä¸ä¼šèµ·ä½œç”¨äº†ã€Œå› ä¸ºé˜Ÿåˆ—æ°¸è¿œä¸ä¼šæ»¡â€¦ã€ï¼ˆåé¢ä¹Ÿä¼šè¯´åˆ°ï¼‰ã€‚å½“çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„æ ¸å¿ƒçº¿ç¨‹éƒ½æ˜¯RUNNINGçŠ¶æ€æ—¶ï¼Œè¿™æ—¶ä¸€ä¸ªæ–°çš„ä»»åŠ¡æäº¤å°±ä¼šæ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼šä¸€èˆ¬ä½¿ç”¨ArrayBlockingQueueã€‚ä½¿ç”¨è¯¥æ–¹å¼å¯ä»¥å°†çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°é‡é™åˆ¶ä¸ºmaximumPoolSizeï¼Œè¿™æ ·èƒ½å¤Ÿé™ä½èµ„æºçš„æ¶ˆè€—ï¼Œä½†åŒæ—¶è¿™ç§æ–¹å¼ä¹Ÿä½¿å¾—çº¿ç¨‹æ± å¯¹çº¿ç¨‹çš„è°ƒåº¦å˜å¾—æ›´å›°éš¾ï¼Œå› ä¸ºçº¿ç¨‹æ± å’Œé˜Ÿåˆ—çš„å®¹é‡éƒ½æ˜¯æœ‰é™çš„å€¼ï¼Œæ‰€ä»¥è¦æƒ³ä½¿çº¿ç¨‹æ± å¤„ç†ä»»åŠ¡çš„ååç‡è¾¾åˆ°ä¸€ä¸ªç›¸å¯¹åˆç†çš„èŒƒå›´ï¼Œåˆæƒ³ä½¿çº¿ç¨‹è°ƒåº¦ç›¸å¯¹ç®€å•ï¼Œå¹¶ä¸”è¿˜è¦å°½å¯èƒ½çš„é™ä½çº¿ç¨‹æ± å¯¹èµ„æºçš„æ¶ˆè€—ï¼Œå°±éœ€è¦åˆç†çš„è®¾ç½®è¿™ä¸¤ä¸ªæ•°é‡ã€‚ å¦‚æœè¦æƒ³é™ä½ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—ï¼ˆåŒ…æ‹¬CPUçš„ä½¿ç”¨ç‡ï¼Œæ“ä½œç³»ç»Ÿèµ„æºçš„æ¶ˆè€—ï¼Œä¸Šä¸‹æ–‡ç¯å¢ƒåˆ‡æ¢çš„å¼€é”€ç­‰ï¼‰, å¯ä»¥è®¾ç½®è¾ƒå¤§çš„é˜Ÿåˆ—å®¹é‡å’Œè¾ƒå°çš„çº¿ç¨‹æ± å®¹é‡, ä½†è¿™æ ·ä¹Ÿä¼šé™ä½çº¿ç¨‹å¤„ç†ä»»åŠ¡çš„ååé‡ã€‚ å¦‚æœæäº¤çš„ä»»åŠ¡ç»å¸¸å‘ç”Ÿé˜»å¡ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘é€šè¿‡è°ƒç”¨ setMaximumPoolSize() æ–¹æ³•æ¥é‡æ–°è®¾å®šçº¿ç¨‹æ± çš„å®¹é‡ã€‚ å¦‚æœé˜Ÿåˆ—çš„å®¹é‡è®¾ç½®çš„è¾ƒå°ï¼Œé€šå¸¸éœ€è¦å°†çº¿ç¨‹æ± çš„å®¹é‡è®¾ç½®å¤§ä¸€ç‚¹ï¼Œè¿™æ ·CPUçš„ä½¿ç”¨ç‡ä¼šç›¸å¯¹çš„é«˜ä¸€äº›ã€‚ä½†å¦‚æœçº¿ç¨‹æ± çš„å®¹é‡è®¾ç½®çš„è¿‡å¤§ï¼Œåˆ™åœ¨æäº¤çš„ä»»åŠ¡æ•°é‡å¤ªå¤šçš„æƒ…å†µä¸‹ï¼Œå¹¶å‘é‡ä¼šå¢åŠ ï¼Œé‚£ä¹ˆçº¿ç¨‹ä¹‹é—´çš„è°ƒåº¦å°±æ˜¯ä¸€ä¸ªè¦è€ƒè™‘çš„é—®é¢˜ï¼Œå› ä¸ºè¿™æ ·åè€Œæœ‰å¯èƒ½é™ä½å¤„ç†ä»»åŠ¡çš„ååé‡ã€‚ keepAliveTimeï¼šçº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´ã€‚å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºcorePoolSizeçš„æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº†keepAliveTimeï¼› threadFactoryï¼šå®ƒæ˜¯ThreadFactoryç±»å‹çš„å˜é‡ï¼Œç”¨æ¥åˆ›å»ºæ–°çº¿ç¨‹ã€‚é»˜è®¤ä½¿ç”¨Executors.defaultThreadFactory() æ¥åˆ›å»ºçº¿ç¨‹ã€‚ä½¿ç”¨é»˜è®¤çš„ThreadFactoryæ¥åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œä¼šä½¿æ–°åˆ›å»ºçš„çº¿ç¨‹å…·æœ‰ç›¸åŒçš„NORM_PRIORITYä¼˜å…ˆçº§å¹¶ä¸”æ˜¯éå®ˆæŠ¤çº¿ç¨‹ï¼ŒåŒæ—¶ä¹Ÿè®¾ç½®äº†çº¿ç¨‹çš„åç§°ã€‚ handlerï¼šå®ƒæ˜¯RejectedExecutionHandlerç±»å‹çš„å˜é‡ï¼Œè¡¨ç¤ºçº¿ç¨‹æ± çš„é¥±å’Œç­–ç•¥ã€‚å¦‚æœé˜»å¡é˜Ÿåˆ—æ»¡äº†å¹¶ä¸”æ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹ï¼Œè¿™æ—¶å¦‚æœç»§ç»­æäº¤ä»»åŠ¡ï¼Œå°±éœ€è¦é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†è¯¥ä»»åŠ¡ã€‚çº¿ç¨‹æ± æä¾›äº†4ç§ç­–ç•¥ï¼š AbortPolicyï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ˜¯é»˜è®¤ç­–ç•¥ï¼› CallerRunsPolicyï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼› DiscardOldestPolicyï¼šä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­é æœ€å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼› DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼› executeæ–¹æ³•execute()æ–¹æ³•ç”¨æ¥æäº¤ä»»åŠ¡ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556public void execute(Runnable command) &#123; if (command == null) throw new NullPointerException(); /* * cltè®°å½•ç€runStateå’ŒworkerCount */ int c = ctl.get(); /* * workerCountOfæ–¹æ³•å–å‡ºä½29ä½çš„å€¼ï¼Œè¡¨ç¤ºå½“å‰æ´»åŠ¨çš„çº¿ç¨‹æ•°ï¼› * å¦‚æœå½“å‰æ´»åŠ¨çº¿ç¨‹æ•°å°äºcorePoolSizeï¼Œåˆ™æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ”¾å…¥çº¿ç¨‹æ± ä¸­ï¼› * å¹¶æŠŠä»»åŠ¡æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ã€‚ */ if (workerCountOf(c) &lt; corePoolSize) &#123; /* * addWorkerä¸­çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºé™åˆ¶æ·»åŠ çº¿ç¨‹çš„æ•°é‡æ˜¯æ ¹æ®corePoolSizeæ¥åˆ¤æ–­è¿˜æ˜¯maximumPoolSizeæ¥åˆ¤æ–­ï¼› * å¦‚æœä¸ºtrueï¼Œæ ¹æ®corePoolSizeæ¥åˆ¤æ–­ï¼› * å¦‚æœä¸ºfalseï¼Œåˆ™æ ¹æ®maximumPoolSizeæ¥åˆ¤æ–­ */ if (addWorker(command, true)) return; /* * å¦‚æœæ·»åŠ å¤±è´¥ï¼Œåˆ™é‡æ–°è·å–ctlå€¼ */ c = ctl.get(); &#125; /* * å¦‚æœå½“å‰çº¿ç¨‹æ± æ˜¯è¿è¡ŒçŠ¶æ€å¹¶ä¸”ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—æˆåŠŸ */ if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; // é‡æ–°è·å–ctlå€¼ int recheck = ctl.get(); // å†æ¬¡åˆ¤æ–­çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯è¿è¡ŒçŠ¶æ€ï¼Œç”±äºä¹‹å‰å·²ç»æŠŠcommandæ·»åŠ åˆ°workQueueä¸­äº†ï¼Œ // è¿™æ—¶éœ€è¦ç§»é™¤è¯¥command // æ‰§è¡Œè¿‡åé€šè¿‡handlerä½¿ç”¨æ‹’ç»ç­–ç•¥å¯¹è¯¥ä»»åŠ¡è¿›è¡Œå¤„ç†ï¼Œæ•´ä¸ªæ–¹æ³•è¿”å› if (! isRunning(recheck) &amp;&amp; remove(command)) reject(command); /* * è·å–çº¿ç¨‹æ± ä¸­çš„æœ‰æ•ˆçº¿ç¨‹æ•°ï¼Œå¦‚æœæ•°é‡æ˜¯0ï¼Œåˆ™æ‰§è¡ŒaddWorkeræ–¹æ³• * è¿™é‡Œä¼ å…¥çš„å‚æ•°è¡¨ç¤ºï¼š * 1. ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œè¡¨ç¤ºåœ¨çº¿ç¨‹æ± ä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä½†ä¸å»å¯åŠ¨ï¼› * 2. ç¬¬äºŒä¸ªå‚æ•°ä¸ºfalseï¼Œå°†çº¿ç¨‹æ± çš„æœ‰é™çº¿ç¨‹æ•°é‡çš„ä¸Šé™è®¾ç½®ä¸ºmaximumPoolSizeï¼Œæ·»åŠ çº¿ç¨‹æ—¶æ ¹æ®maximumPoolSizeæ¥åˆ¤æ–­ï¼› * å¦‚æœåˆ¤æ–­workerCountå¤§äº0ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œåœ¨workQueueä¸­æ–°å¢çš„commandä¼šåœ¨å°†æ¥çš„æŸä¸ªæ—¶åˆ»è¢«æ‰§è¡Œã€‚ */ else if (workerCountOf(recheck) == 0) addWorker(null, false); &#125; /* * å¦‚æœæ‰§è¡Œåˆ°è¿™é‡Œï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š * 1. çº¿ç¨‹æ± å·²ç»ä¸æ˜¯RUNNINGçŠ¶æ€ï¼› * 2. çº¿ç¨‹æ± æ˜¯RUNNINGçŠ¶æ€ï¼Œä½†workerCount &gt;= corePoolSizeå¹¶ä¸”workQueueå·²æ»¡ã€‚ * è¿™æ—¶ï¼Œå†æ¬¡è°ƒç”¨addWorkeræ–¹æ³•ï¼Œä½†ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ä¸ºfalseï¼Œå°†çº¿ç¨‹æ± çš„æœ‰é™çº¿ç¨‹æ•°é‡çš„ä¸Šé™è®¾ç½®ä¸ºmaximumPoolSizeï¼› * å¦‚æœå¤±è´¥åˆ™æ‹’ç»è¯¥ä»»åŠ¡ */ else if (!addWorker(command, false)) reject(command);&#125; ç®€å•æ¥è¯´ï¼Œåœ¨æ‰§è¡Œexecute()æ–¹æ³•æ—¶å¦‚æœçŠ¶æ€ä¸€ç›´æ˜¯RUNNINGæ—¶ï¼Œçš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š å¦‚æœworkerCount &lt; corePoolSizeï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ï¼› å¦‚æœworkerCount &gt;= corePoolSizeï¼Œä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—æœªæ»¡ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°è¯¥é˜»å¡é˜Ÿåˆ—ä¸­ï¼› å¦‚æœworkerCount &gt;= corePoolSize &amp;&amp; workerCount &lt; maximumPoolSizeï¼Œä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ï¼› å¦‚æœworkerCount &gt;= maximumPoolSizeï¼Œå¹¶ä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡, åˆ™æ ¹æ®æ‹’ç»ç­–ç•¥æ¥å¤„ç†è¯¥ä»»åŠ¡, é»˜è®¤çš„å¤„ç†æ–¹å¼æ˜¯ç›´æ¥æŠ›å¼‚å¸¸ã€‚ è¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹addWorker(null, false);ï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä½†å¹¶æ²¡æœ‰ä¼ å…¥ä»»åŠ¡ï¼Œå› ä¸ºä»»åŠ¡å·²ç»è¢«æ·»åŠ åˆ°workQueueä¸­äº†ï¼Œæ‰€ä»¥workeråœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šç›´æ¥ä»workQueueä¸­è·å–ä»»åŠ¡ã€‚æ‰€ä»¥ï¼Œåœ¨workerCountOf(recheck) == 0æ—¶æ‰§è¡ŒaddWorker(null, false);ä¹Ÿæ˜¯ä¸ºäº†ä¿è¯çº¿ç¨‹æ± åœ¨RUNNINGçŠ¶æ€ä¸‹å¿…é¡»è¦æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚ executeæ–¹æ³•æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š addWorkeræ–¹æ³•addWorkeræ–¹æ³•çš„ä¸»è¦å·¥ä½œæ˜¯åœ¨çº¿ç¨‹æ± ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å¹¶æ‰§è¡Œï¼ŒfirstTaskå‚æ•° ç”¨äºæŒ‡å®šæ–°å¢çš„çº¿ç¨‹æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œcoreå‚æ•°ä¸ºtrueè¡¨ç¤ºåœ¨æ–°å¢çº¿ç¨‹æ—¶ä¼šåˆ¤æ–­å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°æ˜¯å¦å°‘äºcorePoolSizeï¼Œfalseè¡¨ç¤ºæ–°å¢çº¿ç¨‹å‰éœ€è¦åˆ¤æ–­å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°æ˜¯å¦å°‘äºmaximumPoolSizeï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495private boolean addWorker(Runnable firstTask, boolean core) &#123; retry: for (;;) &#123; int c = ctl.get(); // è·å–è¿è¡ŒçŠ¶æ€ int rs = runStateOf(c); /* * è¿™ä¸ªifåˆ¤æ–­ * å¦‚æœrs &gt;= SHUTDOWNï¼Œåˆ™è¡¨ç¤ºæ­¤æ—¶ä¸å†æ¥æ”¶æ–°ä»»åŠ¡ï¼› * æ¥ç€åˆ¤æ–­ä»¥ä¸‹3ä¸ªæ¡ä»¶ï¼Œåªè¦æœ‰1ä¸ªä¸æ»¡è¶³ï¼Œåˆ™è¿”å›falseï¼š * 1. rs == SHUTDOWNï¼Œè¿™æ—¶è¡¨ç¤ºå…³é—­çŠ¶æ€ï¼Œä¸å†æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†å´å¯ä»¥ç»§ç»­å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­å·²ä¿å­˜çš„ä»»åŠ¡ * 2. firsTaskä¸ºç©º * 3. é˜»å¡é˜Ÿåˆ—ä¸ä¸ºç©º * * é¦–å…ˆè€ƒè™‘rs == SHUTDOWNçš„æƒ…å†µ * è¿™ç§æƒ…å†µä¸‹ä¸ä¼šæ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œæ‰€ä»¥åœ¨firstTaskä¸ä¸ºç©ºçš„æ—¶å€™ä¼šè¿”å›falseï¼› * ç„¶åï¼Œå¦‚æœfirstTaskä¸ºç©ºï¼Œå¹¶ä¸”workQueueä¹Ÿä¸ºç©ºï¼Œåˆ™è¿”å›falseï¼Œ * å› ä¸ºé˜Ÿåˆ—ä¸­å·²ç»æ²¡æœ‰ä»»åŠ¡äº†ï¼Œä¸éœ€è¦å†æ·»åŠ çº¿ç¨‹äº† */ // Check if queue empty only if necessary. if (rs &gt;= SHUTDOWN &amp;&amp; ! (rs == SHUTDOWN &amp;&amp; firstTask == null &amp;&amp; ! workQueue.isEmpty())) return false; for (;;) &#123; // è·å–çº¿ç¨‹æ•° int wc = workerCountOf(c); // å¦‚æœwcè¶…è¿‡CAPACITYï¼Œä¹Ÿå°±æ˜¯ctlçš„ä½29ä½çš„æœ€å¤§å€¼ï¼ˆäºŒè¿›åˆ¶æ˜¯29ä¸ª1ï¼‰ï¼Œè¿”å›falseï¼› // è¿™é‡Œçš„coreæ˜¯addWorkeræ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¦‚æœä¸ºtrueè¡¨ç¤ºæ ¹æ®corePoolSizeæ¥æ¯”è¾ƒï¼Œ // å¦‚æœä¸ºfalseåˆ™æ ¹æ®maximumPoolSizeæ¥æ¯”è¾ƒã€‚ // if (wc &gt;= CAPACITY || wc &gt;= (core ? corePoolSize : maximumPoolSize)) return false; // å°è¯•å¢åŠ workerCountï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è·³å‡ºç¬¬ä¸€ä¸ªforå¾ªç¯ if (compareAndIncrementWorkerCount(c)) break retry; // å¦‚æœå¢åŠ workerCountå¤±è´¥ï¼Œåˆ™é‡æ–°è·å–ctlçš„å€¼ c = ctl.get(); // Re-read ctl // å¦‚æœå½“å‰çš„è¿è¡ŒçŠ¶æ€ä¸ç­‰äºrsï¼Œè¯´æ˜çŠ¶æ€å·²è¢«æ”¹å˜ï¼Œè¿”å›ç¬¬ä¸€ä¸ªforå¾ªç¯ç»§ç»­æ‰§è¡Œ if (runStateOf(c) != rs) continue retry; // else CAS failed due to workerCount change; retry inner loop &#125; &#125; boolean workerStarted = false; boolean workerAdded = false; Worker w = null; try &#123; // æ ¹æ®firstTaskæ¥åˆ›å»ºWorkerå¯¹è±¡ w = new Worker(firstTask); // æ¯ä¸€ä¸ªWorkerå¯¹è±¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ final Thread t = w.thread; if (t != null) &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; // Recheck while holding lock. // Back out on ThreadFactory failure or if // shut down before lock acquired. int rs = runStateOf(ctl.get()); // rs &lt; SHUTDOWNè¡¨ç¤ºæ˜¯RUNNINGçŠ¶æ€ï¼› // å¦‚æœrsæ˜¯RUNNINGçŠ¶æ€æˆ–è€…rsæ˜¯SHUTDOWNçŠ¶æ€å¹¶ä¸”firstTaskä¸ºnullï¼Œå‘çº¿ç¨‹æ± ä¸­æ·»åŠ çº¿ç¨‹ã€‚ // å› ä¸ºåœ¨SHUTDOWNæ—¶ä¸ä¼šåœ¨æ·»åŠ æ–°çš„ä»»åŠ¡ï¼Œä½†è¿˜æ˜¯ä¼šæ‰§è¡ŒworkQueueä¸­çš„ä»»åŠ¡ if (rs &lt; SHUTDOWN || (rs == SHUTDOWN &amp;&amp; firstTask == null)) &#123; if (t.isAlive()) // precheck that t is startable throw new IllegalThreadStateException(); // workersæ˜¯ä¸€ä¸ªHashSet workers.add(w); int s = workers.size(); // largestPoolSizeè®°å½•ç€çº¿ç¨‹æ± ä¸­å‡ºç°è¿‡çš„æœ€å¤§çº¿ç¨‹æ•°é‡ if (s &gt; largestPoolSize) largestPoolSize = s; workerAdded = true; &#125; &#125; finally &#123; mainLock.unlock(); &#125; if (workerAdded) &#123; // å¯åŠ¨çº¿ç¨‹ t.start(); workerStarted = true; &#125; &#125; &#125; finally &#123; if (! workerStarted) addWorkerFailed(w); &#125; return workerStarted;&#125; æ³¨æ„ä¸€ä¸‹è¿™é‡Œçš„t.start()è¿™ä¸ªè¯­å¥ï¼Œå¯åŠ¨æ—¶ä¼šè°ƒç”¨Workerç±»ä¸­çš„runæ–¹æ³•ï¼ŒWorkeræœ¬èº«å®ç°äº†Runnableæ¥å£ï¼Œæ‰€ä»¥ä¸€ä¸ªWorkerç±»å‹çš„å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚ Workerç±»çº¿ç¨‹æ± ä¸­çš„æ¯ä¸€ä¸ªçº¿ç¨‹è¢«å°è£…æˆä¸€ä¸ªWorkerå¯¹è±¡ï¼ŒThreadPoolç»´æŠ¤çš„å…¶å®å°±æ˜¯ä¸€ç»„Workerå¯¹è±¡ï¼Œçœ‹ä¸€ä¸‹Workerçš„å®šä¹‰ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970private final class Worker extends AbstractQueuedSynchronizer implements Runnable&#123; /** * This class will never be serialized, but we provide a * serialVersionUID to suppress a javac warning. */ private static final long serialVersionUID = 6138294804551838833L; /** Thread this worker is running in. Null if factory fails. */ final Thread thread; /** Initial task to run. Possibly null. */ Runnable firstTask; /** Per-thread task counter */ volatile long completedTasks; /** * Creates with given first task and thread from ThreadFactory. * @param firstTask the first task (null if none) */ Worker(Runnable firstTask) &#123; setState(-1); // inhibit interrupts until runWorker this.firstTask = firstTask; this.thread = getThreadFactory().newThread(this); &#125; /** Delegates main run loop to outer runWorker */ public void run() &#123; runWorker(this); &#125; // Lock methods // // The value 0 represents the unlocked state. // The value 1 represents the locked state. protected boolean isHeldExclusively() &#123; return getState() != 0; &#125; protected boolean tryAcquire(int unused) &#123; if (compareAndSetState(0, 1)) &#123; setExclusiveOwnerThread(Thread.currentThread()); return true; &#125; return false; &#125; protected boolean tryRelease(int unused) &#123; setExclusiveOwnerThread(null); setState(0); return true; &#125; public void lock() &#123; acquire(1); &#125; public boolean tryLock() &#123; return tryAcquire(1); &#125; public void unlock() &#123; release(1); &#125; public boolean isLocked() &#123; return isHeldExclusively(); &#125; void interruptIfStarted() &#123; Thread t; if (getState() &gt;= 0 &amp;&amp; (t = thread) != null &amp;&amp; !t.isInterrupted()) &#123; try &#123; t.interrupt(); &#125; catch (SecurityException ignore) &#123; &#125; &#125; &#125;&#125; Workerç±»ç»§æ‰¿äº†AQSï¼Œå¹¶å®ç°äº†Runnableæ¥å£ï¼Œæ³¨æ„å…¶ä¸­çš„firstTaskå’Œthreadå±æ€§ï¼šfirstTaskç”¨å®ƒæ¥ä¿å­˜ä¼ å…¥çš„ä»»åŠ¡ï¼›threadæ˜¯åœ¨è°ƒç”¨æ„é€ æ–¹æ³•æ—¶é€šè¿‡ThreadFactoryæ¥åˆ›å»ºçš„çº¿ç¨‹ï¼Œæ˜¯ç”¨æ¥å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ã€‚ åœ¨è°ƒç”¨æ„é€ æ–¹æ³•æ—¶ï¼Œéœ€è¦æŠŠä»»åŠ¡ä¼ å…¥ï¼Œè¿™é‡Œé€šè¿‡getThreadFactory().newThread(this);æ¥æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼ŒnewThreadæ–¹æ³•ä¼ å…¥çš„å‚æ•°æ˜¯thisï¼Œå› ä¸ºWorkeræœ¬èº«ç»§æ‰¿äº†Runnableæ¥å£ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ä¸€ä¸ªWorkerå¯¹è±¡åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šè°ƒç”¨Workerç±»ä¸­çš„runæ–¹æ³•ã€‚ Workerç»§æ‰¿äº†AQSï¼Œä½¿ç”¨AQSæ¥å®ç°ç‹¬å é”çš„åŠŸèƒ½ã€‚ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ReentrantLockæ¥å®ç°å‘¢ï¼Ÿå¯ä»¥çœ‹åˆ°tryAcquireæ–¹æ³•ï¼Œå®ƒæ˜¯ä¸å…è®¸é‡å…¥çš„ï¼Œè€ŒReentrantLockæ˜¯å…è®¸é‡å…¥çš„ï¼š lockæ–¹æ³•ä¸€æ—¦è·å–äº†ç‹¬å é”ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œä»»åŠ¡ä¸­ï¼› å¦‚æœæ­£åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™ä¸åº”è¯¥ä¸­æ–­çº¿ç¨‹ï¼› å¦‚æœè¯¥çº¿ç¨‹ç°åœ¨ä¸æ˜¯ç‹¬å é”çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ç©ºé—²çš„çŠ¶æ€ï¼Œè¯´æ˜å®ƒæ²¡æœ‰åœ¨å¤„ç†ä»»åŠ¡ï¼Œè¿™æ—¶å¯ä»¥å¯¹è¯¥çº¿ç¨‹è¿›è¡Œä¸­æ–­ï¼› çº¿ç¨‹æ± åœ¨æ‰§è¡Œshutdownæ–¹æ³•æˆ–tryTerminateæ–¹æ³•æ—¶ä¼šè°ƒç”¨interruptIdleWorkersæ–¹æ³•æ¥ä¸­æ–­ç©ºé—²çš„çº¿ç¨‹ï¼ŒinterruptIdleWorkersæ–¹æ³•ä¼šä½¿ç”¨tryLockæ–¹æ³•æ¥åˆ¤æ–­çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¦æ˜¯ç©ºé—²çŠ¶æ€ï¼› ä¹‹æ‰€ä»¥è®¾ç½®ä¸ºä¸å¯é‡å…¥ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›ä»»åŠ¡åœ¨è°ƒç”¨åƒsetCorePoolSizeè¿™æ ·çš„çº¿ç¨‹æ± æ§åˆ¶æ–¹æ³•æ—¶é‡æ–°è·å–é”ã€‚å¦‚æœä½¿ç”¨ReentrantLockï¼Œå®ƒæ˜¯å¯é‡å…¥çš„ï¼Œè¿™æ ·å¦‚æœåœ¨ä»»åŠ¡ä¸­è°ƒç”¨äº†å¦‚setCorePoolSizeè¿™ç±»çº¿ç¨‹æ± æ§åˆ¶çš„æ–¹æ³•ï¼Œä¼šä¸­æ–­æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚ æ‰€ä»¥ï¼ŒWorkerç»§æ‰¿è‡ªAQSï¼Œç”¨äºåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ç©ºé—²ä»¥åŠæ˜¯å¦å¯ä»¥è¢«ä¸­æ–­ã€‚ æ­¤å¤–ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­æ‰§è¡Œäº†setState(-1);ï¼ŒæŠŠstateå˜é‡è®¾ç½®ä¸º-1ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿæ˜¯å› ä¸ºAQSä¸­é»˜è®¤çš„stateæ˜¯0ï¼Œå¦‚æœåˆšåˆ›å»ºäº†ä¸€ä¸ªWorkerå¯¹è±¡ï¼Œè¿˜æ²¡æœ‰æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œè¿™æ—¶å°±ä¸åº”è¯¥è¢«ä¸­æ–­ï¼Œçœ‹ä¸€ä¸‹tryAquireæ–¹æ³•ï¼š 1234567protected boolean tryAcquire(int unused) &#123; if (compareAndSetState(0, 1)) &#123; setExclusiveOwnerThread(Thread.currentThread()); return true; &#125; return false;&#125; tryAcquireæ–¹æ³•æ˜¯æ ¹æ®stateæ˜¯å¦æ˜¯0æ¥åˆ¤æ–­çš„ï¼Œæ‰€ä»¥ï¼ŒsetState(-1);å°†stateè®¾ç½®ä¸º-1æ˜¯ä¸ºäº†ç¦æ­¢åœ¨æ‰§è¡Œä»»åŠ¡å‰å¯¹çº¿ç¨‹è¿›è¡Œä¸­æ–­ã€‚ æ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨runWorkeræ–¹æ³•ä¸­ä¼šå…ˆè°ƒç”¨Workerå¯¹è±¡çš„unlockæ–¹æ³•å°†stateè®¾ç½®ä¸º0. runWorkeræ–¹æ³•åœ¨Workerç±»ä¸­çš„runæ–¹æ³•è°ƒç”¨äº†runWorkeræ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡ï¼ŒrunWorkeræ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647final void runWorker(Worker w) &#123; Thread wt = Thread.currentThread(); // è·å–ç¬¬ä¸€ä¸ªä»»åŠ¡ Runnable task = w.firstTask; w.firstTask = null; // å…è®¸ä¸­æ–­ w.unlock(); // allow interrupts // æ˜¯å¦å› ä¸ºå¼‚å¸¸é€€å‡ºå¾ªç¯ boolean completedAbruptly = true; try &#123; // å¦‚æœtaskä¸ºç©ºï¼Œåˆ™é€šè¿‡getTaskæ¥è·å–ä»»åŠ¡ while (task != null || (task = getTask()) != null) &#123; w.lock(); // If pool is stopping, ensure thread is interrupted; // if not, ensure thread is not interrupted. This // requires a recheck in second case to deal with // shutdownNow race while clearing interrupt if ((runStateAtLeast(ctl.get(), STOP) || (Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP))) &amp;&amp; !wt.isInterrupted()) wt.interrupt(); try &#123; beforeExecute(wt, task); Throwable thrown = null; try &#123; task.run(); &#125; catch (RuntimeException x) &#123; thrown = x; throw x; &#125; catch (Error x) &#123; thrown = x; throw x; &#125; catch (Throwable x) &#123; thrown = x; throw new Error(x); &#125; finally &#123; afterExecute(task, thrown); &#125; &#125; finally &#123; task = null; w.completedTasks++; w.unlock(); &#125; &#125; completedAbruptly = false; &#125; finally &#123; processWorkerExit(w, completedAbruptly); &#125;&#125; è¿™é‡Œè¯´æ˜ä¸€ä¸‹ç¬¬ä¸€ä¸ªifåˆ¤æ–­ï¼Œç›®çš„æ˜¯ï¼š å¦‚æœçº¿ç¨‹æ± æ­£åœ¨åœæ­¢ï¼Œé‚£ä¹ˆè¦ä¿è¯å½“å‰çº¿ç¨‹æ˜¯ä¸­æ–­çŠ¶æ€ï¼› å¦‚æœä¸æ˜¯çš„è¯ï¼Œåˆ™è¦ä¿è¯å½“å‰çº¿ç¨‹ä¸æ˜¯ä¸­æ–­çŠ¶æ€ï¼› è¿™é‡Œè¦è€ƒè™‘åœ¨æ‰§è¡Œè¯¥ifè¯­å¥æœŸé—´å¯èƒ½ä¹Ÿæ‰§è¡Œäº†shutdownNowæ–¹æ³•ï¼ŒshutdownNowæ–¹æ³•ä¼šæŠŠçŠ¶æ€è®¾ç½®ä¸ºSTOPï¼Œå›é¡¾ä¸€ä¸‹STOPçŠ¶æ€ï¼š ä¸èƒ½æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œä¼šä¸­æ–­æ­£åœ¨å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ã€‚åœ¨çº¿ç¨‹æ± å¤„äº RUNNING æˆ– SHUTDOWN çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ shutdownNow() æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€ã€‚ STOPçŠ¶æ€è¦ä¸­æ–­çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹ï¼Œè€Œè¿™é‡Œä½¿ç”¨Thread.interrupted()æ¥åˆ¤æ–­æ˜¯å¦ä¸­æ–­æ˜¯ä¸ºäº†ç¡®ä¿åœ¨RUNNINGæˆ–è€…SHUTDOWNçŠ¶æ€æ—¶çº¿ç¨‹æ˜¯éä¸­æ–­çŠ¶æ€çš„ï¼Œå› ä¸ºThread.interrupted()æ–¹æ³•ä¼šå¤ä½ä¸­æ–­çš„çŠ¶æ€ã€‚ æ€»ç»“ä¸€ä¸‹runWorkeræ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼š whileå¾ªç¯ä¸æ–­åœ°é€šè¿‡getTask()æ–¹æ³•è·å–ä»»åŠ¡ï¼› getTask()æ–¹æ³•ä»é˜»å¡é˜Ÿåˆ—ä¸­å–ä»»åŠ¡ï¼› å¦‚æœçº¿ç¨‹æ± æ­£åœ¨åœæ­¢ï¼Œé‚£ä¹ˆè¦ä¿è¯å½“å‰çº¿ç¨‹æ˜¯ä¸­æ–­çŠ¶æ€ï¼Œå¦åˆ™è¦ä¿è¯å½“å‰çº¿ç¨‹ä¸æ˜¯ä¸­æ–­çŠ¶æ€ï¼› è°ƒç”¨task.run()æ‰§è¡Œä»»åŠ¡ï¼› å¦‚æœtaskä¸ºnullåˆ™è·³å‡ºå¾ªç¯ï¼Œæ‰§è¡ŒprocessWorkerExit()æ–¹æ³•ï¼› runWorkeræ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿä»£è¡¨ç€Workerä¸­çš„runæ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œé”€æ¯çº¿ç¨‹ã€‚ è¿™é‡Œçš„beforeExecuteæ–¹æ³•å’ŒafterExecuteæ–¹æ³•åœ¨ThreadPoolExecutorç±»ä¸­æ˜¯ç©ºçš„ï¼Œç•™ç»™å­ç±»æ¥å®ç°ã€‚ completedAbruptlyå˜é‡æ¥è¡¨ç¤ºåœ¨æ‰§è¡Œä»»åŠ¡è¿‡ç¨‹ä¸­æ˜¯å¦å‡ºç°äº†å¼‚å¸¸ï¼Œåœ¨processWorkerExitæ–¹æ³•ä¸­ä¼šå¯¹è¯¥å˜é‡çš„å€¼è¿›è¡Œåˆ¤æ–­ã€‚ getTaskæ–¹æ³•getTaskæ–¹æ³•ç”¨æ¥ä»é˜»å¡é˜Ÿåˆ—ä¸­å–ä»»åŠ¡ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263private Runnable getTask() &#123; // timeOutå˜é‡çš„å€¼è¡¨ç¤ºä¸Šæ¬¡ä»é˜»å¡é˜Ÿåˆ—ä¸­å–ä»»åŠ¡æ—¶æ˜¯å¦è¶…æ—¶ boolean timedOut = false; // Did the last poll() time out? for (;;) &#123; int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. /* * å¦‚æœçº¿ç¨‹æ± çŠ¶æ€rs &gt;= SHUTDOWNï¼Œä¹Ÿå°±æ˜¯éRUNNINGçŠ¶æ€ï¼Œå†è¿›è¡Œä»¥ä¸‹åˆ¤æ–­ï¼š * 1. rs &gt;= STOPï¼Œçº¿ç¨‹æ± æ˜¯å¦æ­£åœ¨stopï¼› * 2. é˜»å¡é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚ * å¦‚æœä»¥ä¸Šæ¡ä»¶æ»¡è¶³ï¼Œåˆ™å°†workerCountå‡1å¹¶è¿”å›nullã€‚ * å› ä¸ºå¦‚æœå½“å‰çº¿ç¨‹æ± çŠ¶æ€çš„å€¼æ˜¯SHUTDOWNæˆ–ä»¥ä¸Šæ—¶ï¼Œä¸å…è®¸å†å‘é˜»å¡é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ã€‚ */ if (rs &gt;= SHUTDOWN &amp;&amp; (rs &gt;= STOP || workQueue.isEmpty())) &#123; decrementWorkerCount(); return null; &#125; int wc = workerCountOf(c); // Are workers subject to culling? // timedå˜é‡ç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œè¶…æ—¶æ§åˆ¶ã€‚ // allowCoreThreadTimeOuté»˜è®¤æ˜¯falseï¼Œä¹Ÿå°±æ˜¯æ ¸å¿ƒçº¿ç¨‹ä¸å…è®¸è¿›è¡Œè¶…æ—¶ï¼› // wc &gt; corePoolSizeï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼› // å¯¹äºè¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„è¿™äº›çº¿ç¨‹ï¼Œéœ€è¦è¿›è¡Œè¶…æ—¶æ§åˆ¶ boolean timed = allowCoreThreadTimeOut || wc &gt; corePoolSize; /* * wc &gt; maximumPoolSizeçš„æƒ…å†µæ˜¯å› ä¸ºå¯èƒ½åœ¨æ­¤æ–¹æ³•æ‰§è¡Œé˜¶æ®µåŒæ—¶æ‰§è¡Œäº†setMaximumPoolSizeæ–¹æ³•ï¼› * timed &amp;&amp; timedOut å¦‚æœä¸ºtrueï¼Œè¡¨ç¤ºå½“å‰æ“ä½œéœ€è¦è¿›è¡Œè¶…æ—¶æ§åˆ¶ï¼Œå¹¶ä¸”ä¸Šæ¬¡ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡å‘ç”Ÿäº†è¶…æ—¶ * æ¥ä¸‹æ¥åˆ¤æ–­ï¼Œå¦‚æœæœ‰æ•ˆçº¿ç¨‹æ•°é‡å¤§äº1ï¼Œæˆ–è€…é˜»å¡é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå°è¯•å°†workerCountå‡1ï¼› * å¦‚æœå‡1å¤±è´¥ï¼Œåˆ™è¿”å›é‡è¯•ã€‚ * å¦‚æœwc == 1æ—¶ï¼Œä¹Ÿå°±è¯´æ˜å½“å‰çº¿ç¨‹æ˜¯çº¿ç¨‹æ± ä¸­å”¯ä¸€çš„ä¸€ä¸ªçº¿ç¨‹äº†ã€‚ */ if ((wc &gt; maximumPoolSize || (timed &amp;&amp; timedOut)) &amp;&amp; (wc &gt; 1 || workQueue.isEmpty())) &#123; if (compareAndDecrementWorkerCount(c)) return null; continue; &#125; try &#123; /* * æ ¹æ®timedæ¥åˆ¤æ–­ï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™é€šè¿‡é˜»å¡é˜Ÿåˆ—çš„pollæ–¹æ³•è¿›è¡Œè¶…æ—¶æ§åˆ¶ï¼Œå¦‚æœåœ¨keepAliveTimeæ—¶é—´å†…æ²¡æœ‰è·å–åˆ°ä»»åŠ¡ï¼Œåˆ™è¿”å›nullï¼› * å¦åˆ™é€šè¿‡takeæ–¹æ³•ï¼Œå¦‚æœè¿™æ—¶é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™takeæ–¹æ³•ä¼šé˜»å¡ç›´åˆ°é˜Ÿåˆ—ä¸ä¸ºç©ºã€‚ * */ Runnable r = timed ? workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) : workQueue.take(); if (r != null) return r; // å¦‚æœ r == nullï¼Œè¯´æ˜å·²ç»è¶…æ—¶ï¼ŒtimedOutè®¾ç½®ä¸ºtrue timedOut = true; &#125; catch (InterruptedException retry) &#123; // å¦‚æœè·å–ä»»åŠ¡æ—¶å½“å‰çº¿ç¨‹å‘ç”Ÿäº†ä¸­æ–­ï¼Œåˆ™è®¾ç½®timedOutä¸ºfalseå¹¶è¿”å›å¾ªç¯é‡è¯• timedOut = false; &#125; &#125;&#125; è¿™é‡Œé‡è¦çš„åœ°æ–¹æ˜¯ç¬¬äºŒä¸ªifåˆ¤æ–­ï¼Œç›®çš„æ˜¯æ§åˆ¶çº¿ç¨‹æ± çš„æœ‰æ•ˆçº¿ç¨‹æ•°é‡ã€‚ç”±ä¸Šæ–‡ä¸­çš„åˆ†æå¯ä»¥çŸ¥é“ï¼Œåœ¨æ‰§è¡Œexecuteæ–¹æ³•æ—¶ï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡è¶…è¿‡äº†corePoolSizeä¸”å°äºmaximumPoolSizeï¼Œå¹¶ä¸”workQueueå·²æ»¡æ—¶ï¼Œåˆ™å¯ä»¥å¢åŠ å·¥ä½œçº¿ç¨‹ï¼Œä½†è¿™æ—¶å¦‚æœè¶…æ—¶æ²¡æœ‰è·å–åˆ°ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯timedOutä¸ºtrueçš„æƒ…å†µï¼Œè¯´æ˜workQueueå·²ç»ä¸ºç©ºäº†ï¼Œä¹Ÿå°±è¯´æ˜äº†å½“å‰çº¿ç¨‹æ± ä¸­ä¸éœ€è¦é‚£ä¹ˆå¤šçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡äº†ï¼Œå¯ä»¥æŠŠå¤šäºcorePoolSizeæ•°é‡çš„çº¿ç¨‹é”€æ¯æ‰ï¼Œä¿æŒçº¿ç¨‹æ•°é‡åœ¨corePoolSizeå³å¯ã€‚ ä»€ä¹ˆæ—¶å€™ä¼šé”€æ¯ï¼Ÿå½“ç„¶æ˜¯runWorkeræ–¹æ³•æ‰§è¡Œå®Œä¹‹åï¼Œä¹Ÿå°±æ˜¯Workerä¸­çš„runæ–¹æ³•æ‰§è¡Œå®Œï¼Œç”±JVMè‡ªåŠ¨å›æ”¶ã€‚ getTaskæ–¹æ³•è¿”å›nullæ—¶ï¼Œåœ¨runWorkeræ–¹æ³•ä¸­ä¼šè·³å‡ºwhileå¾ªç¯ï¼Œç„¶åä¼šæ‰§è¡ŒprocessWorkerExitæ–¹æ³•ã€‚ processWorkerExitæ–¹æ³•12345678910111213141516171819202122232425262728293031323334353637private void processWorkerExit(Worker w, boolean completedAbruptly) &#123; // å¦‚æœcompletedAbruptlyå€¼ä¸ºtrueï¼Œåˆ™è¯´æ˜çº¿ç¨‹æ‰§è¡Œæ—¶å‡ºç°äº†å¼‚å¸¸ï¼Œéœ€è¦å°†workerCountå‡1ï¼› // å¦‚æœçº¿ç¨‹æ‰§è¡Œæ—¶æ²¡æœ‰å‡ºç°å¼‚å¸¸ï¼Œè¯´æ˜åœ¨getTask()æ–¹æ³•ä¸­å·²ç»å·²ç»å¯¹workerCountè¿›è¡Œäº†å‡1æ“ä½œï¼Œè¿™é‡Œå°±ä¸å¿…å†å‡äº†ã€‚ if (completedAbruptly) // If abrupt, then workerCount wasn't adjusted decrementWorkerCount(); final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; //ç»Ÿè®¡å®Œæˆçš„ä»»åŠ¡æ•° completedTaskCount += w.completedTasks; // ä»workersä¸­ç§»é™¤ï¼Œä¹Ÿå°±è¡¨ç¤ºç€ä»çº¿ç¨‹æ± ä¸­ç§»é™¤äº†ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ workers.remove(w); &#125; finally &#123; mainLock.unlock(); &#125; // æ ¹æ®çº¿ç¨‹æ± çŠ¶æ€è¿›è¡Œåˆ¤æ–­æ˜¯å¦ç»“æŸçº¿ç¨‹æ±  tryTerminate(); int c = ctl.get(); /* * å½“çº¿ç¨‹æ± æ˜¯RUNNINGæˆ–SHUTDOWNçŠ¶æ€æ—¶ï¼Œå¦‚æœworkeræ˜¯å¼‚å¸¸ç»“æŸï¼Œé‚£ä¹ˆä¼šç›´æ¥addWorkerï¼› * å¦‚æœallowCoreThreadTimeOut=trueï¼Œå¹¶ä¸”ç­‰å¾…é˜Ÿåˆ—æœ‰ä»»åŠ¡ï¼Œè‡³å°‘ä¿ç•™ä¸€ä¸ªworkerï¼› * å¦‚æœallowCoreThreadTimeOut=falseï¼ŒworkerCountä¸å°‘äºcorePoolSizeã€‚ */ if (runStateLessThan(c, STOP)) &#123; if (!completedAbruptly) &#123; int min = allowCoreThreadTimeOut ? 0 : corePoolSize; if (min == 0 &amp;&amp; ! workQueue.isEmpty()) min = 1; if (workerCountOf(c) &gt;= min) return; // replacement not needed &#125; addWorker(null, false); &#125;&#125; è‡³æ­¤ï¼ŒprocessWorkerExitæ‰§è¡Œå®Œä¹‹åï¼Œå·¥ä½œçº¿ç¨‹è¢«é”€æ¯ï¼Œä»¥ä¸Šå°±æ˜¯æ•´ä¸ªå·¥ä½œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»executeæ–¹æ³•å¼€å§‹ï¼ŒWorkerä½¿ç”¨ThreadFactoryåˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹ï¼ŒrunWorkeré€šè¿‡getTaskè·å–ä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœgetTaskè¿”å›nullï¼Œè¿›å…¥processWorkerExitæ–¹æ³•ï¼Œæ•´ä¸ªçº¿ç¨‹ç»“æŸï¼Œå¦‚å›¾æ‰€ç¤ºï¼š tryTerminateæ–¹æ³•tryTerminateæ–¹æ³•æ ¹æ®çº¿ç¨‹æ± çŠ¶æ€è¿›è¡Œåˆ¤æ–­æ˜¯å¦ç»“æŸçº¿ç¨‹æ± ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940final void tryTerminate() &#123; for (;;) &#123; int c = ctl.get(); /* * å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µæ—¶ï¼Œç›´æ¥è¿”å›ï¼š * 1. RUNNINGï¼Œå› ä¸ºè¿˜åœ¨è¿è¡Œä¸­ï¼Œä¸èƒ½åœæ­¢ï¼› * 2. TIDYINGæˆ–TERMINATEDï¼Œå› ä¸ºçº¿ç¨‹æ± ä¸­å·²ç»æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹äº†ï¼› * 3. SHUTDOWNå¹¶ä¸”ç­‰å¾…é˜Ÿåˆ—éç©ºï¼Œè¿™æ—¶è¦æ‰§è¡Œå®ŒworkQueueä¸­çš„taskï¼› */ if (isRunning(c) || runStateAtLeast(c, TIDYING) || (runStateOf(c) == SHUTDOWN &amp;&amp; ! workQueue.isEmpty())) return; // å¦‚æœçº¿ç¨‹æ•°é‡ä¸ä¸º0ï¼Œåˆ™ä¸­æ–­ä¸€ä¸ªç©ºé—²çš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶è¿”å› if (workerCountOf(c) != 0) &#123; // Eligible to terminate interruptIdleWorkers(ONLY_ONE); return; &#125; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; // è¿™é‡Œå°è¯•è®¾ç½®çŠ¶æ€ä¸ºTIDYINGï¼Œå¦‚æœè®¾ç½®æˆåŠŸï¼Œåˆ™è°ƒç”¨terminatedæ–¹æ³• if (ctl.compareAndSet(c, ctlOf(TIDYING, 0))) &#123; try &#123; // terminatedæ–¹æ³•é»˜è®¤ä»€ä¹ˆéƒ½ä¸åšï¼Œç•™ç»™å­ç±»å®ç° terminated(); &#125; finally &#123; // è®¾ç½®çŠ¶æ€ä¸ºTERMINATED ctl.set(ctlOf(TERMINATED, 0)); termination.signalAll(); &#125; return; &#125; &#125; finally &#123; mainLock.unlock(); &#125; // else retry on failed CAS &#125;&#125; interruptIdleWorkers(ONLY_ONE)çš„ä½œç”¨æ˜¯å› ä¸ºåœ¨getTaskæ–¹æ³•ä¸­æ‰§è¡ŒworkQueue.take()æ—¶ï¼Œå¦‚æœä¸æ‰§è¡Œä¸­æ–­ä¼šä¸€ç›´é˜»å¡ã€‚åœ¨ä¸‹é¢ä»‹ç»çš„shutdownæ–¹æ³•ä¸­ï¼Œä¼šä¸­æ–­æ‰€æœ‰ç©ºé—²çš„å·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœåœ¨æ‰§è¡Œshutdownæ—¶å·¥ä½œçº¿ç¨‹æ²¡æœ‰ç©ºé—²ï¼Œç„¶ååˆå»è°ƒç”¨äº†getTaskæ–¹æ³•ï¼Œè¿™æ—¶å¦‚æœworkQueueä¸­æ²¡æœ‰ä»»åŠ¡äº†ï¼Œè°ƒç”¨workQueue.take()æ—¶å°±ä¼šä¸€ç›´é˜»å¡ã€‚æ‰€ä»¥æ¯æ¬¡åœ¨å·¥ä½œçº¿ç¨‹ç»“æŸæ—¶è°ƒç”¨tryTerminateæ–¹æ³•æ¥å°è¯•ä¸­æ–­ä¸€ä¸ªç©ºé—²å·¥ä½œçº¿ç¨‹ï¼Œé¿å…åœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶å–ä»»åŠ¡ä¸€ç›´é˜»å¡çš„æƒ…å†µã€‚ shutdownæ–¹æ³•shutdownæ–¹æ³•è¦å°†çº¿ç¨‹æ± åˆ‡æ¢åˆ°SHUTDOWNçŠ¶æ€ï¼Œå¹¶è°ƒç”¨interruptIdleWorkersæ–¹æ³•è¯·æ±‚ä¸­æ–­æ‰€æœ‰ç©ºé—²çš„workerï¼Œæœ€åè°ƒç”¨tryTerminateå°è¯•ç»“æŸçº¿ç¨‹æ± ã€‚ 1234567891011121314151617public void shutdown() &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; // å®‰å…¨ç­–ç•¥åˆ¤æ–­ checkShutdownAccess(); // åˆ‡æ¢çŠ¶æ€ä¸ºSHUTDOWN advanceRunState(SHUTDOWN); // ä¸­æ–­ç©ºé—²çº¿ç¨‹ interruptIdleWorkers(); onShutdown(); // hook for ScheduledThreadPoolExecutor &#125; finally &#123; mainLock.unlock(); &#125; // å°è¯•ç»“æŸçº¿ç¨‹æ±  tryTerminate();&#125; è¿™é‡Œæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šåœ¨runWorkeræ–¹æ³•ä¸­ï¼Œæ‰§è¡Œä»»åŠ¡æ—¶å¯¹Workerå¯¹è±¡wè¿›è¡Œäº†lockæ“ä½œï¼Œä¸ºä»€ä¹ˆè¦åœ¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™å¯¹æ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½åŠ é”å‘¢ï¼Ÿ ä¸‹é¢ä»”ç»†åˆ†æä¸€ä¸‹ï¼š åœ¨getTaskæ–¹æ³•ä¸­ï¼Œå¦‚æœè¿™æ—¶çº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯SHUTDOWNå¹¶ä¸”workQueueä¸ºç©ºï¼Œé‚£ä¹ˆå°±åº”è¯¥è¿”å›nullæ¥ç»“æŸè¿™ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œè€Œä½¿çº¿ç¨‹æ± è¿›å…¥SHUTDOWNçŠ¶æ€éœ€è¦è°ƒç”¨shutdownæ–¹æ³•ï¼› shutdownæ–¹æ³•ä¼šè°ƒç”¨interruptIdleWorkersæ¥ä¸­æ–­ç©ºé—²çš„çº¿ç¨‹ï¼ŒinterruptIdleWorkersæŒæœ‰mainLockï¼Œä¼šéå†workersæ¥é€ä¸ªåˆ¤æ–­å·¥ä½œçº¿ç¨‹æ˜¯å¦ç©ºé—²ã€‚ä½†getTaskæ–¹æ³•ä¸­æ²¡æœ‰mainLockï¼› åœ¨getTaskä¸­ï¼Œå¦‚æœåˆ¤æ–­å½“å‰çº¿ç¨‹æ± çŠ¶æ€æ˜¯RUNNINGï¼Œå¹¶ä¸”é˜»å¡é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆä¼šè°ƒç”¨workQueue.take()è¿›è¡Œé˜»å¡ï¼› å¦‚æœåœ¨åˆ¤æ–­å½“å‰çº¿ç¨‹æ± çŠ¶æ€æ˜¯RUNNINGåï¼Œè¿™æ—¶è°ƒç”¨äº†shutdownæ–¹æ³•æŠŠçŠ¶æ€æ”¹ä¸ºäº†SHUTDOWNï¼Œè¿™æ—¶å¦‚æœä¸è¿›è¡Œä¸­æ–­ï¼Œé‚£ä¹ˆå½“å‰çš„å·¥ä½œçº¿ç¨‹åœ¨è°ƒç”¨äº†workQueue.take()åä¼šä¸€ç›´é˜»å¡è€Œä¸ä¼šè¢«é”€æ¯ï¼Œå› ä¸ºåœ¨SHUTDOWNçŠ¶æ€ä¸‹ä¸å…è®¸å†æœ‰æ–°çš„ä»»åŠ¡æ·»åŠ åˆ°workQueueä¸­ï¼Œè¿™æ ·ä¸€æ¥çº¿ç¨‹æ± æ°¸è¿œéƒ½å…³é—­ä¸äº†äº†ï¼› ç”±ä¸Šå¯çŸ¥ï¼Œshutdownæ–¹æ³•ä¸getTaskæ–¹æ³•ï¼ˆä»é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡æ—¶ï¼‰å­˜åœ¨ç«æ€æ¡ä»¶ï¼› è§£å†³è¿™ä¸€é—®é¢˜å°±éœ€è¦ç”¨åˆ°çº¿ç¨‹çš„ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¦ç”¨interruptIdleWorkersæ–¹æ³•ã€‚åœ¨è°ƒç”¨workQueue.take()æ—¶ï¼Œå¦‚æœå‘ç°å½“å‰çº¿ç¨‹åœ¨æ‰§è¡Œä¹‹å‰æˆ–è€…æ‰§è¡ŒæœŸé—´æ˜¯ä¸­æ–­çŠ¶æ€ï¼Œåˆ™ä¼šæŠ›å‡ºInterruptedExceptionï¼Œè§£é™¤é˜»å¡çš„çŠ¶æ€ï¼› ä½†æ˜¯è¦ä¸­æ–­å·¥ä½œçº¿ç¨‹ï¼Œè¿˜è¦åˆ¤æ–­å·¥ä½œçº¿ç¨‹æ˜¯å¦æ˜¯ç©ºé—²çš„ï¼Œå¦‚æœå·¥ä½œçº¿ç¨‹æ­£åœ¨å¤„ç†ä»»åŠ¡ï¼Œå°±ä¸åº”è¯¥å‘ç”Ÿä¸­æ–­ï¼› æ‰€ä»¥Workerç»§æ‰¿è‡ªAQSï¼Œåœ¨å·¥ä½œçº¿ç¨‹å¤„ç†ä»»åŠ¡æ—¶ä¼šè¿›è¡Œlockï¼ŒinterruptIdleWorkersåœ¨è¿›è¡Œä¸­æ–­æ—¶ä¼šä½¿ç”¨tryLockæ¥åˆ¤æ–­è¯¥å·¥ä½œçº¿ç¨‹æ˜¯å¦æ­£åœ¨å¤„ç†ä»»åŠ¡ï¼Œå¦‚æœtryLockè¿”å›trueï¼Œè¯´æ˜è¯¥å·¥ä½œçº¿ç¨‹å½“å‰æœªæ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ—¶æ‰å¯ä»¥è¢«ä¸­æ–­ã€‚ ä¸‹é¢å°±æ¥åˆ†æä¸€ä¸‹interruptIdleWorkersæ–¹æ³•ã€‚ interruptIdleWorkersæ–¹æ³•12345678910111213141516171819202122232425private void interruptIdleWorkers() &#123; interruptIdleWorkers(false);&#125;private void interruptIdleWorkers(boolean onlyOne) &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; for (Worker w : workers) &#123; Thread t = w.thread; if (!t.isInterrupted() &amp;&amp; w.tryLock()) &#123; try &#123; t.interrupt(); &#125; catch (SecurityException ignore) &#123; &#125; finally &#123; w.unlock(); &#125; &#125; if (onlyOne) break; &#125; &#125; finally &#123; mainLock.unlock(); &#125;&#125; interruptIdleWorkerséå†workersä¸­æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œè‹¥çº¿ç¨‹æ²¡æœ‰è¢«ä¸­æ–­tryLockæˆåŠŸï¼Œå°±ä¸­æ–­è¯¥çº¿ç¨‹ã€‚ ä¸ºä»€ä¹ˆéœ€è¦æŒæœ‰mainLockï¼Ÿå› ä¸ºworkersæ˜¯HashSetç±»å‹çš„ï¼Œä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ shutdownNowæ–¹æ³•1234567891011121314151617public List&lt;Runnable&gt; shutdownNow() &#123; List&lt;Runnable&gt; tasks; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; checkShutdownAccess(); advanceRunState(STOP); // ä¸­æ–­æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼Œæ— è®ºæ˜¯å¦ç©ºé—² interruptWorkers(); // å–å‡ºé˜Ÿåˆ—ä¸­æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡ tasks = drainQueue(); &#125; finally &#123; mainLock.unlock(); &#125; tryTerminate(); return tasks;&#125; shutdownNowæ–¹æ³•ä¸shutdownæ–¹æ³•ç±»ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºï¼š è®¾ç½®çŠ¶æ€ä¸ºSTOPï¼› ä¸­æ–­æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼Œæ— è®ºæ˜¯å¦æ˜¯ç©ºé—²çš„ï¼› å–å‡ºé˜»å¡é˜Ÿåˆ—ä¸­æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å¹¶è¿”å›ã€‚ shutdownNowæ–¹æ³•æ‰§è¡Œå®Œä¹‹åè°ƒç”¨tryTerminateæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨ä¸Šæ–‡å·²ç»åˆ†æè¿‡äº†ï¼Œç›®çš„å°±æ˜¯ä½¿çº¿ç¨‹æ± çš„çŠ¶æ€è®¾ç½®ä¸ºTERMINATEDã€‚ çº¿ç¨‹æ± çš„ç›‘æ§é€šè¿‡çº¿ç¨‹æ± æä¾›çš„å‚æ•°è¿›è¡Œç›‘æ§ã€‚çº¿ç¨‹æ± é‡Œæœ‰ä¸€äº›å±æ€§åœ¨ç›‘æ§çº¿ç¨‹æ± çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ getTaskCountï¼šçº¿ç¨‹æ± å·²ç»æ‰§è¡Œçš„å’Œæœªæ‰§è¡Œçš„ä»»åŠ¡æ€»æ•°ï¼› getCompletedTaskCountï¼šçº¿ç¨‹æ± å·²å®Œæˆçš„ä»»åŠ¡æ•°é‡ï¼Œè¯¥å€¼å°äºç­‰äºtaskCountï¼› getLargestPoolSizeï¼šçº¿ç¨‹æ± æ›¾ç»åˆ›å»ºè¿‡çš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚é€šè¿‡è¿™ä¸ªæ•°æ®å¯ä»¥çŸ¥é“çº¿ç¨‹æ± æ˜¯å¦æ»¡è¿‡ï¼Œä¹Ÿå°±æ˜¯è¾¾åˆ°äº†maximumPoolSizeï¼› getPoolSizeï¼šçº¿ç¨‹æ± å½“å‰çš„çº¿ç¨‹æ•°é‡ï¼› getActiveCountï¼šå½“å‰çº¿ç¨‹æ± ä¸­æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ•°é‡ã€‚ é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œå¯ä»¥å¯¹çº¿ç¨‹æ± è¿›è¡Œç›‘æ§ï¼Œåœ¨ThreadPoolExecutorç±»ä¸­æä¾›äº†å‡ ä¸ªç©ºæ–¹æ³•ï¼Œå¦‚beforeExecuteæ–¹æ³•ï¼ŒafterExecuteæ–¹æ³•å’Œterminatedæ–¹æ³•ï¼Œå¯ä»¥æ‰©å±•è¿™äº›æ–¹æ³•åœ¨æ‰§è¡Œå‰æˆ–æ‰§è¡Œåå¢åŠ ä¸€äº›æ–°çš„æ“ä½œï¼Œä¾‹å¦‚ç»Ÿè®¡çº¿ç¨‹æ± çš„æ‰§è¡Œä»»åŠ¡çš„æ—¶é—´ç­‰ï¼Œå¯ä»¥ç»§æ‰¿è‡ªThreadPoolExecutoræ¥è¿›è¡Œæ‰©å±•ã€‚ æ€»ç»“æœ¬æ–‡æ¯”è¾ƒè¯¦ç»†çš„åˆ†æäº†çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹ï¼Œæ€»ä½“æ¥è¯´æœ‰å¦‚ä¸‹å‡ ä¸ªå†…å®¹ï¼š åˆ†æäº†çº¿ç¨‹çš„åˆ›å»ºï¼Œä»»åŠ¡çš„æäº¤ï¼ŒçŠ¶æ€çš„è½¬æ¢ä»¥åŠçº¿ç¨‹æ± çš„å…³é—­ï¼› è¿™é‡Œé€šè¿‡executeæ–¹æ³•æ¥å±•å¼€çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹ï¼Œexecuteæ–¹æ³•é€šè¿‡corePoolSizeï¼ŒmaximumPoolSizeä»¥åŠé˜»å¡é˜Ÿåˆ—çš„å¤§å°æ¥åˆ¤æ–­å†³å®šä¼ å…¥çš„ä»»åŠ¡åº”è¯¥è¢«ç«‹å³æ‰§è¡Œï¼Œè¿˜æ˜¯åº”è¯¥æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œè¿˜æ˜¯åº”è¯¥æ‹’ç»ä»»åŠ¡ã€‚ ä»‹ç»äº†çº¿ç¨‹æ± å…³é—­æ—¶çš„è¿‡ç¨‹ï¼Œä¹Ÿåˆ†æäº†shutdownæ–¹æ³•ä¸getTaskæ–¹æ³•å­˜åœ¨ç«æ€æ¡ä»¶ï¼› åœ¨è·å–ä»»åŠ¡æ—¶ï¼Œè¦é€šè¿‡çº¿ç¨‹æ± çš„çŠ¶æ€æ¥åˆ¤æ–­åº”è¯¥ç»“æŸå·¥ä½œçº¿ç¨‹è¿˜æ˜¯é˜»å¡çº¿ç¨‹ç­‰å¾…æ–°çš„ä»»åŠ¡ï¼Œä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆå…³é—­çº¿ç¨‹æ± æ—¶è¦ä¸­æ–­å·¥ä½œçº¿ç¨‹ä»¥åŠä¸ºä»€ä¹ˆæ¯ä¸€ä¸ªworkeréƒ½éœ€è¦lockã€‚ åœ¨å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡æ—¶ï¼Œé™¤äº†executeæ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ä¸ªsubmitæ–¹æ³•ï¼Œsubmitæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªFutureå¯¹è±¡ç”¨äºè·å–è¿”å›å€¼ï¼Œå…·ä½“å¯ä»¥è§ å¤šçº¿ç¨‹ï¼ˆä¸€ï¼‰ä¸­çš„ æœ€å¼€å§‹çš„ demoã€‚ é‡åˆ°çš„é—®é¢˜æœ€è¿‘å¥½ä¹…æ²¡å¤ä¹ äº†ï¼Œçªç„¶æœ‰ç‚¹å¯¹çº¿ç¨‹æ± æ™•å¤´è½¬å‘ï¼Œé˜»å¡é˜Ÿåˆ—åˆ°åº•æ˜¯å­˜å‚¨ä»€ä¹ˆçš„å‘¢ï¼Ÿé‡Œé¢æ˜¯æ€ä¹ˆä¸€ä¸ªå­˜å‚¨å½¢å¼å‘¢ï¼Ÿé˜»å¡é˜Ÿåˆ—åˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿé˜»å¡é˜Ÿåˆ—å’Œ AQS ä¸­çš„ CLH å˜ä½“é˜Ÿåˆ—åˆæœ‰ä»€ä¹ˆå…³ç³»å’Œè”ç³»å‘¢ï¼Ÿçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åˆæ˜¯å¦‚ä½•ç®¡ç†çš„å‘¢ï¼Ÿä»–ä»¬æ˜¯å¦‚ä½•å­˜å‚¨çš„å‘¢ï¼Ÿçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åˆæ˜¯æ€ä¹ˆå»è¿ä½œçš„å‘¢ï¼Ÿ æ¥ï¼Œè¿™äº›é—®é¢˜ä¸€ä¸ªä¸€ä¸ªæ¥è§£å†³ï¼ é˜»å¡é˜Ÿåˆ—åˆ°åº•å­˜å‚¨çš„æ˜¯ä»€ä¹ˆï¼Ÿ å­˜å‚¨çš„æ˜¯ Runnable å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ä»»åŠ¡ é‡Œé¢æ˜¯å¦‚ä½•å­˜å‚¨ä»¥åŠå¦‚ä½•å®ç°çš„ï¼Ÿ ArrayBlockingQueue æ˜¯åˆ©ç”¨æ•°ç»„å­˜å‚¨çš„ï¼ŒLinkedBlockingQueue æ˜¯åˆ©ç”¨çš„é“¾è¡¨å­˜å‚¨çš„ï¼Œè¿™é‡Œæ¯”æ™®é€šçš„é˜Ÿåˆ—å¤šäº†ä¸€ä¸ªä½¿ç”¨äº† ReentrantLock ä¿è¯çº¿ç¨‹å®‰å…¨å¹¶ä¸”é€šè¿‡ä½¿ç”¨ Condition é˜Ÿåˆ—ä¿è¯æ¶ˆè´¹è€…/ç”Ÿäº§è€…æ¨¡å¼ã€‚ é˜»å¡é˜Ÿåˆ—å’Œ AQS çš„ CLHå˜ä½“é˜Ÿåˆ—æœ‰å•¥å…³ç³»å’Œè”ç³» æ²¡æœ‰ä»»ä½•å…³ç³»ï¼ŒCLH å˜ä½“é˜Ÿåˆ—æ˜¯åŒæ­¥é˜Ÿåˆ—ï¼Œå­˜å‚¨çš„æ˜¯çº¿ç¨‹åŒ…è£…åçš„ Nodeï¼Œæˆ‘ä»¬è¿™é‡Œçš„é˜»å¡é˜Ÿåˆ—ä»…ä»…æ˜¯ä»»åŠ¡åŒ…è£…åçš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ CLH å˜ä½“é˜Ÿåˆ—é‚£ä¹ˆå¤æ‚ï¼Œä¸éœ€è¦è¿›è¡Œä¸€ä¸ªçº¿ç¨‹å”¤é†’é˜»å¡çš„è¿‡ç¨‹ã€Œparkã€unparkã€ï¼Œä¹Ÿæ— éœ€å»è€ƒè™‘å…±äº«é”å’Œç‹¬å é”ä¹‹ç±»çš„ï¼Œæ›´ä¸ç”¨è€ƒè™‘åŒæ­¥é˜Ÿåˆ—å’Œæ¡ä»¶é˜Ÿåˆ—çš„åˆ‡æ¢è¿‡ç¨‹ã€‚ çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¦‚ä½•ç®¡ç†çš„å‘¢ï¼Ÿåˆæ˜¯å¦‚ä½•å­˜å‚¨çš„å‘¢ï¼Ÿ çº¿ç¨‹æ± å…¶å®ç®¡ç†çš„å¹¶ä¸æ˜¯çº¿ç¨‹ï¼Œè€Œæ˜¯ Workerï¼ŒWorker åŒ…æ‹¬çš„å±æ€§æœ‰çº¿ç¨‹ã€ä»»åŠ¡ï¼Œæ¯ä¸€ä¸ª Worker éƒ½æ˜¯ç”¨ HashSet å­˜å‚¨çš„ã€‚ çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¦‚ä½•è¿ä½œçš„ï¼Ÿ æœ€å¼€å§‹çš„ Worker æ˜¯ç›´æ¥ä»»åŠ¡æ¥äº†å°±ç›´æ¥ new thread å¹¶æ¥å—ä»»åŠ¡ï¼Œå› ä¸ºæ­¤æ—¶è¿˜æ²¡åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå½“åˆ°äº†æ ¸å¿ƒçº¿ç¨‹æ•°ä¹‹åï¼ŒWorker å°±ä¼šå»é˜Ÿåˆ—é‡Œ take ç›¸åº”çš„ä»»åŠ¡ï¼Œå¦‚æœé˜Ÿåˆ—ä¹Ÿæ»¡äº†çš„è¯ï¼Œå°±å» new æ–°çš„ Worker æ¥å—ä»»åŠ¡ï¼Œå¦‚æœåˆ°äº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œå°±ç›´æ¥é»˜è®¤æŠ›å¼‚å¸¸ã€Œå½“ç„¶è¿˜æœ‰å¦å¤–ä¸‰ç§æªæ–½ï¼š1. ä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­æœ€å‰é¢çš„ 2. ç›´æ¥ä¸ç®¡è¿™ä¸ªä»»åŠ¡ 3. ä½¿ç”¨è°ƒç”¨çš„è¿™ä¸ªçº¿ç¨‹å»æ‰§è¡Œã€ã€‚ è¿™é‡Œ Worker å»æ‹¿ä»»åŠ¡éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œç”±äº é˜»å¡é˜Ÿåˆ—æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨ä¸€ä¸ªä»»åŠ¡å¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹å–èµ°ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå…¶æ¬¡ï¼Œå¾—æ³¨æ„ä¸€ä¸‹ï¼ŒWorker æœ‰å»ç»§æ‰¿ AQSï¼Œè¿™æ˜¯æˆ‘è®¤ä¸ºçº¿ç¨‹æ± ä¸­å†™çš„æœ€å¥½çš„ä¸€å—ï¼Œä¸»è¦æ˜¯è§£å†³äº†ä¸¤ä¸ªé—®é¢˜ã€Œæ”¯æŒä¸­æ–­ä»¥åŠæ ‡è®°çº¿ç¨‹æ˜¯å¦ç©ºé—²ã€ï¼Œæˆ‘ä¸‹é¢ä¹Ÿæœ‰è¯¦ç»†è¯´è¿™ä¸ªã€‚ è¿™ä¸ªä¹Ÿè®²çš„è¿˜è¡Œï¼šhttps://www.cnblogs.com/micrari/p/7429364.html å¦‚ä½•ä¿è¯æ ¸å¿ƒçº¿ç¨‹ä¸è¢«é”€æ¯ timedOutè¶…æ—¶æ ‡è®°é»˜è®¤è®¾ç½®ä¸ºfalseï¼› è®¡ç®—timedçš„å€¼ï¼Œè¯¥å€¼å†³å®šäº†çº¿ç¨‹çš„ç”Ÿæ­»å¤§æƒï¼Œ(timed &amp;&amp; timedOut) å³æ˜¯çº¿ç¨‹è¶…æ—¶å›æ”¶çš„æ¡ä»¶ä¹‹ä¸€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç¬¬ä¸€æ¬¡(timed &amp;&amp; timedOut) ä¸ºfalseï¼Œå› ä¸ºtimedOuté»˜è®¤å€¼ä¸ºfalseï¼Œæ­¤æ—¶è¿˜æ²¡åˆ°pollè¶…æ—¶è·å–çš„æ“ä½œï¼› æ ¹æ®timedå€¼æ¥å†³å®šæ˜¯ç”¨é˜»å¡è¶…æ—¶è·å–ä»»åŠ¡è¿˜æ˜¯é˜»å¡è·å–ä»»åŠ¡ï¼Œå¦‚æœç”¨é˜»å¡è¶…æ—¶è·å–ä»»åŠ¡ï¼Œè¶…æ—¶åtimedOutä¼šè¢«è®¾ç½®ä¸ºtrueï¼Œæ¥ç€ç»§ç»­å¾ªç¯ï¼Œè‹¥(timed &amp;&amp; timedOut) ä¸ºtrueï¼Œæ»¡è¶³çº¿ç¨‹è¶…æ—¶å›æ”¶ã€‚ æ²¡æœ‰ç»„ç»‡çš„ä¸€äº›è¯ï¼Œç•™åœ¨è¿™å§ï¼Œå½“æ—¶æƒ³åˆ°å•¥å°±è¯´å•¥äº† ã€Œé—®é¢˜çš„æ ¸å¿ƒæ˜¯åŒºåˆ†å¼€ Runnable å’Œ Threadçš„åŒºåˆ«ï¼Œä¸€ä¸ªæ˜¯ä»»åŠ¡ï¼Œä¸€ä¸ªæ˜¯çº¿ç¨‹ã€ ã€Œé˜»å¡é˜Ÿåˆ—ä¸­å­˜å‚¨çš„æ˜¯Runnableï¼Œé˜»å¡é˜Ÿåˆ—åº•å±‚å°±æ˜¯é“¾è¡¨å®ç°ï¼Œç„¶åé€šè¿‡ ReentrantLock è¾¾åˆ°çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸”é€šè¿‡ Condition å®Œæˆç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼ï¼Œç„¶åçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä½¿ç”¨ hashSet å­˜å‚¨ï¼Œæ ¸å¿ƒçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ç”±äº timeoutç­‰äºæ— ç©·æ‰€ä»¥ä¸ä¼šè¢«é”€æ¯ã€‚é˜»å¡é˜Ÿåˆ—å’Œ AQS æ²¡æœ‰å…³ç³»ï¼Œåªæ˜¯ç”¨åˆ°äº† Condition å’Œ ReentrantLock ã€ ã€Œçº¿ç¨‹æ± çš„çº¿ç¨‹ï¼Œnew å‡ºæ¥åï¼Œä¼šè¢«å°è£…æˆ Worker å¯¹è±¡ï¼Œç„¶åé‡Œé¢å¯ä»¥è¿è¡Œä»»åŠ¡ï¼Œæ‰€æœ‰çš„ Worker æ˜¯æ”¾åœ¨ HashSet ä¸­çš„ã€‚ã€ ã€Œçº¿ç¨‹æ± ä¸­æˆ‘è§‰å¾—æœ€ç²¾å¦™çš„åœ°æ–¹æ˜¯è®© worker å»ç»§æ‰¿ AQSï¼Œè¿™æ˜¯éå¸¸å·§å¦™çš„è®¾è®¡ï¼Œè¿™ä¸ªè®¾è®¡ä¸»è¦æ˜¯ä¸ºäº†åœ¨æ›´æ”¹ shutdown å’Œ stop çš„æ—¶å€™åšå‡ºçš„è®¾è®¡ï¼Œ æˆ‘ä»¬çŸ¥é“ï¼Œshutdownå°±æ˜¯ä¸å†æ¥å—æ–°çš„ä»»åŠ¡ï¼Œä½†æ˜¯ä¸èƒ½æŠŠæ­£åœ¨è¿è¡Œçš„ä»»åŠ¡åœæ‰ï¼ŒåŒæ—¶è¦æŠŠå¤„äºç©ºé—²çš„çŠ¶æ€çš„çº¿ç¨‹åœæ‰ï¼Œåœ¨è¿™é‡Œå¦‚ä½•åŒºåˆ†çº¿ç¨‹æ˜¯å¦ç©ºé—²æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œæºç çš„è§£å†³æ–¹æ¡ˆæ˜¯è®© worker åŒ…è£…æˆä¸€ä¸ªäº’æ–¥é”ï¼Œå¦‚æœåœ¨è¿è¡Œå°±ç»™è‡ªå·±åŠ é”ï¼Œè¿™æ ·æˆ‘åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ç©ºé—²å°±å¯ä»¥ç›´æ¥ç”¨ tryAcquire() å»åˆ¤æ–­äº†ï¼› åŸå› ä¹‹äºŒå°±æ˜¯ stop çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦å¼ºåˆ¶åœæ‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡çš„ï¼Œè€ŒAQSåˆšå¥½å°±æä¾›å“åº”ä¸­æ–­ï¼Œæ‰€ä»¥è¿™åˆæ˜¯workerç»§æ‰¿AQSçš„ä¸€å¤§åŸå› ã€‚ã€ http://objcoding.com/2019/04/25/threadpool-running/#worker è¿™ä¸ªå¯¹ â€å¦‚ä½•ä¿è¯æ ¸å¿ƒçº¿ç¨‹ä¸è¢«é”€æ¯â€œè®²çš„æŒºå¥½çš„ çº¿ç¨‹æ± ï¼ˆäºŒï¼‰ï¼šScheduledThreadPoolExecutor è½¬ï¼šhttp://www.ideabuffer.cn/2017/04/14/æ·±å…¥ç†è§£Javaçº¿ç¨‹æ± ï¼šScheduledThreadPoolExecutor/ ä»‹ç»è‡ªJDK1.5å¼€å§‹ï¼ŒJDKæä¾›äº†ScheduledThreadPoolExecutorç±»æ¥æ”¯æŒå‘¨æœŸæ€§ä»»åŠ¡çš„è°ƒåº¦ã€‚åœ¨è¿™ä¹‹å‰çš„å®ç°éœ€è¦ä¾é Timerå’ŒTimerTaskæˆ–è€…å…¶å®ƒç¬¬ä¸‰æ–¹å·¥å…·æ¥å®Œæˆã€‚ä½†Timeræœ‰ä¸å°‘çš„ç¼ºé™·ï¼š Timeræ˜¯å•çº¿ç¨‹æ¨¡å¼ï¼› å¦‚æœåœ¨æ‰§è¡Œä»»åŠ¡æœŸé—´æŸä¸ªTimerTaskè€—æ—¶è¾ƒä¹…ï¼Œé‚£ä¹ˆå°±ä¼šå½±å“å…¶å®ƒä»»åŠ¡çš„è°ƒåº¦ï¼› Timerçš„ä»»åŠ¡è°ƒåº¦æ˜¯åŸºäºç»å¯¹æ—¶é—´çš„ï¼Œå¯¹ç³»ç»Ÿæ—¶é—´æ•æ„Ÿï¼› Timerä¸ä¼šæ•è·æ‰§è¡ŒTimerTaskæ—¶æ‰€æŠ›å‡ºçš„å¼‚å¸¸ï¼Œç”±äºTimeræ˜¯å•çº¿ç¨‹ï¼Œæ‰€ä»¥ä¸€æ—¦å‡ºç°å¼‚å¸¸ï¼Œåˆ™çº¿ç¨‹å°±ä¼šç»ˆæ­¢ï¼Œå…¶ä»–ä»»åŠ¡ä¹Ÿå¾—ä¸åˆ°æ‰§è¡Œã€‚ ScheduledThreadPoolExecutorç»§æ‰¿ThreadPoolExecutoræ¥é‡ç”¨çº¿ç¨‹æ± çš„åŠŸèƒ½ï¼Œå®ƒçš„å®ç°æ–¹å¼å¦‚ä¸‹ï¼š å°†ä»»åŠ¡å°è£…æˆScheduledFutureTaskå¯¹è±¡ï¼ŒScheduledFutureTaskåŸºäºç›¸å¯¹æ—¶é—´ï¼Œä¸å—ç³»ç»Ÿæ—¶é—´çš„æ”¹å˜æ‰€å½±å“ï¼› ScheduledFutureTaskå®ç°äº†java.lang.Comparableæ¥å£å’Œjava.util.concurrent.Delayedæ¥å£ï¼Œæ‰€ä»¥æœ‰ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•ï¼šcompareToå’ŒgetDelayã€‚compareToæ–¹æ³•ç”¨äºæ¯”è¾ƒä»»åŠ¡ä¹‹é—´çš„ä¼˜å…ˆçº§å…³ç³»ï¼Œå¦‚æœè·ç¦»ä¸‹æ¬¡æ‰§è¡Œçš„æ—¶é—´é—´éš”è¾ƒçŸ­ï¼Œåˆ™ä¼˜å…ˆçº§é«˜ï¼›getDelayæ–¹æ³•ç”¨äºè¿”å›è·ç¦»ä¸‹æ¬¡ä»»åŠ¡æ‰§è¡Œæ—¶é—´çš„æ—¶é—´é—´éš”ï¼› ScheduledThreadPoolExecutorå®šä¹‰äº†ä¸€ä¸ªDelayedWorkQueueï¼Œå®ƒæ˜¯ä¸€ä¸ªæœ‰åºé˜Ÿåˆ—ï¼Œä¼šé€šè¿‡æ¯ä¸ªä»»åŠ¡æŒ‰ç…§è·ç¦»ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´é—´éš”çš„å¤§å°æ¥æ’åºï¼› ScheduledFutureTaskç»§æ‰¿è‡ªFutureTaskï¼Œå¯ä»¥é€šè¿‡è¿”å›Futureå¯¹è±¡æ¥è·å–æ‰§è¡Œçš„ç»“æœã€‚ é€šè¿‡å¦‚ä¸Šçš„ä»‹ç»ï¼Œå¯ä»¥å¯¹æ¯”ä¸€ä¸‹Timerå’ŒScheduledThreadPoolExecutorï¼š Timer ScheduledThreadPoolExecutor å•çº¿ç¨‹ å¤šçº¿ç¨‹ å•ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´å½±å“å…¶ä»–ä»»åŠ¡è°ƒåº¦ å¤šçº¿ç¨‹ï¼Œä¸ä¼šå½±å“ åŸºäºç»å¯¹æ—¶é—´ åŸºäºç›¸å¯¹æ—¶é—´ ä¸€æ—¦æ‰§è¡Œä»»åŠ¡å‡ºç°å¼‚å¸¸ä¸ä¼šæ•è·ï¼Œå…¶ä»–ä»»åŠ¡å¾—ä¸åˆ°æ‰§è¡Œ å¤šçº¿ç¨‹ï¼Œå•ä¸ªä»»åŠ¡çš„æ‰§è¡Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹ æ‰€ä»¥ï¼Œåœ¨JDK1.5ä¹‹åï¼Œåº”è¯¥æ²¡ä»€ä¹ˆç†ç”±ç»§ç»­ä½¿ç”¨Timerè¿›è¡Œä»»åŠ¡è°ƒåº¦äº†ã€‚ ScheduledThreadPoolExecutorçš„ä½¿ç”¨ä¸‹é¢ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥è¯´æ˜ScheduledThreadPoolExecutorçš„ä½¿ç”¨ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253public class ScheduledThreadPoolTest &#123; public static void main(String[] args) throws InterruptedException &#123; // åˆ›å»ºå¤§å°ä¸º5çš„çº¿ç¨‹æ±  ScheduledExecutorService scheduledThreadPool = Executors.newScheduledThreadPool(5); for (int i = 0; i &lt; 3; i++) &#123; Task worker = new Task("task-" + i); // åªæ‰§è¡Œä¸€æ¬¡// scheduledThreadPool.schedule(worker, 5, TimeUnit.SECONDS); // å‘¨æœŸæ€§æ‰§è¡Œï¼Œæ¯5ç§’æ‰§è¡Œä¸€æ¬¡ scheduledThreadPool.scheduleAtFixedRate(worker, 0,5, TimeUnit.SECONDS); &#125; Thread.sleep(10000); System.out.println("Shutting down executor..."); // å…³é—­çº¿ç¨‹æ±  scheduledThreadPool.shutdown(); boolean isDone; // ç­‰å¾…çº¿ç¨‹æ± ç»ˆæ­¢ do &#123; isDone = scheduledThreadPool.awaitTermination(1, TimeUnit.DAYS); System.out.println("awaitTermination..."); &#125; while(!isDone); System.out.println("Finished all threads"); &#125;&#125;class Task implements Runnable &#123; private String name; public Task(String name) &#123; this.name = name; &#125; @Override public void run() &#123; System.out.println("name = " + name + ", startTime = " + new Date()); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println("name = " + name + ", endTime = " + new Date()); &#125;&#125; ä¸‹é¢å°±æ¥å…·ä½“åˆ†æä¸€ä¸‹ScheduledThreadPoolExecutorçš„å®ç°è¿‡ç¨‹ã€‚ ScheduledThreadPoolExecutorçš„å®ç°ScheduledThreadPoolExecutorçš„ç±»ç»“æ„çœ‹ä¸‹ScheduledThreadPoolExecutorå†…éƒ¨çš„ç±»å›¾ï¼š ä¸è¦è¢«è¿™ä¹ˆå¤šç±»å“åˆ°ï¼Œè¿™é‡Œåªä¸è¿‡æ˜¯ä¸ºäº†æ›´æ¸…æ¥šçš„äº†è§£ScheduledThreadPoolExecutoræœ‰å…³è°ƒåº¦å’Œé˜Ÿåˆ—çš„æ¥å£ã€‚ ScheduledThreadPoolExecutorç»§æ‰¿è‡ªThreadPoolExecutorï¼Œå®ç°äº†ScheduledExecutorServiceæ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰äº†scheduleç­‰ä»»åŠ¡è°ƒåº¦çš„æ–¹æ³•ã€‚ åŒæ—¶ScheduledThreadPoolExecutoræœ‰ä¸¤ä¸ªé‡è¦çš„å†…éƒ¨ç±»ï¼šDelayedWorkQueueå’ŒScheduledFutureTaskã€‚å¯ä»¥çœ‹åˆ°ï¼ŒDelayeddWorkQueueæ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œè€ŒScheduledFutureTaskç»§æ‰¿è‡ªFutureTaskï¼Œå¹¶ä¸”å®ç°äº†Delayedæ¥å£ã€‚æœ‰å…³FutureTaskçš„ä»‹ç»è¯·å‚è€ƒå¦ä¸€ç¯‡æ–‡ç« ï¼šFutureTaskæºç è§£æã€‚ ScheduledThreadPoolExecutorçš„æ„é€ æ–¹æ³•ScheduledThreadPoolExecutoræœ‰3ä¸­æ„é€ æ–¹æ³•ï¼š 123456789101112131415161718public ScheduledThreadPoolExecutor(int corePoolSize, ThreadFactory threadFactory) &#123; super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS, new DelayedWorkQueue(), threadFactory);&#125;public ScheduledThreadPoolExecutor(int corePoolSize, RejectedExecutionHandler handler) &#123; super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS, new DelayedWorkQueue(), handler);&#125;public ScheduledThreadPoolExecutor(int corePoolSize, ThreadFactory threadFactory, RejectedExecutionHandler handler) &#123; super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS, new DelayedWorkQueue(), threadFactory, handler);&#125; å› ä¸ºScheduledThreadPoolExecutorç»§æ‰¿è‡ªThreadPoolExecutorï¼Œæ‰€ä»¥è¿™é‡Œéƒ½æ˜¯è°ƒç”¨çš„ThreadPoolExecutorç±»çš„æ„é€ æ–¹æ³•ã€‚æœ‰å…³ThreadPoolExecutorå¯ä»¥å‚è€ƒæ·±å…¥ç†è§£Javaçº¿ç¨‹æ± ï¼šThreadPoolExecutorã€‚ è¿™é‡Œæ³¨æ„ä¼ å…¥çš„é˜»å¡é˜Ÿåˆ—æ˜¯DelayedWorkQueueç±»å‹çš„å¯¹è±¡ã€‚åé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚ scheduleæ–¹æ³•åœ¨ä¸Šæ–‡çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨äº†scheduleæ–¹æ³•æ¥è¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼Œscheduleæ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324public ScheduledFuture&lt;?&gt; schedule(Runnable command, long delay, TimeUnit unit) &#123; if (command == null || unit == null) throw new NullPointerException(); RunnableScheduledFuture&lt;?&gt; t = decorateTask(command, new ScheduledFutureTask&lt;Void&gt;(command, null, triggerTime(delay, unit))); delayedExecute(t); return t;&#125;public &lt;V&gt; ScheduledFuture&lt;V&gt; schedule(Callable&lt;V&gt; callable, long delay, TimeUnit unit) &#123; if (callable == null || unit == null) throw new NullPointerException(); RunnableScheduledFuture&lt;V&gt; t = decorateTask(callable, new ScheduledFutureTask&lt;V&gt;(callable, triggerTime(delay, unit))); delayedExecute(t); return t;&#125; é¦–å…ˆï¼Œè¿™é‡Œçš„ä¸¤ä¸ªé‡è½½çš„scheduleæ–¹æ³•åªæ˜¯ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸åŒï¼Œå¯ä»¥æ˜¯Runnableå¯¹è±¡æˆ–è€…Callableå¯¹è±¡ã€‚ä¼šæŠŠä¼ å…¥çš„ä»»åŠ¡å°è£…æˆä¸€ä¸ªRunnableScheduledFutureå¯¹è±¡ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ScheduledFutureTaskå¯¹è±¡ï¼ŒdecorateTaské»˜è®¤ä»€ä¹ˆåŠŸèƒ½éƒ½æ²¡æœ‰åšï¼Œå­ç±»å¯ä»¥é‡å†™è¯¥æ–¹æ³•ï¼š 123456789101112131415/** * ä¿®æ”¹æˆ–æ›¿æ¢ç”¨äºæ‰§è¡Œ runnable çš„ä»»åŠ¡ã€‚æ­¤æ–¹æ³•å¯é‡å†™ç”¨äºç®¡ç†å†…éƒ¨ä»»åŠ¡çš„å…·ä½“ç±»ã€‚é»˜è®¤å®ç°åªè¿”å›ç»™å®šä»»åŠ¡ã€‚ */protected &lt;V&gt; RunnableScheduledFuture&lt;V&gt; decorateTask( Runnable runnable, RunnableScheduledFuture&lt;V&gt; task) &#123; return task;&#125;/** * ä¿®æ”¹æˆ–æ›¿æ¢ç”¨äºæ‰§è¡Œ callable çš„ä»»åŠ¡ã€‚æ­¤æ–¹æ³•å¯é‡å†™ç”¨äºç®¡ç†å†…éƒ¨ä»»åŠ¡çš„å…·ä½“ç±»ã€‚é»˜è®¤å®ç°åªè¿”å›ç»™å®šä»»åŠ¡ã€‚ */protected &lt;V&gt; RunnableScheduledFuture&lt;V&gt; decorateTask( Callable&lt;V&gt; callable, RunnableScheduledFuture&lt;V&gt; task) &#123; return task;&#125; ç„¶åï¼Œé€šè¿‡è°ƒç”¨delayedExecuteæ–¹æ³•æ¥å»¶æ—¶æ‰§è¡Œä»»åŠ¡ã€‚æœ€åï¼Œè¿”å›ä¸€ä¸ªScheduledFutureå¯¹è±¡ã€‚ scheduleAtFixedRateæ–¹æ³•è¯¥æ–¹æ³•è®¾ç½®äº†æ‰§è¡Œå‘¨æœŸï¼Œä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶é—´ç›¸å½“äºæ˜¯ä¸Šä¸€æ¬¡çš„æ‰§è¡Œæ—¶é—´åŠ ä¸Šperiodï¼Œå®ƒæ˜¯é‡‡ç”¨å·²å›ºå®šçš„é¢‘ç‡æ¥æ‰§è¡Œä»»åŠ¡ï¼š 123456789101112131415161718public ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command, long initialDelay, long period, TimeUnit unit) &#123; if (command == null || unit == null) throw new NullPointerException(); if (period &lt;= 0) throw new IllegalArgumentException(); ScheduledFutureTask&lt;Void&gt; sft = new ScheduledFutureTask&lt;Void&gt;(command, null, triggerTime(initialDelay, unit), unit.toNanos(period)); RunnableScheduledFuture&lt;Void&gt; t = decorateTask(command, sft); sft.outerTask = t; delayedExecute(t); return t;&#125; scheduleWithFixedDelayæ–¹æ³•è¯¥æ–¹æ³•è®¾ç½®äº†æ‰§è¡Œå‘¨æœŸï¼Œä¸scheduleAtFixedRateæ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶é—´æ˜¯ä¸Šä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œå®Œçš„ç³»ç»Ÿæ—¶é—´åŠ ä¸Šperiodï¼Œå› è€Œå…·ä½“æ‰§è¡Œæ—¶é—´ä¸æ˜¯å›ºå®šçš„ï¼Œä½†å‘¨æœŸæ˜¯å›ºå®šçš„ï¼Œæ˜¯é‡‡ç”¨ç›¸å¯¹å›ºå®šçš„å»¶è¿Ÿæ¥æ‰§è¡Œä»»åŠ¡ï¼š 123456789101112131415161718public ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable command, long initialDelay, long delay, TimeUnit unit) &#123; if (command == null || unit == null) throw new NullPointerException(); if (delay &lt;= 0) throw new IllegalArgumentException(); ScheduledFutureTask&lt;Void&gt; sft = new ScheduledFutureTask&lt;Void&gt;(command, null, triggerTime(initialDelay, unit), unit.toNanos(-delay)); RunnableScheduledFuture&lt;Void&gt; t = decorateTask(command, sft); sft.outerTask = t; delayedExecute(t); return t;&#125; æ³¨æ„è¿™é‡Œçš„unit.toNanos(-delay));ï¼Œè¿™é‡ŒæŠŠå‘¨æœŸè®¾ç½®ä¸ºè´Ÿæ•°æ¥è¡¨ç¤ºæ˜¯ç›¸å¯¹å›ºå®šçš„å»¶è¿Ÿæ‰§è¡Œã€‚ scheduleAtFixedRateå’ŒscheduleWithFixedDelayçš„åŒºåˆ«åœ¨setNextRunTimeæ–¹æ³•ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ï¼š 123456789private void setNextRunTime() &#123; long p = period; // å›ºå®šé¢‘ç‡ï¼Œä¸Šæ¬¡æ‰§è¡Œæ—¶é—´åŠ ä¸Šå‘¨æœŸæ—¶é—´ if (p &gt; 0) time += p; // ç›¸å¯¹å›ºå®šå»¶è¿Ÿæ‰§è¡Œï¼Œä½¿ç”¨å½“å‰ç³»ç»Ÿæ—¶é—´åŠ ä¸Šå‘¨æœŸæ—¶é—´ else time = triggerTime(-p);&#125; setNextRunTimeæ–¹æ³•ä¼šåœ¨runæ–¹æ³•ä¸­æ‰§è¡Œå®Œä»»åŠ¡åè°ƒç”¨ã€‚ triggerTimeæ–¹æ³•triggerTimeæ–¹æ³•ç”¨äºè·å–ä¸‹ä¸€æ¬¡æ‰§è¡Œçš„å…·ä½“æ—¶é—´ï¼š 123456789private long triggerTime(long delay, TimeUnit unit) &#123; return triggerTime(unit.toNanos((delay &lt; 0) ? 0 : delay));&#125;long triggerTime(long delay) &#123; return now() + ((delay &lt; (Long.MAX_VALUE &gt;&gt; 1)) ? delay : overflowFree(delay));&#125; è¿™é‡Œçš„delay &lt; (Long.MAX_VALUE &gt;&gt; 1æ˜¯ä¸ºäº†åˆ¤æ–­æ˜¯å¦è¦é˜²æ­¢Longç±»å‹æº¢å‡ºï¼Œå¦‚æœdelayçš„å€¼å°äºLongç±»å‹æœ€å¤§å€¼çš„ä¸€åŠï¼Œåˆ™ç›´æ¥è¿”å›delayï¼Œå¦åˆ™éœ€è¦è¿›è¡Œé˜²æ­¢æº¢å‡ºå¤„ç†ã€‚ overflowFreeæ–¹æ³•è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯é™åˆ¶é˜Ÿåˆ—ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å»¶è¿Ÿæ—¶é—´åœ¨Long.MAX_VALUEä¹‹å†…ï¼Œé˜²æ­¢åœ¨compareToæ–¹æ³•ä¸­æº¢å‡ºã€‚ 12345678910111213private long overflowFree(long delay) &#123; // è·å–é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ Delayed head = (Delayed) super.getQueue().peek(); if (head != null) &#123; // è·å–å»¶è¿Ÿæ—¶é—´ long headDelay = head.getDelay(NANOSECONDS); // å¦‚æœå»¶è¿Ÿæ—¶é—´å°äº0ï¼Œå¹¶ä¸” delay - headDelay è¶…è¿‡äº†Long.MAX_VALUE // å°†delayè®¾ç½®ä¸º Long.MAX_VALUE + headDelay ä¿è¯delayå°äºLong.MAX_VALUE if (headDelay &lt; 0 &amp;&amp; (delay - headDelay &lt; 0)) delay = Long.MAX_VALUE + headDelay; &#125; return delay;&#125; å½“ä¸€ä¸ªä»»åŠ¡å·²ç»å¯ä»¥æ‰§è¡Œå‡ºé˜Ÿæ“ä½œï¼Œä½†è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œå¯èƒ½ç”±äºçº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹ä¸æ˜¯ç©ºé—²çš„ã€‚å…·ä½“åˆ†æä¸€ä¸‹è¿™ç§æƒ…å†µï¼š ä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œå‡è®¾Long.MAX_VALUE=1023ï¼Œä¹Ÿå°±æ˜¯11ä½ï¼Œå¹¶ä¸”å½“å‰çš„æ—¶é—´æ˜¯100ï¼Œè°ƒç”¨triggerTimeæ—¶å¹¶æ²¡æœ‰å¯¹delayè¿›è¡Œåˆ¤æ–­ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›äº†now() + delayï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äº100 + 1023ï¼Œè¿™è‚¯å®šæ˜¯æº¢å‡ºäº†ï¼Œé‚£ä¹ˆè¿”å›çš„æ—¶é—´æ˜¯-925ï¼› å¦‚æœå¤´èŠ‚ç‚¹å·²ç»å¯ä»¥å‡ºé˜Ÿä½†æ˜¯è¿˜æ²¡æœ‰æ‰§è¡Œå‡ºé˜Ÿï¼Œé‚£ä¹ˆå¤´èŠ‚ç‚¹çš„æ‰§è¡Œæ—¶é—´åº”è¯¥æ˜¯å°äºå½“å‰æ—¶é—´çš„ï¼Œå‡è®¾æ˜¯95ï¼› è¿™æ—¶è°ƒç”¨offeræ–¹æ³•å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ï¼Œåœ¨offeræ–¹æ³•ä¸­ä¼šè°ƒç”¨siftUpæ–¹æ³•æ¥æ’åºï¼Œåœ¨siftUpæ–¹æ³•æ‰§è¡Œæ—¶åˆä¼šè°ƒç”¨ScheduledFutureTaskä¸­çš„compareToæ–¹æ³•æ¥æ¯”è¾ƒæ‰§è¡Œæ—¶é—´ï¼› è¿™æ—¶å¦‚æœæ‰§è¡Œåˆ°äº†compareToæ–¹æ³•ä¸­çš„long diff = time - x.time;æ—¶ï¼Œé‚£ä¹ˆè®¡ç®—åçš„ç»“æœå°±æ˜¯-925 - 95 = -1020ï¼Œé‚£ä¹ˆå°†è¿”å›-1ï¼Œè€Œæ­£å¸¸æƒ…å†µåº”è¯¥æ˜¯è¿”å›1ï¼Œå› ä¸ºæ–°åŠ å…¥çš„ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´è¦æ¯”å¤´ç»“ç‚¹çš„æ‰§è¡Œæ—¶é—´è¦æ™šï¼Œè¿™å°±ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœäº†ï¼Œè¿™ä¼šå¯¼è‡´é˜Ÿåˆ—ä¸­çš„é¡ºåºä¸æ­£ç¡®ã€‚ åŒç†ä¹Ÿå¯ä»¥ç®—ä¸€ä¸‹åœ¨æ‰§è¡ŒcompareToæ–¹æ³•ä¸­çš„long diff = getDelay(NANOSECONDS) - other.getDelay(NANOSECONDS);æ—¶ä¹Ÿä¼šæœ‰è¿™ç§æƒ…å†µï¼› æ‰€ä»¥åœ¨triggerTimeæ–¹æ³•ä¸­å¯¹delayçš„å¤§å°åšäº†åˆ¤æ–­ï¼Œå°±æ˜¯ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿã€‚ å¦‚æœæ‰§è¡Œäº†overflowFreeæ–¹æ³•å‘¢ï¼Œè¿™æ—¶headDelay = 95 - 100 = -5ï¼Œç„¶åæ‰§è¡Œdelay = 1023 + (-5) = 1018ï¼Œé‚£ä¹ˆtriggerTimeä¼šè¿”å›100 + 1018 = -930ï¼Œå†æ‰§è¡ŒcompareToæ–¹æ³•ä¸­çš„long diff = time - x.time;æ—¶ï¼Œdiff = -930 - 95 = -930 - 100 + 5 = 1018 + 5 = 1023ï¼Œæ²¡æœ‰æº¢å‡ºï¼Œç¬¦åˆæ­£å¸¸çš„é¢„æœŸã€‚ æ‰€ä»¥ï¼ŒoverflowFreeæ–¹æ³•ä¸­æŠŠå·²ç»è¶…æ—¶çš„éƒ¨åˆ†æ—¶é—´ç»™å‡å»ï¼Œå°±æ˜¯ä¸ºäº†é¿å…åœ¨compareToæ–¹æ³•ä¸­å‡ºç°æº¢å‡ºæƒ…å†µã€‚ ï¼ˆè¯´å®è¯ï¼Œè¿™æ®µä»£ç çœ‹çš„å¾ˆç—›è‹¦ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¹Ÿä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œè°ä¼šä¼ ä¸€ä¸ªLong.MAX_VALUEå‘¢ã€‚è¦çŸ¥é“Long.MAX_VALUEçš„çº³ç§’æ•°æ¢ç®—æˆå¹´çš„è¯æ˜¯292å¹´ï¼Œè°ä¼šè¿™ä¹ˆæ— èŠã€‚ã€‚ã€‚ï¼‰ ScheduledFutureTaskçš„getDelayæ–¹æ³•1234public long getDelay(TimeUnit unit) &#123; // æ‰§è¡Œæ—¶é—´å‡å»å½“å‰ç³»ç»Ÿæ—¶é—´ return unit.convert(time - now(), NANOSECONDS);&#125; ScheduledFutureTaskçš„æ„é€ æ–¹æ³•ScheduledFutureTaskç»§æ‰¿è‡ªFutureTaskå¹¶å®ç°äº†RunnableScheduledFutureæ¥å£ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¸Šæ–‡çš„ç±»å›¾ï¼Œæ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526ScheduledFutureTask(Runnable r, V result, long ns) &#123; super(r, result); this.time = ns; this.period = 0; this.sequenceNumber = sequencer.getAndIncrement();&#125;/** * Creates a periodic action with given nano time and period. */ScheduledFutureTask(Runnable r, V result, long ns, long period) &#123; super(r, result); this.time = ns; this.period = period; this.sequenceNumber = sequencer.getAndIncrement();&#125;/** * Creates a one-shot action with given nanoTime-based trigger time. */ScheduledFutureTask(Callable&lt;V&gt; callable, long ns) &#123; super(callable); this.time = ns; this.period = 0; this.sequenceNumber = sequencer.getAndIncrement();&#125; è¿™é‡Œé¢æœ‰å‡ ä¸ªé‡è¦çš„å±æ€§ï¼Œä¸‹é¢æ¥è§£é‡Šä¸€ä¸‹ï¼š timeï¼šä¸‹æ¬¡ä»»åŠ¡æ‰§è¡Œæ—¶çš„æ—¶é—´ï¼› periodï¼šæ‰§è¡Œå‘¨æœŸï¼› sequenceNumberï¼šä¿å­˜ä»»åŠ¡è¢«æ·»åŠ åˆ°ScheduledThreadPoolExecutorä¸­çš„åºå·ã€‚ åœ¨scheduleæ–¹æ³•ä¸­ï¼Œåˆ›å»ºå®ŒScheduledFutureTaskå¯¹è±¡ä¹‹åï¼Œä¼šæ‰§è¡ŒdelayedExecuteæ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡ã€‚ delayedExecuteæ–¹æ³•1234567891011121314151617private void delayedExecute(RunnableScheduledFuture&lt;?&gt; task) &#123; // å¦‚æœçº¿ç¨‹æ± å·²ç»å…³é—­ï¼Œä½¿ç”¨æ‹’ç»ç­–ç•¥æ‹’ç»ä»»åŠ¡ if (isShutdown()) reject(task); else &#123; // æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ super.getQueue().add(task); if (isShutdown() &amp;&amp; !canRunInCurrentRunState(task.isPeriodic()) &amp;&amp; remove(task)) task.cancel(false); else // ç¡®ä¿çº¿ç¨‹æ± ä¸­è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹å¯åŠ¨ï¼Œå³ä½¿corePoolSizeä¸º0 // è¯¥æ–¹æ³•åœ¨ThreadPoolExecutorä¸­å®ç° ensurePrestart(); &#125;&#125; è¯´ä¸€ä¸‹è¿™é‡Œçš„ç¬¬äºŒä¸ªifåˆ¤æ–­ï¼š å¦‚æœä¸æ˜¯SHUTDOWNçŠ¶æ€ï¼Œæ‰§è¡Œelseï¼Œå¦åˆ™æ‰§è¡Œæ­¥éª¤2ï¼› å¦‚æœåœ¨å½“å‰çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€ä¸‹å¯ä»¥æ‰§è¡Œä»»åŠ¡ï¼Œæ‰§è¡Œelseï¼Œå¦åˆ™æ‰§è¡Œæ­¥éª¤3ï¼› ä»é˜»å¡é˜Ÿåˆ—ä¸­åˆ é™¤ä»»åŠ¡ï¼Œå¦‚æœå¤±è´¥ï¼Œæ‰§è¡Œelseï¼Œå¦åˆ™æ‰§è¡Œæ­¥éª¤4ï¼› å–æ¶ˆä»»åŠ¡ï¼Œä½†ä¸ä¸­æ–­æ‰§è¡Œä¸­çš„ä»»åŠ¡ã€‚ å¯¹äºæ­¥éª¤2ï¼Œå¯ä»¥é€šè¿‡setContinueExistingPeriodicTasksAfterShutdownPolicyæ–¹æ³•è®¾ç½®åœ¨çº¿ç¨‹æ± å…³é—­æ—¶ï¼Œå‘¨æœŸä»»åŠ¡ç»§ç»­æ‰§è¡Œï¼Œé»˜è®¤ä¸ºfalseï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹æ± å…³é—­æ—¶ï¼Œä¸å†æ‰§è¡Œå‘¨æœŸä»»åŠ¡ã€‚ ensurePrestartæ–¹æ³•åœ¨ThreadPoolExecutorä¸­å®šä¹‰ï¼š 1234567void ensurePrestart() &#123; int wc = workerCountOf(ctl.get()); if (wc &lt; corePoolSize) addWorker(null, true); else if (wc == 0) addWorker(null, false);&#125; è°ƒç”¨äº†addWorkeræ–¹æ³•ï¼Œå¯ä»¥åœ¨æ·±å…¥ç†è§£Javaçº¿ç¨‹æ± ï¼šThreadPoolExecutorä¸­æŸ¥çœ‹addWorkeræ–¹æ³•çš„ä»‹ç»ï¼Œçº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹æ˜¯é€šè¿‡è¯¥æ–¹æ³•æ¥å¯åŠ¨å¹¶æ‰§è¡Œä»»åŠ¡çš„ã€‚ ScheduledFutureTaskçš„runæ–¹æ³•å›é¡¾ä¸€ä¸‹çº¿ç¨‹æ± çš„æ‰§è¡Œè¿‡ç¨‹ï¼šå½“çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹å¯åŠ¨æ—¶ï¼Œä¸æ–­åœ°ä»é˜»å¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œï¼Œå½“ç„¶ï¼Œå–å‡ºçš„ä»»åŠ¡å®ç°äº†Runnableæ¥å£ï¼Œæ‰€ä»¥æ˜¯é€šè¿‡è°ƒç”¨ä»»åŠ¡çš„runæ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡çš„ã€‚ è¿™é‡Œçš„ä»»åŠ¡ç±»å‹æ˜¯ScheduledFutureTaskï¼Œæ‰€ä»¥ä¸‹é¢çœ‹ä¸€ä¸‹ScheduledFutureTaskçš„runæ–¹æ³•ï¼š 123456789101112131415161718public void run() &#123; // æ˜¯å¦æ˜¯å‘¨æœŸæ€§ä»»åŠ¡ boolean periodic = isPeriodic(); // å½“å‰çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€ä¸‹å¦‚æœä¸å¯ä»¥æ‰§è¡Œä»»åŠ¡ï¼Œå–æ¶ˆè¯¥ä»»åŠ¡ if (!canRunInCurrentRunState(periodic)) cancel(false); // å¦‚æœä¸æ˜¯å‘¨æœŸæ€§ä»»åŠ¡ï¼Œè°ƒç”¨FutureTaskä¸­çš„runæ–¹æ³•æ‰§è¡Œ else if (!periodic) ScheduledFutureTask.super.run(); // å¦‚æœæ˜¯å‘¨æœŸæ€§ä»»åŠ¡ï¼Œè°ƒç”¨FutureTaskä¸­çš„runAndResetæ–¹æ³•æ‰§è¡Œ // runAndResetæ–¹æ³•ä¸ä¼šè®¾ç½®æ‰§è¡Œç»“æœï¼Œæ‰€ä»¥å¯ä»¥é‡å¤æ‰§è¡Œä»»åŠ¡ else if (ScheduledFutureTask.super.runAndReset()) &#123; // è®¡ç®—ä¸‹æ¬¡æ‰§è¡Œè¯¥ä»»åŠ¡çš„æ—¶é—´ setNextRunTime(); // é‡å¤æ‰§è¡Œä»»åŠ¡ reExecutePeriodic(outerTask); &#125;&#125; æœ‰å…³FutureTaskçš„runæ–¹æ³•å’ŒrunAndResetæ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒFutureTaskæºç è§£æã€‚ åˆ†æä¸€ä¸‹æ‰§è¡Œè¿‡ç¨‹ï¼š å¦‚æœå½“å‰çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€ä¸å¯ä»¥æ‰§è¡Œä»»åŠ¡ï¼Œå–æ¶ˆè¯¥ä»»åŠ¡ï¼Œç„¶åç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰§è¡Œæ­¥éª¤2ï¼› å¦‚æœä¸æ˜¯å‘¨æœŸæ€§ä»»åŠ¡ï¼Œè°ƒç”¨FutureTaskä¸­çš„runæ–¹æ³•æ‰§è¡Œï¼Œä¼šè®¾ç½®æ‰§è¡Œç»“æœï¼Œç„¶åç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰§è¡Œæ­¥éª¤3ï¼› å¦‚æœæ˜¯å‘¨æœŸæ€§ä»»åŠ¡ï¼Œè°ƒç”¨FutureTaskä¸­çš„runAndResetæ–¹æ³•æ‰§è¡Œï¼Œä¸ä¼šè®¾ç½®æ‰§è¡Œç»“æœï¼Œç„¶åç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰§è¡Œæ­¥éª¤4å’Œæ­¥éª¤5ï¼› è®¡ç®—ä¸‹æ¬¡æ‰§è¡Œè¯¥ä»»åŠ¡çš„å…·ä½“æ—¶é—´ï¼› é‡å¤æ‰§è¡Œä»»åŠ¡ã€‚ ScheduledFutureTaskçš„reExecutePeriodicæ–¹æ³•123456789void reExecutePeriodic(RunnableScheduledFuture&lt;?&gt; task) &#123; if (canRunInCurrentRunState(true)) &#123; super.getQueue().add(task); if (!canRunInCurrentRunState(true) &amp;&amp; remove(task)) task.cancel(false); else ensurePrestart(); &#125;&#125; è¯¥æ–¹æ³•å’ŒdelayedExecuteæ–¹æ³•ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼š ç”±äºè°ƒç”¨reExecutePeriodicæ–¹æ³•æ—¶å·²ç»æ‰§è¡Œè¿‡ä¸€æ¬¡å‘¨æœŸæ€§ä»»åŠ¡äº†ï¼Œæ‰€ä»¥ä¸ä¼šrejectå½“å‰ä»»åŠ¡ï¼› ä¼ å…¥çš„ä»»åŠ¡ä¸€å®šæ˜¯å‘¨æœŸæ€§ä»»åŠ¡ã€‚ onShutdownæ–¹æ³•onShutdownæ–¹æ³•æ˜¯ThreadPoolExecutorä¸­çš„é’©å­æ–¹æ³•ï¼Œåœ¨ThreadPoolExecutorä¸­ä»€ä¹ˆéƒ½æ²¡æœ‰åšï¼Œå‚è€ƒæ·±å…¥ç†è§£Javaçº¿ç¨‹æ± ï¼šThreadPoolExecutorï¼Œè¯¥æ–¹æ³•æ˜¯åœ¨æ‰§è¡Œshutdownæ–¹æ³•æ—¶è¢«è°ƒç”¨ï¼š 123456789101112131415161718192021222324252627282930313233@Override void onShutdown() &#123; BlockingQueue&lt;Runnable&gt; q = super.getQueue(); // è·å–åœ¨çº¿ç¨‹æ± å·² shutdown çš„æƒ…å†µä¸‹æ˜¯å¦ç»§ç»­æ‰§è¡Œç°æœ‰å»¶è¿Ÿä»»åŠ¡ boolean keepDelayed = getExecuteExistingDelayedTasksAfterShutdownPolicy(); // è·å–åœ¨çº¿ç¨‹æ± å·² shutdown çš„æƒ…å†µä¸‹æ˜¯å¦ç»§ç»­æ‰§è¡Œç°æœ‰å®šæœŸä»»åŠ¡ boolean keepPeriodic = getContinueExistingPeriodicTasksAfterShutdownPolicy(); // å¦‚æœåœ¨çº¿ç¨‹æ± å·² shutdown çš„æƒ…å†µä¸‹ä¸ç»§ç»­æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡å’Œå®šæœŸä»»åŠ¡ // åˆ™ä¾æ¬¡å–æ¶ˆä»»åŠ¡ï¼Œå¦åˆ™åˆ™æ ¹æ®å–æ¶ˆçŠ¶æ€æ¥åˆ¤æ–­ if (!keepDelayed &amp;&amp; !keepPeriodic) &#123; for (Object e : q.toArray()) if (e instanceof RunnableScheduledFuture&lt;?&gt;) ((RunnableScheduledFuture&lt;?&gt;) e).cancel(false); q.clear(); &#125; else &#123; // Traverse snapshot to avoid iterator exceptions for (Object e : q.toArray()) &#123; if (e instanceof RunnableScheduledFuture) &#123; RunnableScheduledFuture&lt;?&gt; t = (RunnableScheduledFuture&lt;?&gt;)e; // å¦‚æœæœ‰åœ¨ shutdown åä¸ç»§ç»­çš„å»¶è¿Ÿä»»åŠ¡æˆ–å‘¨æœŸä»»åŠ¡ï¼Œåˆ™ä»é˜Ÿåˆ—ä¸­åˆ é™¤å¹¶å–æ¶ˆä»»åŠ¡ if ((t.isPeriodic() ? !keepPeriodic : !keepDelayed) || t.isCancelled()) &#123; // also remove if already cancelled if (q.remove(t)) t.cancel(false); &#125; &#125; &#125; &#125; tryTerminate();&#125; DelayedWorkQueueScheduledThreadPoolExecutorä¹‹æ‰€ä»¥è¦è‡ªå·±å®ç°é˜»å¡çš„å·¥ä½œé˜Ÿåˆ—ï¼Œæ˜¯å› ä¸ºScheduledThreadPoolExecutorè¦æ±‚çš„å·¥ä½œé˜Ÿåˆ—æœ‰äº›ç‰¹æ®Šã€‚ DelayedWorkQueueæ˜¯ä¸€ä¸ªåŸºäºå †çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼äºDelayQueueå’ŒPriorityQueueã€‚åœ¨æ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„æ—¶å€™ï¼Œæ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´éƒ½ä¸åŒï¼Œæ‰€ä»¥DelayedWorkQueueçš„å·¥ä½œå°±æ˜¯æŒ‰ç…§æ‰§è¡Œæ—¶é—´çš„å‡åºæ¥æ’åˆ—ï¼Œæ‰§è¡Œæ—¶é—´è·ç¦»å½“å‰æ—¶é—´è¶Šè¿‘çš„ä»»åŠ¡åœ¨é˜Ÿåˆ—çš„å‰é¢ï¼ˆæ³¨æ„ï¼šè¿™é‡Œçš„é¡ºåºå¹¶ä¸æ˜¯ç»å¯¹çš„ï¼Œå †ä¸­çš„æ’åºåªä¿è¯äº†å­èŠ‚ç‚¹çš„ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´è¦æ¯”çˆ¶èŠ‚ç‚¹çš„ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´è¦å¤§ï¼Œè€Œå¶å­èŠ‚ç‚¹ä¹‹é—´å¹¶ä¸ä¸€å®šæ˜¯é¡ºåºçš„ï¼Œä¸‹æ–‡ä¸­ä¼šè¯´æ˜ï¼‰ã€‚ å †ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯è§ï¼ŒDelayedWorkQueueæ˜¯ä¸€ä¸ªåŸºäºæœ€å°å †ç»“æ„çš„é˜Ÿåˆ—ã€‚å †ç»“æ„å¯ä»¥ä½¿ç”¨æ•°ç»„è¡¨ç¤ºï¼Œå¯ä»¥è½¬æ¢æˆå¦‚ä¸‹çš„æ•°ç»„ï¼š åœ¨è¿™ç§ç»“æ„ä¸­ï¼Œå¯ä»¥å‘ç°æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š å‡è®¾ï¼Œç´¢å¼•å€¼ä»0å¼€å§‹ï¼Œå­èŠ‚ç‚¹çš„ç´¢å¼•å€¼ä¸ºkï¼Œçˆ¶èŠ‚ç‚¹çš„ç´¢å¼•å€¼ä¸ºpï¼Œåˆ™ï¼š ä¸€ä¸ªèŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹çš„ç´¢å¼•ä¸ºï¼šk = p * 2 + 1ï¼› ä¸€ä¸ªèŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹çš„ç´¢å¼•ä¸ºï¼šk = (p + 1) * 2ï¼› ä¸€ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„ç´¢å¼•ä¸ºï¼šp = (k - 1) / 2ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨DelayedWorkQueueå‘¢ï¼Ÿ å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶éœ€è¦å–å‡ºæœ€è¿‘è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ‰€ä»¥ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­æ¯æ¬¡å‡ºé˜Ÿæ—¶ä¸€å®šè¦æ˜¯å½“å‰é˜Ÿåˆ—ä¸­æ‰§è¡Œæ—¶é—´æœ€é å‰çš„ï¼Œæ‰€ä»¥è‡ªç„¶è¦ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚ DelayedWorkQueueæ˜¯ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå®ƒå¯ä»¥ä¿è¯æ¯æ¬¡å‡ºé˜Ÿçš„ä»»åŠ¡éƒ½æ˜¯å½“å‰é˜Ÿåˆ—ä¸­æ‰§è¡Œæ—¶é—´æœ€é å‰çš„ï¼Œç”±äºå®ƒæ˜¯åŸºäºå †ç»“æ„çš„é˜Ÿåˆ—ï¼Œå †ç»“æ„åœ¨æ‰§è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶çš„æœ€åæ—¶é—´å¤æ‚åº¦æ˜¯ O(logN)ã€‚ DelayedWorkQueueçš„å±æ€§123456789101112// é˜Ÿåˆ—åˆå§‹å®¹é‡private static final int INITIAL_CAPACITY = 16;// æ ¹æ®åˆå§‹å®¹é‡åˆ›å»ºRunnableScheduledFutureç±»å‹çš„æ•°ç»„private RunnableScheduledFuture&lt;?&gt;[] queue = new RunnableScheduledFuture&lt;?&gt;[INITIAL_CAPACITY];private final ReentrantLock lock = new ReentrantLock();private int size = 0;// leaderçº¿ç¨‹private Thread leader = null;// å½“è¾ƒæ–°çš„ä»»åŠ¡åœ¨é˜Ÿåˆ—çš„å¤´éƒ¨å¯ç”¨æ—¶ï¼Œæˆ–è€…æ–°çº¿ç¨‹å¯èƒ½éœ€è¦æˆä¸ºleaderï¼Œåˆ™é€šè¿‡è¯¥æ¡ä»¶å‘å‡ºä¿¡å·private final Condition available = lock.newCondition(); æ³¨æ„è¿™é‡Œçš„leaderï¼Œå®ƒæ˜¯Leader-Followeræ¨¡å¼çš„å˜ä½“ï¼Œç”¨äºå‡å°‘ä¸å¿…è¦çš„å®šæ—¶ç­‰å¾…ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå¯¹äºå¤šçº¿ç¨‹çš„ç½‘ç»œæ¨¡å‹æ¥è¯´ï¼š æ‰€æœ‰çº¿ç¨‹ä¼šæœ‰ä¸‰ç§èº«ä»½ä¸­çš„ä¸€ç§ï¼šleaderå’Œfollowerï¼Œä»¥åŠä¸€ä¸ªå¹²æ´»ä¸­çš„çŠ¶æ€ï¼šproccesserã€‚å®ƒçš„åŸºæœ¬åŸåˆ™å°±æ˜¯ï¼Œæ°¸è¿œæœ€å¤šåªæœ‰ä¸€ä¸ªleaderã€‚è€Œæ‰€æœ‰followeréƒ½åœ¨ç­‰å¾…æˆä¸ºleaderã€‚çº¿ç¨‹æ± å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªLeaderè´Ÿè´£ç­‰å¾…ç½‘ç»œIOäº‹ä»¶ï¼Œå½“æœ‰ä¸€ä¸ªäº‹ä»¶äº§ç”Ÿæ—¶ï¼ŒLeaderçº¿ç¨‹é¦–å…ˆé€šçŸ¥ä¸€ä¸ªFollowerçº¿ç¨‹å°†å…¶ææ‹”ä¸ºæ–°çš„Leaderï¼Œç„¶åè‡ªå·±å°±å»å¹²æ´»äº†ï¼Œå»å¤„ç†è¿™ä¸ªç½‘ç»œäº‹ä»¶ï¼Œå¤„ç†å®Œæ¯•ååŠ å…¥Followerçº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—ï¼Œç­‰å¾…ä¸‹æ¬¡æˆä¸ºLeaderã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¢å¼ºCPUé«˜é€Ÿç¼“å­˜ç›¸ä¼¼æ€§ï¼ŒåŠæ¶ˆé™¤åŠ¨æ€å†…å­˜åˆ†é…å’Œçº¿ç¨‹é—´çš„æ•°æ®äº¤æ¢ã€‚ å‚è€ƒè‡ªï¼šhttp://blog.csdn.net/goldlevi/article/details/7705180 å…·ä½“leaderçš„ä½œç”¨åœ¨åˆ†ætakeæ–¹æ³•æ—¶å†è¯¦ç»†ä»‹ç»ã€‚ offeræ–¹æ³•æ—¢ç„¶æ˜¯é˜»å¡é˜Ÿåˆ—ï¼Œå…¥é˜Ÿçš„æ“ä½œå¦‚addå’Œputæ–¹æ³•éƒ½è°ƒç”¨äº†offeræ–¹æ³•ï¼Œä¸‹é¢æŸ¥çœ‹ä¸€ä¸‹offeræ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031public boolean offer(Runnable x) &#123; if (x == null) throw new NullPointerException(); RunnableScheduledFuture&lt;?&gt; e = (RunnableScheduledFuture&lt;?&gt;)x; final ReentrantLock lock = this.lock; lock.lock(); try &#123; int i = size; // queueæ˜¯ä¸€ä¸ªRunnableScheduledFutureç±»å‹çš„æ•°ç»„ï¼Œå¦‚æœå®¹é‡ä¸å¤Ÿéœ€è¦æ‰©å®¹ if (i &gt;= queue.length) grow(); size = i + 1; // i == 0 è¯´æ˜å †ä¸­è¿˜æ²¡æœ‰æ•°æ® if (i == 0) &#123; queue[0] = e; setIndex(e, 0); &#125; else &#123; // i != 0 æ—¶ï¼Œéœ€è¦å¯¹å †è¿›è¡Œé‡æ–°æ’åº siftUp(i, e); &#125; // å¦‚æœä¼ å…¥çš„ä»»åŠ¡å·²ç»æ˜¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹äº†ï¼Œè¿™æ—¶availableéœ€è¦å‘å‡ºä¿¡å· if (queue[0] == e) &#123; // leaderè®¾ç½®ä¸ºnullä¸ºäº†ä½¿åœ¨takeæ–¹æ³•ä¸­çš„çº¿ç¨‹åœ¨é€šè¿‡available.signal();åä¼šæ‰§è¡Œavailable.awaitNanos(delay); leader = null; available.signal(); &#125; &#125; finally &#123; lock.unlock(); &#125; return true;&#125; æœ‰å…³Conditionçš„ä»‹ç»è¯·å‚è€ƒæ·±å…¥ç†è§£AbstractQueuedSynchronizerï¼ˆä¸‰ï¼‰ è¿™é‡Œçš„é‡ç‚¹æ˜¯siftUpæ–¹æ³•ã€‚ siftUpæ–¹æ³•12345678910111213141516171819private void siftUp(int k, RunnableScheduledFuture&lt;?&gt; key) &#123; while (k &gt; 0) &#123; // æ‰¾åˆ°çˆ¶èŠ‚ç‚¹çš„ç´¢å¼• int parent = (k - 1) &gt;&gt;&gt; 1; // è·å–çˆ¶èŠ‚ç‚¹ RunnableScheduledFuture&lt;?&gt; e = queue[parent]; // å¦‚æœkeyèŠ‚ç‚¹çš„æ‰§è¡Œæ—¶é—´å¤§äºçˆ¶èŠ‚ç‚¹çš„æ‰§è¡Œæ—¶é—´ï¼Œä¸éœ€è¦å†æ’åºäº† if (key.compareTo(e) &gt;= 0) break; // å¦‚æœkey.compareTo(e) &lt; 0ï¼Œè¯´æ˜keyèŠ‚ç‚¹çš„æ‰§è¡Œæ—¶é—´å°äºçˆ¶èŠ‚ç‚¹çš„æ‰§è¡Œæ—¶é—´ï¼Œéœ€è¦æŠŠçˆ¶èŠ‚ç‚¹ç§»åˆ°åé¢ queue[k] = e; // è®¾ç½®ç´¢å¼•ä¸ºk setIndex(e, k); k = parent; &#125; // keyè®¾ç½®ä¸ºæ’åºåçš„ä½ç½®ä¸­ queue[k] = key; setIndex(key, k);&#125; ä»£ç å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯å¾ªç¯çš„æ ¹æ®keyèŠ‚ç‚¹ä¸å®ƒçš„çˆ¶èŠ‚ç‚¹æ¥åˆ¤æ–­ï¼Œå¦‚æœkeyèŠ‚ç‚¹çš„æ‰§è¡Œæ—¶é—´å°äºçˆ¶èŠ‚ç‚¹ï¼Œåˆ™å°†ä¸¤ä¸ªèŠ‚ç‚¹äº¤æ¢ï¼Œä½¿æ‰§è¡Œæ—¶é—´é å‰çš„èŠ‚ç‚¹æ’åˆ—åœ¨é˜Ÿåˆ—çš„å‰é¢ã€‚ å‡è®¾æ–°å…¥é˜Ÿçš„èŠ‚ç‚¹çš„å»¶è¿Ÿæ—¶é—´ï¼ˆè°ƒç”¨getDelay()æ–¹æ³•è·å¾—ï¼‰æ˜¯5ï¼Œæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š å…ˆå°†æ–°çš„èŠ‚ç‚¹æ·»åŠ åˆ°æ•°ç»„çš„å°¾éƒ¨ï¼Œè¿™æ—¶æ–°èŠ‚ç‚¹çš„ç´¢å¼•kä¸º7ï¼š è®¡ç®—æ–°çˆ¶èŠ‚ç‚¹çš„ç´¢å¼•ï¼šparent = (k - 1) &gt;&gt;&gt; 1ï¼Œparent = 3ï¼Œé‚£ä¹ˆqueue[3]çš„æ—¶é—´é—´éš”å€¼ä¸º8ï¼Œå› ä¸º 5 &lt; 8 ï¼Œå°†æ‰§è¡Œqueue[7] = queue[3]ï¼šï¼š è¿™æ—¶å°†kè®¾ç½®ä¸º3ï¼Œç»§ç»­å¾ªç¯ï¼Œå†æ¬¡è®¡ç®—parentä¸º1ï¼Œqueue[1]çš„æ—¶é—´é—´éš”ä¸º3ï¼Œå› ä¸º 5 &gt; 3 ï¼Œè¿™æ—¶é€€å‡ºå¾ªç¯ï¼Œæœ€ç»ˆkä¸º3ï¼š å¯è§ï¼Œæ¯æ¬¡æ–°å¢èŠ‚ç‚¹æ—¶ï¼Œåªæ˜¯æ ¹æ®çˆ¶èŠ‚ç‚¹æ¥åˆ¤æ–­ï¼Œè€Œä¸ä¼šå½±å“å…„å¼ŸèŠ‚ç‚¹ã€‚ å¦å¤–ï¼ŒsetIndexæ–¹æ³•åªæ˜¯è®¾ç½®äº†ScheduledFutureTaskä¸­çš„heapIndexå±æ€§ï¼š 1234private void setIndex(RunnableScheduledFuture&lt;?&gt; f, int idx) &#123; if (f instanceof ScheduledFutureTask) ((ScheduledFutureTask)f).heapIndex = idx;&#125; takeæ–¹æ³•12345678910111213141516171819202122232425262728293031323334353637383940public RunnableScheduledFuture&lt;?&gt; take() throws InterruptedException &#123; final ReentrantLock lock = this.lock; lock.lockInterruptibly(); try &#123; for (;;) &#123; RunnableScheduledFuture&lt;?&gt; first = queue[0]; if (first == null) available.await(); else &#123; // è®¡ç®—å½“å‰æ—¶é—´åˆ°æ‰§è¡Œæ—¶é—´çš„æ—¶é—´é—´éš” long delay = first.getDelay(NANOSECONDS); if (delay &lt;= 0) return finishPoll(first); first = null; // don't retain ref while waiting // leaderä¸ä¸ºç©ºï¼Œé˜»å¡çº¿ç¨‹ if (leader != null) available.await(); else &#123; // leaderä¸ºç©ºï¼Œåˆ™æŠŠleaderè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹ï¼Œ Thread thisThread = Thread.currentThread(); leader = thisThread; try &#123; // é˜»å¡åˆ°æ‰§è¡Œæ—¶é—´ available.awaitNanos(delay); &#125; finally &#123; // è®¾ç½®leader = nullï¼Œè®©å…¶ä»–çº¿ç¨‹æ‰§è¡Œavailable.awaitNanos(delay); if (leader == thisThread) leader = null; &#125; &#125; &#125; &#125; &#125; finally &#123; // å¦‚æœleaderä¸ä¸ºç©ºï¼Œåˆ™è¯´æ˜leaderçš„çº¿ç¨‹æ­£åœ¨æ‰§è¡Œavailable.awaitNanos(delay); // å¦‚æœqueue[0] == nullï¼Œè¯´æ˜é˜Ÿåˆ—ä¸ºç©º if (leader == null &amp;&amp; queue[0] != null) available.signal(); lock.unlock(); &#125;&#125; takeæ–¹æ³•æ˜¯ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„å‘¢ï¼Ÿåœ¨æ·±å…¥ç†è§£Javaçº¿ç¨‹æ± ï¼šThreadPoolExecutorä¸­ï¼Œä»‹ç»äº†getTaskæ–¹æ³•ï¼Œå·¥ä½œçº¿ç¨‹ä¼šå¾ªç¯åœ°ä»workQueueä¸­å–ä»»åŠ¡ã€‚ä½†å®šæ—¶ä»»åŠ¡å´ä¸åŒï¼Œå› ä¸ºå¦‚æœä¸€æ—¦getTaskæ–¹æ³•å–å‡ºäº†ä»»åŠ¡å°±å¼€å§‹æ‰§è¡Œäº†ï¼Œè€Œè¿™æ—¶å¯èƒ½è¿˜æ²¡æœ‰åˆ°æ‰§è¡Œçš„æ—¶é—´ï¼Œæ‰€ä»¥åœ¨takeæ–¹æ³•ä¸­ï¼Œè¦ä¿è¯åªæœ‰åœ¨åˆ°æŒ‡å®šçš„æ‰§è¡Œæ—¶é—´çš„æ—¶å€™ä»»åŠ¡æ‰å¯ä»¥è¢«å–èµ°ã€‚ å†æ¥è¯´ä¸€ä¸‹leaderçš„ä½œç”¨ï¼Œè¿™é‡Œçš„leaderæ˜¯ä¸ºäº†å‡å°‘ä¸å¿…è¦çš„å®šæ—¶ç­‰å¾…ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æˆä¸ºleaderæ—¶ï¼Œå®ƒåªç­‰å¾…ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶é—´é—´éš”ï¼Œä½†å…¶å®ƒçº¿ç¨‹æ— é™æœŸç­‰å¾…ã€‚ leaderçº¿ç¨‹å¿…é¡»åœ¨ä»takeï¼ˆï¼‰æˆ–pollï¼ˆï¼‰è¿”å›ä¹‹å‰signalå…¶å®ƒçº¿ç¨‹ï¼Œé™¤éå…¶ä»–çº¿ç¨‹æˆä¸ºäº†leaderã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœæ²¡æœ‰leaderï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œtakeæ—¶ï¼Œéƒ½è¦æ‰§è¡Œavailable.awaitNanos(delay)ï¼Œå‡è®¾å½“å‰çº¿ç¨‹æ‰§è¡Œäº†è¯¥æ®µä»£ç ï¼Œè¿™æ—¶è¿˜æ²¡æœ‰signalï¼Œç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿæ‰§è¡Œäº†è¯¥æ®µä»£ç ï¼Œåˆ™ç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿè¦è¢«é˜»å¡ã€‚å¤šä¸ªè¿™æ—¶æ‰§è¡Œè¯¥æ®µä»£ç æ˜¯æ²¡æœ‰ä½œç”¨çš„ï¼Œå› ä¸ºåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šä»takeä¸­è¿”å›queue[0]ï¼ˆå› ä¸ºæœ‰lockï¼‰ï¼Œå…¶ä»–çº¿ç¨‹è¿™æ—¶å†è¿”å›forå¾ªç¯æ‰§è¡Œæ—¶å–çš„queue[0]ï¼Œå·²ç»ä¸æ˜¯ä¹‹å‰çš„queue[0]äº†ï¼Œç„¶ååˆè¦ç»§ç»­é˜»å¡ã€‚ æ‰€ä»¥ï¼Œä¸ºäº†ä¸è®©å¤šä¸ªçº¿ç¨‹é¢‘ç¹çš„åšæ— ç”¨çš„å®šæ—¶ç­‰å¾…ï¼Œè¿™é‡Œå¢åŠ äº†leaderï¼Œå¦‚æœleaderä¸ä¸ºç©ºï¼Œåˆ™è¯´æ˜é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å·²ç»åœ¨ç­‰å¾…å‡ºé˜Ÿï¼Œè¿™æ—¶å…¶å®ƒçš„çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ï¼Œå‡å°‘äº†æ— ç”¨çš„é˜»å¡ï¼ˆæ³¨æ„ï¼Œåœ¨finallyä¸­è°ƒç”¨äº†signal()æ¥å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œä¸æ˜¯signalAll()ï¼‰ã€‚ pollæ–¹æ³•ä¸‹é¢çœ‹ä¸‹pollæ–¹æ³•ï¼Œä¸takeç±»ä¼¼ï¼Œä½†è¿™é‡Œè¦æä¾›è¶…æ—¶åŠŸèƒ½ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public RunnableScheduledFuture&lt;?&gt; poll(long timeout, TimeUnit unit) throws InterruptedException &#123; long nanos = unit.toNanos(timeout); final ReentrantLock lock = this.lock; lock.lockInterruptibly(); try &#123; for (;;) &#123; RunnableScheduledFuture&lt;?&gt; first = queue[0]; if (first == null) &#123; if (nanos &lt;= 0) return null; else nanos = available.awaitNanos(nanos); &#125; else &#123; long delay = first.getDelay(NANOSECONDS); // å¦‚æœdelay &lt;= 0ï¼Œè¯´æ˜å·²ç»åˆ°äº†ä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´ï¼Œè¿”å›ã€‚ if (delay &lt;= 0) return finishPoll(first); // å¦‚æœnanos &lt;= 0ï¼Œè¯´æ˜å·²ç»è¶…æ—¶ï¼Œè¿”å›null if (nanos &lt;= 0) return null; first = null; // don't retain ref while waiting // nanos &lt; delay è¯´æ˜éœ€è¦ç­‰å¾…çš„æ—¶é—´å°äºä»»åŠ¡è¦æ‰§è¡Œçš„å»¶è¿Ÿæ—¶é—´ // leader != null è¯´æ˜æœ‰å…¶å®ƒçº¿ç¨‹æ­£åœ¨å¯¹ä»»åŠ¡è¿›è¡Œé˜»å¡ // è¿™æ—¶é˜»å¡å½“å‰çº¿ç¨‹nanosçº³ç§’ if (nanos &lt; delay || leader != null) nanos = available.awaitNanos(nanos); else &#123; Thread thisThread = Thread.currentThread(); leader = thisThread; try &#123; // è¿™é‡Œçš„timeLeftè¡¨ç¤ºdelayå‡å»å®é™…çš„ç­‰å¾…æ—¶é—´ long timeLeft = available.awaitNanos(delay); // è®¡ç®—å‰©ä½™çš„ç­‰å¾…æ—¶é—´ nanos -= delay - timeLeft; &#125; finally &#123; if (leader == thisThread) leader = null; &#125; &#125; &#125; &#125; &#125; finally &#123; if (leader == null &amp;&amp; queue[0] != null) available.signal(); lock.unlock(); &#125;&#125; finishPollæ–¹æ³•å½“è°ƒç”¨äº†takeæˆ–è€…pollæ–¹æ³•èƒ½å¤Ÿè·å–åˆ°ä»»åŠ¡æ—¶ï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•è¿›è¡Œè¿”å›ï¼š 123456789101112private RunnableScheduledFuture&lt;?&gt; finishPoll(RunnableScheduledFuture&lt;?&gt; f) &#123; // æ•°ç»„é•¿åº¦-1 int s = --size; // å–å‡ºæœ€åä¸€ä¸ªèŠ‚ç‚¹ RunnableScheduledFuture&lt;?&gt; x = queue[s]; queue[s] = null; // é•¿åº¦ä¸ä¸º0ï¼Œåˆ™ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹æ’åºï¼Œç›®çš„æ˜¯è¦æŠŠæœ€åä¸€ä¸ªèŠ‚ç‚¹æ”¾åˆ°åˆé€‚çš„ä½ç½®ä¸Š if (s != 0) siftDown(0, x); setIndex(f, -1); return f;&#125; siftDownæ–¹æ³•siftDownæ–¹æ³•ä½¿å †ä»kå¼€å§‹å‘ä¸‹è°ƒæ•´ï¼š 12345678910111213141516171819202122232425private void siftDown(int k, RunnableScheduledFuture&lt;?&gt; key) &#123; // æ ¹æ®äºŒå‰æ ‘çš„ç‰¹æ€§ï¼Œæ•°ç»„é•¿åº¦é™¤ä»¥2ï¼Œè¡¨ç¤ºå–æœ‰å­èŠ‚ç‚¹çš„ç´¢å¼• int half = size &gt;&gt;&gt; 1; // åˆ¤æ–­ç´¢å¼•ä¸ºkçš„èŠ‚ç‚¹æ˜¯å¦æœ‰å­èŠ‚ç‚¹ while (k &lt; half) &#123; // å·¦å­èŠ‚ç‚¹çš„ç´¢å¼• int child = (k &lt;&lt; 1) + 1; RunnableScheduledFuture&lt;?&gt; c = queue[child]; // å³å­èŠ‚ç‚¹çš„ç´¢å¼• int right = child + 1; // å¦‚æœæœ‰å³å­èŠ‚ç‚¹å¹¶ä¸”å·¦å­èŠ‚ç‚¹çš„æ—¶é—´é—´éš”å¤§äºå³å­èŠ‚ç‚¹ï¼Œå–æ—¶é—´é—´éš”æœ€å°çš„èŠ‚ç‚¹ if (right &lt; size &amp;&amp; c.compareTo(queue[right]) &gt; 0) c = queue[child = right]; // å¦‚æœkeyçš„æ—¶é—´é—´éš”å°äºç­‰äºcçš„æ—¶é—´é—´éš”ï¼Œè·³å‡ºå¾ªç¯ if (key.compareTo(c) &lt;= 0) break; // è®¾ç½®è¦ç§»é™¤ç´¢å¼•çš„èŠ‚ç‚¹ä¸ºå…¶å­èŠ‚ç‚¹ queue[k] = c; setIndex(c, k); k = child; &#125; // å°†keyæ”¾å…¥ç´¢å¼•ä¸ºkçš„ä½ç½® queue[k] = key; setIndex(key, k);&#125; siftDownæ–¹æ³•æ‰§è¡Œæ—¶åŒ…å«ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œä¸€ç§æ˜¯æœ‰å­èŠ‚ç‚¹ï¼ˆæ ¹æ®halfåˆ¤æ–­ï¼‰ã€‚ä¾‹å¦‚ï¼š æ²¡æœ‰å­èŠ‚ç‚¹çš„æƒ…å†µï¼š å‡è®¾åˆå§‹çš„å †å¦‚ä¸‹ï¼š å‡è®¾ k = 3 ï¼Œé‚£ä¹ˆ k = half ï¼Œæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œåœ¨æ‰§è¡ŒsiftDownæ–¹æ³•æ—¶ç›´æ¥æŠŠç´¢å¼•ä¸º3çš„èŠ‚ç‚¹è®¾ç½®ä¸ºæ•°ç»„çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼š æœ‰å­èŠ‚ç‚¹çš„æƒ…å†µï¼š å‡è®¾ k = 0 ï¼Œé‚£ä¹ˆæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š è·å–å·¦å­èŠ‚ç‚¹ï¼Œchild = 1 ï¼Œè·å–å³å­èŠ‚ç‚¹ï¼Œ right = 2 ï¼š ç”±äº right &lt; size ï¼Œè¿™æ—¶æ¯”è¾ƒå·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹æ—¶é—´é—´éš”çš„å¤§å°ï¼Œè¿™é‡Œ 3 &lt; 7 ï¼Œæ‰€ä»¥ c = queue[child] ï¼› æ¯”è¾ƒkeyçš„æ—¶é—´é—´éš”æ˜¯å¦å°äºcçš„æ—¶é—´é—´éš”ï¼Œè¿™é‡Œä¸æ»¡è¶³ï¼Œç»§ç»­æ‰§è¡Œï¼ŒæŠŠç´¢å¼•ä¸ºkçš„èŠ‚ç‚¹è®¾ç½®ä¸ºcï¼Œç„¶åå°†kè®¾ç½®ä¸ºchildï¼Œï¼› å› ä¸º half = 3 ï¼Œk = 1 ï¼Œç»§ç»­æ‰§è¡Œå¾ªç¯ï¼Œè¿™æ—¶çš„ç´¢å¼•å˜ä¸ºï¼š è¿™æ—¶å†ç»è¿‡å¦‚ä¸Šåˆ¤æ–­åï¼Œå°†kçš„å€¼ä¸º3ï¼Œæœ€ç»ˆçš„ç»“æœå¦‚ä¸‹ï¼š æœ€åï¼Œå¦‚æœåœ¨finishPollæ–¹æ³•ä¸­è°ƒç”¨çš„è¯ï¼Œä¼šæŠŠç´¢å¼•ä¸º0çš„èŠ‚ç‚¹çš„ç´¢å¼•è®¾ç½®ä¸º-1ï¼Œè¡¨ç¤ºå·²ç»åˆ é™¤äº†è¯¥èŠ‚ç‚¹ï¼Œå¹¶ä¸”sizeä¹Ÿå‡äº†1ï¼Œæœ€åçš„ç»“æœå¦‚ä¸‹ï¼š å¯è§ï¼Œsiftdownæ–¹æ³•åœ¨æ‰§è¡Œå®Œå¹¶ä¸æ˜¯æœ‰åºçš„ï¼Œä½†å¯ä»¥å‘ç°ï¼Œå­èŠ‚ç‚¹çš„ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ä¸€å®šæ¯”çˆ¶èŠ‚ç‚¹çš„ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´è¦å¤§ï¼Œç”±äºæ¯æ¬¡éƒ½ä¼šå–å·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹ä¸­ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´æœ€å°çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿˜æ˜¯å¯ä»¥ä¿è¯åœ¨takeå’Œpollæ—¶å‡ºé˜Ÿæ˜¯æœ‰åºçš„ã€‚ removeæ–¹æ³•1234567891011121314151617181920212223242526public boolean remove(Object x) &#123; final ReentrantLock lock = this.lock; lock.lock(); try &#123; int i = indexOf(x); if (i &lt; 0) return false; setIndex(queue[i], -1); int s = --size; RunnableScheduledFuture&lt;?&gt; replacement = queue[s]; queue[s] = null; if (s != i) &#123; // ä»iå¼€å§‹å‘ä¸‹è°ƒæ•´ siftDown(i, replacement); // å¦‚æœqueue[i] == replacementï¼Œè¯´æ˜iæ˜¯å¶å­èŠ‚ç‚¹ // å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œä¸èƒ½ä¿è¯å­èŠ‚ç‚¹çš„ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´æ¯”çˆ¶èŠ‚ç‚¹çš„å¤§ // è¿™æ—¶éœ€è¦è¿›è¡Œä¸€æ¬¡å‘ä¸Šè°ƒæ•´ if (queue[i] == replacement) siftUp(i, replacement); &#125; return true; &#125; finally &#123; lock.unlock(); &#125;&#125; å‡è®¾åˆå§‹çš„å †ç»“æ„å¦‚ä¸‹ï¼š è¿™æ—¶è¦åˆ é™¤8çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™æ—¶ k = 1ï¼Œkeyä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼š è¿™æ—¶é€šè¿‡ä¸Šæ–‡å¯¹siftDownæ–¹æ³•çš„åˆ†æï¼ŒsiftDownæ–¹æ³•æ‰§è¡Œåçš„ç»“æœå¦‚ä¸‹ï¼š è¿™æ—¶ä¼šå‘ç°ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹çš„å€¼æ¯”çˆ¶èŠ‚ç‚¹è¿˜è¦å°ï¼Œæ‰€ä»¥è¿™é‡Œè¦æ‰§è¡Œä¸€æ¬¡siftUpæ–¹æ³•æ¥ä¿è¯å­èŠ‚ç‚¹çš„ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´è¦æ¯”çˆ¶èŠ‚ç‚¹çš„å¤§ï¼Œæ‰€ä»¥æœ€ç»ˆç»“æœå¦‚ä¸‹ï¼š æ€»ç»“æœ¬æ–‡è¯¦ç»†åˆ†æäº†ScheduedThreadPoolExecutorçš„å®ç°ï¼Œä¸»è¦ä»‹ç»äº†ä»¥ä¸‹æ–¹é¢ï¼š ä¸Timeræ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„æ¯”è¾ƒï¼Œç›¸æ¯”Timerï¼ŒScheduedThreadPoolExecutoræœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼› ScheduledThreadPoolExecutorç»§æ‰¿è‡ªThreadPoolExecutorï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œä¹Ÿæœ‰coorPoolSizeå’ŒworkQueueï¼ŒScheduledThreadPoolExecutorç‰¹æ®Šçš„åœ°æ–¹åœ¨äºï¼Œè‡ªå·±å®ç°äº†ä¼˜å…ˆå·¥ä½œé˜Ÿåˆ—DelayedWorkQueueï¼› ScheduedThreadPoolExecutorå®ç°äº†ScheduledExecutorServiceï¼Œæ‰€ä»¥å°±æœ‰äº†ä»»åŠ¡è°ƒåº¦çš„æ–¹æ³•ï¼Œå¦‚scheduleï¼ŒscheduleAtFixedRateå’ŒscheduleWithFixedDelayï¼ŒåŒæ—¶æ³¨æ„ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ï¼› å†…éƒ¨ç±»ScheduledFutureTaskç»§æ‰¿è‡ªFutureTaskï¼Œå®ç°äº†ä»»åŠ¡çš„å¼‚æ­¥æ‰§è¡Œå¹¶ä¸”å¯ä»¥è·å–è¿”å›ç»“æœã€‚åŒæ—¶ä¹Ÿå®ç°äº†Delayedæ¥å£ï¼Œå¯ä»¥é€šè¿‡getDelayæ–¹æ³•è·å–å°†è¦æ‰§è¡Œçš„æ—¶é—´é—´éš”ï¼› å‘¨æœŸä»»åŠ¡çš„æ‰§è¡Œå…¶å®æ˜¯è°ƒç”¨äº†FutureTaskç±»ä¸­çš„runAndResetæ–¹æ³•ï¼Œæ¯æ¬¡æ‰§è¡Œå®Œä¸è®¾ç½®ç»“æœå’ŒçŠ¶æ€ã€‚å‚è€ƒFutureTaskæºç è§£æï¼› è¯¦ç»†åˆ†æäº†DelayedWorkQueueçš„æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäºæœ€å°å †ç»“æ„çš„ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå¹¶ä¸”æ¯æ¬¡å‡ºé˜Ÿæ—¶èƒ½å¤Ÿä¿è¯å–å‡ºçš„ä»»åŠ¡æ˜¯å½“å‰é˜Ÿåˆ—ä¸­ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´æœ€å°çš„ä»»åŠ¡ã€‚åŒæ—¶æ³¨æ„ä¸€ä¸‹ä¼˜å…ˆé˜Ÿåˆ—ä¸­å †çš„é¡ºåºï¼Œå †ä¸­çš„é¡ºåºå¹¶ä¸æ˜¯ç»å¯¹çš„ï¼Œä½†è¦ä¿è¯å­èŠ‚ç‚¹çš„å€¼è¦æ¯”çˆ¶èŠ‚ç‚¹çš„å€¼è¦å¤§ï¼Œè¿™æ ·å°±ä¸ä¼šå½±å“å‡ºé˜Ÿçš„é¡ºåºã€‚ æ€»ä½“æ¥è¯´ï¼ŒScheduedThreadPoolExecutorçš„é‡ç‚¹æ˜¯è¦ç†è§£ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´çš„è®¡ç®—ï¼Œä»¥åŠä¼˜å…ˆé˜Ÿåˆ—çš„å‡ºé˜Ÿã€å…¥é˜Ÿå’Œåˆ é™¤çš„è¿‡ç¨‹ï¼Œè¿™ä¸¤ä¸ªæ˜¯ç†è§£ScheduedThreadPoolExecutorçš„å…³é”®ã€‚]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>çº¿ç¨‹æ± </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šçº¿ç¨‹ï¼ˆä¸‰ï¼‰--- å¹¶å‘å®¹å™¨]]></title>
    <url>%2F2020%2F02%2F27%2F%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89----%20%E5%B9%B6%E5%8F%91%E5%AE%B9%E5%99%A8.html</url>
    <content type="text"><![CDATA[ConcurrentHashMapè¿™ä¸ªæˆ‘åœ¨ Map &amp; Set æºç åˆ†æ ä¸­å·²ç»éå¸¸è¯¦ç»†çš„è®²è¿‡äº†ï¼Œè¿™é‡Œå°±ç›´æ¥ç•¥è¿‡äº†â€¦ CopyOnWriteArrayList https://juejin.im/post/5aeeae756fb9a07ab11112af å–ï¼è¿™ä¸ªæ›´ç®€å•å“ˆå“ˆå“ˆï¼Œå…¶å®ä¹Ÿå°±æ˜¯è¯»ä¸åŠ é”ï¼Œå†™åŠ ä¸ªé”ï¼Œå†™çš„æ—¶å€™ç”±äºæ˜¯å…ˆå¤åˆ¶ä¸€éï¼Œç„¶åå†å†™å›åˆ°åŸæ•°ç»„ï¼Œæ‰€ä»¥å­˜åœ¨è¯»å†™çš„å¼±ä¸€è‡´æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´è¯»åˆ°çš„æ•°æ®å¯èƒ½ä¸ä¼šæ˜¯æœ€æ–°çš„ã€‚ BlockingQueueé˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰è¢«å¹¿æ³›ä½¿ç”¨åœ¨â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€é—®é¢˜ä¸­ï¼Œå…¶åŸå› æ˜¯ BlockingQueue æä¾›äº†å¯é˜»å¡çš„æ’å…¥å’Œç§»é™¤çš„æ–¹æ³•ã€‚å½“é˜Ÿåˆ—å®¹å™¨å·²æ»¡ï¼Œç”Ÿäº§è€…çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—æœªæ»¡ï¼›å½“é˜Ÿåˆ—å®¹å™¨ä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´è‡³é˜Ÿåˆ—éç©ºæ—¶ä¸ºæ­¢ã€‚å…¶å®å°±æ˜¯å°è£…äº†æˆ‘åœ¨ Condition é‚£ä¸€å—ä¸¾çš„ä¾‹å­ã€‚ç›¸æ¯”äºå¹³å¸¸çš„ Queue()ï¼Œå°±æ˜¯åœ¨å…¥é˜Ÿå‡ºé˜Ÿå°è£…äº†ä¸‹ Conditionï¼Œä¹Ÿå°±æ˜¯ put() å’Œ take() ã€Œå…¥é˜Ÿå’Œå‡ºé˜Ÿã€ã€‚ https://juejin.im/post/5aeebd02518825672f19c546 ArrayBlockingQueue &amp; LinkedBlockingQueue https://juejin.im/post/5aeebdb26fb9a07aa83ea17e æŒºç®€å•çš„â€¦æ²¡å•¥è®²çš„ã€‚]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>å¹¶å‘å®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šçº¿ç¨‹ï¼ˆäºŒï¼‰--- ThreadLocal]]></title>
    <url>%2F2020%2F02%2F27%2F%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89----%20ThreadLocal.html</url>
    <content type="text"><![CDATA[ThreadLocalè¿™ä¸ªéœ€è¦å¥½å¥½å†™ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚éš¾ç‚¹ä¸»è¦å°±åœ¨ Thread å’Œ ThreadLocal ä¹‹é—´çš„å…³ç³»ã€‚ ä¸»è¦å‚è€ƒäº†ThreadLocalçš„åŸç†éƒ¨åˆ†ï¼Œå°±æ˜¯è¿™ç¯‡æ–‡ç« ç»ˆäºè®©æˆ‘æ˜ç™½æˆ‘æƒ³é”™äº† åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ³¨æ„ä¸è¦ä¿å­˜å¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™æ ·çš„è¯æ‹·è´çš„å‰¯æœ¬ä¹Ÿå¿…ç„¶æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼Œæœ€ç»ˆéƒ½ä¼šæ”¹å˜å¯¹è±¡ï¼Œè¿™æ ·å°±ä¸å¯¹äº† ThreadLocal ç®€è¿° ThreadLocal å†…å­˜æ³„æ¼é—®é¢˜ ThreadLocalç›¸å…³é—®é¢˜ï¼éå¸¸æœ‰æ·±åº¦ï¼é¢è¯•ä¹‹å‰ä¸€å®šè¦å†çœ‹çœ‹ï¼ï¼ï¼ï¼ï¼å¼ºçƒˆæ¨èï¼ï¼ï¼ ThreadLocal ç®€ä»‹ ThreadLocal ä¸çº¿ç¨‹åŒæ­¥æ— å…³ã€‚ ThreadLocalè™½ç„¶æä¾›äº†ä¸€ç§è§£å†³å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æˆå‘˜å˜é‡çš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯è§£å†³å¤šçº¿ç¨‹å…±äº«å˜é‡çš„é—®é¢˜ã€‚å¯¹äºå¤šçº¿ç¨‹èµ„æºå…±äº«çš„é—®é¢˜ï¼ŒåŒæ­¥æœºåˆ¶é‡‡ç”¨äº†â€œä»¥æ—¶é—´æ¢ç©ºé—´â€çš„æ–¹å¼ï¼Œè€ŒThreadLocalé‡‡ç”¨äº†â€œä»¥ç©ºé—´æ¢æ—¶é—´â€çš„æ–¹å¼ã€‚å‰è€…ä»…æä¾›ä¸€ä»½å˜é‡ï¼Œè®©ä¸åŒçš„çº¿ç¨‹æ’é˜Ÿè®¿é—®ï¼Œè€Œåè€…ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æä¾›äº†ä¸€ä»½å˜é‡ï¼Œå› æ­¤å¯ä»¥åŒæ—¶è®¿é—®è€Œäº’ä¸å½±å“ã€‚ æ­£å¦‚ä¸Šé¢æ‰€è¨€ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šå¤åˆ¶ä¸€ä»½ ThreadLocal çš„å‰¯æœ¬ï¼Œç„¶åçº¿ç¨‹å†…éƒ¨è¿›è¡Œä½¿ç”¨ï¼Œæ‰€è°“çš„ ThreadLocalå°±æ˜¯æŒ‡ â€œçº¿ç¨‹å±€éƒ¨å˜é‡â€ã€‚ ThreadLocal åŸç†çœ‹æºç çš„æ—¶å€™ï¼Œè¢« ThreadLocalã€ThreadLocalMapã€threadLocals ç»•æ™•äº†ï¼Œæœ€åç»ˆäºç»•æ˜ç™½äº†â€¦å…¶å®è¿˜æ˜¯è‡ªå·±å…ˆå…¥ä¸ºä¸»çš„å»æ€è€ƒäº† ThreadLocal çš„å®ç°ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æ˜¯æ‹¥æœ‰ä¸€ä¸ª ThreadLocalMap çš„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ Map è€Œä¸ä½¿ç”¨ Pair å‘¢ï¼Ÿå› ä¸ºæ¯ä¸ªçº¿ç¨‹å¯èƒ½æ‹¥æœ‰éå¸¸å¤šä¸ª ThreadLocal å˜é‡ã€‚å†é‡å¤ä¸€éï¼ŒThreadLocalMap æ˜¯ä»å±äºæ¯ä¸ªçº¿ç¨‹çš„ï¼Œæ¯ä¸ªçº¿ç¨‹è‡ªå·±ç®¡ç†è‡ªå·±çš„ mapï¼Œæ—¢ç„¶è¯´åˆ°è¿™ï¼Œæˆ‘å°±å†è¯¦ç»†çš„è¯´ä¸€ä¸‹ã€‚ æˆ‘çš„æƒ³æ³•â€”-ThreadLocal ç»´æŠ¤çº¿ç¨‹ä¸å®ä¾‹çš„æ˜ å°„å› ä¸ºæˆ‘çœ‹ ThreadLocalMap æ˜¯ ThreadLocal çš„ å†…éƒ¨ç±»ï¼Œæ‰€ä»¥ä»¥ä¸ºä»å±å…³ç³»æ˜¯ Map ä»å±äºè¯¥å˜é‡ï¼Œé‚£ä¸€ä¸ªå¯èƒ½çš„æ–¹æ¡ˆå°±æ˜¯æ¯ä¸€ä¸ª ThreadLocal å˜é‡éƒ½ç»´æŠ¤ä¸€ä¸ª ThreadLocalMapï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯ä¸ªè®¿é—® ThreadLocal å˜é‡çš„çº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸€ä¸ªâ€œæœ¬åœ°â€å®ä¾‹å‰¯æœ¬ã€‚çº¿ç¨‹é€šè¿‡è¯¥ ThreadLocal çš„ get() æ–¹æ¡ˆè·å–å®ä¾‹æ—¶ï¼Œåªéœ€è¦ä»¥çº¿ç¨‹ä¸ºé”®ï¼Œä» Map ä¸­æ‰¾å‡ºå¯¹åº”çš„å®ä¾‹å³å¯ã€‚è¯¥æ–¹æ¡ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¯¥æ–¹æ¡ˆå¯æ»¡è¶³ä¸Šæ–‡æåˆ°çš„æ¯ä¸ªçº¿ç¨‹å†…ä¸€ä¸ªç‹¬ç«‹å¤‡ä»½çš„è¦æ±‚ã€‚æ¯ä¸ªæ–°çº¿ç¨‹è®¿é—®è¯¥ ThreadLocal æ—¶ï¼Œéœ€è¦å‘ Map ä¸­æ·»åŠ ä¸€ä¸ªæ˜ å°„ï¼Œè€Œæ¯ä¸ªçº¿ç¨‹ç»“æŸæ—¶ï¼Œåº”è¯¥æ¸…é™¤è¯¥æ˜ å°„ã€‚è¿™é‡Œå°±æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š å¢åŠ çº¿ç¨‹ä¸å‡å°‘çº¿ç¨‹å‡éœ€è¦å†™ Mapï¼Œæ•…éœ€ä¿è¯è¯¥ Map çº¿ç¨‹å®‰å…¨ã€‚è™½ç„¶æœ‰å‡ ç§å®ç°çº¿ç¨‹å®‰å…¨ Map çš„æ–¹å¼ï¼Œä½†å®ƒæˆ–å¤šæˆ–å°‘éƒ½éœ€è¦é”æ¥ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§ã€‚ çº¿ç¨‹ç»“æŸæ—¶ï¼Œéœ€è¦ä¿è¯å®ƒæ‰€è®¿é—®çš„æ‰€æœ‰ ThreadLocal ä¸­å¯¹åº”çš„æ˜ å°„å‡åˆ é™¤ï¼Œå¦åˆ™å¯èƒ½ä¼šå¼•èµ·å†…å­˜æ³„æ¼ã€‚ï¼ˆåæ–‡ä¼šä»‹ç»é¿å…å†…å­˜æ³„æ¼çš„æ–¹æ³•ï¼‰ å…¶ä¸­é”çš„é—®é¢˜ï¼Œåº”è¯¥æ˜¯ JDK æœªé‡‡ç”¨è¯¥æ–¹æ¡ˆçš„ä¸€ä¸ªåŸå› ã€‚ çœŸæ­£çš„å®ç°â€”-Thread ç»´æŠ¤ThreadLocalä¸å®ä¾‹çš„æ˜ å°„ä¸Šè¿°æ–¹æ¡ˆä¸­ï¼Œå‡ºç°é”çš„é—®é¢˜ï¼ŒåŸå› åœ¨äºå¤šçº¿ç¨‹è®¿é—®åŒä¸€ä¸ª Mapã€‚å¦‚æœè¯¥ Map ç”± Thread ç»´æŠ¤ï¼Œä»è€Œä½¿å¾—æ¯ä¸ª Thread åªè®¿é—®è‡ªå·±çš„ Mapï¼Œé‚£å°±ä¸å­˜åœ¨å¤šçº¿ç¨‹å†™çš„é—®é¢˜ï¼Œä¹Ÿå°±ä¸éœ€è¦é”ã€‚è¯¥æ–¹æ¡ˆå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ è¯¥æ–¹æ¡ˆè™½ç„¶æ²¡æœ‰é”çš„é—®é¢˜ï¼Œä½†æ˜¯ç”±äºæ¯ä¸ªçº¿ç¨‹è®¿é—®æŸ ThreadLocal å˜é‡åï¼Œéƒ½ä¼šåœ¨è‡ªå·±çš„ Map å†…ç»´æŠ¤è¯¥ ThreadLocal å˜é‡ä¸å…·ä½“å®ä¾‹çš„æ˜ å°„ï¼Œå¦‚æœä¸åˆ é™¤è¿™äº›å¼•ç”¨ï¼ˆæ˜ å°„ï¼‰ï¼Œåˆ™è¿™äº› ThreadLocal ä¸èƒ½è¢«å›æ”¶ï¼Œå¯èƒ½ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚åæ–‡ä¼šä»‹ç» JDK å¦‚ä½•è§£å†³è¯¥é—®é¢˜ã€‚ ThreadLocal ä½¿ç”¨ Demoåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆæ¥ä½¿ç”¨ä¸€ä¸‹ ThreadLocalï¼Œå†æ¥åˆ†æå…¶æºç ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344package å¤šçº¿ç¨‹;import java.text.ParseException;import java.text.SimpleDateFormat;import java.util.Date;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;public class ThreadLocalTest &#123;&#125;class ThreadLocalDemo &#123; private static ThreadLocal&lt;SimpleDateFormat&gt; sdf = new ThreadLocal&lt;&gt;(); public static void main(String[] args) &#123; ExecutorService executorService = Executors.newFixedThreadPool(10); for (int i = 0; i &lt; 100; i++) &#123; executorService.submit(new DateUtil("2019-11-25 09:00:" + i % 60)); &#125; &#125; static class DateUtil implements Runnable &#123; private String date; public DateUtil(String date) &#123; this.date = date; &#125; @Override public void run() &#123; if (sdf.get() == null) &#123; sdf.set(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss")); &#125; else &#123; try &#123; Date date = sdf.get().parse(this.date); System.out.println(date); &#125; catch (ParseException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;&#125; æ³¨æ„æˆ‘ä»¬åœ¨è¿™é‡Œï¼Œç”¨çš„æ˜¯ private static ä¿®é¥°çš„ ThreadLocalï¼Œä¸‹æ–‡æœ‰è¯´ä¸ºä½•å®˜æ–¹æ¨èè¿™æ ·ä¿®é¥°ã€‚ æ³¨æ„åˆ°æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ–¹æ³•æ˜¯ sdf.get()ï¼Œsdf.set(obj)ã€‚ ThreadLocal æºç åˆ†æåˆ†æä¹‹å‰ï¼Œæˆ‘è¯´ä¸€ä¸‹é‡ç‚¹ï¼Œæœ€æ ¸å¿ƒçš„å½“ç„¶æ˜¯ ThreadLocal ä¸­çš„å†…éƒ¨ç±» ThreadLocalMapï¼Œæ•´ä¸ªåº•å±‚çš„å®ç°åŸºæœ¬å…¨éƒ¨ä¾æ‰˜äºè¯¥å†…éƒ¨ç±»ï¼ŒåŒæ—¶åˆ«å¿˜äº†ä¸ºäº† Thread å’Œ ThreadLocalMap ä¸€ä¸€å¯¹åº”ï¼ŒThread äº†ç±»ä¸­æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡â€”-threadLocalsã€‚ 123/* ThreadLocal values pertaining to this thread. This map is maintained * by the ThreadLocal class. */ThreadLocal.ThreadLocalMap threadLocals = null; æ¥ä¸‹æ¥æ­£å¼è¿›å…¥æºç åˆ†ææ¥é˜¶æ®µï¼š ThreadLocal éƒ¨åˆ†æ–¹æ³•set()12345678910111213141516 public void set(T value) &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); &#125; ThreadLocalMap getMap(Thread t) &#123; return t.threadLocals; &#125;void createMap(Thread t, T firstValue) &#123; t.threadLocals = new ThreadLocalMap(this, firstValue); &#125; é€»è¾‘å¦‚ä¸‹ï¼š é€šè¿‡ getMap() æ‹¿åˆ°å½“å‰çº¿ç¨‹å¯¹åº”çš„ ThreadLocalsï¼Œæ³¨æ„è¿™é‡Œå¯èƒ½æœ‰å¤šä¸ª ThreadLocalï¼Œæ‰€ä»¥è¿”å›çš„æ˜¯ä¸€ä¸ªmapï¼› å¦‚æœ map ä¸ºç©ºï¼Œè¯´æ˜è¯¥çº¿ç¨‹è¿˜æ²¡æœ‰ä½¿ç”¨è¿‡ ThreadLocal å˜é‡ï¼Œæ­¤æ—¶å°±è°ƒç”¨ createMap() æ–°å»ºä¸€ä¸ª ThreadLocalMapï¼Œè¿™é‡Œ map åˆå‡ºç°äº†ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»æ„Ÿå—åˆ°äº†é‡è¦æ€§äº†ã€‚ å¦‚æœ map ä¸ä¸ºç©ºï¼Œæˆ‘ä»¬å°±æŠŠ key = å½“å‰çš„ ThreadLocalï¼Œvalue å³ä¸ºå½“å‰çº¿ç¨‹çš„ ThreadLocal å‰¯æœ¬ å¯¹åº”çš„å€¼ã€‚ get()1234567891011121314151617181920212223public T get() &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) &#123; @SuppressWarnings("unchecked") T result = (T)e.value; return result; &#125; &#125; return setInitialValue();&#125; private T setInitialValue() &#123; T value = initialValue(); Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); return value; &#125; é€»è¾‘å¦‚ä¸‹ï¼š é€šè¿‡å½“å‰çº¿ç¨‹æ‹¿åˆ° mapï¼Œç„¶åæ‹¿åˆ°å¯¹åº”çš„ key çš„ entryï¼Œç„¶åè¿”å›å¯¹åº”çš„ value å€¼ã€‚ å¦‚æœ map ä¸ºç©ºï¼Œåˆ™ è°ƒç”¨ setInitialValue()ï¼Œè°ƒç”¨åˆå§‹åŒ– ThreadLocal æ—¶çš„å€¼ã€‚ remove()12345public void remove() &#123; ThreadLocalMap m = getMap(Thread.currentThread()); if (m != null) m.remove(this);&#125; æ‡’å¾—è§£é‡Šäº†â€¦è¿˜æ˜¯è°ƒç”¨çš„ ThreadLocalMap ä¸­çš„ remove() å‡½æ•°ã€‚ ThreadLocalMapï¼ˆä¸€ï¼‰å‰é¢çš„æ–¹æ³•å·²ç»é“ºå«å¾ˆä¹…äº†ï¼Œæ‰€æœ‰çš„æ–¹æ³•åŸºæœ¬éƒ½æ˜¯åŸºäºè¿™ä¸ªç±»å®ç°çš„ã€‚ThreadLocal 700å¤šè¡Œæºä»£ç ï¼Œæœ‰500å¤šè¡Œéƒ½æ˜¯å†…éƒ¨ç±» ThreadLocalMapã€‚ æ•°æ®ç»“æ„å¿…é¡»è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™é‡Œçš„ map ä¸åŒäºæˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„ HashMapã€TreeMapç­‰ï¼Œè¿™é‡Œçš„ map åº•å±‚é‡‡ç”¨çš„å°±æ˜¯åªæœ‰æ•°ç»„ï¼Œæ²¡æœ‰ç”¨åˆ°çº¢é»‘æ ‘å’Œé“¾è¡¨ï¼Œå› ä¸ºè¿™é‡Œè§£å†³å†²çªçš„æ–¹æ³•å¹¶ä¸æ˜¯é“¾åœ°å€æ³•ï¼Œè€Œæ˜¯å¼€æ”¾åœ°å€æ³•ä¸­çš„çº¿æ€§æ¢æµ‹ã€‚æ‰€ä»¥è¿™é‡Œæ•°ç»„çš„åŸºæœ¬å•å…ƒæ˜¯ Entryã€‚ 123456789static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; &#123; /** The value associated with this ThreadLocal. */ Object value; Entry(ThreadLocal&lt;?&gt; k, Object v) &#123; super(k); value = v; &#125;&#125; Tip: è¿™é‡Œæœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ç±» WeakReferenceï¼Œä¹Ÿå°±æ˜¯å¼±å¼•ç”¨ï¼Œæˆ‘ä»¬åé¢ä¼šè¯¦ç»†ä»‹ç»è¿™ä¸ªï¼Œå› ä¸ºè¿™ä¸ªè·Ÿå†…å­˜æ³„æ¼æœ‰å¾ˆå¤§çš„å…³ç³»ã€‚ ç„¶ååˆå§‹å€¼è·Ÿ HashMap ä¸€æ ·ï¼Œéƒ½æ˜¯ 16ï¼Œä½†æ˜¯å…¶è£…è½½å› å­å˜æˆäº† 2/3ï¼Œè£…è½½å› å­è¶Šå¤§ï¼Œè¶Šå®¹æ˜“å‡ºç°å†²çªçš„ç°è±¡ï¼Œä½†æ˜¯è£…è½½å› å­è¶Šå°ï¼Œå°±è¶Šæµªè´¹ç©ºé—´ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„è£…è½½å› å­æ˜¯æ¯” HashMap è¦å°çš„ï¼Œæ‰€ä»¥è¿™é‡Œæ›´ä¸å®¹æ˜“äº§ç”Ÿå†²çªï¼Œè¿™ä¹Ÿæ˜¯é‡‡ç”¨å¼€æ”¾åœ°å€æ³•çš„åŸå› å§ã€‚ ç°åœ¨æ¥åˆ†æä¸€ä¸‹ä¸»è¦çš„å‡½æ•°ï¼š set()123456789101112131415161718192021222324252627282930313233private void set(ThreadLocal&lt;?&gt; key, Object value) &#123; //è¿™é‡Œæœ‰ä¸€æ®µè‹±æ–‡æ³¨é‡Šï¼Œæ„æ€æ˜¯ä¸ä¼šåƒ get() ä¸€æ ·ï¼Œç›´æ¥å»æ‰¾ï¼ŒæˆåŠŸäº†å°±è¿”å›ï¼Œæ²¡æˆåŠŸå°±å†è°ƒç”¨å¦å¤–ä¸€ä¸ªå‡½æ•° // å› ä¸º set()å¤§æ¦‚ç‡æ˜¯å¤±è´¥çš„å¤šï¼Œæ‰€ä»¥å°±ç›´æ¥å†™åœ¨ä¸€ä¸ªå‡½æ•°å†…äº†ã€‚ Entry[] tab = table; int len = tab.length; //æ ¹æ®threadLocalçš„hashCodeç¡®å®šEntryåº”è¯¥å­˜æ”¾çš„ä½ç½® int i = key.threadLocalHashCode &amp; (len-1); //é‡‡ç”¨å¼€æ”¾åœ°å€æ³•ï¼Œhashå†²çªçš„æ—¶å€™ä½¿ç”¨çº¿æ€§æ¢æµ‹ for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) &#123; ThreadLocal&lt;?&gt; k = e.get(); //è¦†ç›–æ—§Entry if (k == key) &#123; e.value = value; return; &#125; //å½“keyä¸ºnullæ—¶ï¼Œè¯´æ˜threadLocalå¼ºå¼•ç”¨å·²ç»è¢«é‡Šæ”¾æ‰ï¼Œé‚£ä¹ˆå°±æ— æ³• //å†é€šè¿‡è¿™ä¸ªkeyè·å–threadLocalMapä¸­å¯¹åº”çš„entryï¼Œè¿™é‡Œå°±å­˜åœ¨å†…å­˜æ³„æ¼çš„å¯èƒ½æ€§ if (k == null) &#123; //ç”¨å½“å‰æ’å…¥çš„å€¼æ›¿æ¢æ‰è¿™ä¸ªkeyä¸ºnullçš„â€œè„â€entry replaceStaleEntry(key, value, i); return; &#125; &#125; //æ–°å»ºentryå¹¶æ’å…¥tableä¸­iå¤„ tab[i] = new Entry(key, value); int sz = ++size; //æ’å…¥åå†æ¬¡æ¸…é™¤ä¸€äº›keyä¸ºnullçš„â€œè„â€entry,å¦‚æœå¤§äºé˜ˆå€¼å°±éœ€è¦æ‰©å®¹ if (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold) rehash();&#125; é€»è¾‘å¦‚ä¸‹ï¼š å…ˆç¡®å®š ThreadLocal æ‰€åœ¨çš„ä½ç½®ï¼› ç„¶åé‡‡ç”¨çº¿æ€§æ¢æµ‹æ³•ï¼Œç¡®å®šä½ç½®ï¼› å¦‚æœå­˜åœ¨è¯¥ ThreadLocalï¼Œé‚£ä¹ˆç›´æ¥è¦†ç›–å°±å¥½äº†ï¼›å¦‚æœä¸º nullï¼Œè¯´æ˜è¯¥ ThreadLocalçš„å¼ºå¼•ç”¨å·²ç»æ¶ˆå¤±ï¼Œæ­¤æ—¶ç›´æ¥åœ¨è¯¥ä½ç½®æ’å…¥å³å¯ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±æ–°å»ºä¸€ä¸ª Entryï¼Œæ’å…¥ï¼Œæœ€åå†æ¬¡æ¸…æ¥š è„entryï¼Œå¹¶åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚ã€Œåé¢ä¼šè¯¦ç»†è®²ä¸“é—¨å¤„ç†è„ entry çš„è¿™å‡ ä¸ªæ–¹æ³•ã€ getEntry()123456789101112private Entry getEntry(ThreadLocal&lt;?&gt; key) &#123; //1. ç¡®å®šåœ¨æ•£åˆ—æ•°ç»„ä¸­çš„ä½ç½® int i = key.threadLocalHashCode &amp; (table.length - 1); //2. æ ¹æ®ç´¢å¼•iè·å–entry Entry e = table[i]; //3. æ»¡è¶³æ¡ä»¶åˆ™è¿”å›è¯¥entry if (e != null &amp;&amp; e.get() == key) return e; else //4. æœªæŸ¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„entryï¼Œé¢å¤–åœ¨åšçš„å¤„ç† return getEntryAfterMiss(key, i, e);&#125; 12345678910111213141516171819private Entry getEntryAfterMiss(ThreadLocal&lt;?&gt; key, int i, Entry e) &#123; Entry[] tab = table; int len = tab.length; while (e != null) &#123; ThreadLocal&lt;?&gt; k = e.get(); if (k == key) //æ‰¾åˆ°å’ŒæŸ¥è¯¢çš„keyç›¸åŒçš„entryåˆ™è¿”å› return e; if (k == null) //è§£å†³è„entryçš„é—®é¢˜ expungeStaleEntry(i); else //ç»§ç»­å‘åç¯å½¢æŸ¥æ‰¾ i = nextIndex(i, len); e = tab[i]; &#125; return null;&#125; resize()123456789101112131415161718192021222324252627282930313233343536/** * Double the capacity of the table. */private void resize() &#123; Entry[] oldTab = table; int oldLen = oldTab.length; //æ–°æ•°ç»„ä¸ºåŸæ•°ç»„çš„2å€ int newLen = oldLen * 2; Entry[] newTab = new Entry[newLen]; int count = 0; for (int j = 0; j &lt; oldLen; ++j) &#123; Entry e = oldTab[j]; if (e != null) &#123; ThreadLocal&lt;?&gt; k = e.get(); //éå†è¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°è„entryçš„è¯ç›´æ¥å¦valueä¸ºnull,æœ‰åŠ©äºvalueèƒ½å¤Ÿè¢«å›æ”¶ if (k == null) &#123; e.value = null; // Help the GC &#125; else &#123; //é‡æ–°ç¡®å®šentryåœ¨æ–°æ•°ç»„çš„ä½ç½®ï¼Œç„¶åè¿›è¡Œæ’å…¥ int h = k.threadLocalHashCode &amp; (newLen - 1); while (newTab[h] != null) h = nextIndex(h, newLen); newTab[h] = e; count++; &#125; &#125; &#125; //è®¾ç½®æ–°å“ˆå¸Œè¡¨çš„threshHoldå’Œsizeå±æ€§ setThreshold(newLen); size = count; table = newTab;&#125; private static int nextIndex(int i, int len) &#123; return ((i + 1 &lt; len) ? i + 1 : 0);&#125; æ‰©å®¹è¿˜æ˜¯éå¸¸ç®€å•çš„ï¼Œå› ä¸ºä¸æ¶‰åŠå¤šçº¿ç¨‹ï¼Œè€Œä¸”åªç”¨åˆ°æ•°ç»„ï¼Œæ•´ä½“é€»è¾‘å¦‚ä¸‹ï¼š new ä¸€ä¸ªåŸæ¥å®¹é‡ä¸¤å€çš„æ•°ç»„ï¼› é‡åˆ°äº†è„ entryï¼Œå°±å°†å…¶ value ç½®ä¸º nullï¼Œæ–¹ä¾¿ GCï¼Œå¦‚æœ key != nullï¼Œå°±é‡æ–°è®¡ç®— entry åœ¨æ–°æ•°ç»„çš„ä½ç½®ï¼› ç„¶åæ’å…¥ï¼Œå¦‚æœæœ‰å†²çªå°±çº¿æ€§æ¢æµ‹å°±å¥½äº†ï¼› æœ€åæ›´æ–° thresholdã€sizeã€tableå°±å¥½å•¦ã€‚ remove()12345678910111213141516private void remove(ThreadLocal&lt;?&gt; key) &#123; Entry[] tab = table; int len = tab.length; int i = key.threadLocalHashCode &amp; (len-1); for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) &#123; if (e.get() == key) &#123; //å°†entryçš„keyç½®ä¸ºnull e.clear(); //å°†è¯¥entryçš„valueä¹Ÿç½®ä¸ºnull expungeStaleEntry(i); return; &#125; &#125;&#125; è¿™é‡Œä¹Ÿå¾ˆç®€å•ï¼Œå°±ä¸è¯´äº†ï¼Œå°±è·Ÿä¸Šé¢çš„ä¸€æ ·ï¼Œåœ¨è¿™ç–¯ç‹‚ç”¨ expungeStaleEntry()ï¼ï¼ï¼ ThreadLocalMapï¼ˆäºŒï¼‰è¿™é‡Œå•ç‹¬å¼€ä¸€å°èŠ‚ï¼Œè®² ThreadLocalMapä¸­æ˜¯å¦‚ä½•å¤„ç†è„ entry çš„ï¼Œä¹Ÿå°±æ˜¯ key == null çš„é”®å€¼å¯¹ï¼Œè¿™æ ·ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œæ‰€ä»¥å¿…é¡»å¤„ç†ã€‚ cleanSomeSlots()å¯ä»¥çœ‹åˆ°ï¼Œæ ¸å¿ƒä¾æ—§æ˜¯ expungeStaleEntry()ã€‚ 123456789101112131415161718192021// æ¸…é™¤éƒ¨åˆ† è„entry// å¯å‘å¼çš„æ‰«æè¿‡æœŸæ•°æ®å¹¶æ“¦é™¤ï¼Œå¯å‘å¼æ˜¯è¿™æ ·çš„ï¼š// å¦‚æœå®åœ¨æ²¡æœ‰è¿‡æœŸæ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(log s)// å¦‚æœæœ‰è¿‡æœŸæ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(log n)private boolean cleanSomeSlots(int i, int n) &#123; boolean removed = false; Entry[] tab = table; int len = tab.length; do &#123; i = nextIndex(i, len); Entry e = tab[i]; // å¦‚æœ entry ä¸ä¸ºç©ºï¼Œä¸”entryä¸­çš„keyæŒ‡å‘çš„æ˜¯ null // è¯´æ˜äº§ç”Ÿäº† è„entry if (e != null &amp;&amp; e.get() == null) &#123; n = len; removed = true; i = expungeStaleEntry(i); &#125; &#125; while ( (n &gt;&gt;&gt;= 1) != 0); return removed;&#125; æ•´ä½“é€»è¾‘å¦‚ä¸‹ï¼š ä»æ’å…¥çš„entryç´¢å¼•çš„åä¸€ä½å¼€å§‹æ£€æµ‹æ˜¯å¦æœ‰ è„entryï¼› å…ˆn == sizeï¼Œlog n å»æ£€æµ‹ï¼Œå¦‚æœå‘ç°æœ‰è„entryï¼Œç«‹å³åŠ å¤§n = lengthï¼Œç„¶åä»ä¸‹ä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸º null çš„ç´¢å¼•ä½ç½® i ç»§ç»­ log n æ£€æµ‹ï¼› æœ€åè¿”å›æ˜¯å¦æœ‰ä¿®æ”¹ã€‚ expungeStaleEntry()1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** * Expunge a stale entry by rehashing any possibly colliding entries * lying between staleSlot and the next null slot. This also expunges * any other stale entries encountered before the trailing null. See * Knuth, Section 6.4 * * @param staleSlot index of slot known to have null key * @return the index of the next null slot after staleSlot * (all between staleSlot and this slot will have been checked * for expunging). */private int expungeStaleEntry(int staleSlot) &#123; Entry[] tab = table; int len = tab.length; //æ¸…é™¤å½“å‰è„entry // expunge entry at staleSlot tab[staleSlot].value = null; tab[staleSlot] = null; size--; // Rehash until we encounter null Entry e; int i; //2.å¾€åç¯å½¢ç»§ç»­æŸ¥æ‰¾,ç›´åˆ°é‡åˆ°table[i]==nullæ—¶ç»“æŸ for (i = nextIndex(staleSlot, len); (e = tab[i]) != null; i = nextIndex(i, len)) &#123; ThreadLocal&lt;?&gt; k = e.get(); //3. å¦‚æœåœ¨å‘åæœç´¢è¿‡ç¨‹ä¸­å†æ¬¡é‡åˆ°è„entryï¼ŒåŒæ ·å°†å…¶æ¸…ç†æ‰ if (k == null) &#123; e.value = null; tab[i] = null; size--; &#125; else &#123; //å¤„ç†rehashçš„æƒ…å†µ int h = k.threadLocalHashCode &amp; (len - 1); if (h != i) &#123; tab[i] = null; // Unlike Knuth 6.4 Algorithm R, we must scan until // null because multiple entries could have been stale. while (tab[h] != null) h = nextIndex(h, len); tab[h] = e; &#125; &#125; &#125; return i;&#125; è¯¥æ–¹æ³•é€»è¾‘è¯·çœ‹æ³¨é‡Šï¼ˆç¬¬1,2,3æ­¥ï¼‰ï¼Œä¸»è¦åšäº†è¿™ä¹ˆå‡ ä»¶äº‹æƒ…ï¼š æ¸…ç†å½“å‰è„entryï¼Œå³å°†å…¶valueå¼•ç”¨ç½®ä¸ºnullï¼Œå¹¶ä¸”å°†table[staleSlot]ä¹Ÿç½®ä¸ºnullã€‚valueç½®ä¸ºnullåè¯¥valueåŸŸå˜ä¸ºä¸å¯è¾¾ï¼Œåœ¨ä¸‹ä¸€æ¬¡gcçš„æ—¶å€™å°±ä¼šè¢«å›æ”¶æ‰ï¼ŒåŒæ—¶table[staleSlot]ä¸ºnullåä»¥ä¾¿äºå­˜æ”¾æ–°çš„entry; ä»å½“å‰staleSlotä½ç½®å‘åç¯å½¢ï¼ˆnextIndexï¼‰ç»§ç»­æœç´¢ï¼Œç›´åˆ°é‡åˆ°å“ˆå¸Œæ¡¶ï¼ˆtab[i]ï¼‰ä¸ºnullçš„æ—¶å€™é€€å‡ºï¼› è‹¥åœ¨æœç´¢è¿‡ç¨‹å†æ¬¡é‡åˆ°è„entryï¼Œç»§ç»­å°†å…¶æ¸…é™¤ã€‚ ä¹Ÿå°±æ˜¯è¯´è¯¥æ–¹æ³•ï¼Œæ¸…ç†æ‰å½“å‰è„entryåï¼Œå¹¶æ²¡æœ‰é—²ä¸‹æ¥ç»§ç»­å‘åæœç´¢ï¼Œè‹¥å†æ¬¡é‡åˆ°è„entryç»§ç»­å°†å…¶æ¸…ç†ï¼Œç›´åˆ°å“ˆå¸Œæ¡¶ï¼ˆtable[i]ï¼‰ä¸ºnullæ—¶é€€å‡ºã€‚å› æ­¤æ–¹æ³•æ‰§è¡Œå®Œçš„ç»“æœä¸º ä»å½“å‰è„entryï¼ˆstaleSlotï¼‰ä½åˆ°è¿”å›çš„iä½ï¼Œè¿™ä¸­é—´æ‰€æœ‰çš„entryä¸æ˜¯è„entryã€‚ä¸ºä»€ä¹ˆæ˜¯é‡åˆ°nullé€€å‡ºå‘¢ï¼ŸåŸå› æ˜¯å­˜åœ¨è„entryçš„å‰ææ¡ä»¶æ˜¯ å½“å‰å“ˆå¸Œæ¡¶ï¼ˆtable[i]ï¼‰ä¸ä¸ºnull,åªæ˜¯è¯¥entryçš„keyåŸŸä¸ºnullã€‚å¦‚æœé‡åˆ°å“ˆå¸Œæ¡¶ä¸ºnull,å¾ˆæ˜¾ç„¶å®ƒè¿æˆä¸ºè„entryçš„å‰ææ¡ä»¶éƒ½ä¸å…·å¤‡ã€‚ cleanSomeSlotæ–¹æ³•ä¸»è¦æœ‰è¿™æ ·å‡ ç‚¹ï¼š ä»å½“å‰ä½ç½®iå¤„ï¼ˆä½äºiå¤„çš„entryä¸€å®šä¸æ˜¯è„entryï¼‰ä¸ºèµ·ç‚¹åœ¨åˆå§‹å°èŒƒå›´ï¼ˆlog2(n)ï¼Œnä¸ºå“ˆå¸Œè¡¨å·²æ’å…¥entryçš„ä¸ªæ•°sizeï¼‰å¼€å§‹å‘åæœç´¢è„entryï¼Œè‹¥åœ¨æ•´ä¸ªæœç´¢è¿‡ç¨‹æ²¡æœ‰è„entryï¼Œæ–¹æ³•ç»“æŸé€€å‡º å¦‚æœåœ¨æœç´¢è¿‡ç¨‹ä¸­é‡åˆ°è„entryté€šè¿‡expungeStaleEntryæ–¹æ³•æ¸…ç†æ‰å½“å‰è„entryï¼Œå¹¶ä¸”è¯¥æ–¹æ³•ä¼šè¿”å›ä¸‹ä¸€ä¸ªå“ˆå¸Œæ¡¶(table[i])ä¸ºnullçš„ç´¢å¼•ä½ç½®ä¸ºiã€‚è¿™æ—¶é‡æ–°ä»¤æœç´¢èµ·ç‚¹ä¸ºç´¢å¼•ä½ç½®iï¼Œnä¸ºå“ˆå¸Œè¡¨çš„é•¿åº¦lenï¼Œå†æ¬¡æ‰©å¤§æœç´¢èŒƒå›´ä¸ºlog2(n)ç»§ç»­æœç´¢ã€‚ ä¸‹é¢ï¼Œä»¥ä¸€ä¸ªä¾‹å­æ›´æ¸…æ™°çš„æ¥è¯´ä¸€ä¸‹ï¼Œå‡è®¾å½“å‰tableæ•°ç»„çš„æƒ…å†µå¦‚ä¸‹å›¾ã€‚ å¦‚å›¾å½“å‰nç­‰äºhashè¡¨çš„sizeå³n=10ï¼Œi=1,åœ¨ç¬¬ä¸€è¶Ÿæœç´¢è¿‡ç¨‹ä¸­é€šè¿‡nextIndex,iæŒ‡å‘äº†ç´¢å¼•ä¸º2çš„ä½ç½®ï¼Œæ­¤æ—¶table[2]ä¸ºnullï¼Œè¯´æ˜ç¬¬ä¸€è¶Ÿæœªå‘ç°è„entry,åˆ™ç¬¬ä¸€è¶Ÿç»“æŸè¿›è¡Œç¬¬äºŒè¶Ÿçš„æœç´¢ã€‚ ç¬¬äºŒè¶Ÿæ‰€æœå…ˆé€šè¿‡nextIndexæ–¹æ³•ï¼Œç´¢å¼•ç”±2çš„ä½ç½®å˜æˆäº†i=3,å½“å‰table[3]!=nullä½†æ˜¯è¯¥entryçš„keyä¸ºnullï¼Œè¯´æ˜æ‰¾åˆ°äº†ä¸€ä¸ªè„entryï¼Œå…ˆå°†nç½®ä¸ºå“ˆå¸Œè¡¨çš„é•¿åº¦len,ç„¶åç»§ç»­è°ƒç”¨expungeStaleEntryæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå°†å½“å‰ç´¢å¼•ä¸º3çš„è„entryç»™æ¸…é™¤æ‰ï¼ˆä»¤valueä¸ºnullï¼Œå¹¶ä¸”table[3]ä¹Ÿä¸ºnullï¼‰,ä½†æ˜¯è¯¥æ–¹æ³•å¯ä¸æƒ³å·æ‡’ï¼Œå®ƒä¼šç»§ç»­å¾€åç¯å½¢æœç´¢ï¼Œå¾€åä¼šå‘ç°ç´¢å¼•ä¸º4,5çš„ä½ç½®çš„entryåŒæ ·ä¸ºè„entryï¼Œç´¢å¼•ä¸º6çš„ä½ç½®çš„entryä¸æ˜¯è„entryä¿æŒä¸å˜ï¼Œç›´è‡³i=7çš„æ—¶å€™æ­¤å¤„table[7]ä½nullï¼Œè¯¥æ–¹æ³•å°±ä»¥i=7è¿”å›ã€‚è‡³æ­¤ï¼Œç¬¬äºŒè¶Ÿæœç´¢ç»“æŸï¼› ç”±äºåœ¨ç¬¬äºŒè¶Ÿæœç´¢ä¸­å‘ç°è„entryï¼Œnå¢å¤§ä¸ºæ•°ç»„çš„é•¿åº¦lenï¼Œå› æ­¤æ‰©å¤§æœç´¢èŒƒå›´ï¼ˆå¢å¤§å¾ªç¯æ¬¡æ•°ï¼‰ç»§ç»­å‘åç¯å½¢æœç´¢ï¼› ç›´åˆ°åœ¨æ•´ä¸ªæœç´¢èŒƒå›´é‡Œéƒ½æœªå‘ç°è„entryï¼ŒcleanSomeSlotæ–¹æ³•æ‰§è¡Œç»“æŸé€€å‡ºã€‚ replaceStaleEntry()12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273/* * @param key the key * @param value the value to be associated with key * @param staleSlot index of the first stale entry encountered while * searching for key. */private void replaceStaleEntry(ThreadLocal&lt;?&gt; key, Object value, int staleSlot) &#123; Entry[] tab = table; int len = tab.length; Entry e; // Back up to check for prior stale entry in current run. // We clean out whole runs at a time to avoid continual // incremental rehashing due to garbage collector freeing // up refs in bunches (i.e., whenever the collector runs). //å‘å‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªè„entry int slotToExpunge = staleSlot; for (int i = prevIndex(staleSlot, len); (e = tab[i]) != null; i = prevIndex(i, len)) if (e.get() == null)1. slotToExpunge = i; // Find either the key or trailing null slot of run, whichever // occurs first for (int i = nextIndex(staleSlot, len); (e = tab[i]) != null; i = nextIndex(i, len)) &#123; ThreadLocal&lt;?&gt; k = e.get(); // If we find key, then we need to swap it // with the stale entry to maintain hash table order. // The newly stale slot, or any other stale slot // encountered above it, can then be sent to expungeStaleEntry // to remove or rehash all of the other entries in run. if (k == key) &#123; //å¦‚æœåœ¨å‘åç¯å½¢æŸ¥æ‰¾è¿‡ç¨‹ä¸­å‘ç°keyç›¸åŒçš„entryå°±è¦†ç›–å¹¶ä¸”å’Œè„entryè¿›è¡Œäº¤æ¢2. e.value = value;3. tab[i] = tab[staleSlot];4. tab[staleSlot] = e; // Start expunge at preceding stale entry if it exists //å¦‚æœåœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­è¿˜æœªå‘ç°è„entryï¼Œé‚£ä¹ˆå°±ä»¥å½“å‰ä½ç½®ä½œä¸ºcleanSomeSlots //çš„èµ·ç‚¹ if (slotToExpunge == staleSlot)5. slotToExpunge = i; //æœç´¢è„entryå¹¶è¿›è¡Œæ¸…ç†6. cleanSomeSlots(expungeStaleEntry(slotToExpunge), len); return; &#125; // If we didn't find stale entry on backward scan, the // first stale entry seen while scanning for key is the // first still present in the run. //å¦‚æœå‘å‰æœªæœç´¢åˆ°è„entryï¼Œåˆ™åœ¨æŸ¥æ‰¾è¿‡ç¨‹é‡åˆ°è„entryçš„è¯ï¼Œåé¢å°±ä»¥æ­¤æ—¶è¿™ä¸ªä½ç½® //ä½œä¸ºèµ·ç‚¹æ‰§è¡ŒcleanSomeSlots if (k == null &amp;&amp; slotToExpunge == staleSlot)7. slotToExpunge = i; &#125; // If key not found, put new entry in stale slot //å¦‚æœåœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­æ²¡æœ‰æ‰¾åˆ°å¯ä»¥è¦†ç›–çš„entryï¼Œåˆ™å°†æ–°çš„entryæ’å…¥åœ¨è„entry8. tab[staleSlot].value = null;9. tab[staleSlot] = new Entry(key, value); // If there are any other stale entries in run, expunge them10. if (slotToExpunge != staleSlot) //æ‰§è¡ŒcleanSomeSlots11. cleanSomeSlots(expungeStaleEntry(slotToExpunge), len);&#125; è¿™ä¸ªæœ‰ç‚¹å¤æ‚ï¼Œæš‚æ—¶å°±ä¸å»æŒæ¡äº†â€¦åªéœ€è¦çŸ¥é“è¿™ä¸ªå‡½æ•°ç”¨å½“å‰æ’å…¥çš„å€¼æ›¿æ¢æ‰è¿™ä¸ªkeyä¸ºnullçš„â€œè„â€entryï¼Œå¹¶ä¸”å¹¶ä¸å±€é™äºå¦‚æ­¤ï¼Œè¿˜æŠŠé™„è¿‘æ‰€æœ‰å¯èƒ½æ˜¯è„entryéƒ½æ¸…ç†äº†ï¼Œåº”è¯¥ç®—æ˜¯æ•´ä¸ª ThreadLocalä¸­æœ€ä¸ºå¤æ‚çš„å‡½æ•°äº†ã€‚ ThreadLocalMap ä¸ HashMap çš„éƒ¨åˆ†åŒºåˆ« è§£å†³å†²çªçš„æ–¹å¼ä¸ä¸€æ ·ã€‚ä¸€ä¸ªä½¿ç”¨çš„æ˜¯å¼€æ”¾åœ°å€æ³•ï¼Œä¸€ä¸ªæ˜¯é“¾åœ°å€æ³•ï¼› é»˜è®¤è£…è½½å› å­ä¸åŒã€‚ThreadLocalMap 2/3ï¼ŒHashMap 0.75ï¼› ThreadLocalMap æ²¡æœ‰æ‰°åŠ¨å‡½æ•°ï¼Œç›´æ¥å°±æ˜¯ç›¸ä¸(ä¹Ÿå°±æ˜¯å–æ¨¡çš„è¿‡ç¨‹)ï¼Œè€Œ HashMap æœ‰é«˜16ä½ä¸ä½16ä½ç›¸ä¸è¿›è¡Œæ‰°åŠ¨ï¼› æ‰©å®¹å’Œåˆå§‹å®¹é‡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåˆå§‹16ï¼Œç„¶åæ‰©å®¹éƒ½æ˜¯ä¸¤å€ã€‚ å¼±å¼•ç”¨ å››å¤§å¼•ç”¨çš„æ¦‚å¿µ Qï¼šå¼±å¼•ç”¨çš„æ¦‚å¿µ Aï¼šå››å¤§å¼•ç”¨ã€‚å¼ºå¼•ç”¨ã€å¼±å¼•ç”¨ã€è½¯å¼•ç”¨ã€å¹»æƒ³å¼•ç”¨ã€‚å¼±å¼•ç”¨é€šè¿‡WeakReferenceç±»å®ç°ã€‚ å¼±å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ¯”è½¯å¼•ç”¨çŸ­ã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†å…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚ç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œå› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å›æ”¶å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚å¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ Qï¼šè¿™é‡Œçš„keyå¯¹ThreadLocalä¸ºå¼±å¼•ç”¨çš„ä½œç”¨ï¼Œå¦‚æœä½¿ç”¨å¼ºå¼•ç”¨å‘¢ï¼Ÿ Aï¼šè¿™é‡Œçš„ key å¯¹ ThreadLocal é‡‡ç”¨å¼±å¼•ç”¨ï¼Œæ˜¯ä¸ºäº†å‡å°‘å†…å­˜æ³„æ¼çš„å‘ç”Ÿã€‚å½“ ThreadLocal å¼ºå¼•ç”¨å…¨éƒ¨æ¶ˆå¤±æ—¶ï¼ŒEntry ä¸­çš„ key ä¼šå˜ä¸º nullï¼Œä½†æ­¤æ—¶ value è¿˜æ˜¯è¢« map æŒæœ‰å¼ºå¼•ç”¨ï¼Œæ­¤æ—¶ entry å°±æ˜¯å¯èƒ½ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œä¸å¯ç”¨ä½†æ˜¯å¯è¾¾ï¼Œæ— æ³• gcï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒTHreadLocalMapä¸­å¯ä»¥è°ƒç”¨ set()ã€get()ã€remove()ç­‰æ–¹æ³•éƒ½ä¼šè§¦å‘ expungeStaleEntryæœºåˆ¶ï¼Œå°†è„ entryæ¸…é™¤æ‰é˜²æ­¢å†…å­˜æ³„æ¼ã€‚å¦‚æœåƒä»¥å‰ä½¿ç”¨äº†å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆå½“å¯¹è±¡ä½¿ç”¨å®Œ ThreadLocal å˜é‡ï¼ŒThreadLocalç”±äºä¸€ç›´è¢« key æŒæœ‰å¼ºå¼•ç”¨ï¼Œæ— æ³•å›æ”¶ï¼Œå¹¶ä¸”è¯¥ Entry ä¹Ÿè¿‡æœŸäº†ï¼Œå¯¼è‡´æ›´å¤§çš„å†…å­˜æ³„æ¼ï¼Œå¹¶ä¸”æ­¤æ—¶æ— æ³•é€šè¿‡ expungeStaleEntryæœºåˆ¶è§£å†³è¯¥é—®é¢˜ã€‚è‡³äºé€ æˆå†…å­˜æ³„æ¼çš„åŸå› ï¼Œæ ¹æœ¬åœ¨äº ThreadLocalMap å’Œ Thread æ‹¥æœ‰åŒæ ·é•¿çš„ç”Ÿå‘½å‘¨æœŸã€‚ é‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼ç”¨å®ŒThreadLocalæœ€åä¸€å®šè¦ remove()ã€remove()ã€remove()ã€‚ Qï¼šEntryã€value ä½¿ç”¨å¼±å¼•ç”¨ï¼Œæ˜¯ä»€ä¹ˆæ•ˆæœï¼Ÿ Aï¼šEntryå®šä¹‰ä¸ºå¼±å¼•ç”¨ï¼šå½“GCå›æ”¶åï¼Œæ— æ³•åŒºåˆ†æ˜¯åŸæœ¬å°±æ²¡æœ‰å†™å…¥è¿˜æ˜¯è¢«å›æ”¶äº†ï¼Œåç»­çº¿æ€§æ¢æµ‹çš„ä¿®è¡¥ä¹Ÿæ— æ³•å®Œæˆã€‚ valueå®šä¹‰ä¸ºå¼±å¼•ç”¨ï¼šä¼¼ä¹ä¹Ÿæ˜¯ä¸ªä¸é”™çš„æ–¹æ³•ï¼Œä¸ºå•¥æ²¡è¿™ä¹ˆåšï¼Ÿå› ä¸ºè¿™ä¹ˆåšå’Œå°†keyå®šä¹‰ä¸ºå¼±å¼•ç”¨åŸºæœ¬æ²¡åŒºåˆ«ï¼Œä»ç„¶å¯ä»¥ä¾èµ–å¼±å¼•ç”¨æœºåˆ¶æ¸…ç†ï¼Œä½†é€šå¸¸åœ¨æˆ‘ä»¬çš„ä½¿ç”¨ä¸­ä¸ä¼šæŒæœ‰valueçš„å¼ºå¼•ç”¨ï¼Œåªä¼šæŒæœ‰keyå³ThreadLocalå¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œè€Œvalueæ²¡æœ‰å¼ºå¼•ç”¨çš„æƒ…å†µä¸‹ä¼šè¢«GCå›æ”¶ï¼Œä¸æˆ‘ä»¬æœŸæœ›çš„åŠŸèƒ½ä¸ç¬¦ã€‚ å†…å­˜æ³„æ¼ ä¸»è¦å‚è€ƒç½‘å€ï¼šhttps://juejin.im/post/5d75ebf451882576c478a102 è¿™åº”è¯¥æ˜¯ ThreadLocal æœ€éš¾çš„éƒ¨åˆ†äº†ï¼Œç½‘ä¸ŠæŸ¥é˜…äº†å‡ ç™¾ç¯‡æ–‡ç« ï¼ŒåŸºæœ¬ä¸ŠæŠŠæ‰€æœ‰æœ‰å…³çš„ ThreadLocal å†…å­˜æ³„æ¼çš„æ–‡ç« éƒ½çœ‹äº†ä¸€éâ€¦åªæœ‰è¿™ä¸€ç¯‡æ¯”è¾ƒæ¬£èµï¼Œå‰©ä¸‹çš„åŸºæœ¬ä¸Šå…¨éƒ¨æ˜¯åœ¨äº’ç›¸æŠ„â€¦å¥½å¤šåœ°æ–¹è§£é‡Šçš„ä¹Ÿä¸é€šâ€¦æ¥ä¸‹æ¥å¸Œæœ›è‡ªå·±èƒ½æŠŠè¿™ä¸ªè®²é€šå§â€¦ ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼å¯¹è±¡å·²ç»æ²¡æœ‰è¢«åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œä½†æ˜¯åƒåœ¾å›æ”¶å™¨æ²¡åŠæ³•ç§»é™¤å®ƒä»¬ï¼Œå› ä¸ºè¿˜åœ¨è¢«å¼•ç”¨ç€ã€‚ åœ¨Javaä¸­ï¼Œå†…å­˜æ³„æ¼å°±æ˜¯å­˜åœ¨ä¸€äº›è¢«åˆ†é…çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡æœ‰ä¸‹é¢ä¸¤ä¸ªç‰¹ç‚¹ï¼Œé¦–å…ˆï¼Œè¿™äº›å¯¹è±¡æ˜¯å¯è¾¾çš„ï¼Œå³åœ¨æœ‰å‘å›¾ä¸­ï¼Œå­˜åœ¨é€šè·¯å¯ä»¥ä¸å…¶ç›¸è¿ï¼›å…¶æ¬¡ï¼Œè¿™äº›å¯¹è±¡æ˜¯æ— ç”¨çš„ï¼Œå³ç¨‹åºä»¥åä¸ä¼šå†ä½¿ç”¨è¿™äº›å¯¹è±¡ã€‚å¦‚æœå¯¹è±¡æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œè¿™äº›å¯¹è±¡å°±å¯ä»¥åˆ¤å®šä¸ºJavaä¸­çš„å†…å­˜æ³„æ¼ï¼Œè¿™äº›å¯¹è±¡ä¸ä¼šè¢«GCæ‰€å›æ”¶ï¼Œç„¶è€Œå®ƒå´å ç”¨å†…å­˜ã€‚ ThreadLocal ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼æˆ‘ä¸ªäººå€¾å‘äºå°†å…¶åˆ†ä¸ºä¸¤ç±»ï¼š å½“ ThreadLocal å˜é‡ä¸ä½¿ç”¨ static ä¿®é¥°å½“ ThreadLocal å˜é‡ä¸ä½¿ç”¨ static ä¿®é¥°ï¼Œé‚£ä¹ˆ ThreadLocal çš„å¼ºå¼•ç”¨å°±å¾ˆæœ‰å¯èƒ½å…¨éƒ¨æ¶ˆå¤±ã€Œä»€ä¹ˆæ—¶å€™ä¼šæ¶ˆå¤±ï¼Ÿï¼Ÿ è¿™ä¸ªç¿»äº†æ•´ä¸ªäº’è”ç½‘éƒ½æ²¡è§åˆ°â€¦ã€ï¼Œè€Œ ThreadLocalMap ä¸­çš„ key å¯¹ ThreadLocal çš„å¼•ç”¨æ˜¯å¼±å¼•ç”¨ï¼Œæ ¹æ® GC è§„åˆ™ï¼ŒThreadLocal å˜é‡ä¼šè¢«å›æ”¶ï¼Œæ­¤æ—¶ ThreadLocaMap å¯¹åº”çš„ key ä¼šè‡ªåŠ¨å˜ä¸º nullï¼Œè€Œ æ­¤æ—¶çš„ Entry å’Œ value åˆè¢« ThreadLocalMap å¼ºå¼•ç”¨ï¼Œå³ä¸å¯èƒ½ä¼šè¢«GCï¼Œæ‰€ä»¥æ­¤æ—¶å°±é€ æˆäº†å†…å­˜æ³„æ¼ï¼Œè§£å†³çš„æ–¹æ³•å°±æ˜¯æ˜¾ç¤ºçš„è°ƒç”¨ set()ã€get()ã€remove()ã€Œå½“ç„¶è°ƒç”¨ set()ã€get() ä¹Ÿä¸ä¸€å®šèƒ½è§£å†³å†…å­˜æ³„æ¼é—®é¢˜ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ–¹æ³•å¯èƒ½åœ¨æ²¡ç¢°åˆ°è„ entryå°±ç»“æŸå¾ªç¯äº†ã€ç­‰æ–¹æ³•ï¼Œå› ä¸ºå…¶å¯ä»¥è°ƒç”¨ expungeStaleEntry() å°†è¿™äº› key ä¸º null çš„é”®å€¼å¯¹å›æ”¶ã€‚å½“ç„¶äº†ï¼Œå¦‚æœçº¿ç¨‹ä¼šç»“æŸï¼Œé‚£æœ€ç»ˆä¹Ÿä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼å•¦ï¼Œçº¿ç¨‹æ­»äº†é‚£è‚¯å®šå°±è‡ªåŠ¨æ¸…ç† map äº†ã€‚ Qï¼šå›åˆ°ä¸Šé¢é‚£ä¸ªé—®é¢˜ï¼Œä»€ä¹ˆæ—¶å€™å¼ºå¼•ç”¨ä¼šæ¶ˆå¤±ï¼Ÿ Aï¼šæˆ‘å‚è€ƒçš„ç½‘å€ç»ˆäºæœ‰äº†ä¸€ä¸ªä¾‹å­ã€‚å¼ºå¼•ç”¨æ˜¯å¯¹åº”çš„å­çº¿ç¨‹æˆ–ä¸»çº¿ç¨‹ä¸­æŸä¸ªå¯¹è±¡æŒæœ‰çš„ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸæˆ–å¯¹è±¡æ›¿æ¢æŒ‡å‘è¿™ä¸ªkeyçš„å¼•ç”¨åï¼Œkeyçš„å¼ºå¼•ç”¨ä¹Ÿå°±æ–­äº†ã€‚å¯¹ï¼Œå°±æ˜¯å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œå¼ºå¼•ç”¨å°±æ¶ˆå¤±äº†ã€‚ egï¼šå‡å¦‚æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œç„¶åæˆ‘è°ƒç”¨äº† Aï¼Œåˆ›å»ºäº† A çš„å®ä¾‹å¯¹è±¡ a1ï¼Œa1 è°ƒç”¨äº† ThreadLocal å˜é‡ï¼Œæ­¤æ—¶å¯¹è±¡ a1 æ˜¯æœ‰å¯¹ ThreadLocal çš„å¼ºå¼•ç”¨çš„ï¼Œæ­¤æ—¶ ThreadLocalMap ä¸­çš„ keyè¿˜ä¸ä¼šä¸º null ï¼Œå½“ä¸»çº¿ç¨‹è°ƒç”¨äº† a = nullï¼Œè¯¥å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œæ­¤æ—¶å¼ºå¼•ç”¨æ¶ˆå¤±äº†ï¼Œä½†æ˜¯ ThreadLocalMap ä¸­çš„ value è¿˜æ˜¯å¼ºå¼•ç”¨ï¼Œæ— æ³• GCï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„æƒ…å†µã€‚ 12345678910111213141516public class A &#123; private ThreadLocal&lt;Context&gt; local = new ThreadLocal&lt;&gt;(); public void doSth() &#123; // Context ctx = ... local.set(ctx); &#125;&#125;public static void main(String[] args)&#123; A a = new A(); a.doSth(); a = null; // æˆ–è€…ç›´æ¥ finalize(); // ... doSometing();&#125; å½“ ThreadLocal å˜é‡ä½¿ç”¨äº† static ä¿®é¥°å½“ ThreadLocal å˜é‡ä½¿ç”¨äº† static ä¿®é¥°ï¼Œè¯´æ˜è¯¥å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå’Œç±»ä¸€æ ·çš„ï¼Œåªè¦å¼•ç”¨ä¸æ”¹å˜ï¼Œé‚£ä¹ˆè¯¥å˜é‡ä¼šä¸€ç›´æŒæœ‰å¼ºå¼•ç”¨ï¼ˆå¼ºå¼•ç”¨ä¸Šé¢å·²ç»è®²äº†ï¼‰ï¼Œé‚£ä¹ˆæ­¤æ—¶ key å¯¹ ThreadLocal æŒæœ‰å¼±å¼•ç”¨æˆ‘ä¸ªäººè§‰å¾—å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ï¼Œå› ä¸ºæ˜¯ä¸å¯èƒ½è§¦å‘ expungeStaleEntry() çš„ï¼Œå› ä¸º key ä¸ä¼šå˜ä¸º nullã€‚é‚£ä¹ˆæ­¤æ—¶æ˜¯ä¸æ˜¯å°±ä¸ä¼šå‡ºç°å†…å­˜æ³„æ¼äº†å‘¢ï¼Ÿä¸ï¼Œä¾æ—§ä¼šå‡ºç°ã€‚å…¶å®æ­¤æ—¶å¦‚æœæˆ‘ä»¬æ­£å¸¸ä½¿ç”¨ï¼Œæ˜¯ä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼çš„ï¼Œä½†æ˜¯ä¸€æ—¦æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯çº¿ç¨‹æ± ï¼Œçº¿ç¨‹ä½¿ç”¨å®Œä¹‹åä¸ä¼šå›æ”¶ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„ ThreadLocalMap åˆå­˜åœ¨å¾ˆå¤šè¿‡æœŸçš„ value éœ€è¦æ¸…ç†ï¼Œæ­¤æ—¶å°±ç®— key æ˜¯å¼±å¼•ç”¨ï¼Œä¹Ÿæ²¡æœ‰åŠæ³•ï¼Œå› ä¸º ThreadLocal ä¸€ç›´æŒæœ‰å¼ºå¼•ç”¨æ ¹æœ¬ä¸ä¼šè§¦å‘ GCï¼Œæ­¤æ—¶å°±äº§ç”Ÿäº†å†…å­˜æ³„æ¼ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š çº¿ç¨‹1å’Œçº¿ç¨‹2éƒ½ç”¨äº†threadLocal1å’ŒthreadLocal2ï¼Œä¸”è®¾ç½®äº†value çº¿ç¨‹1ä½¿ç”¨å®Œæ¯•å½’è¿˜çº¿ç¨‹æ± ï¼Œä½†æ²¡æœ‰è°ƒç”¨threadLocal1.remove() ä¹‹åçº¿ç¨‹1ä¸å†ä½¿ç”¨threadLocal1äº†ï¼Œä»…ä½¿ç”¨threadLocal2 çº¿ç¨‹1çš„threadLocalMapä¸­ä»ç„¶ä¿å­˜äº†obj1 ç”±äºé™æ€å˜é‡threadLocal1å¼•ç”¨ä»ç„¶å¯è¾¾ï¼Œä¸ä¼šè¢«å›æ”¶ï¼Œçº¿ç¨‹1æ— æ³•è§¦å‘expungeStaleEntryæœºåˆ¶ï¼ŒthreadLocal1å¯¹åº”çš„entryå’Œvalueæ— æ³•å›æ”¶ï¼Œé€ æˆäº†å†…å­˜æ³„æ¼ æ‰€ä»¥ç”¨private staticä¿®é¥°ä¹‹åï¼Œå¥½å¤„å°±æ˜¯ä»…ä½¿ç”¨æœ‰é™çš„ThreadLocalå¯¹è±¡ä»¥èŠ‚çº¦åˆ›å»ºå¯¹è±¡å’Œåç»­è‡ªåŠ¨å›æ”¶çš„å¼€é”€ï¼Œåå¤„æ˜¯éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨removeæ–¹æ³•æ¸…ç†ä½¿ç”¨å®Œçš„slotï¼Œå¦åˆ™ä¼šæœ‰å†…å­˜æ³„æ¼é—®é¢˜ã€‚ é—®é¢˜ https://juejin.im/post/5a0e985df265da430e4ebb92#heading-2 https://zhuanlan.zhihu.com/p/91756169 Q1ï¼šThreadLocal è·Ÿæ™®é€šå±€éƒ¨å˜é‡æœ‰ä½•åŒºåˆ«ï¼Œåœ¨å…¶å†…éƒ¨ä½¿ç”¨å±€éƒ¨å˜é‡ä¸æ˜¯ä¸€æ ·çš„å—ï¼Ÿ A1ï¼šç½‘ä¸Šæœ‰ä¸¤ç§è¯´æ³•ã€‚ è¯¥å®ä¾‹éœ€è¦åœ¨å¤šä¸ªæ–¹æ³•ä¸­å…±äº«ï¼Œä½†ä¸å¸Œæœ›è¢«å¤šçº¿ç¨‹å…±äº«ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ ThreadLocalï¼Œè¿™æ ·ä½¿å¾—ä»£ç è€¦åˆåº¦æ›´ä½ï¼Œæ— éœ€åœ¨æ¯ä¸ªæ–¹æ³•ä¸­éƒ½å»å£°æ˜ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯åšåˆ°çº¿ç¨‹é—´éš”ç¦»ï¼Œçº¿ç¨‹å†…å…±äº«ã€‚æˆ‘ä¸ªäººè§‰å¾—è¿™ç§è¯´æ³•æœ‰äº›è¿‡äºç‰µå¼ºï¼Œä½†æ˜¯è²Œä¼¼ç½‘ä¸ŠåŸºæœ¬éƒ½æ˜¯è¿™ç§è¯´æ³•â€¦ æˆ‘è§‰å¾— ThreadLocal ç›¸æ¯”å±€éƒ¨å˜é‡è€Œè¨€ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ å…¨å±€å˜é‡ å’Œ å±€éƒ¨å˜é‡ çš„åŒºåˆ«ã€‚è™½ç„¶æ¯ä¸ªçº¿ç¨‹çš„ ThreadLocal å‰¯æœ¬äº’ä¸å½±å“ï¼Œä½†æ˜¯æˆ‘å¯ä»¥é€šè¿‡ ThreadLocal è¿›è¡Œé€šä¿¡ï¼Œè¿™æ˜¯å±€éƒ¨å˜é‡æ‰€ä¸å…·å¤‡çš„èƒ½åŠ›ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾è¦è®¾è®¡è¿™ä¹ˆä¸€ä¸ªç¨‹åºï¼šä¸‰ä¸ªçº¿ç¨‹åŒæ—¶ä»0æ•°åˆ°10ï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªçº¿ç¨‹æ•°åˆ°äº†10ï¼Œä¸‰ä¸ªçº¿ç¨‹éƒ½ä»0é‡æ–°å¼€å§‹æ•°ï¼Œä¸€ç›´è¿™ä¹ˆå¾ªç¯ã€‚ç”¨runåˆ›å»ºå±€éƒ¨å˜é‡çš„æ–¹å¼å°±æ²¡æ³•åšï¼Œå› ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹ä¹‹é—´æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚ ThreadLocalä¿å­˜å…±äº«å˜é‡çš„å‰¯æœ¬ï¼Œç”¨äºç‰¹å®šçš„ä½¿ç”¨åœºæ™¯ã€‚çœ‹æºç å°±çŸ¥é“ThreadLocalç±»æ˜¯åŸºäºThreadç±»æ¥å®ç°çš„ï¼Œå¦‚æœç›´æ¥ç”¨ç»§æ‰¿Threadæ¥å®ç°ä¸Šé¢çš„åŠŸèƒ½ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªä¸è¿‡JDKéƒ½å·²ç»ç»™å°è£…å¥½äº†ï¼Œè‡ªå·±èƒ½æƒ³åˆ°çš„æ€è·¯ä¼°è®¡è·ŸThreadLocalçš„å®ç°æ€è·¯å·®ä¸å¤šã€‚å¦‚æœåœºæ™¯é€‚åˆä½¿ç”¨ThreadLocalï¼Œä¸ºä½•ä¸ç›´æ¥ç”¨å‘¢ã€‚ æ‰€ä»¥ï¼Œçº¿ç¨‹é—´å¯é€šä¿¡ä¸”å¯ä»¥åšåˆ°äº’ä¸å½±å“ï¼Œæˆ‘è§‰å¾—è¿™æ‰æ˜¯ ThreadLocal çœŸæ­£å­˜åœ¨çš„æ„ä¹‰å§ã€‚ Q2ï¼šæ—¢ç„¶ ThreadMap ä»å±äºæ¯ä¸ªçº¿ç¨‹ï¼Œé‚£ä¸ºä½•ä¸æŠŠ ThreadLocalMap æ”¾åˆ° Thread ç±»ä¸­ï¼Œåè€Œæ˜¯æˆä¸ºäº† ThreadLocal çš„å†…éƒ¨ç±»ï¼Ÿ A2ï¼šå…¶å®æˆ‘è§‰å¾—éƒ½æ˜¯å¯ä»¥çš„ï¼Œä¸ç®¡æ”¾åˆ° Thread ç±»ä¸­ï¼Œè¿˜æ˜¯æ”¾åˆ° ThreadLocal ä¸­ï¼Œéƒ½æ˜¯å¯ä»¥è§£å†³é—®é¢˜çš„ï¼Œä½†æ˜¯æˆ‘è§‰å¾—ä½œè€…è¿™æ ·è®¾è®¡ï¼Œä¸»è¦æ˜¯å› ä¸ºåœ¨ä¹‹å‰ ThreadLocalMap æ˜¯ä»å±äº ThreadLocal çš„ï¼Œå¯èƒ½åæ¥è€ƒè™‘åˆ°æˆ‘ä¸Šæ–‡æåˆ°çš„éœ€è¦åŠ é”è¿˜æœ‰çº¿ç¨‹ç»“æŸå¸¦æ¥çš„ ThreadLocal çš„å†…å­˜æ³„æ¼é—®é¢˜ï¼Œæ”¹æˆäº† ThreadLocalMap ä»å±äº Threadï¼Œä¸ºäº†æœ€å¤§é™åº¦çš„ä¸æ”¹åŠ¨ä»£ç ï¼Œåªåœ¨ Thread ä¸­æ·»åŠ äº†ä¸€ä¸ªæˆå‘˜å˜é‡ ThreadLocal.ThreadLocalMap threadLocalsï¼Œå¹¶ä¸”è¿™æ ·è®¾è®¡çš„è¯ï¼Œç”¨æˆ·å±‚é¢å»è°ƒç”¨ api çš„æ—¶å€™æ ¹æœ¬ä¸ä¼šå‘ç° ThreadLocalMap çš„å­˜åœ¨ï¼Œè®¾è®¡çš„è¿˜æ˜¯éå¸¸ä¼˜ç¾çš„ï¼ Q3ï¼šä¸ºä½•å®˜æ–¹å»ºè®®å®šä¹‰ ThreadLocal æ—¶ é‡‡ç”¨ private static ä¿®é¥°ï¼Ÿ A3ï¼šå¯ä»¥é¿å…é‡å¤åˆ›å»ºTSO(Thread Specific Objectï¼Œå³ä¸çº¿ç¨‹ç›¸å…³çš„å˜é‡)ï¼Œå¦‚æœæŠŠ ThreadLocal å£°æ˜ä¸ºæŸä¸ªç±»çš„å®ä¾‹å˜é‡ï¼ˆè€Œä¸æ˜¯é™æ€å˜é‡ï¼‰ï¼Œé‚£ä¹ˆæ¯åˆ›å»ºä¸€ä¸ªè¯¥ç±»çš„å®ä¾‹å°±ä¼šå¯¼è‡´ä¸€ä¸ªæ–°çš„TSOå®ä¾‹è¢«åˆ›å»ºã€‚æ˜¾ç„¶ï¼Œè¿™äº›è¢«åˆ›å»ºçš„TSOå®ä¾‹æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ã€‚æ—¢ç„¶æ‰€æœ‰çš„çº¿ç¨‹ç”¨åˆ°çš„ ThreadLocal éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾è®¾è®¡æˆ static æ˜¯å¾ˆæ­£å¸¸çš„ï¼Œä¸ä»¥å¯¹è±¡ä¸ºå‡ºå‘ç‚¹ï¼Œè€Œä»¥æ•´ä¸ªç±»ä¸ºå‡ºå‘ç‚¹å°±å¥½äº†ã€‚ æ‰€ä»¥ç”¨private staticä¿®é¥°ä¹‹åï¼Œå¥½å¤„å°±æ˜¯ä»…ä½¿ç”¨æœ‰é™çš„ThreadLocalå¯¹è±¡ä»¥èŠ‚çº¦åˆ›å»ºå¯¹è±¡å’Œåç»­è‡ªåŠ¨å›æ”¶çš„å¼€é”€ï¼Œåå¤„æ˜¯éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨removeæ–¹æ³•æ¸…ç†ä½¿ç”¨å®Œçš„slotï¼Œå¦åˆ™ä¼šæœ‰å†…å­˜æ³„æ¼é—®é¢˜ã€‚ Q4ï¼šThreadLocal çš„ç”¨é€”ï¼Ÿ A4ï¼š çº¿ç¨‹é—´éš”ç¦»ï¼Œçº¿ç¨‹å†…é€šä¿¡ï¼Œè§£å†³ç›¸åŒå˜é‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å†²çªé—®é¢˜ï¼Œä¾‹å¦‚ï¼š hibernateä¸­çš„sessionä½¿ç”¨ï¼› springä¸­å•ä¾‹beançš„å¤šçº¿ç¨‹è®¿é—®ã€‚æˆ‘ä»¬çŸ¥é“åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªæœ‰æ— çŠ¶æ€çš„Beanæ‰å¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å…±äº«ï¼Œåœ¨Springä¸­ï¼Œç»å¤§éƒ¨åˆ†Beanéƒ½å¯ä»¥å£°æ˜ä¸ºsingletonä½œç”¨åŸŸã€‚å°±æ˜¯å› ä¸ºSpringå¯¹ä¸€äº›Beanï¼ˆå¦‚RequestContextHolderã€TransactionSynchronizationManagerã€LocaleContextHolderç­‰ï¼‰ä¸­éçº¿ç¨‹å®‰å…¨çŠ¶æ€é‡‡ç”¨ThreadLocalè¿›è¡Œå¤„ç†ï¼Œè®©å®ƒä»¬ä¹Ÿæˆä¸ºçº¿ç¨‹å®‰å…¨çš„çŠ¶æ€ï¼Œæœ‰çŠ¶æ€çš„Beanå°±å¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸­å…±äº«äº†ï¼› ä»¥åŠ spring å¦‚ä½•ä¿è¯æ•°æ®åº“äº‹åŠ¡åœ¨åŒä¸€ä¸ªè¿æ¥ä¸‹æ‰§è¡Œçš„ã€‚DataSourceTransactionManager æ˜¯springçš„æ•°æ®æºäº‹åŠ¡ç®¡ç†å™¨ï¼Œ å®ƒä¼šåœ¨ä½ è°ƒç”¨getConnection()çš„æ—¶å€™ä»æ•°æ®åº“è¿æ¥æ± ä¸­è·å–ä¸€ä¸ªconnectionï¼Œ ç„¶åå°†å…¶ä¸ThreadLocalç»‘å®šï¼Œ äº‹åŠ¡å®Œæˆåè§£é™¤ç»‘å®šã€‚è¿™æ ·å°±ä¿è¯äº†äº‹åŠ¡åœ¨åŒä¸€è¿æ¥ä¸‹å®Œæˆã€‚ å¯ä»¥ç”¨äºçº¿ç¨‹é—´é€šä¿¡ï¼Œæ¯”å¦‚ä¸‰ä¸ªçº¿ç¨‹éƒ½ç”¨åˆ°äº† ThreadLocalï¼Œåªè¦æœ‰ä¸€ä¸ªè¾¾åˆ°äº†ç›®æ ‡å€¼ï¼Œæˆ‘å°±å…¨éƒ¨è®¾ä¸ºåˆå€¼ï¼Œè¿™æ˜¯å¯ä»¥é€šè¿‡ ThreadLocalç›´æ¥å®Œæˆçš„ã€‚ Q5ï¼šThreadLocal å’Œ Synchronized åŒºåˆ«ï¼Ÿ A5ï¼šThreadLocalå’Œsynchronizedå…³é”®å­—éƒ½ç”¨äºå¤„ç†å¤šçº¿ç¨‹å¹¶å‘è®¿é—®å˜é‡çš„é—®é¢˜ï¼Œåªæ˜¯äºŒè€…å¤„ç†é—®é¢˜çš„è§’åº¦å’Œæ€è·¯ä¸åŒã€‚ ThreadLocalæ˜¯ä¸€ä¸ªJavaç±»,é€šè¿‡å¯¹å½“å‰çº¿ç¨‹ä¸­çš„å±€éƒ¨å˜é‡çš„æ“ä½œæ¥è§£å†³ä¸åŒçº¿ç¨‹çš„å˜é‡è®¿é—®çš„å†²çªé—®é¢˜ã€‚æ‰€ä»¥ï¼ŒThreadLocalæä¾›äº†çº¿ç¨‹å®‰å…¨çš„å…±äº«å¯¹è±¡æœºåˆ¶ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰å…¶å‰¯æœ¬ã€‚ Javaä¸­çš„synchronizedæ˜¯ä¸€ä¸ªä¿ç•™å­—ï¼Œå®ƒä¾é JVMçš„é”æœºåˆ¶æ¥å®ç°ä¸´ç•ŒåŒºçš„å‡½æ•°æˆ–è€…å˜é‡çš„è®¿é—®ä¸­çš„åŸå­æ€§ã€‚åœ¨åŒæ­¥æœºåˆ¶ä¸­ï¼Œé€šè¿‡å¯¹è±¡çš„é”æœºåˆ¶ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å˜é‡ã€‚æ­¤æ—¶ï¼Œè¢«ç”¨ä½œâ€œé”æœºåˆ¶â€çš„å˜é‡æ—¶å¤šä¸ªçº¿ç¨‹å…±äº«çš„ã€‚ åŒæ­¥æœºåˆ¶(synchronizedå…³é”®å­—)é‡‡ç”¨äº†ä»¥â€œæ—¶é—´æ¢ç©ºé—´â€çš„æ–¹å¼ï¼Œæä¾›ä¸€ä»½å˜é‡ï¼Œè®©ä¸åŒçš„çº¿ç¨‹æ’é˜Ÿè®¿é—®ã€‚è€ŒThreadLocalé‡‡ç”¨äº†â€œä»¥ç©ºé—´æ¢æ—¶é—´â€çš„æ–¹å¼ï¼Œä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æä¾›ä¸€ä»½å˜é‡çš„å‰¯æœ¬ï¼Œä»è€Œå®ç°åŒæ—¶è®¿é—®è€Œäº’ä¸å½±å“ã€‚]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>ThreadLocal</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼]]></title>
    <url>%2F2020%2F02%2F25%2F%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html</url>
    <content type="text"><![CDATA[åˆ›å»ºå‹æ¨¡å¼ï¼Œå…±äº”ç§ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€åŸå‹æ¨¡å¼ã€‚ ç»“æ„å‹æ¨¡å¼ï¼Œå…±ä¸ƒç§ï¼šé€‚é…å™¨æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼ã€‚ è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…±åä¸€ç§ï¼šç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å­æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ã€‚ æ•´æŒºå¥½ï¼šhttps://blog.csdn.net/carson_ho/article/details/54910518 å•ä¾‹æ¨¡å¼ç®€ä»‹ä»‹ç»å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰ï¼Œä¹Ÿå«å•å­æ¨¡å¼ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ã€‚åœ¨åº”ç”¨è¿™ä¸ªæ¨¡å¼æ—¶ï¼Œå•ä¾‹å¯¹è±¡çš„ç±»å¿…é¡»ä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ã€‚è®¸å¤šæ—¶å€™æ•´ä¸ªç³»ç»Ÿåªéœ€è¦æ‹¥æœ‰ä¸€ä¸ªçš„å…¨å±€å¯¹è±¡ï¼Œè¿™æ ·æœ‰åˆ©äºæˆ‘ä»¬åè°ƒç³»ç»Ÿæ•´ä½“çš„è¡Œä¸ºã€‚æ¯”å¦‚åœ¨æŸä¸ªæœåŠ¡å™¨ç¨‹åºä¸­ï¼Œè¯¥æœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™äº›é…ç½®æ•°æ®ç”±ä¸€ä¸ªå•ä¾‹å¯¹è±¡ç»Ÿä¸€è¯»å–ï¼Œç„¶åæœåŠ¡è¿›ç¨‹ä¸­çš„å…¶ä»–å¯¹è±¡å†é€šè¿‡è¿™ä¸ªå•ä¾‹å¯¹è±¡è·å–è¿™äº›é…ç½®ä¿¡æ¯ã€‚è¿™ç§æ–¹å¼ç®€åŒ–äº†åœ¨å¤æ‚ç¯å¢ƒä¸‹çš„é…ç½®ç®¡ç†ã€‚ å®ç°æ€è·¯ä¸€ä¸ªç±»èƒ½è¿”å›å¯¹è±¡ä¸€ä¸ªå¼•ç”¨(æ°¸è¿œæ˜¯åŒä¸€ä¸ª)å’Œä¸€ä¸ªè·å¾—è¯¥å®ä¾‹çš„æ–¹æ³•ï¼ˆå¿…é¡»æ˜¯é™æ€æ–¹æ³•ï¼Œé€šå¸¸ä½¿ç”¨getInstanceè¿™ä¸ªå ç§°ï¼‰ï¼›å½“æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå¦‚æœç±»æŒæœ‰çš„å¼•ç”¨ä¸ä¸ºç©ºå°±è¿”å›è¿™ä¸ªå¼•ç”¨ï¼Œå¦‚æœç±»ä¿æŒçš„å¼•ç”¨ä¸ºç©ºå°±åˆ›å»ºè¯¥ç±»çš„å®ä¾‹å¹¶å°†å®ä¾‹çš„å¼•ç”¨èµ‹äºˆè¯¥ç±»ä¿æŒçš„å¼•ç”¨ï¼›åŒæ—¶æˆ‘ä»¬ è¿˜å°†è¯¥ç±»çš„æ„é€ å‡½æ•°å®šä¹‰ä¸ºç§æœ‰æ–¹æ³•ï¼Œè¿™æ ·å…¶ä»–å¤„çš„ä»£ç å°±æ— æ³•é€šè¿‡è°ƒç”¨è¯¥ç±»çš„æ„é€ å‡½æ•°æ¥å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ï¼Œåªæœ‰é€šè¿‡è¯¥ç±»æä¾›çš„é™æ€æ–¹æ³•æ¥å¾—åˆ°è¯¥ç±»çš„å”¯ä¸€å®ä¾‹ã€‚ æ³¨æ„ç‚¹å•ä¾‹æ¨¡å¼åœ¨å¤šçº¿ç¨‹çš„åº”ç”¨åœºåˆä¸‹å¿…é¡»å°å¿ƒä½¿ç”¨ã€‚å¦‚æœå½“å”¯ä¸€å®ä¾‹å°šæœªåˆ›å»ºæ—¶ï¼Œæœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨åˆ›å»ºæ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä»¬åŒæ—¶æ²¡æœ‰æ£€æµ‹åˆ°å”¯ä¸€å®ä¾‹çš„å­˜åœ¨ï¼Œä»è€ŒåŒæ—¶å„è‡ªåˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹ï¼Œ è¿™æ ·å°±æœ‰ä¸¤ä¸ªå®ä¾‹è¢«æ„é€ å‡ºæ¥ï¼Œä»è€Œè¿åäº†å•ä¾‹æ¨¡å¼ä¸­å®ä¾‹å”¯ä¸€çš„åŸåˆ™ã€‚ è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•æ˜¯ä¸ºæŒ‡ç¤ºç±»æ˜¯å¦å·²ç»å®ä¾‹åŒ–çš„å˜é‡æä¾›ä¸€ä¸ªäº’æ–¥é”(è™½ç„¶è¿™æ ·ä¼šé™ä½æ•ˆç‡)ã€‚ ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š åœ¨å•ä¾‹æ¨¡å¼ä¸­ï¼Œæ´»åŠ¨çš„å•ä¾‹åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¯¹å•ä¾‹ç±»çš„æ‰€æœ‰å®ä¾‹åŒ–å¾—åˆ°çš„éƒ½æ˜¯ç›¸åŒçš„ä¸€ä¸ªå®ä¾‹ã€‚è¿™æ ·å°±é˜²æ­¢å…¶å®ƒå¯¹è±¡å¯¹è‡ªå·±çš„å®ä¾‹åŒ–ï¼Œç¡®ä¿æ‰€æœ‰çš„å¯¹è±¡éƒ½è®¿é—®ä¸€ä¸ªå®ä¾‹ã€‚ å•ä¾‹æ¨¡å¼å…·æœ‰ä¸€å®šçš„ä¼¸ç¼©æ€§ï¼Œç±»è‡ªå·±æ¥æ§åˆ¶å®ä¾‹åŒ–è¿›ç¨‹ï¼Œç±»å°±åœ¨æ”¹å˜å®ä¾‹åŒ–è¿›ç¨‹ä¸Šæœ‰ç›¸åº”çš„ä¼¸ç¼©æ€§ã€‚ æä¾›äº†å¯¹å”¯ä¸€å®ä¾‹çš„å—æ§è®¿é—®ã€‚ ç”±äºåœ¨ç³»ç»Ÿå†…å­˜ä¸­åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤å¯ä»¥ èŠ‚çº¦ç³»ç»Ÿèµ„æºï¼Œå½“ éœ€è¦é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çš„å¯¹è±¡æ—¶å•ä¾‹æ¨¡å¼æ— ç–‘å¯ä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚ å…è®¸å¯å˜æ•°ç›®çš„å®ä¾‹ã€‚ é¿å…å¯¹å…±äº«èµ„æºçš„å¤šé‡å ç”¨ã€‚ ç¼ºç‚¹ï¼š ä¸é€‚ç”¨äºå˜åŒ–çš„å¯¹è±¡ï¼Œå¦‚æœåŒä¸€ç±»å‹çš„å¯¹è±¡æ€»æ˜¯è¦åœ¨ä¸åŒçš„ç”¨ä¾‹åœºæ™¯å‘ç”Ÿå˜åŒ–ï¼Œå•ä¾‹å°±ä¼šå¼•èµ·æ•°æ®çš„é”™è¯¯ï¼Œä¸èƒ½ä¿å­˜å½¼æ­¤çš„çŠ¶æ€ã€‚ ç”±äºå•ä¾‹æ¨¡å¼ä¸­æ²¡æœ‰æŠ½è±¡å±‚ï¼Œå› æ­¤å•ä¾‹ç±»çš„æ‰©å±•æœ‰å¾ˆå¤§çš„å›°éš¾ã€‚ å•ä¾‹ç±»çš„èŒè´£è¿‡é‡ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šè¿èƒŒäº†â€œå•ä¸€èŒè´£åŸåˆ™â€ã€‚ æ»¥ç”¨å•ä¾‹å°†å¸¦æ¥ä¸€äº›è´Ÿé¢é—®é¢˜ï¼Œå¦‚ä¸ºäº†èŠ‚çœèµ„æºå°†æ•°æ®åº“è¿æ¥æ± å¯¹è±¡è®¾è®¡ä¸ºçš„å•ä¾‹ç±»ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…±äº«è¿æ¥æ± å¯¹è±¡çš„ç¨‹åºè¿‡å¤šè€Œå‡ºç°è¿æ¥æ± æº¢å‡ºï¼›å¦‚æœå®ä¾‹åŒ–çš„å¯¹è±¡é•¿æ—¶é—´ä¸è¢«åˆ©ç”¨ï¼Œç³»ç»Ÿä¼šè®¤ä¸ºæ˜¯åƒåœ¾è€Œè¢«å›æ”¶ï¼Œè¿™å°†å¯¼è‡´å¯¹è±¡çŠ¶æ€çš„ä¸¢å¤±ã€‚ é€‚ç”¨åœºæ™¯å•ä¾‹æ¨¡å¼åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤èŠ‚çœå†…å­˜ï¼ŒåŠ å¿«å¯¹è±¡è®¿é—®é€Ÿåº¦ï¼Œå› æ­¤å¯¹è±¡éœ€è¦è¢«å…¬ç”¨çš„åœºåˆé€‚åˆä½¿ç”¨ï¼Œå¦‚å¤šä¸ªæ¨¡å—ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®æºè¿æ¥å¯¹è±¡ç­‰ç­‰ã€‚å¦‚ï¼š éœ€è¦é¢‘ç¹å®ä¾‹åŒ–ç„¶åé”€æ¯çš„å¯¹è±¡ã€‚ åˆ›å»ºå¯¹è±¡æ—¶è€—æ—¶è¿‡å¤šæˆ–è€…è€—èµ„æºè¿‡å¤šï¼Œä½†åˆç»å¸¸ç”¨åˆ°çš„å¯¹è±¡ã€‚ æœ‰çŠ¶æ€çš„å·¥å…·ç±»å¯¹è±¡ã€‚ é¢‘ç¹è®¿é—®æ•°æ®åº“æˆ–æ–‡ä»¶çš„å¯¹è±¡ã€‚ ä»¥ä¸‹éƒ½æ˜¯å•ä¾‹æ¨¡å¼çš„ç»å…¸ä½¿ç”¨åœºæ™¯ï¼š èµ„æºå…±äº«çš„æƒ…å†µä¸‹ï¼Œé¿å…ç”±äºèµ„æºæ“ä½œæ—¶å¯¼è‡´çš„æ€§èƒ½æˆ–æŸè€—ç­‰ã€‚å¦‚ä¸Šè¿°ä¸­çš„æ—¥å¿—æ–‡ä»¶ï¼Œåº”ç”¨é…ç½®ã€‚ æ§åˆ¶èµ„æºçš„æƒ…å†µä¸‹ï¼Œæ–¹ä¾¿èµ„æºä¹‹é—´çš„äº’ç›¸é€šä¿¡ã€‚å¦‚çº¿ç¨‹æ± ç­‰ã€‚ åº”ç”¨åœºæ™¯ä¸¾ä¾‹ï¼š å¤–éƒ¨èµ„æºï¼šæ¯å°è®¡ç®—æœºæœ‰è‹¥å¹²ä¸ªæ‰“å°æœºï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ªPrinterSpoolerï¼Œä»¥é¿å…ä¸¤ä¸ªæ‰“å°ä½œä¸šåŒæ—¶è¾“å‡ºåˆ°æ‰“å°æœºã€‚å†…éƒ¨èµ„æºï¼šå¤§å¤šæ•°è½¯ä»¶éƒ½æœ‰ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰å±æ€§æ–‡ä»¶å­˜æ”¾ç³»ç»Ÿé…ç½®ï¼Œè¿™æ ·çš„ç³»ç»Ÿåº”è¯¥æœ‰ä¸€ä¸ªå¯¹è±¡ç®¡ç†è¿™äº›å±æ€§æ–‡ä»¶ã€‚ Windowsçš„Task Managerï¼ˆä»»åŠ¡ç®¡ç†å™¨ï¼‰å°±æ˜¯å¾ˆå…¸å‹çš„å•ä¾‹æ¨¡å¼ï¼ˆè¿™ä¸ªå¾ˆç†Ÿæ‚‰å§ï¼‰ï¼Œæƒ³æƒ³çœ‹ï¼Œæ˜¯ä¸æ˜¯å‘¢ï¼Œä½ èƒ½æ‰“å¼€ä¸¤ä¸ªwindows task managerå—ï¼Ÿ ä¸ä¿¡ä½ è‡ªå·±è¯•è¯•çœ‹å“¦~ windowsçš„Recycle Binï¼ˆå›æ”¶ç«™ï¼‰ä¹Ÿæ˜¯å…¸å‹çš„å•ä¾‹åº”ç”¨ã€‚åœ¨æ•´ä¸ªç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå›æ”¶ç«™ä¸€ç›´ç»´æŠ¤ç€ä»…æœ‰çš„ä¸€ä¸ªå®ä¾‹ã€‚ ç½‘ç«™çš„è®¡æ•°å™¨ï¼Œä¸€èˆ¬ä¹Ÿæ˜¯é‡‡ç”¨å•ä¾‹æ¨¡å¼å®ç°ï¼Œå¦åˆ™éš¾ä»¥åŒæ­¥ã€‚ åº”ç”¨ç¨‹åºçš„æ—¥å¿—åº”ç”¨ï¼Œä¸€èˆ¬éƒ½ä½•ç”¨å•ä¾‹æ¨¡å¼å®ç°ï¼Œè¿™ä¸€èˆ¬æ˜¯ç”±äºå…±äº«çš„æ—¥å¿—æ–‡ä»¶ä¸€ç›´å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œå› ä¸ºåªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹å»æ“ä½œï¼Œå¦åˆ™å†…å®¹ä¸å¥½è¿½åŠ ã€‚ Webåº”ç”¨çš„é…ç½®å¯¹è±¡çš„è¯»å–ï¼Œä¸€èˆ¬ä¹Ÿåº”ç”¨å•ä¾‹æ¨¡å¼ï¼Œè¿™ä¸ªæ˜¯ç”±äºé…ç½®æ–‡ä»¶æ˜¯å…±äº«çš„èµ„æºã€‚ æ•°æ®åº“è¿æ¥æ± çš„è®¾è®¡ä¸€èˆ¬ä¹Ÿæ˜¯é‡‡ç”¨å•ä¾‹æ¨¡å¼ï¼Œå› ä¸ºæ•°æ®åº“è¿æ¥æ˜¯ä¸€ç§æ•°æ®åº“èµ„æºã€‚æ•°æ®åº“è½¯ä»¶ç³»ç»Ÿä¸­ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ï¼Œä¸»è¦æ˜¯èŠ‚çœæ‰“å¼€æˆ–è€…å…³é—­æ•°æ®åº“è¿æ¥æ‰€å¼•èµ·çš„æ•ˆç‡æŸè€—ï¼Œè¿™ç§æ•ˆç‡ä¸Šçš„æŸè€—è¿˜æ˜¯éå¸¸æ˜‚è´µçš„ï¼Œå› ä¸ºä½•ç”¨å•ä¾‹æ¨¡å¼æ¥ç»´æŠ¤ï¼Œå°±å¯ä»¥å¤§å¤§é™ä½è¿™ç§æŸè€—ã€‚ å¤šçº¿ç¨‹çš„çº¿ç¨‹æ± çš„è®¾è®¡ä¸€èˆ¬ä¹Ÿæ˜¯é‡‡ç”¨å•ä¾‹æ¨¡å¼ï¼Œè¿™æ˜¯ç”±äºçº¿ç¨‹æ± è¦æ–¹ä¾¿å¯¹æ± ä¸­çš„çº¿ç¨‹è¿›è¡Œæ§åˆ¶ã€‚ æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿæ˜¯å¤§çš„å•ä¾‹æ¨¡å¼å®ç°çš„å…·ä½“ä¾‹å­ï¼Œä¸€ä¸ªæ“ä½œç³»ç»Ÿåªèƒ½æœ‰ä¸€ä¸ªæ–‡ä»¶ç³»ã€‚ HttpApplication ä¹Ÿæ˜¯å•ä¾‹çš„å…¸å‹åº”ç”¨ã€‚ ä»¥ä¸Šæ¥è‡ªï¼šhttps://www.cnblogs.com/damsoft/p/6105122.html å®ç°æ–¹å¼é¥¿æ±‰å¼è¿™ç§æ–¹æ³•éå¸¸ç®€å•ï¼Œå› ä¸ºå•ä¾‹çš„å®ä¾‹è¢«å£°æ˜æˆ static å’Œ final å˜é‡äº†ï¼Œåœ¨ç¬¬ä¸€æ¬¡åŠ è½½ç±»åˆ°å†…å­˜ä¸­æ—¶å°±ä¼šåˆå§‹åŒ–ï¼Œæ‰€ä»¥åˆ›å»ºå®ä¾‹æœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ 12345678public class Singleton &#123; // ç±»åŠ è½½æ—¶å°±åˆå§‹åŒ– private static final Singleton instance = new Singleton(); private Singleton() &#123;&#125; public static Singleton getInstance()&#123; return instance; &#125;&#125; ç¼ºç‚¹æ˜¯å®ƒä¸æ˜¯ä¸€ç§æ‡’åŠ è½½æ¨¡å¼ï¼ˆlazy initializationï¼‰ï¼Œå•ä¾‹ä¼šåœ¨åŠ è½½ç±»åä¸€å¼€å§‹å°±è¢«åˆå§‹åŒ–ï¼Œå³ä½¿å®¢æˆ·ç«¯æ²¡æœ‰è°ƒç”¨ getInstance()æ–¹æ³•ã€‚é¥¿æ±‰å¼çš„åˆ›å»ºæ–¹å¼åœ¨ä¸€äº›åœºæ™¯ä¸­å°†æ— æ³•ä½¿ç”¨ï¼šè­¬å¦‚ Singleton å®ä¾‹çš„åˆ›å»ºæ˜¯ä¾èµ–å‚æ•°æˆ–è€…é…ç½®æ–‡ä»¶çš„ï¼Œåœ¨ getInstance() ä¹‹å‰å¿…é¡»è°ƒç”¨æŸä¸ªæ–¹æ³•è®¾ç½®å‚æ•°ç»™å®ƒï¼Œé‚£æ ·è¿™ç§å•ä¾‹å†™æ³•å°±æ— æ³•ä½¿ç”¨ æ‡’æ±‰å¼ï¼Œçº¿ç¨‹ä¸å®‰å…¨12345678910public class Singleton &#123; private static Singleton instance; private Singleton () &#123;&#125; public static Singleton getInstance() &#123; if (instance == null) &#123; instance = new Singleton(); &#125; return instance; &#125;&#125; è¿™æ®µä»£ç ç®€å•æ˜äº†ï¼Œè€Œä¸”ä½¿ç”¨äº†æ‡’åŠ è½½æ¨¡å¼ï¼Œä½†æ˜¯å´å­˜åœ¨è‡´å‘½çš„é—®é¢˜ã€‚å½“æœ‰å¤šä¸ªçº¿ç¨‹å¹¶è¡Œè°ƒç”¨ getInstance() çš„æ—¶å€™ï¼Œå°±ä¼šåˆ›å»ºå¤šä¸ªå®ä¾‹ æ‡’æ±‰å¼ï¼Œçº¿ç¨‹å®‰å…¨ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†æ•´ä¸ª getInstance() æ–¹æ³•è®¾ä¸ºåŒæ­¥ï¼ˆsynchronizedï¼‰ 123456public static synchronized Singleton getInstance() &#123; if (instance == null) &#123; instance = new Singleton(); &#125; return instance;&#125; è™½ç„¶åšåˆ°äº†çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸”è§£å†³äº†å¤šå®ä¾‹çš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒå¹¶ä¸é«˜æ•ˆã€‚å› ä¸ºåœ¨ä»»ä½•æ—¶å€™åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ getInstance() æ–¹æ³•ã€‚ä½†æ˜¯åŒæ­¥æ“ä½œåªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ‰è¢«éœ€è¦ï¼Œå³ç¬¬ä¸€æ¬¡åˆ›å»ºå•ä¾‹å®ä¾‹å¯¹è±¡æ—¶ã€‚è¿™å°±å¼•å‡ºäº†åŒé‡æ£€éªŒé” åŒé‡æ£€éªŒé”1234567891011121314public class Singleton &#123; private volatile static Singleton instance; private Singleton () &#123;&#125; public static Singleton getSingleton() &#123; if (instance == null) &#123; synchronized (Singleton.class) &#123; if (instance == null) &#123; instance = new Singleton(); &#125; &#125; &#125; return instance; &#125; &#125; ç§°å…¶ä¸ºåŒé‡æ£€æŸ¥é”ï¼Œæ˜¯å› ä¸ºä¼šæœ‰ä¸¤æ¬¡æ£€æŸ¥ instance == nullï¼Œä¸€æ¬¡æ˜¯åœ¨åŒæ­¥å—å¤–ï¼Œä¸€æ¬¡æ˜¯åœ¨åŒæ­¥å—å†…ã€‚ä¸ºä»€ä¹ˆåœ¨åŒæ­¥å—å†…è¿˜è¦å†æ£€éªŒä¸€æ¬¡ï¼Ÿå› ä¸ºå¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹ä¸€èµ·è¿›å…¥åŒæ­¥å—å¤–çš„ ifï¼Œå¦‚æœåœ¨åŒæ­¥å—å†…ä¸è¿›è¡ŒäºŒæ¬¡æ£€éªŒçš„è¯å°±ä¼šç”Ÿæˆå¤šä¸ªå®ä¾‹äº† è€Œ instance = new Singleton() è¿™å¥ï¼Œå¹¶éæ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œäº‹å®ä¸Šåœ¨ JVM ä¸­è¿™å¥è¯åšäº†ä¸‹é¢ 3 ä»¶äº‹ï¼š ç»™ instance åˆ†é…å†…å­˜ è°ƒç”¨ Singleton çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–æˆå‘˜å˜é‡ å°† instance å¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜ç©ºé—´ï¼ˆæ‰§è¡Œå®Œè¿™æ­¥ instance å°±ä¸ºé null äº†ï¼‰ ä½†æ˜¯åœ¨ JVM çš„å³æ—¶ç¼–è¯‘å™¨ä¸­å­˜åœ¨æŒ‡ä»¤é‡æ’åºçš„ä¼˜åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸Šé¢çš„ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥çš„é¡ºåºæ˜¯ä¸èƒ½ä¿è¯çš„ï¼Œæœ€ç»ˆçš„æ‰§è¡Œé¡ºåºå¯èƒ½æ˜¯ 1-2-3 ä¹Ÿå¯èƒ½æ˜¯ 1-3-2ã€‚å¦‚æœæ˜¯åè€…ï¼Œåˆ™åœ¨ 3 æ‰§è¡Œå®Œæ¯•ã€2 æœªæ‰§è¡Œä¹‹å‰ï¼Œè¢«çº¿ç¨‹äºŒæŠ¢å äº†ï¼Œè¿™æ—¶ instance å·²ç»æ˜¯é null äº†ï¼ˆä½†å´æ²¡æœ‰åˆå§‹åŒ–ï¼‰ï¼Œæ‰€ä»¥çº¿ç¨‹äºŒä¼šç›´æ¥è¿”å› instanceï¼Œç„¶åä½¿ç”¨ï¼Œç„¶åé¡ºç†æˆç« åœ°æŠ¥é”™ æ‰€ä»¥éœ€è¦å°† instance å˜é‡å£°æ˜æˆ volatile ã€Œç¦æ­¢é‡æ’åºã€ é™æ€å†…éƒ¨ç±»123456789public class Singleton &#123; private static class SingletonHolder &#123; private static final Singleton INSTANCE = new Singleton(); &#125; private Singleton () &#123;&#125; public static final Singleton getInstance() &#123; return SingletonHolder.INSTANCE; &#125; &#125; é™æ€å†…éƒ¨ç±»ä¸å¤–éƒ¨ç±»æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œå¤–éƒ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œå†…éƒ¨ç±»ä¸ä¼šè¢«åŠ è½½ï¼Œé™æ€å†…éƒ¨ç±»åªæ˜¯è°ƒç”¨çš„æ—¶å€™ç”¨äº†å¤–éƒ¨ç±»çš„åå­—è€Œå·²ï¼Œæ‰€ä»¥å³ä½¿ Singleton ç±»è¢«åŠ è½½ä¹Ÿä¸ä¼šåˆ›å»ºå•ä¾‹å¯¹è±¡ é™æ€å†…éƒ¨ç±» SingletonHolder åªæœ‰åœ¨ getInstance() æ–¹æ³•ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œæ‰ä¼šè¢«åŠ è½½ï¼Œä»è€Œåˆå§‹åŒ–å®ƒçš„é™æ€åŸŸï¼ˆåˆ›å»º Singleton çš„å®ä¾‹ï¼‰ï¼Œå› æ­¤è¯¥ç§æ–¹å¼å®ç°äº†æ‡’æ±‰å¼çš„å•ä¾‹æ¨¡å¼ ä¸ä»…å¦‚æ­¤ï¼Œæ ¹æ® JVM æœ¬èº«æœºåˆ¶ï¼Œç”±äºæ˜¯é™æ€çš„åŸŸï¼Œå› æ­¤åªä¼šåœ¨è™šæ‹Ÿæœºè£…è½½ç±»çš„æ—¶å€™åˆå§‹åŒ–ä¸€æ¬¡ï¼Œå¹¶ç”±è™šæ‹Ÿæœºæ¥ä¿è¯å®ƒçš„çº¿ç¨‹å®‰å…¨æ€§ åŒæ—¶ä¸ç”¨ synchronizedï¼Œæ‰€ä»¥æ²¡æœ‰æ€§èƒ½ç¼ºé™· 1234567public class Singleton &#123; private static final Singleton INSTANCE = new Singleton(); private Singleton() &#123;&#125; public static Singleton getInstance() &#123; return INSTANCE; &#125;&#125; è¿™ä¸ªå†™æ³•ä¹Ÿæ˜¯åˆ©ç”¨ç±»çš„é™æ€å˜é‡çš„å”¯ä¸€æ€§ï¼Œä¸è¿‡å’Œä¸Šé¢çš„å†™æ³•ç›¸æ¯”ï¼Œä¸èƒ½å®ç°æ‡’åŠ è½½ Enumç”¨æšä¸¾å†™å•ä¾‹æœ€å¤§çš„ä¼˜ç‚¹æ˜¯ç®€å• 1234567891011121314151617public enum Singleton &#123; INSTANCE &#123; @Override protected void read() &#123; System.out.println("read"); &#125; @Override protected void write() &#123; System.out.println("write"); &#125; &#125;; protected abstract void read(); protected abstract void write();&#125; ä»¥ä¸Šæ˜¯ä¸€ä¸ªå•ä¾‹æšä¸¾çš„ä¾‹å­ï¼Œè¦è·å–è¯¥å®ä¾‹åªéœ€è¦ Singleton.INSTANCEï¼Œå¹¶ä¸”æ­¤ç§æ–¹å¼å¯ä»¥ä¿è¯è¯¥å•ä¾‹çº¿ç¨‹å®‰å…¨ã€é˜²åå°„æ”»å‡»ã€é˜²æ­¢åºåˆ—åŒ–ç”Ÿæˆæ–°çš„å®ä¾‹ åç¼–è¯‘åçš„ç±»ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public abstract class Singleton extends Enum &#123; private Singleton(String s, int i) &#123; super(s, i); &#125; protected abstract void read(); protected abstract void write(); public static Singleton[] values() &#123; Singleton asingleton[]; int i; Singleton asingleton1[]; System.arraycopy(asingleton = ENUM$VALUES, 0, asingleton1 = new Singleton[i = asingleton.length], 0, i); return asingleton1; &#125; public static Singleton valueOf(String s) &#123; return (Singleton)Enum.valueOf(singleton/Singleton, s); &#125; Singleton(String s, int i, Singleton singleton) &#123; this(s, i); &#125; public static final Singleton INSTANCE; private static final Singleton ENUM$VALUES[]; static &#123; INSTANCE = new Singleton("INSTANCE", 0) &#123; protected void read() &#123; System.out.println("read"); &#125; protected void write() &#123; System.out.println("write"); &#125; &#125;; ENUM$VALUES = (new Singleton[] &#123; INSTANCE &#125;); &#125;&#125; çœ‹äº†è¿™ä¸ªç±»çš„çœŸèº«åï¼Œå¯ä»¥çŸ¥é“ï¼š æšä¸¾ç±»å®ç°å…¶å®çœç•¥äº† private ç±»å‹çš„æ„é€ å‡½æ•° æšä¸¾ç±»çš„åŸŸå…¶å®æ˜¯ç›¸åº”çš„ enum ç±»å‹çš„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ æšä¸¾ç±»çš„åŸŸä¼šåœ¨ static æ–¹æ³•å—ä¸­è¢«å®ä¾‹åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ enum è¢«ç±»åŠ è½½å™¨åŠ è½½æ—¶è¢«å®ä¾‹åŒ–ï¼Œå¹¶éæ‡’åŠ è½½ enum æ˜¯ abstract ç±»ï¼Œæ‰€ä»¥æ²¡æ³•å®ä¾‹åŒ–ï¼Œåå°„ä¹Ÿæ— èƒ½ä¸ºåŠ› å…³äºçº¿ç¨‹å®‰å…¨çš„ä¿è¯ï¼Œå…¶å®æ˜¯é€šè¿‡ç±»åŠ è½½æœºåˆ¶æ¥ä¿è¯çš„ï¼ŒINSTANCE æ˜¯åœ¨ static å—ä¸­å®ä¾‹åŒ–çš„ï¼ŒJVM åŠ è½½ç±»çš„è¿‡ç¨‹æ˜¾ç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ è€Œæšä¸¾å¯ä»¥ååºåˆ—åŒ–æ˜¯å› ä¸º Enum å®ç°äº† readResolve æ–¹æ³• å¯¹äºä¸€ä¸ªæ ‡å‡†çš„ enum å•ä¾‹æ¨¡å¼ï¼Œæœ€ä¼˜ç§€çš„å†™æ³•è¿˜æ˜¯å®ç°æ¥å£çš„å½¢å¼: 1234567891011121314151617// å®šä¹‰å•ä¾‹æ¨¡å¼ä¸­éœ€è¦å®Œæˆçš„ä»£ç é€»è¾‘public interface MySingleton &#123; void doSomething();&#125;public enum Singleton implements MySingleton &#123; INSTANCE &#123; @Override public void doSomething() &#123; System.out.println("complete singleton"); &#125; &#125;; public static MySingleton getInstance() &#123; return Singleton.INSTANCE; &#125;&#125; ç ´åå•ä¾‹æ¨¡å¼çš„ä¸‰ç§æ–¹å¼ åå°„ åºåˆ—åŒ– å…‹éš† å½“å•ä¾‹ç±»è¢«å¤šä¸ªç±»åŠ è½½å™¨åŠ è½½ï¼Œå¦‚ä½•è¿˜èƒ½ä¿æŒå•ä¾‹å¦‚æœå•ä¾‹ç”±ä¸åŒçš„ç±»è£…è½½å™¨è£…å…¥ï¼Œé‚£ä¾¿æœ‰å¯èƒ½å­˜åœ¨å¤šä¸ªå•ä¾‹ç±»çš„å®ä¾‹ã€‚å‡å®šä¸æ˜¯è¿œç«¯å­˜å–ï¼Œä¾‹å¦‚ä¸€äº› servlet å®¹å™¨å¯¹æ¯ä¸ª servlet ä½¿ç”¨å®Œå…¨ä¸åŒçš„ç±»è£…è½½å™¨ï¼Œè¿™æ ·çš„è¯å¦‚æœæœ‰ä¸¤ä¸ª servlet è®¿é—®ä¸€ä¸ªå•ä¾‹ç±»ï¼Œå®ƒä»¬å°±éƒ½ä¼šæœ‰å„è‡ªçš„å®ä¾‹ åŸºäºåŒæ ·çš„åŸå› ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå’Œé›†ç¾¤ç³»ç»Ÿä¹Ÿéƒ½å¯èƒ½å‡ºç°å•ä¾‹å¤±æ•ˆçš„æƒ…å†µ è§£å†³æ–¹æ³•ï¼šç”¨å¤šä¸ªç±»åŠ è½½å™¨çš„çˆ¶ç±»æ¥åŠ è½½å•ä¾‹ç±» 123456789private static Class getClass(String classname) throws ClassNotFoundException &#123; // çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œæœªè®¾ç½®çš„è¯é»˜è®¤æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ ClassLoader classLoader = Thread.currentThread().getContextClassLoader(); if (classLoader == null) classLoader = Singleton.class.getClassLoader(); return classLoader.loadClass(classname);&#125; å•ä¾‹ç±»é˜²æ­¢ååºåˆ—åŒ–123456public class Singleton implements java.io.Serializable &#123; // ... private Object readResolve() &#123; return INSTANCE; &#125;&#125; readResolve() æ–¹æ³•å¯ä»¥ç†è§£ååºåˆ—åŒ–è¿‡ç¨‹çš„å‡ºå£ï¼Œå°±æ˜¯åœ¨ååºåˆ—åŒ–å®Œæˆå¾—åˆ°å¯¹è±¡å‰ï¼ŒæŠŠè¿™ä¸ªå¯¹è±¡æ¢æˆæˆ‘ä»¬ç¡®å®šå¥½çš„é‚£ä¸ªã€‚ åå°„ç ´åå•ä¾‹åŸåˆ™åœ¨å•ä¾‹æ¨¡å¼ä¸­ï¼Œåªå¯¹å¤–æä¾›å·¥å‚æ–¹æ³•ï¼ˆè·å–å•ä¾‹ï¼‰ï¼Œå¹¶ç§æœ‰åŒ–æ„é€ å‡½æ•°ï¼Œæ¥é˜²æ­¢å¤–é¢å¤šä½™çš„åˆ›å»ºã€‚å¯¹äºä¸€èˆ¬çš„å¤–éƒ¨è°ƒç”¨æ¥è¯´ï¼Œç§æœ‰æ„é€ å‡½æ•°å·²ç»å¾ˆå®‰å…¨äº†ã€‚ä½†æ˜¯ä¸€äº›ç‰¹æƒç”¨æˆ·å¯ä»¥é€šè¿‡åå°„æ¥è®¿é—®ç§æœ‰æ„é€ å‡½æ•°ï¼Œç„¶åæ‰“å¼€è®¿é—®æƒé™ setAccessible(true)ï¼Œå°±å¯ä»¥è®¿é—®ç§æœ‰æ„é€ å‡½æ•°äº†ï¼Œè¿™æ ·ç ´åäº†å•ä¾‹çš„ç§æœ‰æ„é€ å‡½æ•°ä¿æŠ¤ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚å¦‚æœè¦é˜²å¾¡è¿™æ ·çš„åå°„ä¾µå…¥ï¼Œå¯ä»¥ä¿®æ”¹æ„é€ å‡½æ•°ï¼ŒåŠ ä¸Šç¬¬äºŒæ¬¡å®ä¾‹åŒ–çš„æ£€æŸ¥ï¼Œå½“å‘ç”Ÿåˆ›å»ºç¬¬äºŒä¸ªå•ä¾‹çš„è¯·æ±‚æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ 1234567private static int cntInstance = 0; private Singleton() throws Exception &#123; if (cntInstance++ &gt; 1) &#123; throw new Exception("can't create another singleton instance."); &#125;&#125; ä½œè€…ï¼šæ°å“¥é•¿å¾—å¸…é“¾æ¥ï¼šhttps://www.jianshu.com/p/ee110d76c42bæ¥æºï¼šç®€ä¹¦è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ æ¨¡æ¿æ–¹å¼æ¨¡å¼è‡ªå·±æ ¹æ® AQS é‡å†™äº†ä¸€ä¸ªå¯é‡å…¥ï¼Œä¸€ä¸ªä¸å¯é‡å…¥çš„æ˜¾ç¤ºé”ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164/** * éé‡å…¥ */class MutexDemo &#123;// private static Mutex mutex = new Mutex(); private static aa mutex = new aa(); public static void main(String[] args) &#123; for (int i = 0; i &lt; 2 ; i++)&#123; Thread thread = new Thread(() -&gt; &#123; mutex.lock(); try &#123; System.out.println("Current Thread:" + Thread.currentThread().getName()); try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; finally &#123; mutex.unlock(); &#125; &#125;); thread.start(); &#125; &#125;&#125;class Mutex implements Lock, java.io.Serializable &#123; // Our internal helper class private static class Sync extends AbstractQueuedSynchronizer &#123; // Reports whether in locked state protected boolean isHeldExclusively() &#123; return getState() == 1; &#125; protected boolean tryAcquire(int acquires) &#123; assert acquires == 1; // Otherwise unused if (compareAndSetState(0, 1)) &#123; setExclusiveOwnerThread(Thread.currentThread()); return true; &#125; return false; &#125; protected boolean tryRelease(int releases) &#123; assert releases == 1; // Otherwise unused if (getState() == 0) throw new IllegalMonitorStateException(); setExclusiveOwnerThread(null); setState(0); return true; &#125; // Provides a Condition Condition newCondition() &#123; return new ConditionObject(); &#125; &#125; // The sync object does all the hard work. We just forward to it. private final Sync sync = new Sync(); public void lock() &#123; sync.acquire(1); &#125; public boolean tryLock() &#123; return sync.tryAcquire(1); &#125; public void unlock() &#123; sync.release(1); &#125; public Condition newCondition() &#123; return sync.newCondition(); &#125; public void lockInterruptibly() throws InterruptedException &#123; sync.acquireInterruptibly(1); &#125; public boolean tryLock(long timeout, TimeUnit unit) throws InterruptedException &#123; return sync.tryAcquireNanos(1, unit.toNanos(timeout)); &#125;&#125;/** * å¯é‡å…¥ */class aa implements Lock,java.io.Serializable&#123; private static class Sync extends AbstractQueuedSynchronizer&#123; protected boolean isHeldExclusively()&#123; return getExclusiveOwnerThread() == Thread.currentThread(); &#125; protected boolean tryAcquire(int acquires)&#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; if (compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int next = c + acquires; if (next &lt; 0) // overflow throw new Error("Maximum lock count exceeded"); setState(next); return true; &#125; return false; &#125; protected final boolean tryRelease(int releases) &#123; int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) &#123; free = true; setExclusiveOwnerThread(null); &#125; setState(c); return free; &#125; // Provides a Condition Condition newCondition() &#123; return new ConditionObject(); &#125; &#125; private final Sync sync = new Sync(); @Override public void lock() &#123; sync.acquire(1); &#125; @Override public void lockInterruptibly() throws InterruptedException &#123; sync.acquireInterruptibly(1); &#125; @Override public boolean tryLock() &#123; return sync.tryAcquire(1); &#125; @Override public boolean tryLock(long time, TimeUnit unit) throws InterruptedException &#123; return sync.tryAcquireNanos(1, unit.toNanos(time)); &#125; @Override public void unlock() &#123; sync.release(1); &#125; @Override public Condition newCondition() &#123; return sync.newCondition(); &#125;&#125; ä»£ç†è®¾è®¡æ¨¡å¼åŠ¨æ€ä»£ç†ä¸ºä½•åŠ¨æ€ä»£ç†åªèƒ½ä»£ç†æ¥å£å…¶å®æˆ‘è§‰å¾—å®Œå…¨å¯ä»¥ä»£ç†ç±»ï¼Œå¦‚æœä½ è¯´ â€æ˜¯å› ä¸ºProxy$0å·²ç»ç»§æ‰¿äº†Proxyï¼Œjavaé‡Œé¢å•ç»§æ‰¿æ‰€ä»¥å¯¼è‡´åªèƒ½ä»£ç†æ¥å£â€œï¼Œé‚£æˆ‘å°±å¾—å¦è®¤ä½ äº†ï¼Œå› ä¸ºå…¶å®å®Œå…¨å¯ä»¥åšåˆ°ç›´æ¥è®© â€Proxyå»ä»£ç†â€œï¼Œæ‰€ä»¥ï¼Œæˆ‘è§‰å¾—äººå®¶è¿™ä¹ˆè®¾è®¡çš„åŸå› åªæœ‰ä¸€ä¸ªï¼š çœ‹äº†è¿™ä¹ˆå¤šåˆ†æçš„ï¼Œæˆ‘è§‰å¾—è¿™æ ·è®¾è®¡çš„åˆè¡·å°±æ˜¯ä¸ºäº†å¥—ç”¨ä»£ç†æ¨¡å¼æ¨¡æ¿å’ŒåŸºäºæ¥å£ç¼–ç¨‹è§„èŒƒçš„ é™æ€ä»£ç†ä¸­å°±æ˜¯å®ç°æ¥å£ï¼Œå†åœ¨ä»£ç†ç±»setè¿›å®ç°ç±»çš„å¼•ç”¨ï¼Œè°ƒç”¨çœŸæ­£ä»£ç†çš„æ–¹æ³• å°±ç®—ä»–ä¸ç»§æ‰¿Proxyï¼Œä¹Ÿä¸ä¼šç»§æ‰¿è¢«ä»£ç†çš„å®ç°ç±» ï¼Œè€Œæ˜¯å¿…é¡»æœ‰ä¸€ä¸ªä»£ç†ç±»çš„æ¥å£å»å®ç°å®ƒï¼Œè¿™æ˜¯è®¾è®¡çš„åˆè¡· ä½œè€…ï¼šForwardé“¾æ¥ï¼šhttps://www.zhihu.com/question/62201338/answer/904553916æ¥æºï¼šçŸ¥ä¹è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ åŠ¨æ€ä»£ç†çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆä»£ç†çš„è¿‡ç¨‹åœ¨ Proxy.newProxyInstance() æ–¹æ³•ä¸­ï¼Œç¨‹åºå…ˆæ˜¯è¿›è¡Œäº†éªŒè¯ã€ä¼˜åŒ–ã€ç¼“å­˜ã€åŒæ­¥ã€ç”Ÿæˆå­—èŠ‚ç å’Œæ˜¾å¼ç±»åŠ è½½ç­‰æ“ä½œï¼Œæœ€åè°ƒç”¨çš„ sum.misc.ProxyGenerator.generateProxyClass() æ¥å®Œæˆç”Ÿæˆå­—èŠ‚ç çš„åŠ¨ä½œï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨è¿è¡Œæ—¶äº§ç”Ÿä¸€ä¸ªæè¿°ä»£ç†ç±»çš„å­—èŠ‚ç æ•°ç»„byte[]ã€‚ ä»£ç†ç±»çš„å®ç°ä»£ç ä¹Ÿå¾ˆç®€å•ï¼Œå®ƒä¸ºæ¯ä¸€ä¸ªä¼ å…¥æ¥å£ä¸­çš„æ¯ä¸€ä¸ªæ–¹æ³•éƒ½è¿›è¡Œäº†ç›¸åº”çš„å®ç°ï¼Œè°ƒç”¨çš„æ–¹æ³•éƒ½æ˜¯åœ¨æ‰§è¡Œ InvocationHandler.invoke() ä¸­çš„ä»£ç†é€»è¾‘ã€‚ åŠ¨æ€ä»£ç†çš„å¥½å¤„æ˜¯ä»€ä¹ˆå®ç°äº†å¯ä»¥åœ¨åŸå§‹ç±»å’Œæ¥å£è¿˜æœªçŸ¥çš„æƒ…å†µä¸‹ï¼Œå°±ç¡®å®šä»£ç†ç±»çš„ä»£ç†è¡Œä¸ºï¼Œå½“ä»£ç†ç±»ä¸åŸå§‹ç±»è„±ç¦»ç›´æ¥è”ç³»åï¼Œå°±å¯ä»¥çµæ´»çš„é‡ç”¨äºä¸åŒçš„åº”ç”¨åœºæ™¯ä¸­äº†ã€‚ ä»€ä¹ˆå«é™æ€ä»£ç†é™æ€ä»£ç†ï¼Œåœ¨ç¼–è¯‘æœŸé—´å°±å·²ç»ç¡®å®šäº†è¦ä»£ç†çš„ç±»å’Œæ¥å£ï¼Œæ˜¯å†™æ­»äº†çš„ã€‚ 123456789101112131415161718192021nterface Person&#123; public void play();&#125;class é™æ€ä»£ç†&#123; public static void main(String[] args) &#123; Person person = new StaticProxy(); person.play(); &#125;&#125;class StaticProxy implements Person&#123; @Override public void play() &#123; Student student = new Student("jerome",10); student.play(); System.out.println("é™æ€ä»£ç†"); &#125;&#125; Demo123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566package è®¾è®¡æ¨¡å¼;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;public class ä»£ç† &#123; public static void main(String[] args) &#123; Person person = new Student("jerome",18); InvocationHandler dynamic = new Dynamic(person); Person person_proxy = (Person) Proxy.newProxyInstance(person.getClass().getClassLoader(),person.getClass().getInterfaces(),dynamic); person_proxy.play();// System.getProperties().put("sun.misc.ProxyGenerator.saveGeneratedFiles","true"); &#125;&#125;class Dynamic implements InvocationHandler&#123; // è¦ä»£ç†çš„å¯¹è±¡å¾—ä¼ è¿›æ¥ private Object object; public Dynamic(Object object)&#123; this.object = object; &#125; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; //do something System.out.println("let's begin!"); Object result = method.invoke(object,args); System.out.println("It's over!"); return result; &#125;&#125;class Student implements Person &#123; private String name; private int age; public Student(String name,int age)&#123; this.name = name; this.age = age; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; public void play()&#123; System.out.println("I just want to play with " + this.name + ", and her age is " + this.age); &#125;&#125;interface Person&#123; public void play();&#125; ç›¸å…³çš„å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯â€”-cglibç›¸å…³çš„ Aop &amp; IOC]]></content>
  </entry>
  <entry>
    <title><![CDATA[LeetCode äºŒåˆ·å¤ä¹ ]]></title>
    <url>%2F2020%2F02%2F10%2Fleetcode%26%E5%89%91%E6%8C%87%20%E4%BA%8C%E5%88%B7(%E6%8C%89tag).html</url>
    <content type="text"><![CDATA[dpèƒŒåŒ…ä¹è®²é—®é¢˜ 01 èƒŒåŒ…é—®é¢˜ å®Œå…¨èƒŒåŒ…é—®é¢˜ å¤šé‡èƒŒåŒ…é—®é¢˜ æ··åˆèƒŒåŒ…é—®é¢˜ äºŒç»´è´¹ç”¨çš„èƒŒåŒ…é—®é¢˜ åˆ†ç»„èƒŒåŒ…é—®é¢˜ èƒŒåŒ…é—®é¢˜æ±‚æ–¹æ¡ˆæ•° èƒŒåŒ…é—®é¢˜æ±‚æ–¹æ¡ˆè·¯å¾„ æœ‰ä¾èµ–çš„èƒŒåŒ…é—®é¢˜ 01èƒŒåŒ…é—®é¢˜èƒŒæ™¯ï¼šæœ‰ n ä»¶ç‰©å“ï¼Œæ¯ä¸€ä»¶ç‰©å“ i å¯¹åº”ä¸€ä¸ªä½“ç§¯ v[i] å’Œä¸€ä¸ªä»·å€¼ w[i]ï¼Œè®¾æœ‰ä¸€ä¸ªèƒŒåŒ…ï¼Œä½“ç§¯ä¸º Vï¼Œåœ¨è¿™ä¸ªèƒŒåŒ…ä¸‹èƒ½è£…ä¸‹çš„ä»·å€¼çš„æœ€å¤§å€¼æ˜¯å¤šå°‘ï¼Ÿ æ¨¡æ¿ æœ€åŸå§‹æ–¹æ³•ï¼š dp[i][j]å®šä¹‰ï¼šè¡¨ç¤ºå‰ i ä¸ªç‰©å“ï¼Œæ€»ä½“ç§¯æ˜¯ j çš„æƒ…å†µä¸‹ï¼Œæ€»ä»·å€¼æœ€å¤§æ˜¯ä»€ä¹ˆï¼Ÿ çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼šdp[i][j] = Math.max(dp[i-1][j], dp[i-1][j -v[i]] + w[i]) Max = dp[n][V] ä¼˜åŒ– dp[i][j] åªè·Ÿ ä¸Šä¸€å±‚çš„å¤–å¾ªç¯ æœ‰å…³ï¼Œæ‰€ä»¥æ ¹æœ¬æ²¡æœ‰å¿…è¦ä½¿ç”¨äºŒç»´æ•°ç»„ï¼Œåªéœ€è¦ä½¿ç”¨ä¸€ç»´æ•°ç»„å³å¯ï¼Œæ³¨æ„ï¼Œä½¿ç”¨ä¸€ç»´æ•°ç»„çš„æ—¶å€™ï¼Œå†…å±‚å¾ªç¯éœ€è¦ä»åå‘å‰éå†ï¼› å°† dp[0][j] å…¨éƒ¨åˆå§‹åŒ–ä¸º 0 ï¼Œåˆ™ dp[i][j] å°±ä»£è¡¨å‰ i ä¸ªç‰©å“ï¼Œæ€»ä½“ç§¯å°äºç­‰äº j çš„æœ€å¤§æ€»ä»·å€¼ï¼Œæ•…ä¸Šæ–‡çš„Max = dp[V]ï¼Œä»£è¡¨æ€»ä½“ç§¯å°äºç­‰äº V çš„æœ€å¤§æ€»ä»·å€¼ï¼› å¦‚æœè¦æ±‚çš„æ€»ä»·å€¼çš„å‰ææ˜¯èƒŒåŒ…å®¹é‡æ°å¥½æ˜¯ Vï¼Œåˆ™ åªéœ€è¦å°†åˆå§‹åŒ–çš„å€¼æ”¹ä¸º dp[0][0] = 0 ï¼Œdp[0][j] = - INF å³å¯ã€‚ æœ€ç»ˆæ¨¡æ¿ 1234567int[] dp = new int[V+1];for(int i = 1;i &lt;= n;i++)&#123; for(int j = V;j &gt;= v[i];j--)&#123; dp[j] = Math.max(dp[j],dp[j - v[i]] + w[i]); &#125;&#125;return dp[V]; â€‹ ä¾‹é¢˜ leetcodeç¬¬416é¢˜ï¼šåˆ†å‰²ç­‰å’Œå­é›† leetcodeç¬¬494é¢˜ ç›®æ ‡å’Œ 416 é¢˜ä»£ç  12345678910111213141516171819public class Solution &#123; public boolean canPartition(int[] nums) &#123; int sum = 0; for(int i = 0;i &lt; nums.length;i++)&#123; sum = sum + nums[i]; &#125; if(sum % 2 != 0 ) return false; int target = sum / 2; boolean[] dp = new boolean[target+1]; dp[0] = true; for(int i = 1;i &lt;= nums.length;i++)&#123; for(int j = target;j &gt;= nums[i-1];j--)&#123; if(dp[target]) return true; dp[j] = dp[j] || dp[j-nums[i-1]]; &#125; &#125; return false; &#125;&#125; 494 é¢˜ä»£ç  12345678910111213141516171819202122232425public class Solution &#123; public int findTargetSumWays(int[] nums, int S) &#123; // æ­£æ•°é›†åˆ Pï¼Œè´Ÿæ•°é›†åˆ T // P - T = targetï¼Œ P + T = sum // P = (sum + target) / 2 // å³é¢˜ç›®å°±æ˜¯æ‰¾ å­é›†å’Œçš„æ–¹æ³•æ•° // å…¸å‹çš„01èƒŒåŒ…é—®é¢˜æ±‚è§£æ–¹æ¡ˆæ•°ï¼Œåªéœ€è¦æŠŠåˆå§‹åŒ–çš„å€¼æ”¹åŠ¨ä¸€ä¸‹ï¼Œè¿˜è¦æŠŠçŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸­çš„ max ---&gt; sum int count = 0; for(int i = 0;i &lt; nums.length;i++)&#123; count = count + nums[i]; &#125; if(count &lt; S) return 0; if((S + count) % 2 != 0) return 0; int P = (S + count)/2; int[] dp = new int[P+1]; dp[0] = 1; // è¿™é‡Œæ˜¯ç¬¬ä¸€ä¸ªæ”¹åŠ¨ï¼Œå› ä¸ºä¾‹å¦‚äºŒç»´æ•°ç»„ä¸­çš„dp[1][1] = dp[0][0] + dp[0][1],dp[0][1] = 0 //æ­¤æ—¶è¦ä½¿å¾—dp[1][1] = 1,åˆ™dp[0][0] = 1,è¿™ä¹Ÿç¬¦åˆå¸¸ç†ï¼Œå³0ä¸ªæ•°èƒ½æ‰¾åˆ°å’Œä¸º0çš„æ–¹æ¡ˆä¸ºä¸€ç§ for(int i = 1;i &lt;= nums.length;i++)&#123; for(int j = P;j &gt;= nums[i-1];j--)&#123; dp[j] = dp[j] + dp[j - nums[i-1]]; &#125; &#125; return dp[P]; &#125;&#125; å®Œå…¨èƒŒåŒ…ç›¸æ¯” 01 èƒŒåŒ…é—®é¢˜æ¥è¯´ï¼Œè¿™é‡Œçš„ä¸€ä»¶ç‰©å“å¯ä»¥é€‰ä¸æ­¢ä¸€æ¬¡ æ‰€ä»¥ï¼Œè¿™é‡Œçš„åšæ³•è·Ÿ 01 èƒŒåŒ…åªæœ‰ä¸€ä¸ªä¸åŒï¼Œ01èƒŒåŒ…çš„ä¸€ç»´æ•°ç»„çš„æ–¹æ³•ä¸­çš„å†…å±‚å¾ªç¯æ˜¯ä»åå‘å‰éå†ï¼ŒåŸå› æ˜¯å…¶åœ¨å¾ªç¯ç¬¬ i ä¸ªç‰©å“æ—¶è¦ç”¨åˆ°ç¬¬ i-1ä¸ªç‰©å“çš„å¯¹åº”çš„å€¼ï¼Œä¸”è¦ç”¨åˆ°çš„å€¼éƒ½æ²¡æœ‰è¢«æœ¬æ¬¡å¾ªç¯æ›´æ–°è¿‡ï¼Œè€Œè¿™é‡Œæ°æ°ç›¸åï¼Œå› ä¸ºä¸€æ¬¡ç‰©å“å¯ä»¥ç”¨å¤šæ¬¡ï¼Œæ‰€ä»¥å®Œå…¨èƒŒåŒ…é—®é¢˜å…è®¸åœ¨å¾ªç¯ç¬¬ i ä¸ªç‰©å“æ—¶æå‰æ›´æ–°è¦ç”¨åˆ°çš„å€¼ï¼Œå…·ä½“Ë™è¯æ˜å¯ä»¥ä½¿ç”¨ æ•°å­¦å½’çº³æ³•ã€‚ æ¨¡æ¿f[j] è¡¨ç¤º æ€»ä½“ç§¯æ˜¯ j çš„æƒ…å†µä¸‹ï¼Œæœ€å¤§ä»·å€¼æ˜¯ä»€ä¹ˆ 12345678int[] dp = new int[V+1];// æ³¨æ„å†…å±‚å¾ªç¯æ˜¯ä»å‰å¾€åfor(int i = 0;i &lt;= n;i++)&#123; for(int j = v[i];j &lt;= V;j--)&#123; dp[j] = Math.max(dp[j],dp[j - v[i]] + w[i]); &#125;&#125;return dp[V]; å¤šé‡èƒŒåŒ…é—®é¢˜ Iç›¸æ¯” å®Œå…¨èƒŒåŒ…é—®é¢˜ ç›¸æ¯”ï¼Œå°±æ˜¯æ¯ä¸ªç‰©å“å¤šäº†ä¸€ä¸ªæ•°é‡çš„é™åˆ¶ï¼Œç±»ä¼¼äº01èƒŒåŒ…ï¼Œåªä¸è¿‡é‚£é‡Œçš„ç‰©å“çš„æ•°é‡ä¸º1ï¼Œè¿™é‡Œçš„æ•°é‡æ˜¯ sã€‚ æ¨¡æ¿123456789101112// åˆå§‹åŒ–ï¼Œf[i] = 0,i =0...nint[] dp = new int[V+1];for(int i = 1;i &lt;= n;i++)&#123; for(int j = V;j &gt;= 0;j--)&#123; // å’Œ01èƒŒåŒ…å”¯ä¸€çš„åŒºåˆ« for(int k = 1;k &lt;= s &amp;&amp; j &gt;= k * v[i];k++)&#123; dp[j] = Math.max(dp[j],dp[j - v[i]*k] + w[i]*k); &#125; &#125;&#125;return dp[V]; å¤šé‡èƒŒåŒ…é—®é¢˜ IIå…¶å®å°±æ˜¯å¯¹ä¸Šé¢è¿™ä¸ªæ¨¡æ¿çš„ä¼˜åŒ–ï¼Œæ˜¯å¯¹å¤šé‡èƒŒåŒ…çš„äºŒè¿›åˆ¶ä¼˜åŒ–æ–¹æ³• ã€‚æœ€å†…å±‚å¾ªç¯çš„æ„æ€å…¶å®å°±æ˜¯æŠŠèƒŒåŒ…çš„æ¯ä¸€æ¬¡é‡å¤éƒ½å½“æˆä¸€æ¬¡æ–°çš„ç‰©å“ï¼Œç±»ä¼¼äºæ‰“åŒ…çš„å½¢å¼ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªç‰©å“ä½“ç§¯æ˜¯ vï¼Œä»·å€¼ä¸º wï¼Œç¬¬äºŒä¸ªç‰©å“å°±æ˜¯ 2vï¼Œä»·å€¼ä¸º 2wï¼Œä»¥æ­¤ç±»æ¨ï¼Œä½†æ˜¯è¿™æ ·åˆ†è§£çš„æ—¶é—´å¤æ‚åº¦å¤ªé«˜äº†ï¼Œå¯ä»¥é€šè¿‡äºŒè¿›åˆ¶ä¼˜åŒ–æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä»–ä»¬ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œæ¯æ¬¡éƒ½ä¼šåªé€‰å‡ºä¸€ä¸ªæ¥ï¼Œæ˜¯åé¢çš„åˆ†ç»„èƒŒåŒ…çš„ç‰¹æ®Šæƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°èƒ½è¡¨ç¤ºæ‰€æœ‰æ–¹æ¡ˆçš„ç‰©å“å°±è¡Œï¼Œæ— éœ€å…¨éƒ¨ç½—åˆ—éƒ½å½“æˆ01èƒŒåŒ…çš„ç‰©å“ã€‚æ¯”å¦‚ç°åœ¨çš„ s ä¸º7ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦æ¯”è¾ƒ0ã€1ã€2ã€3ã€4ã€5ã€6ã€7è¿™8ä¸ªæ–¹æ¡ˆçš„æœ€å¤§å€¼ï¼Œä½†æ˜¯å…¶å®æˆ‘ä»¬å¯ä»¥ç”¨ä¸‰ä½æ•°å°±è¡¨ç¤º0ã€1ã€2ã€3ã€4ã€5ã€6ã€7ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦ä»è¿™8ä¸ªæ–¹æ¡ˆä¸­é€‰å–ä¸€ä¸ªå³å¯ï¼Œæ‰€ä»¥ä¸‰ä½æ•°å°±å¯ä»¥è¡¨ç¤ºæ‰€æœ‰ï¼Œç„¶åä»ä¸­é€‰å–è‡ªå·±ç¬¦åˆè¦æ±‚çš„å°±è¡Œï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©1ã€2ã€4ï¼Œå°±èƒ½è¡¨ç¤º 0 ~ 7 æ‰€æœ‰å…ƒç´ ï¼Œå¦‚æœ s ä¸º 10ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€‰å– 1ã€2ã€4ã€3 ï¼Œ3æ˜¯å¦‚ä½•æ¥çš„å‘¢ï¼Œæ˜¯ 10 - ï¼ˆ2^ 3 -1ï¼‰ å¾—æ¥çš„ï¼Œæ•…å°±å°† çº¿æ€§å¤æ‚åº¦ å˜ä¸º log2 å¤æ‚åº¦äº†ã€‚ æ¨¡æ¿123456789101112int[] dp = new int[V+1];for(int i = 1;i &lt;= n;i++)&#123; for(int j = V;j &gt;= 0;j--)&#123; for(int k = 1;k &lt;= s;k = k * 2)&#123; s = s - k; // æŠŠæ¯ä¸ª k å¯¹åº”çš„éƒ½å˜æˆ ä¸€ç§ç‰©å“ if(j &gt;= k * v[i]) dp[j] = Math.max(dp[j],dp[j - k * v[i]] + k * w[i]); &#125; //ä¸ç­‰äº0ï¼Œè¯´æ˜æœ‰ä½™æ•° if(s != 0 &amp;&amp; j &gt;= s * v[i]) dp[j] = Math.max(dp[j],dp[j - s * v[i]] + s * w[i]); &#125;&#125; å¤šé‡èƒŒåŒ…é—®é¢˜ IIIè¿™æ˜¯å¯¹å¤šé‡èƒŒåŒ…çš„å†æ¬¡ä¼˜åŒ–ï¼Œä¸Šæ–‡å·²ç»å°†æœ€å†…å±‚å¾ªç¯ä» O(n) é™ä¸ºäº† O(logn)ï¼Œè¿™é‡Œå¯ä»¥è¿ç”¨ å•è°ƒé˜Ÿåˆ— å°†æœ€å†…å±‚å¾ªç¯çš„ O(n) é™æˆ O(1)ã€‚ å®Œå…¨èƒŒåŒ…é—®é¢˜è½¬ç§»å›¾å’Œå¤šé‡èƒŒåŒ…ä¸€æ ·ã€‚ä¸è¿‡æ²¡æœ‰äº†ç‰©å“ä¸ªæ•°é™åˆ¶ï¼Œæ‰€ä»¥ä¸æ˜¯æ»‘åŠ¨çª—å£æƒ…å†µï¼Œä¸ç”¨å•è°ƒé˜Ÿåˆ—ã€‚åªä¿å­˜ä¸€ä¸ªæœ€å¤§å€¼å°±å¯ä»¥ã€‚æ‰€ä»¥å®Œå…¨èƒŒåŒ…é—®é¢˜å¯ä»¥ç›´æ¥ä»å‰å‘åéå†ï¼Œå› ä¸ºå…¶åªéœ€è¦ä¿å­˜ä¸€ä¸ªæœ€å¤§å€¼ã€‚æ‰€ä»¥è¿™é‡Œå¼•å…¥äº†å•è°ƒé˜Ÿåˆ—ä¹‹åï¼Œä¹Ÿç»´æŠ¤äº†ç›¸åŒä½™æ•°çš„æœ€å¤§å€¼ï¼Œæ•… j ä¹Ÿå¯ä»¥ä»å‰å‘åéå†ã€‚ æ€è·¯ï¼šhttps://blog.csdn.net/qq_40679299/article/details/81978770 ä¸ºä½•å¼•å…¥å•è°ƒé˜Ÿåˆ—åˆ†æï¼šhttps://www.cnblogs.com/DeepJay/p/12025225.html ä»£ç å’Œæ€è·¯ç²¾ç®€ç‰ˆï¼šhttps://www.acwing.com/solution/acwing/content/6500/ï¼ˆä¸»æ¨è¿™ä¸ªï¼‰ æ¨¡æ¿1234567891011121314151617181920212223242526272829303132333435363738394041import java.util.Arrays;import java.util.LinkedList;import java.util.Scanner;public class Main &#123; public static void main(String[] args) &#123; Scanner scan = new Scanner(System.in); // è¡¨ç¤ºç‰©å“ç§ç±» int n = scan.nextInt(); // è¡¨ç¤º æœ€å¤§çš„å®¹ç§¯ int V = scan.nextInt(); int[] dp = new int[V + 1]; for (int i = 0; i &lt; n; i++) &#123; int v = scan.nextInt(); int w = scan.nextInt(); int s = scan.nextInt(); int[] pre = Arrays.copyOf(dp,dp.length); // éå†æ‰€æœ‰ä½™æ•° for (int j = 0; j &lt; v; j++) &#123; // æ¯ä¸ªä½™æ•°å¯¹åº”ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œå®ç°å•è°ƒé˜Ÿåˆ— LinkedList&lt;Integer&gt; queue = new LinkedList(); for (int k = j; k &lt;= V; k = k + v) &#123; // 1. å»é™¤é˜Ÿå°¾ä¸ç¬¦åˆè¦æ±‚çš„ï¼Œä¿è¯ä»å¤§åˆ°å°ï¼Œå¦‚æœå‰é¢æ•°å°åˆ™éœ€è¦ä¾æ¬¡å¼¹å‡º while (!queue.isEmpty() &amp;&amp; pre[queue.peekLast()] - (queue.peekLast() - j) / v * w &lt;= pre[k] - (k - j) / v * w) &#123; queue.pollLast(); &#125; // 2.åˆ¤æ–­å½“å‰é˜Ÿåˆ—ä¸­é˜Ÿé¦–çš„å€¼æ˜¯å¦æœ‰æ•ˆ if (!queue.isEmpty() &amp;&amp; queue.peek() &lt; k - s * v) &#123; queue.poll(); &#125; // 3.æ·»åŠ å½“å‰å€¼å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ queue.addLast(k); // 4.æ‹¿åˆ°é˜Ÿé¦–æœ€å¤§å€¼ dp[k] = Math.max(dp[k], pre[queue.peek()] + (k - queue.peek()) / v * w); &#125; &#125; &#125; System.out.println(dp[V]); &#125;&#125; ä¾‹é¢˜LeetCode ç¬¬ 239 é¢˜ï¼šæ»‘åŠ¨çª—å£æœ€å¤§å€¼ è¯¥é¢˜ä¹Ÿæ˜¯åŒæ ·é‡‡ç”¨äº†å•è°ƒé˜Ÿåˆ—çš„æ–¹å¼ï¼Œå®˜æ–¹é¢˜è§£çš„è§£æ³•äºŒ å°±æ˜¯é‡‡ç”¨åŒç«¯é˜Ÿåˆ—å®ç°å•è°ƒé˜Ÿåˆ—ã€‚ 1234567891011121314151617181920212223242526272829class Solution &#123; public int[] maxSlidingWindow(int[] nums, int k) &#123; if(nums == null || nums.length &lt; 2) return nums; // åŒå‘é˜Ÿåˆ— ä¿å­˜å½“å‰çª—å£æœ€å¤§å€¼çš„æ•°ç»„ä½ç½® ä¿è¯é˜Ÿåˆ—ä¸­æ•°ç»„ä½ç½®çš„æ•°å€¼æŒ‰ä»å¤§åˆ°å°æ’åº LinkedList&lt;Integer&gt; queue = new LinkedList(); // ç»“æœæ•°ç»„ int[] result = new int[nums.length-k+1]; // éå†numsæ•°ç»„ for(int i = 0;i &lt; nums.length;i++)&#123; // ä¿è¯ä»å¤§åˆ°å° å¦‚æœå‰é¢æ•°å°åˆ™éœ€è¦ä¾æ¬¡å¼¹å‡ºï¼Œç›´è‡³æ»¡è¶³è¦æ±‚ while(!queue.isEmpty() &amp;&amp; nums[queue.peekLast()] &lt;= nums[i])&#123; queue.pollLast(); &#125; // 11 10 9 8 7 6 5 // åˆ¤æ–­å½“å‰é˜Ÿåˆ—ä¸­é˜Ÿé¦–çš„å€¼æ˜¯å¦æœ‰æ•ˆ if(!queue.isEmpty() &amp;&amp; queue.peek() &lt;= i-k)&#123; queue.poll(); &#125; // æ·»åŠ å½“å‰å€¼å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ queue.addLast(i); // å½“çª—å£é•¿åº¦ç¬¬ä¸€æ¬¡è¾¾åˆ°kåï¼Œå¼€å§‹ä¿å­˜å½“å‰çª—å£ä¸­æœ€å¤§å€¼ // ä»¥åæ¯èµ°ä¸€æ­¥ï¼Œå°±ä¼šä¿å­˜ä¸€ä¸ªæœ€å¤§å€¼ if(i+1 &gt;= k)&#123; result[i+1-k] = nums[queue.peek()]; &#125; &#125; return result; &#125;&#125; æ•…æ€»ç»“ä¸€ä¸‹ï¼Œå•è°ƒé˜Ÿåˆ—çš„æ¨¡æ¿ä¸ºï¼š 1234// 1.å­˜å…¥åŒç«¯é˜Ÿåˆ—çš„æ˜¯å€¼çš„ç´¢å¼•ï¼Œç¬¬ä¸€æ­¥æ˜¯å…ˆæŠŠé˜Ÿå°¾ä¸ç¬¦åˆè¦æ±‚çš„å…¨éƒ¨å¼¹æ ˆ// 2.ç„¶ååˆ¤æ–­é˜Ÿé¦–æ˜¯ä¸æ˜¯æœ‰ä¸ç¬¦åˆè¦æ±‚çš„ï¼Œå³ä¸åœ¨çª—å£ä¹‹ä¸­// 3.å°†è¯¥å€¼åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­// 4.è·å–åˆ°é¢˜ç›®éœ€è¦çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ä¸Šæ–‡è¦å–æ¯ä¸ªçª—å£çš„æœ€å¤§å€¼ï¼Œåˆ™å°†æ¯ä¸ªçª—å£çš„æœ€å¤§å€¼å­˜å…¥æ•°ç»„å³å¯ æ··åˆèƒŒåŒ…é—®é¢˜æ··åˆèƒŒåŒ…ï¼Œå°±æ˜¯01èƒŒåŒ…ï¼Œå®Œå…¨èƒŒåŒ…ï¼Œå¤šé‡èƒŒåŒ…ç»“åˆåœ¨ä¸€èµ·ï¼Œæ–¹æ³•å°±æ˜¯åˆ†ç±»åˆ¤æ–­ï¼Œåˆ†ç±»å¤„ç†å³å¯ï¼Œéå¸¸ç®€å•ï¼Œå°±ä¸åšè¿‡å¤šè§£é‡Šäº†ã€‚ äºŒç»´è´¹ç”¨çš„èƒŒåŒ…é—®é¢˜å…¶å®è·Ÿä¸€ç»´è´¹ç”¨çš„èƒŒåŒ…é—®é¢˜å¦‚å‡ºä¸€è¾™ï¼Œå°±æ˜¯å¤šäº†ä¸€å±‚å¾ªç¯ï¼Œdp ç”±ä¸€ç»´å˜æˆäº†äºŒç»´ï¼Œå…¶ä»–çš„è·Ÿä¸€ç»´çš„éƒ½æ˜¯ä¸€æ ·çš„ã€‚ åˆ†ç»„èƒŒåŒ…é—®é¢˜å…¶å®ï¼Œåˆ†ç»„èƒŒåŒ…å‰é¢å·²ç»è®²è¿‡äº†ï¼Œå°±æ˜¯å¤šé‡èƒŒåŒ…çš„ä¸€èˆ¬åŒ–ï¼Œå°±æ˜¯å› ä¸ºå¤šé‡èƒŒåŒ…çš„ç‰¹æ®Šï¼Œæ‰€ä»¥æ‰ä¼šæœ‰ä¸¤ä¸ªä¼˜åŒ–çš„æ–¹æ³•â€”â€”-äºŒè¿›åˆ¶ä¼˜åŒ– &amp;&amp; å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–ï¼Œæ‰€ä»¥å¯¹äºåˆ†ç»„èƒŒåŒ…é—®é¢˜ï¼Œå°±åªèƒ½é‡‡ç”¨ å¤šé‡èƒŒåŒ…é—®é¢˜ I çš„æ–¹æ³•ï¼Œä¸‰å±‚å¾ªç¯ã€‚ èƒŒåŒ…é—®é¢˜æ±‚æ–¹æ¡ˆæ•°æ±‚æ–¹æ¡ˆæ•°çš„å…³é”®å°±åœ¨äºç¡®å®šï¼šåœ¨æ¯ä¸€æ¬¡å¾ªç¯ä¸­ï¼Œæ˜¯ä¸æ˜¯é€‰äº†è¯¥æ•°ã€‚æ±‚æœ€ä¼˜æ–¹æ¡ˆçš„æ–¹æ¡ˆæ•°æ˜¯é€šè¿‡åˆ¤æ–­è¯¥ä½“ç§¯å¯¹åº”çš„ä»·å€¼çš„æœ€å¤§å€¼æœ‰æ²¡æœ‰æ”¹å˜ï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦é€‰äº†è¯¥æ•°ï¼Œé€‰äº†çš„è¯å°±æŠŠä»¥å‰çš„æ–¹æ¡ˆæ•°æ›¿æ¢æˆ–è€…ç´¯åŠ å³å¯ï¼›æ±‚å›ºå®šä½“ç§¯çš„æ–¹æ¡ˆæ•°ï¼Œå°±æ˜¯ç›´æ¥dp[j] = dp[j] + dp[j - v[i]]ï¼Œä½“ç§¯ä¸º j çš„å°±æ˜¯ç­‰äºé€‰äº†å’Œæ²¡é€‰çš„æ€»æ–¹æ¡ˆæ•°ï¼ˆè¿™ä¸ªåˆå§‹åŒ–æ˜¯å…³é”®ï¼‰ã€‚ æ±‚æœ€ä¼˜æ–¹æ¡ˆçš„æ–¹æ¡ˆæ•°è¿™é‡Œåªæœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ”¹åŠ¨ï¼Œé‚£å°±æ˜¯æ·»åŠ äº†ä¸€ä¸ª cnt æ•°ç»„æ¥ç»Ÿè®¡æ–¹æ¡ˆæ•°ã€‚ è¿™é‡Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼Œä¸€ä¸ªæ˜¯ï¼Œdp[0] = 0ï¼Œdp[i] = 0; å¦å¤–ä¸€ä¸ªæ˜¯ dp[0] = 0ï¼Œdp[i] = -INFã€‚ æ–¹æ³•ä¸€å’Œæ–¹æ³•äºŒåŒºåˆ«ä¸å¤§ï¼Œè·Ÿ 01èƒŒåŒ…ä¸€æ ·ï¼Œç”±äºåˆå§‹åŒ–çš„ä¸åŒï¼Œå¯¼è‡´æœ€åçš„ç»“æœï¼Œä¸€ä¸ªç›´æ¥å–å®¹é‡æœ€å¤§å€¼å³å¯ï¼Œä¸€ä¸ªéœ€è¦éå†ï¼Œè¿™é‡Œè¿˜æ˜¯æ¨èæ–¹æ¡ˆä¸€ï¼ æ–¹æ³•ä¸€ è¾“å…¥ 1234567æ€»ç‰©å“æ•°ï¼š4 æœ€å¤§å®¹ç§¯ï¼š5ç‰©å“ä½“ç§¯ ä»·å€¼1 22 43 44 6 è‹¥åˆå§‹åŒ–çš„å€¼éƒ½ä¸º 0 0 1 2 3 4 5 0 0 0 0 0 0 0 1 0 2 2 2 2 2 2 0 2 2 6 6 6 3 0 2 2 6 6 8 4 0 2 2 6 6 8 æ¨¡æ¿ å®šä¹‰ä¸¤ä¸ªæ•°ç»„ï¼Œdp[j] ç”¨æ¥å­˜å‚¨èƒŒåŒ…å®¹ç§¯æ˜¯ j æ—¶çš„æœ€ä½³æ–¹æ¡ˆçš„æ€»ä»·å€¼ï¼Œcnt[j] ç”¨æ¥å­˜å‚¨å®¹ç§¯ä¸º j æ—¶æ€»ä»·å€¼ä¸ºæœ€ä½³çš„æ–¹æ¡ˆæ•°ï¼› å…ˆåˆå§‹åŒ– dp[0] = 0ï¼Œdp[j] = -INFï¼Œå¾ˆå®¹æ˜“ç†è§£ï¼Œå®¹ç§¯ä¸º 0ï¼Œè‡ªç„¶ä»·å€¼å°±ä¸º 0 äº†ï¼Œè€Œè¦ä½¿å¾—å®¹ç§¯ä¸º 1ã€2â€¦ä¸”æ²¡æœ‰æ•°ï¼Œåˆ™è‡ªç„¶ä»·å€¼å°±ä¸å­˜åœ¨äº†ï¼Œè®°ä¸º -INFï¼Œå†åˆå§‹åŒ–æ‰€æœ‰çš„ cnt[j] = 1ï¼Œå› ä¸ºèƒŒåŒ…é‡Œä»€ä¹ˆéƒ½ä¸è£…å¯¹ä»»ä½•å®¹ç§¯æ¥è¯´éƒ½æ˜¯ä¸€ç§æ–¹æ¡ˆï¼Œåœ¨æ²¡æœ‰æ•°çš„æƒ…å†µä¸‹è‡ªç„¶å°±æ˜¯æœ€å¥½çš„æƒ…å†µäº†ï¼› åœ¨æ¯æ¬¡å¾ªç¯æ–°ç‰©å“æ—¶ï¼Œå…ˆæ±‚å¾—è£…æ–°ç‰©å“çš„æ€»ä»·å€¼ï¼Œç„¶åä¸ä¸è£…æ–°ç‰©å“å¯¹æ¯”ï¼Œå¦‚æœè£…äº†æ–°ç‰©å“çš„ä»·å€¼æ›´å¤§ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨ dp[j - v[i]] + w æ›´æ–° dp[j]ï¼ŒåŒæ—¶ç”¨ cnt[j - v[i]] æ¥æ›´æ–° cnt[j]ï¼› å¦‚æœæ€»ä»·å€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆ cnt[j] = cnt[j] + cnt[j-v[i]]ï¼› å½“ç„¶å¦‚æœè£…äº†æ–°ç‰©å“è¿˜ä¸å¦‚ä¸è£…å‘¢ï¼Œé‚£å°±å•¥ä¹Ÿä¸ç”¨åšäº†ã€‚ 1234567891011121314151617181920212223242526272829303132import java.util.Scanner;public class Test &#123; public static void main(String[] args) &#123; Scanner scan = new Scanner(System.in); // è¡¨ç¤ºç‰©å“ç§ç±» int n = scan.nextInt(); // è¡¨ç¤º æœ€å¤§çš„å®¹ç§¯ int V = scan.nextInt(); int[] dp = new int[V + 1]; int[] cnt = new int[V + 1]; for (int j = 0; j &lt;= V; j++) &#123; cnt[j] = 1; &#125; for (int i = 0; i &lt; n; i++) &#123; int v = scan.nextInt(); int w = scan.nextInt(); for (int j = V; j &gt;= v; j--) &#123; int value = dp[j - v] + w; if (value &gt; dp[j]) &#123; dp[j] = value; cnt[j] = cnt[j - v]; &#125; else if (value == dp[j]) &#123; cnt[j] = cnt[j] + cnt[j - v]; &#125; &#125; &#125; System.out.println(cnt[V]); &#125;&#125; å›çœ‹è¡¨æ ¼(æ‹¬å·å†…ä¸º cnt çš„å€¼) 1234567æ€»ç‰©å“æ•°ï¼š4 æœ€å¤§å®¹ç§¯ï¼š5ç‰©å“ä½“ç§¯ ä»·å€¼1 22 43 44 6 0 1 2 3 4 5 0 0(1) 0(1) 0(1) 0(1) 0(1) 0(1) 1 0(1) 2(1) 2(1) 2(1) 2(1) 2(1) 2 0(1) 2(1) 4(1) 6(1) 6(1) 6(1) 3 0(1) 2(1) 4(1) 6(1) 6(2) 8(1) 4 0(1) 2(1) 4(1) 6(1) 6(3) 8(2) å†æ¥ä¸€ä¸ªç¤ºä¾‹ 1234567æ€»ç‰©å“æ•°ï¼š4 æœ€å¤§å®¹ç§¯ï¼š5ç‰©å“ä½“ç§¯ ä»·å€¼2 42 43 44 6 0 1 2 3 4 5 0 0(1) 0(1) 0(1) 0(1) 0(1) 0(1) 1 0(1) 0(1) 4(1) 4(1) 4(1) 4(1) 2 0(1) 0(1) 4(2) 4(2) 8(1) 8(1) 3 0(1) 0(1) 4(2) 4(3) 8(1) 8(3) 4 0(1) 0(1) 4(2) 4(3) 8(1) 8(3) å¥—ç”¨ä¸Šè¿°æ¨¡æ¿ï¼Œå®ç° LeetCode 494é¢˜ 1234567891011121314151617181920212223242526272829public class Solution &#123; public int findTargetSumWays(int[] nums, int S) &#123; int count = 0; for(int i = 0;i &lt; nums.length;i++)&#123; count = count + nums[i]; &#125; if(count &lt; S) return 0; if((S + count) % 2 != 0) return 0; int V = (S + count)/2; int[] dp = new int[V + 1]; int[] cnt = new int[V + 1]; for (int j = 0; j &lt;= V; j++) &#123; cnt[j] = 1; &#125; for (int i = 0; i &lt; nums.length; i++) &#123; int v = nums[i]; for (int j = V; j &gt;= v; j--) &#123; int value = dp[j - v] + v; if (value &gt; dp[j]) &#123; dp[j] = value; cnt[j] = cnt[j - v]; &#125; else if (value == dp[j]) &#123; cnt[j] = cnt[j] + cnt[j - v]; &#125; &#125; &#125; return cnt[V]; &#125;&#125; æ–¹æ³•äºŒ è‹¥åˆå§‹åŒ–çš„å€¼ä¸éƒ½ä¸º 0,ç”¨ä¸Šé¢çš„ç¤ºä¾‹ 1234567æ€»ç‰©å“æ•°ï¼š4 æœ€å¤§å®¹ç§¯ï¼š5ç‰©å“ä½“ç§¯ ä»·å€¼2 42 43 44 6 0 1 2 3 4 5 0 0(1) -INF(1) -INF(1) -INF(1) -INF(1) -INF(1) 1 0(1) -INF(1) 4(1) -INF(1) -INF(1) -INF(1) 2 0(1) -INF(1) 4(2) -INF(2) 8(1) -INF(1) 3 0(1) -INF(1) 4(2) 4(1) 8(1) 8(2) 4 0(1) -INF(1) 4(2) 4(1) 8(1) 8(2) æ¨¡æ¿ 1234567891011121314151617181920212223242526272829303132333435363738394041424344import java.util.Scanner;public class Test &#123; public static void main(String[] args) &#123; Scanner scan = new Scanner(System.in); int ma = (int) (Math.pow(10,9) + 7); // è¡¨ç¤ºç‰©å“ç§ç±» int n = scan.nextInt(); // è¡¨ç¤º æœ€å¤§çš„å®¹ç§¯ int V = scan.nextInt(); int[] dp = new int[V + 1]; int[] cnt = new int[V + 1]; for (int j = 0; j &lt;= V; j++) &#123; cnt[j] = 1; dp[j] = Integer.MIN_VALUE; &#125; dp[0] = 0; for (int i = 0; i &lt; n; i++) &#123; int v = scan.nextInt(); int w = scan.nextInt(); for (int j = V; j &gt;= v; j--) &#123; int value = dp[j - v] + w; if (value &gt; dp[j]) &#123; dp[j] = value; cnt[j] = cnt[j - v]; &#125; else if (value == dp[j]) &#123; cnt[j] = cnt[j] + cnt[j - v]; &#125; &#125; &#125; int max = Integer.MIN_VALUE; int count = 0; for(int i = 0;i &lt;= V;i++)&#123; max = Math.max(dp[i],max); &#125; for(int i = 0;i &lt;= V;i++)&#123; if(dp[i] == max)&#123; count+=cnt[i]; &#125; &#125; System.out.println(count); &#125;&#125; æ€è·¯ä¸€æ¨¡ä¸€æ ·â€¦å°±æ˜¯å¤´å’Œå°¾å¤æ‚äº†ä¸€ä¸‹ï¼Œæ‰€ä»¥æ„Ÿè§‰æ²¡å•¥å­å¿…è¦â€¦ æ±‚èƒŒåŒ…è£…è‡³æŒ‡å®šå®¹é‡çš„æ–¹æ¡ˆæ•°è¿™ä¸ªéå¸¸ç®€å•äº†ï¼Œå°±æ˜¯ä¸Šé¢çš„ç‰¹æ®ŠåŒ–ä¾‹å­ï¼Œä¹Ÿå°±æ˜¯æŠŠ å¾ªç¯åˆ°çš„è¯¥æ•°çš„å®¹é‡ ä½œä¸ºä»·å€¼ï¼Œç„¶åè®¡ç®—æŒ‡å®šä»·å€¼çš„æ–¹æ¡ˆæ•°ï¼Œè¿™æ˜¯ä¸€èˆ¬åŒ–çš„åšæ³•ï¼Œä½†æ˜¯æ—¢ç„¶è°ˆåˆ°ç‰¹æ®ŠåŒ–ï¼Œä¹Ÿå°±æ˜¯å®¹é‡å’Œä»·å€¼ç›¸ç­‰ï¼Œé‚£è‡ªç„¶å¯ä»¥é‡‡ç”¨æ›´ç®€å•çš„æ–¹æ³•å»å¤„ç†äº†ã€‚ åˆå§‹åŒ– dp[0] = 1ï¼Œä»£è¡¨ 0 å®¹é‡çš„èƒŒåŒ…çš„æ–¹æ¡ˆä¸º1ï¼Œå…¶ä»–éƒ½ä¸º0ï¼› dp[i][j] = dp[i-1][j] + dp[i-1][j-v[i]]ï¼Œå¾ˆå¥½ç†è§£äº†ï¼Œå°±ä¸åšè§£é‡Šäº†ã€‚ ç¤ºä¾‹å°±æ˜¯ LeetCode 494 é¢˜ã€‚ èƒŒåŒ…é—®é¢˜æ±‚æ–¹æ¡ˆè·¯å¾„å¦‚æœæ²¡æœ‰è¦æ±‚å¾—åˆ° æŒ‰å­—å…¸é¡ºåºæœ€å°çš„ æ–¹æ¡ˆè·¯å¾„çš„è¯ï¼Œå°±å¯ä»¥ç›´æ¥æŒ‰01èƒŒåŒ…çš„æ–¹æ³•å»åš(ç”±äºè¦è®°å½•æ–¹æ¡ˆè·¯å¾„ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨æ»šåŠ¨æ•°ç»„ï¼Œéœ€è¦ç”¨åˆ°æ¯ä¸€è½®çš„æ–¹æ¡ˆï¼Œæ‰€ä»¥éœ€è¦æ”¹ä¸ºäºŒç»´æ•°ç»„)ï¼Œç„¶ååœ¨éå†çš„æ—¶å€™ï¼Œåˆ¤æ–­ f[i][j]æ˜¯å¦å’Œ f[i-1][j-v[i]] + w[i] ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰è¯´æ˜ç”¨åˆ°äº†è¯¥ä¸ªç‰©å“ï¼ŒåŠ å…¥æ–¹æ¡ˆè·¯å¾„ä¸­å³å¯ã€‚ å¦‚æœè¦æ±‚æ˜¯å¾—åˆ°æœ€å°çš„ æ–¹æ¡ˆè·¯å¾„çš„è¯ï¼Œåˆ™éœ€è¦å°†æ–¹æ¡ˆä»æœ«å°¾éå†åˆ°å¼€å§‹ï¼Œå¾—åˆ°æœ€ä½³æ–¹æ¡ˆåï¼Œå†ä»å‰å‘åå¯»æ‰¾æ–¹æ¡ˆè·¯å¾„ã€‚ æ¨¡æ¿123456789101112131415int[][] dp = new int[n+1][V+1];for(int i = n;i &gt;= 1;i--)&#123; // äºŒç»´çš„è¯å†…å±‚å¾ªç¯å°±æ— æ‰€è°“æ˜¯ä»å‰å¾€åè¿˜æ˜¯ä»åå¾€å‰äº† for(int j = V;j &gt;= v[i];j--)&#123; dp[i][j] = Math.max(dp[i+1][j],dp[i+1][j - v[i]] + w[i]); &#125;&#125;int vol = m;for(int i = 1;i &lt;= n;i++)&#123; if(f[i][vol] == f[i+1][vol-v[i]] + w[i])&#123; // å°†è¯¥æ–¹æ¡ˆåŠ å…¥ System.out.println(i); vol = vol - v[i]; &#125;&#125; æœ‰ä¾èµ–çš„èƒŒåŒ…é—®é¢˜ï¼ˆ æˆ‘æš‚æ—¶æ²¡å¤ä¹ ï¼ï¼‰è¿™åº”è¯¥æ˜¯èƒŒåŒ…é—®é¢˜é‡Œé¢æœ€éš¾çš„ä¸€ç±»äº†ï¼Œæ˜¯ç”¨ æ ‘å½¢ dp + åˆ†ç»„èƒŒåŒ…é—®é¢˜ çš„æ€è·¯å»è§£å†³ã€‚ https://www.acwing.com/solution/acwing/content/8316/ æ›´å¤šè§è§†é¢‘ï¼šhttps://www.bilibili.com/video/av33930433/?p=2ã€https://www.bilibili.com/video/av34467850/?p=2ï¼ˆè¿™ä¸ªè§†é¢‘æ˜¯ä»ç¬¬ 12 åˆ†é’Ÿå¼€å§‹è®²èƒŒåŒ… 9 è®²åé¢çš„ 3 è®²ï¼‰ è®­ç»ƒåœ°å€ï¼šhttps://www.acwing.com/problem/content/2/ æ›´è¯¦ç»†çš„èƒŒåŒ…ä¹è®²é—®é¢˜ï¼šå·²ç»ä¸‹è½½åˆ°æœ¬åœ°äº†ï¼Œå´”æ·»ç¿¼çš„ pdfâ€”â€”&gt; æœ¬åœ°æ–‡ä»¶åå­—å« èƒŒåŒ…é—®é¢˜ä¹è®² äºŒå‰æ ‘é“¾è¡¨ çƒ­é¢˜ 100ï¼š 2. ä¸¤æ•°ç›¸åŠ  19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹ 21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ 23. åˆå¹¶ K ä¸ªæ’åºé“¾è¡¨ 141. ç¯å½¢é“¾è¡¨ 142. ç¯å½¢é“¾è¡¨ II 148. æ’åºé“¾è¡¨ 160. ç›¸äº¤é“¾è¡¨ 206. åè½¬é“¾è¡¨ 234. å›æ–‡é“¾è¡¨ å‰‘æŒ‡ offerï¼š 18. åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹ 22. åˆ é™¤å€’æ•°ç¬¬ k ä¸ªèŠ‚ç‚¹ 24. åè½¬é“¾è¡¨ 35. å¤æ‚é“¾è¡¨çš„å¤åˆ¶ 52. ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹ ç›¸å…³é¢˜ç›®ï¼ˆçƒ­é¢˜100ï¼‰ ä¸¤æ•°ç›¸åŠ 1234567891011121314151617181920212223class Solution &#123; public ListNode addTwoNumbers(ListNode l1, ListNode l2) &#123; // é¦–å…ˆæ¯”è¾ƒä½æ•°ï¼Œä¸¤ä¸ªåŒæ—¶å‘åéå†ï¼Œå½“ cur.next == null æ—¶è¯´æ˜æœ‰ä¸€ä¸ªå·²ç»åˆ°äº†æœ€é«˜ä½ // æŒ‰ç…§é€†åºçš„æ–¹å¼å­˜å‚¨ï¼Œå…¶å®æ˜¯å°†é¢˜ç›®å˜ç®€å•äº†ã€‚å› ä¸ºæˆ‘ä»¬åœ¨è®¡ç®—ä¸¤æ•°ç›¸åŠ æ—¶ï¼Œæ˜¯å…ˆç®—ä½ä½ï¼Œå†è¿›ä½ç»™é«˜ä½ // é€†åºçš„è¯åˆšå¥½å°±ç¬¦åˆè¿™ç§è¿ç®—è§„åˆ™ // å¤´ç»“ç‚¹ ListNode res = new ListNode(-1); ListNode cur = res; // å®šä¹‰ä¸€ä¸ªè¿›ä½ int quo = 0; while(l1 != null || l2 != null || quo != 0)&#123; int t = (l1 == null ? 0 : l1.val) + (l2 == null ? 0 : l2.val) + quo; quo = t/10; t = t % 10; cur.next = new ListNode(t); cur = cur.next; l1 = l1 == null ? l1 : l1.next; l2 = l2 == null ? l2 : l2.next; &#125; return res.next; &#125;&#125; æ‹“å±•ï¼Œé“¾è¡¨æ­£åºå­˜å‚¨æ•°å­—ï¼Œå¦‚ä½•è®¡ç®—ï¼Ÿ åŒç«¯é˜Ÿåˆ— 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859public class addTwoNumbers &#123; public static void main(String[] args) &#123; addTwoNumbers addTwoNumbers = new addTwoNumbers(); ListNode list1 = new ListNode(9);// list1.next = new ListNode(4);// list1.next.next = new ListNode(3); ListNode list2 = new ListNode(5); list2.next = new ListNode(6); list2.next.next = new ListNode(4); // 9 + 564 = 573 // 243 + 564 = 807 ListNode listNode = addTwoNumbers.addTwoNumbers(list1,list2); System.out.println(listNode.val + "-----&gt;" + listNode.next.val + "------&gt;" + listNode.next.next.val); &#125; // æ–¹æ³•ä¸€ï¼šç”¨åŒç«¯é˜Ÿåˆ—å®ç° public ListNode addTwoNumbers(ListNode l1, ListNode l2) &#123; // æƒ³æ³•æ˜¯ä½¿ç”¨ä¸¤ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œå…ˆå°†æ•°éƒ½ä»é˜Ÿå°¾è¿›é˜Ÿï¼Œå½“æŸä¸ªæ•° ä½æ•°ä¸å¤Ÿæ—¶ï¼Œç”¨0åŠ åˆ°é˜Ÿé¦– // è®¡ç®—æ˜¯éƒ½ä»é˜Ÿå°¾å‡º // å‡ºé˜Ÿåå†ç”¨æ ˆæ¥æ”¶ä¸€ä¸‹ LinkedList&lt;Integer&gt; deque_l1 = new LinkedList&lt;&gt;(); LinkedList&lt;Integer&gt; deque_l2 = new LinkedList&lt;&gt;(); while(l1 != null)&#123; deque_l1.push(l1.val); l1 = l1.next; &#125; while (l2 != null)&#123; deque_l2.push(l2.val); l2 = l2.next; &#125; int deq1_len = deque_l1.size(); int deq2_len = deque_l2.size(); if(deq1_len &gt; deq2_len)&#123; for(int i = 1;i &lt;= deq1_len - deq2_len;i++)&#123; deque_l2.addLast(0); &#125; &#125; else if(deq2_len &gt; deq1_len)&#123; for(int i = 1;i &lt;= deq2_len - deq1_len;i++)&#123; deque_l1.addLast(0); &#125; &#125; Stack&lt;Integer&gt; stack = new Stack(); int quo = 0; while (deque_l1.size() != 0)&#123; int sum = deque_l1.pop() + deque_l2.pop() + quo; stack.push(sum % 10); quo = sum/10; &#125; ListNode res = new ListNode(-1); ListNode cur = res; while(!stack.isEmpty())&#123; cur.next = new ListNode(stack.pop()); cur = cur.next; &#125; return res.next; &#125;&#125; å°†é“¾è¡¨åè½¬ï¼Œç„¶åè®¡ç®—ï¼Œæœ€åå†åè½¬å›æ¥ 12345678910111213141516171819202122232425262728293031323334353637public ListNode addTwoNumbers2(ListNode l1, ListNode l2)&#123; ListNode reverse_l1 = reverseList(l1); ListNode reverse_l2 = reverseList(l2); ListNode tmp = addTwoNumbers(reverse_l1,reverse_l2); ListNode listNode = reverseList(tmp); return listNode; &#125; public ListNode addTwoNumbers(ListNode l1, ListNode l2) &#123; // å¤´ç»“ç‚¹ ListNode res = new ListNode(-1); ListNode cur = res; // å®šä¹‰ä¸€ä¸ªè¿›ä½ int quo = 0; while(l1 != null || l2 != null || quo != 0)&#123; int t = (l1 == null ? 0 : l1.val) + (l2 == null ? 0 : l2.val) + quo; quo = t/10; t = t % 10; cur.next = new ListNode(t); cur = cur.next; l1 = l1 == null ? l1 : l1.next; l2 = l2 == null ? l2 : l2.next; &#125; return res.next; &#125; public ListNode reverseList(ListNode head) &#123; // å¦‚æœå½“å‰è¦åè½¬çš„èŠ‚ç‚¹ä¸º null æˆ–è€…åè½¬é“¾è¡¨ä¸º null // head.next ä¸º nullï¼Œå³åè½¬é“¾è¡¨çš„å°¾ç»“ç‚¹ä¸å­˜åœ¨ï¼Œå³åè½¬é“¾è¡¨ä¸å­˜åœ¨ if (head == null || head.next == null) return head; // èŠ‚ç‚¹ p å…¶å®å°±æ˜¯åè½¬é“¾è¡¨çš„å¤´èŠ‚ç‚¹ ListNode p = reverseList(head.next); // æˆ‘ä»¬å°†åè½¬é“¾è¡¨çš„å°¾ç»“ç‚¹ï¼ˆhead.nextï¼‰çš„ next æŒ‡å‘å½“å‰å³å°†åè½¬çš„èŠ‚ç‚¹ head.next.next = head; // ç„¶åè®©å½“å‰èŠ‚ç‚¹å˜æˆåè½¬é“¾è¡¨çš„å°¾ç»“ç‚¹ head.next = null; // è¿”å›åè½¬é“¾è¡¨çš„å¤´ç»“ç‚¹ return p; &#125; åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªèŠ‚ç‚¹åˆ©ç”¨å…ˆåæŒ‡é’ˆï¼Œå¸¸ç”¨çš„åŒæŒ‡é’ˆæŠ€å·§ä¹‹ä¸€ï¼šå¿«æ…¢æŒ‡é’ˆã€å…ˆåæŒ‡é’ˆã€æ»‘åŠ¨çª—å£ã€‚ 1234567891011121314151617181920class Solution &#123; public ListNode removeNthFromEnd(ListNode head, int n) &#123; if(head == null) return null; //å¯èƒ½ä¼šæŠŠå¤´ç»“ç‚¹ç»™åˆ äº†ï¼Œæ‰€ä»¥å¯ä»¥å»ºä¸ªå“‘å·´èŠ‚ç‚¹ ListNode dummy = new ListNode(-1); dummy.next = head; ListNode front = dummy; ListNode back = dummy; for(int i = 1;i &lt;= n;i++)&#123; front = front.next; &#125; while(front.next != null)&#123; front = front.next; back = back.next; &#125; back.next = back.next.next; return dummy.next; &#125;&#125; åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨è¿™ä¸ªè²Œä¼¼æ²¡ä»€ä¹ˆéš¾åº¦ï¼Œç¨å¾®æ³¨æ„ä¸€ç‚¹ç»†èŠ‚å°±è¡Œäº† è¿­ä»£ 123456789101112131415161718192021class Solution &#123; public ListNode mergeTwoLists(ListNode l1, ListNode l2) &#123; ListNode res = new ListNode(-1); ListNode dummy = res; while(l1 != null &amp;&amp; l2 != null)&#123; if(l1.val &gt; l2.val)&#123; res.next = new ListNode(l2.val); l2 = l2.next; &#125; else&#123; res.next = new ListNode(l1.val); l1 = l1.next; &#125; res = res.next; &#125; if(l1 == null) res.next = l2; else res.next = l1; return dummy.next; &#125;&#125; é€’å½’ 12345678910111213141516class Solution &#123; public ListNode mergeTwoLists(ListNode l1, ListNode l2) &#123; if (l1 == null) &#123; return l2; &#125; if (l2 == null) &#123; return l1; &#125; if (l1.val &lt; l2.val) &#123; l1.next = mergeTwoLists(l1.next, l2); return l1; &#125; l2.next = mergeTwoLists(l1, l2.next); return l2; &#125;&#125; åˆå¹¶ K ä¸ªæ’åºé“¾è¡¨ ä¼˜å…ˆçº§é˜Ÿåˆ— 1234567891011121314151617181920class Solution &#123; // æ–¹æ³•ä¸€ï¼šç›´æ¥ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ— public ListNode mergeKLists(ListNode[] lists) &#123; PriorityQueue&lt;ListNode&gt; priorityQueue = new PriorityQueue((Comparator&lt;ListNode&gt;) (o1, o2) -&gt; o1.val - o2.val); ListNode dummy = new ListNode(-1); ListNode cur = dummy; if(lists.length == 0) return null; for(ListNode list : lists)&#123; if(list == null) continue; priorityQueue.add(list); &#125; while(!priorityQueue.isEmpty())&#123; ListNode min = priorityQueue.poll(); cur.next = min; if(min.next != null) priorityQueue.add(min.next); cur = cur.next; &#125; return dummy.next; &#125;&#125; å½’å¹¶ 123456789101112131415161718192021222324252627282930313233343536class Solution &#123; /** * æ–¹æ³•äºŒ å½’å¹¶æ’åº * è¦æ³¨æ„è·Ÿæ•°ç»„çš„åŒºåˆ« * æ•°ç»„å¯ä»¥ç›´æ¥é€šè¿‡ä¸‹æ ‡ç´¢å¼•ï¼Œæ‰€ä»¥åœ¨å½’å¹¶æ—¶æ— éœ€è¿”å›å€¼ï¼Œä½†é“¾è¡¨å¿…é¡»åœ¨æ¯æ¬¡å½’å¹¶æ—¶æä¾›é“¾è¡¨å¤´ç»“ç‚¹ï¼Œå¦åˆ™æ— æ³•å½’å¹¶ * @param lists * @return */ public ListNode mergeKLists(ListNode[] lists) &#123; if(lists.length == 0) return null; return merge(lists,0,lists.length-1); &#125; private ListNode merge(ListNode[] lists, int left, int right) &#123; if(left == right) return lists[left]; int mid = left + (right - left)/2; ListNode l1 = merge(lists,left,mid); ListNode l2 = merge(lists,mid+1,right); return mergeTwoLists(l1,l2); &#125; public ListNode mergeTwoLists(ListNode l1, ListNode l2) &#123; if (l1 == null) &#123; return l2; &#125; if (l2 == null) &#123; return l1; &#125; if (l1.val &lt; l2.val) &#123; l1.next = mergeTwoLists(l1.next, l2); return l1; &#125; l2.next = mergeTwoLists(l1, l2.next); return l2; &#125;&#125; æš´åŠ›æ³• 123456789101112131415161718192021222324class Solution &#123; public ListNode mergeKLists(ListNode[] lists) &#123; if(lists.length == 0) return null; for(int i = 1;i &lt; lists.length;i++)&#123; lists[i] = mergeTwoLists(lists[i],lists[i-1]); &#125; return lists[lists.length-1]; &#125; public ListNode mergeTwoLists(ListNode l1, ListNode l2) &#123; if (l1 == null) &#123; return l2; &#125; if (l2 == null) &#123; return l1; &#125; if (l1.val &lt; l2.val) &#123; l1.next = mergeTwoLists(l1.next, l2); return l1; &#125; l2.next = mergeTwoLists(l1, l2.next); return l2; &#125;&#125; ç¯å½¢é“¾è¡¨ Seté›†åˆå­˜å‚¨ 123456789101112131415public class Solution &#123; //ç”¨ Set æ¥å­˜å‚¨ï¼Œå¦‚æœå‡ºç°äº†ï¼Œåˆ™è¯´æ˜æœ‰ç¯ï¼Œå¦åˆ™å°±æ— ç¯ public boolean hasCycle(ListNode head) &#123; HashSet&lt;ListNode&gt; set = new HashSet&lt;&gt;(); while(head != null)&#123; if(set.add(head))&#123; head = head.next; &#125; else &#123; return true; &#125; &#125; return false; &#125;&#125; å¿«æ…¢æŒ‡é’ˆ 1234567891011121314public class Solution &#123; //ç”¨ å¿«æ…¢æŒ‡é’ˆ public boolean hasCycle(ListNode head) &#123; if (head == null || head.next == null) return false; ListNode slow = head; ListNode fast = head.next; while (fast != null &amp;&amp; fast.next != null) &#123; if (slow == fast) return true; slow = slow.next; fast = fast.next.next; &#125; return false; &#125;&#125; ç¯å½¢é“¾è¡¨ IIå…¸å‹çš„å¿«æ…¢æŒ‡é’ˆè§£å†³æ­¤é—®é¢˜ èµ·ç‚¹æ˜¯å“‘å·´èŠ‚ç‚¹ 12345678910111213141516171819202122232425public class Solution &#123; public ListNode detectCycle(ListNode head) &#123; if(head == null || head.next == null) return null; // èµ·ç‚¹å¾ˆé‡è¦ï¼Œè¿™ä¸ªè·Ÿç¯å½¢é“¾è¡¨ I ä¸ä¸€æ · // ä¸€å®šè¦æ³¨æ„è¿™ä¸ªç»†èŠ‚ // å› ä¸ºç¬¬äºŒæ¬¡ç›¸é‡å¾— fast å’Œ slow èµ°çš„è·ç¦»ä¸€æ · ListNode slow = head; ListNode fast = head.next; while (true) &#123; if(fast == null || fast.next == null) return null; if (slow == fast) &#123; break; &#125;; slow = slow.next; fast = fast.next.next; &#125; slow = head; fast = fast.next; while(slow != fast)&#123; slow = slow.next; fast = fast.next; &#125; return slow; &#125;&#125; èµ·ç‚¹æ˜¯å¤´ç»“ç‚¹ 123456789101112131415161718192021222324public class Solution &#123; public ListNode detectCycle(ListNode head) &#123; if(head == null) return null; // èµ·ç‚¹å¾ˆé‡è¦ï¼Œè¿™ä¸ªè·Ÿç¯å½¢é“¾è¡¨ I ä¸ä¸€æ · // ä¸€å®šè¦æ³¨æ„è¿™ä¸ªç»†èŠ‚ // å› ä¸ºç¬¬äºŒæ¬¡ç›¸é‡å¾— fast å’Œ slow èµ°çš„è·ç¦»ä¸€æ · ListNode slow = head; ListNode fast = head; while (true) &#123; if(fast == null || fast.next == null) return null; slow = slow.next; fast = fast.next.next; // æ³¨æ„è¿™é‡Œåˆ¤æ–­çš„åœ°æ–¹è·Ÿä¸Šé¢ç•¥æœ‰ä¸åŒ if (slow == fast) &#123; break; &#125;; &#125; slow = head; while(slow != fast)&#123; slow = slow.next; fast = fast.next; &#125; return slow; &#125; æ’åºé“¾è¡¨ã€éš¾ç‚¹å“ˆï¼ã€‘ ä¸ç¬¦åˆç©ºé—´å¤æ‚åº¦ï¼Œç›´æ¥åˆ©ç”¨åˆ—è¡¨ 12345678910111213141516171819class Solution &#123; public ListNode sortList(ListNode head) &#123; List&lt;Integer&gt; arrayList = new ArrayList(); while(head != null)&#123; arrayList.add(head.val); head = head.next; &#125; Collections.sort(arrayList); return ListToLinked(arrayList); &#125; public ListNode ListToLinked(List&lt;Integer&gt; arrayList)&#123; if(arrayList.size() == 0) return null; ListNode node = new ListNode(arrayList.get(0)); // æ³¨æ„è¿™ä¸ª arrayList.subList()çš„è¿”å›å€¼æ˜¯ List // å¹¶ä¸”æ–¹æ³•ä¸­çš„å‚æ•°æ˜¯[fromIndex,toIndex)ï¼Œå·¦é—­å³å¼€ã€‚ node.next = ListToLinked(arrayList.subList(1,arrayList.size())); return node; &#125;&#125; å½’å¹¶æ’åºï¼Œå¹¶ä¸”åœ¨åˆå¹¶æ—¶é‡‡ç”¨é€’å½’ï¼Œç©ºé—´å¤æ‚åº¦é™ä¸º O(logn)ï¼Œè¿™ä¸ªå°±è·Ÿåˆå¹¶ K ä¸ªæœ‰åºé“¾è¡¨æ˜¯ä¸€æ ·çš„æ€è·¯ï¼Œåªä¸è¿‡è¿™é‡Œå°±ç›¸å½“äº K ä¸ª é“¾è¡¨é•¿åº¦ä¸º 1 çš„é“¾è¡¨è¿›è¡Œå½’å¹¶ï¼Œå¹¶ä¸”è¿˜ä¸èƒ½é€šè¿‡æ•°ç»„ç´¢å¼•åˆ° midï¼Œåªèƒ½æ˜¯é€šè¿‡å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ° midã€‚ 12345678910111213141516171819202122232425262728293031323334353637/** * Definition for singly-linked list. * public class ListNode &#123; * int val; * ListNode next; * ListNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public ListNode sortList(ListNode head) &#123; if (head == null || head.next == null) return head; ListNode fast = head.next, slow = head; while (fast != null &amp;&amp; fast.next != null) &#123; slow = slow.next; fast = fast.next.next; &#125; ListNode tmp = slow.next; slow.next = null; ListNode left = sortList(head); ListNode right = sortList(tmp); ListNode h = new ListNode(0); ListNode res = h; while (left != null &amp;&amp; right != null) &#123; if (left.val &lt; right.val) &#123; h.next = left; left = left.next; &#125; else &#123; h.next = right; right = right.next; &#125; h = h.next; &#125; h.next = left != null ? left : right; return res.next; &#125;&#125; å½’å¹¶æ’åºï¼Œåˆå¹¶æ—¶ä¸é‡‡ç”¨é€’å½’ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºå¸¸æ•° è¿˜æœªç ”è¯»ï¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354class Solution &#123; public ListNode sortList(ListNode head) &#123; ListNode h, h1, h2, pre, res; h = head; int length = 0, intv = 1; while (h != null) &#123; h = h.next; length++; &#125; res = new ListNode(0); res.next = head; while (intv &lt; length) &#123; pre = res; h = res.next; while (h != null) &#123; int i = intv; h1 = h; while (i &gt; 0 &amp;&amp; h != null) &#123; h = h.next; i--; &#125; if (i &gt; 0) break; i = intv; h2 = h; while (i &gt; 0 &amp;&amp; h != null) &#123; h = h.next; i--; &#125; int c1 = intv, c2 = intv - i; while (c1 &gt; 0 &amp;&amp; c2 &gt; 0) &#123; if (h1.val &lt; h2.val) &#123; pre.next = h1; h1 = h1.next; c1--; &#125; else &#123; pre.next = h2; h2 = h2.next; c2--; &#125; pre = pre.next; &#125; pre.next = c1 == 0 ? h2 : h1; while (c1 &gt; 0 || c2 &gt; 0) &#123; pre = pre.next; c1--; c2--; &#125; pre.next = h; &#125; intv *= 2; &#125; return res.next; &#125;&#125; ç›¸äº¤é“¾è¡¨èµ°ç›¸åŒè·ç¦»çš„è·¯ï¼Œå¿…å®šåœ¨ç›¸äº¤ç‚¹ç›¸é‡ã€‚ 123456789101112public class Solution &#123; public ListNode getIntersectionNode(ListNode headA, ListNode headB) &#123; if(headA == null || headB == null) return null; ListNode p1 = headA; ListNode p2 = headB; while(p1 != p2)&#123; p1 = (p1 == null ? headB : p1.next); p2 = (p2 == null ? headA : p2.next); &#125; return p1; &#125;&#125; åè½¬é“¾è¡¨ é€’å½’(è¿™ 5 æ­¥å¾—ç‰¢è®°äºå¿ƒ) 123456789class Solution &#123; public ListNode reverseList(ListNode head) &#123; if(head == null || head.next == null) return head; ListNode p = reverseList(head.next); head.next.next = head; head.next = null; return p; &#125;&#125; éé€’å½’(æ¯ä¸€æ­¥å°±åªæ˜¯æŠŠä¸‹ä¸€æ¬¡è¯¥åè½¬çš„èŠ‚ç‚¹è®°ä½å³å¯ï¼Œç„¶åæŠŠcurr.nextæ¢æˆpreå°±è¡Œäº†) 12345678910111213141516class Solution &#123; public ListNode reverseList(ListNode head) &#123; // åˆ©ç”¨ä¸‰ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«å­˜å‚¨éå†çš„è¯¥èŠ‚ç‚¹ï¼Œå‰èŠ‚ç‚¹å’ŒåèŠ‚ç‚¹ ListNode pre = null; ListNode cur = head; while(cur != null)&#123; // åªéœ€è¦ä¿å­˜ä¸‹ä¸€æ¬¡åè½¬çš„èŠ‚ç‚¹å°±è¡Œäº† ListNode nextTemp = cur.next; cur.next = pre; // ä¸‹ä¸€æ¬¡åè½¬ pre = cur; cur = nextTemp; &#125; return pre; &#125;&#125; å›æ–‡é“¾è¡¨ å…ˆåˆ©ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°ä¸­ç‚¹ï¼Œç„¶ååè½¬å‰åŠéƒ¨åˆ†ï¼Œç„¶åæ¯”å¯¹å³å¯ 123456789101112131415161718192021222324252627282930313233class Solution &#123; // åè½¬å‰åŠéƒ¨åˆ† public boolean isPalindrome(ListNode head) &#123; ListNode slow = head; ListNode fast = head; while(fast != null &amp;&amp; fast.next != null)&#123; slow = slow.next; fast = fast.next.next; &#125; // 1 2 3 4 æ­¤æ—¶ fast ä¼šä¸º null ï¼Œslow ä¼šä¸º 3 // 1 2 3 4 5 æ­¤æ—¶ fast.next ä¼šä¸º nullï¼Œslow ä¼šä¸º 3 // ä¹Ÿå°±æ˜¯ ä¸è®ºæ˜¯å¥‡æ•°è¿˜æ˜¯å¶æ•°ï¼Œslow éƒ½ä¼šæ˜¯ååŠéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªæ•° // åè½¬å‰åŠéƒ¨åˆ† ListNode pre = null; ListNode cur = head; while(cur != slow)&#123; ListNode nextTemp = cur.next; cur.next = pre; pre = cur; cur = nextTemp; &#125; if(fast != null)&#123; slow = slow.next; &#125; while(pre != null)&#123; if(pre.val != slow.val) return false; pre = pre.next; slow = slow.next; &#125; return true; &#125;&#125; å¯ä»¥ä¼˜åŒ–ä¸€ä¸‹ï¼Œç›´æ¥åœ¨å¿«æ…¢æŒ‡é’ˆæ‰¾ä¸­ç‚¹çš„åŒæ—¶è¿›è¡Œç¿»è½¬ 1234567891011121314151617181920212223242526class Solution &#123; // åè½¬å‰åŠéƒ¨åˆ† public boolean isPalindrome(ListNode head) &#123; if(head == null) return true; ListNode fast = head; ListNode cur = head, pre = null; while(fast != null &amp;&amp; fast.next != null) &#123; // è¿™é‡Œçš„ cur æŒ‡é’ˆå°±æ˜¯ slow æŒ‡é’ˆï¼Œå……å½“äº†ä¸¤ä¸ªä½œç”¨ // ä¸€ä¸ªæ˜¯å¿«æ…¢æŒ‡é’ˆæ‰¾ä¸­ç‚¹ï¼Œä¸€ä¸ªæ˜¯åè½¬é“¾è¡¨ï¼Œå› ä¸º cur ä¹Ÿæ˜¯æ¯è½®å¾ªç¯èµ°ä¸€æ­¥ fast = fast.next.next; ListNode nextTemp = cur.next; cur.next = pre; pre = cur; cur = nextTemp; &#125; if(fast != null) &#123; cur = cur.next; &#125; while(pre != null) &#123; if(pre.val != cur.val) return false; pre = pre.next; cur = cur.next; &#125; return true; &#125;&#125; é“¾è¡¨è½¬åˆ—è¡¨ï¼Œç„¶åæ¯”å¯¹ 123456789101112131415161718192021class Solution &#123; public boolean isPalindrome(ListNode head) &#123; List&lt;Integer&gt; vals = new ArrayList&lt;&gt;(); ListNode currentNode = head; while (currentNode != null) &#123; vals.add(currentNode.val); currentNode = currentNode.next; &#125; int front = 0; int back = vals.size() - 1; while (front &lt; back) &#123; if (!vals.get(front).equals(vals.get(back))) &#123; return false; &#125; front++; back--; &#125; return true; &#125;&#125; (å‰‘æŒ‡offer) åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ æ‰¾ä¸€ä¸ªç‰ºç‰²è€… 12345678910111213141516171819202122class Solution &#123; public ListNode deleteNode(ListNode head, int val) &#123; // è¿™ä¸ªæ–¹æ³•å«æ‰¾ä¸€ä¸ªç‰ºç‰²è€… ListNode dummy = new ListNode(-1); dummy.next = head; ListNode cur = head; ListNode pre = dummy; while(cur != null &amp;&amp; cur.next != null)&#123; if(cur.val == val)&#123; cur.val = cur.next.val; cur.next = cur.next.next; return dummy.next; &#125; pre = cur; cur = cur.next; &#125; if(cur.next == null)&#123; pre.next = null; &#125; return dummy.next; &#125;&#125; ç›´æ¥åˆ¤æ–­ä¸‹ä¸€ä¸ªæ˜¯ä¸æ˜¯ 123456789101112131415class Solution &#123; public ListNode deleteNode(ListNode head, int val) &#123; ListNode dummy = new ListNode(-1); ListNode pre = dummy; dummy.next = head; while(pre.next != null)&#123; if(pre.next.val == val)&#123; pre.next = pre.next.next; return dummy.next; &#125; pre = pre.next; &#125; return dummy.next; &#125;&#125; é“¾è¡¨ä¸­çš„å€’æ•°ç¬¬Kä¸ªèŠ‚ç‚¹123456789101112131415class Solution &#123; public ListNode getKthFromEnd(ListNode head, int k) &#123; //ä½¿ç”¨å‰åæŒ‡é’ˆ ListNode back = head; ListNode front = head; for(int i = 0;i &lt; k;i++)&#123; front = front.next; &#125; while(front != null)&#123; back = back.next; front = front.next; &#125; return back; &#125;&#125; å¤åˆ¶å¸¦éšå³æŒ‡é’ˆçš„é“¾è¡¨ã€éš¾ç‚¹å“ˆã€‘ HashMap å¤åˆ¶ 1234567891011121314151617181920212223242526272829303132/*// Definition for a Node.class Node &#123; int val; Node next; Node random; public Node(int val) &#123; this.val = val; this.next = null; this.random = null; &#125;&#125;*/class Solution &#123; public Node copyRandomList(Node head) &#123; if (head == null) return null; Map&lt;Node, Node&gt; lookup = new HashMap&lt;&gt;(); Node node = head; while (node != null)&#123; lookup.put(node, new Node(node.val, null, null)); node = node.next; &#125; node = head; while (node != null)&#123; lookup.get(node).next = lookup.get(node.next); lookup.get(node).random = lookup.get(node.random); node = node.next; &#125; return lookup.get(head); &#125;&#125; O(1) ç©ºé—´å¤æ‚åº¦ 123456789101112131415161718192021222324252627282930313233343536373839class Solution &#123; public Node copyRandomList(Node head) &#123; if(head == null) return null; Node cur = head; // å¤åˆ¶ while(cur != null)&#123; Node tmp = cur.next; cur.next = new Node(cur.val,null,null); cur.next.next = tmp; cur = tmp; &#125; // ç½®éšæœºæŒ‡é’ˆ cur = head; while(cur != null)&#123; // æ˜“é”™ç‚¹ï¼Œåˆ«å¿˜äº†åˆ¤æ–­ if(cur.random != null) cur.next.random = cur.random.next; cur = cur.next.next; &#125; // æ‹†åˆ† cur = head; Node copy_head = head.next; Node copy_cur = copy_head; while(copy_cur.next != null)&#123; cur.next = cur.next.next; cur = cur.next; // æ³¨æ„å“¦ï¼Œè¿™é‡Œwhileå¾ªç¯å¿…é¡»æ˜¯ copy_cur.next != null // åŸå› æ˜¯ä¸‹é¢è¿™è¡Œä»£ç ï¼Œå¦‚æœæ˜¯ copy_cur != nullï¼Œé‚£ä¸‹é¢å°±ä¼šç©ºæŒ‡é’ˆå¼‚å¸¸ copy_cur.next = copy_cur.next.next; copy_cur = copy_cur.next; &#125; //åˆ«å¿˜äº†ç»™ cur æœ€å åŠ  null cur.next = null; return copy_head; &#125;&#125;]]></content>
  </entry>
  <entry>
    <title><![CDATA[é›¶ç¢çŸ¥è¯†ç‚¹æ€»ç»“]]></title>
    <url>%2F2020%2F02%2F07%2F%E9%9B%B6%E7%A2%8E%E7%9F%A5%E8%AF%86%E7%82%B9.html</url>
    <content type="text"><![CDATA[é™æ€æ–¹æ³• &amp; éé™æ€æ–¹æ³•çš„åŒºåˆ« æœ¬è´¨åŒºåˆ«ï¼šé™æ€æ–¹æ³•ä¸éé™æ€æ–¹æ³•çš„æœ¬è´¨åŒºåˆ«ï¼šé™æ€æ–¹æ³•åœ¨ç¨‹åºåˆå§‹åŒ–åä¼šä¸€ç›´è´®å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼Œéé™æ€æ–¹æ³•åªåœ¨è¯¥ç±»åˆå§‹åŒ–åè´®å­˜åœ¨å†…å­˜ä¸­ï¼Œå½“è¯¥ç±»è°ƒç”¨å®Œæ¯•åä¼šè¢«åƒåœ¾å›æ”¶å™¨æ”¶é›†é‡Šæ”¾ã€‚ è°ƒç”¨æ–¹å¼åŒºåˆ«ï¼šåœ¨å¤–éƒ¨è°ƒç”¨é™æ€æ–¹æ³•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨â€ç±»å.æ–¹æ³•åâ€çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨â€å¯¹è±¡å.æ–¹æ³•åâ€çš„æ–¹å¼ã€‚è€Œå®ä¾‹æ–¹æ³•åªæœ‰åé¢è¿™ç§æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨é™æ€æ–¹æ³•å¯ä»¥æ— éœ€åˆ›å»ºå¯¹è±¡ã€‚ è®¿é—®é™åˆ¶ä¸åŒï¼šé™æ€æ–¹æ³•åœ¨è®¿é—®æœ¬ç±»çš„æˆå‘˜æ—¶ï¼Œåªå…è®¸è®¿é—®é™æ€æˆå‘˜ï¼ˆå³é™æ€æˆå‘˜å˜é‡å’Œé™æ€æ–¹æ³•ï¼‰ï¼Œè€Œä¸å…è®¸è®¿é—®å®ä¾‹æˆå‘˜å˜é‡å’Œå®ä¾‹æ–¹æ³•ï¼›å®ä¾‹æ–¹æ³•åˆ™æ— æ­¤é™åˆ¶ã€‚å¦‚æœæƒ³è¦åœ¨é™æ€æ–¹æ³•ä¸­è®¿é—®æœ¬ç±»çš„éé™æ€æ–¹æ³•ï¼Œåˆ™éœ€è¦å…ˆå®ä¾‹åŒ–ç±»ï¼Œå†å®ä¾‹åŒ–ç±».å®ä¾‹æ–¹æ³•ã€‚ ä¹‹æ‰€ä»¥ä¸å…è®¸é™æ€æ–¹æ³•ç›´æ¥è®¿é—®å®ä¾‹æˆå‘˜å˜é‡ï¼Œæ˜¯å› ä¸ºå®ä¾‹æˆå‘˜å˜é‡æ˜¯å±äºæŸä¸ªå¯¹è±¡çš„ï¼Œè€Œé™æ€æ–¹æ³•åœ¨æ‰§è¡Œæ—¶ï¼Œå¹¶ä¸ä¸€å®šå­˜åœ¨å¯¹è±¡ã€‚åŒæ ·ï¼Œå› ä¸ºå®ä¾‹æ–¹æ³•å¯ä»¥è®¿é—®å®ä¾‹æˆå‘˜å˜é‡ï¼Œå¦‚æœå…è®¸é™æ€æ–¹æ³•è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼Œå°†é—´æ¥åœ°å…è®¸å®ƒä½¿ç”¨å®ä¾‹æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¸èƒ½è°ƒç”¨å®ä¾‹æ–¹æ³•ã€‚åŸºäºåŒæ ·çš„é“ç†ï¼Œé™æ€æ–¹æ³•ä¸­ä¹Ÿä¸èƒ½ä½¿ç”¨å…³é”®å­—thisã€‚ å£°æ˜æ–¹å¼ä¸åŒï¼šé™æ€æ–¹æ³•å£°æ˜å¿…é¡»æœ‰staticï¼Œè°ƒç”¨æ—¶ä½¿ç”¨ç±»å+.+é™æ€æ–¹æ³•åçš„æ–¹å¼ã€‚éé™æ€æ–¹æ³•ä¸èƒ½ä½¿ç”¨staticå…³é”®å­—ï¼Œè°ƒç”¨æ—¶éœ€åˆå§‹åŒ–è¯¥æ–¹æ³•æ‰€å±ç±»ã€‚ é›¶æ‹·è´ https://www.jianshu.com/p/275602182f39 https://blog.csdn.net/CringKong/article/details/80274148 ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å‡å°‘äº†æ‹·è´æ¬¡æ•°ï¼Œç›´æ¥ä½¿ç”¨ DMAï¼ˆDirect Memory Accessï¼Œç›´æ¥å†…å­˜å­˜å–ï¼‰ï¼Œå¹¶ä¸”å‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ï¼Œæ‰€è°“çš„é›¶æ‹·è´ï¼Œæ„æ€åº”è¯¥æ˜¯æŒ‡ä¸éœ€è¦ CPU å‚ä¸æ‹·è´å°±èƒ½å®Œæˆæ•°æ®çš„æ‹·è´è¿‡ç¨‹ã€‚ Tip: kafkaä¹‹æ‰€ä»¥è¿™ä¹ˆå¿«ï¼Œå°±æ˜¯ç”¨äº†é›¶æ‹·è´æŠ€æœ¯ ä¼ ç»Ÿçš„è¯»å†™(è¿™é‡Œå‡è®¾æ˜¯å°†æ–‡ä»¶ä¸­çš„æ•°æ®è¯»å–åˆ°ç½‘ç»œä¸Š)ï¼š é¦–å…ˆæ˜¯ä»ç£ç›˜é€šè¿‡ DMA åŠ è½½åˆ°å†…å­˜ï¼Œç¬¬ä¸€æ¬¡æ‹·è´ï¼Œç„¶åå†…å­˜å°†å…¶æ”¾åˆ°å†…æ ¸ç¼“å†²åŒºï¼ŒåŒæ—¶å®Œæˆäº†ä¸€æ¬¡ä» ç”¨æˆ·æ€åˆ° å†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼› ç„¶åæ˜¯å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°ç”¨æˆ·ç¼“å­˜åŒºï¼Œç¬¬äºŒæ¬¡æ‹·è´ï¼ŒåŒæ—¶åˆå°†å†…æ ¸æ€åˆ‡å›åˆ°ç”¨æˆ·æ€ï¼› ç„¶åæ˜¯ç”¨æˆ·ç¼“å†²åŒºæ‹·è´è‡³ Socket ç¼“å†²åŒºï¼Œç¬¬ä¸‰æ¬¡æ‹·è´ï¼ŒåŒæ—¶å°†ç”¨æˆ·æ€åˆ‡å›å†…æ ¸æ€ï¼› ç„¶å Socket ç¼“å†²åŒºé€šè¿‡ DMA å°†æ•°æ®æ‹·è´è‡³ç½‘ç»œå¼•æ“ï¼Œç„¶åç»“æŸ wirteï¼Œæ­¤æ—¶ç¬¬å››æ¬¡æ‹·è´ï¼Œå¹¶æœ€ç»ˆå°†å†…æ ¸æ€åˆ‡å›ç”¨æˆ·æ€ã€‚ å†ç»äº† 4 æ¬¡æ‹·è´ï¼Œ4 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå…¶ä¸­åŒ…æ‹¬2æ¬¡éœ€è¦ CPU å‚ä¸å·¥ä½œ(ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥)ã€‚ mmap å¯¹å†…æ ¸ç¼“å†²åŒºå’Œç”¨æˆ·ç¼“å†²åŒºåšåœ°å€æ˜ å°„ï¼Œè¿™æ ·çš„è¯ä¸Šè¿°ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥å¯ä»¥ç›´æ¥å½’ä¸ºä¸€æ­¥ï¼Œä¹Ÿå°±æ˜¯å‡å°‘äº†ä¸€æ¬¡æ‹·è´ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ã€‚ sendfile è¿™æ˜¯çœŸæ­£çš„é›¶æ‹·è´æŠ€æœ¯ï¼Œ Java ä¸­çš„ NIO å°±æ˜¯é€šè¿‡è¿™ä¸ªåº•å±‚å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒæ­¥ä¸­ç›´æ¥å°†å†…æ ¸ç¼“å†²åŒºé€šè¿‡ DMA å‘é€è‡³ç½‘ç»œå¼•æ“ï¼Œå°†å†…æ ¸æ€åˆ‡æ¢ä¸ºç”¨æˆ·æ€ï¼Œæ­¤æ—¶å…¨ç¨‹ä¸éœ€è¦ CPU å‚ä¸å·¥ä½œï¼Œä¸”æ‹·è´æ¬¡æ•°é™ä¸º2æ¬¡ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ä¹ŸåŒæ—¶é™ä¸º2æ¬¡ã€‚ Spring AOPåŸç†Spring MVC è¿‡ç¨‹Spring IocSpring BeanSpring Bean çš„ç”Ÿå‘½å‘¨æœŸæŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«æŠ½è±¡ç±»ï¼šä¸€ä¸ªåŒ…å«æŠ½è±¡æ–¹æ³•çš„ç±»ï¼ŒæŠ½è±¡æ–¹æ³•æ˜¯æŒ‡ç”¨ abstract ä¿®é¥°ï¼Œæ²¡æœ‰å®ç°çš„æ–¹æ³•ï¼› æ¥å£ï¼šä¸€ä¸ªæ–¹æ³•çš„é›†åˆï¼› åŒºåˆ«ï¼š æŠ½è±¡ç±»å…·æœ‰ç±»çš„ç‰¹æ€§ï¼Œå¯ä»¥ publicã€privateã€protected ä¿®é¥°ç±»ï¼Œè€Œæ¥å£åªèƒ½ä½¿ç”¨ publicï¼Œä¸”æŠ½è±¡ç±»å…·æœ‰æ„é€ å‡½æ•°ã€æˆå‘˜å˜é‡ï¼Œæ¥å£éƒ½ä¸å…·å¤‡ï¼› æŠ½è±¡ç±»å’Œæ¥å£éƒ½ä¸èƒ½å®ä¾‹åŒ–ï¼Œä½†æ˜¯æŠ½è±¡ç±»ä¸­å¯ä»¥æœ‰å®ç°å¥½çš„æ–¹æ³•ï¼Œå¯ä»¥è¢«ç»§æ‰¿ï¼Œç»§æ‰¿è€…å¯ä»¥é€‰æ‹©å®ç°éƒ¨åˆ†æŠ½è±¡ç±»çš„æ–¹æ³•ï¼Œç„¶åäº¤ç”±å­ç±»ç»§ç»­å»å®ŒæˆæŠ½è±¡ç±»ä¸­æœªå®Œæˆçš„æŠ½è±¡æ–¹æ³•çš„é‡å†™ï¼Œä½†æ˜¯æ¥å£å¿…é¡»æŠŠæ‰€æœ‰å®šä¹‰çš„æ–¹æ³•å…¨éƒ¨å®ç°ï¼› æŠ½è±¡ç±»å¯ä»¥è¢«ç»§æ‰¿ï¼Œæ‰€ä»¥å¿…é¡»æ»¡è¶³å•ç»§æ‰¿ï¼Œä½†æ˜¯æ¥å£ä¸ä¸€æ ·ï¼Œæ¥å£æ²¡æœ‰é™åˆ¶ã€‚ Javaä¸­publicï¼Œprotectedï¼Œprivateä»¥åŠé»˜è®¤çš„è®¿é—®æƒé™ä½œç”¨åŸŸ å†…éƒ¨ç±» https://www.cnblogs.com/dolphin0520/p/3811445.html å†™çš„çœŸçš„å¤ªå¥½äº†â€¦ å†…éƒ¨ç±»åŸºç¡€å†…éƒ¨ç±»å°±æ˜¯ä¸€ä¸ªç±»å¯ä»¥æ”¾åˆ°å¦å¤–ä¸€ä¸ªç±»æˆ–è€…æ–¹æ³•é‡Œé¢ï¼Œæ€»å…±åˆ†ä¸ºå››ç§æƒ…å†µï¼š æˆå‘˜å†…éƒ¨ç±»ï¼›ã€Œæ”¾åœ¨ç±»ä¸­ã€ å±€éƒ¨å†…éƒ¨ç±»ï¼›ã€Œæ”¾åœ¨æ–¹æ³•ä¸­ã€ åŒ¿åå†…éƒ¨ç±»ï¼› é™æ€å†…éƒ¨ç±»ã€‚ æˆå‘˜å†…éƒ¨ç±»123456789101112131415161718192021222324252627282930313233343536public class InnerClassDemo &#123; public int age = 18; public int sex = 1; // å¤–éƒ¨ç±»åªèƒ½æ˜¯ public or default // è·Ÿå¤–éƒ¨ç±»ä¸ä¸€æ ·ï¼Œè¿™é‡Œå¯ä»¥æœ‰privateã€publicã€protectedã€ä¸åŠ (default) class Inner &#123; public int age = 20; // å½“å†…éƒ¨ç±»çš„å˜é‡å’Œå¤–éƒ¨ç±»å˜é‡åå­—ä¸€è‡´ï¼Œæ³¨æ„å¯¹è±¡ï¼Œå¦‚æœè¦ä½¿ç”¨å¤–éƒ¨å¯¹è±¡ // åˆ™æ˜¯ å¤–éƒ¨ç±»å.this public int inner_sex = 1; public void showAge() &#123; int age = 25; System.out.println(sex); System.out.println(age);//25 System.out.println(this.age);//20 System.out.println(InnerClassDemo.this.age);//18 å†…éƒ¨ç±»è®¿é—®å¤–éƒ¨ç±»çš„å¯¹è±¡ï¼Œä½¿ç”¨ ç±»å.this &#125; &#125; // è™½ç„¶æˆå‘˜å†…éƒ¨ç±»å¯ä»¥æ— æ¡ä»¶åœ°è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜ï¼Œ // è€Œå¤–éƒ¨ç±»æƒ³è®¿é—®æˆå‘˜å†…éƒ¨ç±»çš„æˆå‘˜å´ä¸æ˜¯è¿™ä¹ˆéšå¿ƒæ‰€æ¬²äº†ã€‚ // åœ¨å¤–éƒ¨ç±»ä¸­å¦‚æœè¦è®¿é—®æˆå‘˜å†…éƒ¨ç±»çš„æˆå‘˜ï¼Œå¿…é¡»å…ˆåˆ›å»ºä¸€ä¸ªæˆå‘˜å†…éƒ¨ç±»çš„å¯¹è±¡ï¼Œå†é€šè¿‡æŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨æ¥è®¿é—®ï¼š public void get_inner_sex()&#123; Inner inner = new Inner(); inner.showAge(); System.out.println(inner.inner_sex); &#125;&#125;class Test &#123; public static void main(String[] args) &#123; // æ³¨æ„å†™æ³•ï¼šnew ç±»å().new å†…éƒ¨ç±»å() InnerClassDemo.Inner innerClassDemo = new InnerClassDemo().new Inner(); innerClassDemo.showAge(); &#125;&#125; æˆå‘˜å†…éƒ¨ç±»æœ‰å››ç‚¹éœ€è¦æ³¨æ„ï¼š å†…éƒ¨ç±»å¯ä»¥æ‹¥æœ‰privateè®¿é—®æƒé™ã€protectedè®¿é—®æƒé™ã€publicè®¿é—®æƒé™åŠåŒ…è®¿é—®æƒé™ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœæˆå‘˜å†…éƒ¨ç±»Innerç”¨privateä¿®é¥°ï¼Œåˆ™åªèƒ½åœ¨å¤–éƒ¨ç±»çš„å†…éƒ¨è®¿é—®ï¼Œå¦‚æœç”¨publicä¿®é¥°ï¼Œåˆ™ä»»ä½•åœ°æ–¹éƒ½èƒ½è®¿é—®ï¼›å¦‚æœç”¨protectedä¿®é¥°ï¼Œåˆ™åªèƒ½åœ¨åŒä¸€ä¸ªåŒ…ä¸‹æˆ–è€…ç»§æ‰¿å¤–éƒ¨ç±»çš„æƒ…å†µä¸‹è®¿é—®ï¼›å¦‚æœæ˜¯é»˜è®¤è®¿é—®æƒé™ï¼Œåˆ™åªèƒ½åœ¨åŒä¸€ä¸ªåŒ…ä¸‹è®¿é—®ã€‚è¿™ä¸€ç‚¹å’Œå¤–éƒ¨ç±»æœ‰ä¸€ç‚¹ä¸ä¸€æ ·ï¼Œå¤–éƒ¨ç±»åªèƒ½è¢«publicå’ŒåŒ…è®¿é—®ä¸¤ç§æƒé™ä¿®é¥°ã€‚æˆ‘ä¸ªäººæ˜¯è¿™ä¹ˆç†è§£çš„ï¼Œç”±äºæˆå‘˜å†…éƒ¨ç±»çœ‹èµ·æ¥åƒæ˜¯å¤–éƒ¨ç±»çš„ä¸€ä¸ªæˆå‘˜ï¼Œæ‰€ä»¥å¯ä»¥åƒç±»çš„æˆå‘˜ä¸€æ ·æ‹¥æœ‰å¤šç§æƒé™ä¿®é¥°ã€‚ å½“å†…éƒ¨ç±»å’Œå¤–éƒ¨ç±»æœ‰ç€ä¸€æ ·çš„å˜é‡æ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç”¨ this.å˜é‡å è·å¾—çš„æ˜¯å†…éƒ¨ç±»çš„æˆå‘˜å˜é‡ï¼Œå¦‚æœæƒ³è¦è·å¾—å¤–éƒ¨ç±»çš„æˆå‘˜å˜é‡æˆ–è€…æˆå‘˜æ–¹æ³•éœ€è¦ä½¿ç”¨ å¤–éƒ¨ç±»å.this.å˜é‡å å’Œ å¤–éƒ¨ç±»å.this.æˆå‘˜æ–¹æ³•åï¼› è™½ç„¶æˆå‘˜å†…éƒ¨ç±»å¯ä»¥æ— æ¡ä»¶åœ°è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜ï¼Œè€Œå¤–éƒ¨ç±»æƒ³è®¿é—®æˆå‘˜å†…éƒ¨ç±»çš„æˆå‘˜å´ä¸æ˜¯è¿™ä¹ˆéšå¿ƒæ‰€æ¬²äº†ã€‚åœ¨å¤–éƒ¨ç±»ä¸­å¦‚æœè¦è®¿é—®æˆå‘˜å†…éƒ¨ç±»çš„æˆå‘˜ï¼Œå¿…é¡»å…ˆåˆ›å»ºä¸€ä¸ªæˆå‘˜å†…éƒ¨ç±»çš„å¯¹è±¡ï¼Œå†é€šè¿‡æŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨æ¥è®¿é—®ï¼› æˆå‘˜å†…éƒ¨ç±»æ˜¯ä¾é™„å¤–éƒ¨ç±»è€Œå­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¦åˆ›å»ºæˆå‘˜å†…éƒ¨ç±»çš„å¯¹è±¡ï¼Œå‰ææ˜¯å¿…é¡»å­˜åœ¨ä¸€ä¸ªå¤–éƒ¨ç±»çš„å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯ new ç±»å().new å†…éƒ¨ç±»å()ã€‚ å±€éƒ¨å†…éƒ¨ç±»12345678910111213141516171819202122232425262728293031package å†…éƒ¨ç±»;/** * ä¸æˆå‘˜å†…éƒ¨ç±»åŸºæœ¬ä¸€è‡´ï¼Œä½†æ˜¯æœ‰2å¤„ä¸ä¸€æ · * 1.å±€éƒ¨å†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä¸€ä¸ªä½œç”¨åŸŸé‡Œé¢çš„ç±»ï¼Œå®ƒå’Œæˆå‘˜å†…éƒ¨ç±»çš„åŒºåˆ«åœ¨äºå±€éƒ¨å†…éƒ¨ç±»çš„è®¿é—®ä»…é™äºæ–¹æ³•å†…æˆ–è€…è¯¥ä½œç”¨åŸŸå†…ã€‚ * 2. å†…éƒ¨ç±»æ­¤æ—¶ä¸èƒ½æœ‰ä¿®é¥°ç¬¦ */public class InnerClassDemo2 &#123; public int age = 18; public void example()&#123; int age = 20; // ä¸èƒ½æœ‰ä¿®é¥°ï¼ class Inner2&#123; public int age = 25; public void inner_method()&#123; System.out.println(age); // 25 System.out.println(this.age); // 25 System.out.println(InnerClassDemo2.this.age); //18 &#125; &#125; new Inner2().inner_method(); &#125;&#125;class Test2 &#123; public static void main(String[] args) &#123; InnerClassDemo2 innerClassDemo2 = new InnerClassDemo2(); innerClassDemo2.example(); &#125;&#125; å±€éƒ¨å†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä¸€ä¸ªä½œç”¨åŸŸé‡Œé¢çš„ç±»ï¼Œå®ƒå’Œæˆå‘˜å†…éƒ¨ç±»çš„åŒºåˆ«åœ¨äºå±€éƒ¨å†…éƒ¨ç±»çš„è®¿é—®ä»…é™äºæ–¹æ³•å†…æˆ–è€…è¯¥ä½œç”¨åŸŸå†…ã€‚ æ³¨æ„ï¼Œå±€éƒ¨å†…éƒ¨ç±»å°±åƒæ˜¯æ–¹æ³•é‡Œé¢çš„ä¸€ä¸ªå±€éƒ¨å˜é‡ä¸€æ ·ï¼Œæ˜¯ä¸èƒ½æœ‰publicã€protectedã€privateä»¥åŠstaticä¿®é¥°ç¬¦çš„ã€‚ åŒ¿åå†…éƒ¨ç±»1234567891011121314151617181920212223242526package å†…éƒ¨ç±»;public class InnerClassDemo3 implements Runnable&#123; @Override public void run() &#123; System.out.println("ä¸ä½¿ç”¨å†…éƒ¨ç±»ï¼Œå¾—å…ˆå£°æ˜ä¸€ä¸ªç±»å¹¶å®ç°æ¥å£"); &#125;&#125;class Test3&#123; public static void main(String[] args) &#123; // ä½¿ç”¨å†…éƒ¨ç±»ï¼Œå¯ä»¥åŠ æŒ lambda è¡¨è¾¾å¼ new Thread(() -&gt; System.out.println("å†…éƒ¨ç±»çœŸå¥½ç”¨")).start(); // ä½¿ç”¨å†…éƒ¨ç±»ï¼Œä½†æ˜¯æ²¡ç”¨ lambda è¡¨è¾¾å¼ new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println("å†…éƒ¨ç±»çœŸå¥½ç”¨"); &#125; &#125;).start(); // ä¸ä½¿ç”¨å†…éƒ¨ç±»ï¼Œåˆè‡­åˆé•¿ InnerClassDemo3 innerClassDemo3 = new InnerClassDemo3(); new Thread(innerClassDemo3).start(); &#125;&#125; å¾ˆæ˜æ˜¾ï¼Œå†…éƒ¨ç±» + lambdaè¡¨è¾¾å¼ ä½¿å¾—ä»£ç éå¸¸çš„å¹²å‡€ã€‚ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»èƒ½å¤Ÿåœ¨å®ç°çˆ¶ç±»æˆ–è€…æ¥å£ä¸­çš„æ–¹æ³•æƒ…å†µä¸‹åŒæ—¶äº§ç”Ÿä¸€ä¸ªç›¸åº”çš„å¯¹è±¡ï¼Œä½†æ˜¯å‰ææ˜¯è¿™ä¸ªçˆ¶ç±»æˆ–è€…æ¥å£å¿…é¡»å…ˆå­˜åœ¨æ‰èƒ½è¿™æ ·ä½¿ç”¨ã€‚ å½“ç„¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š åŒ¿åå†…éƒ¨ç±»æ˜¯å”¯ä¸€ä¸€ç§æ²¡æœ‰æ„é€ å™¨çš„ç±»ã€‚æ­£å› ä¸ºå…¶æ²¡æœ‰æ„é€ å™¨ï¼Œæ‰€ä»¥åŒ¿åå†…éƒ¨ç±»çš„ä½¿ç”¨èŒƒå›´éå¸¸æœ‰é™ï¼Œå¤§éƒ¨åˆ†åŒ¿åå†…éƒ¨ç±»ç”¨äºæ¥å£å›è°ƒã€‚åŒ¿åå†…éƒ¨ç±»åœ¨ç¼–è¯‘çš„æ—¶å€™ç”±ç³»ç»Ÿè‡ªåŠ¨èµ·åä¸ºOutter$1.classã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒåŒ¿åå†…éƒ¨ç±»ç”¨äºç»§æ‰¿å…¶ä»–ç±»æˆ–æ˜¯å®ç°æ¥å£ï¼Œå¹¶ä¸éœ€è¦å¢åŠ é¢å¤–çš„æ–¹æ³•ï¼Œåªæ˜¯å¯¹ç»§æ‰¿æ–¹æ³•çš„å®ç°æˆ–æ˜¯é‡å†™ã€‚ é™æ€å†…éƒ¨ç±» é™æ€å†…éƒ¨ç±»ä¹Ÿæ˜¯å®šä¹‰åœ¨å¦ä¸€ä¸ªç±»é‡Œé¢çš„ç±»ï¼Œåªä¸è¿‡åœ¨ç±»çš„å‰é¢å¤šäº†ä¸€ä¸ªå…³é”®å­— staticï¼› é™æ€å†…éƒ¨ç±»æ˜¯ä¸éœ€è¦ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹å¯¹è±¡çš„ï¼Œæ‰€ä»¥åœ¨åˆ«çš„ç±»ä¸­è°ƒç”¨å†…éƒ¨ç±»æ—¶ï¼Œä¸éœ€è¦å…ˆå»è·å–å¤–éƒ¨ç±»çš„å¯¹è±¡ï¼Œè¿™ç‚¹å’Œç±»çš„é™æ€æˆå‘˜å±æ€§æœ‰ç‚¹ç±»ä¼¼ï¼› å¹¶ä¸”å®ƒä¸èƒ½ä½¿ç”¨å¤–éƒ¨ç±»çš„éstaticæˆå‘˜å˜é‡æˆ–è€…æ–¹æ³•ï¼Œè¿™ç‚¹å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºåœ¨æ²¡æœ‰å¤–éƒ¨ç±»çš„å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ›å»ºé™æ€å†…éƒ¨ç±»çš„å¯¹è±¡ï¼Œå¦‚æœå…è®¸è®¿é—®å¤–éƒ¨ç±»çš„éstaticæˆå‘˜å°±ä¼šäº§ç”ŸçŸ›ç›¾ï¼Œå› ä¸ºå¤–éƒ¨ç±»çš„éstaticæˆå‘˜å¿…é¡»ä¾é™„äºå…·ä½“çš„å¯¹è±¡ã€‚ ä¸ºäº†å¯¹æ¯”ç¬¬ä¸€ç§åŒºåˆ«ï¼Œæˆ‘ç›´æ¥åœ¨ç¬¬ä¸€ç§ä»£ç ä¸Šåšäº†éƒ¨åˆ†æ”¹åŠ¨ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041package å†…éƒ¨ç±»;public class InnerClassDemo4 &#123; public int age = 18; public int sex = 1; public static int static_age = 188; // å¤–éƒ¨ç±»åªèƒ½æ˜¯ public or default // è·Ÿå¤–éƒ¨ç±»ä¸ä¸€æ ·ï¼Œè¿™é‡Œå¯ä»¥æœ‰privateã€publicã€protectedã€ä¸åŠ (default) static class Inner &#123; public int age = 20; // å½“å†…éƒ¨ç±»çš„å˜é‡å’Œå¤–éƒ¨ç±»å˜é‡åå­—ä¸€è‡´ï¼Œæ³¨æ„å¯¹è±¡ï¼Œå¦‚æœè¦ä½¿ç”¨å¤–éƒ¨å¯¹è±¡ // åˆ™æ˜¯ å¤–éƒ¨ç±»å.this public int inner_sex = 1; public void showAge() &#123; int age = 25;// System.out.println(sex); // æ­¤æ—¶å°±ä¸èƒ½ä½¿ç”¨äº†ï¼Œå› ä¸ºæ˜¯ é static System.out.println(age);//25 System.out.println(this.age);//20// System.out.println(InnerClassDemo4.this.age);//18 å†…éƒ¨ç±»è®¿é—®å¤–éƒ¨ç±»çš„å¯¹è±¡ï¼Œä½¿ç”¨ ç±»å.this ---&gt;æ­¤æ—¶ä¼šæŠ¥é”™ System.out.println(InnerClassDemo4.static_age); //188 &#125; &#125; // è™½ç„¶æˆå‘˜å†…éƒ¨ç±»å¯ä»¥æ— æ¡ä»¶åœ°è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜ï¼Œ // è€Œå¤–éƒ¨ç±»æƒ³è®¿é—®æˆå‘˜å†…éƒ¨ç±»çš„æˆå‘˜å´ä¸æ˜¯è¿™ä¹ˆéšå¿ƒæ‰€æ¬²äº†ã€‚ // åœ¨å¤–éƒ¨ç±»ä¸­å¦‚æœè¦è®¿é—®æˆå‘˜å†…éƒ¨ç±»çš„æˆå‘˜ï¼Œå¿…é¡»å…ˆåˆ›å»ºä¸€ä¸ªæˆå‘˜å†…éƒ¨ç±»çš„å¯¹è±¡ï¼Œå†é€šè¿‡æŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨æ¥è®¿é—®ï¼š public void get_inner_sex()&#123; Inner inner = new Inner(); inner.showAge(); System.out.println(inner.inner_sex); &#125;&#125;class Test4 &#123; public static void main(String[] args) &#123; // æ³¨æ„å†™æ³•ï¼šnew ç±»å().new å†…éƒ¨ç±»å()// InnerClassDemo4.Inner innerClassDemo = new InnerClassDemo4().new Inner();// æ­¤æ—¶ä¼šæŠ¥é”™ InnerClassDemo4.Inner innerClassDemo = new InnerClassDemo4.Inner(); innerClassDemo.showAge(); &#125;&#125; ä»ä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸¤ä¸ªåœ°æ–¹å’Œç¬¬ä¸€å¤„ä¸ä¸€æ ·ï¼š å†…éƒ¨ç±»ä¸­æ— æ³•è°ƒç”¨å¤–éƒ¨ç±»é static å˜é‡ï¼› å…¶ä»–ç±»è°ƒç”¨å†…éƒ¨ç±»æ—¶ï¼Œæ— éœ€å…ˆå®ä¾‹åŒ–å¤–éƒ¨ç±»äº†ï¼Œå¯ä»¥ç›´æ¥å¤–éƒ¨ç±»å.å†…éƒ¨ç±»å()ã€‚ æ·±å…¥ç†è§£å†…éƒ¨ç±»1.ä¸ºä½•åœ¨æˆå‘˜å†…éƒ¨ç±»ä¸­ï¼Œå†…éƒ¨ç±»å¯ä»¥éšæ„è®¿é—®å¤–éƒ¨ç±»ï¼Ÿ è™½ç„¶æˆ‘ä»¬åœ¨å®šä¹‰çš„å†…éƒ¨ç±»çš„æ„é€ å™¨æ˜¯æ— å‚æ„é€ å™¨ï¼Œç¼–è¯‘å™¨è¿˜æ˜¯ä¼šé»˜è®¤æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°çš„ç±»å‹ä¸ºæŒ‡å‘å¤–éƒ¨ç±»å¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨ï¼Œæ‰€ä»¥æˆå‘˜å†…éƒ¨ç±»ä¸­çš„Outter this&amp;0 æŒ‡é’ˆä¾¿æŒ‡å‘äº†å¤–éƒ¨ç±»å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥åœ¨æˆå‘˜å†…éƒ¨ç±»ä¸­éšæ„è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜ã€‚ä»è¿™é‡Œä¹Ÿé—´æ¥è¯´æ˜äº†æˆå‘˜å†…éƒ¨ç±»æ˜¯ä¾èµ–äºå¤–éƒ¨ç±»çš„ï¼Œå¦‚æœæ²¡æœ‰åˆ›å»ºå¤–éƒ¨ç±»çš„å¯¹è±¡ï¼Œåˆ™æ— æ³•å¯¹Outter this&amp;0å¼•ç”¨è¿›è¡Œåˆå§‹åŒ–èµ‹å€¼ï¼Œä¹Ÿå°±æ— æ³•åˆ›å»ºæˆå‘˜å†…éƒ¨ç±»çš„å¯¹è±¡äº†ã€‚ 2.é™æ€å†…éƒ¨ç±»æœ‰ç‰¹æ®Šçš„åœ°æ–¹å—ï¼Ÿ ä»å‰é¢å¯ä»¥çŸ¥é“ï¼Œé™æ€å†…éƒ¨ç±»æ˜¯ä¸ä¾èµ–äºå¤–éƒ¨ç±»çš„ï¼Œä¹Ÿå°±è¯´å¯ä»¥åœ¨ä¸åˆ›å»ºå¤–éƒ¨ç±»å¯¹è±¡çš„æƒ…å†µä¸‹åˆ›å»ºå†…éƒ¨ç±»çš„å¯¹è±¡ã€‚å¦å¤–ï¼Œé™æ€å†…éƒ¨ç±»æ˜¯ä¸æŒæœ‰æŒ‡å‘å¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨çš„ï¼Œè¿™ä¸ªè¯»è€…å¯ä»¥è‡ªå·±å°è¯•åç¼–è¯‘classæ–‡ä»¶çœ‹ä¸€ä¸‹å°±çŸ¥é“äº†ï¼Œæ˜¯æ²¡æœ‰Outter this&amp;0å¼•ç”¨çš„ã€‚ å†…éƒ¨ç±»çš„ä½¿ç”¨åœºæ™¯ä¸ºä»€ä¹ˆåœ¨Javaä¸­éœ€è¦å†…éƒ¨ç±»ï¼Ÿæ€»ç»“ä¸€ä¸‹ä¸»è¦æœ‰ä»¥ä¸‹å››ç‚¹ï¼š æ¯ä¸ªå†…éƒ¨ç±»éƒ½èƒ½ç‹¬ç«‹çš„ç»§æ‰¿ä¸€ä¸ªæ¥å£çš„å®ç°ï¼Œæ‰€ä»¥æ— è®ºå¤–éƒ¨ç±»æ˜¯å¦å·²ç»ç»§æ‰¿äº†æŸä¸ª(æ¥å£çš„)å®ç°ï¼Œå¯¹äºå†…éƒ¨ç±»éƒ½æ²¡æœ‰å½±å“ï¼Œå†…éƒ¨ç±»ä½¿å¾—å¤šç»§æ‰¿çš„è§£å†³æ–¹æ¡ˆå˜å¾—å®Œæ•´ï¼› æ–¹ä¾¿å°†å­˜åœ¨ä¸€å®šé€»è¾‘å…³ç³»çš„ç±»ç»„ç»‡åœ¨ä¸€èµ·ï¼Œåˆå¯ä»¥å¯¹å¤–ç•Œéšè—ï¼›ã€ŒThreadLocal &amp; ThreadLocalMapã€ æ–¹ä¾¿ç¼–å†™çº¿ç¨‹ä»£ç ã€‚ æœ€åè¡¥å……ä¸€ç‚¹çŸ¥è¯†ï¼šå…³äºæˆå‘˜å†…éƒ¨ç±»çš„ç»§æ‰¿é—®é¢˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå†…éƒ¨ç±»æ˜¯å¾ˆå°‘ç”¨æ¥ä½œä¸ºç»§æ‰¿ç”¨çš„ã€‚ä½†æ˜¯å½“ç”¨æ¥ç»§æ‰¿çš„è¯ï¼Œè¦æ³¨æ„ä¸¤ç‚¹ï¼š 1ï¼‰æˆå‘˜å†…éƒ¨ç±»çš„å¼•ç”¨æ–¹å¼å¿…é¡»ä¸º å¤–éƒ¨ç±»å.å†…éƒ¨ç±»åï¼› 2ï¼‰æ„é€ å™¨ä¸­å¿…é¡»æœ‰æŒ‡å‘å¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶é€šè¿‡è¿™ä¸ªå¼•ç”¨è°ƒç”¨super()ã€‚è¿™æ®µä»£ç æ‘˜è‡ªã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹ 1234567891011121314151617class WithInner &#123; class Inner&#123; &#125;&#125;class InheritInner extends WithInner.Inner &#123; // InheritInner() æ˜¯ä¸èƒ½é€šè¿‡ç¼–è¯‘çš„ï¼Œä¸€å®šè¦åŠ ä¸Šå½¢å‚ InheritInner(WithInner wi) &#123; wi.super(); //å¿…é¡»æœ‰è¿™å¥è°ƒç”¨ &#125; public static void main(String[] args) &#123; WithInner wi = new WithInner(); InheritInner obj = new InheritInner(wi); &#125;&#125; åå°„æœºåˆ¶ åå°„çš„åŸºæœ¬ç”¨æ³•ï¼šhttps://blog.csdn.net/a745233700/article/details/82893076 è·å–ç±»ï¼ˆç¬¬ä¸‰ä¸ªæ–¹æ³•æœ€å¸¸ç”¨ï¼‰ // æ–¹æ³•ä¸€ï¼šé€šè¿‡å®ä¾‹å¯¹è±¡è·å–ï¼Œä¸è¿‡è¯´å®è¯ï¼Œéƒ½èƒ½æ‹¿åˆ°å¯¹è±¡äº†ï¼Œè¿˜è¦ç±»å¯¹è±¡å¹²å˜›..// ä¸è¿‡æœ‰ç§ç”¨é€”ï¼Œå°±æ˜¯æ¯”å¦‚å¯ä»¥è¶Šè¿‡æ³›å‹æ£€æŸ¥ï¼Œæ·»åŠ æ•°æ®// æ¯”å¦‚ä¸€ä¸ªå¯¹è±¡æ˜¯ ArrayList\ï¼Œå¯é€šè¿‡åå°„æ·»åŠ ä¸€ä¸ª Integerçš„æ•°// å› ä¸ºjavaçš„æ³›å‹æ˜¯åœ¨ç¼–è¯‘ä¹‹åæ“¦é™¤çš„â€¦å­˜åœ¨æ¼æ´å“ˆå“ˆå“ˆ// ä¾‹å­è§ï¼š https://blog.csdn.net/sinat_38259539/article/details/71799078 123&gt; InnerClassDemo1 innerClassDemo1 = new InnerClassDemo1();&gt; Class innerClass = innerClassDemo1.getClass();&gt; æ–¹æ³•äºŒï¼šç±»å.classï¼Œè¿™ä¸ªéœ€è¦å¯¼åŒ…â€¦ 12&gt; Class innerClass = InnerClassDemo1.class;&gt; æ–¹æ³•ä¸‰ï¼šæœ€å¸¸ç”¨ï¼Œä½¿ç”¨ç±»åï¼ˆç›¸å¯¹è·¯å¾„ï¼‰ 12&gt; Class innerClass = Class.forName("å†…éƒ¨ç±».InnerClassDemo1");&gt; è·å¾—å®ä¾‹å¯¹è±¡ 1234&gt; Class.forname("").getConstructor(String.class).newinstance() // å¯ç”¨äºç”Ÿæˆæœ‰å‚çš„å¯¹è±¡&gt; &gt; Class.forname("").newInstance() // å¯ç”Ÿæˆæ— å‚çš„å¯¹è±¡&gt; æ‹¿åˆ°å®ä¾‹å±æ€§ã€å®ä¾‹æ–¹æ³• 123456789&gt; // æ‹¿åˆ°å¯¹è±¡çš„å±æ€§&gt; Field field = innerClass.getField("sex");&gt; // å¦‚æœå‚æ•°æ˜¯privateï¼Œå¯ä»¥æ“¦é™¤&gt; // field.setAccessible(true);&gt; int a = (int) field.get(innerClassDemo1);&gt; // æ‹¿åˆ°æ–¹æ³•&gt; Method showAge = innerClass.getMethod("get_inner_sex");&gt; showAge.invoke(innerClassDemo1);&gt; æ‹¿åˆ°é™æ€å˜é‡æˆ–è€…é™æ€å¯¹è±¡ 123456&gt; // æ‹¿åˆ°ç±»çš„å±æ€§&gt; Field ff = innerClass.getField("haha");&gt; int b = (int) ff.get(innerClass);&gt; // æˆ–è€… int b = (int) ff.get(innerClassDemo1);&gt; System.out.println("b: " + b);&gt; åŠ¨æ€ä»£ç† demo æµ‹è¯•ç±» 12345678910111213141516171819202122232425262728package Proxy;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;public class test &#123; public static void main(String[] args) &#123; // ç›¸å½“äºåšç”Ÿæ„çš„è¿‡ç¨‹ï¼Œæ¯”å¦‚æˆ‘å»åŒ»é™¢æ•´å®¹ï¼Œé¦–å…ˆæˆ‘è¦ç¡®ä¿æˆ‘æœ‰é’±(ä¹Ÿå°±æ˜¯æœ‰æ¥å£) Universities person = new Universities(); // å…¶æ¬¡ï¼Œæˆ‘å¾—å»åŒ»é™¢æ‰¾åˆ°ç›¸åº”çš„åŒ»ç”Ÿï¼Œä¹Ÿå°±æ˜¯æŠŠæˆ‘æƒ³ä»£ç†çš„å¯¹è±¡ï¼Œå³æˆ‘æœ¬äººï¼Œå‘ŠçŸ¥ç»™åŒ»ç”Ÿ // åŒ»ç”Ÿè‚¯å®šå¾—æœ‰èƒ½æ•´å®¹çš„æŠ€æœ¯ï¼Œé‚£å°±æ˜¯å¾—ç»§æ‰¿ InvocationHandler InvocationHandler dynamic_person = new Dynamic(person); // è¿›è¡Œäº¤æ˜“çš„è¿‡ç¨‹ï¼Œä¸€æ‰‹äº¤é’±ä¸€æ‰‹äº¤æ¢ï¼ŒåŒ»ç”Ÿæ‹¿åˆ°é’±ï¼Œä¼šè¿”å›ä¸€ä¸ªæœ‰é’±çš„å¤„ç†å¥½çš„ç¾å¥³ï¼Œä¹Ÿå°±æ˜¯ä»£ç†å®Œæˆäº† // è¿™é‡Œå¿…é¡»å¼ºè°ƒä»£ç†è¿”å›çš„æ˜¯ æ¥å£å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯åŒ»ç”Ÿåªä¼šå¯¹æœ‰é’±äººè¿›è¡Œä»£ç†ï¼Œæ²¡é’±çš„ä»£ç†å°±å¤±è´¥äº† // å¦‚æœæœ€å¼€å§‹æˆ‘æ²¡é’±ï¼Œæˆ‘å°±å»æ‰¾åŒ»ç”Ÿäº†ï¼Œé‚£åœ¨è¿™ä¸€æ­¥äº¤æ˜“çš„è¿‡ç¨‹å°±ä¼šå‡ºé”™ï¼Œå› ä¸ºåŒ»ç”Ÿåªä¼šå¤„ç†æœ‰é’±äººï¼Œå¹¶ä¸”è¿”å›æœ‰é’±äººçš„ä»£ç†å¥½çš„å¯¹è±¡ // äº¤æ˜“çš„ä¸‰ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æœ¬äººã€é’±ã€è¿˜æœ‰åŒ»ç”Ÿã€‚æœ¬äººå°±æ˜¯å®ä¾‹å¯¹è±¡ï¼Œé’±å°±æ˜¯å‰æ–‡è¯´çš„æ¥å£ï¼ŒåŒ»ç”Ÿå°±æ˜¯ä¸Šé¢çš„åŠ¨æ€ä»£ç†å¯¹è±¡ // æœ‰é’±äººå¾—åˆ°ä»£ç†åçš„å¯¹è±¡ï¼Œå°±å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº† Person pp = (Person) Proxy.newProxyInstance(person.getClass().getClassLoader(),person.getClass().getInterfaces(),dynamic_person); // pp å°±æ˜¯ è¢«ä»£ç†å¯¹è±¡ è¢« ä»£ç†å¯¹è±¡ ä»£ç†åçš„å¯¹è±¡ pp.dance(); System.out.println("-----------"); pp.play(); &#125;&#125; Person æ¥å£ 1234567package Proxy;public interface Person &#123; void play(); void dance();&#125; Universities å®ç°ç±» 1234567891011121314package Proxy;public class Universities implements Person &#123; @Override public void play() &#123; System.out.println("I like play computer"); &#125; @Override public void dance() &#123; System.out.println("I like dance"); &#125;&#125; åŠ¨æ€ä»£ç†ç±» 1234567891011121314151617181920package Proxy;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;public class Dynamic implements InvocationHandler &#123; // æ•´å®¹çš„äººæ˜¯è°ï¼Œæˆ‘å¾—çŸ¥é“ public Object obj; public Dynamic(Object obj)&#123; this.obj = obj; &#125; // æ•´å®¹çš„è¿‡ç¨‹å°±æ˜¯è¿™çš„ @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println("å¼€å§‹ä¸º" + method.getName() + "æ–¹æ³•è¿›è¡Œä»£ç†"); Object result = method.invoke(obj,args); System.out.println("ç»“æŸ" + method.getName() + "æ–¹æ³•çš„ä»£ç†"); return result; &#125;&#125; Integer å’Œ int çš„åŒºåˆ«åŸºæœ¬å¯¹æ¯” Integeræ˜¯intçš„åŒ…è£…ç±»ï¼›intæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼› Integerå˜é‡å¿…é¡»å®ä¾‹åŒ–åæ‰èƒ½ä½¿ç”¨ï¼›intå˜é‡ä¸éœ€è¦ï¼› Integerå®é™…æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼ŒæŒ‡å‘æ­¤newçš„Integerå¯¹è±¡ï¼›intæ˜¯ç›´æ¥å­˜å‚¨æ•°æ®å€¼ï¼› Integerçš„é»˜è®¤å€¼æ˜¯nullï¼›intçš„é»˜è®¤å€¼æ˜¯0ã€‚ æ·±å…¥å¯¹æ¯” demo ç”±äºIntegerå˜é‡å®é™…ä¸Šæ˜¯å¯¹ä¸€ä¸ªIntegerå¯¹è±¡çš„å¼•ç”¨ï¼Œæ‰€ä»¥ä¸¤ä¸ªé€šè¿‡newç”Ÿæˆçš„Integerå˜é‡æ°¸è¿œæ˜¯ä¸ç›¸ç­‰çš„ï¼ˆå› ä¸ºnewç”Ÿæˆçš„æ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œå…¶å†…å­˜åœ°å€ä¸åŒï¼‰ã€‚ 123Integer i = new Integer(100);Integer j = new Integer(100);System.out.print(i == j); //false Integerå˜é‡å’Œintå˜é‡æ¯”è¾ƒæ—¶ï¼Œåªè¦ä¸¤ä¸ªå˜é‡çš„å€¼æ˜¯å‘ç­‰çš„ï¼Œåˆ™ç»“æœä¸ºtrueï¼ˆå› ä¸ºåŒ…è£…ç±»Integerå’ŒåŸºæœ¬æ•°æ®ç±»å‹intæ¯”è¾ƒæ—¶ï¼Œjavaä¼šè‡ªåŠ¨æ‹†åŒ…è£…ä¸ºintï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒï¼Œå®é™…ä¸Šå°±å˜ä¸ºä¸¤ä¸ªintå˜é‡çš„æ¯”è¾ƒï¼‰ 123Integer i = new Integer(100);int j = 100ï¼›System.out.print(i == j); //true énewç”Ÿæˆçš„Integerå˜é‡å’Œnew Integer()ç”Ÿæˆçš„å˜é‡æ¯”è¾ƒæ—¶ï¼Œç»“æœä¸ºfalseã€‚ï¼ˆå› ä¸ºénewç”Ÿæˆçš„Integerå˜é‡æŒ‡å‘çš„æ˜¯javaå¸¸é‡æ± ä¸­çš„å¯¹è±¡ã€Œæ³¨æ„æ˜¯ -128 ~ 127 æ‰æœ‰ç¼“å­˜ï¼Œå…¶ä»–çš„æ•°ä¹Ÿæ˜¯ä¼šé‡æ–°å¼€è¾Ÿç©ºé—´ã€ï¼Œè€Œnew Integer()ç”Ÿæˆçš„å˜é‡æŒ‡å‘å †ä¸­æ–°å»ºçš„å¯¹è±¡ï¼Œä¸¤è€…åœ¨å†…å­˜ä¸­çš„åœ°å€ä¸åŒï¼‰ 123Integer i = new Integer(100);Integer j = 100;System.out.print(i == j); //false å¯¹äºä¸¤ä¸ªénewç”Ÿæˆçš„Integerå¯¹è±¡ï¼Œè¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œå¦‚æœä¸¤ä¸ªå˜é‡çš„å€¼åœ¨åŒºé—´-128åˆ°127ä¹‹é—´ï¼Œåˆ™æ¯”è¾ƒç»“æœä¸ºtrueï¼Œå¦‚æœä¸¤ä¸ªå˜é‡çš„å€¼ä¸åœ¨æ­¤åŒºé—´ï¼Œåˆ™æ¯”è¾ƒç»“æœä¸ºfalseã€‚ 1234567Integer i = 100;Integer j = 100;System.out.print(i == j); //true Integer i = 128;Integer j = 128;System.out.print(i == j); //false ç¼“å­˜éƒ¨åˆ†å¯ä»¥çœ‹åˆ°æºä»£ç çš„å†™æ³•ï¼š 1234567public static Integer valueOf(int i)&#123; assert IntegerCache.high &gt;= 127; if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)&#123; return IntegerCache.cache[i + (-IntegerCache.low)]; &#125; return new Integer(i);&#125; â€œ== â€œ å’Œ equals() åœ¨ Integer ä¸­çš„ä¸åŒ 12345678910111213141516171819202122/** * Integer vs Int */class Test3&#123; public static void main(String[] args) &#123; Integer a1 = 200; Integer a11 = 200; Integer b1 = 200; Integer b11 = 200; System.out.println(a1.equals(b1)); // trueï¼Œequals ä¼šè‡ªåŠ¨æ‹†ç®± System.out.println(a1 == b1); // falseï¼Œ== åªæœ‰é‡åˆ°äº†ç®—æœ¯è¿ç®—æ‰ä¼šæ‹†ç®±ï¼Œæ­¤æ—¶ç”±äºä¸åœ¨ç¼“å­˜èŒƒå›´å†…ï¼Œæ‰€ä»¥æ˜¯ä¸åŒçš„å¯¹è±¡ System.out.println(a1 + a11 == b1 + b11); // trueï¼Œç®—æœ¯è¿ç®—ï¼Œæ‰€ä»¥æ‹†ç®±äº† // ä¸ç”¨ new å¾—åˆ°çš„ Integer å¯¹è±¡ï¼Œå®é™…ä¸Šè·Ÿ String.inner ä¸€æ · // å¸¸é‡æ± æ²¡æœ‰ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ‰”å¸¸é‡æ± ä¸­ï¼Œä½†æ˜¯è¿™é‡Œçš„ Integer æœ‰é™åˆ¶ï¼Œæ˜¯ -128 ~ 127 // æ‰€ä»¥è¿™é‡Œçš„ 127 éƒ½æ˜¯å¸¸é‡æ± ä¸­çš„æ•°å­—ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ç¼“å­˜æœºåˆ¶ï¼Œæ‰€ä»¥æ˜¯åŒä¸€ä¸ªå¯¹è±¡ Integer a2 = 127; Integer b2 = 127; System.out.println(a2.equals(b2)); // trueï¼Œæ‹†ç®±äº† System.out.println(a2 == b2); // trueï¼Œè™½ç„¶æœªæ‹†ç®±ï¼Œä½†æ˜¯åœ¨ç¼“å­˜èŒƒå›´ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ &#125;&#125; Kafka çš„ç›¸å…³é—®é¢˜ ä¸ºä½•ä½¿ç”¨ kafka è§£è€¦ï¼Œè§„å®šå„æ¨¡å—è¾“å…¥è¾“å‡ºæ ¼å¼å°±å¯ä»¥äº†ï¼Œå„æ¨¡å—è€¦åˆæ€§ä¸‹é™ï¼› å¼‚æ­¥ï¼Œæ¶ˆæ¯æ¥äº†ï¼Œä¸ç”¨ç«‹å³æ¥æ”¶ï¼Œå¯ä»¥æ…¢æ…¢æ¶ˆè´¹ï¼Œä¹Ÿè¾¾åˆ°äº†ä¸€ä¸ªå‰Šå³°çš„ä½œç”¨ã€‚ ä¸ºä½•ä¸ç”¨å…¶ä»–çš„ MQï¼Ÿ Kafka ååé‡æœ€å¤§ï¼› ç¨³å®šæ€§å¥½ ä¸ºä»€ä¹ˆ kafka å¾ˆå¿«ï¼Ÿ å’ŒProducerä¸Consumæ”¶å‘æ¶ˆæ¯å¿«çš„åŸå› æ˜¯ç”¨äº† NIOçš„socketæœ‰å…³çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯ I/O å¤ç”¨æŠ€æœ¯ã€Œåº•å±‚ä½¿ç”¨ epollã€ï¼Œç”¨selectorå»è½®è¯¢ï¼Œä¸éœ€è¦åœ¨è¿æ¥producerå’Œconsumerä¹‹åä¸€ç›´ç­‰å¾…ï¼Œç­‰åˆ°producerå‡†å¤‡å¥½æ•°æ®ä¹‹åæ‰å»newä¸€ä¸ªçº¿ç¨‹è·Ÿä»–ä¼ è¾“æ¶ˆæ¯ï¼› ç„¶åæ¶ˆæ¯ä¼ è¾“åˆ°æœåŠ¡å™¨ä¸Šä¹‹åä½¿ç”¨NIOä¸­çš„Fileæœ‰å…³çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯é›¶æ‹·è´æŠ€æœ¯ä¸­çš„ mmapï¼Œå†…å­˜åœ°å€å’Œç£ç›˜åœ°å€æ˜ å°„ï¼Œè¯»å†™å†…å­˜å°±ç›¸å½“äºç›´æ¥è¯»å†™ç£ç›˜ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚ å…¶è¿˜æä¾›åˆ†åŒºï¼Œè¿™æ ·çš„è¯å¯ä»¥å¤šä¸ªbrokeråŒæ—¶å†™ç£ç›˜ï¼Œæ‰€ä»¥å°±å¾ˆå¿« ç„¶ååœ¨å°†brokerä¸­æ•°æ®ç›´æ¥å‘ç»™consumerä¸­æ˜¯é‡‡ç”¨äº†sendfileè¿™ä¸ªé›¶æ‹·è´æŠ€æœ¯ï¼Œç›´æ¥é€šè¿‡DMAå°†å†…æ ¸ç¼“å†²åŒºä¸­çš„æ•°æ®ä¼ é€åˆ°socketç¼“å†²åŒºã€ŒFileChannel.transferTo/transferFromã€ https://www.jianshu.com/p/7863667d5fa7 å†™çš„çœŸçš„å¥½ kakfaä¼šä¸¢æ¶ˆæ¯å— ä¼šçš„ï¼Œå½“leaderè¿˜åœ¨è¿›è¡ŒåŒæ­¥å¤åˆ¶çš„æ—¶å€™ï¼Œå‰¯æœ¬å¤åˆ¶ç»™å…¶ä»–followerï¼Œè¿˜æ²¡å¤åˆ¶å®Œæˆï¼Œleaderå°±æŒ‚äº†ï¼Œæ­¤æ—¶å†æ¬¡é€‰ä¸¾ä¹‹å‰çš„éƒ¨åˆ†æ•°æ®å°±ä¸¢å¤±äº†ã€‚ kafkaå¦‚ä½•ä¿è¯ä¸ä¸¢æ¶ˆæ¯ Producer ç«¯æ˜¯é‡‡ç”¨äº† ack æœºåˆ¶ï¼Œå‘é€æ¶ˆæ¯ä¹‹åä¼šæœ‰ä¸€ä¸ª ackçš„åé¦ˆï¼› Consumerç«¯æ˜¯é‡‡ç”¨äº†offsetè¿›è¡Œä¸€ä¸ªæ§åˆ¶ï¼Œä¿è¯ä¸ä¸¢æ¶ˆæ¯ï¼Œæ¯æ¬¡éƒ½è®°å½•æœ€åä¸€æ¬¡è¯»å–çš„lastoffset kafkaæ¶ˆæ¯æœ‰åºå— åŒä¸€ä¸ªpartitionæ˜¯æœ‰åºçš„ï¼Œä½†æ˜¯ä¸åŒpartitionä¹‹é—´æ˜¯æ— åºçš„ã€‚ å¦‚ä½•é˜²æ­¢æ•°æ®ä¸¢å¤± å¤šå‰¯æœ¬å†—ä½™çš„é«˜å¯ç”¨æœºåˆ¶ã€‚ã€‚ã€‚ã€‚ Leaderä¼šè·Ÿè¸ªä¸å…¶ä¿æŒåŒæ­¥çš„Replicaåˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨ç§°ä¸ºISRï¼ˆå³in-sync Replicaï¼‰ï¼Œä¿æŒåŒæ­¥çš„å‰¯æœ¬ã€‚Kafkaçš„å¤åˆ¶æœºåˆ¶æ—¢ä¸æ˜¯å®Œå…¨çš„åŒæ­¥å¤åˆ¶ï¼Œä¹Ÿä¸æ˜¯å•çº¯çš„å¼‚æ­¥å¤åˆ¶ã€‚è€ŒKafkaçš„è¿™ç§ä½¿ç”¨ISRçš„æ–¹å¼åˆ™å¾ˆå¥½çš„å‡è¡¡äº†ç¡®ä¿æ•°æ®ä¸ä¸¢å¤±ä»¥åŠååç‡ã€‚Followerå¯ä»¥æ‰¹é‡çš„ä»Leaderå¤åˆ¶æ•°æ®ï¼Œè¿™æ ·æå¤§çš„æé«˜å¤åˆ¶æ€§èƒ½ï¼ˆæ‰¹é‡å†™ç£ç›˜ï¼‰ï¼Œæå¤§å‡å°‘äº†Followerä¸Leaderçš„å·®è·ã€‚ //æ‰¹é‡å¤åˆ¶æ•°æ®æ–¹å¼ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±1 ä¸€æ¡æ¶ˆæ¯åªæœ‰è¢«ISRé‡Œçš„æ‰€æœ‰Followeréƒ½ä»Leaderå¤åˆ¶è¿‡å»æ‰ä¼šè¢«è®¤ä¸ºå·²æäº¤ã€‚è¿™æ ·å°±é¿å…äº†éƒ¨åˆ†æ•°æ®è¢«å†™è¿›äº†Leaderï¼Œè¿˜æ²¡æ¥å¾—åŠè¢«ä»»ä½•Followerå¤åˆ¶å°±å®•æœºäº†ï¼Œè€Œé€ æˆæ•°æ®ä¸¢å¤±ï¼ˆConsumeræ— æ³•æ¶ˆè´¹è¿™äº›æ•°æ®ï¼‰ã€‚ //é˜²æ­¢æ•°æ®ä¸¢å¤±2 å¦‚ä½•åˆ¤æ–­ kafka ä¸­çš„brokeræŒ‚æ‰ zookeeper çš„å¿ƒè·³æœºåˆ¶ ISRæœºåˆ¶ï¼Œæ¯ä¸ªleaderä¼šå…³æ³¨followçš„åŒæ­¥çŠ¶å†µï¼Œå¦‚æœä¸èƒ½åŠæ—¶çš„æ›´æ–°leaderçš„å†™æ“ä½œï¼Œå»¶æ—¶å¤ªä¹…ï¼Œleaderå°±ä¼šå°†å…¶ç§»é™¤ Kafka çš„æ¶ˆæ¯ä¼ é€’è¯­ä¹‰ At most once - æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­æœ‰å¯èƒ½ä¸¢å¤±ï¼Œä¸¢å¤±çš„æ¶ˆæ¯ä¹Ÿä¸ä¼šé‡æ–°ä¼ é€’ï¼Œå…¶å®å°±æ˜¯ä¿è¯æ¶ˆæ¯ä¸ä¼šé‡å¤å‘é€æˆ–è€…é‡å¤æ¶ˆè´¹ At least once - æ¶ˆæ¯åœ¨ä¼ é€’çš„è¿‡ç¨‹ä¸­ä¸å¯èƒ½ä¼šä¸¢å¤±ï¼Œä¸¢å¤±çš„æ¶ˆæ¯ä¼šé‡æ–°ä¼ é€’ï¼Œå…¶å®å°±æ˜¯ä¿è¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œä½†æ˜¯æ¶ˆæ¯æœ‰å¯èƒ½é‡å¤å‘é€æˆ–è€…é‡æ–°è¢«æ¶ˆè´¹ ã€Œé»˜è®¤ã€ Exactly once - è¿™ä¸ªæ˜¯å¤§å¤šæ•°åœºæ™¯éœ€è¦çš„è¯­ä¹‰ï¼Œå…¶å®å°±æ˜¯ä¿è¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œä¹Ÿä¸ä¼šé‡å¤è¢«æ¶ˆè´¹ï¼Œæ¶ˆæ¯åªä¼ é€’ä¸€æ¬¡ åœ¨ Producer ç«¯å®ç° At least onceï¼š åœ¨0.11.0.0ç‰ˆæœ¬ï¼ŒKafkaçš„Producerå¼€å§‹æ”¯æŒäº†å¹‚ç­‰å‘é€æ¶ˆæ¯äº†ï¼Œå…¶å®è¯´ç™½äº†ï¼Œå°±æ˜¯é‡å¤å‘é€ä¸€æ¡æ¶ˆæ¯ä¸ä¼šå¯¼è‡´broker serverä¸­å­˜å‚¨ä¸¤æ¡ä¸€æ ·çš„æ¶ˆæ¯äº†ã€‚è¿™æ ·çš„è¯Kafkaåœ¨æ¶ˆæ¯çš„å‘é€çš„è¯­ä¹‰å°±å¯ä»¥è¾¾åˆ°Exactly onceäº† ä¸ºäº†å®ç°å¹‚ç­‰å‘é€æ¶ˆæ¯ï¼Œåœ¨0.11.0.0ç‰ˆæœ¬ï¼ŒKafkaç»™æ¯ä¸€ä¸ªProducerä¸€ä¸ªå”¯ä¸€çš„IDï¼Œä»¥åŠç»™å‘é€çš„æ¯ä¸€æ¡æ¶ˆæ¯ä¸€ä¸ªå”¯ä¸€çš„sequence numberï¼Œåˆ©ç”¨è¿™ä¸¤ä¸ªä¿¡æ¯å°±å¯ä»¥åœ¨broker serveræ®µå¯¹æ¶ˆæ¯è¿›è¡Œå»é‡äº†ã€‚ å¦‚æœæƒ³è¦å®ç° Exactly onceï¼š åè°ƒå¥½æ¶ˆè´¹è€…æ¶ˆè´¹çš„æ¶ˆæ¯offsetçš„ä¿å­˜å’Œå¤„ç†æ¶ˆæ¯ç»“æœçš„ä¿å­˜ä¹‹é—´çš„å…³ç³»å°±å¯ä»¥è¾¾åˆ°Exactly onceçš„è¯­ä¹‰ï¼Œå°±æ˜¯è¯´ï¼Œå½“æ¶ˆè´¹çš„æ¶ˆæ¯offsetçš„ä¿å­˜æˆåŠŸä»¥åŠå¤„ç†æ¶ˆæ¯ç»“æœçš„ä¿å­˜æˆåŠŸï¼Œåˆ™ç®—æˆåŠŸï¼Œå¦‚æœä¸¤è€…æœ‰ä¸€ä¸ªå¤±è´¥çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦å›æ»šä¸¤ä¸ªä¿å­˜äº†(å’Œäº‹åŠ¡æœ‰ç‚¹åƒ)ã€‚ kafkaä¸­çš„ackæœºåˆ¶ ç¬¬ä¸€ç§é€‰æ‹©æ˜¯æŠŠackså‚æ•°è®¾ç½®ä¸º0ï¼Œæ„æ€å°±æ˜¯æˆ‘çš„KafkaProduceråœ¨å®¢æˆ·ç«¯ï¼Œåªè¦æŠŠæ¶ˆæ¯å‘é€å‡ºå»ï¼Œä¸ç®¡é‚£æ¡æ•°æ®æœ‰æ²¡æœ‰åœ¨å“ªæ€•Partition Leaderä¸Šè½åˆ°ç£ç›˜ï¼Œæˆ‘å°±ä¸ç®¡ä»–äº†ï¼Œç›´æ¥å°±è®¤ä¸ºè¿™ä¸ªæ¶ˆæ¯å‘é€æˆåŠŸäº†ã€‚ å¦‚æœä½ é‡‡ç”¨è¿™ç§è®¾ç½®çš„è¯ï¼Œé‚£ä¹ˆä½ å¿…é¡»æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¯èƒ½ä½ å‘é€å‡ºå»çš„æ¶ˆæ¯è¿˜åœ¨åŠè·¯ã€‚ç»“æœå‘¢ï¼ŒPartition Leaderæ‰€åœ¨Brokerå°±ç›´æ¥æŒ‚äº†ï¼Œç„¶åç»“æœä½ çš„å®¢æˆ·ç«¯è¿˜è®¤ä¸ºæ¶ˆæ¯å‘é€æˆåŠŸäº†ï¼Œæ­¤æ—¶å°±ä¼šå¯¼è‡´è¿™æ¡æ¶ˆæ¯å°±ä¸¢å¤±äº†ã€‚ ç¬¬äºŒç§é€‰æ‹©æ˜¯è®¾ç½® acks = 1ï¼Œæ„æ€å°±æ˜¯è¯´åªè¦Partition Leaderæ¥æ”¶åˆ°æ¶ˆæ¯è€Œä¸”å†™å…¥æœ¬åœ°ç£ç›˜äº†ï¼Œå°±è®¤ä¸ºæˆåŠŸäº†ï¼Œä¸ç®¡ä»–å…¶ä»–çš„Followeræœ‰æ²¡æœ‰åŒæ­¥è¿‡å»è¿™æ¡æ¶ˆæ¯äº†ã€‚ è¿™ç§è®¾ç½®å…¶å®æ˜¯kafkaé»˜è®¤çš„è®¾ç½®ï¼Œå¤§å®¶è¯·æ³¨æ„ï¼Œåˆ’é‡ç‚¹ï¼è¿™æ˜¯é»˜è®¤çš„è®¾ç½® ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä½ è¦æ˜¯ä¸ç®¡acksè¿™ä¸ªå‚æ•°ï¼Œåªè¦Partition Leaderå†™æˆåŠŸå°±ç®—æˆåŠŸã€‚ ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸‡ä¸€Partition Leaderåˆšåˆšæ¥æ”¶åˆ°æ¶ˆæ¯ï¼ŒFollowerè¿˜æ²¡æ¥å¾—åŠåŒæ­¥è¿‡å»ï¼Œç»“æœLeaderæ‰€åœ¨çš„brokerå®•æœºäº†ï¼Œæ­¤æ—¶ä¹Ÿä¼šå¯¼è‡´è¿™æ¡æ¶ˆæ¯ä¸¢å¤±ï¼Œå› ä¸ºäººå®¶å®¢æˆ·ç«¯å·²ç»è®¤ä¸ºå‘é€æˆåŠŸäº†ã€‚ æœ€åä¸€ç§æƒ…å†µï¼Œå°±æ˜¯è®¾ç½®acks=allï¼Œè¿™ä¸ªæ„æ€å°±æ˜¯è¯´ï¼ŒPartition Leaderæ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œè¿˜å¿…é¡»è¦æ±‚ISRåˆ—è¡¨é‡Œè·ŸLeaderä¿æŒåŒæ­¥çš„é‚£äº›Followeréƒ½è¦æŠŠæ¶ˆæ¯åŒæ­¥è¿‡å»ï¼Œæ‰èƒ½è®¤ä¸ºè¿™æ¡æ¶ˆæ¯æ˜¯å†™å…¥æˆåŠŸäº†ã€‚ å¦‚æœè¯´Partition Leaderåˆšæ¥æ”¶åˆ°äº†æ¶ˆæ¯ï¼Œä½†æ˜¯ç»“æœFolloweræ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œæ­¤æ—¶Leaderå®•æœºäº†ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¼šæ„ŸçŸ¥åˆ°è¿™ä¸ªæ¶ˆæ¯æ²¡å‘é€æˆåŠŸï¼Œä»–ä¼šé‡è¯•å†æ¬¡å‘é€æ¶ˆæ¯è¿‡å»ã€‚ æ­¤æ—¶å¯èƒ½Partition 2çš„Followerå˜æˆLeaderäº†ï¼Œæ­¤æ—¶ISRåˆ—è¡¨é‡Œåªæœ‰æœ€æ–°çš„è¿™ä¸ªFollowerè½¬å˜æˆçš„Leaderäº†ï¼Œé‚£ä¹ˆåªè¦è¿™ä¸ªæ–°çš„Leaderæ¥æ”¶æ¶ˆæ¯å°±ç®—æˆåŠŸäº†ã€‚ ack = all å°±èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±å—ï¼Ÿ å½“ç„¶ä¸æ˜¯ï¼Œå¦‚æœä½ çš„Partitionåªæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªLeaderï¼Œä»»ä½•Followeréƒ½æ²¡æœ‰ï¼Œä½ è®¤ä¸ºacks=allæœ‰ç”¨å—ï¼Ÿ å½“ç„¶æ²¡ç”¨äº†ï¼Œå› ä¸ºISRé‡Œå°±ä¸€ä¸ªLeaderï¼Œä»–æ¥æ”¶å®Œæ¶ˆæ¯åå®•æœºï¼Œä¹Ÿä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ æ‰€ä»¥è¯´ï¼Œè¿™ä¸ªacks=allï¼Œå¿…é¡»è·ŸISRåˆ—è¡¨é‡Œè‡³å°‘æœ‰2ä¸ªä»¥ä¸Šçš„å‰¯æœ¬é…åˆä½¿ç”¨ï¼Œèµ·ç æ˜¯æœ‰ä¸€ä¸ªLeaderå’Œä¸€ä¸ªFolloweræ‰å¯ä»¥ã€‚ æœ€åæ€»ç»“ä¸€ä¸‹ kafka å¦‚ä½•ä¿è¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸ä¸¢æ¶ˆæ¯ï¼Œå¦‚ä½•ä¿è¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸ç”Ÿäº§å’Œæ¶ˆè´¹é‡å¤æ¶ˆæ¯ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åºï¼Ÿ å…ˆå›ç­”ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚ä¿è¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸ä¸¢æ¶ˆæ¯ï¼Œé¦–å…ˆç”±äº kafka çš„é»˜è®¤çš„æ¶ˆæ¯ä¼ é€’è¯­ä¹‰æ˜¯ at least onceï¼Œå°±æ˜¯ç¡®ä¿ç”Ÿäº§è€…æ¶ˆæ¯ä¸ä¸¢ï¼Œç¡®ä¿çš„æ‰‹æ®µå°±æ˜¯ ack = all æœºåˆ¶ï¼ŒåŠ ä¸Šè®¾ç½®å°½é‡å¤šçš„ brokerï¼Œè¾¾åˆ°é«˜å¯ç”¨ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—å°±ç®— leader æŒ‚äº†ï¼Œè¿˜æœ‰å…¶ä»–çš„ follower èƒ½å¤Ÿé¡¶ä¸Šå»ã€‚ç¡®ä¿æ¶ˆè´¹è€…ä¸ä¸¢æ¶ˆæ¯ï¼Œéœ€è¦æˆ‘ä»¬ç¨‹åºå‘˜è‡ªå·±å»ç¡®ä¿ï¼Œå› ä¸º kafka å¹¶æ²¡æœ‰æä¾›è¿™æ ·çš„æ¶ˆæ¯è¯­ä¹‰ï¼Œå› ä¸ºå®ƒæ˜¯å…è®¸ä¸¢æ¶ˆæ¯çš„ï¼Œå½“æ¶ˆè´¹è€…æ¶ˆæ¯ä¸¢äº†ä¹‹åï¼Œæˆ‘ä»¬æ— éœ€å»æ”¹åŠ¨æ¶ˆè´¹çš„offsetï¼Œè¿™æ ·å°±ä¸ä¼šå»å¯¼è‡´æ¶ˆè´¹ä¸åˆ°æ¶ˆæ¯ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ç§æ‰‹åŠ¨æ§åˆ¶ offset çš„æ–¹å¼ä¹ŸåŒæ ·èƒ½å¤Ÿç¡®ä¿ä¸ä¼šå»é‡å¤æ¶ˆè´¹ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å·²ç»åšäº†ä¸€ä¸ªäº‹åŠ¡çš„åŸå­æ“ä½œï¼Œç»‘å®šäº†æ›´æ”¹ offset å’Œæ¶ˆè´¹æ¶ˆæ¯è¿™ä¸¤ä»¶äº‹ã€‚ ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¦‚ä½•ä¿è¯ç”Ÿäº§è€…ä¸é‡å¤ç”Ÿäº§åŒæ ·çš„æ¶ˆæ¯ï¼Œ kafka çš„æœºåˆ¶æ˜¯æ¯ä¸ªProduceréƒ½æœ‰ä¸€ä¸ª idï¼Œç„¶åæ¯ä¸€æ¡æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ª idï¼Œåªè¦æœåŠ¡å™¨æ”¶åˆ°äº†ï¼Œå°±ä¼šè®°å½•ä¸‹è¯¥idï¼Œç„¶åå°±ç®—é‡å¤å‘é€äº†ä¹Ÿä¼šå¹‚ç­‰ï¼Œæ‰€ä»¥å°±è§£å†³äº†è¯¥é—®é¢˜ï¼Œè‡³äºæ¶ˆè´¹è€…å¦‚ä½•è§£å†³æ¶ˆè´¹é‡å¤é—®é¢˜ï¼Œæˆ‘åœ¨ä¸Šé¢å·²ç»è®²è¿‡äº†ï¼Œæ‰‹åŠ¨æ§åˆ¶ offset å°±ä¸ä¼šé‡å¤æ¶ˆè´¹äº†ã€‚ ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ä¿è¯æœ‰åºï¼ŒApache Kafkaå®˜æ–¹ä¿è¯äº†partitionå†…éƒ¨çš„æ•°æ®æœ‰æ•ˆæ€§ï¼ˆè¿½åŠ å†™ã€offsetè¯»ï¼‰ï¼›ä¸ºäº†æé«˜Topicçš„å¹¶å‘ååèƒ½åŠ›ï¼Œå¯ä»¥æé«˜Topicçš„partitionæ•°ï¼Œå¹¶é€šè¿‡è®¾ç½®partitionçš„replicaæ¥ä¿è¯æ•°æ®é«˜å¯é ï¼› ä½†æ˜¯åœ¨å¤šä¸ªPartitionæ—¶ï¼Œä¸èƒ½ä¿è¯Topicçº§åˆ«çš„æ•°æ®æœ‰åºæ€§ã€‚ ä¸ºä½•ä½¿ç”¨ MongoDB éœ€æ±‚æ€»æ˜¯å˜åŒ–ï¼Œno-sqlæ•°æ®åº“æ”¹åŠ¨å° é€Ÿåº¦å¿«ï¼Œmmapå†…å­˜æ˜ å°„ æ–‡æ¡£å¤šï¼Œç¤¾åŒºèµ„æºå¤š æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œpythonå’Œnodeæ”¯æŒçš„ä¹Ÿå¾ˆå¥½ï¼Œmongoengine]]></content>
      <categories>
        <category>é›¶ç¢çŸ¥è¯†ç‚¹</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å¤šçº¿ç¨‹ï¼ˆä¸€ï¼‰--- é” & å…³é”®å­—]]></title>
    <url>%2F2020%2F01%2F29%2F%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89----%20%E9%94%81%20%26%20%E5%85%B3%E9%94%AE%E5%AD%97%20.html</url>
    <content type="text"><![CDATA[çº¿ç¨‹çš„åŸºæœ¬æ“ä½œåŠçŠ¶æ€è½¬æ¢åˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼ç»§æ‰¿ Thread ç±»æ–¹æ³•ä¸€ ç»§æ‰¿ Thread ç±»å¹¶é‡å†™ run æ–¹æ³• åˆ›å»ºçº¿ç¨‹å¯¹è±¡ è°ƒç”¨è¯¥çº¿ç¨‹å¯¹è±¡çš„ start() æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ demo 12345678910111213141516class ThreadDemo&#123; public static void main(String[] args) &#123; new ThreadTest().start(); &#125;&#125;class ThreadTest extends Thread&#123; private int i; @Override public void run() &#123; for (; i &lt; 100; i++) &#123; System.out.println(Thread.currentThread().getName() + " is running: " + i); &#125; &#125;&#125; æ–¹æ³•äºŒ å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥å®ç°å†…éƒ¨ç±»ï¼Œç„¶åé‡å†™ run() æ–¹æ³•ï¼Œç„¶åé€‚å½“çš„å¯ä»¥ç”¨ lamda è¡¨è¾¾å¼ demo 123456789101112 public static void main(String[] args) &#123;// new ThreadTest().start(); // 2. ç›´æ¥ç»§æ‰¿ Thread ç±» Thread threadC = new Thread()&#123; @Override public void run()&#123; System.out.println("3.1 get resource c"); super.run(); &#125; &#125;; threadC.start(); &#125; å®ç°Runnableæ¥å£æ–¹æ³•ä¸€ å®šä¹‰ä¸€ä¸ªç±»å®ç° Runnable æ¥å£ï¼Œå¹¶é‡å†™è¯¥æ¥å£çš„ run() æ–¹æ³• åˆ›å»º Runnable å®ç°ç±»çš„å¯¹è±¡ï¼Œä½œä¸ºåˆ›å»º Thread å¯¹è±¡çš„ target å‚æ•°ï¼Œæ­¤ Thread å¯¹è±¡æ‰æ˜¯çœŸæ­£çš„çº¿ç¨‹å¯¹è±¡ï¼Œè¿™ä¸ªè·Ÿç»§æ‰¿ Thread ä¸ä¸€æ ·ï¼Œç¬¬ä¸€ç§æ–¹å¼æ˜¯ç›´æ¥ Thread çš„å®ç°ç±»å°±æ˜¯çœŸæ­£çš„çº¿ç¨‹å¯¹è±¡ï¼Œè€Œå®ç° Runnable æ¥å£å¾—å¯¹è±¡åœ¨è¿™é‡Œå¹¶ä¸æ˜¯çœŸæ­£çš„çº¿ç¨‹å¯¹è±¡ã€‚ è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„ start() æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ demo 12345678910111213141516class RunnableDemo &#123; public static void main(String[] args) &#123; RunnableTest runnableTest = new RunnableTest(); new Thread(runnableTest, "çº¿ç¨‹1").start(); new Thread(runnableTest, "çº¿ç¨‹2").start(); &#125;&#125;class RunnableTest implements Runnable&#123; private int i = 0; @Override public void run() &#123; for (; i &lt; 100; i++) &#123; System.out.println(Thread.currentThread().getName() + " is running: " + i); &#125; &#125;&#125; æ–¹æ³•äºŒ ç›´æ¥å®ç°åŒ¿åå†…éƒ¨ç±»å°±è¡Œäº†ï¼Œè·Ÿæ–¹å¼ä¸€ä¸­çš„æ–¹æ³•äºŒä¸€æ · demo 1234567891011121314class RunnableDemo &#123; public static void main(String[] args) &#123;// RunnableTest runnableTest = new RunnableTest();// new Thread(runnableTest, "çº¿ç¨‹1").start();// new Thread(runnableTest, "çº¿ç¨‹2").start(); Thread thread = new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println("è¿™é‡Œæ˜¯å®ç° Runnable æ¥å£çš„çº¿ç¨‹"); &#125; &#125;); thread.start(); &#125;&#125; å®ç° Callable æ¥å£ä¸Šè¿°ä¸¤ç§æ–¹å¼éƒ½æœ‰ä¸€ä¸ªç¼ºé™·å°±æ˜¯ï¼šåœ¨æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åæ— æ³•è·å–æ‰§è¡Œç»“æœã€‚äºæ˜¯javaåé¢åˆå¢åŠ äº† Callable å’Œ Futureï¼Œé€šè¿‡å®ƒä»¬å¯ä»¥åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åå¾—åˆ°ä»»åŠ¡æ‰§è¡Œç»“æœã€‚ Runnable å’Œ Callable Runnable åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‡Œé¢åªæ˜¯å£°æ˜äº†ä¸€ä¸ªrunæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°æ–¹æ³•çš„è¿”å›å€¼æ˜¯voidï¼Œæ‰€ä»¥çº¿ç¨‹æ‰§è¡Œå®Œäº†æ²¡æœ‰ä»»ä½•çš„è¿”å›å€¼ã€‚ Callable ä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒé‡Œé¢å£°æ˜äº†ä¸€ä¸ªcallæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œcall()å‡½æ•°è¿”å›çš„ç±»å‹å°±æ˜¯ä¼ é€’è¿›æ¥çš„Vç±»å‹ã€‚çº¿ç¨‹çš„æ‰§è¡Œæ˜¯å¼‚æ­¥çš„ï¼Œä¸€ä¸ªçº¿ç¨‹å’Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œæ˜¯äº’ä¸å¹²æ‰°çš„ï¼Œæ‰€ä»¥ä½ ä¸å¯èƒ½ä»åˆ«çš„çº¿ç¨‹ä¸­è·å¾—è¿”å›å€¼ï¼Œæ‰€ä»¥è¦æƒ³è·å¾—Callableçš„è¿”å›å€¼å°±éœ€è¦ç”¨åˆ°Futureè¿™ä¸ªæ¥å£ï¼ŒFutrueå¯ä»¥ç›‘è§†ç›®æ ‡çº¿ç¨‹è°ƒç”¨callçš„æƒ…å†µï¼Œå½“ä½ è°ƒç”¨Futureçš„get()æ–¹æ³•ä»¥è·å¾—ç»“æœæ—¶ï¼Œå½“å‰çº¿ç¨‹å°±å¼€å§‹é˜»å¡ï¼Œç›´åˆ°callæ–¹æ³•ç»“æŸè¿”å›ç»“æœã€‚ æ€»è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ä¸‰ç‚¹ï¼š Runnable è°ƒç”¨ runæ–¹æ³•ï¼ŒCallable è°ƒç”¨ call æ–¹æ³•ï¼› Runnableä¸èƒ½æœ‰è¿”å›å€¼ï¼Œä½†æ˜¯ Callableå¯ä»¥è¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼› Runnableä¸å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯ Callable å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚ FutureFuture å°±æ˜¯å¯¹äºå…·ä½“çš„ Runnable æˆ–è€… Callable ä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿›è¡Œå–æ¶ˆã€æŸ¥è¯¢æ˜¯å¦å®Œæˆã€è·å–ç»“æœã€‚å¿…è¦æ—¶å¯ä»¥é€šè¿‡getæ–¹æ³•è·å–æ‰§è¡Œç»“æœï¼Œè¯¥æ–¹æ³•ä¼šé˜»å¡ç›´åˆ°ä»»åŠ¡è¿”å›ç»“æœã€‚ 12345678public interface Future&lt;V&gt; &#123; boolean cancel(boolean mayInterruptIfRunning); boolean isCancelled(); boolean isDone(); V get() throws InterruptedException, ExecutionException; V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;&#125; ä¸‹é¢æˆ‘ä»¬è®²è§£ä¸‹è¿™äº”ä¸ªæ–¹æ³•çš„ä½œç”¨ï¼š cancelæ–¹æ³•ï¼šç”¨æ¥å–æ¶ˆä»»åŠ¡ï¼Œå¦‚æœå–æ¶ˆä»»åŠ¡æˆåŠŸåˆ™è¿”å›trueï¼Œå¦‚æœå–æ¶ˆä»»åŠ¡å¤±è´¥åˆ™è¿”å›falseã€‚å‚æ•°mayInterruptIfRunningè¡¨ç¤ºæ˜¯å¦å…è®¸å–æ¶ˆæ­£åœ¨æ‰§è¡Œå´æ²¡æœ‰æ‰§è¡Œå®Œæ¯•çš„ä»»åŠ¡ï¼Œå¦‚æœè®¾ç½®trueï¼Œåˆ™è¡¨ç¤ºå¯ä»¥å–æ¶ˆæ­£åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä»»åŠ¡ã€‚å¦‚æœä»»åŠ¡å·²ç»å®Œæˆï¼Œåˆ™æ— è®ºmayInterruptIfRunningä¸ºtrueè¿˜æ˜¯falseï¼Œæ­¤æ–¹æ³•è‚¯å®šè¿”å›falseï¼Œå³å¦‚æœå–æ¶ˆå·²ç»å®Œæˆçš„ä»»åŠ¡ä¼šè¿”å›falseï¼›å¦‚æœä»»åŠ¡æ­£åœ¨æ‰§è¡Œï¼Œè‹¥mayInterruptIfRunningè®¾ç½®ä¸ºtrueï¼Œåˆ™è¿”å›trueï¼Œè‹¥mayInterruptIfRunningè®¾ç½®ä¸ºfalseï¼Œåˆ™è¿”å›falseï¼›å¦‚æœä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œåˆ™æ— è®ºmayInterruptIfRunningä¸ºtrueè¿˜æ˜¯falseï¼Œè‚¯å®šè¿”å›trueã€‚ isCancelledæ–¹æ³•ï¼šè¡¨ç¤ºä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆæˆåŠŸï¼Œå¦‚æœåœ¨ä»»åŠ¡æ­£å¸¸å®Œæˆå‰è¢«å–æ¶ˆæˆåŠŸï¼Œåˆ™è¿”å› true isDoneæ–¹æ³•ï¼šè¡¨ç¤ºä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆï¼Œè‹¥ä»»åŠ¡å®Œæˆï¼Œåˆ™è¿”å›true get()æ–¹æ³•ï¼šç”¨æ¥è·å–æ‰§è¡Œç»“æœï¼Œè¿™ä¸ªæ–¹æ³•ä¼šäº§ç”Ÿé˜»å¡ï¼Œä¼šä¸€ç›´ç­‰åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰è¿”å›ã€‚è¿™é‡Œçš„é˜»å¡éœ€è¦è§£é‡Šä¸€ä¸‹ï¼Œé˜»å¡çš„æ˜¯å½“å‰è°ƒç”¨getæ–¹æ³•çš„çº¿ç¨‹ï¼Œç›´åˆ°getæ–¹æ³•è¿”å›ç»“æœæ‰èƒ½ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œå¦‚æœgetæ–¹æ³•ä¸€ç›´æ²¡æœ‰è¿”å›å€¼ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ä¸‹å» get(long timeout, TimeUnit unit)æ–¹æ³•ï¼šè·å–æ‰§è¡Œç»“æœï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œè¿˜æ²¡è·å–åˆ°ç»“æœï¼Œå°±ç›´æ¥è¿”å›nullï¼Œè¿™ä¸ªå°±é¿å…äº†ä¸€ç›´è·å–ä¸åˆ°ç»“æœä½¿å¾—å½“å‰çº¿ç¨‹ä¸€ç›´é˜»å¡çš„æƒ…å†µå‘ç”Ÿ ä¹Ÿå°±æ˜¯è¯´Futureæä¾›äº†ä¸‰ç§åŠŸèƒ½ï¼š 1ï¼‰åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆï¼› 2ï¼‰èƒ½å¤Ÿä¸­æ–­ä»»åŠ¡ï¼› 3ï¼‰èƒ½å¤Ÿè·å–ä»»åŠ¡æ‰§è¡Œç»“æœã€‚ å› ä¸ºFutureåªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥æ˜¯æ— æ³•ç›´æ¥ç”¨æ¥åˆ›å»ºå¯¹è±¡ä½¿ç”¨çš„ï¼Œå› æ­¤å°±æœ‰äº†ä¸‹é¢çš„ FutureTaskã€‚ FutureTaskæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ FutureTask çš„ç±»å›¾ï¼š å¯ä»¥çœ‹å‡º RunnableFuture ç»§æ‰¿äº† Runnable æ¥å£å’Œ Future æ¥å£ï¼Œè€Œ FutureTask å®ç°äº† RunnableFuture æ¥å£ã€‚æ‰€ä»¥å®ƒæ—¢å¯ä»¥ä½œä¸º Runnable è¢«çº¿ç¨‹æ‰§è¡Œï¼Œåˆå¯ä»¥ä½œä¸º Future å¾—åˆ° Callable çš„è¿”å›å€¼ã€‚ å®ç° ExecutorService &amp; Future &amp; Callable ç¬¬ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ç»§æ‰¿äº†ExecutorServiceçš„çº¿ç¨‹æ± ThreadPoolExecutorä¸­çš„submitæ–¹æ³•ï¼Œå°†Callableç›´æ¥æäº¤åˆ›å»ºFutureã€‚ demo 123456789101112131415161718192021class CallableDemo&#123; public static void main(String[] args) &#123; // ExecutorService &amp; Callable ExecutorService service = Executors.newSingleThreadExecutor(); // æˆ–è€…ç”¨è¿™ä¸ª// ExecutorService service = Executors.newCachedThreadPool(); Future&lt;String&gt; future = service.submit((Callable) () -&gt; "é€šè¿‡å®ç°Callableæ¥å£"); System.out.println(future.isDone()); service.shutdown(); try &#123; String result = future.get(); System.out.println(result); System.out.println(future.isDone()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (ExecutionException e) &#123; e.printStackTrace(); &#125; &#125;&#125; ExecutorService &amp; futureTask &amp; Callable ç¬¬äºŒç§æ–¹å¼å°±æ˜¯ä½¿ç”¨ futureTaskï¼Œå…·ä½“çœ‹ demo å§ demo 12345678910111213141516171819202122232425262728293031323334class CallableDemo &#123; public static void main(String[] args) &#123; // FutureTask &amp; Callable CallableTest callableTest = new CallableTest(); FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;&gt;(callableTest); // futureTask å¯ä»¥é‡‡ç”¨ä¸¤ç§æ–¹å¼è¿è¡Œçº¿ç¨‹ // 1. ç›´æ¥new Thread// new Thread(futureTask).start(); // 2. å°†FutureTask å¯¹è±¡æ”¾å…¥ executorService ä¸­ ExecutorService service = Executors.newCachedThreadPool(); service.submit(futureTask); service.shutdown(); try &#123; System.out.println("å­çº¿ç¨‹çš„è¿”å›å€¼: " + futureTask.get(3, TimeUnit.SECONDS)); &#125; catch (InterruptedException | TimeoutException e) &#123; e.printStackTrace(); &#125; catch (ExecutionException e) &#123; e.printStackTrace(); &#125; &#125;&#125;class CallableTest implements Callable &#123; @Override public Integer call() throws Exception &#123; int sum = 0; for (int i = 1; i &lt; 101; i++) &#123; sum += i; &#125; Thread.sleep(2000); System.out.println(Thread.currentThread().getName() + " is running: " + sum); return sum; &#125;&#125; futureTask &amp; Callable å› ä¸º futureTask å®ç°äº† run() æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ new Thread å¯åŠ¨ã€‚ demo 12345678910111213141516171819202122232425262728293031323334class CallableDemo &#123; public static void main(String[] args) &#123; // FutureTask &amp; Callable CallableTest callableTest = new CallableTest(); FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;&gt;(callableTest); // futureTask å¯ä»¥é‡‡ç”¨ä¸¤ç§æ–¹å¼è¿è¡Œçº¿ç¨‹ // 1. ç›´æ¥new Thread new Thread(futureTask).start(); // 2. å°†FutureTask å¯¹è±¡æ”¾å…¥ executorService ä¸­// ExecutorService service = Executors.newCachedThreadPool();// service.submit(futureTask);// service.shutdown(); try &#123; System.out.println("å­çº¿ç¨‹çš„è¿”å›å€¼: " + futureTask.get(3, TimeUnit.SECONDS)); &#125; catch (InterruptedException | TimeoutException e) &#123; e.printStackTrace(); &#125; catch (ExecutionException e) &#123; e.printStackTrace(); &#125; &#125;&#125;class CallableTest implements Callable &#123; @Override public Integer call() throws Exception &#123; int sum = 0; for (int i = 1; i &lt; 101; i++) &#123; sum += i; &#125; Thread.sleep(2000); System.out.println(Thread.currentThread().getName() + " is running: " + sum); return sum; &#125;&#125; ä¸‰ç§æ–¹å¼çš„æ¯”è¾ƒ1.å®ç°Runnable/Callableæ¥å£ç›¸æ¯”ç»§æ‰¿Threadç±»çš„ä¼˜åŠ¿ ï¼ˆ1ï¼‰é€‚åˆå¤šä¸ªçº¿ç¨‹è¿›è¡Œèµ„æºå…±äº« ï¼ˆ2ï¼‰å¯ä»¥é¿å…javaä¸­å•ç»§æ‰¿çš„é™åˆ¶ ï¼ˆ3ï¼‰å¢åŠ ç¨‹åºçš„å¥å£®æ€§ï¼Œä»£ç å’Œæ•°æ®ç‹¬ç«‹ ï¼ˆ4ï¼‰çº¿ç¨‹æ± åªèƒ½æ”¾å…¥ Runable æˆ– Callable æ¥å£å®ç°ç±»ï¼Œä¸èƒ½ç›´æ¥æ”¾å…¥ç»§æ‰¿ Thread çš„ç±» 2.Callableå’ŒRunnableçš„åŒºåˆ« â€‹ (1) Callable é‡å†™çš„æ˜¯ call() æ–¹æ³•ï¼Œ Runnable é‡å†™çš„æ–¹æ³•æ˜¯ run() æ–¹æ³• â€‹ (2) call() æ–¹æ³•æ‰§è¡Œåå¯ä»¥æœ‰è¿”å›å€¼ï¼Œrun() æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ â€‹ (3) call() æ–¹æ³•å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œrun() æ–¹æ³•ä¸å¯ä»¥ â€‹ (4) è¿è¡Œ Callable ä»»åŠ¡å¯ä»¥æ‹¿åˆ°ä¸€ä¸ª Future å¯¹è±¡ï¼Œè¡¨ç¤ºå¼‚æ­¥è®¡ç®—çš„ç»“æœ ã€‚é€šè¿‡ Future å¯¹è±¡å¯ä»¥äº†è§£ä»»åŠ¡æ‰§è¡Œæƒ…å†µï¼Œå¯å–æ¶ˆä»»åŠ¡çš„æ‰§è¡Œï¼Œè¿˜å¯è·å–æ‰§è¡Œç»“æœ https://zhuanlan.zhihu.com/p/88933756 https://juejin.im/post/5ae6cf7a518825670960fcc2 Synchronized è¶…è¯¦ç»†ä¾‹å­è®²è¿° Synchronized å½¢è±¡è®²è¿°å¯¹è±¡é”å’Œç±»é”åŒºåˆ« Synchronized ä¸»è¦æ˜¯ç±»é”å’Œå¯¹è±¡é”çš„åŒºåˆ« synchronizedç‰¹ç‚¹ï¼šä¿è¯å†…å­˜å¯è§æ€§ã€æ“ä½œåŸå­æ€§ synchronizedå½±å“æ€§èƒ½çš„åŸå› ï¼š 1ã€åŠ é”è§£é”æ“ä½œéœ€è¦é¢å¤–æ“ä½œï¼› 2ã€äº’æ–¥åŒæ­¥å¯¹æ€§èƒ½æœ€å¤§çš„å½±å“æ˜¯é˜»å¡çš„å®ç°ï¼Œå› ä¸ºé˜»å¡æ¶‰åŠåˆ°çš„æŒ‚èµ·çº¿ç¨‹å’Œæ¢å¤çº¿ç¨‹çš„æ“ä½œéƒ½éœ€è¦è½¬å…¥å†…æ ¸æ€ä¸­å®Œæˆï¼ˆç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢çš„æ€§èƒ½ä»£ä»·æ˜¯æ¯”è¾ƒå¤§çš„ï¼‰ synchronizedé”ï¼šå¯¹è±¡å¤´ä¸­çš„Mark Wordæ ¹æ®é”æ ‡å¿—ä½çš„ä¸åŒè€Œè¢«å¤ç”¨ åå‘é”ï¼šåœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥å—æ—¶æé«˜æ€§èƒ½ã€‚Mark Wordå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDï¼Œä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡ŒCASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œåªéœ€ç®€å•æ¯”è¾ƒThreadIDã€‚ç‰¹ç‚¹ï¼šåªæœ‰ç­‰åˆ°çº¿ç¨‹ç«äº‰å‡ºç°æ‰é‡Šæ”¾åå‘é”ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”ã€‚ä¹‹åçš„çº¿ç¨‹ç«äº‰åå‘é”ï¼Œä¼šå…ˆæ£€æŸ¥æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœä¸å­˜è´§ï¼Œåˆ™å¯¹è±¡å˜ä¸ºæ— é”çŠ¶æ€ï¼Œé‡æ–°åå‘ï¼›å¦‚æœä»å­˜æ´»ï¼Œåˆ™åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œæ­¤æ—¶è½»é‡çº§é”ç”±åŸæŒæœ‰åå‘é”çš„çº¿ç¨‹æŒæœ‰ï¼Œç»§ç»­æ‰§è¡Œå…¶åŒæ­¥ä»£ç ï¼Œè€Œæ­£åœ¨ç«äº‰çš„çº¿ç¨‹ä¼šè¿›å…¥è‡ªæ—‹ç­‰å¾…è·å¾—è¯¥è½»é‡çº§é” è½»é‡çº§é”ï¼šåœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œå°è¯•æ‹·è´é”å¯¹è±¡ç›®å‰çš„Mark Wordåˆ°æ ˆå¸§çš„Lock Recordï¼Œè‹¥æ‹·è´æˆåŠŸï¼šè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„Mark Wordã€‚è‹¥æ‹·è´å¤±è´¥ï¼šè‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™å¯é€šè¿‡è‡ªæ—‹ç¨å¾®ç­‰å¾…ä¸€ä¸‹ï¼Œå¯èƒ½æŒæœ‰è½»é‡çº§é”çš„çº¿ç¨‹å¾ˆå¿«å°±ä¼šé‡Šæ”¾é”ã€‚ ä½†æ˜¯å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªåœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªæ¥è®¿æ—¶ï¼Œè½»é‡çº§é”è†¨èƒ€ä¸ºé‡é‡çº§é” é‡é‡çº§é”ï¼šæŒ‡å‘äº’æ–¥é‡ï¼ˆmutexï¼‰ï¼Œåº•å±‚é€šè¿‡æ“ä½œç³»ç»Ÿçš„mutex lockå®ç°ã€‚ç­‰å¾…é”çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç”±äºLinuxä¸‹Javaçº¿ç¨‹ä¸æ“ä½œç³»ç»Ÿå†…æ ¸æ€çº¿ç¨‹ä¸€ä¸€æ˜ å°„ï¼Œæ‰€ä»¥æ¶‰åŠåˆ°ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ã€æ“ä½œç³»ç»Ÿå†…æ ¸æ€ä¸­çš„çº¿ç¨‹çš„é˜»å¡å’Œæ¢å¤ã€‚ Volatile volatileå¯è§æ€§åŸç†åº•å±‚åˆ†æï¼ˆè§†é¢‘ï¼‰ https://juejin.im/post/5ae9b41b518825670b33e6c4 https://www.infoq.cn/article/java-memory-model-4/ æ˜¯å¦èƒ½é‡æ’åº ç¬¬äºŒä¸ªæ“ä½œ ç¬¬ä¸€ä¸ªæ“ä½œ æ™®é€šè¯» / å†™ volatile è¯» volatile å†™ æ™®é€šè¯» / å†™ NO volatile è¯» NO NO( NO volatile å†™ NO NO( ä»ä¸Šè¡¨æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š å½“ç¬¬äºŒä¸ªæ“ä½œæ˜¯ volatile å†™æ—¶ï¼Œä¸ç®¡ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿ volatile å†™ä¹‹å‰çš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æ’åºåˆ° volatile å†™ä¹‹åã€‚ å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ volatile è¯»æ—¶ï¼Œä¸ç®¡ç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿ volatile è¯»ä¹‹åçš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æ’åºåˆ° volatile è¯»ä¹‹å‰ã€‚ å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ volatile å†™ï¼Œç¬¬äºŒä¸ªæ“ä½œæ˜¯ volatile è¯»æ—¶ï¼Œä¸èƒ½é‡æ’åºã€‚ ä¸ºäº†å®ç° volatile çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚å¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œå‘ç°ä¸€ä¸ªæœ€ä¼˜å¸ƒç½®æ¥æœ€å°åŒ–æ’å…¥å±éšœçš„æ€»æ•°å‡ ä¹ä¸å¯èƒ½ï¼Œä¸ºæ­¤ï¼ŒJMM é‡‡å–ä¿å®ˆç­–ç•¥ã€‚ä¸‹é¢æ˜¯åŸºäºä¿å®ˆç­–ç•¥çš„ JMM å†…å­˜å±éšœæ’å…¥ç­–ç•¥ï¼š åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª StoreStore å±éšœã€‚ åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚(å¯ä»¥å…è®¸æ™®é€š) åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadLoad å±éšœã€‚ åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadStore å±éšœã€‚ ä¸Šè¿°å†…å­˜å±éšœæ’å…¥ç­–ç•¥éå¸¸ä¿å®ˆï¼Œä½†å®ƒå¯ä»¥ä¿è¯åœ¨ä»»æ„å¤„ç†å™¨å¹³å°ï¼Œä»»æ„çš„ç¨‹åºä¸­éƒ½èƒ½å¾—åˆ°æ­£ç¡®çš„ volatile å†…å­˜è¯­ä¹‰ã€‚ ä¸‹é¢æ˜¯ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatile å†™æ’å…¥å†…å­˜å±éšœåç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾ï¼š ä¸Šå›¾ä¸­çš„ StoreStore å±éšœå¯ä»¥ä¿è¯åœ¨ volatile å†™ä¹‹å‰ï¼Œå…¶å‰é¢çš„æ‰€æœ‰æ™®é€šå†™æ“ä½œå·²ç»å¯¹ä»»æ„å¤„ç†å™¨å¯è§äº†ã€‚è¿™æ˜¯å› ä¸º StoreStore å±éšœå°†ä¿éšœä¸Šé¢æ‰€æœ‰çš„æ™®é€šå†™åœ¨ volatile å†™ä¹‹å‰åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚ è¿™é‡Œæ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ volatile å†™åé¢çš„ StoreLoad å±éšœã€‚è¿™ä¸ªå±éšœçš„ä½œç”¨æ˜¯é¿å… volatile å†™ä¸åé¢å¯èƒ½æœ‰çš„ volatile è¯» / å†™æ“ä½œé‡æ’åºã€‚å› ä¸ºç¼–è¯‘å™¨å¸¸å¸¸æ— æ³•å‡†ç¡®åˆ¤æ–­åœ¨ä¸€ä¸ª volatile å†™çš„åé¢ï¼Œæ˜¯å¦éœ€è¦æ’å…¥ä¸€ä¸ª StoreLoad å±éšœï¼ˆæ¯”å¦‚ï¼Œä¸€ä¸ª volatile å†™ä¹‹åæ–¹æ³•ç«‹å³ returnï¼‰ã€‚ä¸ºäº†ä¿è¯èƒ½æ­£ç¡®å®ç° volatile çš„å†…å­˜è¯­ä¹‰ï¼ŒJMM åœ¨è¿™é‡Œé‡‡å–äº†ä¿å®ˆç­–ç•¥ï¼šåœ¨æ¯ä¸ª volatile å†™çš„åé¢æˆ–åœ¨æ¯ä¸ª volatile è¯»çš„å‰é¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚ä»æ•´ä½“æ‰§è¡Œæ•ˆç‡çš„è§’åº¦è€ƒè™‘ï¼ŒJMM é€‰æ‹©äº†åœ¨æ¯ä¸ª volatile å†™çš„åé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚å› ä¸º volatile å†™ - è¯»å†…å­˜è¯­ä¹‰çš„å¸¸è§ä½¿ç”¨æ¨¡å¼æ˜¯ï¼šä¸€ä¸ªå†™çº¿ç¨‹å†™ volatile å˜é‡ï¼Œå¤šä¸ªè¯»çº¿ç¨‹è¯»åŒä¸€ä¸ª volatile å˜é‡ã€‚å½“è¯»çº¿ç¨‹çš„æ•°é‡å¤§å¤§è¶…è¿‡å†™çº¿ç¨‹æ—¶ï¼Œé€‰æ‹©åœ¨ volatile å†™ä¹‹åæ’å…¥ StoreLoad å±éšœå°†å¸¦æ¥å¯è§‚çš„æ‰§è¡Œæ•ˆç‡çš„æå‡ã€‚ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° JMM åœ¨å®ç°ä¸Šçš„ä¸€ä¸ªç‰¹ç‚¹ï¼šé¦–å…ˆç¡®ä¿æ­£ç¡®æ€§ï¼Œç„¶åå†å»è¿½æ±‚æ‰§è¡Œæ•ˆç‡ã€‚ ä¸‹é¢æ˜¯åœ¨ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatile è¯»æ’å…¥å†…å­˜å±éšœåç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾ï¼š ä¸Šå›¾ä¸­çš„ LoadLoad å±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„ volatile è¯»ä¸ä¸‹é¢çš„æ™®é€šè¯»é‡æ’åºã€‚LoadStore å±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„ volatile è¯»ä¸ä¸‹é¢çš„æ™®é€šå†™é‡æ’åºã€‚ ä¸Šè¿° volatile å†™å’Œ volatile è¯»çš„å†…å­˜å±éšœæ’å…¥ç­–ç•¥éå¸¸ä¿å®ˆã€‚åœ¨å®é™…æ‰§è¡Œæ—¶ï¼Œåªè¦ä¸æ”¹å˜ volatile å†™ - è¯»çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µçœç•¥ä¸å¿…è¦çš„å±éšœã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡å…·ä½“çš„ç¤ºä¾‹ä»£ç æ¥è¯´æ˜ï¼š 123456789101112131415class VolatileBarrierExample &#123; int a; volatile int v1 = 1; volatile int v2 = 2; void readAndWrite() &#123; int i = v1; // ç¬¬ä¸€ä¸ª volatile è¯» int j = v2; // ç¬¬äºŒä¸ª volatile è¯» a = i + j; // æ™®é€šå†™ v1 = i + 1; // ç¬¬ä¸€ä¸ª volatile å†™ v2 = j * 2; // ç¬¬äºŒä¸ª volatile å†™ &#125; â€¦ // å…¶ä»–æ–¹æ³• &#125; é’ˆå¯¹ readAndWrite() æ–¹æ³•ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶å¯ä»¥åšå¦‚ä¸‹çš„ä¼˜åŒ–ï¼š æ³¨æ„ï¼Œæœ€åçš„ StoreLoad å±éšœä¸èƒ½çœç•¥ã€‚å› ä¸ºç¬¬äºŒä¸ª volatile å†™ä¹‹åï¼Œæ–¹æ³•ç«‹å³ returnã€‚æ­¤æ—¶ç¼–è¯‘å™¨å¯èƒ½æ— æ³•å‡†ç¡®æ–­å®šåé¢æ˜¯å¦ä¼šæœ‰ volatile è¯»æˆ–å†™ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œç¼–è¯‘å™¨å¸¸å¸¸ä¼šåœ¨è¿™é‡Œæ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚ ä¸Šé¢çš„ä¼˜åŒ–æ˜¯é’ˆå¯¹ä»»æ„å¤„ç†å™¨å¹³å°ï¼Œç”±äºä¸åŒçš„å¤„ç†å™¨æœ‰ä¸åŒâ€œæ¾ç´§åº¦â€çš„å¤„ç†å™¨å†…å­˜æ¨¡å‹ï¼Œå†…å­˜å±éšœçš„æ’å…¥è¿˜å¯ä»¥æ ¹æ®å…·ä½“çš„å¤„ç†å™¨å†…å­˜æ¨¡å‹ç»§ç»­ä¼˜åŒ–ã€‚ä»¥ x86 å¤„ç†å™¨ä¸ºä¾‹ï¼Œä¸Šå›¾ä¸­é™¤æœ€åçš„ StoreLoad å±éšœå¤–ï¼Œå…¶å®ƒçš„å±éšœéƒ½ä¼šè¢«çœç•¥ã€‚ å‰é¢ä¿å®ˆç­–ç•¥ä¸‹çš„ volatile è¯»å’Œå†™ï¼Œåœ¨ x86 å¤„ç†å™¨å¹³å°å¯ä»¥ä¼˜åŒ–æˆï¼š å‰æ–‡æåˆ°è¿‡ï¼Œx86 å¤„ç†å™¨ä»…ä¼šå¯¹å†™ - è¯»æ“ä½œåšé‡æ’åºã€‚X86 ä¸ä¼šå¯¹è¯» - è¯»ï¼Œè¯» - å†™å’Œå†™ - å†™æ“ä½œåšé‡æ’åºï¼Œå› æ­¤åœ¨ x86 å¤„ç†å™¨ä¸­ä¼šçœç•¥æ‰è¿™ä¸‰ç§æ“ä½œç±»å‹å¯¹åº”çš„å†…å­˜å±éšœã€‚åœ¨ x86 ä¸­ï¼ŒJMM ä»…éœ€åœ¨ volatile å†™åé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœå³å¯æ­£ç¡®å®ç° volatile å†™ - è¯»çš„å†…å­˜è¯­ä¹‰ã€‚è¿™æ„å‘³ç€åœ¨ x86 å¤„ç†å™¨ä¸­ï¼Œvolatile å†™çš„å¼€é”€æ¯” volatile è¯»çš„å¼€é”€ä¼šå¤§å¾ˆå¤šï¼ˆå› ä¸ºæ‰§è¡Œ StoreLoad å±éšœå¼€é”€ä¼šæ¯”è¾ƒå¤§ï¼‰ã€‚ AQS AQSæºç åˆ†æâ€”ç‹¬å æ¨¡å¼&amp;å…±äº«æ¨¡å¼ AQSåˆ†æä¸€ã€AQSåˆ†æäºŒ ç¾å›¢å›¢é˜Ÿï¼šä»ReentrantLockçš„å®ç°çœ‹AQSçš„åŸç†åŠåº”ç”¨ å…¨ç§°æ˜¯ AbstractQueuedSynchronizerï¼ˆæŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ï¼‰ï¼Œæ˜¯é€šè¿‡ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ï¼ˆå­˜å‚¨ç­‰å¾…çš„çº¿ç¨‹ï¼‰æ¥å®ç°åŒæ­¥å™¨çš„ä¸€ä¸ªæ¡†æ¶ï¼ŒLockã€ReentrantLockã€Semaphore ç­‰ç­‰éƒ½æ˜¯åŸºäº AQS å®ç°çš„ã€‚ æ•´ä½“æ¡†æ¶ ä¸Šå›¾ä¸­æœ‰é¢œè‰²çš„ä¸ºMethodï¼Œæ— é¢œè‰²çš„ä¸ºAttributionã€‚ æ€»çš„æ¥è¯´ï¼ŒAQSæ¡†æ¶å…±åˆ†ä¸ºäº”å±‚ï¼Œè‡ªä¸Šè€Œä¸‹ç”±æµ…å…¥æ·±ï¼Œä»AQSå¯¹å¤–æš´éœ²çš„APIåˆ°åº•å±‚åŸºç¡€æ•°æ®ã€‚ å½“æœ‰è‡ªå®šä¹‰åŒæ­¥å™¨æ¥å…¥æ—¶ï¼Œåªéœ€é‡å†™ç¬¬ä¸€å±‚æ‰€éœ€è¦çš„éƒ¨åˆ†æ–¹æ³•å³å¯ï¼Œä¸éœ€è¦å…³æ³¨åº•å±‚å…·ä½“çš„å®ç°æµç¨‹ã€‚å½“è‡ªå®šä¹‰åŒæ­¥å™¨è¿›è¡ŒåŠ é”æˆ–è€…è§£é”æ“ä½œæ—¶ï¼Œå…ˆç»è¿‡ç¬¬ä¸€å±‚çš„APIè¿›å…¥AQSå†…éƒ¨æ–¹æ³•ï¼Œç„¶åç»è¿‡ç¬¬äºŒå±‚è¿›è¡Œé”çš„è·å–ï¼Œæ¥ç€å¯¹äºè·å–é”å¤±è´¥çš„æµç¨‹ï¼Œè¿›å…¥ç¬¬ä¸‰å±‚å’Œç¬¬å››å±‚çš„ç­‰å¾…é˜Ÿåˆ—å¤„ç†ï¼Œè€Œè¿™äº›å¤„ç†æ–¹å¼å‡ä¾èµ–äºç¬¬äº”å±‚çš„åŸºç¡€æ•°æ®æä¾›å±‚ã€‚ ä¸‹é¢æˆ‘ä»¬ä¼šä»æ•´ä½“åˆ°ç»†èŠ‚ï¼Œä»æµç¨‹åˆ°æ–¹æ³•é€ä¸€å‰–æAQSæ¡†æ¶ï¼Œä¸»è¦åˆ†æè¿‡ç¨‹å¦‚ä¸‹ï¼š åŸç†æ¦‚è¿°AQSæ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œé‚£ä¹ˆå°±å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ï¼›å¦‚æœå…±äº«èµ„æºè¢«å ç”¨ï¼Œå°±éœ€è¦ä¸€å®šçš„é˜»å¡ç­‰å¾…å”¤é†’æœºåˆ¶æ¥ä¿è¯é”åˆ†é…ã€‚è¿™ä¸ªæœºåˆ¶ä¸»è¦ç”¨çš„æ˜¯CLHé˜Ÿåˆ—çš„å˜ä½“å®ç°çš„ï¼Œå°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚ CLHï¼šCraigã€Landin and Hagerstené˜Ÿåˆ—ï¼Œæ˜¯å•å‘é“¾è¡¨ï¼ŒAQSä¸­çš„é˜Ÿåˆ—æ˜¯CLHå˜ä½“çš„è™šæ‹ŸåŒå‘é˜Ÿåˆ—ï¼ˆFIFOï¼‰ï¼ŒAQSæ˜¯é€šè¿‡å°†æ¯æ¡è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ªèŠ‚ç‚¹æ¥å®ç°é”çš„åˆ†é…ã€‚ AQSä½¿ç”¨ä¸€ä¸ªVolatileçš„intç±»å‹çš„æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çš„æ’é˜Ÿå·¥ä½œï¼Œé€šè¿‡CASå®Œæˆå¯¹Stateå€¼çš„ä¿®æ”¹ã€‚ AQS çš„ç»“æ„å¤§æ¦‚å¯æ€»ç»“ä¸ºä»¥ä¸‹ 3 éƒ¨åˆ†ï¼š ç”¨ volatile ä¿®é¥°çš„æ•´æ•°ç±»å‹çš„ state çŠ¶æ€ï¼Œç”¨äºè¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œæä¾› getState å’Œ setState æ¥æ“ä½œåŒæ­¥çŠ¶æ€ï¼› æä¾›äº†ä¸€ä¸ª FIFO ç­‰å¾…é˜Ÿåˆ—ï¼Œå®ç°çº¿ç¨‹é—´çš„ç«äº‰å’Œç­‰å¾…ï¼Œè¿™æ˜¯ AQS çš„æ ¸å¿ƒï¼› AQS å†…éƒ¨æä¾›äº†å„ç§åŸºäº CAS åŸå­æ“ä½œæ–¹æ³•ï¼Œå¦‚ compareAndSetState æ–¹æ³•ï¼Œå¹¶ä¸”æä¾›äº†é”æ“ä½œçš„acquireå’Œreleaseæ–¹æ³•ã€‚ æ•°æ®ç»“æ„ &amp; é‡è¦å˜é‡å’Œç±»å…ˆæ¥çœ‹ä¸‹AQSä¸­æœ€åŸºæœ¬çš„æ•°æ®ç»“æ„â€”â€”Nodeï¼ŒNodeå³ä¸ºä¸Šé¢CLHå˜ä½“é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹ã€‚ 123456//AQSç­‰å¾…é˜Ÿåˆ—çš„å¤´ç»“ç‚¹ï¼ŒAQSçš„ç­‰å¾…é˜Ÿåˆ—æ˜¯åŸºäºä¸€ä¸ªåŒå‘é“¾è¡¨æ¥å®ç°çš„ï¼Œè¿™ä¸ªå¤´ç»“ç‚¹å¹¶ä¸åŒ…å«å…·ä½“çš„çº¿ç¨‹æ˜¯ä¸€ä¸ªç©ºç»“ç‚¹ï¼ˆæ³¨æ„ä¸æ˜¯nullï¼‰private transient volatile Node head;//AQSç­‰å¾…é˜Ÿåˆ—çš„å°¾éƒ¨ç»“ç‚¹private transient volatile Node tail;//AQSåŒæ­¥å™¨çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯é”çš„çŠ¶æ€ï¼Œæ³¨æ„volatileä¿®é¥°è¯æ˜è¿™ä¸ªå˜é‡çŠ¶æ€è¦å¯¹å¤šçº¿ç¨‹å¯è§private volatile int state; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849static final class Node &#123; //ä¸‹é¢ä¸¤ä¸ªå±æ€§éƒ½æ˜¯è¯´æ˜è¿™ä¸ªç»“ç‚¹æ˜¯å…±äº«æ¨¡å¼è¿˜æ˜¯ç‹¬å æ¨¡å¼ static final Node SHARED = new Node(); static final Node EXCLUSIVE = null; //ä¸‹é¢è¿™å››ä¸ªå±æ€§å°±æ˜¯è¯´æ˜ç»“ç‚¹çš„çŠ¶æ€ static final int CANCELLED = 1;//ç”±äºè¶…æ—¶æˆ–ä¸­æ–­ï¼ŒèŠ‚ç‚¹å·²è¢«å–æ¶ˆ static final int SIGNAL = -1;//è¡¨ç¤ºä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯é€šè¿‡parké˜»å¡çš„ï¼Œéœ€è¦é€šè¿‡unparkå”¤é†’ static final int CONDITION = -2;//è¡¨ç¤ºçº¿ç¨‹åœ¨ç­‰å¾…æ¡ä»¶å˜é‡ï¼ˆå…ˆè·å–é”ï¼ŒåŠ å…¥åˆ°æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ï¼Œç„¶åé‡Šæ”¾é”ï¼Œç­‰å¾…æ¡ä»¶å˜é‡æ»¡è¶³æ¡ä»¶ï¼›åªæœ‰é‡æ–°è·å–é”ä¹‹ åæ‰èƒ½è¿”å›ï¼‰ static final int PROPAGATE = -3;//è¡¨ç¤ºåç»­ç»“ç‚¹ä¼šä¼ æ’­å”¤é†’çš„æ“ä½œï¼Œå…±äº«æ¨¡å¼ä¸‹èµ·ä½œç”¨ //å½“å‰èŠ‚ç‚¹åœ¨é˜Ÿåˆ—ä¸­çš„çŠ¶æ€ï¼Œå°±æ˜¯ä¸Šè¿°å‡ ä¸ªæ•°å€¼ volatile int waitStatus; //å‰é©±ç»“ç‚¹ï¼ˆåŒé“¾è¡¨ï¼‰ volatile Node prev; //åç»§ç»“ç‚¹ï¼ˆåŒé“¾è¡¨ï¼‰ volatile Node next; // ç»“ç‚¹æ‰€åŒ…è£…çš„çº¿ç¨‹ volatile Thread thread; // å¯¹äºCondtionè¡¨ç¤ºä¸‹ä¸€ä¸ªç­‰å¾…æ¡ä»¶å˜é‡çš„èŠ‚ç‚¹ // å…¶å®ƒæƒ…å†µä¸‹ç”¨äºæ˜¯åŒºåˆ†å…±äº«æ¨¡å¼å’Œç‹¬å æ¨¡å¼ Node nextWaiter; final boolean isShared() &#123; return nextWaiter == SHARED; &#125; //å–å¾—å‰é©±ç»“ç‚¹ final Node predecessor() throws NullPointerException &#123; Node p = prev; if (p == null) //nullçš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ throw new NullPointerException(); else return p; &#125; Node() &#123; &#125; Node(Thread thread, Node mode) &#123; this.nextWaiter = mode; this.thread = thread; &#125; Node(Thread thread, int waitStatus) &#123; this.waitStatus = waitStatus; this.thread = thread; &#125; &#125; ä¸¤ç§é”æ¨¡å¼AQSæ”¯æŒä¸¤ç§é”ä¸€ç§æ˜¯ç‹¬å é”ï¼ˆç‹¬å æ¨¡å¼ï¼‰ï¼Œä¸€ç§æ˜¯å…±äº«é”ï¼ˆå…±äº«æ¨¡å¼ï¼‰ ç‹¬å é”ï¼šæ¯”å¦‚åƒReentrantLockå°±æ˜¯ä¸€ç§ç‹¬å é”æ¨¡å¼ï¼Œå¤šä¸ªçº¿ç¨‹å»åŒæ—¶æŠ¢ä¸€ä¸ªé”ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŠ¢åˆ°è¿™ä¸ªé”ï¼Œå…¶ä»–çº¿ç¨‹å°±åªèƒ½é˜»å¡ç­‰å¾…é”è¢«é‡Šæ”¾åé‡æ–°ç«äº‰é”ã€‚ å…±äº«é”ï¼šæ¯”å¦‚åƒè¯»å†™é”é‡Œé¢çš„è¯»é”ï¼Œä¸€ä¸ªé”å¯ä»¥åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼ˆå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ‹¥æœ‰è¯»é”ï¼‰ï¼Œå†æ¯”å¦‚Semaphore è®¾ç½®ä¸€ä¸ªèµ„æºæ•°ç›®ï¼ˆå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé”èƒ½åŒæ—¶è¢«å¤šå°‘ä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼‰ã€‚ å…±äº«é”è·Ÿç‹¬å é”å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œæ¯”å¦‚è¯»å†™é”ï¼Œè¯»é”ã€å†™é”åˆ†åˆ«å¯¹åº”å…±äº«é”å’Œç‹¬å é” é˜Ÿåˆ—èŠ‚ç‚¹çŠ¶æ€é˜Ÿåˆ—ä¸­çš„ Nodeï¼Œæœ‰ä¸€ä¸ª waitStatusï¼Œç”¨æ¥è¡¨ç¤ºè¯¥èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹çŠ¶æ€ã€‚ CANCELLED = 1ï¼›å–æ¶ˆçŠ¶æ€ï¼Œå¦‚æœå½“å‰çº¿ç¨‹çš„ å‰ç½®èŠ‚ç‚¹ çŠ¶æ€ä¸º CANCELLEDï¼Œåˆ™è¡¨æ˜å‰ç½®èŠ‚ç‚¹å·²ç»ç­‰å¾…è¶…æ—¶æˆ–è€…å·²ç»è¢«ä¸­æ–­äº†ï¼Œè¿™æ—¶éœ€è¦å°†å…¶ä»ç­‰å¾…é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚ SIGNAL = -1ï¼›ç­‰å¾…è§¦å‘çŠ¶æ€ï¼Œå¦‚æœå½“å‰çº¿ç¨‹çš„ å‰ç½®èŠ‚ç‚¹ çŠ¶æ€ä¸º SIGNALï¼Œåˆ™è¡¨æ˜å½“å‰çº¿ç¨‹éœ€è¦é˜»å¡ã€‚ CONDITION = -2ï¼›ç”¨äº conditionï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹é—´é€šä¿¡ï¼Œç±»ä¼¼äº Synchronized ä¸­çš„ wait/notify æœºåˆ¶ï¼Œåœ¨ Lock ä¸­æ˜¯ç”¨ condition æ¥å®Œæˆçš„ï¼Œ waitStatus = -2 è¡¨ç¤ºè¯¥çº¿ç¨‹åœ¨è¿›é˜Ÿåˆ—ä¹‹å‰å°±å·²ç»è·å–åˆ°äº†é”ï¼Œç„¶åå†åŠ å…¥åˆ°æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç„¶åé‡Šæ”¾é”èµ„æºï¼Œç­‰åˆ°æ¡ä»¶æ»¡è¶³äº†ï¼Œå°±å†æ¬¡è·å–é”ï¼Œç„¶åè¿›è¡Œçº¿ç¨‹ç›¸åº”çš„æ“ä½œã€‚ PROPAGATE = -3ï¼›çŠ¶æ€éœ€è¦å‘åä¼ æ’­ï¼Œè¡¨ç¤º releaseShared éœ€è¦è¢«ä¼ æ’­ç»™åç»­èŠ‚ç‚¹ï¼Œä»…åœ¨å…±äº«é”æ¨¡å¼ä¸‹ä½¿ç”¨ã€‚ å¯ä»¥è¿™ä¹ˆç†è§£ï¼šhead èŠ‚ç‚¹å¯ä»¥è¡¨ç¤ºæˆå½“å‰æŒæœ‰é”çš„çº¿ç¨‹çš„èŠ‚ç‚¹ï¼Œå…¶ä½™çº¿ç¨‹ç«äº‰é”å¤±è´¥åï¼Œä¼šåŠ å…¥åˆ°é˜Ÿå°¾ï¼Œtail å§‹ç»ˆæŒ‡å‘é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ã€‚ ç‹¬å æ¨¡å¼ç‹¬å é”çš„åŸç†æ˜¯å¦‚æœæœ‰çº¿ç¨‹è·å–åˆ°é”ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹åªèƒ½æ˜¯è·å–é”å¤±è´¥ï¼Œç„¶åè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«å”¤é†’ã€‚ 12345678// è·å–é”æ–¹æ³•protected boolean tryAcquire(int arg) &#123; throw new UnsupportedOperationException();&#125;// é‡Šæ”¾é”æ–¹æ³•protected boolean tryRelease(int arg) &#123; throw new UnsupportedOperationException();&#125; å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ AQS ä¸­å¹¶æ²¡æœ‰æä¾›è·å–é”å’Œé‡Šæ”¾é”çš„æ–¹æ³•ï¼Œéœ€è¦å®ç°ç±»è‡ªå·±å»å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œåœ¨è¿™é‡Œåªæ˜¯æŠ›å‡ºäº†å¼‚å¸¸è€Œå·²ã€‚ è·å–é”12345public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt();&#125; æºç è§£è¯»ï¼š é€šè¿‡ tryAcquire(arg) æ–¹æ³•å°è¯•è·å–é”ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦å®ç°ç±»è‡ªå·±å®ç°è·å–é”çš„é€»è¾‘ï¼Œè·å–é”æˆåŠŸååˆ™ä¸æ‰§è¡Œåé¢åŠ å…¥ç­‰å¾…é˜Ÿåˆ—çš„é€»è¾‘äº†ï¼› å¦‚æœå°è¯•è·å–é”å¤±è´¥åï¼Œåˆ™æ‰§è¡Œ addWaiter(Node.EXCLUSIVE) æ–¹æ³•å°†å½“å‰çº¿ç¨‹å°è£…æˆä¸€ä¸ª Node èŠ‚ç‚¹å¯¹è±¡ï¼Œå¹¶åŠ å…¥é˜Ÿåˆ—å°¾éƒ¨ï¼› æŠŠå½“å‰çº¿ç¨‹æ‰§è¡Œå°è£…æˆ Node èŠ‚ç‚¹åï¼Œç»§ç»­æ‰§è¡Œ acquireQueued çš„é€»è¾‘ï¼Œè¯¥é€»è¾‘ä¸»è¦æ˜¯åˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹æ˜¯å¦æ˜¯å¤´èŠ‚ç‚¹ï¼Œæ¥å°è¯•è·å–é”ï¼Œå¦‚æœè·å–é”æˆåŠŸï¼Œåˆ™å½“å‰èŠ‚ç‚¹å°±ä¼šæˆä¸ºæ–°çš„å¤´èŠ‚ç‚¹ï¼Œè¿™ä¹Ÿæ˜¯è·å–é”çš„æ ¸å¿ƒé€»è¾‘ã€‚ ç»§ç»­çœ‹ addWaiter(Node.EXCLUSIVE)ï¼š 12345678910111213141516171819private Node addWaiter(Node mode) &#123; // åˆ›å»ºä¸€ä¸ªåŸºäºå½“å‰çº¿ç¨‹çš„èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹æ˜¯ Node.EXCLUSIVE ç‹¬å å¼ç±»å‹ // æ³¨æ„è¿™é‡Œçš„æ„é€ å‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ NextWaiterï¼Œç”¨æ¥åŒºåˆ†æ˜¯å…±äº«æ¨¡å¼è¿˜æ˜¯ç‹¬å æ¨¡å¼ Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure Node pred = tail; // è¿™é‡Œå…ˆåˆ¤æ–­é˜Ÿå°¾æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™ç›´æ¥å°†èŠ‚ç‚¹åŠ å…¥é˜Ÿå°¾ if (pred != null) &#123; node.prev = pred; // è¿™é‡Œå¿…é¡»é‡‡ç”¨ CASï¼Œå› ä¸ºå¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹åŠ å…¥åŒæ—¶åŠ å…¥åˆ°é˜Ÿå°¾ // é‡‡å– CAS æ“ä½œï¼Œå°†å½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºé˜Ÿå°¾èŠ‚ç‚¹ï¼Œç”±äºé‡‡ç”¨äº† CAS åŸå­æ“ä½œï¼Œæ— è®ºå¹¶å‘æ€ä¹ˆä¿®æ”¹ï¼Œéƒ½æœ‰ä¸”åªæœ‰ä¸€æ¡çº¿ç¨‹å¯ä»¥ä¿®æ”¹æˆåŠŸï¼Œå…¶ä½™éƒ½å°†æ‰§è¡Œåé¢çš„enqæ–¹æ³• if (compareAndSetTail(pred, node)) &#123; pred.next = node; return node; &#125; &#125; enq(node); return node;&#125; ç®€å•æ¥è¯´ addWaiter(Node mode) æ–¹æ³•åšäº†ä»¥ä¸‹äº‹æƒ…ï¼š åˆ›å»ºåŸºäºå½“å‰çº¿ç¨‹çš„ç‹¬å å¼ç±»å‹çš„èŠ‚ç‚¹ï¼› åˆ©ç”¨ CAS åŸå­æ“ä½œï¼Œå°†èŠ‚ç‚¹åŠ å…¥é˜Ÿå°¾ã€‚ æˆ‘ä»¬ç»§ç»­çœ‹ enq(Node node) æ–¹æ³•ï¼š 12345678910111213141516171819private Node enq(final Node node) &#123; // è‡ªæ—‹æ“ä½œ for (;;) &#123; Node t = tail; // å¦‚æœé˜Ÿå°¾èŠ‚ç‚¹ä¸ºç©ºï¼Œé‚£ä¹ˆè¿›è¡ŒCASæ“ä½œåˆå§‹åŒ–é˜Ÿåˆ— if (t == null) &#123; // è¿™é‡Œå¾ˆå…³é”®ï¼Œå³å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆæ­¤æ—¶å¿…é¡»åˆå§‹åŒ–é˜Ÿåˆ—ï¼Œåˆå§‹åŒ–ä¸€ä¸ªç©ºçš„èŠ‚ç‚¹è¡¨ç¤ºé˜Ÿåˆ—å¤´ï¼Œç”¨äºè¡¨ç¤ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„èŠ‚ç‚¹ï¼Œå¤´èŠ‚ç‚¹å³è¡¨ç¤ºå½“å‰æ­£åœ¨è¿è¡Œçš„èŠ‚ç‚¹ if (compareAndSetHead(new Node())) tail = head; &#125; else &#123; node.prev = t; // è¿™ä¸€æ­¥ä¹Ÿæ˜¯é‡‡å–CASæ“ä½œï¼Œå°†å½“å‰èŠ‚ç‚¹åŠ å…¥é˜Ÿå°¾ï¼Œå¦‚æœå¤±è´¥çš„è¯ï¼Œè‡ªæ—‹ç»§ç»­ä¿®æ”¹ç›´åˆ°æˆåŠŸä¸ºæ­¢ if (compareAndSetTail(t, node)) &#123; t.next = node; return t; &#125; &#125; &#125;&#125; enq(Node node)ä¸»è¦åšäº†ä¸‰ä»¶äº‹ï¼š é‡‡ç”¨äº†è‡ªæ—‹æœºåˆ¶ï¼Œæ²¡æˆåŠŸå°±ä¸€ç›´å¾ªç¯è¿›è¡Œ è‹¥é˜Ÿå°¾èŠ‚ç‚¹ä¸ºç©ºï¼Œå°±å…ˆåˆå§‹åŒ–é˜Ÿåˆ—ï¼Œç„¶åå› ä¸ºè‡ªæ—‹ï¼Œå†åœ¨ head èŠ‚ç‚¹åå°†å½“å‰èŠ‚ç‚¹åŠ å…¥é˜Ÿå°¾ è‹¥å¯¹å°¾ç»“ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™é‡‡å– CAS ï¼Œå°†å½“å‰èŠ‚ç‚¹åŠ å…¥é˜Ÿå°¾ æ³¨æ„è¿”å›å€¼æ˜¯å½“å‰èŠ‚ç‚¹çš„ pred èŠ‚ç‚¹ 123456789101112131415161718192021222324252627final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; // çº¿ç¨‹ä¸­æ–­æ ‡è®°å­—æ®µ boolean interrupted = false; for (;;) &#123; // è·å–å½“å‰èŠ‚ç‚¹çš„ pred èŠ‚ç‚¹ final Node p = node.predecessor(); // å¦‚æœ pred èŠ‚ç‚¹ä¸º head èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå†æ¬¡å°è¯•è·å–é” if (p == head &amp;&amp; tryAcquire(arg)) &#123; // è·å–é”ä¹‹åï¼Œé‚£ä¹ˆå½“å‰èŠ‚ç‚¹ä¹Ÿå°±æˆä¸ºäº† head èŠ‚ç‚¹ setHead(node); p.next = null; // help GC failed = false; // ä¸éœ€è¦æŒ‚èµ·ï¼Œè¿”å› false return interrupted; &#125; // è·å–é”å¤±è´¥ï¼Œåˆ™è¿›å…¥æŒ‚èµ·é€»è¾‘ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; acquireQueued ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š åˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„ pred èŠ‚ç‚¹æ˜¯å¦æ˜¯ head èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯ï¼Œè¯´æ˜ä¸‹ä¸€ä¸ªæ‰§è¡Œçš„çº¿ç¨‹å°±æ˜¯è¯¥çº¿ç¨‹ï¼Œæ‰€ä»¥å°±å¯ä»¥å»å°è¯•è·å–é”ï¼ˆè‡ªæ—‹çš„è¿‡ç¨‹ï¼‰ï¼Œå¦‚æœè·å–äº†é”ï¼Œå°±å°†å½“å‰èŠ‚ç‚¹ç½®ä¸º headï¼› è·å–é”å¦‚æœå¤±è´¥äº†ï¼Œå°±å¾—è¿›å…¥æŒ‚èµ·é€»è¾‘ï¼Œå³è¿›å…¥ shouldParkAfterFailedAcquire(p, node)ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­çœ‹æŒ‚èµ·é€»è¾‘ï¼š 123456789101112131415161718private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) &#123; int ws = pred.waitStatus; if (ws == Node.SIGNAL) // å¦‚æœ pred èŠ‚ç‚¹ä¸º SIGNAL çŠ¶æ€ï¼Œè¿”å›trueï¼Œè¯´æ˜å½“å‰èŠ‚ç‚¹éœ€è¦æŒ‚èµ· return true; // å¦‚æœws &gt; 0,è¯´æ˜èŠ‚ç‚¹çŠ¶æ€ä¸ºCANCELLEDï¼Œéœ€è¦ä»é˜Ÿåˆ—ä¸­åˆ é™¤ if (ws &gt; 0) &#123; do &#123; node.prev = pred = pred.prev; &#125; while (pred.waitStatus &gt; 0); pred.next = node; &#125; else &#123; // å¦‚æœæ˜¯å…¶å®ƒçŠ¶æ€ï¼Œåˆ™æ“ä½œCASç»Ÿä¸€æ”¹æˆSIGNALçŠ¶æ€ // ç”±äºè¿™é‡ŒwaitStatusçš„å€¼åªèƒ½æ˜¯0æˆ–è€…PROPAGATEï¼Œæ‰€ä»¥æˆ‘ä»¬å°†èŠ‚ç‚¹è®¾ç½®ä¸ºSIGNALï¼Œé‡æ–°å¾ªç¯ä¸€æ¬¡åˆ¤æ–­ compareAndSetWaitStatus(pred, ws, Node.SIGNAL); &#125; return false;&#125; shouldParkAfterFailedAcquire(Node pred, Node node) ä¸»è¦åšäº†ä¸‰ä»¶äº‹ï¼š åˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„ pred çš„ waitStatus æ˜¯å¦ä¸º SIGNALï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¯´æ˜å½“å‰èŠ‚ç‚¹å¯ä»¥æŒ‚èµ·ï¼› å¦‚æœä¸æ˜¯ SIGNAL çŠ¶æ€ï¼Œè‹¥æ˜¯ CANCELLED çŠ¶æ€ï¼Œåˆ™éœ€è¦å°†è¯¥èŠ‚ç‚¹ä»é˜Ÿåˆ—ä¸­åˆ é™¤ï¼› å¦åˆ™ï¼Œéœ€è¦å°†è¯¥èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹ç½®ä¸º SIGNALï¼Œå†ä» acquireQueued æ–¹æ³•è‡ªæ—‹æ“ä½œå¾ªç¯ä¸€æ¬¡åˆ¤æ–­ã€‚ é€šä¿—æ¥è¯´å°±æ˜¯ï¼šæ ¹æ® pred èŠ‚ç‚¹çŠ¶æ€æ¥åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦å¯ä»¥æŒ‚èµ·ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å› falseï¼Œé‚£ä¹ˆæŒ‚èµ·æ¡ä»¶è¿˜æ²¡å‡†å¤‡å¥½ï¼Œå°±ä¼šé‡æ–°è¿›å…¥ acquireQueued(final Node node, int arg) çš„è‡ªæ—‹ä½“ï¼Œé‡æ–°è¿›è¡Œåˆ¤æ–­ã€‚å¦‚æœè¿”å› trueï¼Œé‚£å°±è¯´æ˜å½“å‰çº¿ç¨‹å¯ä»¥è¿›è¡ŒæŒ‚èµ·æ“ä½œäº†ï¼Œé‚£ä¹ˆå°±ä¼šç»§ç»­æ‰§è¡ŒæŒ‚èµ·ã€‚ ç»§ç»­çœ‹æŒ‚èµ·é€»è¾‘ï¼š 1234private final boolean parkAndCheckInterrupt() &#123; LockSupport.park(this); return Thread.interrupted();&#125; LockSupport æ˜¯ç”¨æ¥åˆ›å»ºé”å’Œå…¶ä»–åŒæ­¥ç±»çš„åŸºæœ¬çº¿ç¨‹é˜»å¡åŸè¯­ã€‚LockSupport æä¾› park() å’Œ unpark() æ–¹æ³•å®ç°é˜»å¡çº¿ç¨‹å’Œè§£é™¤çº¿ç¨‹é˜»å¡ã€‚release é‡Šæ”¾é”æ–¹æ³•é€»è¾‘ä¼šè°ƒç”¨ LockSupport.unPark æ–¹æ³•æ¥å”¤é†’åç»§èŠ‚ç‚¹ã€‚ æœ€åçœ‹ä¸€ä¸‹ cancelAcquire()ï¼š 12345678910111213141516171819202122232425262728293031323334353637// java.util.concurrent.locks.AbstractQueuedSynchronizerprivate void cancelAcquire(Node node) &#123; // å°†æ— æ•ˆèŠ‚ç‚¹è¿‡æ»¤ if (node == null) return; // è®¾ç½®è¯¥èŠ‚ç‚¹ä¸å…³è”ä»»ä½•çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è™šèŠ‚ç‚¹ node.thread = null; Node pred = node.prev; // é€šè¿‡å‰é©±èŠ‚ç‚¹ï¼Œè·³è¿‡å–æ¶ˆçŠ¶æ€çš„node while (pred.waitStatus &gt; 0) node.prev = pred = pred.prev; // è·å–è¿‡æ»¤åçš„å‰é©±èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ Node predNext = pred.next; // æŠŠå½“å‰nodeçš„çŠ¶æ€è®¾ç½®ä¸ºCANCELLED node.waitStatus = Node.CANCELLED; // å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯å°¾èŠ‚ç‚¹ï¼Œå°†ä»åå¾€å‰çš„ç¬¬ä¸€ä¸ªéå–æ¶ˆçŠ¶æ€çš„èŠ‚ç‚¹è®¾ç½®ä¸ºå°¾èŠ‚ç‚¹ // æ›´æ–°å¤±è´¥çš„è¯ï¼Œåˆ™è¿›å…¥elseï¼Œå¦‚æœæ›´æ–°æˆåŠŸï¼Œå°†tailçš„åç»§èŠ‚ç‚¹è®¾ç½®ä¸ºnull if (node == tail &amp;&amp; compareAndSetTail(node, pred)) &#123; compareAndSetNext(pred, predNext, null); &#125; else &#123; int ws; // å¦‚æœå½“å‰èŠ‚ç‚¹ä¸æ˜¯headçš„åç»§èŠ‚ç‚¹ //1:åˆ¤æ–­å½“å‰èŠ‚ç‚¹å‰é©±èŠ‚ç‚¹çš„æ˜¯å¦ä¸ºSIGNALï¼Œ2:å¦‚æœä¸æ˜¯ï¼Œåˆ™æŠŠå‰é©±èŠ‚ç‚¹è®¾ç½®ä¸ºSINGALçœ‹æ˜¯å¦æˆåŠŸ // å¦‚æœ1å’Œ2ä¸­æœ‰ä¸€ä¸ªä¸ºtrueï¼Œå†åˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„çº¿ç¨‹æ˜¯å¦ä¸ºnull // å¦‚æœä¸Šè¿°æ¡ä»¶éƒ½æ»¡è¶³ï¼ŒæŠŠå½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹çš„åç»§æŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ if (pred != head &amp;&amp; ((ws = pred.waitStatus) == Node.SIGNAL || (ws &lt;= 0 &amp;&amp; compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) &amp;&amp; pred.thread != null) &#123; Node next = node.next; if (next != null &amp;&amp; next.waitStatus &lt;= 0) compareAndSetNext(pred, predNext, next); &#125; else &#123; // å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯headçš„åç»§èŠ‚ç‚¹ï¼Œæˆ–è€…ä¸Šè¿°æ¡ä»¶ä¸æ»¡è¶³ï¼Œé‚£å°±å”¤é†’å½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ unparkSuccessor(node); &#125; node.next = node; // help GC &#125;&#125; å…·ä½“å¯å‚è€ƒï¼š https://tech.meituan.com/2019/12/05/aqs-theory-and-apply.html æ•´ä½“é€»è¾‘å›¾å¦‚ä¸‹ï¼š é‡Šæ”¾é”123456789public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) unparkSuccessor(h); return true; &#125; return false;&#125; æ€è·¯è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œå…ˆå°è¯•é‡Šæ”¾é”ï¼Œè¿™ä¸ª tryRelease() éœ€è¦è‡ªå·±å®ç°ï¼Œå¦‚æœå¤´ç»“ç‚¹ä¸ä¸ºç©ºï¼Œä¸” waitStatus != 0 ï¼ˆå› ä¸º addWaiter æ–¹æ³•é»˜è®¤çš„èŠ‚ç‚¹çŠ¶æ€ä¸º 0ï¼Œä¸º 0 è¯´æ˜æ­¤æ—¶èŠ‚ç‚¹è¿˜æ²¡æœ‰è¿›å…¥å°±ç»ªçŠ¶æ€ï¼‰ï¼Œå°±å¯ä»¥æ‰§è¡Œå”¤é†’ä¸‹ä¸ªèŠ‚ç‚¹çš„æ“ä½œã€‚ 123456789101112131415161718192021private void unparkSuccessor(Node node) &#123; int ws = node.waitStatus; if (ws &lt; 0) // å°†å¤´èŠ‚ç‚¹çš„çŠ¶æ€è®¾ç½®ä¸º0 // è¿™é‡Œä¼šå°è¯•æ¸…é™¤å¤´èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œæ”¹ä¸ºåˆå§‹çŠ¶æ€ compareAndSetWaitStatus(node, ws, 0); // åç»§èŠ‚ç‚¹ Node s = node.next; // å¦‚æœåç»§èŠ‚ç‚¹ä¸ºnullï¼Œæˆ–è€…å·²ç»è¢«å–æ¶ˆäº† if (s == null || s.waitStatus &gt; 0) &#123; s = null; // forå¾ªç¯ä»é˜Ÿåˆ—å°¾éƒ¨ä¸€ç›´å¾€å‰æ‰¾å¯ä»¥å”¤é†’çš„èŠ‚ç‚¹ for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; &#125; if (s != null) // å”¤é†’åç»§èŠ‚ç‚¹ LockSupport.unpark(s.thread);&#125; unparkSuccessor(Node node) ä¸»è¦åšäº†äºŒä»¶äº‹ï¼š å°†å¤´ç»“ç‚¹çš„ waitStatus ç½®ä¸ºåˆå§‹çŠ¶æ€ 0 ï¼› æ‰¾åç»§èŠ‚ç‚¹ï¼Œå¦‚æœåç»§èŠ‚ç‚¹æ˜¯ null æˆ–è€… waitStatus = Node.Cancelledï¼Œå°±ç›´æ¥ä»é˜Ÿå°¾å¼€å§‹å‘å‰éå†ï¼Œæ‰¾åˆ°æœ€é è¿‘å¤´ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶å”¤é†’ã€‚ å…±äº«æ¨¡å¼è·å–é”123456public final void acquireShared(int arg) &#123; // å°è¯•è·å–å…±äº«é”ï¼Œå°äº0è¡¨ç¤ºè·å–å¤±è´¥ if (tryAcquireShared(arg) &lt; 0) // æ‰§è¡Œè·å–é”å¤±è´¥çš„é€»è¾‘ doAcquireShared(arg);&#125; è·Ÿç‹¬å æ¨¡å¼å·®ä¸å¤šï¼Œ tryAcquireShared() éœ€è¦å®ç°ç±»è‡ªå·±å»å®ç°ï¼Œè¿™é‡Œåªè¦ &gt;=0 è¯´æ˜å…±äº«é”çš„èµ„æºè¿˜æœ‰ï¼Œå°±è¯´æ˜è·å–é”æˆåŠŸï¼Œå¦åˆ™å°±æ‰§è¡Œè·å–é”å¤±è´¥çš„é€»è¾‘ã€‚ 1234567891011121314151617181920212223242526272829303132private void doAcquireShared(int arg) &#123; // æ·»åŠ å…±äº«é”ç±»å‹èŠ‚ç‚¹åˆ°é˜Ÿåˆ—ä¸­ final Node node = addWaiter(Node.SHARED); boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); if (p == head) &#123; // å†æ¬¡å°è¯•è·å–å…±äº«é” int r = tryAcquireShared(arg); // å¦‚æœåœ¨è¿™é‡ŒæˆåŠŸè·å–å…±äº«é”ï¼Œä¼šè¿›å…¥å…±äº«é”å”¤é†’é€»è¾‘ if (r &gt;= 0) &#123; // å…±äº«é”å”¤é†’é€»è¾‘ setHeadAndPropagate(node, r); p.next = null; // help GC if (interrupted) selfInterrupt(); failed = false; return; &#125; &#125; // ä¸ç‹¬å é”ç›¸åŒçš„æŒ‚èµ·é€»è¾‘ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; è·Ÿç‹¬å é”åŸºæœ¬ä¸€æ ·çš„é€»è¾‘ï¼Œä¹Ÿæ˜¯å…ˆå°†è¯¥çº¿ç¨‹åŒ…è£…æˆ Nodeï¼ŒåŠ å…¥é˜Ÿå°¾ï¼Œç„¶åä¸æ–­è‡ªæ—‹ï¼Œåˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹æ˜¯å¦ä¸º headï¼Œå¦‚æœæ˜¯ headï¼Œå°±å°è¯•è·å–é”ï¼Œå½“ç„¶è¿™é‡Œæœ‰ä¸€ä¸ªä¸åŒçš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯åŸæ¥çš„ setHead() å˜æˆäº† setHeadAndPropagate()ï¼Œå› ä¸ºè¿™é‡Œä¸ä»…è¦å°†è·å–åˆ°é”çš„èŠ‚ç‚¹ç½®ä¸ºå¤´ç»“ç‚¹ï¼ŒåŒæ—¶åªè¦å…±äº«é”è¿˜æ‹¥æœ‰èµ„æºï¼Œå°±éœ€è¦å»å”¤é†’åç»­å…±äº«é”èŠ‚ç‚¹ã€‚ä¸‹é¢æˆ‘ä»¬å…·ä½“çœ‹çœ‹ setHeadAndPropagate(node, r)ã€‚ 12345678910111213141516private void setHeadAndPropagate(Node node, int propagate) &#123; // å¤´èŠ‚ç‚¹ Node h = head; // è®¾ç½®å½“å‰èŠ‚ç‚¹ä¸ºæ–°çš„å¤´èŠ‚ç‚¹ // è¿™é‡Œä¸éœ€è¦åŠ é”æ“ä½œï¼Œå› ä¸ºè·å–å…±äº«é”åï¼Œä¼šä»FIFOé˜Ÿåˆ—ä¸­ä¾æ¬¡å”¤é†’é˜Ÿåˆ—ï¼Œå¹¶ä¸ä¼šäº§ç”Ÿå¹¶å‘å®‰å…¨é—®é¢˜ setHead(node); if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 || (h = head) == null || h.waitStatus &lt; 0) &#123; // åç»§èŠ‚ç‚¹ Node s = node.next; // å¦‚æœåç»§èŠ‚ç‚¹ä¸ºç©ºæˆ–è€…åç»§èŠ‚ç‚¹ä¸ºå…±äº«ç±»å‹ï¼Œåˆ™è¿›è¡Œå”¤é†’åç»§èŠ‚ç‚¹ // è¿™é‡Œåç»§èŠ‚ç‚¹ä¸ºç©ºæ„æ€æ˜¯åªå‰©ä¸‹å½“å‰å¤´èŠ‚ç‚¹äº† if (s == null || s.isShared()) doReleaseShared(); &#125;&#125; ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š å°†å½“å‰èŠ‚ç‚¹ç½®ä¸º headï¼Œè¿™ä¸ªè·Ÿç‹¬å é”æ˜¯ä¸€æ ·çš„ï¼› å¯»æ‰¾åç»­çš„å…±äº«é”çº¿ç¨‹ï¼Œç„¶åå°†å…¶å”¤é†’ã€‚ æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œè¿™é‡Œå”¤é†’è°ƒç”¨çš„æ˜¯ doReleaseShared()ï¼Œä¹Ÿå°±æ˜¯è¯´é‡Šæ”¾å…±äº«é”ä¹Ÿæ˜¯è°ƒç”¨çš„è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆæ˜¯æ€ä¹ˆåšåˆ°å”¤é†’å¤šä¸ªæ‹¥æœ‰å…±äº«é”çº¿ç¨‹å‘¢ï¼Ÿæˆ‘ä»¬æ³¨æ„åˆ°é¦–å…ˆæ˜¯å°†å½“å‰è·å–åˆ°é”çš„çº¿ç¨‹ç½®ä¸º headï¼Œç„¶ååªè¦è¿˜æœ‰èµ„æºï¼Œå°±å”¤é†’è¯¥çº¿ç¨‹ï¼Œ é‡Šæ”¾é”123456789public final boolean releaseShared(int arg) &#123; // ç”±ç”¨æˆ·è‡ªè¡Œå®ç°é‡Šæ”¾é”æ¡ä»¶ if (tryReleaseShared(arg)) &#123; // æ‰§è¡Œé‡Šæ”¾é” doReleaseShared(); return true; &#125; return false;&#125; 1234567891011121314151617181920212223242526272829303132private void doReleaseShared() &#123; for (;;) &#123; // ä»å¤´èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œå”¤é†’æ“ä½œ // è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¦‚æœä»setHeadAndPropagateæ–¹æ³•è°ƒç”¨è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™é‡Œçš„headæ˜¯æ–°çš„å¤´èŠ‚ç‚¹ Node h = head; if (h != null &amp;&amp; h != tail) &#123; int ws = h.waitStatus; //è¡¨ç¤ºåç»§èŠ‚ç‚¹éœ€è¦è¢«å”¤é†’ if (ws == Node.SIGNAL) &#123; // åˆå§‹åŒ–èŠ‚ç‚¹çŠ¶æ€ //è¿™é‡Œéœ€è¦CASåŸå­æ“ä½œï¼Œå› ä¸ºsetHeadAndPropagateå’ŒreleaseSharedè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šé¡¶ç”¨doReleaseSharedï¼Œé¿å…ä¸¤æ¬¡unparkå”¤é†’æ“ä½œ if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) // å¦‚æœåˆå§‹åŒ–èŠ‚ç‚¹çŠ¶æ€å¤±è´¥ï¼Œç»§ç»­å¾ªç¯æ‰§è¡Œ continue; // loop to recheck cases // æ‰§è¡Œå”¤é†’æ“ä½œ // æ³¨æ„è¿™é‡Œæ˜¯å”¤é†’å¤´ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ // å”¤é†’äº†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¹‹åï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹å°±ä¼šå»å°è¯•è·å–é”ï¼Œå½¢æˆä¸€ä¸ªå¾ªç¯ unparkSuccessor(h); &#125; // è¿™é‡Œä¸ªäººè®¤ä¸ºæ˜¯ä¸º setHeadAndPropagate()ä¸­ s == nullå‡†å¤‡çš„ï¼Œå½“åªæœ‰å¤´ç»“ç‚¹çš„æ—¶å€™ // åç»§èŠ‚ç‚¹æ²¡æœ‰æ‰€ä»¥ä¸éœ€è¦å”¤é†’ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»æŠŠè¿™ç§å¯ä¼ é€’çš„çŠ¶æ€æ˜¾ç¤ºè¡¨ç°å‡ºæ¥ // ç¡®ä¿åç»­å¯ä»¥ä¼ é€’ç»™åç»§èŠ‚ç‚¹ else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) continue; // loop on failed CAS &#125; // å¦‚æœåœ¨å”¤é†’çš„è¿‡ç¨‹ä¸­å¤´èŠ‚ç‚¹æ²¡æœ‰æ›´æ”¹ï¼Œé€€å‡ºå¾ªç¯ // è¿™é‡Œé˜²æ­¢å…¶å®ƒçº¿ç¨‹åˆè®¾ç½®äº†å¤´èŠ‚ç‚¹ï¼Œè¯´æ˜å…¶å®ƒçº¿ç¨‹è·å–äº†å…±äº«é”ï¼Œä¼šç»§ç»­å¾ªç¯æ“ä½œ if (h == head) // loop if head changed break; &#125;&#125; æ³¨ï¼šä¸Šé¢çš„setHeadAndPropagate()æ–¹æ³•è¡¨ç¤ºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹æˆåŠŸè·å–åˆ°å…±äº«é”ï¼Œè¿™æ—¶å€™å®ƒéœ€è¦è°ƒç”¨doReleaseShared() å”¤é†’å®ƒåé¢çš„å…±äº«èŠ‚ç‚¹ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œä½†æ˜¯å½“é€šè¿‡ releaseShared() æ–¹æ³•å»è°ƒç”¨doReleaseShared() é‡Šæ”¾ä¸€ä¸ªå…±äº«é”çš„æ—¶å€™ï¼Œæ¥ä¸‹æ¥ç­‰å¾…ç‹¬å é”è·Ÿå…±äº«é”çš„çº¿ç¨‹éƒ½å¯ä»¥è¢«å”¤é†’è¿›è¡Œå°è¯•è·å–ã€‚ æ€»ç»“é€»è¾‘å›¾ è·å–é”çš„è¿‡ç¨‹ï¼š å½“çº¿ç¨‹è°ƒç”¨acquireShared()ç”³è¯·è·å–é”èµ„æºæ—¶ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¿›å…¥ä¸´ç•ŒåŒºã€‚ å½“è·å–é”å¤±è´¥æ—¶ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªå…±äº«ç±»å‹çš„èŠ‚ç‚¹å¹¶è¿›å…¥ä¸€ä¸ªFIFOç­‰å¾…é˜Ÿåˆ—ï¼Œç„¶åè¢«æŒ‚èµ·ç­‰å¾…å”¤é†’ã€‚ å½“é˜Ÿåˆ—ä¸­çš„ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ä»¥åå°±é‡æ–°å°è¯•è·å–é”èµ„æºï¼Œå¦‚æœæˆåŠŸåˆ™å”¤é†’åé¢è¿˜åœ¨ç­‰å¾…çš„å…±äº«èŠ‚ç‚¹å¹¶æŠŠè¯¥å”¤é†’äº‹ä»¶ä¼ é€’ä¸‹å»ï¼Œå³ä¼šä¾æ¬¡å”¤é†’åœ¨è¯¥èŠ‚ç‚¹åé¢çš„æ‰€æœ‰å…±äº«èŠ‚ç‚¹ï¼Œç„¶åè¿›å…¥ä¸´ç•ŒåŒºï¼Œå¦åˆ™ç»§ç»­æŒ‚èµ·ç­‰å¾…ã€‚ é‡Šæ”¾é”è¿‡ç¨‹ï¼š å½“çº¿ç¨‹è°ƒç”¨releaseShared()è¿›è¡Œé”èµ„æºé‡Šæ”¾æ—¶ï¼Œå¦‚æœé‡Šæ”¾æˆåŠŸï¼Œåˆ™å”¤é†’é˜Ÿåˆ—ä¸­ç­‰å¾…çš„èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰çš„è¯ã€‚ æ¯”è¾ƒè·Ÿç‹¬å é”ç›¸æ¯”ï¼Œå…±äº«é”çš„ä¸»è¦ç‰¹å¾åœ¨äºå½“ä¸€ä¸ªåœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„å…±äº«èŠ‚ç‚¹æˆåŠŸè·å–åˆ°é”ä»¥åï¼ˆå®ƒè·å–åˆ°çš„æ˜¯å…±äº«é”ï¼‰ï¼Œæ—¢ç„¶æ˜¯å…±äº«ï¼Œé‚£å®ƒå¿…é¡»è¦ä¾æ¬¡å”¤é†’åé¢æ‰€æœ‰å¯ä»¥è·Ÿå®ƒä¸€èµ·å…±äº«å½“å‰é”èµ„æºçš„èŠ‚ç‚¹ï¼Œæ¯«æ— ç–‘é—®ï¼Œè¿™äº›èŠ‚ç‚¹å¿…é¡»ä¹Ÿæ˜¯åœ¨ç­‰å¾…å…±äº«é”ï¼ˆè¿™æ˜¯å¤§å‰æï¼Œå¦‚æœç­‰å¾…çš„æ˜¯ç‹¬å é”ï¼Œé‚£å‰é¢å·²ç»æœ‰ä¸€ä¸ªå…±äº«èŠ‚ç‚¹è·å–é”äº†ï¼Œå®ƒè‚¯å®šæ˜¯è·å–ä¸åˆ°çš„ï¼‰ã€‚å½“å…±äº«é”è¢«é‡Šæ”¾çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨è¯»å†™é”ä¸ºä¾‹è¿›è¡Œæ€è€ƒï¼Œå½“ä¸€ä¸ªè¯»é”è¢«é‡Šæ”¾ï¼Œæ­¤æ—¶ä¸è®ºæ˜¯è¯»é”è¿˜æ˜¯å†™é”éƒ½æ˜¯å¯ä»¥ç«äº‰èµ„æºçš„ã€‚ https://juejin.im/post/5cd2b58f6fb9a032332b45aa https://www.cnblogs.com/lfls/p/7599863.html é¢è¯•é¢˜ç›®Qï¼šæŸä¸ªçº¿ç¨‹è·å–é”å¤±è´¥çš„åç»­æµç¨‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ Aï¼šå­˜åœ¨æŸç§æ’é˜Ÿç­‰å€™æœºåˆ¶ï¼Œçº¿ç¨‹ç»§ç»­ç­‰å¾…ï¼Œä»ç„¶ä¿ç•™è·å–é”çš„å¯èƒ½ï¼Œè·å–é”æµç¨‹ä»åœ¨ç»§ç»­ã€‚ Qï¼šæ—¢ç„¶è¯´åˆ°äº†æ’é˜Ÿç­‰å€™æœºåˆ¶ï¼Œé‚£ä¹ˆå°±ä¸€å®šä¼šæœ‰æŸç§é˜Ÿåˆ—å½¢æˆï¼Œè¿™æ ·çš„é˜Ÿåˆ—æ˜¯ä»€ä¹ˆæ•°æ®ç»“æ„å‘¢ï¼Ÿ Aï¼šæ˜¯CLHå˜ä½“çš„FIFOåŒç«¯é˜Ÿåˆ—ã€‚ Qï¼šå¤„äºæ’é˜Ÿç­‰å€™æœºåˆ¶ä¸­çš„çº¿ç¨‹ï¼Œä»€ä¹ˆæ—¶å€™å¯ä»¥æœ‰æœºä¼šè·å–é”å‘¢ï¼Ÿ Aï¼šå½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹ä¸º headï¼Œå¯ä»¥å°è¯•è·å–é”ã€‚ Qï¼šå¦‚æœå¤„äºæ’é˜Ÿç­‰å€™æœºåˆ¶ä¸­çš„çº¿ç¨‹ä¸€ç›´æ— æ³•è·å–é”ï¼Œéœ€è¦ä¸€ç›´ç­‰å¾…ä¹ˆï¼Ÿè¿˜æ˜¯æœ‰åˆ«çš„ç­–ç•¥æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Ÿ Aï¼šçº¿ç¨‹æ‰€åœ¨èŠ‚ç‚¹çš„çŠ¶æ€ä¼šå˜æˆå–æ¶ˆçŠ¶æ€ï¼Œå–æ¶ˆçŠ¶æ€çš„èŠ‚ç‚¹ä¼šä»é˜Ÿåˆ—ä¸­é‡Šæ”¾ã€‚ Qï¼šLockå‡½æ•°é€šè¿‡Acquireæ–¹æ³•è¿›è¡ŒåŠ é”ï¼Œä½†æ˜¯å…·ä½“æ˜¯å¦‚ä½•åŠ é”çš„å‘¢ï¼Ÿ Aï¼šAQSçš„Acquireä¼šè°ƒç”¨tryAcquireæ–¹æ³•ï¼ŒtryAcquireç”±å„ä¸ªè‡ªå®šä¹‰åŒæ­¥å™¨å®ç°ï¼Œé€šè¿‡tryAcquireå®ŒæˆåŠ é”è¿‡ç¨‹ã€‚ Tip: è‡ªæˆ‘å®ç°ä¸€ä¸ªé”ï¼Œåˆ©ç”¨ AQS 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110package å¤šçº¿ç¨‹.ConcurrentåŒ…ç†è§£;import java.io.IOException;import java.io.ObjectInputStream;import java.util.concurrent.TimeUnit;import java.util.concurrent.locks.AbstractQueuedSynchronizer;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;public class AQS &#123; public static void main(String[] args) &#123; return; &#125;&#125;class MutexDemo &#123; private static Mutex mutex = new Mutex(); public static void main(String[] args) &#123; for (int i = 0; i &lt; 10 ; i++)&#123; Thread thread = new Thread(() -&gt; &#123; mutex.lock(); try &#123; System.out.println("Current Thread:" + Thread.currentThread().getName()); Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; mutex.unlock(); &#125; &#125;); thread.start(); &#125; &#125;&#125;class Mutex implements Lock, java.io.Serializable &#123; // Our internal helper class private static class Sync extends AbstractQueuedSynchronizer &#123; // Reports whether in locked state protected boolean isHeldExclusively() &#123; return getState() == 1; &#125; public boolean tryAcquire(int acquires) &#123; assert acquires == 1; // Otherwise unused if (compareAndSetState(0, 1)) &#123; setExclusiveOwnerThread(Thread.currentThread()); return true; &#125; return false; &#125; protected boolean tryRelease(int releases) &#123; assert releases == 1; // Otherwise unused if (getState() == 0) throw new IllegalMonitorStateException(); setExclusiveOwnerThread(null); setState(0); return true; &#125; // Provides a Condition Condition newCondition() &#123; return new ConditionObject(); &#125; // Deserializes properly ååºåˆ—åŒ– private void readObject(ObjectInputStream s) throws IOException, ClassNotFoundException &#123; s.defaultReadObject(); setState(0); // reset to unlocked state &#125; &#125; // The sync object does all the hard work. We just forward to it. private final Sync sync = new Sync(); public void lock() &#123; sync.acquire(1); &#125; public boolean tryLock() &#123; return sync.tryAcquire(1); &#125; public void unlock() &#123; sync.release(1); &#125; public Condition newCondition() &#123; return sync.newCondition(); &#125; public boolean isLocked() &#123; return sync.isHeldExclusively(); &#125; public boolean hasQueuedThreads() &#123; return sync.hasQueuedThreads(); &#125; public void lockInterruptibly() throws InterruptedException &#123; sync.acquireInterruptibly(1); &#125; public boolean tryLock(long timeout, TimeUnit unit) throws InterruptedException &#123; return sync.tryAcquireNanos(1, unit.toNanos(timeout)); &#125;&#125; ReentrantLock å¯é‡å…¥æ€§ã€å…¬å¹³ä¸éå…¬å¹³ ReentranLockçš„ç‰¹ç‚¹ é‡ç‚¹è¿˜æ˜¯ï¼š å¯é‡å…¥æ€§çš„å®ç° å…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ« å…¶ä»–çš„åŸºæœ¬ä¸Šå°±æ˜¯ AQS çš„ç‹¬å é”å®ç°è€Œå·² å¯é‡å…¥æ€§çš„å®ç°åœ¨å¯é‡å…¥æ€§æ–¹é¢ï¼Œä¸ªäººè§‰å¾—è¿˜æ˜¯é’ˆå¯¹äºåŒä¸€æŠŠé”è€Œè¨€çš„ï¼Œä¸åŒé”å»è°ˆé‡å…¥æ€§æ²¡æœ‰æ„ä¹‰ï¼Œä½†æ˜¯æœ‰ä¸ªç‰¹ä¾‹ï¼Œå°±æ˜¯ ReentrantReadWriteLockï¼Œå› ä¸ºå…¶ ReadLock å’Œ WriteLock æ˜¯å±äºåŒä¸€æŠŠå¤§é”ä¸‹çš„ä¸¤æŠŠå°é”ï¼Œå®ƒä»¬ä¹‹é—´çš„é‡å…¥æ€§æœ‰äº›ç‰¹æ®Šï¼Œä¹Ÿå°±æ˜¯åŒä¸€æŠŠå†™é”è‚¯å®šæ˜¯å¯ä»¥é‡å…¥çš„ï¼ŒåŒä¸€æŠŠè¯»é”è‚¯å®šä¹Ÿæ˜¯å¯ä»¥é‡å…¥çš„ï¼Œä½†æ˜¯æ³¨æ„çš„æ˜¯è¯»é”ä¸‹ä¸å¯é‡å…¥å†™é”ï¼Œå› ä¸ºè¯»-å†™äº’æ–¥ï¼Œä½†æ˜¯æœ‰ä¸ªé”é™çº§ï¼Œä¹Ÿå°±æ˜¯ å†™é”å¯ä»¥é‡å…¥è¯»é”ï¼Œå°†å†™é”é™çº§ä¸ºè¯»é”ï¼ˆå…ˆè·å–å†™é”ï¼Œç„¶åè·å–è¯»é”ï¼Œç„¶åé‡Šæ”¾å†™é”ï¼Œç„¶åå†é‡Šæ”¾è¯»é”ï¼‰ã€‚ è¨€å½’æ­£ä¼ ï¼Œä¸åŒé”çš„ ReentrantLockï¼Œä¹‹é—´ä¸ä¼šæœ‰å½±å“ï¼Œ ç±»ä¼¼äºä¸‹é¢çš„ demoï¼š 123456789101112131415161718192021222324252627282930package å¤šçº¿ç¨‹.ConcurrentåŒ…ç†è§£;import java.util.concurrent.TimeUnit;import java.util.concurrent.locks.ReentrantLock;public class ReentrantLockDemo &#123; public static final ReentrantLock lock1 = new ReentrantLock(); public static final ReentrantLock lock2 = new ReentrantLock(); public static void main(String[] args) throws InterruptedException &#123; for(int i = 0;i &lt; 10;i++)&#123; Thread thread = new Thread(() -&gt; &#123; lock1.lock(); lock2.lock(); try&#123; System.out.println("current:" + Thread.currentThread().getName() ); TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock2.unlock(); lock1.unlock(); &#125; &#125;); thread.start(); &#125; &#125;&#125; æˆ‘ä»¬ä»¥éå…¬å¹³é”ä¸ºä¾‹ï¼Œçœ‹çœ‹å¯é‡å…¥çš„ä»£ç å®ç°ï¼š 123456789101112131415161718192021final boolean nonfairTryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); //1. å¦‚æœè¯¥é”æœªè¢«ä»»ä½•çº¿ç¨‹å æœ‰ï¼Œè¯¥é”èƒ½è¢«å½“å‰çº¿ç¨‹è·å– if (c == 0) &#123; if (compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; //2.è‹¥è¢«å æœ‰ï¼Œæ£€æŸ¥å æœ‰çº¿ç¨‹æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ else if (current == getExclusiveOwnerThread()) &#123; // 3. å†æ¬¡è·å–ï¼Œè®¡æ•°åŠ ä¸€ int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false;&#125; 123456789101112131415protected final boolean tryRelease(int releases) &#123; //1. åŒæ­¥çŠ¶æ€å‡1 int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) &#123; //2. åªæœ‰å½“åŒæ­¥çŠ¶æ€ä¸º0æ—¶ï¼Œé”æˆåŠŸè¢«é‡Šæ”¾ï¼Œè¿”å›true free = true; setExclusiveOwnerThread(null); &#125; // 3. é”æœªè¢«å®Œå…¨é‡Šæ”¾ï¼Œè¿”å›false setState(c); return free;&#125; å…¬å¹³é”ä¸éå…¬å¹³é”ReentrantLockæ”¯æŒä¸¤ç§é”ï¼šå…¬å¹³é”å’Œéå…¬å¹³é”ã€‚ä½•è°“å…¬å¹³æ€§ï¼Œæ˜¯é’ˆå¯¹è·å–é”è€Œè¨€çš„ï¼Œå¦‚æœä¸€ä¸ªé”æ˜¯å…¬å¹³çš„ï¼Œé‚£ä¹ˆé”çš„è·å–é¡ºåºå°±åº”è¯¥ç¬¦åˆè¯·æ±‚ä¸Šçš„ç»å¯¹æ—¶é—´é¡ºåºï¼Œæ»¡è¶³FIFOã€‚ReentrantLockçš„æ„é€ æ–¹æ³•æ— å‚æ—¶æ˜¯æ„é€ éå…¬å¹³é”ï¼Œæºç ä¸ºï¼š 123public ReentrantLock() &#123; sync = new NonfairSync();&#125; å¦å¤–è¿˜æä¾›äº†å¦å¤–ä¸€ç§æ–¹å¼ï¼Œå¯ä¼ å…¥ä¸€ä¸ªbooleanå€¼ï¼Œtrueæ—¶ä¸ºå…¬å¹³é”ï¼Œfalseæ—¶ä¸ºéå…¬å¹³é”ï¼Œæºç ä¸ºï¼š 123public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync();&#125; åœ¨ä¸Šé¢éå…¬å¹³é”è·å–æ—¶ï¼ˆnonfairTryAcquireæ–¹æ³•ï¼‰åªæ˜¯ç®€å•çš„è·å–äº†ä¸€ä¸‹å½“å‰çŠ¶æ€åšäº†ä¸€äº›é€»è¾‘å¤„ç†ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°å½“å‰åŒæ­¥é˜Ÿåˆ—ä¸­çº¿ç¨‹ç­‰å¾…çš„æƒ…å†µã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å…¬å¹³é”çš„å¤„ç†é€»è¾‘æ˜¯æ€æ ·çš„ï¼Œæ ¸å¿ƒæ–¹æ³•ä¸ºï¼š 1234567891011121314151617181920protected final boolean tryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false; &#125;&#125; å…¶å®å°±æ˜¯å¤šäº†ä¸€ä¸ªæ–¹æ³• hasQueuedPredecessors()ï¼Œæ–¹æ³•åå°±å¯çŸ¥é“è¯¥æ–¹æ³•ç”¨æ¥åˆ¤æ–­å½“å‰èŠ‚ç‚¹åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œå¦‚æœæœ‰å‰é©±èŠ‚ç‚¹è¯´æ˜æœ‰çº¿ç¨‹æ¯”å½“å‰çº¿ç¨‹æ›´æ—©çš„è¯·æ±‚èµ„æºï¼Œæ ¹æ®å…¬å¹³æ€§ï¼Œå½“å‰çº¿ç¨‹è¯·æ±‚èµ„æºå¤±è´¥ã€‚å¦‚æœå½“å‰èŠ‚ç‚¹æ²¡æœ‰å‰é©±èŠ‚ç‚¹çš„è¯ï¼Œå†æ‰æœ‰åšåé¢çš„é€»è¾‘åˆ¤æ–­çš„å¿…è¦æ€§ã€‚å…¬å¹³é”æ¯æ¬¡éƒ½æ˜¯ä»åŒæ­¥é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è·å–åˆ°é”ï¼Œè€Œéå…¬å¹³æ€§é”åˆ™ä¸ä¸€å®šï¼Œæœ‰å¯èƒ½åˆšé‡Šæ”¾é”çš„çº¿ç¨‹èƒ½å†æ¬¡è·å–åˆ°é”ã€‚ å…¬å¹³é” VS éå…¬å¹³é” å…¬å¹³é”æ¯æ¬¡è·å–åˆ°é”ä¸ºåŒæ­¥é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¿è¯è¯·æ±‚èµ„æºæ—¶é—´ä¸Šçš„ç»å¯¹é¡ºåºï¼Œè€Œéå…¬å¹³é”æœ‰å¯èƒ½åˆšé‡Šæ”¾é”çš„çº¿ç¨‹ä¸‹æ¬¡ç»§ç»­è·å–è¯¥é”ï¼Œåˆ™æœ‰å¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹æ°¸è¿œæ— æ³•è·å–åˆ°é”ï¼Œé€ æˆâ€œé¥¥é¥¿â€ç°è±¡ã€‚ å…¬å¹³é”ä¸ºäº†ä¿è¯æ—¶é—´ä¸Šçš„ç»å¯¹é¡ºåºï¼Œéœ€è¦é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè€Œéå…¬å¹³é”ä¼šé™ä½ä¸€å®šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œé™ä½æ€§èƒ½å¼€é”€ã€‚å› æ­¤ï¼ŒReentrantLocké»˜è®¤é€‰æ‹©çš„æ˜¯éå…¬å¹³é”ï¼Œåˆ™æ˜¯ä¸ºäº†å‡å°‘ä¸€éƒ¨åˆ†ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¿è¯äº†ç³»ç»Ÿæ›´å¤§çš„ååé‡ã€‚ ä¸ Synchronized çš„åŒºåˆ«å¯é‡å…¥æ€§ä»åå­—ä¸Šç†è§£ï¼ŒReenTrantLockçš„å­—é¢æ„æ€å°±æ˜¯å†è¿›å…¥çš„é”ï¼Œå…¶å®synchronizedå…³é”®å­—æ‰€ä½¿ç”¨çš„é”ä¹Ÿæ˜¯å¯é‡å…¥çš„ï¼Œä¸¤è€…å…³äºè¿™ä¸ªçš„åŒºåˆ«ä¸å¤§ã€‚ä¸¤è€…éƒ½æ˜¯åŒä¸€ä¸ªçº¿ç¨‹æ²¡è¿›å…¥ä¸€æ¬¡ï¼Œé”çš„è®¡æ•°å™¨éƒ½è‡ªå¢1ï¼Œæ‰€ä»¥è¦ç­‰åˆ°é”çš„è®¡æ•°å™¨ä¸‹é™ä¸º0æ—¶æ‰èƒ½é‡Šæ”¾é”ã€‚ é”çš„å®ç°Synchronizedæ˜¯ä¾èµ–äºJVMå®ç°çš„ï¼Œè€ŒReenTrantLockæ˜¯JDKå®ç°çš„ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè¯´ç™½äº†å°±ç±»ä¼¼äºæ“ä½œç³»ç»Ÿæ¥æ§åˆ¶å®ç°å’Œç”¨æˆ·è‡ªå·±æ•²ä»£ç å®ç°çš„åŒºåˆ«ã€‚å‰è€…çš„å®ç°æ˜¯æ¯”è¾ƒéš¾è§åˆ°çš„ï¼Œåè€…æœ‰ç›´æ¥çš„æºç å¯ä¾›é˜…è¯»ã€‚ æ€§èƒ½çš„åŒºåˆ«åœ¨Synchronizedä¼˜åŒ–ä»¥å‰ï¼Œsynchronizedçš„æ€§èƒ½æ˜¯æ¯”ReenTrantLockå·®å¾ˆå¤šçš„ï¼Œä½†æ˜¯è‡ªä»Synchronizedå¼•å…¥äº†åå‘é”ï¼Œè½»é‡çº§é”ï¼ˆè‡ªæ—‹é”ï¼‰åï¼Œä¸¤è€…çš„æ€§èƒ½å°±å·®ä¸å¤šäº†ï¼Œåœ¨ä¸¤ç§æ–¹æ³•éƒ½å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œå®˜æ–¹ç”šè‡³å»ºè®®ä½¿ç”¨synchronizedï¼Œå…¶å®synchronizedçš„ä¼˜åŒ–æˆ‘æ„Ÿè§‰å°±å€Ÿé‰´äº†ReenTrantLockä¸­çš„CASæŠ€æœ¯ã€‚éƒ½æ˜¯è¯•å›¾åœ¨ç”¨æˆ·æ€å°±æŠŠåŠ é”é—®é¢˜è§£å†³ï¼Œé¿å…è¿›å…¥å†…æ ¸æ€çš„çº¿ç¨‹é˜»å¡ã€‚ åŠŸèƒ½åŒºåˆ«ä¾¿åˆ©æ€§ï¼šå¾ˆæ˜æ˜¾Synchronizedçš„ä½¿ç”¨æ¯”è¾ƒæ–¹ä¾¿ç®€æ´ï¼Œå¹¶ä¸”ç”±ç¼–è¯‘å™¨å»ä¿è¯é”çš„åŠ é”å’Œé‡Šæ”¾ï¼Œè€ŒReenTrantLockéœ€è¦æ‰‹å·¥å£°æ˜æ¥åŠ é”å’Œé‡Šæ”¾é”ï¼Œä¸ºäº†é¿å…å¿˜è®°æ‰‹å·¥é‡Šæ”¾é”é€ æˆæ­»é”ï¼Œæ‰€ä»¥æœ€å¥½åœ¨finallyä¸­å£°æ˜é‡Šæ”¾é”ã€‚ é”çš„ç»†ç²’åº¦å’Œçµæ´»åº¦ï¼šå¾ˆæ˜æ˜¾ReenTrantLockä¼˜äºSynchronized ReenTrantLockç‹¬æœ‰çš„èƒ½åŠ› ReenTrantLockå¯ä»¥æŒ‡å®šæ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ã€‚è€Œsynchronizedåªèƒ½æ˜¯éå…¬å¹³é”ã€‚æ‰€è°“çš„å…¬å¹³é”å°±æ˜¯å…ˆç­‰å¾…çš„çº¿ç¨‹å…ˆè·å¾—é”ã€‚ ReenTrantLockæä¾›äº†ä¸€ä¸ªConditionï¼ˆæ¡ä»¶ï¼‰ç±»ï¼Œç”¨æ¥å®ç°åˆ†ç»„å”¤é†’éœ€è¦å”¤é†’çš„çº¿ç¨‹ä»¬ï¼Œè€Œä¸æ˜¯åƒsynchronizedè¦ä¹ˆéšæœºå”¤é†’ä¸€ä¸ªçº¿ç¨‹è¦ä¹ˆå”¤é†’å…¨éƒ¨çº¿ç¨‹ã€‚ ReenTrantLockæä¾›äº†ä¸€ç§èƒ½å¤Ÿä¸­æ–­ç­‰å¾…é”çš„çº¿ç¨‹çš„æœºåˆ¶ï¼Œé€šè¿‡lock.lockInterruptibly()æ¥å®ç°è¿™ä¸ªæœºåˆ¶ã€‚ ReenTrantLockå®ç°çš„åŸç†ç®€å•æ¥è¯´ï¼ŒReenTrantLockçš„å®ç°æ˜¯ä¸€ç§è‡ªæ—‹é”ï¼Œé€šè¿‡å¾ªç¯è°ƒç”¨CASæ“ä½œæ¥å®ç°åŠ é”ã€‚å®ƒçš„æ€§èƒ½æ¯”è¾ƒå¥½ä¹Ÿæ˜¯å› ä¸ºé¿å…äº†ä½¿çº¿ç¨‹è¿›å…¥å†…æ ¸æ€çš„é˜»å¡çŠ¶æ€ã€‚æƒ³å°½åŠæ³•é¿å…çº¿ç¨‹è¿›å…¥å†…æ ¸çš„é˜»å¡çŠ¶æ€æ˜¯æˆ‘ä»¬å»åˆ†æå’Œç†è§£é”è®¾è®¡çš„å…³é”®é’¥åŒ™ã€‚ ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ReenTrantLockç­”æ¡ˆæ˜¯ï¼Œå¦‚æœä½ éœ€è¦å®ç°ReenTrantLockçš„ä¸‰ä¸ªç‹¬æœ‰åŠŸèƒ½æ—¶ã€‚ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œqq838642798ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/qq838642798/article/details/65441415 ReentrantReadWriteLock å†™é”â€”-çœŸçš„æ˜¯å†™çš„è¶…æ£’ï¼ è¯»é”â€”-ä¸è¯´äº†å¤ªèµäº†ï¼ï¼å…³æ³¨è¿™ä¸ªä½œè€… é”é™çº§é—®é¢˜ è¿™ä¸ªæ‰æ˜¯å®Œæ•´ç»§æ‰¿äº† AQS åŸºæœ¬æ‰€æœ‰æ–¹æ³•çš„å®ç°ç±»ï¼Œå› ä¸ºå®ƒä¸åƒ ReentrantLock åªæœ‰ç‹¬å é”ï¼Œå®ƒå¯ä»¥åŒæ—¶æ‹¥æœ‰ç‹¬å é”å’Œå…±äº«é”ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªé”è¿˜æœ‰ä¸€äº›é¢å¤–çš„é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯ å†™-è¯»äº’æ–¥(å½“ç„¶é”é™çº§é™¤å¤–)ï¼Œå†™-å†™äº’æ–¥ï¼Œè¯»-è¯»å…±äº«ã€‚æ‰€ä»¥è¿™ä¸ªå¾ˆæœ‰å¿…è¦è¯¦ç»†è¯´ä¸€ä¸‹ã€‚ ä¸»è¦è¿˜æ˜¯ä¸‰ä¸ªç‰¹ç‚¹ï¼š å…¬å¹³æ€§é€‰æ‹©ï¼šæ”¯æŒéå…¬å¹³æ€§ï¼ˆé»˜è®¤ï¼‰å’Œå…¬å¹³çš„é”è·å–æ–¹å¼ï¼Œååé‡è¿˜æ˜¯éå…¬å¹³ä¼˜äºå…¬å¹³ï¼› é‡å…¥æ€§ï¼šæ”¯æŒé‡å…¥ï¼Œè¯»é”è·å–åèƒ½å†æ¬¡è·å–ï¼Œå†™é”è·å–ä¹‹åèƒ½å¤Ÿå†æ¬¡è·å–å†™é”ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿè·å–è¯»é”ï¼› é”é™çº§ï¼šéµå¾ªè·å–å†™é”ï¼Œè·å–è¯»é”å†é‡Šæ”¾å†™é”çš„æ¬¡åºï¼Œå†™é”èƒ½å¤Ÿé™çº§æˆä¸ºè¯»é” è¦å¼„æ¸…æ¥šä¸Šè¿°ä¸‰ä¸ªç‰¹ç‚¹ï¼Œå°±å¾—è§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š å†™é”å’Œè¯»é”æ˜¯å¦‚ä½•è®°å½•è¯»å†™çŠ¶æ€çš„ï¼› å†™é”æ˜¯å¦‚ä½•è·å–å’Œé‡Šæ”¾çš„ï¼› è¯»é”æ˜¯å¦‚ä½•è·å–å’Œé‡Šæ”¾çš„ï¼› é”é™çº§çš„è§„åˆ™æ˜¯ä»€ä¹ˆã€‚ è¯»å†™é”å¦‚ä½•è®°å½•çŠ¶æ€ä¹‹å‰éƒ½æ˜¯ç”¨ state è¿™ä¸ªå˜é‡æ¥è®°å½•é”çš„è·å–æƒ…å†µï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡Œæ¯”è¾ƒç‰¹æ®Šï¼Œä½¿ç”¨äº†(Integer 32ä½)ä½ 16 ä½æ¥å­˜å‚¨å†™é”çš„è·å–æƒ…å†µï¼Œé«˜ 16 ä½ç”¨æ¥å­˜å‚¨è¯»é”çš„è·å–æƒ…å†µã€‚ å†™é”çš„è·å–å’Œé‡Šæ”¾å†™é”ç”±äºæ˜¯ç‹¬å é”ï¼Œå¹¶ä¸”ä¸èƒ½é”å‡çº§ï¼ˆä¹Ÿå°±æ˜¯ä¸å…è®¸è¯»é”å†…åµŒå¥—å†™é”ï¼‰ï¼Œæ‰€ä»¥ä¹Ÿå°±æ¯”è¾ƒç®€å•äº†ã€‚ tryAcquire()å†™é”ç‹¬å é”ï¼Œæ‰€ä»¥éœ€è¦å®ç°çš„å°±æ˜¯ AQS ä¸­çš„ tryAcquire() 1234567891011121314151617181920212223242526272829303132// å¦‚æœæœ‰è¯»é”ï¼Œæ­¤æ—¶æ˜¯è·å–ä¸åˆ°å†™é”çš„ã€‚å½“æœ‰å†™é”æ—¶ï¼Œåˆ¤æ–­é‡å…¥æ¬¡æ•°ã€‚// å½“å†™é”ç©ºé—²ï¼Œè¯»é”ç©ºé—²ï¼Œå…¬å¹³æ¨¡å¼ä¸‹ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æœ‰ç­‰å¾…çš„ï¼Œä¸ä¼šæŠ¢é”ã€‚éå…¬å¹³æ¨¡å¼ä¸‹ï¼Œå¿…æŠ¢é”ã€‚protected final boolean tryAcquire(int acquires) &#123; // å†™ Thread current = Thread.currentThread(); int c = getState(); // ç”¨ state &amp; 65535 å¾—åˆ°ä½ 16 ä½çš„å€¼ã€‚ int w = exclusiveCount(c); if (c != 0) &#123; // (Note: if c != 0 and w == 0 then shared count != 0) // å¦‚æœ state ä¸æ˜¯0ï¼Œä¸”ä½16ä½æ˜¯0ï¼Œè¯´æ˜äº†ä»€ä¹ˆï¼Ÿè¯´æ˜å†™é”æ˜¯ç©ºé—²çš„ï¼Œè¯»é”è¢«éœ¸å äº†ã€‚é‚£ä¹ˆä¹Ÿä¸èƒ½æ‹¿é”ï¼Œè¿”å› fasleã€‚ // å¦‚æœä½ 16 ä½ä¸æ˜¯0ï¼Œè¯´æ˜å†™é”è¢«éœ¸å äº†ï¼Œå¹¶ä¸”ï¼Œå¦‚æœæŒæœ‰é”çš„ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œé‚£ä¹ˆè¿™æ¬¡æ‹¿é”æ˜¯å¤±è´¥çš„ã€‚è¿”å› fasleã€‚ // æ€»ä¹‹ï¼Œå½“åªæœ‰è¯»é”æ—¶ï¼Œå°±ä¸èƒ½è·å–å†™é”ã€‚å½“æœ‰å†™é”ï¼Œå¯èƒ½æ˜¯å†™é”é™çº§ï¼Œä¹Ÿå¯èƒ½æ˜¯æ­£å¸¸çš„æ‹¥æœ‰å†™é”ï¼Œæ­¤æ—¶å°± // å¿…é¡»æ˜¯é‡å…¥é”ã€‚ if (w == 0 || current != getExclusiveOwnerThread()) return false; // åˆ°è¿™ä¸€æ­¥äº†ï¼Œåªä¼šæ˜¯å†™é‡å…¥é”ã€‚å¦‚æœå†™é‡å…¥æ¬¡æ•°è¶…è¿‡æœ€å¤§å€¼ 65535ï¼Œå°±ä¼šæº¢å‡ºã€‚ if (w + exclusiveCount(acquires) &gt; MAX_COUNT) throw new Error("Maximum lock count exceeded"); // Reentrant acquire // å°† state + 1 setState(c + acquires); return true; &#125; // å½“ state æ˜¯ 0 çš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±å¯ä»¥è·å–é”äº†ã€‚ // writerShouldBlock åˆ¤æ–­æ˜¯å¦éœ€è¦é”ã€‚éå…¬å¹³æƒ…å†µä¸‹ï¼Œè¿”å› falseã€‚å…¬å¹³æƒ…å†µä¸‹ï¼Œæ ¹æ® hasQueuedPredecessors ç»“æœåˆ¤æ–­ã€‚ // å½“é˜Ÿåˆ—ä¸­æœ‰é”ç­‰å¾…äº†ï¼Œå°±è¿”å› false äº†ã€‚ // å½“æ˜¯éå…¬å¹³é”çš„æ—¶å€™ï¼Œæˆ–è€…é˜Ÿåˆ—ä¸­æ²¡æœ‰ç­‰å¾…èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå°è¯•ç”¨ CAS ä¿®æ”¹ stateã€‚ if (writerShouldBlock() || !compareAndSetState(c, c + acquires)) return false; // ä¿®æ”¹æˆåŠŸ state åï¼Œä¿®æ”¹é”çš„æŒæœ‰çº¿ç¨‹ã€‚ setExclusiveOwnerThread(current); æœ€éš¾ç†è§£çš„å°±æ˜¯if (w == 0 || current != getExclusiveOwnerThread()) è¿™ä¸€æ­¥ï¼Œå…·ä½“çš„æµç¨‹åˆ†æå¦‚ä¸‹å›¾ï¼š tryRelease()123456789101112131415protected final boolean tryRelease(int releases) &#123; // æ˜¯å¦æŒæœ‰å½“å‰é” if (!isHeldExclusively()) throw new IllegalMonitorStateException(); // è®¡ç®— state å€¼ int nextc = getState() - releases; // è®¡ç®—å†™é”çš„çŠ¶æ€ï¼Œå¦‚æœæ˜¯0ï¼Œè¯´æ˜æ˜¯å¦æˆåŠŸã€‚ boolean free = exclusiveCount(nextc) == 0; // é‡Šæ”¾æˆåŠŸï¼Œè®¾ç½®æŒæœ‰é”çš„çº¿ç¨‹ä¸º nullã€‚ if (free) setExclusiveOwnerThread(null); // è®¾ç½® state setState(nextc); return free;&#125; è¿™é‡Œè¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œåªæ˜¯æœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼š 12// è®¡ç®—å†™é”çš„çŠ¶æ€ï¼Œå¦‚æœæ˜¯0ï¼Œè¯´æ˜æ˜¯å¦æˆåŠŸã€‚boolean free = exclusiveCount(nextc) == 0; è¿™é‡Œè®¡ç®—çš„åªæ˜¯ state å˜é‡çš„ä½ 16 çš„å€¼ï¼Œè€Œä¸æ˜¯æ•´ä¸ª state çš„å€¼ã€‚è™½ç„¶å†™çš„æ—¶å€™ï¼Œå¿…ç„¶æ˜¯ä¸²è¡Œçš„ï¼Œä½†è¿™é‡Œè®¡ç®—çš„ä»ç„¶æ˜¯ä½ 16 ä½çš„ã€‚ è¯»é”çš„è·å–å’Œé‡Šæ”¾è·å–è¯»é”çš„è¿‡ç¨‹æ˜¯è·å–å…±äº«é”çš„è¿‡ç¨‹ã€‚ tryAcquireShared()123456789101112131415161718192021222324252627282930313233343536373839404142434445protected final int11 tryAcquireShared(int unused) &#123; Thread current = Thread.currentThread(); int c = getState(); // exclusiveCount(c) != 0 ---ã€‹ ç”¨ state &amp; 65535 å¾—åˆ°ä½ 16 ä½çš„å€¼ã€‚å¦‚æœä¸æ˜¯0ï¼Œè¯´æ˜å†™é”åˆ«æŒæœ‰äº†ã€‚ // getExclusiveOwnerThread() != current----&gt; ä¸æ˜¯å½“å‰çº¿ç¨‹ // å¦‚æœå†™é”è¢«éœ¸å äº†ï¼Œä¸”æŒæœ‰çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œè¿”å› falseï¼ŒåŠ å…¥é˜Ÿåˆ—ã€‚è·å–å†™é”å¤±è´¥ã€‚ // åä¹‹ï¼Œå¦‚æœæŒæœ‰å†™é”çš„æ˜¯å½“å‰çº¿ç¨‹ï¼Œå°±å¯ä»¥ç»§ç»­è·å–è¯»é”äº†ã€‚ if (exclusiveCount(c) != 0 &amp;&amp; getExclusiveOwnerThread() != current) // è·å–é”å¤±è´¥ return -1; // å¦‚æœå†™é”æ²¡æœ‰è¢«éœ¸å ï¼Œåˆ™å°†é«˜16ä½ç§»åˆ°ä½16ä½ã€‚ int r = sharedCount(c);// c &gt;&gt;&gt; 16 // !readerShouldBlock() å’Œå†™é”çš„é€»è¾‘ä¸€æ ·ï¼ˆæ ¹æ®å…¬å¹³ä¸å¦ç­–ç•¥å’Œé˜Ÿåˆ—æ˜¯å¦å«æœ‰ç­‰å¾…èŠ‚ç‚¹ï¼‰ // ä¸èƒ½å¤§äº 65535ï¼Œä¸” CAS ä¿®æ”¹æˆåŠŸ if (!readerShouldBlock() &amp;&amp; r &lt; 65535 &amp;&amp; compareAndSetState(c, c + 65536)) &#123; // å¦‚æœè¯»é”æ˜¯ç©ºé—²çš„ï¼Œ è·å–é”æˆåŠŸã€‚ if (r == 0) &#123; // å°†å½“å‰çº¿ç¨‹è®¾ç½®ä¸ºç¬¬ä¸€ä¸ªè¯»é”çº¿ç¨‹ firstReader = current; // è®¡æ•°å™¨ä¸º1 firstReaderHoldCount = 1; &#125;// å¦‚æœè¯»é”ä¸æ˜¯ç©ºé—²çš„ï¼Œä¸”ç¬¬ä¸€ä¸ªè¯»çº¿ç¨‹æ˜¯å½“å‰çº¿ç¨‹ã€‚è·å–é”æˆåŠŸã€‚ else if (firstReader == current) &#123;// // å°†è®¡æ•°å™¨åŠ ä¸€ firstReaderHoldCount++; &#125; else &#123;// å¦‚æœä¸æ˜¯ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œè·å–é”æˆåŠŸã€‚ // cachedHoldCounter ä»£è¡¨çš„æ˜¯æœ€åä¸€ä¸ªè·å–è¯»é”çš„çº¿ç¨‹çš„è®¡æ•°å™¨ã€‚ HoldCounter rh = cachedHoldCounter; // å¦‚æœæœ€åä¸€ä¸ªçº¿ç¨‹è®¡æ•°å™¨æ˜¯ null æˆ–è€…ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±æ–°å»ºä¸€ä¸ª HoldCounter å¯¹è±¡ if (rh == null || rh.tid != getThreadId(current)) // ç»™å½“å‰çº¿ç¨‹æ–°å»ºä¸€ä¸ª HoldCounter cachedHoldCounter = rh = readHolds.get(); // å¦‚æœä¸æ˜¯ nullï¼Œä¸” count æ˜¯ 0ï¼Œå°±å°†ä¸Šä¸ªçº¿ç¨‹çš„ HoldCounter è¦†ç›–æœ¬åœ°çš„ã€‚ else if (rh.count == 0) readHolds.set(rh); // å¯¹ count åŠ ä¸€ rh.count++; &#125; return 1; &#125; // æ­»å¾ªç¯è·å–è¯»é”ã€‚åŒ…å«é”é™çº§ç­–ç•¥ã€‚ return fullTryAcquireShared(current);&#125; æ€»ç»“ä¸€ä¸‹ä¸Šé¢ä»£ç çš„é€»è¾‘å§ï¼ åˆ¤æ–­å†™é”æ˜¯å¦ç©ºé—²ã€‚ å¦‚æœä¸æ˜¯ç©ºé—²ï¼Œä¸”å½“å‰çº¿ç¨‹ä¸æ˜¯æŒæœ‰å†™é”çš„çº¿ç¨‹ï¼Œåˆ™è¿”å› -1 ï¼Œè¡¨ç¤ºæŠ¢é”å¤±è´¥ã€‚å¦‚æœæ˜¯ç©ºé—²çš„ï¼Œè¿›å…¥ç¬¬ä¸‰æ­¥ã€‚å¦‚æœæ˜¯å½“å‰çº¿ç¨‹ï¼Œè¿›å…¥ç¬¬ä¸‰æ­¥ã€‚ åˆ¤æ–­æŒæœ‰è¯»é”çš„æ•°é‡æ˜¯å¦è¶…è¿‡ 65535ï¼Œç„¶åä½¿ç”¨ CAS è®¾ç½® int é«˜ 16 ä½çš„å€¼ï¼Œä¹Ÿå°±æ˜¯åŠ ä¸€ã€‚ å¦‚æœè®¾ç½®æˆåŠŸï¼Œä¸”æ˜¯ç¬¬ä¸€æ¬¡è·å–è¯»é”ï¼Œå°±è®¾ç½® firstReader ç›¸å…³çš„å±æ€§ï¼ˆä¸ºäº†æ€§èƒ½æå‡ï¼‰ã€‚ å¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡ï¼Œå½“å½“å‰çº¿ç¨‹å°±æ˜¯ç¬¬ä¸€æ¬¡è·å–è¯»é”çš„çº¿ç¨‹ï¼Œå¯¹ â€œç¬¬ä¸€æ¬¡è·å–è¯»é”çº¿ç¨‹è®¡æ•°å™¨â€ åŠ  1. å¦‚æœéƒ½ä¸æ˜¯ï¼Œåˆ™è·å–æœ€åä¸€ä¸ªè¯»é”çš„çº¿ç¨‹è®¡æ•°å™¨ï¼Œåˆ¤æ–­è¿™ä¸ªè®¡æ•°å™¨æ˜¯ä¸æ˜¯å½“å‰çº¿ç¨‹çš„ã€‚å¦‚æœæ˜¯ï¼ŒåŠ ä¸€ï¼Œå¦‚æœä¸æ˜¯ï¼Œè‡ªå·±åˆ›å»ºä¸€ä¸ªæ–°è®¡æ•°å™¨ï¼Œå¹¶æ›´æ–° â€œæœ€åè¯»å–çš„çº¿ç¨‹è®¡æ•°å™¨â€ï¼ˆä¹Ÿæ˜¯ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼‰ã€‚æœ€ååŠ ä¸€ã€‚è¿”å›æˆåŠŸã€‚ å¦‚æœä¸Šé¢çš„åˆ¤æ–­å¤±è´¥äº†ï¼ˆCAS è®¾ç½®å¤±è´¥ï¼Œæˆ–è€…é˜Ÿåˆ—æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼ˆå…¬å¹³æƒ…å†µä¸‹ï¼‰ï¼‰ã€‚å°±è°ƒç”¨ fullTryAcquireShared æ–¹æ³•æ­»å¾ªç¯æ‰§è¡Œä¸Šé¢çš„æ­¥éª¤ã€‚ æ­¥éª¤è¿˜æ˜¯æœ‰ç‚¹å¤šå“ˆï¼Œç”»ä¸ªå›¾å§ï¼Œæ›´æ¸…æ™°ä¸€ç‚¹ã€‚ å¯ä»¥çœ‹åˆ°è¯»é”å¯¹ AQS çš„å…±äº«é”åšäº†ä¸¤ä¸ªä¼˜åŒ–ï¼š å¼•è¿›äº† firstReaderHoldCount å’Œ cachedHoldCounter ï¼Œå¯ä»¥åŠ å¿«è®¡æ•°çš„æ€§èƒ½ï¼› å¼•å…¥é”é™çº§æœºåˆ¶ï¼Œå¯¹è¯»å¤šå†™å°‘ä¸”è¯»æ›´é‡è¦çš„åœºæ™¯å¾ˆé€‚ç”¨ã€‚ ç»§ç»­çœ‹ fullTryAcquireShared()ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364final int fullTryAcquireShared(Thread current) &#123; /* * è¿™æ®µä»£ç ä¸tryAcquireSharedä¸­çš„ä»£ç æœ‰éƒ¨åˆ†é‡å¤ï¼Œä½†æ•´ä½“æ›´ç®€å•ã€‚ */ HoldCounter rh = null; // æ­»å¾ªç¯ for (;;) &#123; int c = getState(); // å¦‚æœå­˜åœ¨å†™é” if (exclusiveCount(c) != 0) &#123; // å¹¶ä¸”ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œè·å–é”å¤±è´¥ï¼Œåä¹‹ï¼Œå¦‚æœæŒæœ‰å†™é”çš„æ˜¯å½“å‰çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥ä¸‹é¢çš„é€»è¾‘ã€‚ // åä¹‹ï¼Œå¦‚æœå­˜åœ¨å†™é”ï¼Œä½†æŒæœ‰å†™é”çš„æ˜¯å½“å‰çº¿ç¨‹ã€‚é‚£ä¹ˆå°±ç»§ç»­å°è¯•è·å–è¯»é”ã€‚ if (getExclusiveOwnerThread() != current) return -1; // å¦‚æœå†™é”ç©ºé—²ï¼Œä¸”å¯ä»¥è·å–è¯»é”ã€‚ &#125; else if (readerShouldBlock()) &#123; // ç¬¬ä¸€ä¸ªè¯»çº¿ç¨‹æ˜¯å½“å‰çº¿ç¨‹ if (firstReader == current) &#123; // å¦‚æœä¸æ˜¯å½“å‰çº¿ç¨‹ &#125; else &#123; if (rh == null) &#123; rh = cachedHoldCounter; if (rh == null || rh.tid != getThreadId(current)) &#123; // ä» ThreadLocal ä¸­å–å‡ºè®¡æ•°å™¨ rh = readHolds.get(); if (rh.count == 0) readHolds.remove(); &#125; &#125; if (rh.count == 0) return -1; &#125; &#125; // å¦‚æœè¯»é”æ¬¡æ•°è¾¾åˆ° 65535 ï¼ŒæŠ›å‡ºå¼‚å¸¸ if (sharedCount(c) == MAX_COUNT) throw new Error("Maximum lock count exceeded"); // å°è¯•å¯¹ state åŠ  65536, ä¹Ÿå°±æ˜¯è®¾ç½®è¯»é”ï¼Œå®é™…å°±æ˜¯å¯¹é«˜16ä½åŠ ä¸€ã€‚ if (compareAndSetState(c, c + SHARED_UNIT)) &#123; // å¦‚æœè¯»é”æ˜¯ç©ºé—²çš„ if (sharedCount(c) == 0) &#123; // è®¾ç½®ç¬¬ä¸€ä¸ªè¯»é” firstReader = current; // è®¡æ•°å™¨ä¸º 1 firstReaderHoldCount = 1; // å¦‚æœä¸æ˜¯ç©ºé—²çš„ï¼ŒæŸ¥çœ‹ç¬¬ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ã€‚ &#125; else if (firstReader == current) &#123; firstReaderHoldCount++;// æ›´æ–°è®¡æ•°å™¨ &#125; else &#123;// å¦‚æœä¸æ˜¯å½“å‰çº¿ç¨‹ if (rh == null) rh = cachedHoldCounter; if (rh == null || rh.tid != getThreadId(current))// å¦‚æœæœ€åä¸€ä¸ªè¯»è®¡æ•°å™¨æ‰€å±çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹ã€‚ // è‡ªå·±åˆ›å»ºä¸€ä¸ªã€‚ rh = readHolds.get(); else if (rh.count == 0) readHolds.set(rh); // å¯¹è®¡æ•°å™¨ ++ rh.count++; // æ›´æ–°ç¼“å­˜è®¡æ•°å™¨ã€‚ cachedHoldCounter = rh; // cache for release &#125; return 1; &#125; &#125;&#125; åŸºæœ¬ä¸Šå’Œ tryAcquireShared() å·®ä¸å¤šï¼Œåªä¸è¿‡è¿™é‡Œæœ‰ä¸€ä¸ªè‡ªæ—‹çš„è¿‡ç¨‹ã€‚ firstReader æ˜¯è·å–è¯»é”çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å–è¯»é”ï¼Œå¾ˆæ˜æ˜¾ï¼Œä½¿ç”¨è¿™æ ·ä¸€ä¸ªå˜é‡é€Ÿåº¦æ›´å¿«ã€‚ firstReaderHoldCountæ˜¯ firstReaderçš„è®¡æ•°å™¨ã€‚åŒä¸Šã€‚ cachedHoldCounteræ˜¯æœ€åä¸€ä¸ªè·å–åˆ°è¯»é”çš„çº¿ç¨‹è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰æ–°çš„çº¿ç¨‹è·å–åˆ°è¯»é”ï¼Œè¿™ä¸ªå˜é‡éƒ½ä¼šæ›´æ–°ã€‚è¿™ä¸ªå˜é‡çš„ç›®çš„æ˜¯ï¼šå½“æœ€åä¸€ä¸ªè·å–è¯»é”çš„çº¿ç¨‹é‡å¤è·å–è¯»é”ï¼Œæˆ–è€…é‡Šæ”¾è¯»é”ï¼Œå°±ä¼šç›´æ¥ä½¿ç”¨è¿™ä¸ªå˜é‡ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œç›¸å½“äºç¼“å­˜ã€‚ tryReleaseShared()1234567891011121314151617181920212223242526272829303132333435363738protected final boolean tryReleaseShared(int unused) &#123; Thread current = Thread.currentThread(); // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªçº¿ç¨‹ if (firstReader == current) &#123; // å¦‚æœæ˜¯ 1ï¼Œå°†ç¬¬ä¸€ä¸ªçº¿ç¨‹è®¾ç½®æˆ nullã€‚ç»“æŸã€‚ if (firstReaderHoldCount == 1) firstReader = null; // å¦‚æœä¸æ˜¯ 1ï¼Œå‡ä¸€æ“ä½œ else firstReaderHoldCount--; &#125; else &#123;//å¦‚æœä¸æ˜¯å½“å‰çº¿ç¨‹ HoldCounter rh = cachedHoldCounter; // å¦‚æœç¼“å­˜æ˜¯ null æˆ–è€…ç¼“å­˜æ‰€å±çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¸æ˜¯æœ€åä¸€ä¸ªè¯»é”ã€‚ if (rh == null || rh.tid != getThreadId(current)) // è·å–å½“å‰çº¿ç¨‹çš„è®¡æ•°å™¨ rh = readHolds.get(); int count = rh.count; // å¦‚æœè®¡æ•°å™¨å°äºç­‰äºä¸€ï¼Œå°±ç›´æ¥åˆ é™¤è®¡æ•°å™¨ if (count &lt;= 1) &#123; readHolds.remove(); // å¦‚æœè®¡æ•°å™¨çš„å€¼å°äºç­‰äº0ï¼Œè¯´æ˜æœ‰é—®é¢˜äº†ï¼ŒæŠ›å‡ºå¼‚å¸¸ if (count &lt;= 0) throw unmatchedUnlockException(); &#125; // å¯¹è®¡æ•°å™¨å‡ä¸€ --rh.count; &#125; for (;;) &#123;// æ­»å¾ªç¯ä½¿ç”¨ CAS ä¿®æ”¹çŠ¶æ€ int c = getState(); // c - 65536, å…¶å®å°±æ˜¯å‡å»ä¸€ä¸ªè¯»é”ã€‚å¯¹é«˜16ä½å‡ä¸€ã€‚ int nextc = c - SHARED_UNIT; // ä¿®æ”¹ state çŠ¶æ€ã€‚ if (compareAndSetState(c, nextc)) // ä¿®æ”¹æˆåŠŸåï¼Œå¦‚æœæ˜¯ 0ï¼Œè¡¨ç¤ºè¯»é”å’Œå†™é”éƒ½ç©ºé—²ï¼Œåˆ™å¯ä»¥å”¤é†’åé¢çš„ç­‰å¾…çº¿ç¨‹ return nextc == 0; &#125;&#125; é‡Šæ”¾è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š å¦‚æœå½“å‰çº¿ç¨‹æ˜¯ç¬¬ä¸€ä¸ªæŒæœ‰è¯»é”çš„çº¿ç¨‹ï¼Œåˆ™åªéœ€è¦æ“ä½œ firstReaderHoldCount å‡ä¸€ã€‚å¦‚æœä¸æ˜¯ï¼Œè¿›å…¥ç¬¬äºŒæ­¥ã€‚ è·å–åˆ°ç¼“å­˜è®¡æ•°å™¨ï¼ˆæœ€åä¸€ä¸ªçº¿ç¨‹çš„è®¡æ•°å™¨ï¼‰ï¼Œå¦‚æœåŒ¹é…åˆ°å½“å‰çº¿ç¨‹ï¼Œå°±å‡ä¸€ã€‚å¦‚æœä¸åŒ¹é…ï¼Œè¿›å…¥ç¬¬ä¸‰æ­¥ã€‚ è·å–å½“å‰çº¿ç¨‹è‡ªå·±çš„è®¡æ•°å™¨ï¼ˆç”±äºæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šå¤šæ¬¡è·å–åˆ°é”ï¼Œæ‰€ä»¥ï¼Œæ¯ä¸ªçº¿ç¨‹å¿…é¡»ä¿å­˜è‡ªå·±çš„è®¡æ•°å™¨ã€‚ï¼‰ã€‚ åšå‡ä¸€æ“ä½œã€‚ æ­»å¾ªç¯ä¿®æ”¹ state å˜é‡ã€‚ é”é™çº§é‡å…¥è¿˜å…è®¸ä»å†™å…¥é”é™çº§ä¸ºè¯»å–é”ï¼Œå…¶å®ç°æ–¹å¼æ˜¯ï¼šå…ˆè·å–å†™å…¥é”ï¼Œç„¶åè·å–è¯»å–é”ï¼Œæœ€åé‡Šæ”¾å†™å…¥é”ã€‚ä½†æ˜¯ï¼Œä»è¯»å–é”å‡çº§åˆ°å†™å…¥é”æ˜¯ä¸å¯èƒ½çš„ã€‚ é”é™çº§çš„å¿…è¦æ€§ä¸»è¦æœ‰ä¸¤ä¸ªè§‚ç‚¹ï¼š ã€Œä¸ªäººè¿˜æ˜¯å€¾å‘äºç¬¬ä¸€ç§è§‚ç‚¹ã€ æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œç±»ä¼¼äºvolatileï¼Œåªæœ‰å†™é”é™çº§æ‰èƒ½ä¿è¯æˆ‘è¯»åˆ°çš„æ•°æ®æ˜¯æˆ‘è¿™æ¬¡å†™æ•°æ®åçš„æ•°æ®ï¼Œå¦åˆ™å°±å¯èƒ½å‘ç”Ÿå…¶ä»–çº¿ç¨‹å…ˆæŠ¢å†™é”ï¼Œå¯¼è‡´è¯»åˆ°çš„æ•°æ®å¹¶ä¸æ˜¯æˆ‘è¿™ä¸ªçº¿ç¨‹å†™åçš„æ•°æ®ï¼Œå½“å‰çº¿ç¨‹æ— æ³•æ„ŸçŸ¥æ•°æ®æ›´æ–°ã€‚ ç‰¹æ®Šçš„å†™é”é‡å…¥æœºåˆ¶ï¼ŒJDK ä½¿ç”¨ å…ˆè·å–å†™å…¥é”ï¼Œç„¶åè·å–è¯»å–é”ï¼Œæœ€åé‡Šæ”¾å†™å…¥é” è¿™ä¸ªæ­¥éª¤ï¼Œæ˜¯ä¸ºäº†æé«˜è·å–é”çš„æ•ˆç‡ã€‚å°¤å…¶æ˜¯è¯»é”çš„æ•ˆç‡ï¼Œä¸éœ€è¦ç­‰åˆ°å†™é”é‡Šæ”¾ï¼Œä¹Ÿæ— éœ€è·Ÿå†™é”ç«äº‰å…±äº«èµ„æºã€‚ Condition æºç éƒ¨åˆ†è®²çš„å¾ˆå¥½ï¼Œåˆ†æçš„å¾ˆé€å½» ç®€ä»‹éƒ¨åˆ†å†™çš„è¿˜è¡Œï¼Œä½†æ˜¯æºç åˆ†æçš„éå¸¸ç³Ÿç³• ç®€ä»‹ä»»æ„ä¸€ä¸ªJavaå¯¹è±¡ï¼Œéƒ½æ‹¥æœ‰ä¸€ç»„ç›‘è§†å™¨æ–¹æ³•ï¼ˆå®šä¹‰åœ¨java.lang.Objectä¸Šï¼‰ï¼Œä¸»è¦åŒ…æ‹¬wait()ã€wait(long timeout)ã€notify()ä»¥åŠnotifyAll()æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸synchronizedåŒæ­¥å…³é”®å­—é…åˆï¼Œå¯ä»¥å®ç°ç­‰å¾…/é€šçŸ¥æ¨¡å¼ã€‚Conditionæ¥å£ä¹Ÿæä¾›äº†ç±»ä¼¼Objectçš„ç›‘è§†å™¨æ–¹æ³•ï¼Œä¸Locké…åˆå¯ä»¥å®ç°ç­‰å¾…/é€šçŸ¥æ¨¡å¼ï¼Œä½†æ˜¯è¿™ä¸¤è€…åœ¨ä½¿ç”¨æ–¹å¼ä»¥åŠåŠŸèƒ½ç‰¹æ€§ä¸Šè¿˜æ˜¯æœ‰å·®åˆ«çš„ã€‚ Qï¼šä¸ºä»€ä¹ˆ wait/notify ç­‰æ–¹æ³•å®šä¹‰åœ¨ Object æ–¹æ³•å†…ï¼Ÿ Aï¼šJavaä¸­æ‰€æœ‰çš„ç±»å’Œå¯¹è±¡é€»è¾‘ä¸Šéƒ½å¯¹åº”æœ‰ä¸€ä¸ªé”å’Œç›‘è§†å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨Javaä¸­ä¸€åˆ‡å¯¹è±¡éƒ½å¯ä»¥ç”¨æ¥çº¿ç¨‹çš„åŒæ­¥ã€æ‰€ä»¥è¿™äº›ç®¡ç¨‹ï¼ˆç›‘è§†å™¨ï¼‰çš„â€œè¿‡ç¨‹â€æ–¹æ³•å®šä¹‰åœ¨Objectä¸­ä¸€ç‚¹ä¹Ÿä¸å¥‡æ€ªã€‚ ä¸€å¥è¯å½’çº³ï¼Œå°±æ˜¯ Lock æ­é… Condition(await/signal)ï¼ŒSynchronized(ç›‘è§†å™¨) æ­é… wait/notifyã€‚ ä»æ•´ä½“ä¸Šæ¥çœ‹Objectçš„waitå’Œnotify/notifyæ˜¯ä¸å¯¹è±¡ç›‘è§†å™¨é…åˆå®Œæˆçº¿ç¨‹é—´çš„ç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼Œè€ŒConditionä¸Locké…åˆå®Œæˆç­‰å¾…é€šçŸ¥æœºåˆ¶ï¼Œå‰è€…æ˜¯javaåº•å±‚çº§åˆ«çš„ï¼Œåè€…æ˜¯è¯­è¨€çº§åˆ«çš„ï¼Œå…·æœ‰æ›´é«˜çš„å¯æ§åˆ¶æ€§å’Œæ‰©å±•æ€§ã€‚ä¸¤è€…é™¤äº†åœ¨ä½¿ç”¨æ–¹å¼ä¸Šä¸åŒå¤–ï¼Œåœ¨åŠŸèƒ½ç‰¹æ€§ä¸Šè¿˜æ˜¯æœ‰å¾ˆå¤šçš„ä¸åŒï¼š å‰ç½®æ¡ä»¶ä¸åŒï¼ŒObjecæ–¹å¼çš„å¯¹è±¡ç›‘è§†å™¨éœ€è¦è·å¾—é”ï¼Œè€Œ Condition çš„å‰ææ˜¯è¦æ‹¿åˆ° Lockï¼› Conditionèƒ½å¤Ÿæ”¯æŒä¸å“åº”ä¸­æ–­ï¼Œè€Œé€šè¿‡ä½¿ç”¨Objectæ–¹å¼ä¸æ”¯æŒï¼› Conditionèƒ½å¤Ÿæ”¯æŒå¤šä¸ªç­‰å¾…é˜Ÿåˆ—ï¼ˆnew å¤šä¸ªConditionå¯¹è±¡ï¼‰ï¼Œè€ŒObjectæ–¹å¼åªèƒ½æ”¯æŒä¸€ä¸ªï¼› Conditionèƒ½å¤Ÿæ”¯æŒè¶…æ—¶æ—¶é—´çš„è®¾ç½®ï¼Œè€ŒObjectä¸æ”¯æŒã€‚ å‚ç…§Objectçš„waitå’Œnotify/notifyAllæ–¹æ³•ï¼ŒConditionä¹Ÿæä¾›äº†åŒæ ·çš„æ–¹æ³•ï¼š é’ˆå¯¹Objectçš„waitæ–¹æ³• void await() throws InterruptedException:å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹è°ƒç”¨conditionçš„signalæˆ–è€…signalAllæ–¹æ³•å¹¶ä¸”å½“å‰çº¿ç¨‹è·å–Lockä»awaitæ–¹æ³•è¿”å›ï¼Œå¦‚æœåœ¨ç­‰å¾…çŠ¶æ€ä¸­è¢«ä¸­æ–­ä¼šæŠ›å‡ºè¢«ä¸­æ–­å¼‚å¸¸ï¼› long awaitNanos(long nanosTimeout)ï¼šå½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ°è¢«é€šçŸ¥ï¼Œä¸­æ–­æˆ–è€…è¶…æ—¶ï¼› boolean await(long time, TimeUnit unit)throws InterruptedExceptionï¼šåŒç¬¬äºŒç§ï¼Œæ”¯æŒè‡ªå®šä¹‰æ—¶é—´å•ä½ boolean awaitUntil(Date deadline) throws InterruptedExceptionï¼šå½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ°è¢«é€šçŸ¥ï¼Œä¸­æ–­æˆ–è€…åˆ°äº†æŸä¸ªæ—¶é—´ é’ˆå¯¹Objectçš„notify/notifyAllæ–¹æ³• void signal()ï¼šå”¤é†’ä¸€ä¸ªç­‰å¾…åœ¨conditionä¸Šçš„çº¿ç¨‹ï¼Œå°†è¯¥çº¿ç¨‹ä»ç­‰å¾…é˜Ÿåˆ—ä¸­è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­èƒ½å¤Ÿç«äº‰åˆ°Lockåˆ™å¯ä»¥ä»ç­‰å¾…æ–¹æ³•ä¸­è¿”å›ã€‚ void signalAll()ï¼šä¸1çš„åŒºåˆ«åœ¨äºèƒ½å¤Ÿå”¤é†’æ‰€æœ‰ç­‰å¾…åœ¨conditionä¸Šçš„çº¿ç¨‹ æºç åˆ†æåˆ›å»ºä¸€ä¸ª Condition å¯¹è±¡ï¼Œæ˜¯é€šè¿‡ lock.newCondition()ï¼Œnewå‡ºæ¥ä¸€ä¸ª ConditionObject å¯¹è±¡ï¼Œè€Œè¿™ä¸ªæ°å¥½åˆæ˜¯ AQS çš„å†…éƒ¨ç±»ï¼Œå‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œconditionæ˜¯è¦å’Œlocké…åˆä½¿ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯conditionå’Œlockæ˜¯ç»‘å®šåœ¨ä¸€èµ·çš„ï¼Œè€Œlockçš„å®ç°åŸç†åˆä¾èµ–äºAQSï¼Œè‡ªç„¶è€Œç„¶ ConditionObject ä½œä¸ºAQSçš„ä¸€ä¸ªå†…éƒ¨ç±»æ— å¯åšéã€‚ æˆ‘ä»¬åœ¨ AQS è®²è¿‡ï¼ŒnextWaiter æ—¢å¯ä»¥ç”¨æ¥æ ‡å¿— Condition é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªï¼Œåˆå¯ä»¥æ ‡å¿—æ˜¯ç‹¬å é”/å…±äº«é”ï¼Œå¾ˆæ˜æ˜¾ä»è¿™é‡Œå°±å¯ä»¥çœ‹å‡ºç­‰å¾…é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå•å‘é˜Ÿåˆ—ï¼Œä¸åŒäºåŒæ­¥é˜Ÿåˆ—æ˜¯ä¸€ä¸ªåŒå‘é˜Ÿåˆ—ï¼Œå¹¶ä¸”ç­‰å¾…é˜Ÿåˆ—å¹¶æ²¡æœ‰å¤´ç»“ç‚¹ï¼Œä¸åƒåŒæ­¥é˜Ÿåˆ—æ˜¯æœ‰ä¸€ä¸ªå¤´ç»“ç‚¹çš„ã€‚è¿˜æœ‰ä¸€ç‚¹éœ€è¦å†å¼ºè°ƒä¸€æ¬¡ï¼Œå¯¹è±¡Objectå¯¹è±¡ç›‘è§†å™¨ä¸Šåªèƒ½æ‹¥æœ‰ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œè€Œå¹¶å‘åŒ…ä¸­çš„Lockæ‹¥æœ‰ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œå¤šä¸ªç­‰å¾…é˜Ÿåˆ—ã€‚ æ³¨ï¼š å›¾ä¸­çš„æ¡ä»¶é˜Ÿåˆ—å³ç­‰å¾…é˜Ÿåˆ—ã€‚æ¡ä»¶é˜Ÿåˆ—(ç­‰å¾…é˜Ÿåˆ—)çš„å±æ€§å¦‚ä¸‹ï¼Œç”¨å¤´å°¾æŒ‡é’ˆæ§åˆ¶æ•´ä¸ªé˜Ÿåˆ—ã€‚ 12345678910private static final long serialVersionUID = 1173984872572414699L;/** First node of condition queue. */private transient Node firstWaiter; // æ¡ä»¶é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹/** Last node of condition queue. */ private transient Node lastWaiter; // æ¡ä»¶é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹ /** * Creates a new &#123;@code ConditionObject&#125; instance. */public ConditionObject() &#123; &#125; Conditionçš„å®ç°ä¸»è¦åŒ…æ‹¬ï¼šæ¡ä»¶é˜Ÿåˆ—ã€ç­‰å¾…å’Œé€šçŸ¥ã€‚å…¶ä¸­æ¡ä»¶é˜Ÿåˆ—æ”¾çš„æ˜¯AQSé‡Œçš„Nodeæ•°æ®ç»“æ„ï¼Œä½¿ç”¨nextWaiteræ¥ç»´æŠ¤æ¡ä»¶é˜Ÿåˆ—ã€‚ç­‰å¾…å’Œé€šçŸ¥å…±æœ‰7ä¸ªæ–¹æ³•ã€‚ 12345678signal() //å”¤é†’è¯¥æ¡ä»¶é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹ã€‚signalAll() //å”¤é†’è¯¥æ¡ä»¶é˜Ÿåˆ—çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚awaitUninterruptibly() //ç­‰å¾…ï¼Œæ­¤æ–¹æ³•æ— æ³•è¢«ä¸­æ–­ï¼Œå¿…é¡»é€šè¿‡å”¤é†’æ‰èƒ½è§£é™¤é˜»å¡ã€‚await() //å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…ã€‚awaitNanos(long) //å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…ï¼Œæœ‰è¶…æ—¶æ—¶é—´ï¼Œå…¥å‚çš„å•ä½ä¸ºçº³ç§’ã€‚awaitUntil(Date) //å½“å…ˆçº¿ç¨‹è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°å½“å‰æ—¶é—´è¶…è¿‡å…¥å‚çš„æ—¶é—´ã€‚await(long, TimeUnit) //å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…ï¼Œæœ‰è¶…æ—¶æ—¶é—´ï¼Œå…¥å‚å¯ä»¥è‡ªå·±è®¾ç½®æ—¶é—´å•ä½ã€‚ è¿™äº›æ–¹æ³•å…¶å®å¤§åŒå°å¼‚ï¼Œå› æ­¤æœ¬æ–‡åªå¯¹å¸¸ç”¨çš„signal()ã€signalAll()å’Œawait()æ–¹æ³•å±•å¼€è¯¦è§£ã€‚ææ‡‚äº†è¿™3ä¸ªæ–¹æ³•ï¼Œææ‡‚å…¶ä»–å‡ ä¸ªæ–¹æ³•ä¹ŸåŸºæœ¬æ²¡ä»€ä¹ˆé˜»ç¢ã€‚ await()123456789101112131415161718public final void await() throws InterruptedException &#123; // é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´æ¥è¢«å”¤é†’æˆ–è¢«ä¸­æ–­ if (Thread.interrupted()) // å¦‚æœå½“å‰çº¿ç¨‹è¢«ä¸­æ–­è¿‡ï¼Œåˆ™æŠ›å‡ºä¸­æ–­å¼‚å¸¸ throw new InterruptedException(); Node node = addConditionWaiter(); // æ·»åŠ ä¸€ä¸ªwaitStatusä¸ºCONDITIONçš„èŠ‚ç‚¹åˆ°æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨ int savedState = fullyRelease(node); // é‡Šæ”¾æ“ä½œã€‚æˆ‘ä»¬çŸ¥é“åªæœ‰åœ¨æ‹¥æœ‰é”ï¼ˆacquireæˆåŠŸï¼‰çš„æ—¶å€™æ‰èƒ½è°ƒç”¨await()æ–¹æ³•ï¼Œå› æ­¤ï¼Œè°ƒç”¨await()æ–¹æ³•çš„çº¿ç¨‹çš„èŠ‚ç‚¹å¿…ç„¶æ˜¯åŒæ­¥é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹ã€‚æ‰€ä»¥ï¼Œå½“è°ƒç”¨await()æ–¹æ³•æ—¶ï¼Œç›¸å½“äºåŒæ­¥é˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹ï¼ˆè·å–äº†é”çš„èŠ‚ç‚¹ï¼‰ç§»åŠ¨åˆ°Conditionçš„æ¡ä»¶é˜Ÿåˆ—ä¸­ã€‚ int interruptMode = 0; // 0ä¸ºæ­£å¸¸ï¼Œè¢«ä¸­æ–­å€¼ä¸ºTHROW_IEæˆ–REINTERRUPT while (!isOnSyncQueue(node)) &#123; // isOnSyncQueueï¼šåˆ¤æ–­nodeæ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—ï¼ˆæ³¨æ„å’Œæ¡ä»¶é˜Ÿåˆ—åŒºåˆ†ã€‚è°ƒç”¨signalæ–¹æ³•ä¼šå°†èŠ‚ç‚¹ä»æ¡ä»¶é˜Ÿåˆ—ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œå› æ­¤è¿™è¾¹å°±å¯ä»¥è·³å‡ºwhileå¾ªç¯ï¼‰ LockSupport.park(this); // nodeå¦‚æœä¸åœ¨åŒæ­¥é˜Ÿåˆ—åˆ™è¿›è¡Œparkï¼ˆé˜»å¡å½“å‰çº¿ç¨‹ï¼‰ if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) // æ£€æŸ¥çº¿ç¨‹è¢«å”¤é†’æ˜¯å¦æ˜¯å› ä¸ºè¢«ä¸­æ–­ï¼Œå¦‚æœæ˜¯åˆ™è·³å‡ºå¾ªç¯ï¼Œå¦åˆ™ä¼šè¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œå› ä¸ºè¢«å”¤é†’å‰ææ˜¯è¿›å…¥åŒæ­¥é˜Ÿåˆ—ï¼Œæ‰€ä»¥ä¸‹ä¸€æ¬¡å¾ªç¯ä¹Ÿå¿…ç„¶ä¼šè·³å‡ºå¾ªç¯ break; &#125; if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) // acquireQueuedè¿”å›trueä»£è¡¨è¢«ä¸­æ–­è¿‡ï¼Œå¦‚æœä¸­æ–­æ¨¡å¼ä¸æ˜¯THROW_IEï¼Œåˆ™å¿…ç„¶ä¸ºREINTERRUPTï¼ˆè§ä¸Šé¢çš„checkInterruptWhileWaitingæ–¹æ³•ï¼‰ interruptMode = REINTERRUPT; if (node.nextWaiter != null) // clean up if cancelled unlinkCancelledWaiters(); // ç§»é™¤waitStatusä¸ºCANCELLEDçš„èŠ‚ç‚¹ if (interruptMode != 0) // å¦‚æœè·³å‡ºwhileå¾ªç¯æ˜¯å› ä¸ºè¢«ä¸­æ–­ reportInterruptAfterWait(interruptMode); // åˆ™æ ¹æ®interruptModeï¼Œé€‰æ‹©æŠ›å‡ºInterruptedException æˆ– é‡æ–°ä¸­æ–­å½“å‰çº¿ç¨‹&#125; æ€»ç»“ä¸€ä¸‹æ•´ä½“çš„æµç¨‹ï¼š åˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œæ˜¯çš„è¯å°±æŠ›å‡ºå¼‚å¸¸ï¼› ç„¶åå°†ç»™çº¿ç¨‹åŒ…è£…æˆèŠ‚ç‚¹ï¼Œä¸” WaitStatus == Conditionï¼Œè¿™ä¸ªç”± addConditionWaiter() å®Œæˆï¼Œä¸‹é¢ä¼šè®²ï¼› ç„¶åå°†åŒæ­¥é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹åˆ é™¤ï¼Œå…¶å®å°±ç›¸å½“äºæ˜¯å°†åŒæ­¥é˜Ÿåˆ—çš„å¤´ç»“ç‚¹åŠ å…¥åˆ°æ¡ä»¶é˜Ÿåˆ—ä¸­çš„å°¾ç»“ç‚¹ï¼Œè¿™ä¸ªæ˜¯ç”±fullRelease() å®Œæˆçš„ï¼› ç„¶ååˆ¤æ–­çº¿ç¨‹æ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªä½¿ç”¨çš„æ˜¯ isOnSyncQueue()ï¼Œç¬¬ä¸€æ¬¡è‚¯å®šæ˜¯å·²ç»ä¸åœ¨äº†ï¼Œå› ä¸ºè°ƒç”¨äº† fullRelease() å·²ç»å°†å…¶ä»åŒæ­¥é˜Ÿåˆ—ä¸­åˆ é™¤äº†ï¼Œè¿›å…¥å¾ªç¯åï¼Œå°±ä¼šé˜»å¡è¯¥çº¿ç¨‹ï¼Œå¦‚ä½•é€€å‡ºå‘¢ï¼Œé‚£å°±éœ€è¦ signaläº†ï¼› å½“è°ƒç”¨äº† signal åï¼Œç¨‹åºä¼šè·³å‡ºå¾ªç¯ï¼Œæ­¤æ—¶ signal å‡½æ•°å·²ç»å°†è¯¥èŠ‚ç‚¹ä»æ¡ä»¶é˜Ÿåˆ—åŠ å›è‡³åŒæ­¥é˜Ÿåˆ—ä¸­äº†ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨ acquireQueued() å°è¯•è·å–é”å°±å¯ä»¥äº†ã€‚ æ¥ä¸‹æ¥ï¼Œè®²ä¸€ä¸‹åˆšæ‰ç”¨åˆ°çš„å‡ ä¸ªæ–¹æ³•ï¼š addConditionWaiter()123456789101112131415private Node addConditionWaiter() &#123; // æ·»åŠ ä¸€ä¸ªwaitStatusä¸ºCONDITIONçš„èŠ‚ç‚¹åˆ°æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨ Node t = lastWaiter; // If lastWaiter is cancelled, clean out. if (t != null &amp;&amp; t.waitStatus != Node.CONDITION) &#123; unlinkCancelledWaiters(); // ç§»é™¤waitStatusä¸ä¸ºCONDITIONçš„èŠ‚ç‚¹ï¼ˆæ¡ä»¶é˜Ÿåˆ—é‡Œçš„èŠ‚ç‚¹waitStatuséƒ½ä¸ºCONDITIONï¼‰ t = lastWaiter; // å°†tèµ‹å€¼ä¸ºç§»é™¤äº†waitStatusä¸ä¸ºCONDITIONåçš„å°¾èŠ‚ç‚¹ï¼ˆä¸Šé¢è¿›è¡Œäº†ç§»é™¤æ“ä½œï¼Œå› æ­¤å°¾èŠ‚ç‚¹å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼‰ &#125; Node node = new Node(Thread.currentThread(), Node.CONDITION); // ä»¥å½“å‰çº¿ç¨‹æ–°å»ºä¸€ä¸ªwaitStatusä¸ºCONDITIONçš„èŠ‚ç‚¹ if (t == null) // tä¸ºç©ºï¼Œä»£è¡¨æ¡ä»¶é˜Ÿåˆ—ä¸ºç©º firstWaiter = node; // å°†å¤´èŠ‚ç‚¹èµ‹å€¼ä¸ºnode else t.nextWaiter = node; // å¦åˆ™ï¼Œé˜Ÿåˆ—ä¸ä¸ºç©ºã€‚å°†tï¼ˆåŸå°¾èŠ‚ç‚¹ï¼‰çš„åç»§èŠ‚ç‚¹èµ‹å€¼ä¸ºnode lastWaiter = node; // å°†nodeèµ‹å€¼ç»™å°¾èŠ‚ç‚¹ï¼Œå³å°†nodeæ”¾åˆ°æ¡ä»¶é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚è¿™é‡Œæ²¡æœ‰ç”¨CASæ¥ä¿è¯åŸå­æ€§ï¼ŒåŸå› åœ¨äºè°ƒç”¨await()æ–¹æ³•çš„çº¿ç¨‹å¿…å®šæ˜¯è·å–äº†é”çš„çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥è¿‡ç¨‹æ˜¯ç”±é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ return node;&#125; è¿™ä¸ªå‡½æ•°çš„ä¸»ä½“åŠŸèƒ½å°±æ˜¯æ·»åŠ ä¸€ä¸ªwaitStatusä¸ºCONDITIONçš„èŠ‚ç‚¹åˆ°æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨ï¼Œå…·ä½“å®ç°æ­¥éª¤æ˜¯ï¼š å¦‚æœæ¡ä»¶é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹ä¸ä¸ºnullå¹¶ä¸”waitStatusä¸ä¸ºCONDITIONï¼Œåˆ™è°ƒç”¨unlinkCancelledWaitersæ–¹æ³•ï¼ˆè¯¦è§£è§ä¸‹æ–‡unlinkCancelledWaitersæ–¹æ³•ï¼‰ç§»é™¤waitStatusä¸ä¸ºCONDITIONçš„èŠ‚ç‚¹ï¼ˆæ¡ä»¶é˜Ÿåˆ—é‡Œçš„èŠ‚ç‚¹waitStatuséƒ½ä¸ºCONDITIONï¼‰ï¼Œå¹¶å°†tèµ‹å€¼ä¸ºç§»é™¤äº†waitStatusä¸ä¸ºCONDITIONåçš„å°¾èŠ‚ç‚¹ï¼ˆä¸Šé¢è¿›è¡Œäº†ç§»é™¤æ“ä½œï¼Œå› æ­¤å°¾èŠ‚ç‚¹å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼‰ï¼› æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå­˜å‚¨å½“å‰çº¿ç¨‹ï¼› æ·»åŠ åˆ°é˜Ÿå°¾ï¼Œæ³¨æ„è¿™é‡Œä¸éœ€è¦ä½¿ç”¨ CASã€‚ 12345678910111213141516171819private void unlinkCancelledWaiters() &#123; // ä»æ¡ä»¶é˜Ÿåˆ—ç§»é™¤æ‰€æœ‰waitStatusä¸ä¸ºCONDITIONçš„èŠ‚ç‚¹ Node t = firstWaiter; // tèµ‹å€¼ä¸ºæ¡ä»¶é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹ Node trail = null; while (t != null) &#123; Node next = t.nextWaiter; // å‘ä¸‹éå† if (t.waitStatus != Node.CONDITION) &#123; // å¦‚æœtçš„waitStatusä¸ä¸ºCONDITION t.nextWaiter = null; // æ–­å¼€tä¸tåç»§èŠ‚ç‚¹çš„å…³è” if (trail == null) // å¦‚æœtrailä¸ºnullï¼Œåˆ™å°†firstWaiterèµ‹å€¼ä¸ºnextèŠ‚ç‚¹ï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰éå†åˆ°waitStatusä¸ºCONDITIONçš„èŠ‚ç‚¹ï¼Œå› æ­¤ç›´æ¥ç§»åŠ¨firstWaiterçš„æŒ‡é’ˆå³å¯ç§»é™¤å‰é¢çš„èŠ‚ç‚¹ firstWaiter = next; else trail.nextWaiter = next; // å¦åˆ™å°†trailçš„åç»§èŠ‚ç‚¹è®¾ä¸ºnextèŠ‚ç‚¹ã€‚æ­¤æ—¶ï¼ŒtrailèŠ‚ç‚¹åˆ°nextèŠ‚ç‚¹ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹è¢«ç§»é™¤ï¼ˆåŒ…æ‹¬tèŠ‚ç‚¹ï¼Œä½†å¯èƒ½ä¸æ­¢tèŠ‚ç‚¹ã€‚å› ä¸ºï¼Œtrailå§‹ç»ˆæŒ‡å‘éå†è¿‡çš„æœ€åä¸€ä¸ªwaitStatusä¸ºCONDITIONï¼Œå› æ­¤åªéœ€è¦å°†trailçš„åç»§èŠ‚ç‚¹è®¾ç½®ä¸ºnextï¼Œå³å¯å°†trailä¹‹ååˆ°nextä¹‹å‰çš„æ‰€æœ‰èŠ‚ç‚¹ç§»é™¤ï¼‰ if (next == null) lastWaiter = trail; &#125; else trail = t; // å¦‚æœtçš„waitStatusä¸ºCONDITIONï¼Œåˆ™å°†trailèµ‹å€¼ä¸ºtï¼Œtrailå§‹ç»ˆæŒ‡å‘éå†è¿‡çš„æœ€åä¸€ä¸ªwaitStatusä¸ºCONDITION t = next; // tæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ &#125;&#125; fullRelease()ä¸»ä½“ä¹Ÿå°±æ˜¯ AQS çš„ release æ–¹æ³•ï¼Œå°†å…¶ä»åŒæ­¥é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚ 123456789101112131415final int fullyRelease(Node node) &#123; // é‡Šæ”¾é” boolean failed = true; try &#123; int savedState = getState(); // å½“å‰çš„åŒæ­¥çŠ¶æ€ if (release(savedState)) &#123; // ç‹¬å æ¨¡å¼ä¸‹releaseï¼ˆä¸€èˆ¬æŒ‡é‡Šæ”¾é”ï¼‰ failed = false; return savedState; &#125; else &#123; throw new IllegalMonitorStateException(); &#125; &#125; finally &#123; if (failed) node.waitStatus = Node.CANCELLED; // å¦‚æœreleaseå¤±è´¥åˆ™å°†è¯¥èŠ‚ç‚¹çš„waitStatusè®¾ç½®ä¸ºCANCELLED &#125;&#125; isOnSyncQueue()12345678910111213141516171819final boolean isOnSyncQueue(Node node) &#123; // åˆ¤æ–­nodeæ˜¯å¦å†åŒæ­¥é˜Ÿåˆ—ä¸­ if (node.waitStatus == Node.CONDITION || node.prev == null) // å¦‚æœwaitStatusä¸ºCONDITION æˆ– nodeæ²¡æœ‰å‰é©±èŠ‚ç‚¹ï¼Œåˆ™å¿…ç„¶ä¸åœ¨åŒæ­¥é˜Ÿåˆ—ï¼Œç›´æ¥è¿”å›false return false; if (node.next != null) // å¦‚æœæœ‰åç»§èŠ‚ç‚¹ï¼Œå¿…ç„¶æ˜¯åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œè¿”å›true return true; return findNodeFromTail(node); // è¿”å›nodeæ˜¯å¦ä¸ºåŒæ­¥é˜Ÿåˆ—èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯è¿”å›trueï¼Œå¦åˆ™è¿”å›false&#125;// ä»åŒæ­¥é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹å¼€å§‹å‘å‰éå†ï¼Œå¦‚æœnodeä¸ºåŒæ­¥é˜Ÿåˆ—èŠ‚ç‚¹åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseprivate boolean findNodeFromTail(Node node) &#123; Node t = tail; for (;;) &#123; if (t == node) return true; if (t == null) return false; t = t.prev; &#125; signal()1234567public final void signal() &#123; if (!isHeldExclusively()) // æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºç‹¬å æ¨¡å¼åŒæ­¥å™¨çš„æ‰€æœ‰è€… throw new IllegalMonitorStateException(); Node first = firstWaiter; if (first != null) doSignal(first); // å”¤é†’æ¡ä»¶é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹&#125; å› ä¸ºæ¡ä»¶é˜Ÿåˆ—ï¼Œå³ç­‰å¾…é˜Ÿåˆ—ä¹Ÿæ˜¯ FIFOï¼Œå¤´ç»“ç‚¹å¿…ç„¶æ˜¯ç­‰çš„æœ€ä¹…çš„ä¸€ä¸ªï¼Œæ‰€ä»¥æ¯æ¬¡å”¤é†’éƒ½æ˜¯å”¤é†’å¤´ç»“ç‚¹ã€‚ å…·ä½“æ­¥éª¤ï¼š æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºç‹¬å æ¨¡å¼åŒæ­¥å™¨çš„æ‰€æœ‰è€…ï¼Œåœ¨ReentrantLockä¸­å³æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºæ‹¥æœ‰é”çš„çº¿ç¨‹ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™æŠ›IllegalMonitorStateExceptionã€‚ æ‹¿åˆ°æ¡ä»¶é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹ï¼Œå¦‚æœä¸ä¸ºnullï¼Œåˆ™è°ƒç”¨doSignalæ–¹æ³•ï¼ˆè¯¦è§£è§ä¸‹æ–‡doSignalæ–¹æ³•ï¼‰å”¤é†’å¤´èŠ‚ç‚¹ã€‚ 12345678910111213141516171819202122232425private void doSignal(Node first) &#123; // å°†æ¡ä»¶é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹ç§»åˆ°åŒæ­¥é˜Ÿåˆ— do &#123; if ( (firstWaiter = first.nextWaiter) == null) // å°†firstèŠ‚ç‚¹èµ‹å€¼ä¸ºfirstèŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ï¼ˆç›¸å½“äºç§»é™¤firstèŠ‚ç‚¹ï¼‰ï¼Œå¦‚æœfirstèŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™å°†lastWaiterèµ‹å€¼ä¸ºnull lastWaiter = null; first.nextWaiter = null; // æ–­å¼€firstèŠ‚ç‚¹å¯¹firstèŠ‚ç‚¹åç»§èŠ‚ç‚¹çš„å…³è” &#125; while (!transferForSignal(first) &amp;&amp; // transferForSignalï¼šå°†firstèŠ‚ç‚¹ä»æ¡ä»¶é˜Ÿåˆ—ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ— (first = firstWaiter) != null); // å¦‚æœtransferForSignalå¤±è´¥ï¼Œå¹¶ä¸”firstèŠ‚ç‚¹ä¸ä¸ºnullï¼Œåˆ™å‘ä¸‹éå†æ¡ä»¶é˜Ÿåˆ—çš„èŠ‚ç‚¹ï¼Œç›´åˆ°èŠ‚ç‚¹æˆåŠŸç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ— æˆ–è€… firstWaiterä¸ºnull&#125;// å°†nodeèŠ‚ç‚¹ä»æ¡ä»¶é˜Ÿåˆ—ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›trueã€‚final boolean transferForSignal(Node node) &#123; if (!compareAndSetWaitStatus(node, Node.CONDITION, 0)) // å¦‚æœä¸èƒ½æ›´æ”¹èŠ‚ç‚¹çš„waitStatusï¼Œåˆ™è¡¨ç¤ºè¯¥èŠ‚ç‚¹å·²è¢«å–æ¶ˆï¼Œè¿”å›false return false; // å¦åˆ™ï¼Œè°ƒç”¨enqæ–¹æ³•å°†nodeæ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œæ³¨æ„ï¼šenqæ–¹æ³•è¿”å›çš„èŠ‚ç‚¹æ˜¯nodeçš„å‰é©±èŠ‚ç‚¹ Node p = enq(node); int ws = p.waitStatus; // å°†wsèµ‹å€¼ä¸ºnodeå‰é©±èŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€ if (ws &gt; 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL)) // å¦‚æœnodeå‰é©±èŠ‚ç‚¹çš„çŠ¶æ€ä¸ºCANCELLEDï¼ˆws&gt;0ï¼‰ //æˆ– ä½¿ç”¨CASå°†waitStatusä¿®æ”¹æˆSIGNALå¤±è´¥ï¼Œåˆ™ä»£è¡¨nodeçš„å‰é©±èŠ‚ç‚¹æ— æ³•æ¥å”¤é†’nodeèŠ‚ç‚¹ï¼Œå› æ­¤ç›´æ¥è°ƒç”¨LockSupport.unparkæ–¹æ³•å”¤é†’nodeèŠ‚ç‚¹ // æ³¨æ„ï¼ŒunparkSuccessor(node)æ˜¯å”¤é†’è¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€ŒLockSupport.lockåˆ™æ˜¯ç›´æ¥å”¤é†’è¯¥èŠ‚ç‚¹ LockSupport.unpark(node.thread); return true;&#125; signalAll()1234567public final void signalAll() &#123; if (!isHeldExclusively()) // æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºç‹¬å æ¨¡å¼åŒæ­¥å™¨çš„æ‰€æœ‰è€… throw new IllegalMonitorStateException(); Node first = firstWaiter; if (first != null) doSignalAll(first); // å”¤é†’æ¡ä»¶é˜Ÿåˆ—çš„æ‰€æœ‰èŠ‚ç‚¹&#125; 123456789private void doSignalAll(Node first) &#123; // å°†æ¡ä»¶é˜Ÿåˆ—çš„æ‰€æœ‰èŠ‚ç‚¹ç§»åˆ°åŒæ­¥é˜Ÿåˆ— lastWaiter = firstWaiter = null; // å› ä¸ºè¦ç§»é™¤æ¡ä»¶é˜Ÿåˆ—çš„æ‰€æœ‰èŠ‚ç‚¹åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œå› æ­¤è¿™è¾¹ç›´æ¥å°†firstWaiterå’ŒlastWaiterèµ‹å€¼ä¸ºnull do &#123; Node next = first.nextWaiter; // nextèµ‹å€¼ä¸ºfirstèŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ first.nextWaiter = null; // æ–­å¼€firstèŠ‚ç‚¹å¯¹firstèŠ‚ç‚¹åç»§èŠ‚ç‚¹çš„å…³è” transferForSignal(first); // transferForSignalï¼šå°†firstèŠ‚ç‚¹ä»æ¡ä»¶é˜Ÿåˆ—ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ— first = next; // firstèµ‹å€¼ä¸ºnextèŠ‚ç‚¹ &#125; while (first != null); // å¾ªç¯éå†ï¼Œå°†æ¡ä»¶é˜Ÿåˆ—çš„æ‰€æœ‰èŠ‚ç‚¹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—&#125; è‡³æ­¤ï¼ŒCondition å°±åˆ†æå®Œäº†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ Condition å†™ä¸€ä¸ª ç”Ÿäº§è€…-æ¶ˆè´¹è€…çš„demoï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677package å¤šçº¿ç¨‹.Producer_Consumer;import java.util.LinkedList;import java.util.concurrent.TimeUnit;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;public class await_signal &#123; private final static Lock lock = new ReentrantLock(); private final static Condition producer_condition = lock.newCondition(); private final static Condition consumer_condition = lock.newCondition(); private final static LinkedList&lt;Long&gt; linkedList = new LinkedList&lt;&gt;(); private final static int MAX_CAPACITY = 100; public static void main(String[] args) &#123; new Thread(() -&gt; &#123; for (int i = 0; i &lt; 10; i++) &#123; while (true) &#123; await_signal.producer(); try &#123; TimeUnit.SECONDS.sleep(5); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;).start(); new Thread(() -&gt; &#123; for (int i = 0; i &lt; 14; i++) &#123; while (true) &#123; await_signal.consumer(); try &#123; TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;).start(); &#125; private static void producer() &#123; try &#123; lock.lock(); if (linkedList.size() &gt; MAX_CAPACITY) &#123; producer_condition.await(); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; long value = System.currentTimeMillis(); System.out.println(Thread.currentThread().getName() + ":-------PRODUCER-------- " + value); linkedList.addLast(value); consumer_condition.signalAll(); lock.unlock(); &#125; &#125; private static void consumer() &#123; try &#123; lock.lock(); if (linkedList.size() == 0) &#123; consumer_condition.await(); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; long value = linkedList.pop(); System.out.println(Thread.currentThread().getName() + "::-------CONSUMER-------- " + value); producer_condition.signalAll(); lock.unlock(); &#125; &#125;&#125; LockSupport &amp; UnsafeLockSupport.park() vs Object.wait() vs Thread.sleep() ä»é‡Šæ”¾èµ„æºçœ‹ï¼Œä¸‰è€…åœ¨é˜»å¡çº¿ç¨‹åï¼ŒLockSupport.park() ä¼šé˜»å¡çº¿ç¨‹å¹¶ä¸”ä¸ä¼šé‡Šæ”¾é”èµ„æºï¼Œæ³¨æ„ï¼Œæœ¬èº« park() æ˜¯ä¸ä¼šé‡Šæ”¾èµ„æºçš„ï¼Œæˆ‘ä»¬åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ä¸­å°±æ˜¯ç”¨ park() æ¥ä½¿å¾—çº¿ç¨‹æŒ‚èµ·ï¼ˆwaitçŠ¶æ€ï¼‰ï¼Œç­‰å¾…èµ„æºã€‚Object.wait() ï¼ˆä¹Ÿæ˜¯waitçŠ¶æ€ï¼‰ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œå¹¶ä¸”è®©å‡ºæ—¶é—´ç‰‡å’Œé”èµ„æºï¼Œç­‰å¾…è¢« notify æ‰è·å¾— monitorï¼Œæ‹¿åˆ°é”èµ„æºã€‚Thread.sleep() ä¼šè®©çº¿ç¨‹sleepï¼ˆsleepçŠ¶æ€ï¼‰ï¼ŒåŒæ ·é˜»å¡å½“å‰çº¿ç¨‹ï¼Œä½†æ˜¯ä¸ä¼šè®©å‡ºé”èµ„æºï¼› ä½¿ç”¨çš„å‰ææ¡ä»¶çœ‹ã€‚Object.wait() å¿…é¡»åœ¨ Synchronized é‡Œç”¨ï¼ŒLockSupport.park() å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç”¨ï¼ŒThread.sleep() å½“ç„¶ä¹Ÿæ˜¯åœ°æ–¹éƒ½èƒ½ç”¨ï¼› ä»ä¸­æ–­å¼‚å¸¸çœ‹ã€‚LockSupport.park() ä¸éœ€è¦æ•è·ä¸­æ–­å¼‚å¸¸ï¼Œæ³¨æ„ï¼Œå®ƒä¸éœ€è¦æ•è·ï¼Œå¹¶ä¸”å®ƒä¼šä»ä¸­æ–­ä¸­é†’æ¥ï¼Œå°†çº¿ç¨‹ç”± interrupted â€”&gt; runningï¼Œæ‰€ä»¥å¤–éƒ¨è°ƒç”¨æ—¶éœ€è¦è°¨æ…ï¼Œè¿™é‡Œæé†’ä¸€ä¸‹ï¼Œå°¤å…¶æ˜¯åœ¨ StampedLock ä¸­ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœ writeLock ä¸€ç›´åœ¨ä½¿ç”¨é”èµ„æºï¼Œè€ŒreadLockåœ¨ç­‰å¾…é”èµ„æºåå¼€å§‹æŒ‚èµ·ï¼Œçªç„¶å°†readLockçº¿ç¨‹ä¸­æ–­çš„è¯ï¼Œå› ä¸º StampedLock.readLock() ä¸å¤„ç†ä¸­æ–­ï¼Œæ‰€ä»¥ç›´æ¥å°†çº¿ç¨‹ç”± wait â€“&gt; runningï¼Œæ­¤æ—¶çº¿ç¨‹ä¼šä¸€ç›´è‡ªæ—‹è·å–é”ï¼Œä½†æ˜¯ç”±äºé”ä¸€ç›´è¢« writeLockï¼Œæ­¤æ—¶ CPUå°±ä¼šçˆ†ç‚¸ã€‚Object.wait() å£°æ˜æŠ›å‡ºäº†ä¸­æ–­å¼‚å¸¸ï¼Œè°ƒç”¨è€…éœ€è¦æ•è·æˆ–è€…å†æŠ›å‡ºï¼ŒThread.sleep()æ–¹æ³•å£°æ˜ä¸Šä¹Ÿæ˜¯æŠ›å‡ºäº†InterruptedExceptionä¸­æ–­å¼‚å¸¸ï¼Œæ‰€ä»¥è°ƒç”¨è€…éœ€è¦æ•è·è¿™ä¸ªå¼‚å¸¸æˆ–è€…å†æŠ›å‡ºï¼› å”¤é†’æ–¹å¼çœ‹ã€‚LockSupport.park() å¯ä»¥é€šè¿‡ LockSupport.unpark() æˆ–è€…ä¸­æ–­å”¤é†’ï¼ŒObject.wait() åˆ™éœ€è¦è°ƒç”¨ å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ notify() è¿›è¡Œå”¤é†’ï¼ŒThread.sleep() åªèƒ½è‡ªå·±é†’è¿‡æ¥ï¼› è¡¥å……ï¼šå¦‚æœåœ¨wait()ä¹‹å‰æ‰§è¡Œäº†notify()ä¼šæ€æ ·ï¼ŸæŠ›å‡ºIllegalMonitorStateExceptionå¼‚å¸¸ï¼› å¦‚æœåœ¨park()ä¹‹å‰æ‰§è¡Œäº†unpark()ä¼šæ€æ ·ï¼Ÿçº¿ç¨‹ä¸ä¼šè¢«é˜»å¡ï¼Œç›´æ¥è·³è¿‡park()ï¼Œç»§ç»­æ‰§è¡Œåç»­å†…å®¹ã€‚ ç®€ä»‹LockSupportä¸‹çš„å¾ˆå¤šæ–¹æ³•ï¼Œä¾‹å¦‚æˆ‘ä»¬ä¹‹å‰å¸¸å¸¸æåŠçš„ LockSupport.park()ã€LockSupport.unpark() éƒ½æ˜¯ç”¨äº† Unsafe ç±»ä¸‹çš„ park() å’Œ unpark() æ–¹æ³•ã€‚ 123456public static void park(Object blocker) &#123; Thread t = Thread.currentThread(); setBlocker(t, blocker); UNSAFE.park(false, 0L); setBlocker(t, null); &#125; 1234private static void setBlocker(Thread t, Object arg) &#123; // Even though volatile, hotspot doesn't need a write barrier here. UNSAFE.putObject(t, parkBlockerOffset, arg);&#125; 12345public static Object getBlocker(Thread t) &#123; if (t == null) throw new NullPointerException(); return UNSAFE.getObjectVolatile(t, parkBlockerOffset);&#125; å¯ä»¥çœ‹åˆ°ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸ªæ–¹æ³•çš„åº•å±‚éƒ½æ˜¯ä½¿ç”¨äº† Unsafe ç±»çš„æ–¹æ³•ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ä¸»è¦åˆ†æä¸€ä¸‹ Unsafeã€‚ Unsafeç®€ä»‹ https://tech.meituan.com/2019/02/14/talk-about-java-magic-class-unsafe.html å±äº sun.misc.Unsafeã€‚ é‡‡ç”¨é¥¿æ±‰å¼çš„å•ä¾‹æ¨¡å¼ï¼Œä½†Unsafeç±»åšäº†é™åˆ¶ï¼Œå¦‚æœæ˜¯æ™®é€šçš„è°ƒç”¨çš„è¯ï¼Œå®ƒä¼šæŠ›å‡ºä¸€ä¸ªSecurityExceptionå¼‚å¸¸ï¼›åªæœ‰ç”±ä¸»ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ‰èƒ½è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ 1234567891011121314151617private static native void registerNatives();static &#123; registerNatives(); sun.reflect.Reflection.registerMethodsToFilter(Unsafe.class, "getUnsafe");&#125;private Unsafe() &#123;&#125;private static final Unsafe theUnsafe = new Unsafe();@CallerSensitivepublic static Unsafe getUnsafe() &#123; Class&lt;?&gt; caller = Reflection.getCallerClass(); if (!VM.isSystemDomainLoader(caller.getClassLoader())) throw new SecurityException("Unsafe"); return theUnsafe;&#125; åŠŸèƒ½ä»‹ç» å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒUnsafeæä¾›çš„APIå¤§è‡´å¯åˆ†ä¸ºå†…å­˜æ“ä½œã€CASã€Classç›¸å…³ã€å¯¹è±¡æ“ä½œã€çº¿ç¨‹è°ƒåº¦ã€ç³»ç»Ÿä¿¡æ¯è·å–ã€å†…å­˜å±éšœã€æ•°ç»„æ“ä½œç­‰å‡ ç±»ï¼Œä¸‹é¢å°†å¯¹å…¶ç›¸å…³æ–¹æ³•å’Œåº”ç”¨åœºæ™¯è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚ å†…å­˜æ“ä½œä¸»è¦æ˜¯ç®¡æ§å †å¤–çš„ä¸€äº›å†…å­˜æ“ä½œã€‚ 123456789101112131415161718//åˆ†é…å†…å­˜, ç›¸å½“äºC++çš„mallocå‡½æ•°public native long allocateMemory(long bytes);//æ‰©å……å†…å­˜public native long reallocateMemory(long address, long bytes);//é‡Šæ”¾å†…å­˜public native void freeMemory(long address);//åœ¨ç»™å®šçš„å†…å­˜å—ä¸­è®¾ç½®å€¼public native void setMemory(Object o, long offset, long bytes, byte value);//å†…å­˜æ‹·è´public native void copyMemory(Object srcBase, long srcOffset, Object destBase, long destOffset, long bytes);//è·å–ç»™å®šåœ°å€å€¼ï¼Œå¿½ç•¥ä¿®é¥°é™å®šç¬¦çš„è®¿é—®é™åˆ¶ã€‚ä¸æ­¤ç±»ä¼¼æ“ä½œè¿˜æœ‰: getIntï¼ŒgetDoubleï¼ŒgetLongï¼ŒgetCharç­‰public native Object getObject(Object o, long offset);//ä¸ºç»™å®šåœ°å€è®¾ç½®å€¼ï¼Œå¿½ç•¥ä¿®é¥°é™å®šç¬¦çš„è®¿é—®é™åˆ¶ï¼Œä¸æ­¤ç±»ä¼¼æ“ä½œè¿˜æœ‰: putInt,putDoubleï¼ŒputLongï¼ŒputCharç­‰public native void putObject(Object o, long offset, Object x);//è·å–ç»™å®šåœ°å€çš„byteç±»å‹çš„å€¼ï¼ˆå½“ä¸”ä»…å½“è¯¥å†…å­˜åœ°å€ä¸ºallocateMemoryåˆ†é…æ—¶ï¼Œæ­¤æ–¹æ³•ç»“æœä¸ºç¡®å®šçš„ï¼‰public native byte getByte(long address);//ä¸ºç»™å®šåœ°å€è®¾ç½®byteç±»å‹çš„å€¼ï¼ˆå½“ä¸”ä»…å½“è¯¥å†…å­˜åœ°å€ä¸ºallocateMemoryåˆ†é…æ—¶ï¼Œæ­¤æ–¹æ³•ç»“æœæ‰æ˜¯ç¡®å®šçš„ï¼‰public native void putByte(long address, byte x); é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨Javaä¸­åˆ›å»ºçš„å¯¹è±¡éƒ½å¤„äºå †å†…å†…å­˜ï¼ˆheapï¼‰ä¸­ï¼Œå †å†…å†…å­˜æ˜¯ç”±JVMæ‰€ç®¡æ§çš„Javaè¿›ç¨‹å†…å­˜ï¼Œå¹¶ä¸”å®ƒä»¬éµå¾ªJVMçš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼ŒJVMä¼šé‡‡ç”¨åƒåœ¾å›æ”¶æœºåˆ¶ç»Ÿä¸€ç®¡ç†å †å†…å­˜ã€‚ä¸ä¹‹ç›¸å¯¹çš„æ˜¯å †å¤–å†…å­˜ï¼Œå­˜åœ¨äºJVMç®¡æ§ä¹‹å¤–çš„å†…å­˜åŒºåŸŸï¼ŒJavaä¸­å¯¹å †å¤–å†…å­˜çš„æ“ä½œï¼Œä¾èµ–äºUnsafeæä¾›çš„æ“ä½œå †å¤–å†…å­˜çš„nativeæ–¹æ³•ã€‚ ä½¿ç”¨å †å¤–å†…å­˜çš„åŸå›  å¯¹åƒåœ¾å›æ”¶åœé¡¿çš„æ”¹å–„ã€‚ç”±äºå †å¤–å†…å­˜æ˜¯ç›´æ¥å—æ“ä½œç³»ç»Ÿç®¡ç†è€Œä¸æ˜¯JVMï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨å †å¤–å†…å­˜æ—¶ï¼Œå³å¯ä¿æŒè¾ƒå°çš„å †å†…å†…å­˜è§„æ¨¡ã€‚ä»è€Œåœ¨GCæ—¶å‡å°‘å›æ”¶åœé¡¿å¯¹äºåº”ç”¨çš„å½±å“ã€‚ æå‡ç¨‹åºI/Oæ“ä½œçš„æ€§èƒ½ã€‚é€šå¸¸åœ¨I/Oé€šä¿¡è¿‡ç¨‹ä¸­ï¼Œä¼šå­˜åœ¨å †å†…å†…å­˜åˆ°å †å¤–å†…å­˜çš„æ•°æ®æ‹·è´æ“ä½œï¼Œå¯¹äºéœ€è¦é¢‘ç¹è¿›è¡Œå†…å­˜é—´æ•°æ®æ‹·è´ä¸”ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„æš‚å­˜æ•°æ®ï¼Œéƒ½å»ºè®®å­˜å‚¨åˆ°å †å¤–å†…å­˜ã€‚ å…¸å‹åº”ç”¨DirectByteBufferæ˜¯Javaç”¨äºå®ç°å †å¤–å†…å­˜çš„ä¸€ä¸ªé‡è¦ç±»ï¼Œé€šå¸¸ç”¨åœ¨é€šä¿¡è¿‡ç¨‹ä¸­åšç¼“å†²æ± ï¼Œå¦‚åœ¨Nettyã€MINAç­‰NIOæ¡†æ¶ä¸­åº”ç”¨å¹¿æ³›ã€‚DirectByteBufferå¯¹äºå †å¤–å†…å­˜çš„åˆ›å»ºã€ä½¿ç”¨ã€é”€æ¯ç­‰é€»è¾‘å‡ç”±Unsafeæä¾›çš„å †å¤–å†…å­˜APIæ¥å®ç°ã€‚ ä¸‹å›¾ä¸ºDirectByteBufferæ„é€ å‡½æ•°ï¼Œåˆ›å»ºDirectByteBufferçš„æ—¶å€™ï¼Œé€šè¿‡Unsafe.allocateMemoryåˆ†é…å†…å­˜ã€Unsafe.setMemoryè¿›è¡Œå†…å­˜åˆå§‹åŒ–ï¼Œè€Œåæ„å»ºCleanerå¯¹è±¡ç”¨äºè·Ÿè¸ªDirectByteBufferå¯¹è±¡çš„åƒåœ¾å›æ”¶ï¼Œä»¥å®ç°å½“DirectByteBufferè¢«åƒåœ¾å›æ”¶æ—¶ï¼Œåˆ†é…çš„å †å¤–å†…å­˜ä¸€èµ·è¢«é‡Šæ”¾ã€‚ é‚£ä¹ˆå¦‚ä½•é€šè¿‡æ„å»ºåƒåœ¾å›æ”¶è¿½è¸ªå¯¹è±¡Cleanerå®ç°å †å¤–å†…å­˜é‡Šæ”¾å‘¢ï¼Ÿ Cleanerç»§æ‰¿è‡ªJavaå››å¤§å¼•ç”¨ç±»å‹ä¹‹ä¸€çš„è™šå¼•ç”¨PhantomReferenceï¼ˆä¼—æ‰€å‘¨çŸ¥ï¼Œæ— æ³•é€šè¿‡è™šå¼•ç”¨è·å–ä¸ä¹‹å…³è”çš„å¯¹è±¡å®ä¾‹ï¼Œä¸”å½“å¯¹è±¡ä»…è¢«è™šå¼•ç”¨å¼•ç”¨æ—¶ï¼Œåœ¨ä»»ä½•å‘ç”ŸGCçš„æ—¶å€™ï¼Œå…¶å‡å¯è¢«å›æ”¶ï¼‰ï¼Œé€šå¸¸PhantomReferenceä¸å¼•ç”¨é˜Ÿåˆ—ReferenceQueueç»“åˆä½¿ç”¨ï¼Œå¯ä»¥å®ç°è™šå¼•ç”¨å…³è”å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶èƒ½å¤Ÿè¿›è¡Œç³»ç»Ÿé€šçŸ¥ã€èµ„æºæ¸…ç†ç­‰åŠŸèƒ½ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“æŸä¸ªè¢«Cleanerå¼•ç”¨çš„å¯¹è±¡å°†è¢«å›æ”¶æ—¶ï¼ŒJVMåƒåœ¾æ”¶é›†å™¨ä¼šå°†æ­¤å¯¹è±¡çš„å¼•ç”¨æ”¾å…¥åˆ°å¯¹è±¡å¼•ç”¨ä¸­çš„pendingé“¾è¡¨ä¸­ï¼Œç­‰å¾…Reference-Handlerè¿›è¡Œç›¸å…³å¤„ç†ã€‚å…¶ä¸­ï¼ŒReference-Handlerä¸ºä¸€ä¸ªæ‹¥æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„å®ˆæŠ¤çº¿ç¨‹ï¼Œä¼šå¾ªç¯ä¸æ–­çš„å¤„ç†pendingé“¾è¡¨ä¸­çš„å¯¹è±¡å¼•ç”¨ï¼Œæ‰§è¡ŒCleanerçš„cleanæ–¹æ³•è¿›è¡Œç›¸å…³æ¸…ç†å·¥ä½œã€‚ Tip: è¿™å—åŸºæœ¬ä¸æ‡‚å•Šâ€¦â€¦ç­‰å¤ä¹ å®Œå¤šçº¿ç¨‹å¾—æ¶è¡¥ä¸€ä¸‹ JVM çš„ç›¸å…³çŸ¥è¯†äº†â€¦ CAS ç›¸å…³12345678910111213/** * CAS * @param o åŒ…å«è¦ä¿®æ”¹fieldçš„å¯¹è±¡ * @param offset å¯¹è±¡ä¸­æŸfieldçš„åç§»é‡ * @param expected æœŸæœ›å€¼ * @param update æ›´æ–°å€¼ * @return true | false */public final native boolean compareAndSwapObject(Object o, long offset, Object expected, Object update);public final native boolean compareAndSwapInt(Object o, long offset, int expected,int update); public final native boolean compareAndSwapLong(Object o, long offset, long expected, long update); ä»€ä¹ˆæ˜¯CAS? å³æ¯”è¾ƒå¹¶æ›¿æ¢ï¼Œå®ç°å¹¶å‘ç®—æ³•æ—¶å¸¸ç”¨åˆ°çš„ä¸€ç§æŠ€æœ¯ã€‚CASæ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°â€”â€”å†…å­˜ä½ç½®ã€é¢„æœŸåŸå€¼åŠæ–°å€¼ã€‚æ‰§è¡ŒCASæ“ä½œçš„æ—¶å€™ï¼Œå°†å†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸåŸå€¼æ¯”è¾ƒï¼Œå¦‚æœç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œå¦åˆ™ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒCASæ˜¯ä¸€æ¡CPUçš„åŸå­æŒ‡ä»¤ï¼ˆcmpxchgæŒ‡ä»¤ï¼‰ï¼Œä¸ä¼šé€ æˆæ‰€è°“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼ŒUnsafeæä¾›çš„CASæ–¹æ³•ï¼ˆå¦‚compareAndSwapXXXï¼‰åº•å±‚å®ç°å³ä¸ºCPUæŒ‡ä»¤cmpxchgã€‚ çº¿ç¨‹è°ƒåº¦1234567891011121314//å–æ¶ˆé˜»å¡çº¿ç¨‹public native void unpark(Object thread);//é˜»å¡çº¿ç¨‹public native void park(boolean isAbsolute, long time);//è·å¾—å¯¹è±¡é”ï¼ˆå¯é‡å…¥é”ï¼‰@Deprecatedpublic native void monitorEnter(Object o);//é‡Šæ”¾å¯¹è±¡é”@Deprecatedpublic native void monitorExit(Object o);//å°è¯•è·å–å¯¹è±¡é”@Deprecatedpublic native boolean tryMonitorEnter(Object o); å¦‚ä¸Šæºç è¯´æ˜ä¸­ï¼Œæ–¹æ³•parkã€unparkå³å¯å®ç°çº¿ç¨‹çš„æŒ‚èµ·ä¸æ¢å¤ï¼Œå°†ä¸€ä¸ªçº¿ç¨‹è¿›è¡ŒæŒ‚èµ·æ˜¯é€šè¿‡parkæ–¹æ³•å®ç°çš„ï¼Œè°ƒç”¨parkæ–¹æ³•åï¼Œçº¿ç¨‹å°†ä¸€ç›´é˜»å¡ç›´åˆ°è¶…æ—¶æˆ–è€…ä¸­æ–­ç­‰æ¡ä»¶å‡ºç°ï¼›unparkå¯ä»¥ç»ˆæ­¢ä¸€ä¸ªæŒ‚èµ·çš„çº¿ç¨‹ï¼Œä½¿å…¶æ¢å¤æ­£å¸¸ã€‚ Javaé”å’ŒåŒæ­¥å™¨æ¡†æ¶çš„æ ¸å¿ƒç±»AbstractQueuedSynchronizerï¼Œå°±æ˜¯é€šè¿‡è°ƒç”¨LockSupport.park()å’ŒLockSupport.unpark()å®ç°çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’çš„ï¼Œè€ŒLockSupportçš„parkã€unparkæ–¹æ³•å®é™…æ˜¯è°ƒç”¨Unsafeçš„parkã€unparkæ–¹å¼æ¥å®ç°ã€‚ Classç›¸å…³æ­¤éƒ¨åˆ†ä¸»è¦æä¾›Classå’Œå®ƒçš„é™æ€å­—æ®µçš„æ“ä½œç›¸å…³æ–¹æ³•ï¼ŒåŒ…å«é™æ€å­—æ®µå†…å­˜å®šä½ã€å®šä¹‰ç±»ã€å®šä¹‰åŒ¿åç±»ã€æ£€éªŒ&amp;ç¡®ä¿åˆå§‹åŒ–ç­‰ã€‚ 123456789101112//è·å–ç»™å®šé™æ€å­—æ®µçš„å†…å­˜åœ°å€åç§»é‡ï¼Œè¿™ä¸ªå€¼å¯¹äºç»™å®šçš„å­—æ®µæ˜¯å”¯ä¸€ä¸”å›ºå®šä¸å˜çš„public native long staticFieldOffset(Field f);//è·å–ä¸€ä¸ªé™æ€ç±»ä¸­ç»™å®šå­—æ®µçš„å¯¹è±¡æŒ‡é’ˆpublic native Object staticFieldBase(Field f);//åˆ¤æ–­æ˜¯å¦éœ€è¦åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œé€šå¸¸åœ¨è·å–ä¸€ä¸ªç±»çš„é™æ€å±æ€§çš„æ—¶å€™ï¼ˆå› ä¸ºä¸€ä¸ªç±»å¦‚æœæ²¡åˆå§‹åŒ–ï¼Œå®ƒçš„é™æ€å±æ€§ä¹Ÿä¸ä¼šåˆå§‹åŒ–ï¼‰ä½¿ç”¨ã€‚ å½“ä¸”ä»…å½“ensureClassInitializedæ–¹æ³•ä¸ç”Ÿæ•ˆæ—¶è¿”å›falseã€‚public native boolean shouldBeInitialized(Class&lt;?&gt; c);//æ£€æµ‹ç»™å®šçš„ç±»æ˜¯å¦å·²ç»åˆå§‹åŒ–ã€‚é€šå¸¸åœ¨è·å–ä¸€ä¸ªç±»çš„é™æ€å±æ€§çš„æ—¶å€™ï¼ˆå› ä¸ºä¸€ä¸ªç±»å¦‚æœæ²¡åˆå§‹åŒ–ï¼Œå®ƒçš„é™æ€å±æ€§ä¹Ÿä¸ä¼šåˆå§‹åŒ–ï¼‰ä½¿ç”¨ã€‚public native void ensureClassInitialized(Class&lt;?&gt; c);//å®šä¹‰ä¸€ä¸ªç±»ï¼Œæ­¤æ–¹æ³•ä¼šè·³è¿‡JVMçš„æ‰€æœ‰å®‰å…¨æ£€æŸ¥ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒClassLoaderï¼ˆç±»åŠ è½½å™¨ï¼‰å’ŒProtectionDomainï¼ˆä¿æŠ¤åŸŸï¼‰å®ä¾‹æ¥æºäºè°ƒç”¨è€…public native Class&lt;?&gt; defineClass(String name, byte[] b, int off, int len, ClassLoader loader, ProtectionDomain protectionDomain);//å®šä¹‰ä¸€ä¸ªåŒ¿åç±»public native Class&lt;?&gt; defineAnonymousClass(Class&lt;?&gt; hostClass, byte[] data, Object[] cpPatches); å¯¹è±¡æ“ä½œæ­¤éƒ¨åˆ†ä¸»è¦åŒ…å«å¯¹è±¡æˆå‘˜å±æ€§ç›¸å…³æ“ä½œåŠéå¸¸è§„çš„å¯¹è±¡å®ä¾‹åŒ–æ–¹å¼ç­‰ç›¸å…³æ–¹æ³•ã€‚ 1234567891011121314//è¿”å›å¯¹è±¡æˆå‘˜å±æ€§åœ¨å†…å­˜åœ°å€ç›¸å¯¹äºæ­¤å¯¹è±¡çš„å†…å­˜åœ°å€çš„åç§»é‡public native long objectFieldOffset(Field f);//è·å¾—ç»™å®šå¯¹è±¡çš„æŒ‡å®šåœ°å€åç§»é‡çš„å€¼ï¼Œä¸æ­¤ç±»ä¼¼æ“ä½œè¿˜æœ‰ï¼šgetIntï¼ŒgetDoubleï¼ŒgetLongï¼ŒgetCharç­‰public native Object getObject(Object o, long offset);//ç»™å®šå¯¹è±¡çš„æŒ‡å®šåœ°å€åç§»é‡è®¾å€¼ï¼Œä¸æ­¤ç±»ä¼¼æ“ä½œè¿˜æœ‰ï¼šputIntï¼ŒputDoubleï¼ŒputLongï¼ŒputCharç­‰public native void putObject(Object o, long offset, Object x);//ä»å¯¹è±¡çš„æŒ‡å®šåç§»é‡å¤„è·å–å˜é‡çš„å¼•ç”¨ï¼Œä½¿ç”¨volatileçš„åŠ è½½è¯­ä¹‰public native Object getObjectVolatile(Object o, long offset);//å­˜å‚¨å˜é‡çš„å¼•ç”¨åˆ°å¯¹è±¡çš„æŒ‡å®šçš„åç§»é‡å¤„ï¼Œä½¿ç”¨volatileçš„å­˜å‚¨è¯­ä¹‰public native void putObjectVolatile(Object o, long offset, Object x);//æœ‰åºã€å»¶è¿Ÿç‰ˆæœ¬çš„putObjectVolatileæ–¹æ³•ï¼Œä¸ä¿è¯å€¼çš„æ”¹å˜è¢«å…¶ä»–çº¿ç¨‹ç«‹å³çœ‹åˆ°ã€‚åªæœ‰åœ¨fieldè¢«volatileä¿®é¥°ç¬¦ä¿®é¥°æ—¶æœ‰æ•ˆpublic native void putOrderedObject(Object o, long offset, Object x);//ç»•è¿‡æ„é€ æ–¹æ³•ã€åˆå§‹åŒ–ä»£ç æ¥åˆ›å»ºå¯¹è±¡public native Object allocateInstance(Class&lt;?&gt; cls) throws InstantiationException; å¸¸è§„å¯¹è±¡å®ä¾‹åŒ–æ–¹å¼ï¼šæˆ‘ä»¬é€šå¸¸æ‰€ç”¨åˆ°çš„åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œä»æœ¬è´¨ä¸Šæ¥è®²ï¼Œéƒ½æ˜¯é€šè¿‡newæœºåˆ¶æ¥å®ç°å¯¹è±¡çš„åˆ›å»ºã€‚ä½†æ˜¯ï¼Œnewæœºåˆ¶æœ‰ä¸ªç‰¹ç‚¹å°±æ˜¯å½“ç±»åªæä¾›æœ‰å‚çš„æ„é€ å‡½æ•°ä¸”æ— æ˜¾ç¤ºå£°æ˜æ— å‚æ„é€ å‡½æ•°æ—¶ï¼Œåˆ™å¿…é¡»ä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°è¿›è¡Œå¯¹è±¡æ„é€ ï¼Œè€Œä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°æ—¶ï¼Œå¿…é¡»ä¼ é€’ç›¸åº”ä¸ªæ•°çš„å‚æ•°æ‰èƒ½å®Œæˆå¯¹è±¡å®ä¾‹åŒ–ã€‚ éå¸¸è§„çš„å®ä¾‹åŒ–æ–¹å¼ï¼šè€ŒUnsafeä¸­æä¾›allocateInstanceæ–¹æ³•ï¼Œä»…é€šè¿‡Classå¯¹è±¡å°±å¯ä»¥åˆ›å»ºæ­¤ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè€Œä¸”ä¸éœ€è¦è°ƒç”¨å…¶æ„é€ å‡½æ•°ã€åˆå§‹åŒ–ä»£ç ã€JVMå®‰å…¨æ£€æŸ¥ç­‰ã€‚å®ƒæŠ‘åˆ¶ä¿®é¥°ç¬¦æ£€æµ‹ï¼Œä¹Ÿå°±æ˜¯å³ä½¿æ„é€ å™¨æ˜¯privateä¿®é¥°çš„ä¹Ÿèƒ½é€šè¿‡æ­¤æ–¹æ³•å®ä¾‹åŒ–ï¼Œåªéœ€æç±»å¯¹è±¡å³å¯åˆ›å»ºç›¸åº”çš„å¯¹è±¡ã€‚ç”±äºè¿™ç§ç‰¹æ€§ï¼ŒallocateInstanceåœ¨java.lang.invokeã€Objenesisï¼ˆæä¾›ç»•è¿‡ç±»æ„é€ å™¨çš„å¯¹è±¡ç”Ÿæˆæ–¹å¼ï¼‰ã€Gsonï¼ˆååºåˆ—åŒ–æ—¶ç”¨åˆ°ï¼‰ä¸­éƒ½æœ‰ç›¸åº”çš„åº”ç”¨ã€‚ æ•°ç»„ç›¸å…³è¿™éƒ¨åˆ†ä¸»è¦ä»‹ç»ä¸æ•°æ®æ“ä½œç›¸å…³çš„arrayBaseOffsetä¸arrayIndexScaleè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸¤è€…é…åˆèµ·æ¥ä½¿ç”¨ï¼Œå³å¯å®šä½æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ åœ¨å†…å­˜ä¸­çš„ä½ç½®ã€‚ 1234//è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„åç§»åœ°å€public native int arrayBaseOffset(Class&lt;?&gt; arrayClass);//è¿”å›æ•°ç»„ä¸­ä¸€ä¸ªå…ƒç´ å ç”¨çš„å¤§å°public native int arrayIndexScale(Class&lt;?&gt; arrayClass); è¿™ä¸¤ä¸ªä¸æ•°æ®æ“ä½œç›¸å…³çš„æ–¹æ³•ï¼Œåœ¨java.util.concurrent.atomic åŒ…ä¸‹çš„AtomicIntegerArrayï¼ˆå¯ä»¥å®ç°å¯¹Integeræ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„åŸå­æ€§æ“ä½œï¼‰ä¸­æœ‰å…¸å‹çš„åº”ç”¨ï¼Œå¦‚ä¸‹å›¾AtomicIntegerArrayæºç æ‰€ç¤ºï¼Œé€šè¿‡Unsafeçš„arrayBaseOffsetã€arrayIndexScaleåˆ†åˆ«è·å–æ•°ç»„é¦–å…ƒç´ çš„åç§»åœ°å€baseåŠå•ä¸ªå…ƒç´ å¤§å°å› å­scaleã€‚ å†…å­˜å±éšœåœ¨Java 8ä¸­å¼•å…¥ï¼Œç”¨äºå®šä¹‰å†…å­˜å±éšœï¼ˆä¹Ÿç§°å†…å­˜æ …æ ï¼Œå†…å­˜æ …éšœï¼Œå±éšœæŒ‡ä»¤ç­‰ï¼Œæ˜¯ä¸€ç±»åŒæ­¥å±éšœæŒ‡ä»¤ï¼Œæ˜¯CPUæˆ–ç¼–è¯‘å™¨åœ¨å¯¹å†…å­˜éšæœºè®¿é—®çš„æ“ä½œä¸­çš„ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œä½¿å¾—æ­¤ç‚¹ä¹‹å‰çš„æ‰€æœ‰è¯»å†™æ“ä½œéƒ½æ‰§è¡Œåæ‰å¯ä»¥å¼€å§‹æ‰§è¡Œæ­¤ç‚¹ä¹‹åçš„æ“ä½œï¼‰ï¼Œé¿å…ä»£ç é‡æ’åºã€‚ åœ¨Java 8ä¸­å¼•å…¥äº†ä¸€ç§é”çš„æ–°æœºåˆ¶â€”â€”StampedLockï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯è¯»å†™é”çš„ä¸€ä¸ªæ”¹è¿›ç‰ˆæœ¬ã€‚StampedLockæä¾›äº†ä¸€ç§ä¹è§‚è¯»é”çš„å®ç°ï¼Œè¿™ç§ä¹è§‚è¯»é”ç±»ä¼¼äºæ— é”çš„æ“ä½œï¼Œå®Œå…¨ä¸ä¼šé˜»å¡å†™çº¿ç¨‹è·å–å†™é”ï¼Œä»è€Œç¼“è§£è¯»å¤šå†™å°‘æ—¶å†™çº¿ç¨‹â€œé¥¥é¥¿â€ç°è±¡ã€‚ç”±äºStampedLockæä¾›çš„ä¹è§‚è¯»é”ä¸é˜»å¡å†™çº¿ç¨‹è·å–è¯»é”ï¼Œå½“çº¿ç¨‹å…±äº«å˜é‡ä»ä¸»å†…å­˜loadåˆ°çº¿ç¨‹å·¥ä½œå†…å­˜æ—¶ï¼Œä¼šå­˜åœ¨æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œæ‰€ä»¥å½“ä½¿ç”¨StampedLockçš„ä¹è§‚è¯»é”æ—¶ï¼Œéœ€è¦éµä»å¦‚ä¸‹å›¾ç”¨ä¾‹ä¸­ä½¿ç”¨çš„æ¨¡å¼æ¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚ ç³»ç»Ÿç›¸å…³è¿™éƒ¨åˆ†åŒ…å«ä¸¤ä¸ªè·å–ç³»ç»Ÿç›¸å…³ä¿¡æ¯çš„æ–¹æ³•ã€‚ 1234//è¿”å›ç³»ç»ŸæŒ‡é’ˆçš„å¤§å°ã€‚è¿”å›å€¼ä¸º4ï¼ˆ32ä½ç³»ç»Ÿï¼‰æˆ– 8ï¼ˆ64ä½ç³»ç»Ÿï¼‰ã€‚public native int addressSize(); //å†…å­˜é¡µçš„å¤§å°ï¼Œæ­¤å€¼ä¸º2çš„å¹‚æ¬¡æ–¹ã€‚public native int pageSize(); å„ç§é”å¤ä¹  å„ç§é”çš„å¯¹æ¯” åå‘é”ã€è½»é‡çº§é”ã€è‡ªæ—‹é”ã€é‡é‡çº§é” å¹¶å‘ç¼–ç¨‹ä¹‹é”ä¼˜åŒ–]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Synchronized</tag>
        <tag>Volatile</tag>
        <tag>é”</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç®—æ³•é¢˜æ€»ç»“]]></title>
    <url>%2F2020%2F01%2F26%2F%E9%83%A8%E5%88%86%E5%81%9A%E9%A2%98%E6%80%BB%E7%BB%93.html</url>
    <content type="text"><![CDATA[åœ¨çº¿ oj è¾“å…¥ 12345678910import java.util.Scanner; public class Main&#123; public static void main(String[] args)&#123; Scanner in = new Scanner(System.in); String s =in.nextLine(); String[] str = s.spilt(" "); for(String data : str) System.out.println(data); &#125;&#125; æ›´å…·ä½“ä¸€ç‚¹çš„ï¼šhttps://blog.csdn.net/da_kao_la/article/details/80225003?utm_source=blogxgwz2 æ•°ç»„éƒ½æ˜¯arr.lengthï¼Œå­—ç¬¦ä¸²æ˜¯str.length()ï¼Œåˆ—è¡¨æ˜¯list.size() å­—ç¬¦ä¸² â€”â€”&gt; æ•°ç»„ï¼Œå¯ä»¥æœ‰ str.toCharArray()ï¼Œç„¶åæ•°ç»„ â€”â€“&gt; å­—ç¬¦ä¸² æ˜¯ new String(arr)ï¼Œæ³¨æ„å¦‚æœæƒ³è¦ç›´æ¥æ‰“å°æ•°ç»„å†…å®¹åˆ™æ˜¯ Arrays.toString(arr)ï¼Œæ‰“å°å¤šç»´æ•°ç»„æ˜¯ Arrays.deeptoString() String ä¸èƒ½ç›´æ¥å˜åŒ–ï¼Œä½†æ˜¯å¯ä»¥ç”¨StringBuilder 123StringBuilder sb = new StringBuilder(str);sb.replace(1,2,"aa");return sb.toString(); ä¸ç®¡æ˜¯æ•°ç»„è½¬æ¢æˆé›†åˆï¼Œè¿˜æ˜¯é›†åˆè½¬æ¢æˆæ•°ç»„ï¼Œéƒ½è¦æ³¨æ„è½¬æ¢ç±»å‹çš„ä¸€è‡´æ€§ï¼ŒString[]æ•°ç»„è½¬Stringç±»å‹çš„é›†åˆï¼Œå½“éœ€è¦ä½¿ç”¨intï¼Œdoubleç­‰é›†åˆçš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨å¯¹åº”çš„å¯¹è±¡ å¦‚ï¼šæ•°ç»„int[]ç”¨Integer[]ï¼Œdouble[]ç”¨Double[] ,å› ä¸ºListé›†åˆæ˜¯å¯¹è±¡çš„é›†åˆï¼Œè€Œintã€doubleç­‰ä¸æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦ç”¨å­—æ®µçš„å¯¹åº”å¯¹è±¡ç±» æ•°ç»„ç›´æ¥è½¬æˆåˆ—è¡¨ 1234// æ³¨æ„è¿™é‡Œå¿…é¡»æ˜¯ Integerå¯¹è±¡çš„æ•°ç»„ï¼Œå¦åˆ™è½¬ä¸äº†Integer[] nums = &#123;1,2,3&#125;;ArrayList arr= new ArrayList&lt;&gt;(nums.length);Collections.addAll(arr,nums); 12// å¥½åƒä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯è·Ÿä¸Šé¢ä¸€æ ·ï¼Œå¾—æ˜¯ Stringã€Integerç±»å‹çš„æ•°ç»„Arrays.asList(arr); å¦‚æœæ˜¯intï¼Œéœ€è¦è£…ç®±å†è½¬æ‰å¯ä»¥ 123int[] a = &#123;1,2,3,4&#125;;List arr = Arrays.stream(a).boxed().collect(Collectors.toList());System.out.println(arr); åˆ—è¡¨è½¬æ•°ç»„ é‡‡ç”¨é›†åˆçš„toArray()æ–¹æ³•ç›´æ¥æŠŠListé›†åˆè½¬æ¢æˆæ•°ç»„ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œä¸èƒ½è¿™æ ·å†™ï¼š 1String[] array = (String[]) mlist.toArray(); è¿™æ ·å†™çš„è¯ï¼Œç¼–è¯‘è¿è¡Œæ—¶ä¼šæŠ¥ç±»å‹æ— æ³•è½¬æ¢java.lang.ClassCastExceptionçš„é”™è¯¯ï¼Œè¿™æ˜¯ä¸ºä½•å‘¢ï¼Œè¿™æ ·å†™çœ‹èµ·æ¥æ²¡æœ‰é—®é¢˜å•Š å› ä¸ºjavaä¸­çš„å¼ºåˆ¶ç±»å‹è½¬æ¢æ˜¯é’ˆå¯¹å•ä¸ªå¯¹è±¡æ‰æœ‰æ•ˆæœçš„ï¼Œè€ŒListæ˜¯å¤šå¯¹è±¡çš„é›†åˆï¼Œæ‰€ä»¥å°†æ•´ä¸ªListå¼ºåˆ¶è½¬æ¢æ˜¯ä¸è¡Œçš„ ã€‚æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š 1String[] array = mlist.toArray(new String[0]); 12345List&lt;int[]&gt; res = new ArrayList();res.add(new int[]&#123;1,2&#125;);res.add(new int[]&#123;3,4&#125;);System.out.println(res);int[][] a = res.toArray(new int[0][]); 123456List&lt;Integer&gt; res = new ArrayList();res.add(1);res.add(2);System.out.println(res);Integer[] a = res.toArray(new Integer[0]);System.out.println(Arrays.toString(a)); å“ˆå¸Œè¡¨ä¸­ç»Ÿè®¡æ•°å‡ºç°çš„æ¬¡æ•° 123456789class Solution &#123; public void majorityElement(int[] nums) &#123; Map&lt;Integer, Integer&gt; numCount = new HashMap&lt;&gt;(); for (int num : nums) &#123; int count = numCount.getOrDefault(num, 0) + 1; numCount.put(num, count); &#125; &#125;&#125; å¯¹å“ˆå¸Œmapä¸­çš„ value å€¼å‡åºæ’åˆ— 123456789List&lt;Map.Entry&lt;Integer, Integer&gt;&gt; list = new ArrayList&lt;Map.Entry&lt;Integer, Integer&gt;&gt;(hashMap.entrySet());Collections.sort(list, (o1, o2) -&gt; &#123; int compare = (o1.getValue()).compareTo(o2.getValue()); return compare;&#125;);Map&lt;Integer, Integer&gt; returnMap = new LinkedHashMap&lt;Integer, Integer&gt;();for (Map.Entry&lt;Integer, Integer&gt; entry : list) &#123; returnMap.put(entry.getKey(), entry.getValue());&#125; æ•°å­—è½¬å­—ç¬¦ï¼Œå­—ç¬¦è½¬æ•°å­— 12345678910// æ•°å­—è½¬å­—ç¬¦ æ–¹å¼ä¸€String str = "1230";int d = Integer.parseInt(str); //é™æ€å‡½æ•°ç›´æ¥é€šè¿‡ç±»åè°ƒç”¨// æ•°å­—è½¬å­—ç¬¦ æ–¹å¼äºŒint d3 = Integer.valueOf("1230");System.out.println("digit3: " + d3);// å­—ç¬¦è½¬æ•°å­—String s = String.valueOf(d);]]></content>
  </entry>
  <entry>
    <title><![CDATA[çº¢é»‘æ ‘]]></title>
    <url>%2F2020%2F01%2F16%2F%E7%BA%A2%E9%BB%91%E6%A0%91.html</url>
    <content type="text"><![CDATA[çº¢é»‘æ ‘ç‰¹ç‚¹ æ¯ä¸ªèŠ‚ç‚¹æˆ–è€…æ˜¯çº¢è‰²çš„ï¼Œæˆ–è€…æ˜¯é»‘è‰²çš„ï¼› æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ï¼› æ¯ä¸ªå¶å­ç»“ç‚¹ï¼ˆæœ€åçš„ç©ºèŠ‚ç‚¹ï¼‰æ˜¯é»‘è‰²çš„ï¼› å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œé‚£ä¹ˆä»–çš„å­©å­éƒ½æ˜¯é»‘è‰²çš„ ï¼›[çº¢è‰²ä¸èƒ½è¿ç€] ä»ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹ç»è¿‡çš„é»‘è‰²èŠ‚ç‚¹æ˜¯ä¸€æ ·çš„ã€‚ å¢åŠ æ“ä½œ å›¾ä¸­ C ä¸ºå½“å‰éœ€è¦æ’å…¥çš„èŠ‚ç‚¹ï¼ŒP ä¸ºå½“å‰æ’å…¥èŠ‚ç‚¹çš„åŒäº²ç»“ç‚¹ï¼ŒU ä¸ºå½“å‰æ’å…¥èŠ‚ç‚¹çš„å”å”èŠ‚ç‚¹ï¼ŒG ä¸ºå½“å‰æ’å…¥èŠ‚ç‚¹çš„ç¥–çˆ¶èŠ‚ç‚¹ï¼å¢åŠ èŠ‚ç‚¹å°±æ˜¯è¿™å››ç§æƒ…å†µäº†ï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘ä¸‰ä»£èŠ‚ç‚¹ï¼Œè¿˜æ˜¯éå¸¸ç®€å•çš„â€¦ è¿™é‡Œæ¨èä¸€ä¸ªç½‘ç«™ï¼Œå¯ä»¥è¯•éªŒä¸€ä¸‹çº¢é»‘æ ‘çš„å¢åŠ åˆ é™¤ï¼Œæ„Ÿè§‰è´¼çˆ½å•Šï¼ï¼ï¼ (å…¶å®æ˜¯æˆ‘ä¸æƒ³ç”»å›¾æ‰¾ä¾‹å­äº†â€¦è‡ªå·±å»è¯•éªŒå§..è¿™å››ç§æƒ…å†µçš„æ–¹æ³•å±¡è¯•ä¸çˆ½) cs.usfca.edu/~galles/visualization/RedBlack.html è¯è¯´ï¼Œå’±ä¸­æ–‡çš„åšå®¢çœŸçš„å¥½å¤šäººéƒ½ä¸å¤ªæ‡‚è¿™ä¸ªçº¢é»‘æ ‘ï¼Œå„ç§é”™è¯¯çš„ä¾‹å­å°±å¾€ä¸Šè´´ï¼Œå…¶å®æœ¬æ¥æ˜¯å¾ˆç®€å•çš„çŸ¥è¯†ç‚¹ï¼ŒæŠŠæˆ‘ç¡¬æ˜¯æ•´è¿·ç³Šäº†â€¦çœŸæ˜¯è¯¯äººå­å¼Ÿå•Šâ€¦å¥½æ°”å•Šï¼ åˆ é™¤æ“ä½œåˆ é™¤æ˜¯çº¢é»‘æ ‘ä¸­æœ€éš¾çš„éƒ¨åˆ†ï¼ä½†æ˜¯å…¶å®è·Ÿæ‹§é­”æ–¹æ˜¯ä¸€æ ·å“’ï¼åªè¦æŒæ¡äº†æŠ€å·§ï¼Œç®¡ä½ æ˜¯ä»€ä¹ˆï¼Œå¥—å…¬å¼å°±å®Œäº‹å„¿äº†ï¼ [ç»´åŸºç™¾ç§‘å†™çš„å•¥ç©æ„å„¿ï¼Œæˆ‘çš„æ™ºå•†å—åˆ°äº†å‹åˆ¶â€¦] æƒ³è¦åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé¦–å…ˆå°±è¦è€ƒè™‘å®ƒæœ‰å‡ ä¸ªå­©å­ï¼š è‹¥æƒ³è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œæˆ‘è¿™é‡Œè®°ä¸º Nï¼Œè‹¥ N æœ‰ä¸¤ä¸ªå­©å­ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥æ‰¾ N çš„å·¦å­æ ‘æœ€å¤§å€¼ æˆ–è€…æ˜¯ N çš„å³å­æ ‘æœ€å°å€¼ï¼Œå°†å…¶å€¼å¤åˆ¶åˆ° N ,ç„¶å ä¸åˆ é™¤ N è¿™ä¸ªèŠ‚ç‚¹ï¼Œè½¬è€Œå»åˆ é™¤è¢«å¤åˆ¶çš„é‚£ä¸ªèŠ‚ç‚¹(N çš„å·¦å­æ ‘æœ€å¤§å€¼ æˆ–è€…æ˜¯ N çš„å³å­æ ‘æœ€å°å€¼æ‰€åœ¨çš„èŠ‚ç‚¹)ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·è½¬æ¢å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬çŸ¥é“ï¼ŒN çš„å·¦å­æ ‘æœ€å¤§å€¼ æˆ–è€…æ˜¯ N çš„å³å­æ ‘æœ€å°å€¼æœ€å¤šä¹Ÿå°±ä¸€ä¸ªå„¿å­(æˆ‘è¿™é‡Œè¯´çš„å„¿å­æ˜¯ä¸åŒ…æ‹¬å¶å­ç»“ç‚¹[å¶å­ç»“ç‚¹å…¨éƒ¨æ˜¯é»‘è‰²ç©ºèŠ‚ç‚¹å“¦ï¼Œè¿™æ˜¯çº¢é»‘æ ‘çš„æ€§è´¨3]çš„å“ˆ~) æ‰€ä»¥æˆ‘ä»¬ç°åœ¨åªéœ€è¦è€ƒè™‘åˆ é™¤ åªæœ‰ä¸€ä¸ªå„¿å­æˆ–è€…æ²¡æœ‰å„¿å­çš„èŠ‚ç‚¹ çœ‹ä¸Šå›¾ï¼Œå…¶å®ä¹Ÿå°±å‰©ä¸‹3ç§æƒ…å†µï¼Œåˆ†åˆ«æ˜¯ éœ€åˆ é™¤èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼Œæœ‰ä¸€ä¸ªé¢œè‰²ä¸ºçº¢è‰²çš„å­©å­ éœ€åˆ é™¤èŠ‚ç‚¹ä¸ºçº¢è‰²ï¼Œä¸”æ²¡æœ‰å„¿å­ éœ€åˆ é™¤èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼Œä¸”æ²¡æœ‰å„¿å­ å‰é¢ä¸¤ç§æƒ…å†µæ˜¯å¾ˆå¥½å¤„ç†çš„ï¼Œæœ€éš¾çš„å°±æ˜¯ç¬¬ä¸‰ç§æƒ…å†µï¼Œéœ€åˆ é™¤èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼Œä¸”æ²¡æœ‰å„¿å­ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±åªéœ€è¦è€ƒè™‘è¿™ç§æƒ…å†µï¼ï¼ï¼ è¿™ç§æƒ…å†µä¸‹ï¼Œåªéœ€è¦è€ƒè™‘å››ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯ çˆ¶äº²èŠ‚ç‚¹ Pã€å…„å¼ŸèŠ‚ç‚¹ Sã€S çš„å·¦å­©å­ S1ã€S çš„å³å­©å­ S2ï¼ŒæŒ‰ç†è¯´4ä¸ªèŠ‚ç‚¹ï¼Œé¢œè‰²æ’åˆ—ç»„åˆï¼Œå¯ä»¥æ’æˆ16ç§ï¼Œä½†æ˜¯æœ‰äº›æ˜¯ä¸ç¬¦åˆçº¢é»‘æ ‘æ€§è´¨çš„ç»„åˆï¼Œç°åœ¨æˆ‘ä»¬æ¥ä¸€ä¸€æ’åˆ—ä¸€ä¸‹ã€‚ ç²—ç•¥çœ‹ä¸€ä¸‹ï¼Œæ€»å…±æ˜¯æœ‰9ç§æƒ…å†µçš„ï¼åœ¨æ–‡æœ«ä¼šç»™å‡ºæˆ‘è‡ªå·±æ€»ç»“çš„è¿™9ç§åˆ†åˆ«å¯¹åº”çš„æ“ä½œæ–¹å¼ï¼Œå¤§å®¶å¯ä»¥ç›´æ¥çœ‹æ–‡æœ«ï¼ï¼ï¼ ä¸€é“ä¾‹é¢˜ è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯é»‘è‰²èŠ‚ç‚¹ï¼Œä¸”å„¿å­ä¸ºå¶å­ç»“ç‚¹ å¦‚é¢˜ï¼Œè¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯40ï¼Œå…¶çˆ¶äº²æ˜¯55ï¼Œé»‘è‰²èŠ‚ç‚¹ï¼Œè®°ä¸ºPï¼›å…¶å…„å¼Ÿæ˜¯65ï¼Œçº¢è‰²èŠ‚ç‚¹ï¼Œè®°ä¸ºSï¼Œå…¶ä¾„å­æ˜¯60ï¼Œ75ï¼Œé»‘è‰²èŠ‚ç‚¹ã€‚ å¦‚å›¾ï¼Œè¿™æ˜¯åˆ é™¤äº†40ä¹‹åçš„å›¾ï¼Œå…¶å„¿å­â€”-å¶å­ç»“ç‚¹å˜ä¸ºxï¼Œç°åœ¨ä¸æ»¡è¶³æ€§è´¨5ï¼Œéœ€è¦è¿›è¡Œå˜æ¢ã€‚ Case Iï¼šS ä¸º çº¢è‰²ï¼ŒP ä¸ºé»‘è‰² å°† S å’Œ P çš„é¢œè‰²äº’æ¢ï¼Œå³ S å˜ä¸ºé»‘è‰²ï¼ŒP å˜ä¸ºçº¢è‰² å¯¹çˆ¶äº²èŠ‚ç‚¹ P è¿›è¡Œ å·¦æ—‹ï¼Œæ³¨æ„å“¦ï¼Œå› ä¸ºæ˜¯å·¦æ—‹ï¼Œæ‰€ä»¥åœ†å¿ƒæ˜¯ å…„å¼ŸèŠ‚ç‚¹ S Case IIï¼šæ­¤æ—¶åˆæ˜¯ä¸€ä¸ªæ–°çš„å¯èƒ½å‡ºç°çš„åœºæ™¯ï¼Œåˆ é™¤èŠ‚ç‚¹åï¼ŒP ä¸ºçº¢è‰²èŠ‚ç‚¹ï¼Œè€Œå…„å¼ŸèŠ‚ç‚¹ S ä¸ºé»‘è‰²èŠ‚ç‚¹ï¼Œä½†æ˜¯å…„å¼Ÿçš„å·¦å­©å­ä¸º çº¢è‰²ï¼Œå³å­©å­(å¶å­ç»“ç‚¹ï¼Œå½“ç„¶å…¶ä¹Ÿåªèƒ½æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå¦åˆ™å°±è¿åæ€§è´¨5äº†)ä¸ºé»‘è‰²ã€‚ æ­¤æ—¶ï¼Œå°† S å˜ä¸º çº¢è‰²ï¼ŒS çš„å·¦å­©å­å˜ä¸º é»‘è‰² ç„¶åï¼Œè¿æ³•äº†æ€§è´¨ 4ï¼Œå°† S å³æ—‹ Case IIIï¼šæ­¤æ—¶ç¬¬ä¸‰ç§æƒ…å†µå‡ºç°äº†ï¼ŒP ä¸ºçº¢è‰²ï¼Œ S ä¸ºé»‘è‰²ï¼ŒS çš„å·¦å­©å­ä¸ºé»‘è‰²å¶å­ç»“ç‚¹ï¼ŒS çš„å³å­©å­ä¸ºçº¢è‰²èŠ‚ç‚¹ å°† S çš„å³å­©å­(çº¢è‰²)ã€P(çº¢è‰²)ã€S(é»‘è‰²)ï¼Œé¢œè‰²äº’æ¢ ç„¶åå°† x ç°åœ¨çš„çˆ¶äº²è¿›è¡Œå·¦æ—‹ ç»´åŸºç™¾ç§‘éƒ¨åˆ†æƒ…å½¢1: Næ˜¯æ–°çš„æ ¹ã€‚åœ¨è¿™ç§æƒ…å½¢ä¸‹ï¼Œæˆ‘ä»¬å°±åšå®Œäº†ã€‚æˆ‘ä»¬ä»æ‰€æœ‰è·¯å¾„å»é™¤äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œè€Œæ–°æ ¹æ˜¯é»‘è‰²çš„ï¼Œæ‰€ä»¥æ€§è´¨éƒ½ä¿æŒç€ã€‚ æ³¨æ„ï¼šåœ¨æƒ…å½¢2ã€5å’Œ6ä¸‹ï¼Œæˆ‘ä»¬å‡å®šNæ˜¯å®ƒçˆ¶äº²çš„å·¦å„¿å­ã€‚å¦‚æœå®ƒæ˜¯å³å„¿å­ï¼Œåˆ™åœ¨è¿™äº›æƒ…å½¢ä¸‹çš„å·¦å’Œå³åº”å½“å¯¹è°ƒã€‚ æƒ…å½¢2ï¼š Sæ˜¯çº¢è‰²ã€‚åœ¨è¿™ç§æƒ…å½¢ä¸‹æˆ‘ä»¬åœ¨Nçš„çˆ¶äº²ä¸Šåšå·¦æ—‹è½¬ï¼ŒæŠŠçº¢è‰²å…„å¼Ÿè½¬æ¢æˆNçš„ç¥–çˆ¶ï¼Œæˆ‘ä»¬æ¥ç€å¯¹è°ƒNçš„çˆ¶äº²å’Œç¥–çˆ¶çš„é¢œè‰²ã€‚å®Œæˆè¿™ä¸¤ä¸ªæ“ä½œåï¼Œå°½ç®¡æ‰€æœ‰è·¯å¾„ä¸Šé»‘è‰²èŠ‚ç‚¹çš„æ•°ç›®æ²¡æœ‰æ”¹å˜ï¼Œä½†ç°åœ¨Næœ‰äº†ä¸€ä¸ªé»‘è‰²çš„å…„å¼Ÿå’Œä¸€ä¸ªçº¢è‰²çš„çˆ¶äº²ï¼ˆå®ƒçš„æ–°å…„å¼Ÿæ˜¯é»‘è‰²å› ä¸ºå®ƒæ˜¯çº¢è‰²Sçš„ä¸€ä¸ªå„¿å­ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¥ä¸‹å»æŒ‰æƒ…å½¢4ã€æƒ…å½¢5æˆ–æƒ…å½¢6æ¥å¤„ç†ã€‚ï¼ˆæ³¨æ„ï¼šè¿™é‡Œçš„å›¾ä¸­æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼ŒNæ˜¯åˆ é™¤äº†é»‘è‰²èŠ‚ç‚¹åæ›¿æ¢ä¸Šæ¥çš„å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹ä¸­ç”±P-&gt;X-&gt;Nå˜æˆäº†P-&gt;Nï¼Œå®é™…ä¸Šæ˜¯å°‘äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºParent(Black)å’ŒSilbing(Red)é‚£ä¹ˆä»–ä»¬çš„å­©å­é»‘è‰²èŠ‚ç‚¹çš„æ•°ç›®è‚¯å®šä¸ç­‰ï¼Œè®©ä»–ä»¬åšæ–°å…„å¼Ÿè‚¯å®šæ˜¯ä¸å¹³è¡¡çš„ï¼Œè¿˜éœ€åé¢ç»§ç»­å¤„ç†ã€‚è¿™é‡Œçœ‹è‹±æ–‡ç‰ˆæœ¬çš„[1]æ¯”è¾ƒçš„æ˜äº†ï¼‰ æƒ…å½¢3ï¼š Nçš„çˆ¶äº²ã€Så’ŒSçš„å„¿å­éƒ½æ˜¯é»‘è‰²çš„ã€‚åœ¨è¿™ç§æƒ…å½¢ä¸‹ï¼Œæˆ‘ä»¬ç®€å•çš„é‡ç»˜Sä¸ºçº¢è‰²ã€‚ç»“æœæ˜¯é€šè¿‡Sçš„æ‰€æœ‰è·¯å¾„ï¼Œå®ƒä»¬å°±æ˜¯ä»¥å‰ä¸é€šè¿‡Nçš„é‚£äº›è·¯å¾„ï¼Œéƒ½å°‘äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ã€‚å› ä¸ºåˆ é™¤Nçš„åˆå§‹çš„çˆ¶äº²ä½¿é€šè¿‡Nçš„æ‰€æœ‰è·¯å¾„å°‘äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œè¿™ä½¿äº‹æƒ…éƒ½å¹³è¡¡äº†èµ·æ¥ã€‚ä½†æ˜¯ï¼Œé€šè¿‡Pçš„æ‰€æœ‰è·¯å¾„ç°åœ¨æ¯”ä¸é€šè¿‡Pçš„è·¯å¾„å°‘äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä»ç„¶è¿åæ€§è´¨5ã€‚è¦ä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¦ä»æƒ…å½¢1å¼€å§‹ï¼Œåœ¨Pä¸Šåšé‡æ–°å¹³è¡¡å¤„ç†ã€‚ æƒ…å½¢4ï¼š Så’ŒSçš„å„¿å­éƒ½æ˜¯é»‘è‰²ï¼Œä½†æ˜¯Nçš„çˆ¶äº²æ˜¯çº¢è‰²ã€‚åœ¨è¿™ç§æƒ…å½¢ä¸‹ï¼Œæˆ‘ä»¬ç®€å•çš„äº¤æ¢Nçš„å…„å¼Ÿå’Œçˆ¶äº²çš„é¢œè‰²ã€‚è¿™ä¸å½±å“ä¸é€šè¿‡Nçš„è·¯å¾„çš„é»‘è‰²èŠ‚ç‚¹çš„æ•°ç›®ï¼Œä½†æ˜¯å®ƒåœ¨é€šè¿‡Nçš„è·¯å¾„ä¸Šå¯¹é»‘è‰²èŠ‚ç‚¹æ•°ç›®å¢åŠ äº†ä¸€ï¼Œæ·»è¡¥äº†åœ¨è¿™äº›è·¯å¾„ä¸Šåˆ é™¤çš„é»‘è‰²èŠ‚ç‚¹ã€‚ æƒ…å½¢5ï¼š Sæ˜¯é»‘è‰²ï¼ŒSçš„å·¦å„¿å­æ˜¯çº¢è‰²ï¼ŒSçš„å³å„¿å­æ˜¯é»‘è‰²ï¼Œè€ŒNæ˜¯å®ƒçˆ¶äº²çš„å·¦å„¿å­ã€‚åœ¨è¿™ç§æƒ…å½¢ä¸‹æˆ‘ä»¬åœ¨Sä¸Šåšå³æ—‹è½¬ï¼Œè¿™æ ·Sçš„å·¦å„¿å­æˆä¸ºSçš„çˆ¶äº²å’ŒNçš„æ–°å…„å¼Ÿã€‚æˆ‘ä»¬æ¥ç€äº¤æ¢Så’Œå®ƒçš„æ–°çˆ¶äº²çš„é¢œè‰²ã€‚æ‰€æœ‰è·¯å¾„ä»æœ‰åŒæ ·æ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ï¼Œä½†æ˜¯ç°åœ¨Næœ‰äº†ä¸€ä¸ªé»‘è‰²å…„å¼Ÿï¼Œä»–çš„å³å„¿å­æ˜¯çº¢è‰²çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿›å…¥äº†æƒ…å½¢6ã€‚Nå’Œå®ƒçš„çˆ¶äº²éƒ½ä¸å—è¿™ä¸ªå˜æ¢çš„å½±å“ã€‚ æƒ…å½¢6ï¼š Sæ˜¯é»‘è‰²ï¼ŒSçš„å³å„¿å­æ˜¯çº¢è‰²ï¼Œè€ŒNæ˜¯å®ƒçˆ¶äº²çš„å·¦å„¿å­ã€‚åœ¨è¿™ç§æƒ…å½¢ä¸‹æˆ‘ä»¬åœ¨Nçš„çˆ¶äº²ä¸Šåšå·¦æ—‹è½¬ï¼Œè¿™æ ·Sæˆä¸ºNçš„çˆ¶äº²ï¼ˆPï¼‰å’ŒSçš„å³å„¿å­çš„çˆ¶äº²ã€‚æˆ‘ä»¬æ¥ç€äº¤æ¢Nçš„çˆ¶äº²å’ŒSçš„é¢œè‰²ï¼Œå¹¶ä½¿Sçš„å³å„¿å­ä¸ºé»‘è‰²ã€‚å­æ ‘åœ¨å®ƒçš„æ ¹ä¸Šçš„ä»æ˜¯åŒæ ·çš„é¢œè‰²ï¼Œæ‰€ä»¥æ€§è´¨3æ²¡æœ‰è¢«è¿åã€‚ä½†æ˜¯ï¼ŒNç°åœ¨å¢åŠ äº†ä¸€ä¸ªé»‘è‰²ç¥–å…ˆï¼šè¦ä¹ˆNçš„çˆ¶äº²å˜æˆé»‘è‰²ï¼Œè¦ä¹ˆå®ƒæ˜¯é»‘è‰²è€ŒSè¢«å¢åŠ ä¸ºä¸€ä¸ªé»‘è‰²ç¥–çˆ¶ã€‚æ‰€ä»¥ï¼Œé€šè¿‡Nçš„è·¯å¾„éƒ½å¢åŠ äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ã€‚æ­¤æ—¶ï¼Œå¦‚æœä¸€ä¸ªè·¯å¾„ä¸é€šè¿‡Nï¼Œåˆ™æœ‰ä¸¤ç§å¯èƒ½æ€§ï¼šå®ƒé€šè¿‡Nçš„æ–°å…„å¼Ÿã€‚é‚£ä¹ˆå®ƒä»¥å‰å’Œç°åœ¨éƒ½å¿…å®šé€šè¿‡Så’ŒNçš„çˆ¶äº²ï¼Œè€Œå®ƒä»¬åªæ˜¯äº¤æ¢äº†é¢œè‰²ã€‚æ‰€ä»¥è·¯å¾„ä¿æŒäº†åŒæ ·æ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚å®ƒé€šè¿‡Nçš„æ–°å”çˆ¶ï¼ŒSçš„å³å„¿å­ã€‚é‚£ä¹ˆå®ƒä»¥å‰é€šè¿‡Sã€Sçš„çˆ¶äº²å’ŒSçš„å³å„¿å­ï¼Œä½†æ˜¯ç°åœ¨åªé€šè¿‡Sï¼Œå®ƒè¢«å‡å®šä¸ºå®ƒä»¥å‰çš„çˆ¶äº²çš„é¢œè‰²ï¼Œå’ŒSçš„å³å„¿å­ï¼Œå®ƒè¢«ä»çº¢è‰²æ”¹å˜ä¸ºé»‘è‰²ã€‚åˆæˆæ•ˆæœæ˜¯è¿™ä¸ªè·¯å¾„é€šè¿‡äº†åŒæ ·æ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œåœ¨è¿™äº›è·¯å¾„ä¸Šçš„é»‘è‰²èŠ‚ç‚¹æ•°ç›®éƒ½æ²¡æœ‰æ”¹å˜ã€‚æ‰€ä»¥æˆ‘ä»¬æ¢å¤äº†æ€§è´¨4ã€‚åœ¨ç¤ºæ„å›¾ä¸­çš„ç™½è‰²èŠ‚ç‚¹å¯ä»¥æ˜¯çº¢è‰²æˆ–é»‘è‰²ï¼Œä½†æ˜¯åœ¨å˜æ¢å‰åéƒ½å¿…é¡»æŒ‡å®šç›¸åŒçš„é¢œè‰²ã€‚ è‡ªå·±æ€»ç»“çš„æ“ä½œæ–¹å¼ æ€»ç»“è‡³æ­¤ï¼Œçº¢é»‘æ ‘å‘Šä¸€æ®µè½äº†â€¦å­¦äº†ä¸¤å¤©æ‰çœŸæ­£ææ˜ç™½æ¯ä¸€æ­¥å¹²å˜›çš„â€¦çœŸæ˜¯å¤ªéº»çƒ¦äº† å»ºè®®å­¦çº¢é»‘æ ‘ï¼Œå…ˆç†Ÿæ‚‰å®ƒçš„5ä¸ªæ€§è´¨ï¼Œç„¶åå°†å¢åŠ å’Œåˆ é™¤çš„æ“ä½œèƒŒä¸€ä¸‹å°±è¡Œâ€¦è‡ªå·±å¯ä»¥å¤šä¸Šæˆ‘æ¨èçš„é‚£ä¸ªç½‘ç«™ï¼Œç”¨æˆ‘æ€»ç»“çš„æ“ä½œæ–¹å¼å¤šæ“ä½œå‡ éï¼Œå°±åº”è¯¥æ²¡å•¥å¤§é—®é¢˜äº†ï¼è‡³äºæ‰‹å†™çº¢é»‘æ ‘ä»£ç â€¦æˆ‘é€‰æ‹©æ”¾å¼ƒäº†ï¼]]></content>
  </entry>
  <entry>
    <title><![CDATA[Map]]></title>
    <url>%2F2020%2F01%2F15%2FMap%20%26%20Set%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html</url>
    <content type="text"><![CDATA[HashMapå‚è€ƒ é›†åˆç•ª@HashMapä¸€æ–‡é€šï¼ˆ1.7ç‰ˆï¼‰ é›†åˆç•ª@HashMapä¸€æ–‡é€šï¼ˆ1.8ç‰ˆï¼‰ HashMapæºç åˆ†æâ€”æ˜é‡‘åšä¸» ç¾å›¢æŠ€æœ¯è®²è§£HashMap ç›¸å…³é¢è¯•é—®é¢˜ é—®é¢˜å¼•å¯¼ç”±äºçŸ¥è¯†ç‚¹å¤ªå¤šï¼Œæˆ‘å°±ä»¥è‡ªå·±æœé›†åˆ°çš„é¢è¯•å¸¸é—®çš„æœ‰å…³äºHashMapçš„é—®é¢˜è¿›è¡Œè§£å†³ï¼Œç„¶åå†è¿›ä¸€æ­¥æ·±æŒ–ï¼ HashMapçš„åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ HashMapçš„ä¸»è¦æ–¹æ³•ï¼Ÿ HashMap æ˜¯å¦‚ä½•ç¡®å®šå…ƒç´ å­˜å‚¨ä½ç½®çš„ä»¥åŠå¦‚ä½•å¤„ç†å“ˆå¸Œå†²çªçš„ï¼Ÿ HashMap æ‰©å®¹æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ JDK 1.8 åœ¨æ‰©å®¹å’Œè§£å†³å“ˆå¸Œå†²çªä¸Šå¯¹ HashMap æºç åšäº†å“ªäº›æ”¹åŠ¨ï¼Ÿæœ‰ä»€ä¹ˆå¥½å¤„? ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨HashMapï¼Ÿä»–æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ ä½ çŸ¥é“HashMapçš„å·¥ä½œåŸç†å—ï¼Ÿ ä½ çŸ¥é“getå’Œputçš„åŸç†å—ï¼Ÿequals()å’ŒhashCode()éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ ä½ çŸ¥é“hashçš„å®ç°å—ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™æ ·å®ç°ï¼Ÿ å¦‚æœHashMapçš„å¤§å°è¶…è¿‡äº†è´Ÿè½½å› å­ï¼ˆload factorï¼‰å®šä¹‰çš„å®¹é‡ï¼Œæ€ä¹ˆåŠï¼Ÿ ä½ äº†è§£é‡æ–°è°ƒæ•´HashMapå¤§å°å­˜åœ¨ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ ä¸ºä»€ä¹ˆä½¿ç”¨Stringï¼ŒIntergerè¿™æ ·çš„wrapperç±»é€‚åˆä½œä¸ºé”®ï¼Ÿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„å¯¹è±¡ä½œä¸ºé”®å—ï¼Ÿ å¦‚ä½•å¯¹HashMapè¿›è¡Œæ’åºï¼Ÿ HashMapçš„åˆ é™¤é™·é˜±ï¼Ÿ ä¸ºä»€ä¹ˆåªå…è®¸é€šè¿‡iteratorè¿›è¡Œåˆ é™¤æ“ä½œï¼Ÿ å¦‚æœæ˜¯éå†è¿‡ç¨‹ä¸­å¢åŠ æˆ–ä¿®æ”¹æ•°æ®å‘¢ï¼Ÿ hashmapä¸ºä»€ä¹ˆåˆå§‹é•¿åº¦ä¸º16ï¼Ÿ HashMapä¸­çš„æ‰°åŠ¨å‡½æ•°æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆä½œç”¨ï¼ŒTreeMapä¸­æœ‰å—ï¼Ÿ HashMapä¸ºä½•å¯ä»¥æ’å…¥ç©ºå€¼ï¼Ÿä¸ºä»€ä¹ˆå®ƒæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Ÿ è¿™20ä¸ªé—®é¢˜çš„å‚è€ƒæƒ³æ³•ä¼šåœ¨æ–‡ç« æœ«å°¾ç»™å‡ºï¼å…ˆä¸€èµ·æ¥å­¦ä¹ ä¸€å“ˆHashMapçš„æºç ï¼ æ¦‚è¿° HashMapçš„ç‰¹æ€§ HashMapçš„å­˜å‚¨ç»“æ„ HashMapçš„é‡è¦æ–¹æ³•â€”å¢åˆ æ”¹æŸ¥ HashMapçš„æ‰©å®¹æœºåˆ¶ HashMapçš„è¿­ä»£å™¨ HashMapçš„Fail-Fastæœºåˆ¶ HashMapä¸å¤§å®¶åº­ä¸­å…¶ä»–Mapçš„åŒºåˆ« æ¥ä¸‹æ¥ä»è¿™äº›æ–¹é¢æ‹¿ä¸‹HashMapï¼ï¼ï¼ HashMapçš„ç‰¹æ€§ å®ƒæ ¹æ®é”®çš„ hashCodeå€¼ å­˜å‚¨æ•°æ®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éå†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚[åªæ˜¯è¯´è·ŸhashCodeçš„å€¼æœ‰å…³ç³»å“¦ï¼å¹¶ä¸æ˜¯ç›´æ¥æŒ‰ç…§hashCode()è¿”å›å€¼å­˜å–çš„] HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnullã€‚ HashMap éçº¿ç¨‹å®‰å…¨ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æœéœ€è¦æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ Collections çš„ synchronizedMap æ–¹æ³•ä½¿ HashMap å…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨ConcurrentHashMapã€‚ é”®å”¯ä¸€ï¼Œå¦‚æœé”®ç›¸åŒï¼Œåˆ™å€¼ä¼šè¢«è¦†ç›–ã€‚åŒæ—¶è‹¥é”®ä¸ºè‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œåˆ™éœ€è¦ä¿è¯å·²ç»é‡å†™äº†equals() å’Œ hashCode()ã€‚ â€”â€”&gt; equals() å’Œ hashCode()è¯¦è§£ HashMapçš„å­˜å‚¨ç»“æ„JDK 1.7 ç‰ˆæœ¬çš„HashMapæ˜¯ä»¥ æ•°ç»„ + é“¾è¡¨ å­˜å‚¨çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„æŒ‰ é“¾åœ°å€æ³• å­˜å‚¨ å¸¸è§çš„å¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•å°±ä¸¤ç§ï¼š å¼€æ”¾åœ°å€æ³• å¼€æ”¾åœ°å€æ³•åˆå¯ä»¥åˆ†ä¸ºçº¿æ€§æ¢æµ‹æ³•ã€å¹³æ–¹æ¢æµ‹æ³•ã€å†æ•£åˆ—æ³• æ‹‰é“¾æ³• JDK 1.8 ç‰ˆæœ¬çš„HashMapæ˜¯ä»¥ æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ å®ç°çš„ï¼Œçº¢é»‘æ ‘ å¯èƒ½å¤§å®¶æ¥è§¦çš„ä¸æ˜¯å¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘èµ¶ç´§å­¦ä¹ äº†ä¸€æ³¢ ä¼ é€é—¨)ï¼Œå…·ä½“çš„å®ç°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æºç ä¸­çš„ç›¸å…³æ¦‚å¿µé‡è¦å‚æ•° å“ˆå¸Œæ¡¶ï¼ˆbucketsï¼‰ï¼šåœ¨ HashMap çš„æ³¨é‡Šé‡Œä½¿ç”¨å“ˆå¸Œæ¡¶æ¥å½¢è±¡çš„è¡¨ç¤ºæ•°ç»„ä¸­æ¯ä¸ªåœ°å€ä½ç½®ã€‚æ³¨æ„è¿™é‡Œå¹¶ä¸æ˜¯æ•°ç»„æœ¬èº«ï¼Œæ•°ç»„æ˜¯è£…å“ˆå¸Œæ¡¶çš„ï¼Œä»–å¯ä»¥è¢«ç§°ä¸ºå“ˆå¸Œè¡¨ã€‚ åˆå§‹å®¹é‡(initial capacity) : è¿™ä¸ªå¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯å“ˆå¸Œè¡¨ä¸­å“ˆå¸Œæ¡¶åˆå§‹çš„æ•°é‡ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰é€šè¿‡æ„é€ æ–¹æ³•ä¿®æ”¹è¿™ä¸ªå®¹é‡å€¼é»˜è®¤ä¸ºDEFAULT_INITIAL_CAPACITY = 1&lt;&lt;4 å³16ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ä¸ºäº†ä¿è¯ HashMap æ·»åŠ å’ŒæŸ¥æ‰¾çš„é«˜æ•ˆæ€§ï¼ŒHashMap çš„å®¹é‡æ€»æ˜¯ 2^n çš„å½¢å¼ï¼Œä¸‹æ–‡ä¼šè®²ä¸ºä»€ä¹ˆ HashMap çš„å®¹é‡æ€»æ˜¯ 2^næ¬¡æ–¹ã€‚ åŠ è½½å› å­(load factor)ï¼šåŠ è½½å› å­æ˜¯å“ˆå¸Œè¡¨ï¼ˆæ•£åˆ—è¡¨ï¼‰åœ¨å…¶å®¹é‡è‡ªåŠ¨å¢åŠ ä¹‹å‰è¢«å…è®¸è·å¾—çš„æœ€å¤§æ•°é‡çš„åº¦é‡ã€‚å½“å“ˆå¸Œè¡¨ä¸­çš„æ¡ç›®æ•°é‡è¶…è¿‡è´Ÿè½½å› å­å’Œå½“å‰å®¹é‡çš„ä¹˜ç§¯æ—¶ï¼Œæ•£åˆ—è¡¨å°±ä¼šè¢«é‡æ–°æ˜ å°„ï¼ˆå³é‡å»ºå†…éƒ¨æ•°æ®ç»“æ„ï¼‰ï¼Œé‡æ–°åˆ›å»ºçš„æ•£åˆ—è¡¨å®¹é‡å¤§çº¦æ˜¯ä¹‹å‰æ•£åˆ—è¡¨å“ˆç³»ç»Ÿæ¡¶æ•°é‡çš„ä¸¤å€ã€‚é»˜è®¤åŠ è½½å› å­ï¼ˆ0.75ï¼‰åœ¨æ—¶é—´å’Œç©ºé—´æˆæœ¬ä¹‹é—´æä¾›äº†è‰¯å¥½çš„æŠ˜è¡·ã€‚åŠ è½½å› å­è¿‡å¤§ä¼šå¯¼è‡´å¾ˆå®¹æ˜“é“¾è¡¨è¿‡é•¿ï¼ŒåŠ è½½å› å­å¾ˆå°åˆå®¹æ˜“å¯¼è‡´é¢‘ç¹çš„æ‰©å®¹ã€‚æ‰€ä»¥ä¸è¦è½»æ˜“è¯•ç€å»æ”¹å˜è¿™ä¸ªé»˜è®¤å€¼ã€‚ æ‰©å®¹é˜ˆå€¼ï¼ˆthresholdï¼‰ï¼šå…¶å®åœ¨è¯´åŠ è½½å› å­çš„æ—¶å€™å·²ç»æåˆ°äº†æ‰©å®¹é˜ˆå€¼äº†ï¼Œæ‰©å®¹é˜ˆå€¼ = å“ˆå¸Œè¡¨å®¹é‡ * åŠ è½½å› å­ã€‚å“ˆå¸Œè¡¨çš„é”®å€¼å¯¹æ€»æ•° = æ‰€æœ‰å“ˆå¸Œæ¡¶ä¸­æ‰€æœ‰é“¾è¡¨èŠ‚ç‚¹æ•°çš„åŠ å’Œï¼Œæ‰©å®¹é˜ˆå€¼æ¯”è¾ƒçš„æ˜¯æ˜¯é”®å€¼å¯¹çš„ä¸ªæ•°è€Œä¸æ˜¯å“ˆå¸Œè¡¨çš„æ•°ç»„ä¸­æœ‰å¤šå°‘ä¸ªä½ç½®è¢«å äº†ã€‚ æ ‘åŒ–é˜€å€¼(TREEIFY_THRESHOLD) ï¼šè¿™ä¸ªå‚æ•°æ¦‚å¿µæ˜¯åœ¨ JDK1.8ååŠ å…¥çš„ï¼Œå®ƒçš„å«ä¹‰ä»£è¡¨ä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­çš„èŠ‚ç‚¹ä¸ªæ•°å¤§äºè¯¥å€¼ï¼ˆé»˜è®¤ä¸º8ï¼‰çš„æ—¶å€™å°†ä¼šè¢«è½¬ä¸ºçº¢é»‘æ ‘è¡Œå­˜å‚¨ç»“æ„ã€‚ éæ ‘åŒ–é˜€å€¼(UNTREEIFY_THRESHOLD)ï¼š ä¸æ ‘åŒ–é˜ˆå€¼ç›¸å¯¹åº”ï¼Œè¡¨ç¤ºå½“ä¸€ä¸ªå·²ç»è½¬åŒ–ä¸ºæ•°å½¢å­˜å‚¨ç»“æ„çš„å“ˆå¸Œæ¡¶ä¸­èŠ‚ç‚¹æ•°é‡å°äºè¯¥å€¼ï¼ˆé»˜è®¤ä¸º 6ï¼‰çš„æ—¶å€™å°†å†æ¬¡æ”¹ä¸ºå•é“¾è¡¨çš„æ ¼å¼å­˜å‚¨ã€‚å¯¼è‡´è¿™ç§æ“ä½œçš„åŸå› å¯èƒ½æœ‰åˆ é™¤èŠ‚ç‚¹æˆ–è€…æ‰©å®¹ã€‚ æœ€å°æ ‘åŒ–å®¹é‡(MIN_TREEIFY_CAPACITY): ç»è¿‡ä¸Šè¾¹çš„ä»‹ç»æˆ‘ä»¬åªçŸ¥é“ï¼Œå½“é“¾è¡¨çš„èŠ‚ç‚¹æ•°è¶…è¿‡8çš„æ—¶å€™å°±ä¼šè½¬åŒ–ä¸ºæ ‘åŒ–å­˜å‚¨ï¼Œå…¶å®å¯¹äºè½¬åŒ–è¿˜æœ‰ä¸€ä¸ªè¦æ±‚å°±æ˜¯å“ˆå¸Œè¡¨çš„æ•°é‡è¶…è¿‡æœ€å°æ ‘åŒ–å®¹é‡çš„è¦æ±‚ï¼ˆé»˜è®¤è¦æ±‚æ˜¯ 64ï¼‰,ä¸”ä¸ºäº†é¿å…è¿›è¡Œæ‰©å®¹ã€æ ‘å½¢åŒ–é€‰æ‹©çš„å†²çªï¼Œè¿™ä¸ªå€¼ä¸èƒ½å°äº 4 * TREEIFY_THRESHOLD);åœ¨è¾¾åˆ°è¯¥è¦æ±‚ä¹‹å‰ä¼˜å…ˆé€‰æ‹©æ‰©å®¹ã€‚æ‰©å®¹å› ä¸ºå› ä¸ºå®¹é‡çš„å˜åŒ–å¯èƒ½ä¼šä½¿å•é“¾è¡¨çš„é•¿åº¦æ”¹å˜ã€‚ ä¸è¿™ä¸ªå‡ ä¸ªæ¦‚å¿µå¯¹åº”çš„åœ¨ HashMap ä¸­å‡ ä¸ªå¸¸äº®é‡ï¼Œç”±äºä¸Šè¾¹çš„ä»‹ç»æ¯”è¾ƒè¯¦ç»†äº†ï¼Œä¸‹è¾¹ä»…åˆ—å‡ºå‡ ä¸ªå˜é‡çš„å£°æ˜ï¼š 1234567891011121314151617/*é»˜è®¤åˆå§‹å®¹é‡*/static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16/*æœ€å¤§å­˜å‚¨å®¹é‡*/static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;/*é»˜è®¤åŠ è½½å› å­*/static final float DEFAULT_LOAD_FACTOR = 0.75f;/*é»˜è®¤æ ‘åŒ–é˜ˆå€¼*/static final int TREEIFY_THRESHOLD = 8;/*é»˜è®¤éæ ‘åŒ–é˜ˆå€¼*/static final int UNTREEIFY_THRESHOLD = 6;/*é»˜è®¤æœ€å°æ ‘åŒ–å®¹é‡*/static final int MIN_TREEIFY_CAPACITY = 64; å¯¹åº”çš„è¿˜æœ‰å‡ ä¸ªå…¨å±€å˜é‡ï¼š 1234567891011121314// æ‰©å®¹é˜ˆå€¼ = å®¹é‡ x åŠ è½½å› å­int threshold;//å­˜å‚¨å“ˆå¸Œæ¡¶çš„æ•°ç»„ï¼Œå“ˆå¸Œæ¡¶ä¸­è£…çš„æ˜¯ä¸€ä¸ªå•é“¾è¡¨æˆ–ä¸€é¢—çº¢é»‘æ ‘ï¼Œé•¿åº¦ä¸€å®šæ˜¯ 2^ntransient Node&lt;K,V&gt;[] table; // HashMapä¸­å­˜å‚¨çš„é”®å€¼å¯¹çš„æ•°é‡æ³¨æ„è¿™é‡Œæ˜¯é”®å€¼å¯¹çš„ä¸ªæ•°è€Œä¸æ˜¯æ•°ç»„çš„é•¿åº¦transient int size; //æ‰€æœ‰é”®å€¼å¯¹çš„Seté›†åˆ åŒºåˆ†äº table å¯ä»¥è°ƒç”¨ entrySet(ï¼‰å¾—åˆ°è¯¥é›†åˆtransient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet; //æ“ä½œæ•°è®°å½• ä¸ºäº†å¤šçº¿ç¨‹æ“ä½œæ—¶ Fast-fail æœºåˆ¶transient int modCount; ä½œè€…ï¼šåƒä¸€åªç‹—é“¾æ¥ï¼šhttps://juejin.im/post/5ac83fa35188255c5668afd0æ¥æºï¼šæ˜é‡‘ åŸºæœ¬å­˜å‚¨å•å…ƒNode12345678910111213141516171819202122232425262728293031323334353637383940414243444546/** * Basic hash bin node, used for most entries. (See below for * TreeNode subclass, and in LinkedHashMap for its Entry subclass.) * 1.8ä¸­å°†Entryæ”¹æˆNodeï¼ˆå†…éƒ¨ç»“æ„ä¸å˜ï¼‰ * è™½ç„¶åªæ˜¯æ”¹äº†åå­—ï¼Œä½†åå­—çš„å˜æ›´ä½“ç°å‡ºHashMapå¯¹äºèŠ‚ç‚¹æ¦‚å¿µçš„é‡è§† */ static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash;//å“ˆå¸Œå€¼,æ–°å¢finalå±æ€§ï¼Œè¡¨æ˜hashå€¼ä¹Ÿä¸å¯å˜äº†ï¼Œæ›´åŠ ä¸¥è°¨ final K key;//key V value;//value Node&lt;K,V&gt; next;//é“¾è¡¨åç½®èŠ‚ç‚¹ Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125; public final K getKey() &#123; return key; &#125; public final V getValue() &#123; return value; &#125; public final String toString() &#123; return key + "=" + value; &#125; //æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„hashå€¼ï¼Œæ˜¯å°† key çš„ hashCode å’Œ value çš„ hashCode å¼‚æˆ–å¾—åˆ°çš„ã€‚ public final int hashCode() &#123; return Objects.hashCode(key) ^ Objects.hashCode(value); &#125; //è®¾ç½®æ–°çš„value åŒæ—¶è¿”å›æ—§value public final V setValue(V newValue) &#123; V oldValue = value; value = newValue; return oldValue; &#125; public final boolean equals(Object o) &#123; if (o == this) return true; if (o instanceof Map.Entry) &#123; Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o; if (Objects.equals(key, e.getKey()) &amp;&amp; Objects.equals(value, e.getValue())) return true; &#125; return false; &#125; &#125; TreeNode12345678910111213141516171819202122232425262728293031/** * Entry for Tree bins. Extends LinkedHashMap.Entry (which in turn extends Node) * so can be used as extension of either regular or linked node. * çº¢é»‘æ ‘èŠ‚ç‚¹ ç›¸æ¯”äºTreeMapï¼Œ * 1.å¢åŠ preæ¥è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹ * 2.ç»§æ‰¿LinkedHashMap.Entry&lt;K,V&gt;ï¼Œè€ŒLinkedHashMap.Entry&lt;K,V&gt;åˆç»§æ‰¿HashMap.Nodeï¼š * 1.æ‹¥æœ‰äº†Nodeå’Œé“¾è¡¨Nodeçš„æ‰€æœ‰åŠŸèƒ½ * 2.å…·æœ‰é¢å¤–6ä¸ªå±æ€§Entry&lt;K,V&gt; before, after;final int hash;final K key;V value;Node&lt;K,V&gt; next; */static final class TreeNode&lt;K,V&gt; extends LinkedHashMap.Entry&lt;K,V&gt; &#123; TreeNode&lt;K,V&gt; parent; // çˆ¶èŠ‚ç‚¹ TreeNode&lt;K,V&gt; left;//å·¦å­èŠ‚ç‚¹ TreeNode&lt;K,V&gt; right;//å³å­èŠ‚ç‚¹ TreeNode&lt;K,V&gt; prev; // å‰ä¸€ä¸ªå…ƒç´ çš„èŠ‚ç‚¹ boolean red;//æ˜¯å¦æ˜¯çº¢èŠ‚ç‚¹ TreeNode(int hash, K key, V val, Node&lt;K,V&gt; next) &#123; super(hash, key, val, next); &#125; ...&#125;/** * LinkedHashMap.Entryçš„å®ç° * HashMap.Node subclass for normal LinkedHashMap entries. * å¯ä»¥å‘ç°ï¼Œæœ€ç»ˆTreeNodeè¿˜æ˜¯ç»§æ‰¿äº†HashMap.Nodeçš„æ‰€æœ‰åŠŸèƒ½ï¼Œåº•å±‚å®ç°è¿˜æ˜¯Node */static class Entry&lt;K,V&gt; extends HashMap.Node&lt;K,V&gt; &#123; Entry&lt;K,V&gt; before, after; Entry(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; super(hash, key, value, next); &#125;&#125; é‡è¦æ–¹æ³•ç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®ä¸ç®¡å¢åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾é”®å€¼å¯¹ï¼Œå®šä½åˆ°å“ˆå¸Œæ¡¶æ•°ç»„çš„ä½ç½®éƒ½æ˜¯å¾ˆå…³é”®çš„ç¬¬ä¸€æ­¥ã€‚å‰é¢è¯´è¿‡HashMapçš„æ•°æ®ç»“æ„æ˜¯æ•°ç»„å’Œé“¾è¡¨çš„ç»“åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å½“ç„¶å¸Œæœ›è¿™ä¸ªHashMapé‡Œé¢çš„å…ƒç´ ä½ç½®å°½é‡åˆ†å¸ƒå‡åŒ€äº›ï¼Œå°½é‡ä½¿å¾—æ¯ä¸ªä½ç½®ä¸Šçš„å…ƒç´ æ•°é‡åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ç”¨hashç®—æ³•æ±‚å¾—è¿™ä¸ªä½ç½®çš„æ—¶å€™ï¼Œé©¬ä¸Šå°±å¯ä»¥çŸ¥é“å¯¹åº”ä½ç½®çš„å…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œä¸ç”¨éå†é“¾è¡¨ï¼Œå¤§å¤§ä¼˜åŒ–äº†æŸ¥è¯¢çš„æ•ˆç‡ã€‚HashMapå®šä½æ•°ç»„ç´¢å¼•ä½ç½®ï¼Œç›´æ¥å†³å®šäº†hashæ–¹æ³•çš„ç¦»æ•£æ€§èƒ½ã€‚å…ˆçœ‹çœ‹æºç çš„å®ç°(æ–¹æ³•ä¸€+æ–¹æ³•äºŒ): 1234567891011//æ–¹æ³•ä¸€ï¼šç§°ä¸ºæ‰°åŠ¨å‡½æ•°static final int hash(Object key) &#123; //jdk1.8 &amp; jdk1.7 int h; // h = key.hashCode() ä¸ºç¬¬ä¸€æ­¥ å–hashCodeå€¼ // h ^ (h &gt;&gt;&gt; 16) ä¸ºç¬¬äºŒæ­¥ é«˜ä½å‚ä¸è¿ç®—ï¼Œé«˜16ä½å’Œä½16ä½è¿›è¡Œå¼‚æˆ– return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125;//æ–¹æ³•äºŒï¼šstatic int indexFor(int h, int length) &#123; //jdk1.7çš„æºç ï¼Œjdk1.8æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯å®ç°åŸç†ä¸€æ ·çš„ return h &amp; (length-1); //ç¬¬ä¸‰æ­¥ å–æ¨¡è¿ç®—&#125; è¿™é‡Œçš„Hashç®—æ³•æœ¬è´¨ä¸Šå°±æ˜¯ä¸‰æ­¥ï¼šå–keyçš„hashCodeå€¼ã€é«˜ä½è¿ç®—ã€å–æ¨¡è¿ç®—ã€‚ å¯¹äºä»»æ„ç»™å®šçš„å¯¹è±¡ï¼Œåªè¦å®ƒçš„hashCode()è¿”å›å€¼ç›¸åŒï¼Œé‚£ä¹ˆç¨‹åºè°ƒç”¨æ–¹æ³•ä¸€æ‰€è®¡ç®—å¾—åˆ°çš„Hashç å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æŠŠhashå€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…ƒç´ çš„åˆ†å¸ƒç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚ä½†æ˜¯ï¼Œæ¨¡è¿ç®—çš„æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œåœ¨HashMapä¸­æ˜¯è¿™æ ·åšçš„ï¼šè°ƒç”¨æ–¹æ³•äºŒæ¥è®¡ç®—è¯¥å¯¹è±¡åº”è¯¥ä¿å­˜åœ¨tableæ•°ç»„çš„å“ªä¸ªç´¢å¼•å¤„ã€‚ è¿™ä¸ªæ–¹æ³•éå¸¸å·§å¦™ï¼Œå®ƒé€šè¿‡h &amp; (table.length -1)æ¥å¾—åˆ°è¯¥å¯¹è±¡çš„ä¿å­˜ä½ï¼Œè€ŒHashMapåº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯2çš„næ¬¡æ–¹ï¼Œè¿™æ˜¯HashMapåœ¨é€Ÿåº¦ä¸Šçš„ä¼˜åŒ–ã€‚å½“lengthæ€»æ˜¯2çš„næ¬¡æ–¹æ—¶ï¼Œh&amp; (length-1)è¿ç®—ç­‰ä»·äºå¯¹lengthå–æ¨¡ï¼Œä¹Ÿå°±æ˜¯h%lengthï¼Œä½†æ˜¯&amp;æ¯”%å…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚ åœ¨JDK1.8çš„å®ç°ä¸­ï¼Œä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œé€šè¿‡hashCode()çš„é«˜16ä½å¼‚æˆ–ä½16ä½å®ç°çš„ï¼š(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)ï¼Œä¸»è¦æ˜¯ä»é€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ï¼Œè¿™ä¹ˆåšå¯ä»¥åœ¨æ•°ç»„tableçš„lengthæ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½Bitéƒ½å‚ä¸åˆ°Hashçš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚ ä¸‹é¢ä¸¾ä¾‹è¯´æ˜ä¸‹ï¼Œnä¸ºtableçš„é•¿åº¦ã€‚ Putæ–¹æ³•(æ–°å¢) â‘  åˆ¤æ–­é”®å€¼å¯¹æ•°ç»„table[i]æ˜¯å¦ä¸ºç©ºæˆ–ä¸ºnullï¼Œå¦åˆ™æ‰§è¡Œresize()è¿›è¡Œæ‰©å®¹ï¼› â‘¡ æ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼å¾—åˆ°æ’å…¥çš„æ•°ç»„ç´¢å¼•iï¼Œå¦‚æœtable[i]==nullï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ ï¼Œè½¬å‘â‘¥ï¼Œå¦‚æœtable[i]ä¸ä¸ºç©ºï¼Œè½¬å‘â‘¢ï¼› â‘¢ åˆ¤æ–­table[i]çš„é¦–ä¸ªå…ƒç´ æ˜¯å¦å’Œkeyä¸€æ ·ï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–valueï¼Œå¦åˆ™è½¬å‘â‘£ï¼Œè¿™é‡Œçš„ç›¸åŒæŒ‡çš„æ˜¯hashCodeä»¥åŠequalsï¼› â‘£ åˆ¤æ–­table[i] æ˜¯å¦ä¸ºtreeNodeï¼Œå³table[i] æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥åœ¨æ ‘ä¸­æ’å…¥é”®å€¼å¯¹ï¼Œå¦åˆ™è½¬å‘â‘¤ï¼› â‘¤ éå†table[i]ï¼Œåˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº8ï¼Œå¤§äº8çš„è¯ï¼Œè¿›å…¥åˆ° treeifyBin()ï¼Œä¼šå…ˆå»åˆ¤æ–­å½“å‰å“ˆå¸Œæ¡¶å¤§å°æ˜¯ä¸æ˜¯åˆ°äº† MIN_TREEIFY_CAPACITY ï¼ˆé»˜è®¤æ˜¯ 64ï¼‰ï¼Œå¦‚æœæ²¡æœ‰å°±ç›´æ¥æ‰©å®¹ï¼Œå¦‚æœåˆ°äº†64ï¼ˆâ‰¥64ï¼‰ï¼Œå°±æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æ‰§è¡Œæ’å…¥æ“ä½œï¼Œå¦åˆ™è¿›è¡Œé“¾è¡¨çš„æ’å…¥æ“ä½œï¼›éå†è¿‡ç¨‹ä¸­è‹¥å‘ç°keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–valueå³å¯ï¼› â‘¥ æ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡sizeæ˜¯å¦è¶…å¤šäº†æœ€å¤§å®¹é‡thresholdï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125;/** * Implements Map.put and related methods * æ–°å¢é”®å€¼å¯¹ * @param hash hash for key * @param key the key * @param value the value to put * @param onlyIfAbsent if true, don't change existing value * @param evict if false, the table is in creation mode. * @return previous value, or null if none *///æ³¨æ„ ä¸å¯ä»¥è¢«ç»§æ‰¿é‡è½½ å¦‚æœä½¿ç”¨hashMapçš„æ–¹å¼çš„è¯final V putVal(int hash, K key, V value, boolean onlyIfAbsent,boolean evict) &#123; Node&lt;K, V&gt;[] tab; Node&lt;K, V&gt; p; int n, i; //å½“æ•°ç»„ä¸ºç©ºæ—¶ if ((tab = table) == null || (n = tab.length) == 0) &#123; n = (tab = resize()).length;//å½“åˆå§‹åŒ–æˆ–è€…å½“å‰æ•°ç»„é•¿åº¦ä¸º0æ—¶ï¼Œéœ€è¦é‡æ–°resizeå¹¶è¿”å›æ–°çš„é•¿åº¦ &#125; //ç›¸å½“äºé€šè¿‡ h &amp; (length-1) è®¡ç®—ä¸‹æ ‡å¹¶è·å–å…ƒç´  if ((p = tab[i = (n - 1) &amp; hash]) == null)&#123; //è‹¥å½“å‰ä¸‹æ ‡ä½ç½®ç©ºç½®ï¼ˆå³è¯¥keyä¸å­˜åœ¨ï¼‰ï¼Œå°±æ–°å»ºä¸€ä¸ªæ™®é€š(non-tree)èŠ‚ç‚¹ tab[i] = newNode(hash, key, value, null); &#125;else &#123; //å½“è¯¥keyå­˜åœ¨æˆ–è€…å‘ç”Ÿhashå†²çªæ—¶ Node&lt;K,V&gt; e; K k; //è‹¥åœ¨æ•°ç»„ä¸­é€šè¿‡hashå’Œequalsæ¯”è¾ƒèƒ½å¤Ÿç›´æ¥æ‰¾åˆ°è¯¥å€¼ï¼Œå°±è¦†ç›–æ—§å€¼ //å³å½“å‰æ¡¶å³éé“¾è¡¨ä¹Ÿéçº¢é»‘æ ‘ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))&#123; e = p;//è¦†ç›– &#125; //å¦åˆ™éœ€è¦å…ˆåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ else if (p instanceof TreeNode)&#123;//è‹¥æ˜¯çº¢é»‘æ ‘ç±»å‹ï¼Œæ‰§è¡Œæ ‘èŠ‚ç‚¹putTreeValæ“ä½œ e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); &#125; else &#123; //æ­¤æ—¶å‘ç”Ÿäº†å†²çª for (int binCount = 0; ; ++binCount) &#123; //å¦‚æœæ­¤æ—¶çš„æ¡¶è¿˜ä¸æ˜¯é“¾è¡¨ï¼Œéœ€è¦è½¬å˜ä¸ºé“¾è¡¨ æˆ–è€… å¦‚æœåœ¨é“¾è¡¨ä¸­æ²¡æœ‰ï¼Œé‚£å°±æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹ if ((e = p.next) == null) &#123; //æ³¨æ„é“¾è¡¨æ’å…¥æ—¶1.7ä¸1.8æ˜¯ä¸åŒçš„ //1.7:æ˜¯å¤´æ’å…¥æ³•ï¼Œåæ¥çš„ç•™åœ¨æ•°ç»„ä¸Šï¼Œå…ˆæ¥çš„é“¾åœ¨å°¾ä¸Šï¼ˆéå†æ—¶æ˜¯å…ˆè¿›åå‡ºï¼‰ //1.8:æ˜¯å°¾æ’å…¥æ³•ï¼Œå…ˆæ¥çš„ç•™åœ¨æ•°ç»„ä¸Šï¼Œåæ¥çš„é“¾åœ¨å°¾ä¸Šï¼ˆéå†æ—¶æ˜¯å…ˆè¿›å…ˆå‡ºï¼‰ p.next = newNode(hash, key, value, null); //å¦‚æœæ¡¶çš„é“¾è¡¨é•¿åº¦&gt;=æ¡¶çš„æ ‘åŒ–é˜ˆå€¼ï¼Œéœ€è¦å°†é“¾è¡¨è½¬å˜ä¸ºçº¢é»‘æ ‘ //è¿™é‡Œéœ€è¦æ³¨æ„ï¼šæ˜¯å…ˆæ–°å¢å…ƒç´ ä¹‹åå†åˆ¤æ–­æ ‘åŒ–æ¡ä»¶ï¼Œè€Œä¸æ˜¯å…ˆæ ‘åŒ–å†æ–°å¢ if (binCount &gt;= TREEIFY_THRESHOLD - 1) treeifyBin(tab, hash); //å½“å‰æ¡¶æ ‘åŒ– break; &#125; //å¦‚æœåœ¨é“¾è¡¨ä¸­å·²ç»å­˜åœ¨è¯¥å€¼ï¼Œå°±è¦†ç›–æ—§å€¼ if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; //åŸåˆ™ï¼šç”¨æ–°å€¼è¦†ç›–æ—§å€¼ if (e != null) &#123; // existing mapping for key V oldValue = e.value; //onlyIfAbsent è‹¥æ˜¯trueï¼Œä¸å…è®¸è¦†ç›– if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e);//ç›¸å½“äº1.7çš„afterNodeAccessï¼ŒLinkedHashMapä¸“ç”¨ï¼Œç”¨äºæœ‰åºæ§åˆ¶ return oldValue; &#125; &#125; ++modCount; if (++size &gt; threshold)//è¶…è¿‡é˜ˆå€¼å°±æ‰©å®¹ resize(); afterNodeInsertion(evict);//LinkedHashMapä¸“ç”¨ï¼Œç”¨äºåˆ é™¤æœ€æ—§å…ƒç´  (remove eldest) return null;&#125;// Create a regular (non-tree) node åˆ›å»ºä¸€ä¸ªæ™®é€šçš„éæ ‘èŠ‚ç‚¹Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; return new Node&lt;&gt;(hash, key, value, next);&#125; resizeæ–¹æ³•(æ‰©å®¹)æ•´ä½“åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š1. å¯»æ‰¾æ‰©å®¹åæ•°ç»„çš„å¤§å°ä»¥åŠæ–°çš„æ‰©å®¹é˜ˆå€¼ï¼Œ2. å°†åŸæœ‰å“ˆå¸Œè¡¨æ‹·è´åˆ°æ–°çš„å“ˆå¸Œè¡¨ä¸­ã€‚ æˆ‘ä»¬åˆ†æä¸‹resizeçš„æºç ï¼Œé‰´äºJDK1.8èå…¥äº†çº¢é»‘æ ‘ï¼Œè¾ƒå¤æ‚ï¼Œä¸ºäº†ä¾¿äºç†è§£æˆ‘ä»¬ä»ç„¶ä½¿ç”¨JDK1.7çš„ä»£ç ï¼Œå¥½ç†è§£ä¸€äº›ï¼Œæœ¬è´¨ä¸ŠåŒºåˆ«ä¸å¤§ï¼Œå…·ä½“åŒºåˆ«åæ–‡å†è¯´ã€‚ 12345678910111213void resize(int newCapacity) &#123; //ä¼ å…¥æ–°çš„å®¹é‡ Entry[] oldTable = table; //å¼•ç”¨æ‰©å®¹å‰çš„Entryæ•°ç»„ int oldCapacity = oldTable.length; if (oldCapacity == MAXIMUM_CAPACITY) &#123; //æ‰©å®¹å‰çš„æ•°ç»„å¤§å°å¦‚æœå·²ç»è¾¾åˆ°æœ€å¤§(2^30)äº† threshold = Integer.MAX_VALUE; //ä¿®æ”¹é˜ˆå€¼ä¸ºintçš„æœ€å¤§å€¼(2^31-1)ï¼Œè¿™æ ·ä»¥åå°±ä¸ä¼šæ‰©å®¹äº† return; &#125; Entry[] newTable = new Entry[newCapacity]; //åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Entryæ•°ç»„ transfer(newTable); //ï¼ï¼å°†æ•°æ®è½¬ç§»åˆ°æ–°çš„Entryæ•°ç»„é‡Œ table = newTable; //HashMapçš„tableå±æ€§å¼•ç”¨æ–°çš„Entryæ•°ç»„ threshold = (int)(newCapacity * loadFactor);//ä¿®æ”¹é˜ˆå€¼&#125; è¿™é‡Œå°±æ˜¯ä½¿ç”¨ä¸€ä¸ªå®¹é‡æ›´å¤§çš„æ•°ç»„æ¥ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œtransfer()æ–¹æ³•å°†åŸæœ‰Entryæ•°ç»„çš„å…ƒç´ æ‹·è´åˆ°æ–°çš„Entryæ•°ç»„é‡Œã€‚ 1234567891011121314151617void transfer(Entry[] newTable) &#123; Entry[] src = table; //srcå¼•ç”¨äº†æ—§çš„Entryæ•°ç»„ int newCapacity = newTable.length; for (int j = 0; j &lt; src.length; j++) &#123; //éå†æ—§çš„Entryæ•°ç»„ Entry&lt;K,V&gt; e = src[j]; //å–å¾—æ—§Entryæ•°ç»„çš„æ¯ä¸ªå…ƒç´  if (e != null) &#123; src[j] = null;//é‡Šæ”¾æ—§Entryæ•°ç»„çš„å¯¹è±¡å¼•ç”¨ï¼ˆforå¾ªç¯åï¼Œæ—§çš„Entryæ•°ç»„ä¸å†å¼•ç”¨ä»»ä½•å¯¹è±¡ï¼‰ do &#123; Entry&lt;K,V&gt; next = e.next; int i = indexFor(e.hash, newCapacity); //ï¼ï¼é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½® e.next = newTable[i]; //æ ‡è®°[1] newTable[i] = e; //å°†å…ƒç´ æ”¾åœ¨æ•°ç»„ä¸Š e = next; //è®¿é—®ä¸‹ä¸€ä¸ªEntryé“¾ä¸Šçš„å…ƒç´  &#125; while (e != null); &#125; &#125;&#125; newTable[i]çš„å¼•ç”¨èµ‹ç»™äº†e.nextï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†å•é“¾è¡¨çš„å¤´æ’å…¥æ–¹å¼ï¼ŒåŒä¸€ä½ç½®ä¸Šæ–°å…ƒç´ æ€»ä¼šè¢«æ”¾åœ¨é“¾è¡¨çš„å¤´éƒ¨ä½ç½®ï¼›è¿™æ ·å…ˆæ”¾åœ¨ä¸€ä¸ªç´¢å¼•ä¸Šçš„å…ƒç´ ç»ˆä¼šè¢«æ”¾åˆ°Entryé“¾çš„å°¾éƒ¨(å¦‚æœå‘ç”Ÿäº†hashå†²çªçš„è¯ï¼‰ï¼Œè¿™ä¸€ç‚¹å’ŒJdk1.8æœ‰åŒºåˆ«ï¼Œä¸‹æ–‡è¯¦è§£ã€‚åœ¨æ—§æ•°ç»„ä¸­åŒä¸€æ¡Entryé“¾ä¸Šçš„å…ƒç´ ï¼Œé€šè¿‡é‡æ–°è®¡ç®—ç´¢å¼•ä½ç½®åï¼Œæœ‰å¯èƒ½è¢«æ”¾åˆ°äº†æ–°æ•°ç»„çš„ä¸åŒä½ç½®ä¸Šã€‚ ä¸‹é¢ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸‹æ‰©å®¹è¿‡ç¨‹ã€‚å‡è®¾äº†æˆ‘ä»¬çš„hashç®—æ³•å°±æ˜¯ç®€å•çš„ç”¨key mod ä¸€ä¸‹è¡¨çš„å¤§å°ï¼ˆä¹Ÿå°±æ˜¯æ•°ç»„çš„é•¿åº¦ï¼‰ã€‚å…¶ä¸­çš„å“ˆå¸Œæ¡¶æ•°ç»„tableçš„size=2ï¼Œ æ‰€ä»¥key = 3ã€7ã€5ï¼Œputé¡ºåºä¾æ¬¡ä¸º 5ã€7ã€3ã€‚åœ¨mod 2ä»¥åéƒ½å†²çªåœ¨table[1]è¿™é‡Œäº†ã€‚è¿™é‡Œå‡è®¾è´Ÿè½½å› å­ loadFactor=1ï¼Œå³å½“é”®å€¼å¯¹çš„å®é™…å¤§å°size å¤§äº tableçš„å®é™…å¤§å°æ—¶è¿›è¡Œæ‰©å®¹ã€‚æ¥ä¸‹æ¥çš„ä¸‰ä¸ªæ­¥éª¤æ˜¯å“ˆå¸Œæ¡¶æ•°ç»„ resizeæˆ4ï¼Œç„¶åæ‰€æœ‰çš„Nodeé‡æ–°rehashçš„è¿‡ç¨‹ã€‚ ä¸‹é¢æˆ‘ä»¬è®²è§£ä¸‹JDK1.8åšäº†å“ªäº›ä¼˜åŒ–ã€‚ç»è¿‡è§‚æµ‹å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯2æ¬¡å¹‚çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥2å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚çœ‹ä¸‹å›¾å¯ä»¥æ˜ç™½è¿™å¥è¯çš„æ„æ€ï¼Œnä¸ºtableçš„é•¿åº¦ï¼Œå›¾ï¼ˆaï¼‰è¡¨ç¤ºæ‰©å®¹å‰çš„key1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå›¾ï¼ˆbï¼‰è¡¨ç¤ºæ‰©å®¹åkey1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå…¶ä¸­hash1æ˜¯key1å¯¹åº”çš„å“ˆå¸Œä¸é«˜ä½è¿ç®—ç»“æœã€‚ å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åï¼Œå› ä¸ºnå˜ä¸º2å€ï¼Œé‚£ä¹ˆn-1çš„maskèŒƒå›´åœ¨é«˜ä½å¤š1bit(çº¢è‰²)ï¼Œå› æ­¤æ–°çš„indexå°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ‰©å……HashMapçš„æ—¶å€™ï¼Œä¸éœ€è¦åƒJDK1.7çš„å®ç°é‚£æ ·é‡æ–°è®¡ç®—hashï¼Œåªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯1çš„è¯ç´¢å¼•å˜æˆâ€œåŸç´¢å¼•+oldCapâ€ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º16æ‰©å……ä¸º32çš„resizeç¤ºæ„å›¾ï¼š è¿™ä¸ªè®¾è®¡ç¡®å®éå¸¸çš„å·§å¦™ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº†ã€‚è¿™ä¸€å—å°±æ˜¯JDK1.8æ–°å¢çš„ä¼˜åŒ–ç‚¹ã€‚æœ‰ä¸€ç‚¹æ³¨æ„åŒºåˆ«ï¼ŒJDK1.7ä¸­rehashçš„æ—¶å€™ï¼Œæ—§é“¾è¡¨è¿ç§»æ–°é“¾è¡¨çš„æ—¶å€™ï¼Œå¦‚æœåœ¨æ–°è¡¨çš„æ•°ç»„ç´¢å¼•ä½ç½®ç›¸åŒï¼Œåˆ™é“¾è¡¨å…ƒç´ ä¼šå€’ç½®ï¼Œä½†æ˜¯ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒJDK1.8ä¸ä¼šå€’ç½®ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107/** * Initializes or doubles table size. If null, allocates in accord with initial capacity * target held in field threshold. Otherwise, because we are using power-of-two expansion, * the elements from each bin must either stay at same index, or move with a power of two * offset in the new table. * åˆå§‹åŒ–Mapæˆ–2å€æ‰©å®¹ï¼Œä¸”ä¼šå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„æ¡¶ä¸­ * å½“Mapä¸ºç©ºæ—¶ï¼Œå°†åˆ†é…ä¸é˜ˆå€¼ä¸€æ ·å¤§å°çš„å®¹é‡ * å½“Mapä¸ä¸ºç©ºæ—¶ï¼Œç”±äº2æ¬¡å¹‚æ‰©å®¹ï¼Œå…ƒç´ ä½ç½®ä¼šäº§ç”Ÿä¸¤ç§æƒ…å†µ * 1.è¦ä¹ˆå…ƒç´ æ‰€åœ¨ä½ç½®ä¸å˜ * 2.è¦ä¹ˆå…ƒç´ æ‰€åœ¨ä½ç½®å˜åŠ¨ï¼šå‘å³ä½ç§»2æ¬¡å¹‚ä½ç½® * æ³¨æ„ï¼šç”±äº1.8ä¸­å®¹é‡æ˜¯æ ¹æ®é˜ˆå€¼å¾—æ¥çš„ï¼Œå› æ­¤è¯»è€…ä¼šåœ¨1.8ä¸­çœ‹åˆ°å¾ˆå¤šå¯¹é˜ˆå€¼çš„åˆ¤æ–­å’Œå¤„ç†ï¼Œè¿™ç‚¹ä¸€å®šè¦æ¸…æ¥š * @return the table */final Node&lt;K,V&gt;[] resize() &#123; Node&lt;K,V&gt;[] oldTab = table;//ç”±äºæ–°æ•°ç»„ä¼šè¦†ç›–æ—§æ•°ç»„ï¼Œæ‰€ä»¥è¦ä¸´æ—¶å…ˆå¤‡ä»½ä¸€ä»½ï¼Œç”¨äºå¯¹æ–°æ•°ç»„é‡æ–°èµ‹å€¼ int oldCap = (oldTab == null) ? 0 : oldTab.length; int oldThr = threshold; int newCap, newThr = 0; if (oldCap &gt; 0) &#123;//å½“Mapä¸ä¸ºç©ºæ—¶ //ä¸´ç•Œå¤„ç†ï¼šæœ€å¤§å€¼ if (oldCap &gt;= MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE;//æœ€å¤§å€¼å…¶å®æ˜¯Integerçš„æœ€å¤§å€¼ return oldTab; &#125; //è‹¥2å€å®¹é‡ &lt; MAXIMUM_CAPACITY åŒæ—¶ åŸå®¹é‡&gt;=é»˜è®¤å®¹é‡(å³16)ï¼Œé‚£ä¹ˆå°±æ‰©å®¹2å€ else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr &lt;&lt; 1; // double threshold é˜ˆå€¼ç›´æ¥ä¸¤å€ï¼ˆå®¹é‡éƒ½æ˜¯æ ¹æ®é˜ˆå€¼æ¥çš„ï¼‰ &#125; else if (oldThr &gt; 0)&#123;//å½“Mapä¸ºç©ºæ—¶ï¼Œéœ€è¦åˆ¤æ–­é˜ˆå€¼æ˜¯å¦&gt;0 newCap = oldThr;//é˜ˆå€¼å³æ–°å®¹é‡ï¼ˆæ³¨æ„ï¼šåˆå§‹åŒ–æ—¶å€™å°±æ˜¯æ‰§è¡Œè¯¥æ“ä½œå®Œæˆå®¹é‡èµ‹å€¼ï¼‰ // initial capacity was placed in thresholdï¼ˆå®¹é‡éƒ½æ˜¯æ ¹æ®é˜ˆå€¼æ¥çš„ï¼‰ &#125; else &#123; //å½“Mapä¸ºç©ºï¼Œä¸”é˜ˆå€¼ä¸æ˜¯å¤§äº0ï¼ˆå³æ— æ•ˆé˜ˆå€¼ï¼‰ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨é»˜è®¤å€¼ // zero initial threshold signifies using defaults newCap = DEFAULT_INITIAL_CAPACITY;//1 &lt;&lt; 4 = 16 newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);//0.75 * 16 = 12 &#125; //å½“æ–°é˜ˆå€¼æ²¡æœ‰è¢«é‡ç½®æ—¶ï¼Œéœ€è¦æ ¹æ® æ–°å®¹é‡å’Œè´Ÿè½½å› å­ é‡æ–°è®¡ç®—å‡ºæ–°çš„é˜ˆå€¼ //æ³¨æ„ï¼šåˆå§‹åŒ–çš„æ—¶å€™ï¼Œé˜ˆå€¼ä¼šè¢«é‡ç½®ï¼Œå³æ­¤æ—¶ é˜ˆå€¼ï¼=å®¹é‡ ï¼Œå®¹é‡å·²ç»åœ¨(oldThr &gt; 0)æ—¶é‡ç½®è¿‡äº† if (newThr == 0) &#123; //ç­‰åŒäº1.7ç‰ˆæœ¬ï¼šthreshold = (int)Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + 1); float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); &#125; threshold = newThr;//é‡ç½®ç»™çœŸå®é˜ˆå€¼ @SuppressWarnings(&#123;"rawtypes","unchecked"&#125;) Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];//æ–°å»ºä¸€ä¸ªæ–°å®¹é‡çš„Nodeæ•°ç»„ table = newTab;//è¦†ç›–åŸæ•°ç»„ï¼ˆç¬¬ä¸€è¡Œå·²ç»å¤‡ä»½äº†ï¼‰ //å½“åŸæ•°ç»„éç©ºï¼Œéœ€è¦å¯¹æ–°æ•°ç»„é‡æ–°å¡«å…… if (oldTab != null) &#123; //éå† for (int j = 0; j &lt; oldCap; ++j) &#123; Node&lt;K,V&gt; e;//ç”¨äºå¤‡ä»½å½“å‰èŠ‚ç‚¹ //è‹¥è¯¥æ•°ç»„ä¸‹æ ‡ä½ç½®éç©º if ((e = oldTab[j]) != null) &#123; oldTab[j] = null;//å…ˆæŠŠåŸæ•°ç»„çš„å½“å‰ä½ç½®æ¸…ç©ºï¼Œå› ä¸ºå·²ç»å¤‡ä»½äº† help gc if (e.next == null)//å½“å‰æ¡¶æ—¢éé“¾è¡¨ä¹Ÿéçº¢é»‘æ ‘ newTab[e.hash &amp; (newCap - 1)] = e;//ä½ç½®å¯èƒ½ä¸å˜æˆ–ç§»åŠ¨2æ¬¡å¹‚ï¼Œè·ŸnewCap-1æœ‰å…³ else if (e instanceof TreeNode)//è‹¥å½“å‰æ¡¶æ˜¯æ ‘èŠ‚ç‚¹ï¼Œéœ€è¦å¯¹æ ‘è¿›è¡Œåˆ‡åˆ† ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); else &#123; // preserve order å½“å‰æ¡¶æ˜¯é“¾è¡¨ï¼Œè¦ä¿æŒé¡ºåº 1.7çš„ä¼šå€’ç½® //æ‰©å®¹åï¼Œæ–°æ•°ç»„ä¸­çš„é“¾è¡¨é¡ºåºä¾ç„¶ä¸æ—§æ•°ç»„ä¸­çš„é“¾è¡¨é¡ºåºä¿æŒä¸€è‡´!!! Node&lt;K,V&gt; loHead = null, loTail = null;//lo=lowï¼Œè¡¨ç¤ºä½ä½ï¼ˆå³æ•°ç»„å‰åŠéƒ¨åˆ†çš„é“¾è¡¨ï¼‰ Node&lt;K,V&gt; hiHead = null, hiTail = null;//hi=highï¼Œè¡¨ç¤ºé«˜ä½ï¼ˆå³æ•°ç»„ååŠéƒ¨åˆ†çš„é“¾è¡¨ï¼‰ Node&lt;K,V&gt; next; //éå†å½“å‰æ¡¶çš„é“¾è¡¨ //1.8:æ˜¯å°¾æ’å…¥æ³•ï¼Œå…ˆæ¥çš„ç•™åœ¨æ•°ç»„ä¸Šï¼Œåæ¥çš„é“¾åœ¨å°¾ä¸Šï¼ˆéå†æ—¶æ˜¯å…ˆè¿›å…ˆå‡ºï¼‰ do &#123; next = e.next; //æ ¹æ®e.hash &amp; oldCapæ˜¯å¦ä¸ºé›¶å°†åŸé“¾è¡¨æ‹†åˆ†æˆ2ä¸ªé“¾è¡¨ //åˆ¤æ–­å½“å‰ä½ç½®æ˜¯å¦å‘ç”Ÿå˜åŠ¨ 0åˆ™æ²¡å˜ å³ä¿ç•™åœ¨åŸé“¾è¡¨ä¸­ä¸éœ€è¦ç§»åŠ¨ if ((e.hash &amp; oldCap) == 0) &#123; //åŸç´¢å¼• åœ¨æ•°ç»„å‰åŠéƒ¨åˆ†å¤„ç† //è‹¥é˜Ÿå°¾ä¸ºç©ºï¼Œå½“å‰å…ƒç´ å³æ˜¯é˜Ÿé¦–å…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªæ’å…¥çš„å…ƒç´ ï¼‰ï¼Œä¿è¯å…ˆè¿›å…ˆå‡º if (loTail == null) loHead = e; else //è‹¥é˜Ÿå°¾ä¸ä¸ºç©ºï¼Œå½“å‰å…ƒç´ é“¾æ¥åˆ°åŸé˜Ÿå°¾å…ƒç´ åé¢ï¼Œä¿è¯å…ˆè¿›å…ˆå‡º loTail.next = e; loTail = e;//ä¸ºäº†ä¿è¯æ’å…¥é¡ºåºä¸å˜ï¼Œå½“å‰å…ƒç´ éƒ½éœ€å…ˆè®¾ç½®ä¸ºé˜Ÿå°¾å…ƒç´  &#125; //åŸç´¢å¼•+oldCap å¦åˆ™ç§»åŠ¨åˆ°"åŸç´¢å¼•+oldCap"çš„æ–°é“¾è¡¨ä¸­ else &#123; //åœ¨æ•°ç»„ååŠéƒ¨åˆ†å¤„ç† if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e;//ä¸ºäº†ä¿è¯æ’å…¥é¡ºåºä¸å˜ï¼Œå½“å‰å…ƒç´ éƒ½éœ€å…ˆè®¾ç½®ä¸ºé˜Ÿå°¾å…ƒç´  &#125; &#125; while ((e = next) != null); //åŸç´¢å¼•æ”¾åˆ°åŸæ¡¶ä¸­ if (loTail != null) &#123;//å¦‚æœé˜Ÿå°¾å…ƒç´ éç©º loTail.next = null;//loTailæ­¤æ—¶å°±æ˜¯é˜Ÿå°¾å…ƒç´  newTab[j] = loHead;//é˜Ÿé¦–æ˜¯æ”¾åœ¨æ•°ç»„é‡Œé¢çš„ &#125; //åŸç´¢å¼•+oldCapæ”¾åˆ°æ–°æ¡¶ä¸­ if (hiTail != null) &#123;//å¦‚æœé˜Ÿå°¾å…ƒç´ éç©º hiTail.next = null;//hiTailæ­¤æ—¶å°±æ˜¯é˜Ÿå°¾å…ƒç´  newTab[j + oldCap] = hiHead;//é˜Ÿé¦–æ˜¯æ”¾åœ¨æ•°ç»„é‡Œé¢çš„ &#125; &#125; &#125; &#125; &#125; return newTab;&#125; æ‰€ä»¥è¯´ï¼ŒJDK 1.8ä¹‹åæ‰©å®¹çš„æ”¹è¿›æœ‰ï¼š é“¾è¡¨ä¸Šçš„èŠ‚ç‚¹æ˜¯å°¾æ’æ³•ï¼Œå…ˆæ¥çš„æ”¾åˆ°æ•°ç»„ä¸­ï¼Œåæ¥çš„æ”¾åˆ°é“¾è¡¨ä¸­ï¼Œå…ˆåˆ°å…ˆå‡ºï¼Œç±»ä¼¼äºæ ˆã€‚ JDK 1.8 ä¸åƒ JDK1.7ä¸­ä¼šé‡æ–°è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹åœ¨æ–°å“ˆå¸Œè¡¨ä¸­çš„ä½ç½®ï¼Œè€Œæ˜¯é€šè¿‡ (e.hash &amp; oldCap) == 0æ˜¯å¦ç­‰äº0 å°±å¯ä»¥å¾—å‡ºåŸæ¥é“¾è¡¨ä¸­çš„èŠ‚ç‚¹åœ¨æ–°å“ˆå¸Œè¡¨çš„ä½ç½®ã€‚æ— éœ€é‡æ–°è®¡ç®—Hashï¼ŒèŠ‚çœäº†æ—¶é—´ï¼Œæ–°ç´¢å¼•=åŸç´¢å¼•+åŸå®¹é‡ HashMap åœ¨ 1.7çš„æ—¶å€™æ‰©å®¹åï¼Œé“¾è¡¨çš„èŠ‚ç‚¹é¡ºåºä¼šå€’ç½®ï¼Œ1.8åˆ™ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚å› ä¸º1.7æ˜¯åè¿›å…ˆå‡ºï¼Œ1.8æ˜¯å…ˆè¿›å…ˆå‡ºã€‚ treeifyBinæ–¹æ³•(æ ‘åŒ–æ–¹æ³•)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889 /** * Replaces all linked nodes in bin at index for given hash unless * table is too small, in which case resizes instead. * æ¡¶å†…é“¾è¡¨æ ‘åŒ–ï¼šå°†æ¡¶å†…æ‰€æœ‰çš„é“¾è¡¨èŠ‚ç‚¹æ›¿æ¢æˆçº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œå½“å…ƒç´ æ•°é‡ä¸å¤Ÿæ ‘åŒ–æ—¶ä¼šé‡æ–°resize * æ³¨æ„ï¼šä¸æ˜¯æ•´ä¸ªMapè½¬æ¢ï¼Œåªæ˜¯å½“å‰æ¡¶ï¼ */final void treeifyBin(Node&lt;K,V&gt;[] tab, int hash) &#123; int n, index; Node&lt;K,V&gt; e; //å½“æ•°ç»„ä¸ºç©º æˆ–è€… æ•°ç»„é•¿åº¦ &lt; æ ‘åŒ–é˜ˆå€¼ï¼ˆ64ï¼‰æ—¶éœ€è¦æ‰§è¡Œresizeæ–¹æ³•ï¼Œé‡æ–°å†³å®šå†…éƒ¨çš„æ•°æ®ç»“æ„ç±»å‹ if (tab == null || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY) resize(); //å¦åˆ™ï¼Œéœ€è¦æ ‘åŒ– else if ((e = tab[index = (n - 1) &amp; hash]) != null) &#123; TreeNode&lt;K,V&gt; hd = null, tl = null;//hdæŒ‡çš„æ˜¯headï¼ŒtlæŒ‡çš„æ˜¯tailï¼Œåˆ†åˆ«æŒ‡å‘çº¢é»‘æ ‘çš„å¤´ã€å°¾èŠ‚ç‚¹ //ä»é“¾è¡¨å¤´èŠ‚ç‚¹å¼€å§‹éå†é“¾è¡¨ï¼Œå¤´èŠ‚ç‚¹æ˜¯å­˜æ”¾åœ¨æ•°ç»„ä¸­çš„ do &#123; //æ–°å»ºä¸€ä¸ªæ ‘å½¢èŠ‚ç‚¹ï¼Œå†…å®¹å’Œå½“å‰é“¾è¡¨èŠ‚ç‚¹eä¿æŒä¸€è‡´ //æ­¤æ—¶nexté»˜è®¤ä¸ºnullï¼Œä¼šåœ¨åé¢æŒ‰é¡ºåºé‡æ–°å¯¹nextèµ‹å€¼ TreeNode&lt;K,V&gt; p = replacementTreeNode(e, null); if (tl == null)//å½“å°¾èŠ‚ç‚¹ä¸ºç©ºï¼Œå³å½“å‰èŠ‚ç‚¹åº”ä¸ºå¤´èŠ‚ç‚¹ï¼ˆå› ä¸ºå°±è¿™ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ hd = p; else &#123; p.prev = tl;//prevè¢«èµ‹å€¼ï¼Œä¸»è¦æ˜¯è®°å½•å½“å‰èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ tl.next = p;//pæŒ‡å‘ä¹‹å‰å°¾èŠ‚ç‚¹çš„nextï¼Œä¿æŒæ’å…¥é¡ºåº &#125; tl = p;//å½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºå°¾èŠ‚ç‚¹ï¼Œä¿æŒæ’å…¥é¡ºåº &#125; while ((e = e.next) != null); //æ¡¶å†…ç¬¬ä¸€ä¸ªå…ƒç´ å³é“¾è¡¨å¤´èŠ‚ç‚¹ï¼Œå¹¶æ”¾åœ¨æ•°ç»„ä¸­ if ((tab[index] = hd) != null) hd.treeify(tab);//ä»å¤´èŠ‚ç‚¹å¼€å§‹éå†ï¼Œå°†æ•´ä¸ªæ¡¶æ ‘åŒ– //æ³¨æ„å¤´èŠ‚ç‚¹å¹¶ä¸ä¸€å®šæ˜¯æ ‘çš„æ ¹èŠ‚ç‚¹ï¼šæ ‘åŒ–åçš„æ ¹èŠ‚ç‚¹ä¼šé‡æ–°è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹ï¼Œå³tab[index]=root //å…·ä½“å‚è§moveRootToFront() &#125;&#125;// For treeifyBin æ–°å»ºä¸€ä¸ªæ ‘å½¢èŠ‚ç‚¹TreeNode&lt;K,V&gt; replacementTreeNode(Node&lt;K,V&gt; p, Node&lt;K,V&gt; next) &#123; return new TreeNode&lt;&gt;(p.hash, p.key, p.value, next);&#125;/** * Forms tree of the nodes linked from this node. * å¡‘é€ çº¢é»‘æ ‘ * @return root of tree è¿™é‡Œæ¯”è¾ƒæœ‰æ„æ€ï¼Œæ˜æ˜æ—¶voidä½†æœ‰æ³¨é‡Š@returnï¼Œä¸çŸ¥å¤§ç¥ä»¬ä½•æ„ */final void treeify(Node&lt;K,V&gt;[] tab) &#123; TreeNode&lt;K,V&gt; root = null;//æ ¹èŠ‚ç‚¹éœ€è¦æ’åºåé‡æ–°è®¾ç½®ï¼ˆä¹‹å‰é“¾è¡¨çš„å¤´èŠ‚ç‚¹ä¸ä¸€å®šæ˜¯æ ‘çš„æ ¹èŠ‚ç‚¹ï¼‰ //thisæŒ‡çš„æ˜¯å½“å‰äºŒå‰æ ‘çš„å¤´èŠ‚ç‚¹ï¼Œä»å¤´èŠ‚ç‚¹å¼€å§‹éå† for (TreeNode&lt;K,V&gt; x = this, next; x != null; x = next) &#123; next = (TreeNode&lt;K,V&gt;)x.next; x.left = x.right = null; //å½“æ ¹èŠ‚ç‚¹ä¸ºç©ºæ—¶ï¼Œå…ˆè®¾ç½®æ ¹èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼ŒåŒæ—¶å½“å‰èŠ‚ç‚¹å…ˆå½“ä½œæ ¹èŠ‚ç‚¹ï¼ˆå³è‡ªä¸Šè€Œä¸‹æ’å…¥ï¼‰ if (root == null) &#123; x.parent = null; x.red = false;//çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹ä¸ºé»‘è‰² root = x; &#125; else &#123; //åé¢è¿›å…¥å¾ªç¯èµ°çš„é€»è¾‘ï¼Œx æŒ‡å‘æ ‘ä¸­çš„æŸä¸ªèŠ‚ç‚¹ K k = x.key; int h = x.hash; Class&lt;?&gt; kc = null; //é‡æ–°å¾ªç¯ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œéå†æ‰€æœ‰èŠ‚ç‚¹ä¸å½“å‰èŠ‚ç‚¹xæ¯”è¾ƒï¼Œé‡æ–°è°ƒæ•´ä½ç½®ï¼Œç±»ä¼¼å†’æ³¡æ’åº for (TreeNode&lt;K,V&gt; p = root;;) &#123; int dir, ph; K pk = p.key; if ((ph = p.hash) &gt; h)//å¦‚æœæ¯”è¾ƒèŠ‚ç‚¹çš„hashæ¯”å½“å‰èŠ‚ç‚¹çš„hashå¤§ï¼ŒæŸ¥å·¦å­æ ‘ dir = -1; else if (ph &lt; h) dir = 1;//å¦‚æœæ¯”è¾ƒèŠ‚ç‚¹çš„hashæ¯”å½“å‰èŠ‚ç‚¹çš„hashå°ï¼ŒæŸ¥å³å­æ ‘ else if ((kc == null &amp;&amp; (kc = comparableClassFor(k)) == null) || (dir = compareComparables(kc, k, pk)) == 0 ) //tieBreakOrder ç”¨äºhashç›¸åŒæ—¶ä¸”keyæ— æ³•æ¯”è¾ƒæ—¶ï¼Œç›´æ¥æ ¹æ®å¼•ç”¨æ¯”è¾ƒ //è¿™é‡ŒæŒ‡çš„æ˜¯å¦‚æœå½“å‰æ¯”è¾ƒèŠ‚ç‚¹çš„å“ˆå¸Œå€¼æ¯”xå¤§ï¼Œè¿”å›-1ï¼Œå¦åˆ™è¿”å›1 dir = tieBreakOrder(k, pk); //ç»è¿‡å‰é¢çš„è®¡ç®—ï¼Œå¾—åˆ°äº†å½“å‰èŠ‚ç‚¹å’Œè¦æ’å…¥èŠ‚ç‚¹xçš„ä¸€ä¸ªå¤§å°å…³ç³» //å¦‚æœå½“å‰æ¯”è¾ƒèŠ‚ç‚¹çš„å“ˆå¸Œå€¼æ¯”xå¤§ï¼Œxå°±æ˜¯å·¦å­èŠ‚ç‚¹ï¼Œå¦åˆ™xæ˜¯å³å­èŠ‚ç‚¹ TreeNode&lt;K,V&gt; xp = p; if ((p = (dir &lt;= 0) ? p.left : p.right) == null) &#123; x.parent = xp;//æŠŠå½“å‰èŠ‚ç‚¹å˜æˆxçš„çˆ¶èŠ‚ç‚¹ if (dir &lt;= 0) xp.left = x; else xp.right = x; root = balanceInsertion(root, x); break; &#125; &#125; &#125; &#125; moveRootToFront(tab, root);//å°†æ ¹èŠ‚ç‚¹è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹ getæ–¹æ³•(æŸ¥è¯¢) æ ¹æ®é”®å€¼å¯¹çš„ key å»è·å–å¯¹åº”çš„ Value 1234567891011121314151617181920212223242526272829public V get(Object key) &#123; Node&lt;K,V&gt; e; //é€šè¿‡ getNodeå¯»æ‰¾ key å¯¹åº”çš„ Value å¦‚æœæ²¡æ‰¾åˆ°ï¼Œæˆ–è€…æ‰¾åˆ°çš„ç»“æœä¸º null å°±ä¼šè¿”å›null å¦åˆ™ä¼šè¿”å›å¯¹åº”çš„ Value return (e = getNode(hash(key), key)) == null ? null : e.value;&#125;final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; //ç°æ ¹æ® key çš„ hash å€¼å»æ‰¾åˆ°å¯¹åº”çš„é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘ if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; // å¦‚æœç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯é‚£ä¹ˆç›´æ¥è¿”å› if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; //å¦‚æœ å¯¹åº”çš„ä½ç½®ä¸ºçº¢é»‘æ ‘è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•å»å¯»æ‰¾èŠ‚ç‚¹ if ((e = first.next) != null) &#123; if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); //éå†å•é“¾è¡¨æ‰¾åˆ°å¯¹åº”çš„ key å’Œ Value do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null;&#125; JDK 1.8æ–°å¢ get æ–¹æ³•ï¼Œåœ¨å¯»æ‰¾ key å¯¹åº” Value çš„æ—¶å€™å¦‚æœæ²¡æ‰¾åˆ°åˆ™è¿”å›æŒ‡å®šé»˜è®¤å€¼ã€‚ 12345@Overridepublic V getOrDefault(Object key, V defaultValue) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? defaultValue : e.value;&#125; deleteæ–¹æ³•(åˆ é™¤)HashMap æ²¡æœ‰ set æ–¹æ³•ï¼Œå¦‚æœæƒ³è¦ä¿®æ”¹å¯¹åº” key æ˜ å°„çš„ Value ï¼Œåªéœ€è¦å†æ¬¡è°ƒç”¨ put æ–¹æ³•å°±å¯ä»¥äº†ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•ç§»é™¤ HashMap ä¸­å¯¹åº”çš„èŠ‚ç‚¹çš„æ–¹æ³•ï¼š 12345678910 public V remove(Object key) &#123; Node&lt;K,V&gt; e; return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value;&#125; public V remove(Object key) &#123; Node&lt;K,V&gt; e; return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value;&#125; è¿™é‡Œæœ‰ä¸¤ä¸ªå‚æ•°éœ€è¦æˆ‘ä»¬æèµ·æ³¨æ„ï¼š matchValue å¦‚æœè¿™ä¸ªå€¼ä¸º true åˆ™è¡¨ç¤ºåªæœ‰å½“ Value ä¸ç¬¬ä¸‰ä¸ªå‚æ•° Value ç›¸åŒçš„æ—¶å€™æ‰åˆ é™¤å¯¹ä¸€ä¸ªçš„èŠ‚ç‚¹ movable è¿™ä¸ªå‚æ•°åœ¨çº¢é»‘æ ‘ä¸­å…ˆåˆ é™¤èŠ‚ç‚¹æ—¶å€™ä½¿ç”¨ true è¡¨ç¤ºåˆ é™¤å¹¶å…¶ä»–æ•°ä¸­çš„èŠ‚ç‚¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051 final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index; //åˆ¤æ–­å“ˆå¸Œè¡¨æ˜¯å¦ä¸ºç©ºï¼Œé•¿åº¦æ˜¯å¦å¤§äº0 å¯¹åº”çš„ä½ç½®ä¸Šæ˜¯å¦æœ‰å…ƒç´  if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (p = tab[index = (n - 1) &amp; hash]) != null) &#123; // node ç”¨æ¥å­˜æ”¾è¦ç§»é™¤çš„èŠ‚ç‚¹ï¼Œ e è¡¨ç¤ºä¸‹ä¸ªèŠ‚ç‚¹ k ï¼Œv æ¯ä¸ªèŠ‚ç‚¹çš„é”®å€¼ Node&lt;K,V&gt; node = null, e; K k; V v; //å¦‚æœç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç›´æ¥èµ‹å€¼ç»™ node if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; else if ((e = p.next) != null) &#123; // éå†çº¢é»‘æ ‘æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ if (p instanceof TreeNode) node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key); else &#123; //éå†å¯¹åº”çš„é“¾è¡¨æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) &#123; node = e; break; &#125; p = e; &#125; while ((e = e.next) != null); &#125; &#125; // å¦‚æœæ‰¾åˆ°äº†èŠ‚ç‚¹ // !matchValue æ˜¯å¦ä¸åˆ é™¤èŠ‚ç‚¹ // (v = node.value) == value || // (value != null &amp;&amp; value.equals(v))) èŠ‚ç‚¹å€¼æ˜¯å¦ç›¸åŒï¼Œ if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) &#123; //åˆ é™¤èŠ‚ç‚¹ if (node instanceof TreeNode) ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable); else if (node == p) tab[index] = node.next; else p.next = node.next; ++modCount; --size; afterNodeRemoval(node); return node; &#125; &#125; return null;&#125; 1234567891011public void remove() &#123; if (current == null) throw new IllegalStateException(); if (modCount != expectedModCount) throw new ConcurrentModificationException(); Object k = current.key; current = null; HashMap.this.removeEntryForKey(k); //é‡è¦æ“ä½œï¼šè¿­ä»£å™¨ä¸­åˆ é™¤æ—¶åŒæ­¥äº†expectedModCountå€¼ä¸modCountç›¸åŒ expectedModCount = modCount;&#125; è¿­ä»£Map æ˜¯æ²¡æœ‰è¿­ä»£å™¨çš„ï¼Œéœ€è¦è½¬æˆ Set æ“ä½œ 1234567Map map = new HashMap();Iterator iter = map.entrySet().iterator();while (iter.hasNext()) &#123; Map.Entry entry = (Map.Entry) iter.next(); Object key = entry.getKey(); Object val = entry.getValue();&#125; è¦å¼ºè°ƒçš„æ˜¯ï¼Œæ— è®ºå“ªç§è¿­ä»£å™¨éƒ½æ˜¯é€šè¿‡éå† table è¡¨æ¥è·å–ä¸‹ä¸ªèŠ‚ç‚¹ï¼Œæ¥éå†çš„ï¼Œéå†è¿‡ç¨‹å¯ä»¥ç†è§£ä¸ºä¸€ç§æ·±åº¦ä¼˜å…ˆéå†ï¼Œå³ä¼˜å…ˆéå†é“¾è¡¨èŠ‚ç‚¹ï¼ˆæˆ–è€…çº¢é»‘æ ‘ï¼‰ï¼Œç„¶ååœ¨éå†å…¶ä»–æ•°ç»„ä½ç½®ã€‚ Fail-Fastå½“ä½¿ç”¨è¿­ä»£å™¨çš„è¿‡ç¨‹ä¸­æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†mapï¼Œå¹¶ä¸”ä¸æ˜¯ä½¿ç”¨è¿­ä»£å™¨ä¿®æ”¹çš„ï¼Œå°†å¼•å‘ConcurrentModificationException 1234567891011121314//ä¿®æ”¹è®¡æ•° putã€removeæˆ–clearæ—¶mount++ clearæ—¶æ¸…ç©ºtransient int modCount;HashIterator() &#123; expectedModCount = modCount; if (size &gt; 0) &#123; Entry[] t = table; while (index &lt; t.length &amp;&amp; (next = t[index++]) == null); &#125;&#125;final Entry&lt;K,V&gt; nextEntry() &#123; //æœŸæœ›å˜æ›´æ•°é‡ä¸åŒ¹é… if (modCount != expectedModCount) throw new ConcurrentModificationException();&#125; ä¸HashTableçš„åŒºåˆ« HashMap æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼ŒHashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ HashMap å…è®¸ key å’Œ Vale æ˜¯ nullï¼Œä½†æ˜¯åªå…è®¸ä¸€ä¸ª key ä¸º null,ä¸”è¿™ä¸ªå…ƒç´ å­˜æ”¾åœ¨å“ˆå¸Œè¡¨ 0 è§’æ ‡ä½ç½®ã€‚ HashTable ä¸å…è®¸keyã€value æ˜¯ nullã€‚ HashMap å†…éƒ¨ä½¿ç”¨hash(Object key)æ‰°åŠ¨å‡½æ•°å¯¹ key çš„ hashCode è¿›è¡Œæ‰°åŠ¨åä½œä¸º hash å€¼ã€‚HashTable æ˜¯ç›´æ¥ä½¿ç”¨ key çš„ hashCode() è¿”å›å€¼ä½œä¸º hash å€¼ã€‚ HashMapé»˜è®¤å®¹é‡ä¸º 2^4 ä¸”å®¹é‡ä¸€å®šæ˜¯ 2^n ; HashTable é»˜è®¤å®¹é‡æ˜¯11,ä¸ä¸€å®šæ˜¯ 2^nã€‚ HashTable å–å“ˆå¸Œæ¡¶ä¸‹æ ‡æ˜¯ç›´æ¥ç”¨æ¨¡è¿ç®—,æ‰©å®¹æ—¶æ–°å®¹é‡æ˜¯åŸæ¥çš„2å€+1ã€‚HashMap åœ¨æ‰©å®¹çš„æ—¶å€™æ˜¯åŸæ¥çš„ä¸¤å€ï¼Œä¸”å“ˆå¸Œæ¡¶çš„ä¸‹æ ‡ä½¿ç”¨ &amp;è¿ç®—ä»£æ›¿äº†å–æ¨¡ã€‚ Hashtableæ˜¯Dictionaryçš„å­ç±»åŒæ—¶ä¹Ÿå®ç°äº†Mapæ¥å£ï¼ŒHashMapæ˜¯Mapæ¥å£çš„ä¸€ä¸ªå®ç°ç±»ã€‚ é¢è¯•é¢˜ç­”æ¡ˆ HashMapçš„åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ HashMapçš„ä¸»è¦æ–¹æ³•ï¼Ÿ put()ã€resize()ã€treeifyBin()ã€get()ã€delete()ç­‰ç­‰ HashMap æ˜¯å¦‚ä½•ç¡®å®šå…ƒç´ å­˜å‚¨ä½ç½®çš„ä»¥åŠå¦‚ä½•å¤„ç†å“ˆå¸Œå†²çªçš„ï¼Ÿ æ˜¯é€šè¿‡hashcodeå’Œæ‰°ä¹±å‡½æ•°ç¡®å®šçš„ï¼Œå…ˆè®¡ç®—å¥½keyçš„hashCode,ç„¶åå°†hashCodeçš„ä½16ä½å’Œé«˜16ä½è¿›è¡Œç›¸å¼‚æˆ–ï¼Œå¼‚æˆ–å®Œæˆåå†è¿›è¡Œå–æ¨¡(å…¶å®ä¹Ÿå°±æ˜¯ä¸å®¹é‡-1è¿›è¡Œç›¸ä¸[æœ‰0åˆ™å…¨ä¸º0ï¼Œå…¨1æ‰ä¸º1])ã€‚ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼š å–keyçš„hashCodeå€¼ã€é«˜ä½è¿ç®—ã€å–æ¨¡è¿ç®— HashMap æ‰©å®¹æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ å…ˆåˆ¤æ–­æ˜¯å¦è¶…è¿‡äº†æ•´æ•°å‹çš„æœ€å¤§å€¼ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå†åˆ¤æ–­æ˜¯å¦å·²ç»è¶…è¿‡äº†æ‰©å®¹é˜ˆå€¼ï¼Œå¦‚æœè¶…è¿‡äº†ï¼Œåˆ™ç›´æ¥æ‰©å®¹ä¸¤å€ï¼Œæ‰©å®¹çš„æ•°é‡éƒ½æ˜¯2çš„næ¬¡æ–¹ï¼ŒHashMapéƒ½æ˜¯ä¼˜å…ˆæ‰©å®¹çš„ï¼Œç„¶åå…¶æ¬¡æ‰æ˜¯æ ‘åŒ–ç­‰ç­‰ã€‚ æ€»çš„æ¥è¯´åˆ†ä¸ºä¸¤æ­¥ï¼š1. å¯»æ‰¾æ‰©å®¹åæ•°ç»„çš„å¤§å°ä»¥åŠæ–°çš„æ‰©å®¹é˜ˆå€¼ï¼Œ2. å°†åŸæœ‰å“ˆå¸Œè¡¨æ‹·è´åˆ°æ–°çš„å“ˆå¸Œè¡¨ä¸­ã€‚ JDK 1.8 åœ¨æ‰©å®¹å’Œè§£å†³å“ˆå¸Œå†²çªä¸Šå¯¹ HashMap æºç åšäº†å“ªäº›æ”¹åŠ¨ï¼Ÿæœ‰ä»€ä¹ˆå¥½å¤„? åœ¨æ‰©å®¹æ–¹é¢ï¼Œç”±äºæ˜¯é€‰ç”¨äº†2çš„næ¬¡æ–¹ä½œä¸ºæ¡¶çš„æ•°é‡ï¼Œæ‰€ä»¥åœ¨å–æ¨¡çš„æ—¶å€™å°±éå¸¸æ–¹ä¾¿äº†ï¼Œç›´æ¥çœ‹hashCodeçš„å‰ä¸€ä½æ˜¯1æˆ–è€…0å°±å¯ä»¥åˆ¤æ–­åœ¨æ‰©å®¹åçš„æ–°ä½ç½®ï¼Œæ— éœ€é‡æ–°å–æ¨¡è¿ç®—ï¼› æ—¢çœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº†ï¼Œè¿™ä¸€å—å°±æ˜¯JDK1.8æ–°å¢çš„ä¼˜åŒ–ç‚¹ï¼› HashMap åœ¨ 1.7çš„æ—¶å€™æ‰©å®¹åï¼Œé“¾è¡¨çš„èŠ‚ç‚¹é¡ºåºä¼šå€’ç½®ï¼Œ1.8åˆ™ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚å› ä¸º1.7æ˜¯åè¿›å…ˆå‡ºï¼Œ1.8æ˜¯å…ˆè¿›å…ˆå‡ºã€‚1.7æ˜¯å¤´æ’æ³•ï¼Œ1.8æ˜¯å°¾æ’æ³•ï¼› ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨HashMapï¼Ÿä»–æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ åŸºäºMapæ¥å£å®ç°çš„Key-Valueå®¹å™¨ï¼Œå…è®¸ä¸ºç©ºå€¼ï¼ŒåŒæ—¶éæœ‰åºï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼ŒéåŒæ­¥ã€‚ ä½ çŸ¥é“HashMapçš„å·¥ä½œåŸç†å—ï¼Ÿ ç»è¿‡HashCodeå’Œæ‰°ä¹±å‡½æ•°ï¼Œå¾—åˆ°ç›¸åº”çš„ç´¢å¼•ä½ç½®ï¼Œç„¶åæ’å…¥ï¼Œå¦‚æœéç©ºç›´æ¥æ’å…¥å³å¯ï¼Œå¦‚æœæ˜¯æœ‰æ•°æ®ï¼Œåˆ™åˆ¤æ–­æ˜¯é“¾è¡¨è¿˜æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœé“¾è¡¨è¶…è¿‡8åˆ™å…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œå¦‚æœä¸éœ€è¦å°±å°†é“¾è¡¨å˜æˆçº¢é»‘æ ‘ï¼ ä½ çŸ¥é“getå’Œputçš„åŸç†å—ï¼Ÿequals()å’ŒhashCode()éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ é€šè¿‡å¯¹keyçš„hashCode()è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå¹¶è®¡ç®—ä¸‹æ ‡ï¼ˆn-1ï¼†hashï¼‰ï¼Œä»è€Œè·å¾—å­˜å‚¨æ¡¶çš„ä½ç½®ã€‚å¦‚æœäº§ç”Ÿç¢°æ’ï¼Œåˆ™åˆ©ç”¨key.equals()æ–¹æ³•å»é“¾è¡¨æˆ–æ ‘ä¸­å»æŸ¥æ‰¾å¯¹åº”çš„é˜Ÿåˆ—ã€‚ ä½ çŸ¥é“hashçš„å®ç°å—ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™æ ·å®ç°ï¼Ÿ åœ¨Java 1.8çš„å®ç°ä¸­ï¼Œæ˜¯é€šè¿‡hashCodeï¼ˆï¼‰çš„é«˜16ä½å¼‚æˆ–ä½16ä½å®ç°çš„ï¼šï¼ˆh = k.hashCodeï¼ˆï¼‰ï¼‰^ï¼ˆh &gt;&gt;&gt; 16ï¼‰ï¼Œä¸»è¦æ˜¯ä»é€Ÿåº¦ï¼Œæ•ˆç›Šï¼Œè´¨é‡æ¥è€ƒè™‘çš„ï¼Œè¿™æ ·åšå¯ä»¥åœ¨bucketçš„næ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½ä½éƒ½å‚ä¸åˆ°hashçš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚ ä½¿ç”¨hashè¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯å¯ä»¥ç¡®ä¿æ¯ä¸ªé“¾è¡¨ä¸­çš„é•¿åº¦ä¸€è‡´ å¦‚æœHashMapçš„å¤§å°è¶…è¿‡äº†è´Ÿè½½å› å­ï¼ˆload factorï¼‰å®šä¹‰çš„å®¹é‡ï¼Œæ€ä¹ˆåŠï¼Ÿ å¦‚æœè¶…è¿‡äº†è´Ÿè½½å› å­ï¼ˆæœ€å°0.75ï¼‰ï¼Œåˆ™é‡æ–°é‡æ–°è°ƒæ•´ä¸€ä¸ªåŸå…ˆé•¿åº¦çš„HashMapï¼Œå¹¶é‡æ–°è°ƒç”¨hashæ–¹æ³•ã€‚ ä½ äº†è§£é‡æ–°è°ƒæ•´HashMapå¤§å°å­˜åœ¨ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ å½“æ•°æ®è¿‡å¤šæ—¶ï¼Œå¾ˆå¯èƒ½å‡ºç°æ€§èƒ½ä¸‹é™ï¼ˆåŒ…æ‹¬rehashæ—¶é—´ï¼‰ å¤šçº¿ç¨‹æƒ…å†µä¸‹å¯èƒ½äº§ç”Ÿæ¡ä»¶ç«äº‰ç«äº‰ä»è€Œé€ æˆæ­»å¾ªç¯ï¼ˆå…·ä½“è¡¨ç°åœ¨CPUæ¥è¿‘100ï¼…)ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ¨èä½¿ç”¨ConcurrentHashMap ä¸ºä»€ä¹ˆä½¿ç”¨Stringï¼ŒIntergerè¿™æ ·çš„wrapperç±»é€‚åˆä½œä¸ºé”®ï¼Ÿ å› ä¸ºè¿™ç§ç±»å…·æœ‰finalå±æ€§ï¼Œå¯ä»¥ä¿è¯çº¿ç¨‹çš„ç›¸å¯¹å®‰å…¨ï¼Œä¹Ÿå¯ä»¥å‡å°‘ç¢°æ’ [è‡ªåŠ¨è£…ç®±ï¼Œè‡ªåŠ¨æ‹†ç®±çš„çŸ¥è¯†ç‚¹ï¼ï¼] å¯ä»¥åŒæ—¶é‡å»ºequals()å’ŒhashCode()æ–¹æ³•ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„å¯¹è±¡ä½œä¸ºé”®å—ï¼Ÿ å½“ç„¶ä½ å¯èƒ½ä½¿ç”¨ä»»ä½•å¯¹è±¡ä½œä¸ºé”®ï¼Œåªè¦å®ƒéµå®ˆäº†equalsï¼ˆï¼‰å’ŒhashCodeï¼ˆï¼‰æ–¹æ³•çš„å®šä¹‰è§„åˆ™ï¼Œå¹¶ä¸”å½“å¯¹è±¡æ’å…¥åˆ°Mapä¸­ä¹‹åå°†ä¸ä¼šå†æ”¹å˜äº†ã€‚è‡ªå®šä¹‰å¯¹è±¡æ—¶ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå®ƒå·²ç»æ»¡è¶³äº†ä½œä¸ºé”®çš„æ¡ä»¶ï¼Œå› ä¸ºå½“å®ƒåˆ›å»ºä¹‹åå°±å·²ç»ä¸èƒ½æ”¹å˜äº†ã€‚ å¦‚ä½•å¯¹HashMapè¿›è¡Œæ’åºï¼Ÿ å­˜å…¥LinkedHashMap HashMapçš„åˆ é™¤é™·é˜±ï¼Ÿ é€šè¿‡Iteratoræ–¹å¼å¯æ­£ç¡®éå†å®Œæˆåˆ é™¤æ“ä½œ ç›´æ¥è°ƒç”¨listçš„removeæ–¹æ³•å°±ä¼šæŠ›å¼‚å¸¸ ä¸ºä»€ä¹ˆåªå…è®¸é€šè¿‡iteratorè¿›è¡Œåˆ é™¤æ“ä½œï¼Ÿ HashMapå’ŒkeySetçš„åˆ é™¤æ–¹æ³•éƒ½å¯ä»¥é€šè¿‡ä¼ é€’keyå‚æ•°åˆ é™¤ä»»æ„çš„å…ƒç´  è€Œiteratoråªèƒ½åˆ é™¤å½“å‰å…ƒç´ ï¼ˆå½“å‰ï¼‰ï¼Œä¸€æ—¦åˆ é™¤çš„å…ƒç´ æ˜¯iteratorå¯¹è±¡ä¸­ä¸‹ä¸€ä¸ªæ­£åœ¨å¼•ç”¨çš„ï¼Œå¦‚æœæ²¡æœ‰é€šè¿‡modCountï¼ŒexpectedModCountçš„æ¯”è¾ƒå®ç°å¿«é€Ÿå¤±è´¥å¼‚å¸¸ï¼Œåˆ™ä¸‹ä¸€å¾ªç¯è¯¥å…ƒç´ å°†æˆä¸ºå½“å‰æŒ‡å‘ï¼Œæ­¤æ—¶iteratorå°±éå†äº†ä¸€ä¸ªå·²ç§»é™¤çš„è¿‡æœŸæ•°æ® ä¹‹æ‰€ä»¥æ¨èè¿­ä»£å™¨removeçš„æ ¹æœ¬åŸå› åœ¨äºåªæœ‰è¿­ä»£å™¨çš„removeæ–¹æ³•ä¸­å®ç°äº†å˜æ›´æ—¶äºmodCountçš„åŒæ­¥å·¥ä½œexpectedModCount = modCount; å¦‚æœæ˜¯éå†è¿‡ç¨‹ä¸­å¢åŠ æˆ–ä¿®æ”¹æ•°æ®å‘¢ï¼Ÿ å¢åŠ æˆ–ä¿®æ”¹æ•°æ®åªèƒ½é€šè¿‡Mapçš„putæ–¹æ³•å®ç°ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­ä¿®æ”¹æ•°æ®å¯ä»¥ï¼Œä½†å¦‚æœå¢åŠ æ–°å¯†é’¥å°±ä¼šåœ¨ä¸‹æ¬¡å¾ªç¯æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºåœ¨æ·»åŠ æ–°å¯†é’¥æ—¶modCountä¹Ÿä¼šè‡ªå¢ï¼ˆè¿­ä»£å™¨åªå®ç°äº†åˆ é™¤æ–¹æ³•ä¹Ÿæ˜¯åŸå› ä¹‹ä¸€ï¼‰ hashmapä¸ºä»€ä¹ˆåˆå§‹é•¿åº¦ä¸º16ï¼Ÿ é¦–å…ˆè¦ä¸º2çš„å¹‚æ¬¡ã€‚è¿™æ˜¯å› ä¸ºï¼Œhashmapè®¡ç®—keyçš„hashå€¼è¿›è¡Œå­˜å‚¨çš„æ—¶å€™é‡‡ç”¨çš„æ–¹æ³•æ˜¯ â€œç”¨keyçš„hashå€¼å’Œhashmapçš„é•¿åº¦å‡ä¸€ï¼ˆlength-1ï¼‰æŒ‰ä½ä¸ï¼ˆ&amp;ï¼‰ï¼Œ2çš„å¹‚æ¬¡å‡ä¸€çš„äºŒè¿›åˆ¶æ˜¯111â€¦â€¦ï¼Œä»»ä½•æ•°å’Œ1ä¸å°±æ˜¯ä»–æœ¬èº«ï¼Œè¿™æ ·å­˜å‚¨è¿›æ¥çš„hashä½ç½®å°±å–å†³äºkeyçš„äºŒè¿›åˆ¶å€¼äº†ï¼Œè¿™æ ·ä¼šè®©hashåˆ†å¸ƒç›¸å¯¹åˆ†æ•£ã€‚æå‡æ€§èƒ½ã€‚ HashMapä¸­çš„æ‰°åŠ¨å‡½æ•°æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆä½œç”¨ï¼ŒTreeMapä¸­æœ‰å—ï¼Ÿ å°±æ˜¯è¿”å› hashCodeçš„é«˜16ä½å’Œä½16ä½ç›¸å¼‚æˆ–ç„¶åä¸ å®¹é‡-1 ç›¸ä¸çš„ç»“æœï¼Œè¿™æ ·çš„è¯åˆ†æ•£æ›´å‡åŒ€ï¼ŒTreeMapæ²¡æœ‰ã€‚ æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥å‡å°‘ç¢°æ’ï¼Ÿ æ‰°åŠ¨å‡½æ•°å¯ä»¥å‡å°‘ç¢°æ’ åŸç†æ˜¯å¦‚æœä¸¤ä¸ªä¸ç›¸ç­‰çš„å¯¹è±¡è¿”å›ä¸åŒçš„ hashcode çš„è¯ï¼Œé‚£ä¹ˆç¢°æ’çš„å‡ ç‡å°±ä¼šå°äº›ã€‚è¿™å°±æ„å‘³ç€å­˜é“¾è¡¨ç»“æ„å‡å°ï¼Œè¿™æ ·å–å€¼çš„è¯å°±ä¸ä¼šé¢‘ç¹è°ƒç”¨ equal æ–¹æ³•ï¼Œä»è€Œæé«˜ HashMap çš„æ€§èƒ½ï¼ˆæ‰°åŠ¨å³ Hash æ–¹æ³•å†…éƒ¨çš„ç®—æ³•å®ç°ï¼Œç›®çš„æ˜¯è®©ä¸åŒå¯¹è±¡è¿”å›ä¸åŒhashcodeï¼‰ã€‚ ä½¿ç”¨ä¸å¯å˜çš„ã€å£°æ˜ä½œ final å¯¹è±¡ï¼Œå¹¶ä¸”é‡‡ç”¨åˆé€‚çš„ equals() å’Œ hashCode() æ–¹æ³•ï¼Œå°†ä¼šå‡å°‘ç¢°æ’çš„å‘ç”Ÿ ä¸å¯å˜æ€§ä½¿å¾—èƒ½å¤Ÿç¼“å­˜ä¸åŒé”®çš„ hashcodeï¼Œè¿™å°†æé«˜æ•´ä¸ªè·å–å¯¹è±¡çš„é€Ÿåº¦ï¼Œä½¿ç”¨ Stringã€Integer è¿™æ ·çš„ wrapper ç±»ä½œä¸ºé”®æ˜¯éå¸¸å¥½çš„é€‰æ‹©ã€‚ HashMapä¸ºä½•å¯ä»¥æ’å…¥ç©ºå€¼ï¼Ÿä¸ºä»€ä¹ˆå®ƒæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Ÿ HashMapåœ¨putçš„æ—¶å€™ä¼šè°ƒç”¨hash()æ–¹æ³•æ¥è®¡ç®—keyçš„hashcodeå€¼ï¼Œå¯ä»¥ä»hashç®—æ³•ä¸­çœ‹å‡ºå½“key==nullæ—¶è¿”å›çš„å€¼ä¸º0ã€‚å› æ­¤keyä¸ºnullæ—¶ï¼Œhashç®—æ³•è¿”å›å€¼ä¸º0ï¼Œä¸ä¼šè°ƒç”¨keyçš„hashcodeæ–¹æ³•ã€‚è€ŒHashtableå­˜å…¥çš„valueä¸ºnullæ—¶ï¼ŒæŠ›å‡ºNullPointerExceptionå¼‚å¸¸ã€‚å¦‚æœvalueä¸ä¸ºnullï¼Œè€Œkeyä¸ºç©ºï¼Œåœ¨æ‰§è¡Œåˆ°int hash = key.hashCode()æ—¶åŒæ ·ä¼šæŠ›å‡ºNullPointerExceptionå¼‚å¸¸ã€‚ ä¸Šé¢è¯´åˆ°ï¼ŒHashMapä¼šè¿›è¡Œresizeæ“ä½œï¼Œåœ¨resizeæ“ä½œçš„æ—¶å€™ä¼šé€ æˆçº¿ç¨‹ä¸å®‰å…¨ã€‚ä¸‹é¢å°†ä¸¾ä¸¤ä¸ªå¯èƒ½å‡ºç°çº¿ç¨‹ä¸å®‰å…¨çš„åœ°æ–¹ã€‚ putçš„æ—¶å€™å¯¼è‡´çš„å¤šçº¿ç¨‹æ•°æ®ä¸ä¸€è‡´ã€‚ å¦å¤–ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜æ˜¯HashMapçš„getæ“ä½œå¯èƒ½å› ä¸ºresizeè€Œå¼•èµ·æ­»å¾ªç¯ï¼ˆcpu100%)ã€‚ å¯ä»¥ä½¿ç”¨ CocurrentHashMap æ¥ä»£æ›¿ Hashtable å—ï¼Ÿ æˆ‘ä»¬çŸ¥é“ Hashtable æ˜¯ synchronized çš„ï¼Œä½†æ˜¯ ConcurrentHashMap åŒæ­¥æ€§èƒ½æ›´å¥½ï¼Œå› ä¸ºå®ƒä»…ä»…æ ¹æ®åŒæ­¥çº§åˆ«å¯¹ map çš„ä¸€éƒ¨åˆ†è¿›è¡Œä¸Šé”ã€‚ ConcurrentHashMap å½“ç„¶å¯ä»¥ä»£æ›¿ HashTableï¼Œä½†æ˜¯ HashTable æä¾›æ›´å¼ºçš„çº¿ç¨‹å®‰å…¨æ€§ å®ƒä»¬éƒ½å¯ä»¥ç”¨äºå¤šçº¿ç¨‹çš„ç¯å¢ƒï¼Œä½†æ˜¯å½“ Hashtable çš„å¤§å°å¢åŠ åˆ°ä¸€å®šçš„æ—¶å€™ï¼Œæ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ï¼Œå› ä¸ºè¿­ä»£æ—¶éœ€è¦è¢«é”å®šå¾ˆé•¿çš„æ—¶é—´ã€‚ ç”±äº ConcurrentHashMap å¼•å…¥äº†åˆ†å‰²ï¼ˆsegmentationï¼‰ï¼Œä¸è®ºå®ƒå˜å¾—å¤šä¹ˆå¤§ï¼Œä»…ä»…éœ€è¦é”å®š Map çš„æŸä¸ªéƒ¨åˆ†ï¼Œå…¶å®ƒçš„çº¿ç¨‹ä¸éœ€è¦ç­‰åˆ°è¿­ä»£å®Œæˆæ‰èƒ½è®¿é—® Mapã€‚ ç®€è€Œè¨€ä¹‹ï¼Œåœ¨è¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼ŒConcurrentHashMap ä»…ä»…é”å®š Map çš„æŸä¸ªéƒ¨åˆ†ï¼Œè€Œ Hashtable åˆ™ä¼šé”å®šæ•´ä¸ª Mapã€‚ CocurrentHashMapï¼ˆJDK 1.8ï¼‰ CocurrentHashMap æŠ›å¼ƒäº†åŸæœ‰çš„ Segment åˆ†æ®µé”ï¼Œé‡‡ç”¨äº† CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚å…¶ä¸­çš„ val next éƒ½ç”¨äº† volatile ä¿®é¥°ï¼Œä¿è¯äº†å¯è§æ€§ã€‚ æœ€å¤§ç‰¹ç‚¹æ˜¯å¼•å…¥äº† CAS å€ŸåŠ© Unsafe æ¥å®ç° native codeã€‚CASæœ‰3ä¸ªæ“ä½œæ•°ï¼Œå†…å­˜å€¼ Vã€æ—§çš„é¢„æœŸå€¼ Aã€è¦ä¿®æ”¹çš„æ–°å€¼ Bã€‚å½“ä¸”ä»…å½“é¢„æœŸå€¼ A å’Œå†…å­˜å€¼ V ç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼Vä¿®æ”¹ä¸º Bï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšã€‚Unsafe å€ŸåŠ© CPU æŒ‡ä»¤ cmpxchg æ¥å®ç°ã€‚ CAS ä½¿ç”¨å®ä¾‹ å¯¹ sizeCtl çš„æ§åˆ¶éƒ½æ˜¯ç”¨ CAS æ¥å®ç°çš„ï¼š -1 ä»£è¡¨ table æ­£åœ¨åˆå§‹åŒ– N è¡¨ç¤ºæœ‰ -N-1 ä¸ªçº¿ç¨‹æ­£åœ¨è¿›è¡Œæ‰©å®¹æ“ä½œ å¦‚æœ table æœªåˆå§‹åŒ–ï¼Œè¡¨ç¤ºtableéœ€è¦åˆå§‹åŒ–çš„å¤§å° å¦‚æœ table åˆå§‹åŒ–å®Œæˆï¼Œè¡¨ç¤ºtableçš„å®¹é‡ï¼Œé»˜è®¤æ˜¯tableå¤§å°çš„0.75å€ï¼Œç”¨è¿™ä¸ªå…¬å¼ç®— 0.75ï¼ˆn â€“ (n &gt;&gt;&gt; 2)ï¼‰ CAS ä¼šå‡ºç°çš„é—®é¢˜ï¼šABA è§£å†³ï¼šå¯¹å˜é‡å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡ä¿®æ”¹ï¼Œç‰ˆæœ¬å·åŠ  1ï¼Œæ¯”è¾ƒçš„æ—¶å€™æ¯”è¾ƒç‰ˆæœ¬å·ã€‚ è´´ä¸€ä¸ªå¤ä¹ æ—¶å¯ä»¥çœ‹çš„é—®ç­” https://cloud.tencent.com/developer/article/1491634 TreeMap æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ¥åˆ†æä¸€æ³¢ TreeMap ï¼ï¼ï¼ å‚è€ƒTreeMap æºç åˆ†æ javaé›†åˆï¼ˆ6ï¼‰ï¼šTreeMapæºç åˆ†æï¼ˆjdk1.8ï¼‰ å¦‚ä½•å†³å®šä½¿ç”¨HashMap Or TreeMap é—®é¢˜å¼•å¯¼ å¦‚ä½•å†³å®šä½¿ç”¨ HashMap è¿˜æ˜¯ TreeMapï¼Ÿ TreeMapçš„ç‰¹ç‚¹ æ¦‚è¿° TreeMap åº•å±‚åŸºäºçº¢é»‘æ ‘å®ç° è¯¥é›†åˆæœ€é‡è¦çš„ç‰¹ç‚¹å°±æ˜¯å¯æ’åºï¼Œè¯¥æ˜ å°„æ ¹æ®å…¶é”®çš„è‡ªç„¶é¡ºåºè¿›è¡Œæ’åºï¼Œæˆ–è€…æ ¹æ®åˆ›å»ºæ˜ å°„æ—¶æä¾›çš„ Comparator è¿›è¡Œæ’åºï¼Œå…·ä½“å–å†³äºä½¿ç”¨çš„æ„é€ æ–¹æ³•ã€‚ ç”±ä¸Šå›¾å¯çŸ¥ï¼ŒTreeMap ç»§æ‰¿äº† AbstractMapï¼ŒåŒæ—¶å®ç°äº† NavigableMap (å¯¼èˆª map )ï¼Œè€Œ NavigableMap åˆ™æ˜¯ç»§æ‰¿äº† SortedMap ,è€Œ SortedMap å’Œ AbstractMap åˆ™æ˜¯å®ç°äº† Map æ¥å£ã€‚ NavigableMap æ¥å£ï¼ŒNavigableMap æ¥å£å£°æ˜äº†ä¸€äº›åˆ—å…·æœ‰å¯¼èˆªåŠŸèƒ½çš„æ–¹æ³•ï¼Œé€šè¿‡è¿™äº›å¯¼èˆªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿå®šä½åˆ°ç›®æ ‡çš„ key æˆ– Entryã€‚æ¯”å¦‚ï¼š 12345678910111213141516/** * è¿”å›çº¢é»‘æ ‘ä¸­æœ€å°é”®æ‰€å¯¹åº”çš„ Entry */Map.Entry&lt;K,V&gt; firstEntry();/** * è¿”å›æœ€å¤§çš„é”® maxKeyï¼Œä¸” maxKey ä»…å°äºå‚æ•° key */K lowerKey(K key);/** * è¿”å›æœ€å°çš„é”® minKeyï¼Œä¸” minKey ä»…å¤§äºå‚æ•° key */K higherKey(K key);// å…¶ä»–ç•¥ è‡³äº SortedMap æ¥å£ï¼Œè¿™ä¸ªæ¥å£æä¾›äº†ä¸€äº›åŸºäºæœ‰åºé”®çš„æ“ä½œï¼Œæ¯”å¦‚: 1234567891011/** * è¿”å›åŒ…å«é”®å€¼åœ¨ [minKey, toKey) èŒƒå›´å†…çš„ Map */SortedMap&lt;K,V&gt; headMap(K toKey);();/** * è¿”å›åŒ…å«é”®å€¼åœ¨ [fromKey, toKey) èŒƒå›´å†…çš„ Map */SortedMap&lt;K,V&gt; subMap(K fromKey, K toKey);// å…¶ä»–ç•¥ æºç åˆ†æJDK 1.8ä¸­çš„TreeMapæºç æœ‰ä¸¤åƒå¤šè¡Œï¼Œè¿˜æ˜¯æ¯”è¾ƒå¤šçš„ã€‚TreeMapå®ç°çš„æ ¸å¿ƒéƒ¨åˆ†æ˜¯å…³äºçº¢é»‘æ ‘çš„å®ç°ï¼Œå…¶ç»å¤§éƒ¨åˆ†çš„æ–¹æ³•åŸºæœ¬éƒ½æ˜¯å¯¹åº•å±‚çº¢é»‘æ ‘å¢ã€åˆ ã€æŸ¥æ“ä½œçš„ä¸€ä¸ªå°è£…ã€‚å¦‚ç®€ä»‹ä¸€èŠ‚æ‰€è¯´ï¼Œåªè¦å¼„æ‡‚äº†çº¢é»‘æ ‘åŸç†ï¼ŒTreeMap å°±æ²¡ä»€ä¹ˆç§˜å¯†äº†ã€‚å…³äºçº¢é»‘æ ‘çš„åŸç†ï¼Œè¯·å‚è€ƒæœ¬äººçš„å¦ä¸€ç¯‡æ–‡ç«  çº¢é»‘æ ‘è¯¦ç»†åˆ†æã€‚ ç±»ååŠç±»æˆå‘˜å˜é‡1234567891011121314151617181920212223242526public class TreeMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements NavigableMap&lt;K,V&gt;, Cloneable, java.io.Serializable&#123; // æ¯”è¾ƒå™¨å¯¹è±¡ private final Comparator&lt;? super K&gt; comparator; // æ ¹èŠ‚ç‚¹ private transient Entry&lt;K,V&gt; root; // é›†åˆå¤§å° private transient int size = 0; // æ ‘ç»“æ„è¢«ä¿®æ”¹çš„æ¬¡æ•° private transient int modCount = 0; // é™æ€å†…éƒ¨ç±»ç”¨æ¥è¡¨ç¤ºèŠ‚ç‚¹ç±»å‹ static final class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; K key; // é”® V value; // å€¼ Entry&lt;K,V&gt; left; // æŒ‡å‘å·¦å­æ ‘çš„å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰ Entry&lt;K,V&gt; right; // æŒ‡å‘å³å­æ ‘çš„å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰ Entry&lt;K,V&gt; parent; // æŒ‡å‘çˆ¶èŠ‚ç‚¹çš„å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰ boolean color = BLACK; // &#125;&#125; æ„é€ æ–¹æ³•123456789101112131415161718192021public TreeMap() &#123; // 1,æ— å‚æ„é€ æ–¹æ³• comparator = null; // é»˜è®¤æ¯”è¾ƒæœºåˆ¶&#125;public TreeMap(Comparator&lt;? super K&gt; comparator) &#123; // 2ï¼Œè‡ªå®šä¹‰æ¯”è¾ƒå™¨çš„æ„é€ æ–¹æ³• this.comparator = comparator;&#125;public TreeMap(Map&lt;? extends K, ? extends V&gt; m) &#123; // 3ï¼Œæ„é€ å·²çŸ¥Mapå¯¹è±¡ä¸ºTreeMap comparator = null; // é»˜è®¤æ¯”è¾ƒæœºåˆ¶ putAll(m);&#125;public TreeMap(SortedMap&lt;K, ? extends V&gt; m) &#123; // 4ï¼Œæ„é€ å·²çŸ¥çš„SortedMapå¯¹è±¡ä¸ºTreeMap comparator = m.comparator(); // ä½¿ç”¨å·²çŸ¥å¯¹è±¡çš„æ„é€ å™¨ try &#123; buildFromSorted(m.size(), m.entrySet().iterator(), null, null); &#125; catch (java.io.IOException cannotHappen) &#123; &#125; catch (ClassNotFoundException cannotHappen) &#123; &#125;&#125; æŸ¥æ‰¾TreeMapåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œè€Œçº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ‰€ä»¥ TreeMap çš„æŸ¥æ‰¾æ“ä½œæµç¨‹å’ŒäºŒå‰æŸ¥æ‰¾æ ‘ä¸€è‡´ã€‚äºŒå‰æ ‘çš„æŸ¥æ‰¾æµç¨‹æ˜¯è¿™æ ·çš„ï¼Œå…ˆå°†ç›®æ ‡å€¼å’Œæ ¹èŠ‚ç‚¹çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›®æ ‡å€¼å°äºæ ¹èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™å†å’Œæ ¹èŠ‚ç‚¹çš„å·¦å­©å­è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœç›®æ ‡å€¼å¤§äºæ ¹èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™ç»§ç»­å’Œæ ¹èŠ‚ç‚¹çš„å³å­©å­æ¯”è¾ƒã€‚åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­ï¼Œå¦‚æœç›®æ ‡å€¼å’ŒäºŒå‰æ ‘ä¸­çš„æŸä¸ªèŠ‚ç‚¹å€¼ç›¸ç­‰ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚TreeMap æŸ¥æ‰¾å’Œæ­¤ç±»ä¼¼ï¼Œåªä¸è¿‡åœ¨ TreeMap ä¸­ï¼ŒèŠ‚ç‚¹ï¼ˆEntryï¼‰å­˜å‚¨çš„æ˜¯é”®å€¼å¯¹ã€‚åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­ï¼Œæ¯”è¾ƒçš„æ˜¯é”®çš„å¤§å°ï¼Œè¿”å›çš„æ˜¯å€¼ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™è¿”å›nullã€‚TreeMap ä¸­çš„æŸ¥æ‰¾æ–¹æ³•æ˜¯getï¼Œå…·ä½“å®ç°åœ¨getEntryæ–¹æ³•ä¸­ï¼Œç›¸å…³æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728public V get(Object key) &#123; Entry&lt;K,V&gt; p = getEntry(key); return (p==null ? null : p.value);&#125;final Entry&lt;K,V&gt; getEntry(Object key) &#123; // Offload comparator-based version for sake of performance if (comparator != null) return getEntryUsingComparator(key); if (key == null) throw new NullPointerException(); @SuppressWarnings("unchecked") Comparable&lt;? super K&gt; k = (Comparable&lt;? super K&gt;) key; Entry&lt;K,V&gt; p = root; // æŸ¥æ‰¾æ“ä½œçš„æ ¸å¿ƒé€»è¾‘å°±åœ¨è¿™ä¸ª while å¾ªç¯é‡Œ // key ä¸ root ä½œæ¯”è¾ƒ while (p != null) &#123; int cmp = k.compareTo(p.key); if (cmp &lt; 0) p = p.left; else if (cmp &gt; 0) p = p.right; else return p; &#125; return null;&#125; éå† Iterator é¡ºåºéå† 12345678TreeMap map = new TreeMap();Set set = map.entrySet();Iterator iter = set.iterator();while(iter.hasNext())&#123; Map.Entry entry = (Map.Entry) iter.next(); Object key = entry.getKey(); Object value = entry.getValue();&#125; foreach éå† 1234567891011//éå†Map ç¬¬äºŒç§æ–¹å¼Map&lt;String, Integer&gt; map1 = new TreeMap&lt;&gt;();map1.put("jack", 20);map1.put("rose", 18);map1.put("lucy", 17);map1.put("java", 25);//é€šè¿‡Map.Entry(String,Integer) è·å–ï¼Œç„¶åä½¿ç”¨entry.getKey()è·å–åˆ°é”®ï¼Œé€šè¿‡entry.getValue()è·å–åˆ°å€¼for(Map.Entry&lt;String, Integer&gt; entry : map1.entrySet())&#123; System.out.println("é”® key ï¼š"+entry.getKey()+" å€¼value ï¼š"+entry.getValue());&#125; ä»ä¸Šé¢ä»£ç ç‰‡æ®µä¸­å¯ä»¥çœ‹å‡ºï¼Œå¤§å®¶ä¸€èˆ¬éƒ½æ˜¯å¯¹ TreeMap çš„ key é›†åˆæˆ– Entry é›†åˆè¿›è¡Œéå†ã€‚ä¸Šé¢ä»£ç ç‰‡æ®µä¸­ç”¨ foreach éå† entrySet æ–¹æ³•äº§ç”Ÿçš„é›†åˆï¼Œåœ¨ç¼–è¯‘æ—¶ä¼šè½¬æ¢æˆç”¨è¿­ä»£å™¨éå†ï¼Œç­‰ä»·äºï¼š 1234567Set entry = map.entrySet();Iterator ite = entry.iterator();while (ite.hasNext()) &#123; Map.Entry entry = (Map.Entry) iter.next(); Object key = entry.getKey(); // do something&#125; å¦ä¸€æ–¹é¢ï¼ŒTreeMap æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå³å¯ä»¥ä¿è¯é”®çš„æœ‰åºæ€§ï¼Œé»˜è®¤æ˜¯æ­£åºã€‚æ‰€ä»¥åœ¨éå†è¿‡ç¨‹ä¸­ï¼Œå¤§å®¶ä¼šå‘ç° TreeMap ä¼šä»å°åˆ°å¤§è¾“å‡ºé”®çš„å€¼ã€‚é‚£ä¹ˆï¼Œæ¥ä¸‹æ¥å°±æ¥åˆ†æä¸€ä¸‹keySetæ–¹æ³•ï¼Œä»¥åŠåœ¨éå† keySet æ–¹æ³•äº§ç”Ÿçš„é›†åˆæ—¶ï¼ŒTreeMap æ˜¯å¦‚ä½•ä¿è¯é”®çš„æœ‰åºæ€§çš„ã€‚ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586public Set&lt;K&gt; keySet() &#123; return navigableKeySet();&#125;public NavigableSet&lt;K&gt; navigableKeySet() &#123; KeySet&lt;K&gt; nks = navigableKeySet; return (nks != null) ? nks : (navigableKeySet = new KeySet&lt;&gt;(this));&#125;static final class KeySet&lt;E&gt; extends AbstractSet&lt;E&gt; implements NavigableSet&lt;E&gt; &#123; private final NavigableMap&lt;E, ?&gt; m; KeySet(NavigableMap&lt;E,?&gt; map) &#123; m = map; &#125; public Iterator&lt;E&gt; iterator() &#123; if (m instanceof TreeMap) return ((TreeMap&lt;E,?&gt;)m).keyIterator(); else return ((TreeMap.NavigableSubMap&lt;E,?&gt;)m).keyIterator(); &#125; // çœç•¥éå…³é”®ä»£ç &#125;Iterator&lt;K&gt; keyIterator() &#123; return new KeyIterator(getFirstEntry());&#125;final class KeyIterator extends PrivateEntryIterator&lt;K&gt; &#123; KeyIterator(Entry&lt;K,V&gt; first) &#123; super(first); &#125; public K next() &#123; return nextEntry().key; &#125;&#125;abstract class PrivateEntryIterator&lt;T&gt; implements Iterator&lt;T&gt; &#123; Entry&lt;K,V&gt; next; Entry&lt;K,V&gt; lastReturned; int expectedModCount; PrivateEntryIterator(Entry&lt;K,V&gt; first) &#123; expectedModCount = modCount; lastReturned = null; next = first; &#125; public final boolean hasNext() &#123; return next != null; &#125; final Entry&lt;K,V&gt; nextEntry() &#123; Entry&lt;K,V&gt; e = next; if (e == null) throw new NoSuchElementException(); if (modCount != expectedModCount) throw new ConcurrentModificationException(); // å¯»æ‰¾èŠ‚ç‚¹ e çš„åç»§èŠ‚ç‚¹ next = successor(e); lastReturned = e; return e; &#125; /** * Returns the successor of the specified Entry, or null if no such. */ static &lt;K,V&gt; TreeMap.Entry&lt;K,V&gt; successor(Entry&lt;K,V&gt; t) &#123; if (t == null) return null; else if (t.right != null) &#123; Entry&lt;K,V&gt; p = t.right; while (p.left != null) p = p.left; return p; &#125; else &#123; Entry&lt;K,V&gt; p = t.parent; Entry&lt;K,V&gt; ch = t; while (p != null &amp;&amp; ch == p.right) &#123; ch = p; p = p.parent; &#125; return p; &#125; &#125; // å…¶ä»–æ–¹æ³•çœç•¥&#125; ä¸Šé¢çš„ä»£ç æ¯”è¾ƒå¤šï¼ŒkeySet æ¶‰åŠçš„ä»£ç è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œå¤§å®¶å¯ä»¥ä»ä¸Šå¾€ä¸‹çœ‹ã€‚ä»ä¸Šé¢æºç å¯ä»¥çœ‹å‡º keySet æ–¹æ³•è¿”å›çš„æ˜¯KeySetç±»çš„å¯¹è±¡ã€‚è¿™ä¸ªç±»å®ç°äº†Iterableæ¥å£ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚è¯¥è¿­ä»£å™¨çš„å…·ä½“å®ç°æ˜¯KeyIteratorï¼Œè€Œ KeyIterator ç±»çš„æ ¸å¿ƒé€»è¾‘æ˜¯åœ¨PrivateEntryIteratorä¸­å®ç°çš„ã€‚ä¸Šé¢çš„ä»£ç è™½å¤šï¼Œä½†æ ¸å¿ƒä»£ç è¿˜æ˜¯ KeySet ç±»å’Œ PrivateEntryIterator ç±»çš„ nextEntryæ–¹æ³•ã€‚KeySet ç±»å°±æ˜¯ä¸€ä¸ªé›†åˆï¼Œè¿™é‡Œä¸åˆ†æäº†ã€‚è€Œ nextEntry æ–¹æ³•æ¯”è¾ƒé‡è¦ï¼Œä¸‹é¢ç®€å•åˆ†æä¸€ä¸‹ã€‚ åœ¨åˆå§‹åŒ– KeyIterator æ—¶ï¼Œä¼šå°† TreeMap ä¸­åŒ…å«æœ€å°é”®çš„ Entry ä¼ ç»™ PrivateEntryIteratorã€‚å½“è°ƒç”¨ nextEntry æ–¹æ³•æ—¶ï¼Œé€šè¿‡è°ƒç”¨ successor æ–¹æ³•æ‰¾åˆ°å½“å‰ entry çš„åç»§ï¼Œå¹¶è®© next æŒ‡å‘åç»§ï¼Œæœ€åè¿”å›å½“å‰çš„ entryã€‚é€šè¿‡è¿™ç§æ–¹å¼å³å¯å®ç°æŒ‰æ­£åºè¿”å›é”®å€¼çš„çš„é€»è¾‘ã€‚ æ’å…¥ä¸åˆ é™¤å…¶å®å°±æ˜¯çº¢é»‘æ ‘çš„æ’å…¥å’Œåˆ é™¤ï¼Œå…·ä½“çº¢é»‘æ ‘çš„æ’å…¥å’Œåˆ é™¤è§æˆ‘å¦å†™çš„çº¢é»‘æ ‘æ–‡ç« ã€‚ æ’å…¥ 1234567891011121314151617181920212223242526272829303132333435363738394041public V put(K key, V value) &#123; Entry&lt;K,V&gt; t = root; // 1.å¦‚æœæ ¹èŠ‚ç‚¹ä¸º nullï¼Œå°†æ–°èŠ‚ç‚¹è®¾ä¸ºæ ¹èŠ‚ç‚¹ if (t == null) &#123; compare(key, key); root = new Entry&lt;&gt;(key, value, null); size = 1; modCount++; return null; &#125; int cmp; Entry&lt;K,V&gt; parent; // split comparator and comparable paths Comparator&lt;? super K&gt; cpr = comparator; if (cpr != null) &#123; // 2.ä¸º key åœ¨çº¢é»‘æ ‘æ‰¾åˆ°åˆé€‚çš„ä½ç½® do &#123; parent = t; cmp = cpr.compare(key, t.key); if (cmp &lt; 0) t = t.left; else if (cmp &gt; 0) t = t.right; else return t.setValue(value); &#125; while (t != null); &#125; else &#123; // ä¸ä¸Šé¢ä»£ç é€»è¾‘ç±»ä¼¼ï¼Œçœç•¥ &#125; Entry&lt;K,V&gt; e = new Entry&lt;&gt;(key, value, parent); // 3.å°†æ–°èŠ‚ç‚¹é“¾å…¥çº¢é»‘æ ‘ä¸­ if (cmp &lt; 0) parent.left = e; else parent.right = e; // 4.æ’å…¥æ–°èŠ‚ç‚¹å¯èƒ½ä¼šç ´åçº¢é»‘æ ‘æ€§è´¨ï¼Œè¿™é‡Œä¿®æ­£ä¸€ä¸‹ fixAfterInsertion(e); size++; modCount++; return null;&#125; put æ–¹æ³•ä»£ç å¦‚ä¸Šï¼Œé€»è¾‘å’ŒäºŒå‰æŸ¥æ‰¾æ ‘æ’å…¥èŠ‚ç‚¹é€»è¾‘ä¸€è‡´ã€‚é‡è¦çš„æ­¥éª¤æˆ‘å·²ç»å†™äº†æ³¨é‡Šï¼Œå¹¶ä¸éš¾ç†è§£ã€‚æ’å…¥é€»è¾‘çš„å¤æ‚ä¹‹å¤„åœ¨äºæ’å…¥åçš„ä¿®å¤æ“ä½œï¼Œå¯¹åº”çš„æ–¹æ³•fixAfterInsertionï¼Œè¯¥æ–¹æ³•çš„æºç å’Œè¯´æ˜å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041/** From CLR */ private void fixAfterInsertion(Entry&lt;K,V&gt; x) &#123; x.color = RED; while (x != null &amp;&amp; x != root &amp;&amp; x.parent.color == RED) &#123; if (parentOf(x) == leftOf(parentOf(parentOf(x)))) &#123; Entry&lt;K,V&gt; y = rightOf(parentOf(parentOf(x))); if (colorOf(y) == RED) &#123; setColor(parentOf(x), BLACK); setColor(y, BLACK); setColor(parentOf(parentOf(x)), RED); x = parentOf(parentOf(x)); &#125; else &#123; if (x == rightOf(parentOf(x))) &#123; x = parentOf(x); rotateLeft(x); &#125; setColor(parentOf(x), BLACK); setColor(parentOf(parentOf(x)), RED); rotateRight(parentOf(parentOf(x))); &#125; &#125; else &#123; Entry&lt;K,V&gt; y = leftOf(parentOf(parentOf(x))); if (colorOf(y) == RED) &#123; setColor(parentOf(x), BLACK); setColor(y, BLACK); setColor(parentOf(parentOf(x)), RED); x = parentOf(parentOf(x)); &#125; else &#123; if (x == leftOf(parentOf(x))) &#123; x = parentOf(x); rotateRight(x); &#125; setColor(parentOf(x), BLACK); setColor(parentOf(parentOf(x)), RED); rotateLeft(parentOf(parentOf(x))); &#125; &#125; &#125; root.color = BLACK; &#125; åˆ é™¤ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364public V remove(Object key) &#123; Entry&lt;K,V&gt; p = getEntry(key); if (p == null) return null; V oldValue = p.value; deleteEntry(p); return oldValue;&#125;private void deleteEntry(Entry&lt;K,V&gt; p) &#123; modCount++; size--; /* * 1. å¦‚æœ p æœ‰ä¸¤ä¸ªå­©å­èŠ‚ç‚¹ï¼Œåˆ™æ‰¾åˆ°åç»§èŠ‚ç‚¹ï¼Œ * å¹¶æŠŠåç»§èŠ‚ç‚¹çš„å€¼å¤åˆ¶åˆ°èŠ‚ç‚¹ P ä¸­ï¼Œå¹¶è®© p æŒ‡å‘å…¶åç»§èŠ‚ç‚¹ */ if (p.left != null &amp;&amp; p.right != null) &#123; Entry&lt;K,V&gt; s = successor(p); p.key = s.key; p.value = s.value; p = s; &#125; // p has 2 children // Start fixup at replacement node, if it exists. Entry&lt;K,V&gt; replacement = (p.left != null ? p.left : p.right); if (replacement != null) &#123; /* * 2. å°† replacement parent å¼•ç”¨æŒ‡å‘æ–°çš„çˆ¶èŠ‚ç‚¹ï¼Œ * åŒæ—¶è®©æ–°çš„çˆ¶èŠ‚ç‚¹æŒ‡å‘ replacementã€‚ */ replacement.parent = p.parent; if (p.parent == null) root = replacement; else if (p == p.parent.left) p.parent.left = replacement; else p.parent.right = replacement; // Null out links so they are OK to use by fixAfterDeletion. p.left = p.right = p.parent = null; // 3. å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹ p æ˜¯é»‘è‰²èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦è¿›è¡Œè°ƒæ•´ if (p.color == BLACK) fixAfterDeletion(replacement); &#125; else if (p.parent == null) &#123; // åˆ é™¤çš„æ˜¯æ ¹èŠ‚ç‚¹ï¼Œä¸”æ ‘ä¸­å½“å‰åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ root = null; &#125; else &#123; // åˆ é™¤çš„èŠ‚ç‚¹æ²¡æœ‰å­©å­èŠ‚ç‚¹ // p æ˜¯é»‘è‰²ï¼Œåˆ™éœ€è¦è¿›è¡Œè°ƒæ•´ if (p.color == BLACK) fixAfterDeletion(p); // å°† P ä»æ ‘ä¸­ç§»é™¤ if (p.parent != null) &#123; if (p == p.parent.left) p.parent.left = null; else if (p == p.parent.right) p.parent.right = null; p.parent = null; &#125; &#125;&#125; ä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œremoveæ–¹æ³•åªæ˜¯ä¸€ä¸ªç®€å•çš„ä¿è¯ï¼Œæ ¸å¿ƒå®ç°åœ¨deleteEntryæ–¹æ³•ä¸­ã€‚deleteEntry ä¸»è¦åšäº†è¿™ä¹ˆå‡ ä»¶äº‹ï¼š å¦‚æœå¾…åˆ é™¤èŠ‚ç‚¹ P æœ‰ä¸¤ä¸ªå­©å­ï¼Œåˆ™å…ˆæ‰¾åˆ° P çš„åç»§ Sï¼Œç„¶åå°† S ä¸­çš„å€¼æ‹·è´åˆ° P ä¸­ï¼Œå¹¶è®© P æŒ‡å‘ S å¦‚æœæœ€ç»ˆè¢«åˆ é™¤èŠ‚ç‚¹ Pï¼ˆP ç°åœ¨æŒ‡å‘æœ€ç»ˆè¢«åˆ é™¤èŠ‚ç‚¹ï¼‰çš„å­©å­ä¸ä¸ºç©ºï¼Œåˆ™ç”¨å…¶å­©å­èŠ‚ç‚¹æ›¿æ¢æ‰ å¦‚æœæœ€ç»ˆè¢«åˆ é™¤çš„èŠ‚ç‚¹æ˜¯é»‘è‰²çš„è¯ï¼Œè°ƒç”¨ fixAfterDeletion æ–¹æ³•è¿›è¡Œä¿®å¤ ä¸Šé¢è¯´äº† replacement ä¸ä¸ºç©ºæ—¶ï¼ŒdeleteEntry çš„æ‰§è¡Œé€»è¾‘ã€‚ä¸Šé¢è¯´çš„ç•¥å¾®å•°å—¦ï¼Œå¦‚æœç®€å•è¯´çš„è¯ï¼Œ7ä¸ªå­—å³å¯æ€»ç»“ï¼šæ‰¾åç»§ -&gt; æ›¿æ¢ -&gt; ä¿®å¤ã€‚è¿™ä¸‰æ­¥ä¸­ï¼Œæœ€å¤æ‚çš„æ˜¯ä¿®å¤æ“ä½œã€‚ä¿®å¤æ“ä½œè¦é‡æ–°ä½¿çº¢é»‘æ ‘æ¢å¤å¹³è¡¡ï¼Œä¿®å¤æ“ä½œçš„æºç åˆ†æå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162/** From CLR */ private void fixAfterDeletion(Entry&lt;K,V&gt; x) &#123; while (x != root &amp;&amp; colorOf(x) == BLACK) &#123; if (x == leftOf(parentOf(x))) &#123; Entry&lt;K,V&gt; sib = rightOf(parentOf(x)); if (colorOf(sib) == RED) &#123; setColor(sib, BLACK); setColor(parentOf(x), RED); rotateLeft(parentOf(x)); sib = rightOf(parentOf(x)); &#125; if (colorOf(leftOf(sib)) == BLACK &amp;&amp; colorOf(rightOf(sib)) == BLACK) &#123; setColor(sib, RED); x = parentOf(x); &#125; else &#123; if (colorOf(rightOf(sib)) == BLACK) &#123; setColor(leftOf(sib), BLACK); setColor(sib, RED); rotateRight(sib); sib = rightOf(parentOf(x)); &#125; setColor(sib, colorOf(parentOf(x))); setColor(parentOf(x), BLACK); setColor(rightOf(sib), BLACK); rotateLeft(parentOf(x)); x = root; &#125; &#125; else &#123; // symmetric Entry&lt;K,V&gt; sib = leftOf(parentOf(x)); if (colorOf(sib) == RED) &#123; setColor(sib, BLACK); setColor(parentOf(x), RED); rotateRight(parentOf(x)); sib = leftOf(parentOf(x)); &#125; if (colorOf(rightOf(sib)) == BLACK &amp;&amp; colorOf(leftOf(sib)) == BLACK) &#123; setColor(sib, RED); x = parentOf(x); &#125; else &#123; if (colorOf(leftOf(sib)) == BLACK) &#123; setColor(rightOf(sib), BLACK); setColor(sib, RED); rotateLeft(sib); sib = leftOf(parentOf(x)); &#125; setColor(sib, colorOf(parentOf(x))); setColor(parentOf(x), BLACK); setColor(leftOf(sib), BLACK); rotateRight(parentOf(x)); x = root; &#125; &#125; &#125; setColor(x, BLACK); &#125; è‡ªå®šä¹‰æ¯”è¾ƒå™¨ åœ¨å®ä½“ç±»å¯¹è±¡ä¸­å®ç°Comparableæ¥å£å¹¶å®ç°äº†compareTo()æ–¹æ³•ã€Stringï¼ŒIntegerå¯¹è±¡å°±æ˜¯æ­¤ç§æ–¹å¼ã€‘ 12345678910111213141516171819202122232425262728293031323334353637class TreeMap2_Comparable &#123; public static void main(String[] args) &#123; Map&lt;User, String&gt; map = new TreeMap&lt;&gt;(); map.put(new User("jerome", 30), "hello"); map.put(new User("memory", 30), "hello"); map.put(new User("aa", 22), "hello"); map.put(new User("bb", 20), "hello"); for (Map.Entry&lt;User, String&gt; each : map.entrySet()) &#123; System.out.println(each.getKey()+"::"+each.getValue()); &#125; &#125;&#125;class User implements Comparable&lt;User&gt;&#123; private String username; private int age; public User(String username, int age) &#123; this.username = username; this.age = age; &#125; @Override public String toString() &#123; return "User [username=" + username + ", age=" + age + "]"; &#125; @Override public int compareTo(User user) &#123; // å…ˆæ¯”è¾ƒ age ï¼Œå†æ¯”è¾ƒ username int temp = this.age - user.age; return temp == 0 ? this.username.compareTo(user.username) : temp; &#125;&#125; è¾“å‡ºï¼š 12345&gt; User [username=bb, age=20]::hello&gt; User [username=aa, age=22]::hello&gt; User [username=jerome, age=30]::hello&gt; User [username=memory, age=30]::hello&gt; å†™ä¸€ä¸ªç±»å®ç°java.util.Comparatoræ¥å£(æ³¨æ„è¿™é‡Œæ˜¯Comparatorï¼Œä¸Šé¢æ˜¯Comparable)ï¼Œå¹¶å°†è¯¥ç±»å¯¹è±¡ä¼ é€’ç»™TreeMapçš„æ„é€ æ–¹æ³•ã€‚è¿™ç§æ–¹å¼å°†å®ä½“ç±»å’Œæ¯”è¾ƒæœºåˆ¶è§£è€¦åˆï¼Œå¯ä»¥å†™å¾ˆå¤šä¸ªä¸åŒçš„æ¯”è¾ƒå™¨å¯¹è±¡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152class TreeMap2_Comparator&#123; public static void main(String[] args) &#123; Map&lt;User2, String&gt; map = new TreeMap&lt;&gt;(new TreeMapComparator()); map.put(new User2("jerome", 30), "hello"); map.put(new User2("memory", 30), "hello"); map.put(new User2("aa", 22), "hello"); map.put(new User2("bb", 20), "hello"); for (Map.Entry&lt;User2, String&gt; each : map.entrySet()) &#123; System.out.println(each.getKey()+"::"+each.getValue()); &#125; &#125;&#125;class User2 &#123; // Userå¯¹è±¡ä¸å†å®ç°ä»»ä½•æ¥å£ private String username; private int age; public User2(String username, int age) &#123; super(); this.username = username; this.age = age; &#125; public String getUsername() &#123; return username; &#125; public void setUsername(String username) &#123; this.username = username; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; @Override public String toString() &#123; return "User2 [username=" + username + ", age=" + age + "]"; &#125;&#125;class TreeMapComparator implements Comparator&lt;User2&gt; &#123; // æ¯”è¾ƒå™¨ç±» @Override public int compare(User2 o1, User2 o2) &#123; int temp = o1.getAge() - o2.getAge(); return temp == 0 ? o1.getUsername().compareTo(o2.getUsername()) : temp; &#125;&#125; è¾“å‡ºåŒä¸Š ä¸å†™æ¯”è¾ƒå™¨ç±»ï¼Œè€Œæ˜¯ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»çš„å½¢å¼æ¥å†™æ¯”è¾ƒå™¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748class TreeMap2_InnerComparator &#123; public static void main(String[] args) &#123; Map&lt;User3, String&gt; map = new TreeMap&lt;&gt;(new Comparator&lt;User3&gt;() &#123; @Override public int compare(User3 o1, User3 o2) &#123; int temp = o1.getAge() - o2.getAge(); return temp == 0 ? o1.getUsername().compareTo(o2.getUsername()) : temp; &#125; &#125;); map.put(new User3("jimmy1", 30), "hello"); map.put(new User3("jimmy2", 30), "hello"); map.put(new User3("jimmy", 22), "hello"); map.put(new User3("jimmy", 20), "hello"); for (Map.Entry&lt;User3, String&gt; each : map.entrySet()) &#123; System.out.println(each.getKey() + "::" + each.getValue()); &#125; &#125;&#125;class User3 &#123; // Userå¯¹è±¡ä¸å†å®ç°ä»»ä½•æ¥å£ private String username; private int age; public User3(String username, int age) &#123; super(); this.username = username; this.age = age; &#125; public String getUsername() &#123; return username; &#125; public void setUsername(String username) &#123; this.username = username; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; @Override public String toString() &#123; return "User3 [username=" + username + ", age=" + age + "]"; &#125;&#125; é¢è¯•ç›¸å…³é¢˜ç›® HashMap å’Œ TreeMap æœ‰è¿­ä»£å™¨å—ï¼Ÿ keySet()å’ŒentrySet()æ–¹æ³•ï¼Œåœ¨å°†HashMapçš„æ—¶å€™å·²ç»è®²è¿‡äº†ï¼ŒMapæ²¡æœ‰è¿­ä»£å™¨ï¼Œè¦å°†Mapè½¬åŒ–ä¸ºSetï¼Œç”¨Setçš„è¿­ä»£å™¨æ‰èƒ½è¿›è¡Œå…ƒç´ è¿­ä»£ã€‚ å¦‚ä½•å†³å®šä½¿ç”¨ HashMap è¿˜æ˜¯ TreeMapï¼Ÿ éƒ½æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœä½ éœ€è¦å¾—åˆ°ä¸€ä¸ªæœ‰åºçš„ç»“æœæ—¶å°±åº”è¯¥ä½¿ç”¨TreeMapï¼ˆå› ä¸ºHashMapä¸­å…ƒç´ çš„æ’åˆ—é¡ºåºæ˜¯ä¸å›ºå®šçš„ï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”±äºHashMapæœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œæ•…å¤§å¤šä¸éœ€è¦æ’åºçš„æ—¶å€™æˆ‘ä»¬ä¼šä½¿ç”¨HashMapã€‚ TreeMapçš„ç‰¹ç‚¹ï¼Ÿ éçº¿ç¨‹å®‰å…¨ï¼Œå¯æ’åºï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¸å…è®¸é‡å¤(é»˜è®¤æ²¡æœ‰é‡å†™æ¯”è¾ƒå™¨)ï¼Œåº•å±‚é‡‡ç”¨çš„æ˜¯çº¢é»‘æ ‘ã€‚å› ä¸ºå…¶éçº¿ç¨‹å®‰å…¨ï¼Œæ•…å¯ä»¥å…è®¸nullå€¼ï¼Œè¿™ä¸ªè·ŸHashMapã€ArrayListã€LinkedListæ˜¯ä¸€æ ·çš„ã€‚ Map çš„ key å€¼éƒ½æ˜¯ä¸å¯ä»¥é‡å¤çš„ï¼Œæ•… Set ä¸ List æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ä¸€ä¸ªæ•°æ®ä¸å¯é‡å¤ï¼Œä¸€ä¸ªæ˜¯å¯ä»¥é‡å¤çš„ã€‚ HashMapã€TreeMapã€ConcurrentHashMapã€HashTableã€ArrayDequeã€ArrayListã€LinkedListã€Vectorçº¿ç¨‹å®‰å…¨é—®é¢˜ä»¥åŠ keyã€value æ˜¯å¦èƒ½ä¸ºç©ºï¼Ÿ é›†åˆ çº¿ç¨‹æ˜¯å¦å®‰å…¨ keyã€valueæ˜¯å¦å¯ä»¥ä¸ºç©º åŸå›  HashMap éçº¿ç¨‹å®‰å…¨ Keyã€valueå‡èƒ½ä¸ºç©º Key å¯ä»¥ä¸ºç©ºï¼Œä½†å¿…é¡»å”¯ä¸€ï¼Œvalueæ²¡æœ‰é™åˆ¶ TreeMap éçº¿ç¨‹å®‰ Keyä¸èƒ½ä¸ºnullã€valueä¸èƒ½ä¸ºnull keyä¸èƒ½ä¸ºnullï¼Œå› ä¸ºå…¶éœ€è¦æ’åºï¼Œvalueå¯ä»¥ä¸ºnull ConcurrentHashMap çº¿ç¨‹å®‰å…¨ Keyã€valueå‡ä¸èƒ½ä¸ºç©º keyä¸èƒ½ä¸ºç©ºï¼Œå› ä¸ºé‡‡ç”¨äº†fail-safeæœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶ä¼šä½¿å¾—è¯»å–çš„æ•°æ®ä¸ä¸€å®šæ˜¯æœ€æ–°çš„ï¼Œä½¿ç”¨nullå€¼ï¼Œå°±ä¼šä½¿å¾—å…¶æ— æ³•åˆ¤æ–­å¯¹åº”çš„keyæ˜¯ä¸å­˜åœ¨è¿˜æ˜¯ä¸ºç©ºï¼Œå› ä¸ºä½ æ— æ³•å†è°ƒç”¨ä¸€æ¬¡contains(keyï¼‰æ¥å¯¹keyæ˜¯å¦å­˜åœ¨è¿›è¡Œåˆ¤æ–­ï¼ŒHashTableåŒç†ã€‚æ•…åœ¨å…¥å‚æ—¶ï¼Œè‹¥ä¸º null å°±æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œè€Œä¸”åœ¨å–hashcodeæ—¶ï¼Œå‹æ ¹å°±æ²¡è€ƒè™‘ç©ºçš„æƒ…å†µã€‚ HashTable çº¿ç¨‹å®‰å…¨ Keyã€valueå‡ä¸èƒ½ä¸ºç©º valueä¸èƒ½ä¸ºç©ºï¼Œå½“é€šè¿‡get(k)è·å–å¯¹åº”çš„valueæ—¶ï¼Œå¦‚æœè·å–åˆ°çš„æ˜¯nullæ—¶ï¼Œæ— æ³•åˆ¤æ–­ï¼Œå®ƒæ˜¯putï¼ˆk,vï¼‰çš„æ—¶å€™valueä¸ºnullï¼Œè¿˜æ˜¯è¿™ä¸ªkeyä»æ¥æ²¡æœ‰åšè¿‡æ˜ å°„ã€‚å‡å¦‚çº¿ç¨‹1è°ƒç”¨m.containsï¼ˆkeyï¼‰è¿”å›trueï¼Œç„¶ååœ¨è°ƒç”¨m.get(key)ï¼Œè¿™æ—¶çš„må¯èƒ½å·²ç»ä¸åŒäº†ã€‚å› ä¸ºçº¿ç¨‹2å¯èƒ½åœ¨çº¿ç¨‹1è°ƒç”¨m.containsï¼ˆkeyï¼‰æ—¶ï¼Œåˆ é™¤äº†keyèŠ‚ç‚¹ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´çº¿ç¨‹1å¾—åˆ°çš„ç»“æœä¸æ˜ç¡®ï¼Œäº§ç”Ÿå¤šçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› æ­¤ï¼ŒHashmapå’ŒConcurrentHashMapçš„keyå’Œvalueä¸èƒ½ä¸ºnullã€‚ ArrayDeque éçº¿ç¨‹å®‰å…¨ å€¼ä¸èƒ½ä¸ºç©º ä¸èƒ½å­˜å…¥ nullï¼Œå› ä¸ºåœ¨addæ—¶å°±æœ‰åˆ¤æ–­ï¼Œå¦‚æœæ˜¯ nullï¼Œå°±æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ ArrayList éçº¿ç¨‹å®‰å…¨ å€¼å¯ä»¥ä¸ºç©º å¯ä»¥ä¸ºç©ºï¼Œå½“æˆä¸€ä¸ªå¯¹è±¡åŠ å…¥æˆ–åˆ é™¤ï¼Œæ·»åŠ nullä¹Ÿä¼šå¢åŠ size LinkedList éçº¿ç¨‹å®‰å…¨ å€¼å¯ä»¥ä¸ºç©º åŒArrayList Vector çº¿ç¨‹å®‰å…¨ å€¼ä¸å¯ä»¥ä¸ºç©º ä¸èƒ½ä¸ºç©ºï¼Œå› ä¸ºæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½¿ç”¨äº†fail-safeæœºåˆ¶ï¼ŒåŒConcurrentHashMap LinkedHashMapå‚è€ƒLinkedHashMapæºç è¯¦ç»†åˆ†æ LinkedHashMap æºç è§£è¯»(JDK 1.8) LinkedHashMapè¯¦è§£ Javaé›†åˆä¹‹LinkedHashMap Javaé›†åˆæ¡†æ¶ä¹‹LinkedHashMapè¯¦è§£ Java LinkedHashMapç±»æºç è§£æ Java8é›†åˆç³»åˆ—ä¹‹LinkedHashMap LinkedHashMapã€ConcurrentHashMapæ¦‚æ‹¬ æ¦‚è¿° LinkedHashMapæ˜¯HashMapçš„ä¸€ä¸ªå­ç±»ï¼Œå®ƒä¿ç•™æ’å…¥æˆ–è€…è®¿é—®é¡ºåºï¼Œå¸®åŠ©æˆ‘ä»¬å®ç°äº†æœ‰åºçš„HashMapã€‚ å…¶ç»´æŠ¤ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¹¶ä¸æ˜¯è¯´å…¶é™¤äº†ç»´æŠ¤å­˜å…¥çš„æ•°æ®ï¼Œå¦å¤–ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨å¯¹è±¡ï¼Œè€Œæ˜¯è¯´å…¶æ ¹æ®é‡å†™HashMapçš„å®ä½“ç±»Entryï¼Œæ¥å®ç°èƒ½å¤Ÿå°†HashMapçš„æ•°æ®ç»„æˆä¸€ä¸ªåŒå‘åˆ—è¡¨ï¼Œå…¶å­˜å‚¨çš„ç»“æ„è¿˜æ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„å½¢å¼ï¼Œä¹Ÿå°±æ˜¯é“¾è¡¨ä¸Šçš„èŠ‚ç‚¹æœ‰ä¸‰ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æ˜¯beforeã€afterã€nextã€‚ ä¸ HashMap çš„åŒºåˆ«è¿™é‡Œç”¨ä¸€ä¸ª demo å‘ˆç°å‡º LinkedHashMap çš„æœ‰åºçš„ç‰¹ç‚¹ 123456789101112 public static void main(String[] args) &#123;// LinkedHashMap&lt;String,Integer&gt; map = new LinkedHashMap(16, 0.75f,true); LinkedHashMap&lt;String,Integer&gt; map = new LinkedHashMap(); map.put("apple",10000); map.put("huawei",5000); map.put("xiaomi",2000);// map.get("apple");// map.get("xiaomi"); for(Map.Entry a:map.entrySet())&#123; System.out.println(a.getValue()); &#125; &#125; 1234è¾“å‡ºä¸ºï¼š1000050002000 å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä½¿ç”¨ä¸Šï¼ŒLinkedHashMapå’ŒHashMapçš„åŒºåˆ«å°±æ˜¯LinkedHashMapæ˜¯æœ‰åºçš„ã€‚ ä¸Šé¢è¿™ä¸ªä¾‹å­æ˜¯æ ¹æ®æ’å…¥é¡ºåºæ’åºï¼Œæ­¤å¤–ï¼ŒLinkedHashMapè¿˜æœ‰ä¸€ä¸ªå‚æ•°(accessOrder)å†³å®šæ˜¯å¦åœ¨æ­¤åŸºç¡€ä¸Šå†æ ¹æ®è®¿é—®é¡ºåº(get,put)æ’åº,è®°ä½ï¼Œæ˜¯åœ¨æ’å…¥é¡ºåºçš„åŸºç¡€ä¸Šå†æ’åºï¼Œåé¢çœ‹äº†æºç å°±çŸ¥é“ä¸ºä»€ä¹ˆäº†ã€‚çœ‹ä¸‹ä¾‹å­: 123456789101112 public static void main(String[] args) &#123; LinkedHashMap&lt;String,Integer&gt; map = new LinkedHashMap(16, 0.75f,true);// LinkedHashMap&lt;String,Integer&gt; map = new LinkedHashMap(); map.put("apple",10000); map.put("huawei",5000); map.put("xiaomi",2000); map.get("apple"); map.get("xiaomi"); for(Map.Entry a:map.entrySet())&#123; System.out.println(a.getValue()); &#125; &#125; 1234è¾“å‡ºä¸ºï¼š5000100002000 å¾ˆæ˜æ˜¾èƒ½çœ‹å‡ºæ¥ï¼Œç”±äºå°† accessOrder == trueï¼ŒæŒ‰ç…§äº†è¯»å–é¡ºåºæ’åˆ—ï¼Œæœ€å¼€å§‹çš„é¡ºåºæ˜¯ apple - huawei - xiaomiï¼Œç”±äºè¯»å–äº†appleï¼Œappleåˆ™è¿›å…¥åˆ°å°¾(tail)ï¼Œé¡ºåºå˜ä¸º huawei - xiaomi - appleï¼Œåˆè¯»å–äº† xiaomiï¼Œæ•…é¡ºåºå˜ä¸º huawei - apple - xiaomi ï¼Œæ•…æœ€åçš„ç­”æ¡ˆæ˜¯ 5000 - 10000 - 2000ã€‚ LinkedHashMapçš„å­˜å‚¨ç»“æ„LinkedHashMapä¹‹æ‰€ä»¥èƒ½å®ç°å­˜å–çš„é¡ºåºæ€§ï¼Œä¸»è¦æ˜¯ä»–é‡æ–°å®šä¹‰äº† Entry ï¼Œè¿™ä¸ªæ–°çš„ Entry ç»§æ‰¿è‡ªHashMap.Nodeï¼Œå¹¶åšäº†æ–°çš„æ‰©å±•ï¼Œä¸‹é¢æˆ‘ä»¬ç»“åˆæºç æ¥åˆ†æä¸€ä¸‹ã€‚ 123456789101112131415161718192021/*** ç»§æ‰¿è‡ª HashMap.Nodeï¼Œæ–°å¢äº† beforeã€after è®°å½•æ’å…¥é¡ºåº*///é“¾è¡¨ç»“ç‚¹static class Entry&lt;K,V&gt; extends HashMap.Node&lt;K,V&gt; &#123; Entry&lt;K,V&gt; before, after; Entry(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; super(hash, key, value, next); &#125;&#125;private static final long serialVersionUID = 3801124242820219131L;//é“¾è¡¨å¤´éƒ¨transient LinkedHashMap.Entry&lt;K,V&gt; head;//é“¾è¡¨å°¾éƒ¨transient LinkedHashMap.Entry&lt;K,V&gt; tail;/** * è®¿é—®é¡ºåº * The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt; * for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order. */final boolean accessOrder; ç”±ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªè‡ªå®šä¹‰çš„ Entryæ¯” HashMap.Nodeå¤šäº†ä¸¤ä¸ªå±æ€§ï¼Œbeforeå’Œafterã€‚æ­£æ˜¯ä½¿ç”¨è¿™ä¸¤ä¸ªå…³é”®çš„å±æ€§ï¼Œåœ¨LinkedHashMapå†…éƒ¨å®ç°äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚åŒå‘é“¾è¡¨å°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹é™¤äº†å­˜å‚¨æ•°æ®æœ¬èº«ä¹‹å¤–ï¼Œè¿˜ä¿å­˜ç€ä¸¤ä¸ªæŒ‡é’ˆï¼Œåœ¨javaé‡Œé¢å°±æ˜¯æŒ‡å‘å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸€ä¸ªæ˜¯å‰é©±èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä»–çš„å‰ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œä¸€ä¸ªæ˜¯åç»§èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä»–çš„åä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥å®ç°å­˜å‚¨ä¸€ä¸ªæœ‰åºèŠ‚ç‚¹çš„æ•°æ®ç»“æ„äº†ã€‚ï¼ˆè¿™é‡Œè¯´æ˜ä¸‹ï¼Œåœ¨jdk1.7ä¸­ï¼Œä½¿ç”¨çš„ç»“æ„ä¸ºç¯å½¢åŒå‘é“¾è¡¨ï¼‰å¦å¤–ï¼Œç»§æ‰¿è‡ªHashMap.Nodeçš„Entryè‡ªèº«è¿˜ä¿ç•™ç€ç”¨äºç»´æŒå•é“¾è¡¨çš„nextå±æ€§ï¼Œå› æ­¤LinkedHashMapçš„EntryèŠ‚ç‚¹å…·æœ‰ä¸‰ä¸ªæŒ‡é’ˆåŸŸï¼ŒnextæŒ‡é’ˆç»´æŠ¤Hashæ¡¶ä¸­å†²çªkeyçš„é“¾è¡¨ï¼Œbeforeå’Œafterç»´æŠ¤åŒå‘é“¾è¡¨ã€‚ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é‡è¦æ–¹æ³•æ„é€ å‡½æ•°ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ç»§æ‰¿ HashMap ï¼Œä¸€ä¸ªæ˜¯å¯ä»¥é€‰æ‹© accessOrder çš„å€¼(é»˜è®¤ falseï¼Œä»£è¡¨æŒ‰ç…§æ’å…¥é¡ºåºæ’åº)æ¥ç¡®å®šæ˜¯æŒ‰æ’å…¥é¡ºåºè¿˜æ˜¯è¯»å–é¡ºåºæ’åºã€‚ 123456789101112131415161718192021//è°ƒç”¨çˆ¶ç±»HashMapçš„æ„é€ æ–¹æ³•ã€‚public LinkedHashMap(int initialCapacity) &#123; super(initialCapacity); accessOrder = false;&#125;/** * //è°ƒç”¨çˆ¶ç±»HashMapçš„æ„é€ æ–¹æ³•ã€‚ * Constructs an empty insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance * with the default initial capacity (16) and load factor (0.75). */public LinkedHashMap() &#123; super(); accessOrder = false;&#125;public LinkedHashMap(int initialCapacity, float loadFactor, boolean accessOrder) &#123; super(initialCapacity, loadFactor); this.accessOrder = accessOrder;&#125; put()LinkedHashMap çš„ put æ–¹æ³•ä¹Ÿæ˜¯ä½¿ç”¨ HashMap çš„æ–¹æ³•ï¼Œä¸åŒåœ¨äºé‡å†™äº† newNode(), afterNodeAccess() å’Œ afterNodeInsertion() è¿™å‡ ä¸ªæ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374// HashMap ä¸­å®ç°public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125;// HashMap ä¸­å®ç°final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; if ((tab = table) == null || (n = tab.length) == 0) &#123;...&#125; // é€šè¿‡èŠ‚ç‚¹ hash å®šä½èŠ‚ç‚¹æ‰€åœ¨çš„æ¡¶ä½ç½®ï¼Œå¹¶æ£€æµ‹æ¡¶ä¸­æ˜¯å¦åŒ…å«èŠ‚ç‚¹å¼•ç”¨ if ((p = tab[i = (n - 1) &amp; hash]) == null) &#123;...&#125; else &#123; Node&lt;K,V&gt; e; K k; if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; else if (p instanceof TreeNode) &#123;...&#125; else &#123; // éå†é“¾è¡¨ï¼Œå¹¶ç»Ÿè®¡é“¾è¡¨é•¿åº¦ for (int binCount = 0; ; ++binCount) &#123; // æœªåœ¨å•é“¾è¡¨ä¸­æ‰¾åˆ°è¦æ’å…¥çš„èŠ‚ç‚¹ï¼Œå°†æ–°èŠ‚ç‚¹æ¥åœ¨å•é“¾è¡¨çš„åé¢ if ((e = p.next) == null) &#123; p.next = newNode(hash, key, value, null); if (binCount &gt;= TREEIFY_THRESHOLD - 1) &#123;...&#125; break; &#125; // æ’å…¥çš„èŠ‚ç‚¹å·²ç»å­˜åœ¨äºå•é“¾è¡¨ä¸­ if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) &#123;...&#125; afterNodeAccess(e); // å›è°ƒæ–¹æ³•ï¼Œåç»­è¯´æ˜ï¼ï¼ï¼é‡ç‚¹å“ˆï¼ï¼ï¼ return oldValue; &#125; &#125; ++modCount; if (++size &gt; threshold) &#123;...&#125; afterNodeInsertion(evict); // å›è°ƒæ–¹æ³•ï¼Œåç»­è¯´æ˜ï¼ï¼ï¼é‡ç‚¹å“ˆï¼ï¼ï¼ return null;&#125;// HashMap ä¸­å®ç°Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; return new Node&lt;&gt;(hash, key, value, next);&#125;// LinkedHashMap ä¸­è¦†å†™ï¼ï¼ï¼ï¼ï¼é‡ç‚¹ï¼ï¼ï¼Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; e) &#123; LinkedHashMap.Entry&lt;K,V&gt; p = new LinkedHashMap.Entry&lt;K,V&gt;(hash, key, value, e); // å°† Entry æ¥åœ¨åŒå‘é“¾è¡¨çš„å°¾éƒ¨ linkNodeLast(p); return p;&#125;// LinkedHashMap ä¸­å®ç°ï¼ï¼ï¼ï¼ï¼private void linkNodeLast(LinkedHashMap.Entry&lt;K,V&gt; p) &#123; LinkedHashMap.Entry&lt;K,V&gt; last = tail; tail = p; // last ä¸º nullï¼Œè¡¨æ˜é“¾è¡¨è¿˜æœªå»ºç«‹ if (last == null) head = p; else &#123; // å°†æ–°èŠ‚ç‚¹ p æ¥åœ¨é“¾è¡¨å°¾éƒ¨ p.before = last; last.after = p; &#125;&#125; æˆ‘æŠŠ newNode æ–¹æ³•çº¢è‰²èƒŒæ™¯æ ‡æ³¨äº†å‡ºæ¥ï¼Œè¿™ä¸€æ­¥æ¯”è¾ƒå…³é”®ã€‚LinkedHashMap è¦†å†™äº†è¯¥æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼ŒLinkedHashMap åˆ›å»ºäº† Entryï¼Œå¹¶é€šè¿‡ linkNodeLast æ–¹æ³•å°† Entry æ¥åœ¨åŒå‘é“¾è¡¨çš„å°¾éƒ¨ï¼Œå®ç°äº†åŒå‘é“¾è¡¨çš„å»ºç«‹ã€‚åŒå‘é“¾è¡¨å»ºç«‹ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§æ’å…¥é¡ºåºå»éå† LinkedHashMapã€‚ æ¥ä¸‹æ¥å°±é‡ç‚¹ä»‹ç» newNode() ã€linkNodeLast()ã€afterNodeAccess() ã€afterNodeInsertion()ã€afterNodeInsertion() newNode() 12345678910/** * æ ¹æ® key-value åˆ›å»ºåŒå‘é“¾è¡¨èŠ‚ç‚¹ * e è¡¨ç¤ºä¸‹ä¸€ä¸ªèŠ‚ç‚¹, ä¸è¿‡è¿™é‡Œæ˜¯ç©ºå€¼, ä¸ç”¨ç†ä¼š */Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; e) &#123; LinkedHashMap.Entry&lt;K,V&gt; p = new LinkedHashMap.Entry&lt;K,V&gt;(hash, key, value, e); linkNodeLast(p); return p;&#125; linkNodeLast() 1234567891011121314/** * æŠŠæ–°èŠ‚ç‚¹æ’å…¥åˆ°åŒå‘é“¾è¡¨å°¾éƒ¨ */private void linkNodeLast(LinkedHashMap.Entry&lt;K,V&gt; p) &#123; LinkedHashMap.Entry&lt;K,V&gt; last = tail; tail = p; // å¦‚æœè¿™æ˜¯ç©ºé“¾è¡¨, æ–°èŠ‚ç‚¹å°±æ˜¯å¤´ç»“ç‚¹ if (last == null) head = p; else &#123; p.before = last; last.after = p; &#125;&#125; afterNodeAccess() &amp; afterNodeInsertion() &amp; afterNodeRemoval() 1234// Callbacks to allow LinkedHashMap post-actionsvoid afterNodeAccess(Node&lt;K,V&gt; p) &#123; &#125;void afterNodeRemoval(Node&lt;K,V&gt; p) &#123; &#125;void afterNodeInsertion(boolean evict) &#123; &#125; æ ¹æ®è¿™ä¸‰ä¸ªæ–¹æ³•çš„æ³¨é‡Šå¯ä»¥çœ‹å‡ºï¼Œè¿™äº›æ–¹æ³•çš„ç”¨é€”æ˜¯åœ¨å¢åˆ æŸ¥ç­‰æ“ä½œåï¼Œé€šè¿‡å›è°ƒçš„æ–¹å¼ï¼Œè®© LinkedHashMap æœ‰æœºä¼šåšä¸€äº›åç½®æ“ä½œã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253//æ ‡å‡†çš„å¦‚ä½•åœ¨åŒå‘é“¾è¡¨ä¸­å°†æŒ‡å®šå…ƒç´ æ”¾å…¥é˜Ÿå°¾// LinkedHashMap ä¸­è¦†å†™//è®¿é—®å…ƒç´ ä¹‹åçš„å›è°ƒæ–¹æ³•/** * 1. ä½¿ç”¨ get æ–¹æ³•ä¼šè®¿é—®åˆ°èŠ‚ç‚¹, ä»è€Œè§¦å‘è°ƒç”¨è¿™ä¸ªæ–¹æ³• * 2. ä½¿ç”¨ put æ–¹æ³•æ’å…¥èŠ‚ç‚¹, å¦‚æœ key å­˜åœ¨, ä¹Ÿç®—è¦è®¿é—®èŠ‚ç‚¹, ä»è€Œè§¦å‘è¯¥æ–¹æ³• * 3. åªæœ‰ accessOrder æ˜¯ true æ‰ä¼šè°ƒç”¨è¯¥æ–¹æ³• * 4. è¿™ä¸ªæ–¹æ³•ä¼šæŠŠè®¿é—®åˆ°çš„æœ€åèŠ‚ç‚¹é‡æ–°æ’å…¥åˆ°åŒå‘é“¾è¡¨ç»“å°¾ */void afterNodeAccess(Node&lt;K,V&gt; e) &#123; // move node to last // ç”¨ last è¡¨ç¤ºæ’å…¥ e å‰çš„å°¾èŠ‚ç‚¹ // æ’å…¥ e å e æ˜¯å°¾èŠ‚ç‚¹, æ‰€ä»¥ä¹Ÿæ˜¯è¡¨ç¤º e çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ LinkedHashMap.Entry&lt;K,V&gt; last; //å¦‚æœæ˜¯è®¿é—®åºï¼Œä¸”å½“å‰èŠ‚ç‚¹å¹¶ä¸æ˜¯å°¾èŠ‚ç‚¹ //å°†è¯¥èŠ‚ç‚¹ç½®ä¸ºåŒå‘é“¾è¡¨çš„å°¾éƒ¨ if (accessOrder &amp;&amp; (last = tail) != e) &#123; // p: å½“å‰èŠ‚ç‚¹ // b: å‰ä¸€ä¸ªèŠ‚ç‚¹ // a: åä¸€ä¸ªèŠ‚ç‚¹ // ç»“æ„ä¸º: b &lt;=&gt; p &lt;=&gt; a LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; // ç»“æ„å˜æˆ: b &lt;=&gt; p &lt;- a p.after = null; // å¦‚æœå½“å‰èŠ‚ç‚¹ p æœ¬èº«æ˜¯å¤´èŠ‚ç‚¹, é‚£ä¹ˆå¤´ç»“ç‚¹è¦æ”¹æˆ a if (b == null) head = a; // å¦‚æœ p ä¸æ˜¯å¤´å°¾èŠ‚ç‚¹, æŠŠå‰åèŠ‚ç‚¹è¿æ¥, å˜æˆ: b -&gt; a else b.after = a; // a éç©º, å’Œ b è¿æ¥, å˜æˆ: b &lt;- a if (a != null) a.before = b; // å¦‚æœ a ä¸ºç©º, è¯´æ˜ p æ˜¯å°¾èŠ‚ç‚¹, b å°±æ˜¯å®ƒçš„å‰ä¸€ä¸ªèŠ‚ç‚¹, ç¬¦åˆ last çš„å®šä¹‰ // è¿™ä¸ª else æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºæœ€å¼€å¤´ifå·²ç»ç¡®ä¿äº†pä¸æ˜¯å°¾ç»“ç‚¹äº†ï¼Œè‡ªç„¶afterä¸ä¼šæ˜¯null else last = b; // å¦‚æœè¿™æ˜¯ç©ºé“¾è¡¨, p æ”¹æˆå¤´ç»“ç‚¹ if (last == null) head = p; // å¦åˆ™æŠŠ p æ’å…¥åˆ°é“¾è¡¨å°¾éƒ¨ else &#123; p.before = last; last.after = p; &#125; tail = p; ++modCount; &#125;&#125; 12345678910111213141516void afterNodeRemoval(Node&lt;K,V&gt; e) &#123; // ä¼˜ç¾çš„ä¸€ç¬”ï¼Œå­¦ä¹ ä¸€æ³¢å¦‚ä½•åœ¨åŒå‘é“¾è¡¨ä¸­åˆ é™¤èŠ‚ç‚¹ LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; // å°† p èŠ‚ç‚¹çš„å‰é©±ååç»§å¼•ç”¨ç½®ç©º p.before = p.after = null; // b ä¸º nullï¼Œè¡¨æ˜ p æ˜¯å¤´èŠ‚ç‚¹ if (b == null) head = a; else b.after = a; // a ä¸º nullï¼Œè¡¨æ˜ p æ˜¯å°¾èŠ‚ç‚¹ if (a == null) tail = b; else a.before = b;&#125; 123456789101112131415161718192021222324252627// åœ¨æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ ä¹‹åï¼Œå¦‚æœæ˜¯æŒ‰æ’å…¥é¡ºåºæ’åºï¼Œå³è°ƒç”¨newNode()ä¸­çš„linkNodeLast()å®Œæˆ// å¦‚æœæ˜¯æŒ‰ç…§è¯»å–é¡ºåºæ’åºï¼Œå³è°ƒç”¨afterNodeAccess()å®Œæˆ// é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•æ˜¯å¹²å˜›çš„å‘¢ï¼Œè¿™ä¸ªå°±æ˜¯è‘—åçš„ LRU ç®—æ³•å•¦// åœ¨æ’å…¥å®Œæˆä¹‹åï¼Œéœ€è¦å›è°ƒå‡½æ•°åˆ¤æ–­æ˜¯å¦éœ€è¦ç§»é™¤æŸäº›å…ƒç´ ï¼/** * æ’å…¥æ–°èŠ‚ç‚¹æ‰ä¼šè§¦å‘è¯¥æ–¹æ³•ï¼Œå› ä¸ºåªæœ‰æ’å…¥æ–°èŠ‚ç‚¹æ‰éœ€è¦å†…å­˜ * æ ¹æ® HashMap çš„ putVal æ–¹æ³•, evict ä¸€ç›´æ˜¯ true * removeEldestEntry æ–¹æ³•è¡¨ç¤ºç§»é™¤è§„åˆ™, åœ¨ LinkedHashMap é‡Œä¸€ç›´è¿”å› false * æ‰€ä»¥åœ¨ LinkedHashMap é‡Œè¿™ä¸ªæ–¹æ³•ç›¸å½“äºä»€ä¹ˆéƒ½ä¸åš */void afterNodeInsertion(boolean evict) &#123; // possibly remove eldest LinkedHashMap.Entry&lt;K,V&gt; first; // æ ¹æ®æ¡ä»¶åˆ¤æ–­æ˜¯å¦ç§»é™¤æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„èŠ‚ç‚¹ if (evict &amp;&amp; (first = head) != null &amp;&amp; removeEldestEntry(first)) &#123; K key = first.key; removeNode(hash(key), key, null, false, true); &#125;&#125;// ç§»é™¤æœ€è¿‘æœ€å°‘è¢«è®¿é—®æ¡ä»¶ä¹‹ä¸€ï¼Œé€šè¿‡è¦†ç›–æ­¤æ–¹æ³•å¯å®ç°ä¸åŒç­–ç•¥çš„ç¼“å­˜// LinkedHashMapæ˜¯é»˜è®¤è¿”å›falseçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç»§æ‰¿LinkedHashMapç„¶åå¤å†™è¯¥æ–¹æ³•å³å¯// ä¾‹å¦‚ LeetCode ç¬¬ 146 é¢˜å°±æ˜¯é‡‡ç”¨è¯¥ç§æ–¹æ³•ï¼Œç›´æ¥ return size() &gt; capacity;protected boolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest) &#123; return false;&#125; get()å‰é¢è¯´äº†æ’å…¥é¡ºåºçš„å®ç°ï¼Œæœ¬èŠ‚æ¥è®²è®²è®¿é—®é¡ºåºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinkedHashMap æ˜¯æŒ‰æ’å…¥é¡ºåºç»´æŠ¤é“¾è¡¨ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥åœ¨åˆå§‹åŒ– LinkedHashMapï¼ŒæŒ‡å®š accessOrder å‚æ•°ä¸º trueï¼Œå³å¯è®©å®ƒæŒ‰è®¿é—®é¡ºåºç»´æŠ¤é“¾è¡¨ã€‚è®¿é—®é¡ºåºçš„åŸç†ä¸Šå¹¶ä¸å¤æ‚ï¼Œå½“æˆ‘ä»¬è°ƒç”¨getã€getOrDefaultã€replaceç­‰æ–¹æ³•æ—¶ï¼Œåªéœ€è¦å°†è¿™äº›æ–¹æ³•è®¿é—®çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨çš„å°¾éƒ¨å³å¯ã€‚ç›¸åº”çš„æºç å¦‚ä¸‹: 1234567891011121314151617181920212223242526272829303132333435363738394041424344// LinkedHashMap ä¸­è¦†å†™public V get(Object key) &#123; Node&lt;K,V&gt; e; if ((e = getNode(hash(key), key)) == null) return null; // å¦‚æœ accessOrder ä¸º trueï¼Œåˆ™è°ƒç”¨ afterNodeAccess å°†è¢«è®¿é—®èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨æœ€å if (accessOrder) afterNodeAccess(e); return e.value;&#125;// LinkedHashMap ä¸­è¦†å†™void afterNodeAccess(Node&lt;K,V&gt; e) &#123; // move node to last LinkedHashMap.Entry&lt;K,V&gt; last; if (accessOrder &amp;&amp; (last = tail) != e) &#123; LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; p.after = null; // å¦‚æœ b ä¸º nullï¼Œè¡¨æ˜ p ä¸ºå¤´èŠ‚ç‚¹ if (b == null) head = a; else b.after = a; if (a != null) a.before = b; /* * è¿™é‡Œå­˜ç–‘ï¼Œçˆ¶æ¡ä»¶åˆ†æ”¯å·²ç»ç¡®ä¿èŠ‚ç‚¹ e ä¸ä¼šæ˜¯å°¾èŠ‚ç‚¹ï¼Œ * é‚£ä¹ˆ e.after å¿…ç„¶ä¸ä¼šä¸º nullï¼Œä¸çŸ¥é“ else åˆ†æ”¯æœ‰ä»€ä¹ˆä½œç”¨ */ else last = b; if (last == null) head = p; else &#123; // å°† p æ¥åœ¨é“¾è¡¨çš„æœ€å p.before = last; last.after = p; &#125; tail = p; ++modCount; &#125;&#125; delete()ä¸æ’å…¥æ“ä½œä¸€æ ·ï¼ŒLinkedHashMap åˆ é™¤æ“ä½œç›¸å…³çš„ä»£ç ä¹Ÿæ˜¯ç›´æ¥ç”¨çˆ¶ç±»çš„å®ç°ã€‚åœ¨åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œçˆ¶ç±»çš„åˆ é™¤é€»è¾‘å¹¶ä¸ä¼šä¿®å¤ LinkedHashMap æ‰€ç»´æŠ¤çš„åŒå‘é“¾è¡¨ï¼Œè¿™ä¸æ˜¯å®ƒçš„èŒè´£ã€‚é‚£ä¹ˆåˆ é™¤åŠèŠ‚ç‚¹åï¼Œè¢«åˆ é™¤çš„èŠ‚ç‚¹è¯¥å¦‚ä½•ä»åŒé“¾è¡¨ä¸­ç§»é™¤å‘¢ï¼Ÿå½“ç„¶ï¼ŒåŠæ³•è¿˜ç®—æ˜¯æœ‰çš„ã€‚ä¸Šä¸€èŠ‚æœ€åæåˆ° HashMap ä¸­ä¸‰ä¸ªå›è°ƒæ–¹æ³•è¿è¡Œ LinkedHashMap å¯¹ä¸€äº›æ“ä½œåšå‡ºå“åº”ã€‚æ‰€ä»¥ï¼Œåœ¨åˆ é™¤åŠèŠ‚ç‚¹åï¼Œå›è°ƒæ–¹æ³• afterNodeRemoval ä¼šè¢«è°ƒç”¨ã€‚LinkedHashMap è¦†å†™è¯¥æ–¹æ³•ï¼Œå¹¶åœ¨è¯¥æ–¹æ³•ä¸­å®Œæˆäº†ç§»é™¤è¢«åˆ é™¤èŠ‚ç‚¹çš„æ“ä½œã€‚ç›¸å…³æºç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110// HashMap ä¸­å®ç°public V remove(Object key) &#123; Node&lt;K,V&gt; e; return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value;&#125;// HashMap ä¸­å®ç°final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (p = tab[index = (n - 1) &amp; hash]) != null) &#123; Node&lt;K,V&gt; node = null, e; K k; V v; if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; else if ((e = p.next) != null) &#123; if (p instanceof TreeNode) &#123;...&#125; else &#123; // éå†å•é“¾è¡¨ï¼Œå¯»æ‰¾è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œå¹¶èµ‹å€¼ç»™ node å˜é‡ do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) &#123; node = e; break; &#125; p = e; &#125; while ((e = e.next) != null); &#125; &#125; if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) &#123; if (node instanceof TreeNode) &#123;...&#125; // å°†è¦åˆ é™¤çš„èŠ‚ç‚¹ä»å•é“¾è¡¨ä¸­ç§»é™¤ else if (node == p) tab[index] = node.next; else p.next = node.next; ++modCount; --size; afterNodeRemoval(node); // è°ƒç”¨åˆ é™¤å›è°ƒæ–¹æ³•è¿›è¡Œåç»­æ“ä½œ return node; &#125; &#125; return null;&#125;//å…·ä½“åˆ†æ ä¸Šé¢ put() ä¸­è®²çš„å¾ˆæ¸…æ¥šäº†ï¼// LinkedHashMap ä¸­è¦†å†™void afterNodeRemoval(Node&lt;K,V&gt; e) &#123; // unlink LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; // å°† p èŠ‚ç‚¹çš„å‰é©±ååç»§å¼•ç”¨ç½®ç©º p.before = p.after = null; // b ä¸º nullï¼Œè¡¨æ˜ p æ˜¯å¤´èŠ‚ç‚¹ if (b == null) head = a; else b.after = a; // a ä¸º nullï¼Œè¡¨æ˜ p æ˜¯å°¾èŠ‚ç‚¹ if (a == null) tail = b; else a.before = b;&#125;// æˆ‘å·²ç»åœ¨ HashMap éƒ¨åˆ†è®²è¿‡äº†final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (p = tab[index = (n - 1) &amp; hash]) != null) &#123; Node&lt;K,V&gt; node = null, e; K k; V v; if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; else if ((e = p.next) != null) &#123; if (p instanceof TreeNode) node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key); else &#123; do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) &#123; node = e; break; &#125; p = e; &#125; while ((e = e.next) != null); &#125; &#125; if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) &#123; if (node instanceof TreeNode) ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable); else if (node == p) tab[index] = node.next; else p.next = node.next; ++modCount; --size; afterNodeRemoval(node); return node; &#125; &#125; return null; &#125; åˆ é™¤çš„è¿‡ç¨‹å¹¶ä¸å¤æ‚ï¼Œä¸Šé¢è¿™ä¹ˆå¤šä»£ç å…¶å®å°±åšäº†ä¸‰ä»¶äº‹ï¼š æ ¹æ® hash å®šä½åˆ°æ¡¶ä½ç½® éå†é“¾è¡¨æˆ–è°ƒç”¨çº¢é»‘æ ‘ç›¸å…³çš„åˆ é™¤æ–¹æ³• ä» LinkedHashMap ç»´æŠ¤çš„åŒé“¾è¡¨ä¸­ç§»é™¤è¦åˆ é™¤çš„èŠ‚ç‚¹ replacementTreeNode()åœ¨è¿›è¡Œçº¢é»‘æ ‘è½¬æ¢çš„æ—¶å€™ä¸€äº›æ–¹æ³•ä¹Ÿè¿›è¡Œäº†é‡å†™ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718192021TreeNode&lt;K,V&gt; replacementTreeNode(Node&lt;K,V&gt; p, Node&lt;K,V&gt; next) &#123; LinkedHashMap.Entry&lt;K,V&gt; q = (LinkedHashMap.Entry&lt;K,V&gt;)p; //TreeNodeä¾æ—§æ˜¯HashMapä¸­çš„å†…éƒ¨ç±» TreeNode&lt;K,V&gt; t = new TreeNode&lt;K,V&gt;(q.hash, q.key, q.value, next); transferLinks(q, t); return t;&#125;//å°±æ˜¯å¯¹åŸæ¥åŒå‘é“¾è¡¨ä¸­çš„ç»“ç‚¹ç»“ç‚¹è¿›è¡Œæ›¿æ¢ï¼Œæ›¿æ¢æˆTreeNodeç»“ç‚¹ï¼ˆå¦å¤–ï¼ŒTreeNodeç»§æ‰¿äº†LinkedHashMap.Entryï¼‰private void transferLinks(LinkedHashMap.Entry&lt;K,V&gt; src, LinkedHashMap.Entry&lt;K,V&gt; dst) &#123; LinkedHashMap.Entry&lt;K,V&gt; b = dst.before = src.before; LinkedHashMap.Entry&lt;K,V&gt; a = dst.after = src.after; if (b == null) head = dst; else b.after = dst; if (a == null) tail = dst; else a.before = dst;&#125; è¿­ä»£LinkedHashMap çš„éå†æ–¹å¼å’Œ HashMap çš„ä¸€æ ·ï¼Œéƒ½æ˜¯é€šè¿‡ entrySet æ–¹æ³•è¿”å› Set å®ä¾‹,ï¼Œç„¶åé€šè¿‡ iterator æ–¹æ³•è¿”å›è¿­ä»£å™¨è¿›è¡Œéå†ã€‚ entrySet 12345678910111213141516171819/** * è¿”å› LinkedEntrySet å®ä¾‹, è¿™æ˜¯éé™æ€å†…éƒ¨ç±» */public Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123; Set&lt;Map.Entry&lt;K,V&gt;&gt; es; return (es = entrySet) == null ? (entrySet = new LinkedEntrySet()) : es;&#125;/** * å’Œ HashMap çš„ EntrySet ç±»ä¸€æ ·ç»§æ‰¿ AbstractSet * iterator æ–¹æ³•è¿”å› LinkedEntryIterator å®ä¾‹ */final class LinkedEntrySet extends AbstractSet&lt;Map.Entry&lt;K,V&gt;&gt; &#123; ... public final Iterator&lt;Map.Entry&lt;K,V&gt;&gt; iterator() &#123; return new LinkedEntryIterator(); &#125; ...&#125; next å’Œ hasNext 1234567891011121314151617181920212223242526272829303132333435363738394041/** * next æ–¹æ³•å®é™…æ˜¯è°ƒç”¨çˆ¶ç±» nextNode æ–¹æ³•è¿”å›èŠ‚ç‚¹ */final class LinkedEntryIterator extends LinkedHashIterator implements Iterator&lt;Map.Entry&lt;K,V&gt;&gt; &#123; public final Map.Entry&lt;K,V&gt; next() &#123; return nextNode(); &#125;&#125;abstract class LinkedHashIterator &#123; LinkedHashMap.Entry&lt;K,V&gt; next; LinkedHashMap.Entry&lt;K,V&gt; current; int expectedModCount; /** * æ„é€ å‡½æ•°, ä»åŒå‘é“¾è¡¨å¤´èŠ‚ç‚¹å¼€å§‹éå† */ LinkedHashIterator() &#123; next = head; expectedModCount = modCount; current = null; &#125; public final boolean hasNext() &#123; return next != null; &#125; /** * éå†æ¯”è¾ƒç®€å•, ç›´æ¥è¯»å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å°±è¡Œ */ final LinkedHashMap.Entry&lt;K,V&gt; nextNode() &#123; LinkedHashMap.Entry&lt;K,V&gt; e = next; if (modCount != expectedModCount) throw new ConcurrentModificationException(); if (e == null) throw new NoSuchElementException(); current = e; next = e.after; //ç›´æ¥éå†åŒå‘é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å³å¯ return e; &#125; ...&#125; é‡è¦è¡¥å……ç‚¹###ä¸ºä½• TreeNode è¿™ä¸ªç±»ç»§æ‰¿çš„æ˜¯ LinkedHashMap çš„ Entryï¼Œè€Œä¸æ˜¯ HashMap ä¸­çš„ Node ï¼Ÿ å…ˆæ¥çœ‹çœ‹ç»§æ‰¿ä½“ç³»ç»“æ„å›¾ï¼š ä¸Šé¢çš„ç»§æ‰¿ä½“ç³»ä¹ä¸€çœ‹è¿˜æ˜¯æœ‰ç‚¹å¤æ‚çš„ï¼ŒåŒæ—¶ä¹Ÿæœ‰ç‚¹è®©äººè¿·æƒ‘ã€‚HashMap çš„å†…éƒ¨ç±» TreeNode ä¸ç»§æ‰¿å®ƒçš„å†…éƒ¨ç±» Nodeï¼Œå´ç»§æ‰¿è‡ª Node çš„å­ç±» LinkedHashMap å†…éƒ¨ç±» Entryã€‚è¿™é‡Œè¿™æ ·åšæ˜¯æœ‰ä¸€å®šåŸå› çš„ï¼Œè¿™é‡Œå…ˆä¸è¯´ã€‚å…ˆæ¥ç®€å•è¯´æ˜ä¸€ä¸‹ä¸Šé¢çš„ç»§æ‰¿ä½“ç³»ã€‚LinkedHashMap å†…éƒ¨ç±» Entry ç»§æ‰¿è‡ª HashMap å†…éƒ¨ç±» Nodeï¼Œå¹¶æ–°å¢äº†ä¸¤ä¸ªå¼•ç”¨ï¼Œåˆ†åˆ«æ˜¯ before å’Œ afterã€‚è¿™ä¸¤ä¸ªå¼•ç”¨çš„ç”¨é€”ä¸éš¾ç†è§£ï¼Œä¹Ÿå°±æ˜¯ç”¨äºç»´æŠ¤åŒå‘é“¾è¡¨ã€‚åŒæ—¶ï¼ŒTreeNode ç»§æ‰¿ LinkedHashMap çš„å†…éƒ¨ç±» Entry åï¼Œå°±å…·å¤‡äº†å’Œå…¶ä»– Entry ä¸€èµ·ç»„æˆé“¾è¡¨çš„èƒ½åŠ›ã€‚ä½†æ˜¯è¿™é‡Œéœ€è¦å¤§å®¶è€ƒè™‘ä¸€ä¸ªé—®é¢˜ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ HashMap æ—¶ï¼ŒTreeNode å¹¶ä¸éœ€è¦å…·å¤‡ç»„æˆé“¾è¡¨èƒ½åŠ›ã€‚å¦‚æœç»§æ‰¿ LinkedHashMap å†…éƒ¨ç±» Entry ï¼ŒTreeNode å°±å¤šäº†ä¸¤ä¸ªç”¨ä¸åˆ°çš„å¼•ç”¨ï¼Œè¿™æ ·åšä¸æ˜¯ä¼šæµªè´¹ç©ºé—´å—ï¼Ÿç®€å•è¯´æ˜ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼ˆæ°´å¹³æœ‰é™ï¼Œä¸ä¿è¯å®Œå…¨æ­£ç¡®ï¼‰ï¼Œè¿™é‡Œè¿™ä¹ˆåšç¡®å®ä¼šæµªè´¹ç©ºé—´ï¼Œä½†ä¸ TreeNode é€šè¿‡ç»§æ‰¿è·å–çš„ç»„æˆé“¾è¡¨çš„èƒ½åŠ›ç›¸æ¯”ï¼Œè¿™ç‚¹æµªè´¹æ˜¯å€¼å¾—çš„ã€‚åœ¨ HashMap çš„è®¾è®¡æ€è·¯æ³¨é‡Šä¸­ï¼Œæœ‰è¿™æ ·ä¸€æ®µè¯ï¼š Because TreeNodes are about twice the size of regular nodes, weuse them only when bins contain enough nodes to warrant use(see TREEIFY_THRESHOLD). And when they become too small (due toremoval or resizing) they are converted back to plain bins. Inusages with well-distributed user hashCodes, tree bins arerarely used. å¤§è‡´çš„æ„æ€æ˜¯ TreeNode å¯¹è±¡çš„å¤§å°çº¦æ˜¯æ™®é€š Node å¯¹è±¡çš„2å€ï¼Œæˆ‘ä»¬ä»…åœ¨æ¡¶ï¼ˆbinï¼‰ä¸­åŒ…å«è¶³å¤Ÿå¤šçš„èŠ‚ç‚¹æ—¶å†ä½¿ç”¨ã€‚å½“æ¡¶ä¸­çš„èŠ‚ç‚¹æ•°é‡å˜å°‘æ—¶ï¼ˆå–å†³äºåˆ é™¤å’Œæ‰©å®¹ï¼‰ï¼ŒTreeNode ä¼šè¢«è½¬æˆ Nodeã€‚å½“ç”¨æˆ·å®ç°çš„ hashCode æ–¹æ³•å…·æœ‰è‰¯å¥½åˆ†å¸ƒæ€§æ—¶ï¼Œæ ‘ç±»å‹çš„æ¡¶å°†ä¼šå¾ˆå°‘è¢«ä½¿ç”¨ã€‚ é€šè¿‡ä¸Šé¢çš„æ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªè¦ hashCode çš„å®ç°ä¸ç³Ÿç³•ï¼ŒNode ç»„æˆçš„é“¾è¡¨å¾ˆå°‘ä¼šè¢«è½¬æˆç”± TreeNode ç»„æˆçš„çº¢é»‘æ ‘ã€‚ä¹Ÿå°±æ˜¯è¯´ TreeNode ä½¿ç”¨çš„å¹¶ä¸å¤šï¼Œæµªè´¹é‚£ç‚¹ç©ºé—´æ˜¯å¯æ¥å—çš„ã€‚å‡å¦‚ TreeNode æœºåˆ¶ç»§æ‰¿è‡ª Node ç±»ï¼Œé‚£ä¹ˆå®ƒè¦æƒ³å…·å¤‡ç»„æˆé“¾è¡¨çš„èƒ½åŠ›ï¼Œå°±éœ€è¦ Node å»ç»§æ‰¿ LinkedHashMap çš„å†…éƒ¨ç±» Entryã€‚è¿™ä¸ªæ—¶å€™å°±å¾—ä¸å¿å¤±äº†ï¼Œæµªè´¹å¾ˆå¤šç©ºé—´å»è·å–ä¸ä¸€å®šç”¨å¾—åˆ°çš„èƒ½åŠ›ã€‚ åˆ©ç”¨LinkedHashMapå®ç°LRUç¼“å­˜( æˆ–è€… LeetCode ç¬¬ 146 é¢˜)LRUå³Least Recently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç¼“å­˜æ»¡äº†ï¼Œä¼šä¼˜å…ˆæ·˜æ±°é‚£äº›æœ€è¿‘æœ€ä¸å¸¸è®¿é—®çš„æ•°æ®ã€‚æˆ‘ä»¬çš„LinkedHashMapæ­£å¥½æ»¡è¶³è¿™ä¸ªç‰¹æ€§ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå½“æˆ‘ä»¬å¼€å¯accessOrderä¸ºtrueæ—¶ï¼Œæœ€æ–°è®¿é—®(getæˆ–è€…put(æ›´æ–°æ“ä½œ))çš„æ•°æ®ä¼šè¢«ä¸¢åˆ°é˜Ÿåˆ—çš„å°¾å·´å¤„ï¼Œé‚£ä¹ˆåŒå‘é˜Ÿåˆ—çš„å¤´å°±æ˜¯æœ€ä¸ç»å¸¸ä½¿ç”¨çš„æ•°æ®äº†ã€‚æ¯”å¦‚: å¦‚æœæœ‰1 2 3è¿™3ä¸ªEntryï¼Œé‚£ä¹ˆè®¿é—®äº†1ï¼Œå°±æŠŠ1ç§»åˆ°å°¾éƒ¨å»ï¼Œå³2 3 1ã€‚æ¯æ¬¡è®¿é—®éƒ½æŠŠè®¿é—®çš„é‚£ä¸ªæ•°æ®ç§»åˆ°åŒå‘é˜Ÿåˆ—çš„å°¾éƒ¨å»ï¼Œé‚£ä¹ˆæ¯æ¬¡è¦æ·˜æ±°æ•°æ®çš„æ—¶å€™ï¼ŒåŒå‘é˜Ÿåˆ—æœ€å¤´çš„é‚£ä¸ªæ•°æ®ä¸å°±æ˜¯æœ€ä¸å¸¸è®¿é—®çš„é‚£ä¸ªæ•°æ®äº†å—ï¼Ÿæ¢å¥è¯è¯´ï¼ŒåŒå‘é“¾è¡¨æœ€å¤´çš„é‚£ä¸ªæ•°æ®å°±æ˜¯è¦æ·˜æ±°çš„æ•°æ®ã€‚ æ­¤å¤–ï¼ŒLinkedHashMapè¿˜æä¾›äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ä¸ºäº†æˆ‘ä»¬å®ç°LRUç¼“å­˜è€Œæä¾›çš„ï¼ŒremoveEldestEntry(Map.Entry eldest) æ–¹æ³•ã€‚è¯¥æ–¹æ³•å¯ä»¥æä¾›åœ¨æ¯æ¬¡æ·»åŠ æ–°æ¡ç›®æ—¶ç§»é™¤æœ€æ—§æ¡ç›®çš„å®ç°ç¨‹åºï¼Œé»˜è®¤è¿”å› falseã€‚ æ¥ï¼Œç»™å¤§å®¶ä¸€ä¸ªç®€é™‹çš„LRUç¼“å­˜: 1234567891011121314151617public class LRUCache extends LinkedHashMap&#123; public LRUCache(int maxSize) &#123; super(maxSize, 0.75F, true); maxElements = maxSize; &#125; protected boolean removeEldestEntry(java.util.Map.Entry eldest) &#123; //é€»è¾‘å¾ˆç®€å•ï¼Œå½“å¤§å°è¶…å‡ºäº†Mapçš„å®¹é‡ï¼Œå°±ç§»é™¤æ‰åŒå‘é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ ï¼Œç»™å…¶ä»–å…ƒç´ è…¾å‡ºç‚¹åœ°æ¥ã€‚ return size() &gt; maxElements; &#125; private static final long serialVersionUID = 1L; protected int maxElements;&#125; ConcurrentHashMapå‚è€ƒConcurrentHashMap æºç åˆ†æ å¹¶å‘å®¹å™¨ä¹‹ConcurrentHashMap(JDK 1.8ç‰ˆæœ¬) å†™çš„æœ€å¥½ï¼ æ­»ç£• ConcurrentHashMap Java 8 ConcurrentHashMapæºç åˆ†æ ConcurrentHashMap è¯¦è§£ä¸€ javaå¹¶å‘ä¹‹ConcurrentHashMap 1.8åŸç†è¯¦è§£ å†™çš„ä¹Ÿéå¸¸æœ‰æ·±åº¦ï¼Œå¯æƒœæ’ç‰ˆå¾ˆå·®ï¼ï¼ï¼ å†™å¾—å¥½ ä¸»è¦å°±æ˜¯å‚è€ƒä¸Šé¢ä¸‰ä¸ªè‡ªå·±è§‰å¾—å†™å¾—å¥½çš„ï¼ æ¦‚è¿°åœ¨ä½¿ç”¨ HashMap æ—¶åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹æ‰©å®¹ä¼šå‡ºç° CPU æ¥è¿‘ 100%çš„æƒ…å†µï¼Œå› ä¸º hashmap å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åœ¨ java ä½“ç³»ä¸­å¤è€çš„ hashtable ç±»ï¼Œè¯¥ç±»åŸºæœ¬ä¸Šæ‰€æœ‰çš„æ–¹æ³•éƒ½é‡‡ç”¨ synchronized è¿›è¡Œçº¿ç¨‹å®‰å…¨çš„æ§åˆ¶ï¼Œå¯æƒ³è€ŒçŸ¥ï¼Œåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å–å¯¹è±¡ç›‘è§†å™¨é”ï¼Œè¿™æ ·çš„å¹¶å‘æ€§èƒ½çš„ç¡®ä¸ä»¤äººæ»¡æ„ã€‚å¦å¤–ä¸€ç§æ–¹å¼é€šè¿‡ Collections çš„Map synchronizedMap(Map m)å°† hashmap åŒ…è£…æˆä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ mapã€‚æ¯”å¦‚ SynchronzedMap çš„ put æ–¹æ³•æºç ä¸ºï¼š 123public V put(K key, V value) &#123; synchronized (mutex) &#123;return m.put(key, value);&#125;&#125; å®é™…ä¸Š SynchronizedMap å®ç°ä¾ç„¶æ˜¯é‡‡ç”¨ synchronized ç‹¬å å¼é”è¿›è¡Œçº¿ç¨‹å®‰å…¨çš„å¹¶å‘æ§åˆ¶çš„ã€‚åŒæ ·ï¼Œè¿™ç§æ–¹æ¡ˆçš„æ€§èƒ½ä¹Ÿæ˜¯ä»¤äººä¸å¤ªæ»¡æ„çš„ã€‚é’ˆå¯¹è¿™ç§å¢ƒå†µï¼ŒDoug Lea å¤§å¸ˆä¸é—ä½™åŠ›çš„ä¸ºæˆ‘ä»¬åˆ›é€ äº†ä¸€äº›çº¿ç¨‹å®‰å…¨çš„å¹¶å‘å®¹å™¨ï¼Œè®©æ¯ä¸€ä¸ª java å¼€å‘äººå‘˜å€æ„Ÿå¹¸ç¦ã€‚ç›¸å¯¹äº hashmap æ¥è¯´ï¼ŒConcurrentHashMap å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ mapï¼Œå…¶ä¸­åˆ©ç”¨äº†é”åˆ†æ®µçš„æ€æƒ³æé«˜äº†å¹¶å‘åº¦ã€‚ ConcurrentHashMap åœ¨ JDK1.7 çš„ç‰ˆæœ¬ç½‘ä¸Šèµ„æ–™å¾ˆå¤šï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»çœ‹çœ‹ã€‚ JDK 1.7 ç‰ˆæœ¬å…³é”®è¦ç´ ï¼š segment ç»§æ‰¿äº† ReentrantLock å……å½“é”çš„è§’è‰²ï¼Œä¸ºæ¯ä¸€ä¸ª segment æä¾›äº†çº¿ç¨‹å®‰å…¨çš„ä¿éšœï¼› segment ç»´æŠ¤äº†å“ˆå¸Œæ•£åˆ—è¡¨çš„è‹¥å¹²ä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶ç”± HashEntry æ„æˆçš„é“¾è¡¨ã€‚ è€Œåˆ°äº† JDK 1.8 çš„ ConcurrentHashMap å°±æœ‰äº†å¾ˆå¤§çš„å˜åŒ–ï¼Œå…‰æ˜¯ä»£ç é‡å°±è¶³è¶³å¢åŠ äº†å¾ˆå¤šã€‚1.8 ç‰ˆæœ¬èˆå¼ƒäº† segmentï¼Œå¹¶ä¸”å¤§é‡ä½¿ç”¨äº† synchronizedï¼Œä»¥åŠ CAS æ— é”æ“ä½œä»¥ä¿è¯ ConcurrentHashMap æ“ä½œçš„çº¿ç¨‹å®‰å…¨æ€§ã€‚è‡³äºä¸ºä»€ä¹ˆä¸ç”¨ ReentrantLock è€Œæ˜¯ Synchronzied å‘¢ï¼Ÿå®é™…ä¸Šï¼Œsynchronzied åšäº†å¾ˆå¤šçš„ä¼˜åŒ–ï¼ŒåŒ…æ‹¬åå‘é”ï¼Œè½»é‡çº§é”ï¼Œé‡é‡çº§é”ï¼Œå¯ä»¥ä¾æ¬¡å‘ä¸Šå‡çº§é”çŠ¶æ€ï¼Œä½†ä¸èƒ½é™çº§ï¼Œå› æ­¤ï¼Œä½¿ç”¨ synchronized ç›¸è¾ƒäº ReentrantLock çš„æ€§èƒ½ä¼šæŒå¹³ç”šè‡³åœ¨æŸäº›æƒ…å†µæ›´ä¼˜ï¼Œå…·ä½“çš„æ€§èƒ½æµ‹è¯•å¯ä»¥å»ç½‘ä¸ŠæŸ¥é˜…ä¸€äº›èµ„æ–™ã€‚å¦å¤–ï¼Œåº•å±‚æ•°æ®ç»“æ„æ”¹å˜ä¸ºé‡‡ç”¨æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„æ•°æ®å½¢å¼ã€‚ ä½œè€…: ä½ å¬___é“¾æ¥ï¼šhttps://juejin.im/post/5aeeaba8f265da0b9d781d16æ¥æºï¼šæ˜é‡‘è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ ä¸HashMapåŒºåˆ«çº¿ç¨‹å®‰å…¨ ä¸ éçº¿ç¨‹å®‰å…¨ çš„åŒºåˆ« å…³é”®å±æ€§å’Œç±»tableæ‰€æœ‰æ•°æ®éƒ½å­˜åœ¨tableä¸­ï¼Œtableçš„å®¹é‡ä¼šæ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæ‰©å®¹ï¼Œtable[i]å­˜æ”¾çš„æ•°æ®ç±»å‹æœ‰ä»¥ä¸‹3ç§ï¼š TreeBin ç”¨äºåŒ…è£…çº¢é»‘æ ‘ç»“æ„çš„ç»“ç‚¹ç±»å‹ ForwardingNode æ‰©å®¹æ—¶å­˜æ”¾çš„ç»“ç‚¹ç±»å‹ï¼Œå¹¶å‘æ‰©å®¹çš„å®ç°å…³é”®ä¹‹ä¸€ Node æ™®é€šç»“ç‚¹ç±»å‹ï¼Œè¡¨ç¤ºé“¾è¡¨å¤´ç»“ç‚¹ ä½œä¸º ConcurrentHashMap çš„æ•°æ®å®¹å™¨ï¼Œé‡‡ç”¨ æ‡’åŠ è½½ çš„æ–¹å¼ï¼Œç›´åˆ°ç¬¬ä¸€æ¬¡æ’å…¥æ•°æ®çš„æ—¶å€™æ‰ä¼šè¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œæ•°ç»„çš„å¤§å°æ€»æ˜¯ä¸º 2 çš„å¹‚æ¬¡æ–¹ã€‚ nextTable12//æ‰©å®¹æ—¶ä½¿ç”¨ï¼Œå¹³æ—¶ä¸º nullï¼Œåªæœ‰åœ¨æ‰©å®¹çš„æ—¶å€™æ‰ä¸ºé nullvolatile Node&lt;K,V&gt;[] nextTable; sizeCtl1private transient volatile int sizeCtl; æ§åˆ¶æ ‡è¯†ç¬¦ï¼Œç”¨æ¥æ§åˆ¶tableçš„åˆå§‹åŒ–å’Œæ‰©å®¹çš„æ“ä½œï¼Œä¸åŒçš„å€¼æœ‰ä¸åŒçš„å«ä¹‰ï¼š å½“ä¸ºè´Ÿæ•°æ—¶ï¼š-1ä»£è¡¨æ­£åœ¨åˆå§‹åŒ–ï¼ˆå…¶å®ä¹Ÿå°±ç›¸å½“äºç¬¬ä¸€æ¬¡æ‰©å®¹ï¼‰ï¼Œ-Nä»£è¡¨æœ‰N-1ä¸ªçº¿ç¨‹æ­£åœ¨å¸®å¿™è¿›è¡Œæ‰©å®¹ å½“ä¸º0æ—¶ï¼šä»£è¡¨å½“æ—¶çš„tableè¿˜æ²¡æœ‰è¢«åˆå§‹åŒ– å½“ä¸ºæ­£æ•°æ—¶ï¼šè¡¨ç¤ºåˆå§‹åŒ–æˆ–è€…ä¸‹ä¸€æ¬¡è¿›è¡Œæ‰©å®¹çš„å¤§å° sizeCtl å˜é‡æ‹…å½“äº† 5 ç§è§’è‰²ï¼Œ è®¾è®¡éå¸¸ç²¾å·§ â‘  é¦–æ¬¡åˆå§‹åŒ–æ—¶ï¼Œ å…¶å˜é‡å«ä¹‰ä¸ºåˆå§‹å®¹é‡ â‘¡ æ‰©å®¹ä»¥åï¼Œ å…¶å€¼ä¸ºè§¦å‘ä¸‹ä¸€æ¬¡æ‰©å®¹çš„å…ƒç´ æ•°é‡é˜ˆå€¼ â‘¢ å…¶æ­£è´ŸçŠ¶æ€ï¼Œ æ ‡è¯†äº†å½“å‰æ•°ç»„æ˜¯å¦å¤„äºæ‰©å®¹çŠ¶æ€ â‘£ sizeCtl ä¸ºè´Ÿå€¼æ—¶ï¼Œé«˜16ä½bitåæ˜ äº†æ­£åœ¨è¿›è¡Œçš„æ‰©å®¹æ“ä½œæ˜¯é’ˆå¯¹å“ªä¸ªå®¹é‡è¿›è¡Œçš„ â‘¤ sizeCtl ä¸ºè´Ÿå€¼æ—¶ï¼Œä½ 16ä½bit åæ˜ äº†å‚ä¸æ­¤æ¬¡æ‰©å®¹çš„çº¿ç¨‹æœ‰å¤šå°‘ä¸ª 1234567891011if tableæœªå®Œæˆåˆå§‹åŒ–: sizeCtl = 0 //æœªæŒ‡å®šåˆå§‹å®¹é‡æ—¶çš„é»˜è®¤å€¼ sizeCtl &gt; 0 //æŒ‡å®šåˆå§‹å®¹é‡(éä¼ å…¥å€¼ï¼Œæ˜¯2çš„å¹‚æ¬¡ä¿®æ­£å€¼)å¤§å°çš„ä¸¤å€ sizeCtl =- 1 //è¡¨æ˜tableæ­£åœ¨åˆå§‹åŒ–else if nextTableä¸ºç©º: if æ‰©å®¹æ—¶å‘ç”Ÿé”™è¯¯(å¦‚å†…å­˜ä¸è¶³ã€table.length * 2 &gt; Integer.MAX_VALUEç­‰): sizeCtl = Integer.MAX_VALUE //ä¸å¿…å†æ‰©å®¹äº†ï¼ else: sizeCtl = table.length * 0.75 //æ‰©å®¹é˜ˆå€¼è°ƒä¸ºtableå®¹é‡å¤§å°çš„0.75å€else: sizeCtl = -(1+N) //Nçš„ä½RESIZE_STAMP_SHIFTä½è¡¨ç¤ºå‚ä¸æ‰©å®¹çº¿ç¨‹æ•°ï¼Œåé¢è¯¦ç»†ä»‹ç» sun.misc.Unsafe Uåœ¨ ConcurrentHashMap çš„å®ç°ä¸­å¯ä»¥çœ‹åˆ°å¤§é‡çš„ U.compareAndSwapXXXX çš„æ–¹æ³•å»ä¿®æ”¹ ConcurrentHashMap çš„ä¸€äº›å±æ€§ã€‚è¿™äº›æ–¹æ³•å®é™…ä¸Šæ˜¯åˆ©ç”¨äº† CAS ç®—æ³• ä¿è¯äº†çº¿ç¨‹å®‰å…¨æ€§ï¼Œè¿™æ˜¯ä¸€ç§ä¹è§‚ç­–ç•¥ï¼Œå‡è®¾æ¯ä¸€æ¬¡æ“ä½œéƒ½ä¸ä¼šäº§ç”Ÿå†²çªï¼Œå½“ä¸”ä»…å½“å†²çªå‘ç”Ÿçš„æ—¶å€™å†å»å°è¯•ã€‚è€Œ CAS æ“ä½œä¾èµ–äºç°ä»£å¤„ç†å™¨æŒ‡ä»¤é›†ï¼Œé€šè¿‡åº•å±‚CMPXCHGæŒ‡ä»¤å®ç°ã€‚CAS(V,O,N)æ ¸å¿ƒæ€æƒ³ä¸ºï¼šè‹¥å½“å‰å˜é‡å®é™…å€¼ V ä¸æœŸæœ›çš„æ—§å€¼ O ç›¸åŒï¼Œåˆ™è¡¨æ˜è¯¥å˜é‡æ²¡è¢«å…¶ä»–çº¿ç¨‹è¿›è¡Œä¿®æ”¹ï¼Œå› æ­¤å¯ä»¥å®‰å…¨çš„å°†æ–°å€¼ N èµ‹å€¼ç»™å˜é‡ï¼›è‹¥å½“å‰å˜é‡å®é™…å€¼ V ä¸æœŸæœ›çš„æ—§å€¼ O ä¸ç›¸åŒï¼Œåˆ™è¡¨æ˜è¯¥å˜é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹åšäº†å¤„ç†ï¼Œæ­¤æ—¶å°†æ–°å€¼ N èµ‹ç»™å˜é‡æ“ä½œå°±æ˜¯ä¸å®‰å…¨çš„ï¼Œåœ¨è¿›è¡Œé‡è¯•ã€‚è€Œåœ¨å¤§é‡çš„åŒæ­¥ç»„ä»¶å’Œå¹¶å‘å®¹å™¨çš„å®ç°ä¸­ä½¿ç”¨ CAS æ˜¯é€šè¿‡sun.misc.Unsafeç±»å®ç°çš„ï¼Œè¯¥ç±»æä¾›äº†ä¸€äº›å¯ä»¥ç›´æ¥æ“æ§å†…å­˜å’Œçº¿ç¨‹çš„åº•å±‚æ“ä½œï¼Œå¯ä»¥ç†è§£ä¸º java ä¸­çš„â€œæŒ‡é’ˆâ€ã€‚è¯¥æˆå‘˜å˜é‡çš„è·å–æ˜¯åœ¨é™æ€ä»£ç å—ä¸­ï¼š 12345678static &#123; try &#123; U = sun.misc.Unsafe.getUnsafe(); ....... &#125; catch (Exception e) &#123; throw new Error(e); &#125;&#125; åœ¨ ConcurrentHashMap ä¸­ï¼Œä¸»è¦ç”¨åˆ° CAS ç®—æ³•çš„æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š tabAt 123static final &lt;K,V&gt; Node&lt;K,V&gt; tabAt(Node&lt;K,V&gt;[] tab, int i) &#123; return (Node&lt;K,V&gt;)U.getObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE);&#125; è¯¥æ–¹æ³•ç”¨æ¥è·å– table æ•°ç»„ä¸­ç´¢å¼•ä¸º i çš„ Node å…ƒç´ ã€‚ casTabAt 1234static final &lt;K,V&gt; boolean casTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; c, Node&lt;K,V&gt; v) &#123; return U.compareAndSwapObject(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, c, v);&#125; åŸºäº CAS å°è¯•æ›´æ–° table ä¸Šä¸‹æ ‡ä¸º i çš„ç»“ç‚¹çš„å€¼ä¸º vã€‚ setTabAt 123static final &lt;K,V&gt; void setTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; v) &#123; U.putObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, v);&#125; ç”¨äºè®¾ç½® table ä¸Šä¸‹æ ‡ä¸º i çš„ç»“ç‚¹ä¸º vï¼Œç›¸å¯¹äº casTabAt æ–¹æ³•çš„åŒºåˆ«åœ¨äºä¸å…³æ³¨å†å²å€¼ã€‚ NodeNode ç±»å®ç°äº† Map.Entry æ¥å£ï¼Œä¸»è¦å­˜æ”¾ key-value å¯¹ï¼Œå¹¶ä¸”å…·æœ‰ next åŸŸï¼Œå¦å¤–å¯ä»¥çœ‹å‡ºå¾ˆå¤šå±æ€§éƒ½æ˜¯ç”¨ volatile è¿›è¡Œä¿®é¥°çš„ï¼Œä¹Ÿå°±æ˜¯ä¸ºäº†ä¿è¯å†…å­˜å¯è§æ€§ã€‚ 1234567static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash; final K key; volatile V val; volatile Node&lt;K,V&gt; next; ......&#125; TreeNodeæ ‘èŠ‚ç‚¹ï¼Œç»§æ‰¿äºæ‰¿è½½æ•°æ®çš„ Node ç±»ã€‚è€Œçº¢é»‘æ ‘çš„æ“ä½œæ˜¯é’ˆå¯¹ TreeBin ç±»çš„ï¼Œä»è¯¥ç±»çš„æ³¨é‡Šä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œä¹Ÿå°±æ˜¯ TreeBin ä¼šå°† TreeNode è¿›è¡Œå†ä¸€æ¬¡å°è£… 1234567891011** * Nodes for use in TreeBins */static final class TreeNode&lt;K,V&gt; extends Node&lt;K,V&gt; &#123; TreeNode&lt;K,V&gt; parent; // red-black tree links TreeNode&lt;K,V&gt; left; TreeNode&lt;K,V&gt; right; TreeNode&lt;K,V&gt; prev; // needed to unlink next upon deletion boolean red; ......&#125; TreeBinè¿™ä¸ªç±»å¹¶ä¸è´Ÿè´£åŒ…è£…ç”¨æˆ·çš„ keyã€value ä¿¡æ¯ï¼Œè€Œæ˜¯åŒ…è£…çš„å¾ˆå¤š TreeNode èŠ‚ç‚¹ã€‚å®é™…çš„ ConcurrentHashMapâ€œæ•°ç»„â€ä¸­ï¼Œå­˜æ”¾çš„æ˜¯ TreeBin å¯¹è±¡ï¼Œè€Œä¸æ˜¯ TreeNode å¯¹è±¡ã€‚ 1234567891011static final class TreeBin&lt;K,V&gt; extends Node&lt;K,V&gt; &#123; TreeNode&lt;K,V&gt; root; volatile TreeNode&lt;K,V&gt; first; volatile Thread waiter; volatile int lockState; // values for lockState static final int WRITER = 1; // set while holding write lock static final int WAITER = 2; // set when waiting for write lock static final int READER = 4; // increment value for setting read lock ......&#125; ForwardingNodeåœ¨æ‰©å®¹æ—¶æ‰ä¼šå‡ºç°çš„ç‰¹æ®ŠèŠ‚ç‚¹ï¼Œåœ¨è½¬ç§»çš„æ—¶å€™æ”¾åœ¨å¤´éƒ¨çš„èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªç©ºèŠ‚ç‚¹ï¼Œå…¶ key,value,hash å…¨éƒ¨ä¸º nullã€‚å¹¶æ‹¥æœ‰ nextTable æŒ‡é’ˆå¼•ç”¨æ–°çš„ table æ•°ç»„ã€‚ 12345678static final class ForwardingNode&lt;K,V&gt; extends Node&lt;K,V&gt; &#123; final Node&lt;K,V&gt;[] nextTable; ForwardingNode(Node&lt;K,V&gt;[] tab) &#123; super(MOVED, null, null, null); this.nextTable = tab; &#125; .....&#125; éƒ¨åˆ† final å¸¸é‡1234567891011121314151617181920212223242526272829// nodeæ•°ç»„æœ€å¤§å®¹é‡ï¼š2^30=1073741824,å› ä¸ºç¬¬ä¸€ä½æ˜¯ç¬¦å·ä½ï¼Œæ‰€ä»¥æ˜¯ 30 æ¬¡å¹‚private static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;// é»˜è®¤åˆå§‹å€¼ï¼Œå¿…é¡»æ˜¯2çš„å¹‚æ•°private static final int DEFAULT_CAPACITY = 16;//æ•°ç»„å¯èƒ½æœ€å¤§å€¼ï¼Œéœ€è¦ä¸toArrayï¼ˆï¼‰ç›¸å…³æ–¹æ³•å…³è”static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;//å¹¶å‘çº§åˆ«ï¼Œé—ç•™ä¸‹æ¥çš„ï¼Œä¸ºå…¼å®¹ä»¥å‰çš„ç‰ˆæœ¬private static final int DEFAULT_CONCURRENCY_LEVEL = 16;// è´Ÿè½½å› å­private static final float LOAD_FACTOR = 0.75f;// é“¾è¡¨è½¬çº¢é»‘æ ‘é˜€å€¼,&gt; 8 é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘static final int TREEIFY_THRESHOLD = 8;//æ ‘è½¬é“¾è¡¨é˜€å€¼ï¼Œå°äºç­‰äº6ï¼ˆtranferæ—¶ï¼Œlcã€hc=0ä¸¤ä¸ªè®¡æ•°å™¨åˆ†åˆ«++è®°å½•åŸbinã€æ–°binTreeNodeæ•°é‡ï¼Œ&lt;=UNTREEIFY_THRESHOLD åˆ™untreeify(lo)ï¼‰static final int UNTREEIFY_THRESHOLD = 6;static final int MIN_TREEIFY_CAPACITY = 64;private static final int MIN_TRANSFER_STRIDE = 16;private static int RESIZE_STAMP_BITS = 16;// 2^15-1ï¼Œhelp resizeçš„æœ€å¤§çº¿ç¨‹æ•°private static final int MAX_RESIZERS = (1 &lt;&lt; (32 - RESIZE_STAMP_BITS)) - 1;// 32-16=16ï¼ŒsizeCtlä¸­è®°å½•sizeå¤§å°çš„åç§»é‡private static final int RESIZE_STAMP_SHIFT = 32 - RESIZE_STAMP_BITS;// forwarding nodesçš„hashå€¼static final int MOVED = -1; // æ ‘æ ¹èŠ‚ç‚¹çš„hashå€¼static final int TREEBIN = -2; // ReservationNodeçš„hashå€¼static final int RESERVED = -3; // å¯ç”¨å¤„ç†å™¨æ•°é‡static final int NCPU = Runtime.getRuntime().availableProcessors(); ä¸»è¦æ–¹æ³•æ„é€ å‡½æ•°åœ¨ä½¿ç”¨ ConcurrentHashMap ç¬¬ä¸€ä»¶äº‹è‡ªç„¶è€Œç„¶å°±æ˜¯ new å‡ºæ¥ä¸€ä¸ª ConcurrentHashMap å¯¹è±¡ï¼Œä¸€å…±æä¾›äº†å¦‚ä¸‹å‡ ä¸ªæ„é€ å™¨æ–¹æ³•ï¼š 12345678910// 1. æ„é€ ä¸€ä¸ªç©ºçš„mapï¼Œå³tableæ•°ç»„è¿˜æœªåˆå§‹åŒ–ï¼Œåˆå§‹åŒ–æ”¾åœ¨ç¬¬ä¸€æ¬¡æ’å…¥æ•°æ®æ—¶ï¼Œé»˜è®¤å¤§å°ä¸º16ConcurrentHashMap()// 2. ç»™å®šmapçš„å¤§å°ConcurrentHashMap(int initialCapacity)// 3. ç»™å®šä¸€ä¸ªmapConcurrentHashMap(Map&lt;? extends K, ? extends V&gt; m)// 4. ç»™å®šmapçš„å¤§å°ä»¥åŠåŠ è½½å› å­ConcurrentHashMap(int initialCapacity, float loadFactor)// 5. ç»™å®šmapå¤§å°ï¼ŒåŠ è½½å› å­ä»¥åŠå¹¶å‘åº¦ï¼ˆé¢„è®¡åŒæ—¶æ“ä½œæ•°æ®çš„çº¿ç¨‹ï¼Œjdk1.8åŸºæœ¬ä¸ç”¨ï¼‰ConcurrentHashMap(int initialCapacity,float loadFactor, int concurrencyLevel) ConcurrentHashMap ä¸€å…±ç»™æˆ‘ä»¬æä¾›äº† 5 ç§æ„é€ å™¨æ–¹æ³•ï¼Œå…·ä½“ä½¿ç”¨è¯·çœ‹æ³¨é‡Šï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬ 2 ç§æ„é€ å™¨ï¼Œä¼ å…¥æŒ‡å®šå¤§å°æ—¶çš„æƒ…å†µï¼Œè¯¥æ„é€ å™¨æºç ä¸ºï¼š 123456789101112public ConcurrentHashMap(int initialCapacity) &#123; //1. å°äº0ç›´æ¥æŠ›å¼‚å¸¸ if (initialCapacity &lt; 0) throw new IllegalArgumentException(); //2. åˆ¤æ–­æ˜¯å¦è¶…è¿‡äº†å…è®¸çš„æœ€å¤§å€¼ï¼Œè¶…è¿‡äº†è¯åˆ™å–æœ€å¤§å€¼ï¼Œå¦åˆ™å†å¯¹è¯¥å€¼è¿›ä¸€æ­¥å¤„ç† // è‡³äºä¸ºä»€ä¹ˆè¿™æ ·å–è¿™ä¸ªå€¼...æš‚æ—¶æˆ‘è¿˜æ²¡ææ‡‚ï¼Œåé¢ä¹Ÿæœ‰tryPresize()ä¹Ÿæ˜¯è¿™æ · int cap = ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY : tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; 1) + 1)); //3. èµ‹å€¼ç»™sizeCtl this.sizeCtl = cap;&#125; è¿™æ®µä»£ç çš„é€»è¾‘è¯·çœ‹æ³¨é‡Šï¼Œå¾ˆå®¹æ˜“ç†è§£ï¼Œå¦‚æœå°äº 0 å°±ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæŒ‡å®šå€¼å¤§äºäº†æ‰€å…è®¸çš„æœ€å¤§å€¼çš„è¯å°±å–æœ€å¤§å€¼ï¼Œå¦åˆ™ï¼Œåœ¨å¯¹æŒ‡å®šå€¼åšè¿›ä¸€æ­¥å¤„ç†ã€‚æœ€åå°† cap èµ‹å€¼ç»™ sizeCtl,å…³äº sizeCtl çš„è¯´æ˜è¯·çœ‹ä¸Šé¢çš„è¯´æ˜ï¼Œå½“è°ƒç”¨æ„é€ å™¨æ–¹æ³•ä¹‹åï¼ŒsizeCtl çš„å¤§å°åº”è¯¥å°±ä»£è¡¨äº† ConcurrentHashMap çš„å¤§å°ï¼Œå³ table æ•°ç»„é•¿åº¦ã€‚tableSizeFor åšäº†å“ªäº›äº‹æƒ…äº†ï¼Ÿæºç ä¸ºï¼š 12345678910111213/** * Returns a power of two table size for the given desired capacity. * See Hackers Delight, sec 3.2 */private static final int tableSizeFor(int c) &#123; int n = c - 1; n |= n &gt;&gt;&gt; 1; n |= n &gt;&gt;&gt; 2; n |= n &gt;&gt;&gt; 4; n |= n &gt;&gt;&gt; 8; n |= n &gt;&gt;&gt; 16; return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;&#125; é€šè¿‡æ³¨é‡Šå°±å¾ˆæ¸…æ¥šäº†ï¼Œè¯¥æ–¹æ³•ä¼šå°†è°ƒç”¨æ„é€ å™¨æ–¹æ³•æ—¶æŒ‡å®šçš„å¤§å°è½¬æ¢æˆä¸€ä¸ª 2 çš„å¹‚æ¬¡æ–¹æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ ConcurrentHashMap çš„å¤§å°ä¸€å®šæ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼Œæ¯”å¦‚ï¼Œå½“æŒ‡å®šå¤§å°ä¸º 18 æ—¶ï¼Œä¸ºäº†æ»¡è¶³ 2 çš„å¹‚æ¬¡æ–¹ç‰¹æ€§ï¼Œå®é™…ä¸Š concurrentHashMapd çš„å¤§å°ä¸º 2 çš„ 5 æ¬¡æ–¹ï¼ˆ32ï¼‰ã€‚å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè°ƒç”¨æ„é€ å™¨æ–¹æ³•çš„æ—¶å€™å¹¶æœªæ„é€ å‡º table æ•°ç»„ï¼ˆå¯ä»¥ç†è§£ä¸º ConcurrentHashMap çš„æ•°æ®å®¹å™¨ï¼‰ï¼Œåªæ˜¯ç®—å‡º table æ•°ç»„çš„é•¿åº¦ï¼Œå½“ç¬¬ä¸€æ¬¡å‘ ConcurrentHashMap æ’å…¥æ•°æ®çš„æ—¶å€™æ‰çœŸæ­£çš„å®Œæˆåˆå§‹åŒ–åˆ›å»º table æ•°ç»„çš„å·¥ä½œã€‚ åˆå§‹åŒ–tableæ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š åˆ¤æ–­ sizeCtl å€¼æ˜¯å¦å°äº 0ï¼Œå¦‚æœå°äº 0 åˆ™è¡¨ç¤º ConcurrentHashMap æ­£åœ¨æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œæ‰€ä»¥éœ€è¦å…ˆç­‰å¾…ä¸€ä¼šï¼Œå¦‚æœå…¶å®ƒçº¿ç¨‹åˆå§‹åŒ–å¤±è´¥è¿˜å¯ä»¥é¡¶æ›¿ä¸Šå» å¦‚æœ sizeCtl å€¼å¤§äºç­‰äº 0ï¼Œåˆ™åŸºäº CAS ç­–ç•¥æŠ¢å æ ‡è®° sizeCtl ä¸º -1ï¼Œè¡¨ç¤º ConcurrentHashMap æ­£åœ¨æ‰§è¡Œåˆå§‹åŒ–ï¼Œç„¶åæ„é€  tableï¼Œå¹¶æ›´æ–° sizeCtl çš„å€¼ 1234567891011121314151617181920212223242526private final Node&lt;K,V&gt;[] initTable() &#123; Node&lt;K,V&gt;[] tab; int sc; while ((tab = table) == null || tab.length == 0) &#123; if ((sc = sizeCtl) &lt; 0) // 1. ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œå‘ç°sizeCtlä¸ºè´Ÿæ•°æ—¶ï¼Œå¾—è®©å‡ºæ—¶é—´ç‰‡ç­‰å¾… Thread.yield(); // lost initialization race; just spin else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) &#123; try &#123; if ((tab = table) == null || tab.length == 0) &#123; // 2. å¾—å‡ºæ•°ç»„çš„å¤§å° int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY; @SuppressWarnings("unchecked") // 3. è¿™é‡Œæ‰çœŸæ­£çš„åˆå§‹åŒ–æ•°ç»„ Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; table = tab = nt; // 4. è®¡ç®—æ•°ç»„ä¸­å¯ç”¨çš„å¤§å°ï¼šå®é™…å¤§å°n*0.75ï¼ˆåŠ è½½å› å­ï¼‰ sc = n - (n &gt;&gt;&gt; 2); &#125; &#125; finally &#123; sizeCtl = sc; &#125; break; &#125; &#125; return tab;&#125; put() ã€é‡ç‚¹ï¼Œæœ‰å¾ˆå¤šå¼•ç”³ï¼ŒåŒ…æ‹¬æ‰©å®¹ã€‘å…ˆæ”¾æºç ï¼Œç„¶åæˆ‘ä»¬æ…¢æ…¢æ¥åˆ†æä¸€æ³¢ï¼Œè¿™æ˜¯æ•´ä¸ª ConcurrentHashMap() çš„æ ¸å¿ƒï¼Œæˆ‘ä»¬ä»¥ç‚¹æ¨é¢ï¼Œå°† put() ç”¨åˆ°çš„æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„å‡½æ•°éƒ½æŒ‘å‡ºæ¥è®²ä¸€è®²ï¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970public V put(K key, V value) &#123; return putVal(key, value, false);&#125;/** Implementation for put and putIfAbsent */final V putVal(K key, V value, boolean onlyIfAbsent) &#123; if (key == null || value == null) throw new NullPointerException(); int hash = spread(key.hashCode()); //1.ä¸¤æ¬¡hashï¼Œå‡å°‘hashå†²çªï¼Œå¯ä»¥å‡åŒ€åˆ†å¸ƒï¼Œåé¢ä¼šè®² int binCount = 0; //ç”¨äºè®°å½•å…ƒç´ ä¸ªæ•°,ä¹Ÿå°±æ˜¯é“¾è¡¨é•¿åº¦ for (Node&lt;K,V&gt;[] tab = table;;) &#123; //å¯¹è¿™ä¸ªtableè¿›è¡Œè¿­ä»£ Node&lt;K,V&gt; f; int n, i, fh; //2.è¿™é‡Œå°±æ˜¯ä¸Šé¢æ„é€ æ–¹æ³•æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œåœ¨è¿™é‡Œè¿›è¡Œåˆ¤æ–­ï¼Œä¸ºnullå°±è°ƒç”¨initTableè¿›è¡Œåˆå§‹åŒ–ï¼Œå±äºæ‡’æ±‰æ¨¡å¼åˆå§‹åŒ– if (tab == null || (n = tab.length) == 0) tab = initTable(); //ä¸Šé¢å·²ç»è®²è¿‡äº† else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) &#123;//3.å¦‚æœiä½ç½®æ²¡æœ‰æ•°æ®ï¼Œå°±ç›´æ¥æ— é”CASæ’å…¥,ä¸Šæ–‡å·²ç»è®²è¿‡äº† if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value, null))) break; // no lock when adding to empty bin &#125; else if ((fh = f.hash) == MOVED)//4.å¦‚æœåœ¨è¿›è¡Œæ‰©å®¹(å½“å‰èŠ‚ç‚¹æ˜¯forwardingNode)ï¼Œåˆ™å…ˆè¿›è¡Œæ‰©å®¹æ“ä½œ tab = helpTransfer(tab, f); //åé¢ä¼šè¯¦è§£ else &#123; V oldVal = null; //5.å¦‚æœä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œé‚£å°±è¦è¿›è¡ŒåŠ é”æ“ä½œï¼Œå³å­˜åœ¨hashå†²çªï¼Œé”ä½é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘çš„å¤´ç»“ç‚¹ synchronized (f) &#123; if (tabAt(tab, i) == f) &#123; //fæ”¹å˜å†æ¬¡å¾ªç¯ if (fh &gt;= 0) &#123; //è¡¨ç¤ºè¯¥èŠ‚ç‚¹æ˜¯é“¾è¡¨ç»“æ„(çº¢é»‘æ ‘ -2ï¼Œæˆ–è€…æ­£åœ¨è½¬ç§»éƒ½ä¸ºè´Ÿæ•°) binCount = 1; for (Node&lt;K,V&gt; e = f;; ++binCount) &#123; K ek; //è¿™é‡Œæ¶‰åŠåˆ°ç›¸åŒçš„keyè¿›è¡Œputå°±ä¼šè¦†ç›–åŸå…ˆçš„value if (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) &#123; oldVal = e.val; if (!onlyIfAbsent) //åªæœ‰ä¸å­˜åœ¨çš„æ—¶å€™æ‰æ’å…¥ e.val = value; break; &#125; Node&lt;K,V&gt; pred = e; if ((e = e.next) == null) &#123; //æ’å…¥é“¾è¡¨å°¾éƒ¨ pred.next = new Node&lt;K,V&gt;(hash, key, value, null); break; &#125; &#125; &#125; else if (f instanceof TreeBin) &#123;//çº¢é»‘æ ‘ç»“æ„ Node&lt;K,V&gt; p; binCount = 2; //çº¢é»‘æ ‘ç»“æ„æ—‹è½¬æ’å…¥ if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != null) &#123; oldVal = p.val; if (!onlyIfAbsent) p.val = value; &#125; &#125; &#125; &#125; if (binCount != 0) &#123; //6.å¦‚æœé“¾è¡¨çš„é•¿åº¦å¤§äº8æ—¶å°±ä¼šè¿›è¡Œçº¢é»‘æ ‘çš„è½¬æ¢ if (binCount &gt;= TREEIFY_THRESHOLD) treeifyBin(tab, i); if (oldVal != null) return oldVal; break; &#125; &#125; &#125; addCount(1L, binCount);//7.ç»Ÿè®¡sizeï¼Œå¹¶ä¸”æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ return null; æ•…æ•´ä¸ª put() çš„æµç¨‹åˆ†ä¸º 7 æ­¥ï¼š 1.è°ƒç”¨ spread()ï¼Œè¿›è¡Œä¸¤æ¬¡å“ˆå¸Œ 2.å¦‚æœæ²¡æœ‰åˆå§‹åŒ–å°±å…ˆè°ƒç”¨ initTable() æ–¹æ³•æ¥è¿›è¡Œåˆå§‹åŒ–è¿‡ç¨‹ 3.å¦‚æœæ²¡æœ‰hashå†²çªå°±ç›´æ¥ CAS æ’å…¥ 4.å¦‚æœè¿˜åœ¨è¿›è¡Œæ‰©å®¹æ“ä½œå°±å…ˆè¿›è¡Œæ‰©å®¹ 5.å¦‚æœå­˜åœ¨hashå†²çªï¼Œå°±åŠ é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯é“¾è¡¨å½¢å¼å°±ç›´æ¥éå†åˆ°å°¾ç«¯æ’å…¥ï¼Œä¸€ç§æ˜¯çº¢é»‘æ ‘å°±æŒ‰ç…§çº¢é»‘æ ‘ç»“æ„æ’å…¥ 6.æœ€åä¸€ä¸ªå¦‚æœè¯¥é“¾è¡¨çš„æ•°é‡å¤§äºé˜ˆå€¼8ï¼Œå°±è¦å…ˆè½¬æ¢æˆé»‘çº¢æ ‘çš„ç»“æ„ï¼Œbreakå†ä¸€æ¬¡è¿›å…¥å¾ªç¯ 7.å¦‚æœæ·»åŠ æˆåŠŸå°±è°ƒç”¨ addCount() æ–¹æ³•ç»Ÿè®¡ sizeï¼Œå¹¶ä¸”æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ æ¥ä¸‹æ¥é’ˆå¯¹æ¯ä¸€æ­¥è¿›è¡Œç»†è‡´çš„åˆ†æï¼ŒåŒ…æ‹¬å†…éƒ¨å‡½æ•°çš„å…·ä½“å®ç°ï¼ spread()é¦–å…ˆæ˜¯ spread() å‡½æ•°ï¼å…ˆä¸Šæºç ï¼ 1234static final int HASH_BITS = 0x7fffffff; // usable bits of normal node hashstatic final int spread(int h) &#123; return (h ^ (h &gt;&gt;&gt; 16)) &amp; HASH_BITS;&#125; å°±æ˜¯æˆ‘ä»¬åœ¨ HashMap ç« èŠ‚è®²è¿‡çš„ï¼Œå°† hashcode å€¼çš„ä½16ä½å’Œé«˜16ä½ ç›¸å¼‚æˆ–ï¼Œä¹Ÿç§°ä¹‹ä¸º æ‰°åŠ¨å‡½æ•°ï¼ initTable() &amp; tabAt() &amp; casTabAt()ä¸Šæ–‡å·²ç»è®²è¿‡è¿™ä¸‰ä¸ªå‡½æ•°äº†ï¼Œè®©æˆ‘ä»¬ go onï¼ï¼ helpTransfer()å¦‚æœåœ¨è¿›è¡Œæ‰©å®¹ï¼Œåˆ™å…ˆè¿›è¡Œæ‰©å®¹æ“ä½œï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯å¸®åŠ©æ‰©å®¹çš„ï¼è¿™æ ·å¯ä»¥æé«˜æ‰©å®¹çš„é€Ÿåº¦ï¼ è¯¥æ–¹æ³•çš„ä¸»è¦ä½œç”¨å°±æ˜¯åŸºäº CAS å°è¯•æ·»åŠ ä¸€ä¸ªçº¿ç¨‹å»ååŠ©æ‰©å®¹æ“ä½œï¼Œå¦‚æœèƒ½å¤ŸæˆåŠŸåŠ å…¥åˆ™å°† sizeCtl å€¼åŠ  1ã€‚æ–¹æ³• transfer æ˜¯çœŸæ­£æ‰§è¡Œæ‰©å®¹æ“ä½œçš„åœ°æ–¹ï¼Œå¹¶åœ¨å¤šä¸ªæ­¥éª¤ä¸­è¢«è§¦å‘ã€‚è¿™é‡Œå…ˆç»™å‡ºè¯¥æ–¹æ³•çš„å®šä¹‰ï¼ˆå¦‚ä¸‹ï¼‰ï¼Œå…·ä½“çš„å®ç°åé¢ä¼šä¸“é—¨è¿›è¡Œåˆ†æï¼Œè¯¥æ–¹æ³•æ¥æ”¶ 2 ä¸ªå‚æ•°ï¼Œå…¶ä¸­ tab æ˜¯å½“å‰éœ€è¦è¢«æ‰©å®¹çš„ tableï¼Œè€Œ nextTab æ˜¯æ‰©å®¹ä¹‹åçš„ tableï¼Œå®¹é‡ä¸Šæ˜¯ä¹‹å‰çš„ä¸¤å€ï¼ŒhelpTransfer ä¼ é€’çš„ nextTab æ˜¯ä¸€ä¸ªé null å€¼ï¼Œå› ä¸ºè§¦å‘ helpTransfer çš„å‰æå°±æ˜¯å½“å‰å·²ç»å¤„äºæ‰©å®¹é˜¶æ®µã€‚ 1234567891011121314151617181920212223242526272829303132 /** * Helps transfer if a resize is in progress. * å¸®åŠ©ä»æ—§çš„tableçš„å…ƒç´ å¤åˆ¶åˆ°æ–°çš„tableä¸­ */final Node&lt;K,V&gt;[] helpTransfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt; f) &#123; Node&lt;K,V&gt;[] nextTab; int sc; // æ–°çš„table nextTabå·²ç»å­˜åœ¨å‰æä¸‹æ‰èƒ½å¸®åŠ©æ‰©å®¹ // å½“å‰ç»“ç‚¹æ˜¯ ForwardingNode ç±»å‹ if (tab != null &amp;&amp; (f instanceof ForwardingNode) &amp;&amp; (nextTab = ((ForwardingNode&lt;K,V&gt;)f).nextTable) != null) &#123; int rs = resizeStamp(tab.length); // ä¸‹é¢ä¼šè®²ï¼Œæ‰©å®¹æˆ³ while (nextTab == nextTable &amp;&amp; table == tab &amp;&amp; (sc = sizeCtl) &lt; 0) &#123; // æ¡ä»¶1åˆ¤æ–­æ˜¯å¦ä¸ºå½“å‰æ‰©å®¹æˆ³ // æ¡ä»¶2åˆ¤æ–­æ˜¯å¦æ‰©å®¹ç»“æŸ // æ¡ä»¶3åˆ¤æ–­æ‰©å®¹çº¿ç¨‹æ˜¯å¦å·²ç»è¶…è¿‡æœ€å¤§å¹¶å‘æ‰©å®¹çº¿ç¨‹æ•° (è¿™å…¶å®æ˜¯ä¸€ä¸ªbug,è§ä¸‹é¢è¯¦è§£) // æ¡ä»¶4åˆ¤æ–­å½“å‰æ˜¯å¦æœ‰å¯ä»¥åˆ†é…çš„ä»»åŠ¡ // sc=((rs=resizeStamp())&lt;&lt;&lt;RESIZE_STAMP_SHIFT ) // sc é«˜16ä½ç”¨äºè®°å½•æœ¬æ¬¡æ‰©å®¹æˆ³,ä½16ä½ç”¨äºè®°å½•æ‰©å®¹çº¿ç¨‹æ•°é‡,rs = sc - 1 if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 || sc == rs + MAX_RESIZERS || transferIndex &lt;= 0) break; // åŸºäº CAS å°† æ‰©å®¹çº¿ç¨‹æ•° + 1ï¼Œè¯´æ˜åˆæœ‰ä¸€ä¸ªçº¿ç¨‹åŠ å…¥æ‰©å®¹äº† if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1)) &#123; transfer(tab, nextTab);// è°ƒç”¨æ‰©å®¹æ–¹æ³•ï¼Œæ‰©å®¹æœ€æ ¸å¿ƒçš„å‡½æ•° break; &#125; &#125; return nextTab; &#125; return table;&#125; åœ¨ helptransfer() ä¸­ï¼Œè°ƒç”¨äº† resizeStamp() å‡½æ•°(å½“ç„¶è¿˜æœ‰ transfer()ï¼Œè¿™ä¸ªæ˜¯æ‰©å®¹æ ¸å¿ƒä»£ç ï¼Œä¸‹é¢å•ç‹¬ä¼šæ‹å‡ºæ¥è®²)ï¼Œæˆ‘ä»¬ç°åœ¨åˆ†æä¸€ä¸‹è¿™ä¸¤ä¸ªå‡½æ•°ï¼ 123456789 /* ---------------- Table Initialization and Resizing -------------- */// ç”Ÿæˆè¡¨çš„æ‰©å®¹æˆ³ï¼Œæ¯ä¸ªnéƒ½æœ‰ä¸åŒçš„æ‰©å®¹æˆ³ /** * Returns the stamp bits for resizing a table of size n. * Must be negative when shifted left by RESIZE_STAMP_SHIFT. */ static final int resizeStamp(int n) &#123; return Integer.numberOfLeadingZeros(n) | (1 &lt;&lt; (RESIZE_STAMP_BITS - 1)); &#125; Integer.numberOfLeadingZeros(n) åœ¨æŒ‡å®š int å€¼çš„äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºå½¢å¼ä¸­æœ€é«˜ä½ï¼ˆæœ€å·¦è¾¹ï¼‰çš„ 1 ä½ä¹‹å‰ï¼Œè¿”å›é›¶ä½çš„æ•°é‡ã€‚å…·ä½“æˆ‘ä¹Ÿä¸æ‡‚å•¥æ„æ€ï¼Œåæ­£å°±æ˜¯ä¼šç”Ÿæˆä¸€ä¸ªç‰¹æ®Šçš„æ‰©å®¹æˆ³ï¼ treeifyBin()æ¥åˆ°è¿™é‡Œï¼Œå°±æ˜¯ put() çš„ç¬¬å…­æ­¥äº†ï¼Œä¸Šæºç ï¼ 12345678910111213141516171819202122232425262728293031private final void treeifyBin(Node&lt;K, V&gt;[] tab, int index) &#123; Node&lt;K, V&gt; b; int n, sc; if (tab != null) &#123; // 1. å¦‚æœ table é•¿åº¦å°äº 64ï¼Œæ‰§è¡Œæ‰©å®¹æ“ä½œ if ((n = tab.length) &lt; MIN_TREEIFY_CAPACITY) &#123; this.tryPresize(n &lt;&lt; 1); &#125; // 2. å¦åˆ™ï¼Œå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ else if ((b = tabAt(tab, index)) != null &amp;&amp; b.hash &gt;= 0) &#123; // å¤´ç»“ç‚¹ hash å¤§äº 0ï¼Œè¯´æ˜æ˜¯é“¾è¡¨ synchronized (b) &#123; if (tabAt(tab, index) == b) &#123; TreeNode&lt;K, V&gt; hd = null, tl = null; // å°†é“¾è¡¨è½¬æ¢æˆä¸€æ£µçº¢é»‘æ ‘ for (Node&lt;K, V&gt; e = b; e != null; e = e.next) &#123; TreeNode&lt;K, V&gt; p = new TreeNode&lt;&gt;(e.hash, e.key, e.val, null, null); if ((p.prev = tl) == null) &#123; hd = p; &#125; else &#123; tl.next = p; &#125; tl = p; &#125; // å°†çº¢é»‘æ ‘è®¾ç½®åˆ° table å¯¹åº”çš„ä½ç½® // æ³¨æ„å“¦ï¼Œæ•°ç»„ä¸­å­˜å‚¨çš„å¯æ˜¯ TreeBin setTabAt(tab, index, new TreeBin&lt;&gt;(hd)); &#125; &#125; &#125; &#125;&#125; ç»†å¿ƒçš„å°ä¼™ä¼´å‘ç°äº†ï¼Œè¿™é‡Œåˆæœ‰ä¸€ä¸ªæ‰©å®¹æ“ä½œçš„å‡½æ•° tryPresize() ï¼Œæ¥ï¼Œå’±ä¸èƒ½æ”¾è¿‡å®ƒï¼Œè¿›å»çœ‹çœ‹ï¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849private final void tryPresize(int size) &#123; // å¦‚æœå½“å‰æœŸæœ›çš„å¤§å°ï¼ˆsizeï¼‰å°äºæœ€å¤§å…è®¸å®¹é‡çš„ä¸€åŠï¼Œåˆ™æ‰©å®¹å¤§å°ä¸º size çš„ 1.5 å€åŠ  1ï¼Œåœ¨å‘ä¸Šå–æœ€å°çš„ 2 æ¬¡å¹‚,æ³¨æ„å“¦ï¼Œè¿™é‡Œçš„ size ä¼ è¿›æ¥çš„æ—¶å€™å°±å·²ç»æ˜¯åŸæ•°ç»„çš„ä¸¤å€å¤§å°äº†ï¼ï¼ï¼ // è¿™é‡Œæˆ‘æ²¡ææ¸…ä»–è¦å¹²å˜›... å› ä¸º c å¯æ˜¯ä¸€æ¬¡æ€§æ‰©äº†å¥½å¤šå€ // çœŸæ­£å»æ‰§è¡Œæ‰©å®¹çš„è¿˜æ˜¯ transfer è¿™ä¸ªå‡½æ•° int c = (size &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY : tableSizeFor(size + (size &gt;&gt;&gt; 1) + 1); int sc; while ((sc = sizeCtl) &gt;= 0) &#123; // æ£€æŸ¥å½“å‰æœªå¤„äºæ‰©å®¹é˜¶æ®µ Node&lt;K, V&gt;[] tab = table; int n; // åˆå§‹åŒ– nextTable if (tab == null || (n = tab.length) == 0) &#123; n = (sc &gt; c) ? sc : c; if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) &#123; try &#123; if (table == tab) &#123; @SuppressWarnings("unchecked") Node&lt;K, V&gt;[] nt = (Node&lt;K, V&gt;[]) new Node&lt;?, ?&gt;[n]; table = nt; sc = n - (n &gt;&gt;&gt; 2); &#125; &#125; finally &#123; sizeCtl = sc; &#125; &#125; &#125; else if (c &lt;= sc || n &gt;= MAXIMUM_CAPACITY) &#123; break; &#125; else if (tab == table) &#123; int rs = resizeStamp(n); // 2. åŸºäº CAS å°† sc çš„å€¼åŠ  1ï¼Œç„¶åæ‰§è¡Œ transfer æ–¹æ³• if (sc &lt; 0) &#123; Node&lt;K, V&gt;[] nt; if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 || sc == rs + MAX_RESIZERS || (nt = nextTable) == null || transferIndex &lt;= 0) &#123; break; &#125; if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1)) &#123; // æ‰§è¡Œ transfer æ–¹æ³• this.transfer(tab, nt); &#125; &#125; // 1. åŸºäº CAS å°† sizeCtl çš„å€¼è®¾ç½®ä¸º (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2 else if (U.compareAndSwapInt(this, SIZECTL, sc, (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2)) &#123; // æ‰§è¡Œ transfer æ–¹æ³•ï¼Œæ­¤æ—¶ nextTable æ˜¯ null this.transfer(tab, null); &#125; &#125; &#125;&#125; è¯¥æ–¹æ³•çš„æ ¸å¿ƒæ“ä½œåœ¨äºæœ€åä¸€ä¸ªæ·»åŠ  transfer ä»»åŠ¡ï¼Œå¹¶è®¾ç½® sizeCtl å€¼ï¼Œè¯¥æ–¹æ³•ç¬¬ä¸€æ¬¡è°ƒç”¨ transfer æ–¹æ³•æ—¶ sizeCtl ä¸€å®šæ˜¯å¤§äºç­‰äº 0 çš„ï¼Œæ‰€ä»¥æ–¹æ³•ä¼šå°è¯•å°† sizeCtl è®¾ç½®ä¸º (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2ï¼Œè¿™æ˜¯å¤§è´Ÿæ•°ï¼Œå¹¶æ‰§è¡Œ transfer(tab, null) æ“ä½œï¼Œåé¢çš„å¾ªç¯ sizeCtl å‡å°äº 0ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œ transfer(tab, nt)ï¼Œå¹¶å°† sizeCtl åŠ  1ã€‚æ³¨æ„æ•´ä¸ªè¿‡ç¨‹ä¸­ sizeCtl å€¼çš„å˜åŒ–ï¼Œåœ¨ä¸€æ¬¡æ‰©å®¹æ“ä½œä¸­ç¬¬ä¸€æ¬¡è°ƒç”¨ transfer æ–¹æ³•æ—¶å°† sizeCtl è®¾ç½®ä¸º (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2ï¼Œå¹¶åœ¨æ‰©å®¹è¿‡ç¨‹å†æ¬¡è°ƒç”¨ transfer æ–¹æ³•æ—¶å°† sizeCtl åŠ  1ã€‚è¿™å¯¹äºä¸‹ä¸€èŠ‚ç†è§£æ‰©å®¹æ“ä½œä»€ä¹ˆæ—¶å€™ç»“æŸè‡³å…³é‡è¦ã€‚ transfer()æ¥äº†ï¼Œå®ƒç»ˆäºæ¥äº†â€¦åœ¨ä¹‹å‰æˆ‘ä»¬å·²ç»é“ºå«äº†å¾ˆä¹…äº†ï¼Œæœ¬æ¥æ˜¯æ‰“ç®—å†æ”¾åˆ°åé¢ä¸€ç‚¹çš„ï¼Œå› ä¸ºåœ¨ put() çš„ç¬¬ä¸ƒæ­¥ addCount() æ–¹æ³•ä¸­ä¹Ÿè°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯â€¦ æˆ‘å¿ä¸ä½äº†ï¼ï¼ï¼ åœ¨è®² transfer() ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹æ€»å…±æœ‰å“ªäº›å‡½æ•°è°ƒç”¨äº†å®ƒï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦åœ¨ä»€ä¹ˆæ—¶å€™æ‰©å®¹å‘¢ï¼Ÿ helpTransfer()ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¦å¯¹tableä¸­å…ƒç´ è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœæ£€æµ‹åˆ°èŠ‚ç‚¹çš„HASHå€¼ä¸ºMOVEDçš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨helpTransferæ–¹æ³•ï¼Œåœ¨helpTransferä¸­å†è°ƒç”¨transferæ–¹æ³•æ¥å¸®åŠ©å®Œæˆæ•°ç»„çš„æ‰©å®¹ã€‚ tryPresize()ã€‚treeIfybin å’Œ putAll æ–¹æ³•ä¸­è°ƒç”¨ï¼ŒtreeIfybin ä¸»è¦æ˜¯åœ¨putæ·»åŠ å…ƒç´ å®Œä¹‹åï¼Œåˆ¤æ–­è¯¥æ•°ç»„èŠ‚ç‚¹ç›¸å…³å…ƒç´ æ˜¯ä¸æ˜¯å·²ç»è¶…è¿‡8ä¸ªçš„æ—¶å€™ï¼Œå¦‚æœè¶…è¿‡åˆ™ä¼šè°ƒç”¨è¿™ä¸ª tryPresize æ–¹æ³•æ¥æ‰©å®¹æ•°ç»„æˆ–è€…æŠŠé“¾è¡¨è½¬ä¸ºæ ‘ã€‚ addCount()ã€‚å½“å¯¹æ•°ç»„è¿›è¡Œæ“ä½œï¼Œä½¿å¾—æ•°ç»„ä¸­å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°å‘ç”Ÿäº†å˜åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨çš„æ–¹æ³•ã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œä¹Ÿå°±æ˜¯ä¸¤ç§æƒ…å†µï¼š åªæœ‰åœ¨å¾€mapä¸­æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œåœ¨æŸä¸€ä¸ªèŠ‚ç‚¹çš„æ•°ç›®å·²ç»è¶…è¿‡äº†8ä¸ªï¼ŒåŒæ—¶æ•°ç»„çš„é•¿åº¦åˆå°äº64çš„æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘æ•°ç»„çš„æ‰©å®¹ã€‚ å½“æ•°ç»„ä¸­å…ƒç´ è¾¾åˆ°äº†sizeCtlçš„æ•°é‡çš„æ—¶å€™ï¼Œåˆ™ä¼šè°ƒç”¨transferæ–¹æ³•æ¥è¿›è¡Œæ‰©å®¹ã€‚ æ‰©å®¹æ“ä½œç®€å•åœ°è¯´å°±æ˜¯æ–°å»ºä¸€ä¸ªé•¿åº¦ç¿»å€çš„ nextTableï¼Œç„¶åå°†ä¹‹å‰ table ä¸Šçš„ç»“ç‚¹é‡æ–°å“ˆå¸Œè¿ç§»åˆ°æ–°çš„ nextTable ä¸Šï¼Œå¹¶åœ¨è¿ç§»å®Œæˆä¹‹åä½¿ç”¨ nextTable æ›¿æ¢åŸå…ˆçš„ tableã€‚å¯¹äºä¸€ä¸ª table è€Œè¨€ï¼Œä¸Šé¢åˆ†å¸ƒç€ n ä¸ª bin ç»“ç‚¹ï¼Œè€Œç»“ç‚¹è¿ç§»çš„è¿‡ç¨‹å¯ä»¥æ˜¯å¹¶å‘çš„ï¼Œè¿™æ ·å¯ä»¥æå‡è¿ç§»çš„æ•ˆç‡ã€‚ConcurrentHashMap ä½¿ç”¨äº†ä¸€ä¸ª stride å˜é‡ç”¨äºæŒ‡å®šå°† stride ä¸ª bin ç»“ç‚¹ç»„æˆä¸€ä¸ªä»»åŠ¡å•å…ƒç”±ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£å¤„ç†ï¼Œåœ¨å•æ ¸ CPU ä¸‹ stride çš„å€¼ä¸º table çš„é•¿åº¦ nï¼Œåœ¨å¤šæ ¸ CPU ä¸‹ä¸º (n &gt;&gt;&gt; 3) / NCPUï¼Œæœ€å°å€¼ä¸º 16ã€‚ ConcurrentHashMap å®šä¹‰äº†ä¸€ä¸ªç±»å®ä¾‹å˜é‡ transferIndexï¼Œç”¨äºæŒ‡å®šä»»åŠ¡çš„è¾¹ç•Œã€‚ä»»åŠ¡åˆ’åˆ†çš„è¿‡ç¨‹åœ¨ table ä¸Šæ˜¯ä»åå¾€å‰è¿›è¡Œçš„ï¼Œä¾‹å¦‚ç°åœ¨æœ‰ n ä¸ªç»“ç‚¹ï¼Œåˆ™ç¼–å· ï¼ˆn-1-stride, ..., n-1ï¼‰ çš„ä»»åŠ¡äº¤ç»™ç¬¬ 1 ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œç¼–å· ï¼ˆn-1-2*stride, ..., n-1-strideï¼‰ çš„ä»»åŠ¡äº¤ç»™ç¬¬ 2 ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œä»¥æ­¤ç±»æ¨ã€‚å½“æœ‰æ–°çš„çº¿ç¨‹åŠ å…¥æ—¶å¯ä»¥ä¾æ® transferIndex å€¼çŸ¥é“æ¥ä¸‹å»åº”è¯¥åˆ†é…å“ªä¸€å—çš„ bin ç»“ç‚¹ç»™å½“å‰çº¿ç¨‹ã€‚ å…·ä½“ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203private final void transfer(Node&lt;K, V&gt;[] tab, Node&lt;K, V&gt;[] nextTab) &#123; int n = tab.length, stride; /* * stride å³æ­¥è¿›ï¼Œ * åœ¨å•æ ¸ä¸‹ä¸º table çš„é•¿åº¦ nï¼Œåœ¨å¤šæ ¸æ¨¡å¼ä¸‹ä¸º (n &gt;&gt;&gt; 3) / NCPUï¼Œæœ€å°å€¼ä¸º 16 */ // æ¯æ ¸å¤„ç†çš„é‡å°äº16ï¼Œåˆ™å¼ºåˆ¶èµ‹å€¼16 // NCPUä¸ºCPUæ ¸å¿ƒæ•°ï¼Œæ¯ä¸ªæ ¸å¿ƒå‡åˆ†å¤åˆ¶ä»»åŠ¡ï¼Œå¦‚æœå‡åˆ†å°äº16ä¸ªï¼Œé‚£ä¹ˆä»¥16ä¸ºæ­¥é•¿åˆ†ç»™å¤„ç†å™¨ // ä¾‹å¦‚0-15å·ç»™å¤„ç†å™¨1ï¼Œ16-32å·åˆ†ç»™å¤„ç†å™¨2ã€‚å¤„ç†å™¨3å°±ä¸ç”¨æ¥ä»»åŠ¡äº†ã€‚ if ((stride = (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) / NCPU : n) &lt; MIN_TRANSFER_STRIDE) &#123; stride = MIN_TRANSFER_STRIDE; // subdivide range &#125; // 1. å¦‚æœ nextTable æœªåˆå§‹åŒ–ï¼Œåˆ™å…ˆè¿›è¡Œåˆå§‹åŒ–ï¼Œå®¹é‡æ˜¯ä¹‹å‰çš„ä¸¤å€ // å¦‚æœnextTabä¸ºç©ºåˆ™åˆå§‹åŒ–ä¸ºåŸtabçš„ä¸¤å€ï¼Œè¿™é‡Œåªä¼šæœ‰å•çº¿ç¨‹è¿›å¾—æ¥ï¼Œå› ä¸ºåˆå§‹åŒ–nextTabåªéœ€è¦ä¸€ä¸ªï¼Œ // addcounté‡Œé¢åˆ¤æ–­äº†nextTabä¸ºç©ºåˆ™ä¸æ‰§è¡Œæ‰©å®¹ä»»åŠ¡ if (nextTab == null) &#123; try &#123; @SuppressWarnings("unchecked") Node&lt;K, V&gt;[] nt = (Node&lt;K, V&gt;[]) new Node&lt;?, ?&gt;[n &lt;&lt; 1]; // å®¹é‡ç¿»å€ nextTab = nt; &#125; catch (Throwable ex) &#123; // try to cope with OOME sizeCtl = Integer.MAX_VALUE; return; &#125; nextTable = nextTab; transferIndex = n; //æ‰©å®¹æ€»è¿›åº¦ï¼ŒtransferIndexä¹‹åçš„æ¡¶éƒ½å·²åˆ†é…å‡ºå»,å› ä¸ºæ˜¯å€’åºåˆ†é… &#125; // 2. æ‰§è¡Œè¿ç§»å·¥ä½œ int nextn = nextTab.length; // ForwardingNode è¡¨ç¤ºä¸€ä¸ªæ­£åœ¨è¢«è¿ç§»çš„ç»“ç‚¹ï¼Œå¯¹åº”çš„ hash å€¼æ˜¯ MOVED ForwardingNode&lt;K, V&gt; fwd = new ForwardingNode&lt;&gt;(nextTab); boolean advance = true; // æ ‡è®°ä¸€ä¸ªç»“ç‚¹æ˜¯å¦è¿ç§»å®Œæˆ boolean finishing = false; // æ ‡è®°æ‰©å®¹ä»»åŠ¡æ˜¯å¦å®Œæˆ // i æ˜¯ç´¢å¼•ï¼Œbound æ˜¯è¾¹ç•Œå€¼ï¼ˆå·¦è¾¹ç•Œå€¼ï¼‰ï¼Œä»åå¾€å‰è¿ç§» for (int i = 0, bound = 0; ; ) &#123; Node&lt;K, V&gt; f; int fh; /* * 2.1 åŸºäº CAS è®¡ç®—æœ¬æ¬¡ä»»åŠ¡çš„è¾¹ç•Œå€¼ï¼Œå³ i å’Œ bound å€¼ï¼Œ * å°† i æŒ‡å‘ transferIndexï¼Œå°† bound æŒ‡å‘ transferIndex - stride */ while (advance) &#123; int nextIndex, nextBound; // æ ‡è®°å½“å‰ç»“ç‚¹è¿ç§»å®Œæˆ if (--i &gt;= bound || finishing) &#123; advance = false; &#125; // ä¸€æ—¦ transferIndex &lt;= 0ï¼Œè¡¨ç¤ºæ‰€æœ‰ä»»åŠ¡å·²ç»åˆ†é…ç»™ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œå¤„ç† else if ((nextIndex = transferIndex) &lt;= 0) &#123; i = -1; // åˆ†é…å®Œæˆï¼Œä¸‹é¢ç›´æ¥æ‰§è¡Œè¿ç§»ä»»åŠ¡ advance = false; &#125; // åŸºäº CAS è®¡ç®— transferIndex å€¼ï¼ˆå³ transferIndex - strideï¼‰ // nextBound æ˜¯æœ¬æ¬¡ä»»åŠ¡çš„è¾¹ç•Œ //ç¡®å®šå½“å‰çº¿ç¨‹æ¯æ¬¡åˆ†é…çš„å¾…è¿ç§»æ¡¶çš„èŒƒå›´[bound, nextIndex) //æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä¹‹å‰çš„ä»»åŠ¡ä»¥åä¼šèµ°è¿™ä¸ªåˆ†æ”¯ç»§ç»­è·å–æ–°çš„ä»»åŠ¡,ç›´åˆ°æ‰€æœ‰ä»»åŠ¡éƒ½åˆ†é…å®Œæ¯• else if (U.compareAndSwapInt( this, TRANSFERINDEX, nextIndex, nextBound = (nextIndex &gt; stride ? nextIndex - stride : 0))) &#123; bound = nextBound; i = nextIndex - 1; advance = false; &#125; &#125; // ~end while /* * 2.2 æ‰§è¡Œè¿ç§»ä»»åŠ¡ */ if (i &lt; 0 || i &gt;= n || i + n &gt;= nextn) &#123; int sc; // å®Œæˆäº†æ‰€æœ‰ç»“ç‚¹çš„è¿ç§» if (finishing) &#123; nextTable = null; table = nextTab; // æ›´æ–° table ä¸º nextTable sizeCtl = (n &lt;&lt; 1) - (n &gt;&gt;&gt; 1); // sizeCtl å€¼æ›´æ–°ä¸º table é•¿åº¦çš„ 1.5 å€ return; &#125; // ä»»åŠ¡ç»§ç»­ /* * åŸºäº CAS å°† sizeCtl å‡ 1 * åœ¨è¿ç§»æ“ä½œå¼€å§‹å‰ä¼šå°† sizeCtl è®¾ç½®ä¸º (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹åŠ å…¥è¿ç§»ä»»åŠ¡å°±ä¼šå°† sizeCtl åŠ  1ï¼Œ * æ‰€ä»¥è¿™é‡Œæ‰§è¡Œ sizeCtl å‡ 1ï¼Œä»£è¡¨å½“å‰ä»»åŠ¡å®Œæˆ */ if (U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1)) &#123; if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT) &#123; // å½“å‰ä»»åŠ¡ç»“æŸï¼Œä½†æ˜¯æ•´ä½“ä»»åŠ¡è¿˜æœªå®Œæˆ return; &#125; // æ­¤æ—¶ sizeCtl == (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2ï¼Œè¯´æ˜æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œäº† finishing = advance = true; i = n; // recheck before commit,å†æ¬¡æ£€æŸ¥ä¸€ä¸‹æ•´å¼ è¡¨ &#125; &#125; // å¦åˆ™ï¼Œè·å– table ä¸­ä½ç½®ä¸º i çš„å¤´ç»“ç‚¹ï¼Œä¸”ä¸º null else if ((f = tabAt(tab, i)) == null) &#123; // åœ¨å½“å‰ä½ç½®è®¾ç½®ä¸€ä¸ªç©ºçš„ ForwardingNode èŠ‚ç‚¹ advance = casTabAt(tab, i, null, fwd); &#125; // å¦åˆ™ï¼Œå½“å‰ä½ç½®å·²ç»æ˜¯ä¸€ä¸ª ForwardingNodeï¼Œä»£è¡¨æ­£åœ¨æ‰§è¡Œè¿ç§»å·¥ä½œ else if ((fh = f.hash) == MOVED) &#123; advance = true; // already processed &#125; // å¦åˆ™ï¼Œå¼€å§‹å¯¹å½“å‰ç»“ç‚¹æ‰§è¡Œè¿ç§»å·¥ä½œ else &#123; synchronized (f) &#123; if (tabAt(tab, i) == f) &#123; // å†æ¬¡æ ¡éªŒç»“ç‚¹ Node&lt;K, V&gt; ln, hn; // å½“å‰ bin æ˜¯ä¸€ä¸ªé“¾è¡¨ if (fh &gt;= 0) &#123; int runBit = fh &amp; n; // n ä¸ºè€ table çš„é•¿åº¦ Node&lt;K, V&gt; lastRun = f; // éå†å½“å‰é“¾è¡¨ï¼Œæ‰¾åˆ°æœ€å p.hash &amp; n å€¼ç›¸åŒçš„ç¬¬ä¸€ä¸ªç»“ç‚¹ for (Node&lt;K, V&gt; p = f.next; p != null; p = p.next) &#123; int b = p.hash &amp; n; if (b != runBit) &#123; runBit = b; lastRun = p; &#125; &#125; // runBit == 0 è¡¨ç¤ºè¿˜åœ¨è€ table åŸå…ˆçš„ä½ç½® if (runBit == 0) &#123; ln = lastRun; hn = null; &#125; // æ­¤å¤„ runBit ç­‰äºè€ table çš„é•¿åº¦ï¼Œå³ n else &#123; hn = lastRun; ln = null; &#125; // ä»¥ lastRun ä¸ºç•Œ for (Node&lt;K, V&gt; p = f; p != lastRun; p = p.next) &#123; int ph = p.hash; K pk = p.key; V pv = p.val; if ((ph &amp; n) == 0) &#123; ln = new Node&lt;&gt;(ph, pk, pv, ln); &#125; else &#123; hn = new Node&lt;&gt;(ph, pk, pv, hn); &#125; &#125; // å°†å…¶ä¸­ä¸€ä¸ªé“¾è¡¨æ”¾ç½®åœ¨ nextTable çš„ i ä½ç½® setTabAt(nextTab, i, ln); // å°†å¦å¤–ä¸€ä¸ªé“¾è¡¨æ”¾ç½®åœ¨ nextTable çš„ i+n ä½ç½® setTabAt(nextTab, i + n, hn); // è®¾ç½®å½“å‰ table çš„ i ä½ç½®ä¸º ForwardingNode ç©ºç»“ç‚¹ï¼Œä»£è¡¨å·²ç»å¤„ç†å®Œ setTabAt(tab, i, fwd); advance = true; &#125; // å½“å‰ bin æ˜¯ä¸€é¢—çº¢é»‘æ ‘ else if (f instanceof TreeBin) &#123; TreeBin&lt;K, V&gt; t = (TreeBin&lt;K, V&gt;) f; TreeNode&lt;K, V&gt; lo = null, loTail = null; TreeNode&lt;K, V&gt; hi = null, hiTail = null; int lc = 0, hc = 0; for (Node&lt;K, V&gt; e = t.first; e != null; e = e.next) &#123; int h = e.hash; TreeNode&lt;K, V&gt; p = new TreeNode&lt;&gt;(h, e.key, e.val, null, null); if ((h &amp; n) == 0) &#123; if ((p.prev = loTail) == null) &#123; lo = p; &#125; else &#123; loTail.next = p; &#125; loTail = p; ++lc; &#125; else &#123; if ((p.prev = hiTail) == null) &#123; hi = p; &#125; else &#123; hiTail.next = p; &#125; hiTail = p; ++hc; &#125; &#125; /* å¦‚æœå°†çº¢é»‘æ ‘ä¸€åˆ†ä¸ºäºŒåï¼Œç»“ç‚¹æ•°ç›®å°äº 6ï¼Œåˆ™å°†çº¢é»‘æ ‘è½¬æ¢æˆé“¾è¡¨ */ ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) : (hc != 0) ? new TreeBin&lt;&gt;(lo) : t; hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) : (lc != 0) ? new TreeBin&lt;&gt;(hi) : t; // å°†å…¶ä¸­ä¸€ä¸ªçº¢é»‘æ ‘ï¼ˆæˆ–é“¾è¡¨ï¼‰æ”¾ç½®åœ¨ nextTable çš„ i ä½ç½® setTabAt(nextTab, i, ln); // å°†å¦å¤–ä¸€ä¸ªçº¢é»‘æ ‘ï¼ˆæˆ–é“¾è¡¨ï¼‰æ”¾ç½®åœ¨ nextTable çš„ i+n ä½ç½® setTabAt(nextTab, i + n, hn); // è®¾ç½®å½“å‰ table çš„ i ä½ç½®ä¸º ForwardingNode ç©ºç»“ç‚¹ï¼Œä»£è¡¨å·²ç»å¤„ç†å®Œ setTabAt(tab, i, fwd); advance = true; &#125; &#125; &#125; &#125; &#125;&#125; æ–¹æ³•çš„å®ç°å¾ˆå¤æ‚ï¼Œä¸è¿‡æ•´ä½“æµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸º 2 å¤§éƒ¨åˆ†ï¼š å¦‚æœ nextTable æœªåˆå§‹åŒ–ï¼Œåˆ™å…ˆæ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œæ–°çš„ table å®¹é‡ç¿»å€ æ‰§è¡Œè¿ç§»ä»»åŠ¡ å…¶ä¸­è¿‡ç¨‹ 1 æ¯”è¾ƒç®€å•ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰è§¦å‘ transfer æ–¹æ³•éƒ½éœ€è¦æ‰§è¡Œåˆå§‹åŒ– table çš„æ“ä½œï¼Œåªæœ‰ä¸»åŠ¨è§¦å‘æ‰©å®¹çš„çº¿ç¨‹éœ€è¦æ‰§è¡Œè¯¥æ“ä½œï¼Œå¯¹äºåæ¥åŠ å…¥â€œå¸®å¿™â€çš„çº¿ç¨‹ä¼šè·³è¿‡è¿‡ç¨‹ 1ï¼Œç›´æ¥è¿›å…¥è¿‡ç¨‹ 2ã€‚ è¿‡ç¨‹ 2 é€šè¿‡ transferIndex å®ä¾‹å˜é‡åè°ƒä»»åŠ¡çš„åˆ†é…ï¼Œå¹¶ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é… stride ä¸ªç»“ç‚¹è¿›è¡Œè¿ç§»ï¼Œä»»åŠ¡åˆ†é…çš„è¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯ç¡®å®šå½“å‰çº¿ç¨‹è¿ç§»ç»“ç‚¹çš„ä¸Šä¸‹ç•Œçš„è¿‡ç¨‹ï¼Œè¯¥è¿‡ç¨‹ä½äº while å¾ªç¯ä¸­ï¼ˆå³ä»£ç æ³¨é‡Š 2.1ï¼‰ï¼Œè¯¥å¾ªç¯æ•´ä½“ä¸Šå°±æ˜¯ä¸€ä¸ª CAS æ“ä½œï¼Œå¦‚æœè¿ç§»ä»»åŠ¡å·²ç»å®Œæˆï¼Œæˆ–è€…æ²¡æœ‰å‰©ä½™çš„ç»“ç‚¹å¯ä»¥è¿ç§»ï¼ˆå®ä¾‹å˜é‡ transferIndex å°äºç­‰äº 0ï¼‰ï¼Œåˆ™é€€å‡º CASï¼Œå¦åˆ™å°è¯•ä¸ºæœ¬æ¬¡ä»»åŠ¡åˆ†é…æ–°çš„ä¸Šä¸‹ç•Œï¼ŒåŒæ—¶æ›´æ–° transferIndex å€¼ã€‚ æ¥ä¸‹æ¥æ­£å¼å¼€å§‹è¿ç§»å·¥ä½œï¼Œæ•´ä½“æµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š æ£€æŸ¥æ•´ä½“è¿ç§»ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œå¦‚æœå®Œæˆåˆ™æ›´æ–° table å’Œ sizeCtl å€¼ å¦åˆ™ï¼Œæ£€æŸ¥å½“å‰ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆï¼Œå¦‚æœå®Œæˆåˆ™é€€å‡ºæœ¬æ¬¡ä»»åŠ¡ å¯¹äºä»åœ¨è¿›è¡Œä¸­çš„ä»»åŠ¡ä¼šç»§ç»­æ‰§è¡Œè¿ç§»æ“ä½œï¼Œå¦‚æœå½“å‰ç»“ç‚¹æ˜¯ä¸€ä¸ªç©ºç»“ç‚¹ï¼Œåˆ™åœ¨è¯¥ä½ç½®è®¾ç½®ä¸€ä¸ªç©ºçš„ ForwardingNode ç»“ç‚¹ï¼Œç”¨äºæ ‡è®°å½“å‰ç»“ç‚¹æ­£åœ¨è¿ç§»ä¸­ å¦åˆ™ï¼Œå¦‚æœå½“å‰ç»“ç‚¹æ˜¯ä¸€ä¸ª ForwardingNode ç»“ç‚¹ï¼Œå³å½“å‰ç»“ç‚¹æ­£åœ¨è¿ç§»ä¸­ï¼Œè¿›å…¥ä¸‹ä¸€è½®ä»»åŠ¡åˆ†é… å¦åˆ™ï¼Œå¯¹å½“å‰ç»“ç‚¹æ‰§è¡Œè¿ç§»æ“ä½œ ä¸‹é¢é’ˆå¯¹æµç¨‹ä¸­çš„ä¸€äº›å…³é”®ç‚¹è¿›è¡Œè¯´æ˜ï¼Œé¦–å…ˆæ¥çœ‹ä¸€ä¸‹è¿‡ç¨‹ 2 ç›¸å…³çš„ä»£ç ï¼š 123456789101112131415/* * åŸºäº CAS å°† sizeCtl å‡ 1 * åœ¨è¿ç§»æ“ä½œå¼€å§‹å‰ä¼šå°† sizeCtl è®¾ç½®ä¸º (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹åŠ å…¥è¿ç§»ä»»åŠ¡å°±ä¼šå°† sizeCtl åŠ  1ï¼Œ * å‰é¢ä¸¤ä¸ªè°ƒç”¨ transferå‡½æ•°çš„ï¼Œåœ¨è°ƒç”¨ä¹‹å‰éƒ½ä¼šå…ˆåŠ  sizeCtl + 1 * æ‰€ä»¥è¿™é‡Œæ‰§è¡Œ sizeCtl å‡ 1ï¼Œä»£è¡¨å½“å‰ä»»åŠ¡å®Œæˆ */if (U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1)) &#123; if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT) &#123; // å½“å‰ä»»åŠ¡ç»“æŸï¼Œä½†æ˜¯æ•´ä½“ä»»åŠ¡è¿˜æœªå®Œæˆ return; &#125; // æ­¤æ—¶ sizeCtl == (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2ï¼Œè¯´æ˜æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œäº† finishing = advance = true; i = n; // recheck before commit&#125; å‰é¢æˆ‘ä»¬æ›¾æåˆ°å½“æ–°å¢ä¸€ä¸ªçº¿ç¨‹æ”¯æŒè¿ç§»ä»»åŠ¡æ—¶ä¼šæ‰§è¡Œ U.compareAndSwapInt(this, SIZECTL, sc, sc + 1) æ“ä½œï¼Œå¹¶ä¸”åœ¨æ‰©å®¹æ“ä½œå¼€å§‹å‰ä¼šè®¾ç½® sizeCtl çš„å€¼ä¸º (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2ï¼Œè€Œè¿™é‡Œåœ¨å®Œæˆä¸€ä¸ªä»»åŠ¡çš„æ—¶å€™ä¼šæ‰§è¡Œ U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1) æ“ä½œå°† sizeCtl çš„å€¼å‡ 1ã€‚ä¸Šé¢çš„ä»£ç ä¼šåˆ¤å®šå½“å‰ sizeCtl å€¼æ˜¯å¦ç­‰äº (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2ï¼Œå¦‚æœç›¸ç­‰åˆ™è¯´æ˜æ•´ä½“æ‰©å®¹ä»»åŠ¡å®Œæˆï¼Œå¦åˆ™ä»…è¯´æ˜å½“å‰ä»»åŠ¡å®Œæˆï¼Œå°†çº¿ç¨‹ä»»åŠ¡æ•°å‡ 1ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­æ¥çœ‹ä¸€ä¸ªç»“ç‚¹è¿ç§»çš„è¿‡ç¨‹ï¼Œè¿ç§»åŒºåˆ†é“¾è¡¨å’Œçº¢é»‘æ ‘ï¼Œä¸è¿‡åŸºæœ¬æ€æƒ³æ˜¯æƒ³é€šçš„ï¼Œè¿™é‡Œä»¥é“¾è¡¨è¿›è¡Œè¯´æ˜ï¼Œç›¸å…³å®ç°å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041// å½“å‰ bin æ˜¯ä¸€ä¸ªé“¾è¡¨if (fh &gt;= 0) &#123; int runBit = fh &amp; n; // n ä¸ºè€ table çš„é•¿åº¦ Node&lt;K, V&gt; lastRun = f; // éå†å½“å‰é“¾è¡¨ï¼Œæ‰¾åˆ°æœ€å p.hash &amp; n å€¼ç›¸åŒçš„ç¬¬ä¸€ä¸ªç»“ç‚¹ for (Node&lt;K, V&gt; p = f.next; p != null; p = p.next) &#123; int b = p.hash &amp; n; if (b != runBit) &#123; runBit = b; lastRun = p; &#125; &#125; // runBit == 0 è¡¨ç¤ºè¿˜åœ¨è€ table åŸå…ˆçš„ä½ç½® if (runBit == 0) &#123; ln = lastRun; hn = null; &#125; // æ­¤å¤„ runBit ç­‰äºè€ table çš„é•¿åº¦ï¼Œå³ n else &#123; hn = lastRun; ln = null; &#125; // ä»¥ lastRun ä¸ºç•Œ for (Node&lt;K, V&gt; p = f; p != lastRun; p = p.next) &#123; int ph = p.hash; K pk = p.key; V pv = p.val; if ((ph &amp; n) == 0) &#123; ln = new Node&lt;&gt;(ph, pk, pv, ln); &#125; else &#123; hn = new Node&lt;&gt;(ph, pk, pv, hn); &#125; &#125; // å°†å…¶ä¸­ä¸€ä¸ªé“¾è¡¨æ”¾ç½®åœ¨ nextTable çš„ i ä½ç½® setTabAt(nextTab, i, ln); // å°†å¦å¤–ä¸€ä¸ªé“¾è¡¨æ”¾ç½®åœ¨ nextTable çš„ i+n ä½ç½® setTabAt(nextTab, i + n, hn); // è®¾ç½®å½“å‰ table çš„ i ä½ç½®ä¸º ForwardingNode ç©ºç»“ç‚¹ï¼Œä»£è¡¨å·²ç»å¤„ç†å®Œ setTabAt(tab, i, fwd); advance = true;&#125; è¿™ä¸€æ®µä»£ç å¦‚æœå¸Œæœ›æ›´å¥½çš„ç†è§£ï¼Œå»ºè®®è‡ªå·±æ¨¡æ‹Ÿä¸€ä¸ª tableï¼Œå¹¶ debug ä¸€ä¸‹æ‰§è¡Œæµç¨‹ã€‚å…¶å®ä¹Ÿä¸éš¾ï¼Œè¿™æ®µä»£ç çš„å·¥ä½œå°±æ˜¯å°†ä¸€ä¸ªé“¾è¡¨çš„æ‹†åˆ†æˆä¸¤ä¸ªé“¾è¡¨ï¼Œå¹¶å°†å®ƒä»¬æ’å…¥åˆ°æ–° table é€‚å½“çš„ä½ç½®ã€‚å‡è®¾è€çš„ table é•¿åº¦ä¸º 16ï¼Œé‚£ä¹ˆä¸Šé¢çš„å®ç°æœ‰ä¸€ä¸ªå·§å¦™çš„åœ°æ–¹åœ¨äºå¯¹é“¾è¡¨ä¸­æ‰€æœ‰ç»“ç‚¹çš„å“ˆå¸Œå€¼æ‰§è¡Œ p.hash &amp; n æ“ä½œï¼Œå…¶ç»“æœä¸æ˜¯ 0 å°±æ˜¯ 16ï¼ˆè€ table çš„é•¿åº¦ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¾æ® p.hash &amp; n çš„å€¼å°†ä¸€ä¸ªé“¾è¡¨æ‹†åˆ†æˆä¸¤ä¸ªé“¾è¡¨ï¼Œå…¶ä¸­å€¼å‡ä¸º 0 çš„ç»“ç‚¹æ„æˆçš„é“¾è¡¨ä»ç„¶æ”¾ç½®åœ¨æ–° table çš„å½“å‰ä½ç½® iï¼Œè€Œå€¼å‡ä¸º 16 çš„ç»“ç‚¹æ„æˆçš„é“¾è¡¨åˆ™æ”¾ç½®åœ¨æ–°çš„ä½ç½®ï¼Œå³ i + 16ã€‚å˜é‡ lastRun æ‰€è¡¨ç¤ºçš„ç»“ç‚¹å®é™…ä¸Šæ˜¯æœ€åå‡ ä¸ªå…·å¤‡ç›¸åŒ p.hash &amp; n å€¼çš„è¿ç»­ç»“ç‚¹çš„æœ€å·¦è¾¹ç»“ç‚¹ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥å‡å°‘è¯¥ç»“ç‚¹å³è¾¹å‡ ä¸ªç»“ç‚¹çš„è¿ç§»å·¥ä½œï¼Œå› ä¸ºå®ƒä»¬å…·å¤‡ç›¸åŒçš„ p.hash &amp; n å€¼ï¼Œè‡ªç„¶ä¹Ÿå°±ä½äºåŒä¸€ä¸ªé“¾è¡¨ä¸Šã€‚ addCount()åœ¨ put æ–¹æ³•ç»“å°¾å¤„è°ƒç”¨äº† addCount æ–¹æ³•ï¼ŒæŠŠå½“å‰ ConcurrentHashMap çš„å…ƒç´ ä¸ªæ•°+1ï¼Œ è¿™ä¸ªæ–¹æ³•ä¸€å…±åšäº†ä¸¤ä»¶äº‹,æ›´æ–° baseCount çš„å€¼ï¼Œæ£€æµ‹æ˜¯å¦è¿›è¡Œæ‰©å®¹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657// ä» putVal ä¼ å…¥çš„å‚æ•°æ˜¯ 1//binCountï¼ŒbinCount é»˜è®¤æ˜¯0ï¼Œåªæœ‰ hash å†²çªäº†æ‰ä¼šå¤§äº 1.ä¸”ä»–çš„å¤§å°æ˜¯é“¾è¡¨çš„é•¿åº¦ï¼ˆå¦‚æœä¸æ˜¯çº¢é»‘æ•°ç»“æ„çš„è¯ï¼‰private final void addCount(long x, int check) &#123; CounterCell[] as; long b, s; //åˆ©ç”¨CASæ–¹æ³•æ›´æ–°baseCountçš„å€¼ // å¦‚æœè®¡æ•°ç›’å­ä¸æ˜¯ç©º æˆ–è€… // å¦‚æœä¿®æ”¹ baseCount å¤±è´¥ if ((as = counterCells) != null || !U.compareAndSwapLong(this, BASECOUNT, b = baseCount, s = b + x)) &#123; CounterCell a; long v; int m; boolean uncontended = true; // å¦‚æœè®¡æ•°ç›’å­æ˜¯ç©ºï¼ˆå°šæœªå‡ºç°å¹¶å‘ï¼‰ // å¦‚æœéšæœºå–ä½™ä¸€ä¸ªæ•°ç»„ä½ç½®ä¸ºç©º æˆ–è€… // ä¿®æ”¹è¿™ä¸ªæ§½ä½çš„å˜é‡å¤±è´¥ï¼ˆå‡ºç°å¹¶å‘äº†ï¼‰ // æ‰§è¡Œ fullAddCount æ–¹æ³•ã€‚å¹¶ç»“æŸ if (as == null || (m = as.length - 1) &lt; 0 || (a = as[ThreadLocalRandom.getProbe() &amp; m]) == null || !(uncontended = U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))) &#123; fullAddCount(x, uncontended); return; &#125; if (check &lt;= 1) return; s = sumCount(); &#125; // å¦‚æœéœ€è¦æ£€æŸ¥,æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œåœ¨ putVal æ–¹æ³•è°ƒç”¨æ—¶ï¼Œé»˜è®¤å°±æ˜¯è¦æ£€æŸ¥çš„ã€‚ if (check &gt;= 0) &#123; Node&lt;K,V&gt;[] tab, nt; int n, sc; // å¦‚æœmap.size() å¤§äº sizeCtlï¼ˆè¾¾åˆ°æ‰©å®¹é˜ˆå€¼éœ€è¦æ‰©å®¹ï¼‰ ä¸” // table ä¸æ˜¯ç©ºï¼›ä¸” table çš„é•¿åº¦å°äº 1 &lt;&lt; 30ã€‚ï¼ˆå¯ä»¥æ‰©å®¹ï¼‰ while (s &gt;= (long)(sc = sizeCtl) &amp;&amp; (tab = table) != null &amp;&amp; (n = tab.length) &lt; MAXIMUM_CAPACITY) &#123; // æ ¹æ® length å¾—åˆ°ä¸€ä¸ªæ ‡è¯† int rs = resizeStamp(n); // å¦‚æœæ­£åœ¨æ‰©å®¹ if (sc &lt; 0) &#123; if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 || sc == rs + MAX_RESIZERS || (nt = nextTable) == null || transferIndex &lt;= 0) break; // å¦‚æœå·²ç»æœ‰å…¶ä»–çº¿ç¨‹åœ¨æ‰§è¡Œæ‰©å®¹æ“ä½œ // å¯ä»¥å¸®åŠ©æ‰©å®¹ï¼Œé‚£ä¹ˆå°† sc åŠ  1. è¡¨ç¤ºå¤šäº†ä¸€ä¸ªçº¿ç¨‹åœ¨å¸®åŠ©æ‰©å®¹ if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1)) // æ‰©å®¹ transfer(tab, nt); &#125; // å¦‚æœä¸åœ¨æ‰©å®¹ï¼Œå°† sc æ›´æ–°ï¼šæ ‡è¯†ç¬¦å·¦ç§» 16 ä½ ç„¶å + 2. ä¹Ÿå°±æ˜¯å˜æˆä¸€ä¸ªè´Ÿæ•°ã€‚é«˜ 16 ä½æ˜¯æ ‡è¯†ç¬¦ï¼Œä½ 16 ä½åˆå§‹æ˜¯ 2. else if (U.compareAndSwapInt(this, SIZECTL, sc, (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2)) // æ›´æ–° sizeCtl ä¸ºè´Ÿæ•°åï¼Œå¼€å§‹æ‰©å®¹ã€‚ transfer(tab, null); s = sumCount(); &#125; &#125;&#125; æ€»ç»“ä¸€ä¸‹è¯¥æ–¹æ³•çš„é€»è¾‘ï¼š x å‚æ•°è¡¨ç¤ºçš„æ­¤æ¬¡éœ€è¦å¯¹è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°åŠ å‡ ã€‚check å‚æ•°è¡¨ç¤ºæ˜¯å¦éœ€è¦è¿›è¡Œæ‰©å®¹æ£€æŸ¥ï¼Œå¤§äºç­‰äº0 éœ€è¦è¿›è¡Œæ£€æŸ¥ï¼Œè€Œæˆ‘ä»¬çš„ putVal æ–¹æ³•çš„ binCount å‚æ•°æœ€å°ä¹Ÿæ˜¯ 0 ï¼Œå› æ­¤ï¼Œæ¯æ¬¡æ·»åŠ å…ƒç´ éƒ½ä¼šè¿›è¡Œæ£€æŸ¥ã€‚ï¼ˆé™¤éæ˜¯è¦†ç›–æ“ä½œï¼‰ åˆ¤æ–­è®¡æ•°ç›’å­å±æ€§æ˜¯å¦æ˜¯ç©ºï¼Œå¦‚æœæ˜¯ç©ºï¼Œå°±å°è¯•ä¿®æ”¹ baseCount å˜é‡ï¼Œå¯¹è¯¥å˜é‡è¿›è¡ŒåŠ  Xã€‚ å¦‚æœè®¡æ•°ç›’å­ä¸æ˜¯ç©ºï¼Œæˆ–è€…ä¿®æ”¹ baseCount å˜é‡å¤±è´¥äº†ï¼Œåˆ™æ”¾å¼ƒå¯¹ baseCount è¿›è¡Œæ“ä½œã€‚ å¦‚æœè®¡æ•°ç›’å­æ˜¯ null æˆ–è€…è®¡æ•°ç›’å­çš„ length æ˜¯ 0ï¼Œæˆ–è€…éšæœºå–ä¸€ä¸ªä½ç½®å–äºæ•°ç»„é•¿åº¦æ˜¯ nullï¼Œé‚£ä¹ˆå°±å¯¹åˆšåˆšçš„å…ƒç´ è¿›è¡Œ CAS èµ‹å€¼ã€‚ å¦‚æœèµ‹å€¼å¤±è´¥ï¼Œæˆ–è€…æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼Œåˆ™è°ƒç”¨ fullAddCount æ–¹æ³•é‡æ–°æ­»å¾ªç¯æ’å…¥ã€‚ è¿™é‡Œå¦‚æœæ“ä½œ baseCount å¤±è´¥äº†ï¼ˆæˆ–è€…è®¡æ•°ç›’å­ä¸æ˜¯ Nullï¼‰ï¼Œä¸”å¯¹è®¡æ•°ç›’å­èµ‹å€¼æˆåŠŸï¼Œé‚£ä¹ˆå°±æ£€æŸ¥ check å˜é‡ï¼Œå¦‚æœè¯¥å˜é‡å°äºç­‰äº 1. ç›´æ¥ç»“æŸã€‚å¦åˆ™ï¼Œè®¡ç®—ä¸€ä¸‹ count å˜é‡ã€‚ å¦‚æœ check å¤§äºç­‰äº 0 ï¼Œè¯´æ˜éœ€è¦å¯¹æ˜¯å¦æ‰©å®¹è¿›è¡Œæ£€æŸ¥ã€‚ å¦‚æœ map çš„ size å¤§äº sizeCtlï¼ˆæ‰©å®¹é˜ˆå€¼ï¼‰ï¼Œä¸” table çš„é•¿åº¦å°äº 1 &lt;&lt; 30ï¼Œé‚£ä¹ˆå°±è¿›è¡Œæ‰©å®¹ã€‚ æ ¹æ® length å¾—åˆ°ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œç„¶åï¼Œåˆ¤æ–­ sizeCtl çŠ¶æ€ï¼Œå¦‚æœå°äº 0 ï¼Œè¯´æ˜è¦ä¹ˆåœ¨åˆå§‹åŒ–ï¼Œè¦ä¹ˆåœ¨æ‰©å®¹ã€‚ å¦‚æœæ­£åœ¨æ‰©å®¹ï¼Œé‚£ä¹ˆå°±æ ¡éªŒä¸€ä¸‹æ•°æ®æ˜¯å¦å˜åŒ–äº†ï¼ˆå…·ä½“å¯ä»¥çœ‹ä¸Šé¢ä»£ç çš„æ³¨é‡Šï¼‰ã€‚å¦‚æœæ£€éªŒæ•°æ®ä¸é€šè¿‡ï¼Œbreakã€‚ å¦‚æœæ ¡éªŒæ•°æ®é€šè¿‡äº†ï¼Œé‚£ä¹ˆå°† sizeCtl åŠ ä¸€ï¼Œè¡¨ç¤ºå¤šäº†ä¸€ä¸ªçº¿ç¨‹å¸®åŠ©æ‰©å®¹ã€‚ç„¶åè¿›è¡Œæ‰©å®¹ã€‚ å¦‚æœæ²¡æœ‰åœ¨æ‰©å®¹ï¼Œä½†æ˜¯éœ€è¦æ‰©å®¹ã€‚é‚£ä¹ˆå°±å°† sizeCtl æ›´æ–°ï¼Œèµ‹å€¼ä¸ºæ ‡è¯†ç¬¦å·¦ç§» 16 ä½ â€”â€” ä¸€ä¸ªè´Ÿæ•°ã€‚ç„¶ååŠ  2ã€‚ è¡¨ç¤ºï¼Œå·²ç»æœ‰ä¸€ä¸ªçº¿ç¨‹å¼€å§‹æ‰©å®¹äº†ã€‚ç„¶åè¿›è¡Œæ‰©å®¹ã€‚ç„¶åå†æ¬¡æ›´æ–° countï¼Œçœ‹çœ‹æ˜¯å¦è¿˜éœ€è¦æ‰©å®¹ã€‚ ä»ä¸Šé¢çš„åˆ†æä¸­æˆ‘ä»¬å¯ä»¥çœ‹ï¼ŒaddCount()æ˜¯æ‰©å®¹æ˜¯è€è€å®å®æŒ‰å®¹é‡x2æ¥æ‰©å®¹çš„ï¼ŒtryPresize()ä¼šä¼ å…¥ä¸€ä¸ªsizeå‚æ•°ï¼Œå¯èƒ½ä¸€æ¬¡æ€§æ‰©å®¹å¾ˆå¤šå€ã€‚åé¢é‡‡ç”¨ä¸€æ ·çš„æ–¹å¼è°ƒç”¨transfer()æ¥è¿›è¡ŒçœŸæ­£çš„æ‰©å®¹å¤„ç†ã€‚ ä½œè€…ï¼šexposureé“¾æ¥ï¼šhttps://juejin.im/post/5c36bcc0e51d45513236ee78æ¥æºï¼šæ˜é‡‘è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ get()æ–¹æ³• put çš„æ‰§è¡Œæµç¨‹å¯ä»¥åŠ æ·±æˆ‘ä»¬å¯¹äº ConcurrentHashMap å­˜å‚¨ç»“æ„çš„ç†è§£ï¼Œè€Œç†è§£äº† ConcurrentHashMap çš„å­˜å‚¨ç»“æ„ï¼Œé‚£ä¹ˆåˆ†æ get æ–¹æ³•çš„è¿è¡Œæœºåˆ¶ä¹Ÿæ˜¯æ°´åˆ°æ¸ æˆçš„äº‹æƒ…ï¼Œå®ç°å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728public V get(Object key) &#123; Node&lt;K, V&gt;[] tab; Node&lt;K, V&gt; e, p; int n, eh; K ek; // è®¡ç®— key çš„ hash å€¼ int h = spread(key.hashCode()); // table è¡¨ä¸ä¸ºç©ºï¼Œä¸” key å¯¹åº”çš„ table å¤´ç»“ç‚¹å­˜åœ¨ if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (e = tabAt(tab, (n - 1) &amp; h)) != null) &#123; if ((eh = e.hash) == h) &#123; if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))) &#123; // æ‰¾åˆ°å¯¹åº”çš„ keyï¼Œè¿”å› value return e.val; &#125; &#125; // å½“å‰ bin ä¸ºæ ‘ï¼Œæ‰§è¡Œ find æ–¹æ³•æ£€ç´¢ else if (eh &lt; 0) &#123; return (p = e.find(h, key)) != null ? p.val : null; &#125; // å½“å‰ bin æ˜¯é“¾è¡¨ï¼Œç›´æ¥éå†æ£€ç´¢ while ((e = e.next) != null) &#123; if (e.hash == h &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) &#123; return e.val; &#125; &#125; &#125; return null;&#125; æ–¹æ³•é¦–å…ˆä¾æ®ç›¸åŒçš„å®ç°è®¡ç®— key çš„å“ˆå¸Œå€¼ï¼Œç„¶åå®šä½ key åœ¨ table ä¸­çš„ bin ä½ç½®ã€‚å¦‚æœ bin ç»“ç‚¹å­˜åœ¨ï¼Œåˆ™ä¾æ®å½“å‰ bin ç±»å‹ï¼ˆé“¾è¡¨æˆ–çº¢é»‘æ ‘ï¼‰æ£€ç´¢ç›®æ ‡å€¼ã€‚ è¡¥å……Qï¼šå¼±ä¸€è‡´æ€§çš„é—®é¢˜ï¼Ÿ Aï¼šä¹‹å‰ç»å¸¸æœ‰çœ‹åˆ°è¯´ ConcurrentHashMap åœ¨jdk1.6 ç‰ˆæœ¬ä¸­æ˜¯å¼±ä¸€è‡´æ€§çš„ï¼ŒåŸå› æ˜¯å…¶è·Ÿ CopyOnWriteArrayList ä¸€æ ·ï¼Œåªæœ‰åœ¨å†™æ•°æ®æ—¶åŠ é”ï¼Œåœ¨è¯»æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œä¸”æ•°ç»„å¼•ç”¨æ˜¯ volatile å…³é”®å­—ä¿®é¥°çš„ï¼Œè¿™ä¸ªå¼±ä¸€è‡´æ€§å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯è¯»åˆ°çš„æ•°æ®å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ï¼Œå› ä¸ºåœ¨å†™å®Œåæ•°ç»„å¼•ç”¨å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œåªæ˜¯å…ƒç´ çš„å€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™ä¸ªæ—¶å€™ volatile æ˜¯ä¸ä¼šå»åˆ·æ–°æ•°æ®çš„ï¼Œåªæœ‰ç­‰å†™å®Œåçš„æ•°æ®ä»å·¥ä½œå†…å­˜å†™å›åˆ°ä¸»å†…å­˜ä¸­ï¼Œè¯»åˆ°çš„æ•°æ®æ‰æ˜¯å†™åçš„æ•°æ®ï¼Œæ‰€ä»¥æ˜¯å¼±ä¸€è‡´æ€§ã€‚è‡³äº jdk1.8è€Œè¨€ï¼Œæ­¤æ—¶çš„é”å·²ç»æ˜¯è¡Œç²’åº¦äº†ï¼Œå¹¶ä¸”è¯»æ•°æ®æ—¶ä½¿ç”¨äº† CASï¼Œå¼ºè¡Œå»è¯»åˆ° volatileçš„å€¼ï¼Œæ‰€ä»¥æ­¤æ—¶åº”è¯¥æ˜¯å¼ºä¸€è‡´æ€§çš„ã€‚ HashTableç”±äºè¿™ä¸ªåŸºæœ¬å·²ç»è¢«æ·˜æ±°äº†â€¦æ‰€ä»¥å°±ä¸å†è¿›è¡Œç³»ç»Ÿçš„æºç åˆ†æäº†ã€‚ å…¶å® HashTable æºä»£ç åªæœ‰1000å¤šè¡Œç‚¹ï¼Œæºä»£ç å¾ˆå°‘ï¼Œä¹ŸåŸºæœ¬ä¸Šæ˜¯ HashMap çš„åŸæ¥çš„ç‰ˆæœ¬åŠ ä¸Š synchronized å…³é”®å­—ï¼Œæ¯æ¬¡éƒ½æ˜¯é”å®šæ•´ä¸ªå“ˆå¸Œè¡¨ï¼Œæ‰€ä»¥æ•ˆç‡éå¸¸ä½ä¸‹ï¼Œæ³¨æ„å“ˆ~ è·Ÿ HashMap çš„åŒºåˆ«ä¸»è¦å…¶åŸºæœ¬å…ƒç´ è¿˜æ˜¯ Entryï¼Œç„¶åé»˜è®¤åˆå§‹å€¼æ˜¯ 11ï¼Œä¸æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼ŒåŒæ—¶æ‰©å®¹çš„æ—¶å€™ä¹Ÿä¸æ˜¯æŒ‰ 2 çš„å¹‚æ¬¡æ–¹è¿›è¡Œæ‰©å®¹çš„ï¼Œè€Œæ˜¯ 2 çš„å¹‚æ¬¡æ–¹ + 1æ¥æ‰©å®¹çš„ï¼Œå¹¶ä¸”ï¼Œå…¶æ‰°åŠ¨å‡½æ•°ä¾æ—§æ˜¯åŸæ¥çš„ jdk7çš„æ‰°åŠ¨å‡½æ•°æ–¹å¼ï¼Œå³æ‰°åŠ¨4æ¬¡ï¼Œæ•ˆç‡ä½ä¸‹ï¼Œå–ä½™ä¹Ÿæ˜¯ç›´æ¥å–ä½™ï¼Œå› ä¸ºå…¶æ€»æ•°ä¸æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼Œæ•…ä¸èƒ½ç›´æ¥ç›¸ä¸å¾—åˆ°å“ˆå¸Œæ¡¶çš„ä¸‹æ ‡å€¼ã€‚ ä¸HashMapåŒºåˆ« å®ç°æ–¹å¼ä¸ä¸€æ · Hashtableç»§æ‰¿è‡ª Dictionary ç±»ï¼Œè€Œ HashMap ç»§æ‰¿è‡ª AbstractMap ç±»ã€‚ä½†äºŒè€…éƒ½å®ç°äº† Map æ¥å£ã€‚ 12public class Hashtable&lt;K,V&gt; extends Dictionary&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable 12public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable çº¿ç¨‹å®‰å…¨æ€§ä¸åŒ Hashtable ä¸­çš„æ–¹æ³•æ˜¯Synchronizeçš„ï¼Œè€ŒHashMapä¸­çš„æ–¹æ³•åœ¨ç¼ºçœæƒ…å†µä¸‹æ˜¯éSynchronizeçš„ã€‚ æ˜¯å¦æä¾›containsæ–¹æ³•HashMapæŠŠHashtableçš„containsæ–¹æ³•å»æ‰äº†ï¼Œæ”¹æˆcontainsValueå’ŒcontainsKeyï¼Œå› ä¸ºcontainsæ–¹æ³•å®¹æ˜“è®©äººå¼•èµ·è¯¯è§£ã€‚Hashtableåˆ™ä¿ç•™äº†containsï¼ŒcontainsValueå’ŒcontainsKeyä¸‰ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­containså’ŒcontainsValueåŠŸèƒ½ç›¸åŒã€‚ keyå’Œvalueæ˜¯å¦å…è®¸nullå€¼ ã€é‡ç‚¹ï¼ï¼ï¼å¯ä»¥å¼•ç”³åˆ° fail-fast å’Œ fail-safe æœºåˆ¶ï¼Œè¿›è€Œå¼•å‘åˆ°å¤šçº¿ç¨‹ä¸Šã€‘ è¿­ä»£å™¨ä¸åŒ HashMap ä¸­çš„ Iterator è¿­ä»£å™¨æ˜¯ fail-fast çš„ï¼Œè€Œ Hashtable çš„ Enumerator ä¸æ˜¯ fail-fast çš„ã€‚ æ‰€ä»¥ï¼Œå½“å…¶ä»–çº¿ç¨‹æ”¹å˜äº†HashMap çš„ç»“æ„ï¼Œå¦‚ï¼šå¢åˆ ï¼Œå°†ä¼šæŠ›å‡ºConcurrentModificationException å¼‚å¸¸ï¼Œè€Œ Hashtable åˆ™ä¸ä¼šã€‚[fail-fast å’Œ fail-safe] æ‰©å®¹æœºåˆ¶ä¸åŒ å½“ç°æœ‰å®¹é‡å¤§äºæ€»å®¹é‡ * è´Ÿè½½å› å­æ—¶ï¼ŒHashMap æ‰©å®¹è§„åˆ™ä¸ºå½“å‰å®¹é‡ç¿»å€ï¼ŒHashtable æ‰©å®¹è§„åˆ™ä¸ºå½“å‰å®¹é‡ç¿»å€ + 1ã€‚ åˆå§‹åŒ–å®¹é‡ä¸åŒ HashMap çš„åˆå§‹å®¹é‡ä¸ºï¼š16ï¼ŒHashtable åˆå§‹å®¹é‡ä¸ºï¼š11ï¼Œä¸¤è€…çš„è´Ÿè½½å› å­é»˜è®¤éƒ½æ˜¯ï¼š0.75ã€‚ Hashå€¼è·å–ä¸ä¸€æ · HashMap å†…éƒ¨ä½¿ç”¨hash(Object key)æ‰°åŠ¨å‡½æ•°å¯¹ key çš„ hashCode è¿›è¡Œæ‰°åŠ¨åä½œä¸º hash å€¼ã€‚HashTable æ˜¯ç›´æ¥ä½¿ç”¨ key çš„ hashCode() è¿”å›å€¼ä½œä¸º hash å€¼ã€‚ HashSet &amp; TreeSet &amp; LinkedHashSetSet çš„åº•å±‚å®ç°å°±æ˜¯ Mapï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ Set å­˜çš„å€¼å°±æ˜¯ Map çš„ keyï¼Œvalue å€¼æ˜¯ä¸€ä¸ªå›ºå®šå€¼ï¼Œæ‰€ä»¥â€¦å°±ä¸ç”¨åˆ†æå•¦ï¼ï¼ï¼ æœ‰ä¸ªæ³¨æ„ç‚¹å“ˆ~~ TreeMap ç”±äº key ä¸å¯ä»¥ä¸º nullï¼Œvalue å¯ä»¥ä¸ºnullã€‚æ‰€ä»¥åœ¨ TreeSet ä¸­ï¼Œå°±ä¸èƒ½æ’å…¥ null å…ƒç´ ã€‚ ç›¸å…³çŸ¥è¯†ç‚¹fail-fast å’Œ fail-safe æœºåˆ¶ä¸€ï¼šå¿«é€Ÿå¤±è´¥ï¼ˆfailâ€”fastï¼‰ åœ¨ç”¨è¿­ä»£å™¨éå†ä¸€ä¸ªé›†åˆå¯¹è±¡æ—¶ï¼Œå¦‚æœéå†è¿‡ç¨‹ä¸­å¯¹é›†åˆå¯¹è±¡çš„å†…å®¹è¿›è¡Œäº†ä¿®æ”¹ï¼ˆå¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºConcurrent Modification Exceptionã€‚ åŸç†ï¼šè¿­ä»£å™¨åœ¨éå†æ—¶ç›´æ¥è®¿é—®é›†åˆä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨éå†è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ª modCount å˜é‡ã€‚é›†åˆåœ¨è¢«éå†æœŸé—´å¦‚æœå†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šæ”¹å˜modCountçš„å€¼ã€‚æ¯å½“è¿­ä»£å™¨ä½¿ç”¨hashNext()/next()éå†ä¸‹ä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œéƒ½ä¼šæ£€æµ‹modCountå˜é‡æ˜¯å¦ä¸ºexpectedmodCountå€¼ï¼Œæ˜¯çš„è¯å°±è¿”å›éå†ï¼›å¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢éå†ã€‚ æ³¨æ„ï¼šè¿™é‡Œå¼‚å¸¸çš„æŠ›å‡ºæ¡ä»¶æ˜¯æ£€æµ‹åˆ° modCountï¼=expectedmodCount è¿™ä¸ªæ¡ä»¶ã€‚å¦‚æœé›†åˆå‘ç”Ÿå˜åŒ–æ—¶ä¿®æ”¹modCountå€¼åˆšå¥½åˆè®¾ç½®ä¸ºäº†expectedmodCountå€¼ï¼Œåˆ™å¼‚å¸¸ä¸ä¼šæŠ›å‡ºã€‚å› æ­¤ï¼Œä¸èƒ½ä¾èµ–äºè¿™ä¸ªå¼‚å¸¸æ˜¯å¦æŠ›å‡ºè€Œè¿›è¡Œå¹¶å‘æ“ä½œçš„ç¼–ç¨‹ï¼Œè¿™ä¸ªå¼‚å¸¸åªå»ºè®®ç”¨äºæ£€æµ‹å¹¶å‘ä¿®æ”¹çš„bugã€‚ åœºæ™¯ï¼šjava.utilåŒ…ä¸‹çš„é›†åˆç±»éƒ½æ˜¯å¿«é€Ÿå¤±è´¥çš„ï¼Œä¸èƒ½åœ¨å¤šçº¿ç¨‹ä¸‹å‘ç”Ÿå¹¶å‘ä¿®æ”¹ã€‚ äºŒï¼šå®‰å…¨å¤±è´¥ï¼ˆfailâ€”safeï¼‰ é‡‡ç”¨å®‰å…¨å¤±è´¥æœºåˆ¶çš„é›†åˆå®¹å™¨ï¼Œåœ¨éå†æ—¶ä¸æ˜¯ç›´æ¥åœ¨é›†åˆå†…å®¹ä¸Šè®¿é—®çš„ï¼Œè€Œæ˜¯å…ˆå¤åˆ¶åŸæœ‰é›†åˆå†…å®¹ï¼Œåœ¨æ‹·è´çš„é›†åˆä¸Šè¿›è¡Œéå†ã€‚ åŸç†ï¼šç”±äºè¿­ä»£æ—¶æ˜¯å¯¹åŸé›†åˆçš„æ‹·è´è¿›è¡Œéå†ï¼Œæ‰€ä»¥åœ¨éå†è¿‡ç¨‹ä¸­å¯¹åŸé›†åˆæ‰€ä½œçš„ä¿®æ”¹å¹¶ä¸èƒ½è¢«è¿­ä»£å™¨æ£€æµ‹åˆ°ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘Concurrent Modification Exceptionã€‚ ç¼ºç‚¹ï¼šåŸºäºæ‹·è´å†…å®¹çš„ä¼˜ç‚¹æ˜¯é¿å…äº†Concurrent Modification Exceptionï¼Œä½†åŒæ ·åœ°ï¼Œè¿­ä»£å™¨å¹¶ä¸èƒ½è®¿é—®åˆ°ä¿®æ”¹åçš„å†…å®¹ï¼Œå³ï¼šè¿­ä»£å™¨éå†çš„æ˜¯å¼€å§‹éå†é‚£ä¸€åˆ»æ‹¿åˆ°çš„é›†åˆæ‹·è´ï¼Œåœ¨éå†æœŸé—´åŸé›†åˆå‘ç”Ÿçš„ä¿®æ”¹è¿­ä»£å™¨æ˜¯ä¸çŸ¥é“çš„ã€‚ åœºæ™¯ï¼šjava.util.concurrentåŒ…ä¸‹çš„å®¹å™¨éƒ½æ˜¯å®‰å…¨å¤±è´¥ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘ä½¿ç”¨ï¼Œå¹¶å‘ä¿®æ”¹ã€‚ å¿«é€Ÿå¤±è´¥å’Œå®‰å…¨å¤±è´¥æ˜¯å¯¹è¿­ä»£å™¨è€Œè¨€çš„ã€‚ å¿«é€Ÿå¤±è´¥ï¼šå½“åœ¨éå†ä¸€ä¸ªé›†åˆçš„æ—¶å€™ï¼Œå¦‚æœæœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹åœ¨ä¿®æ”¹è¿™ä¸ªé›†åˆï¼Œå°±ä¼šæŠ›å‡ºConcurrentModificationå¼‚å¸¸ï¼Œjava.utilä¸‹éƒ½æ˜¯å¿«é€Ÿå¤±è´¥ã€‚ å®‰å…¨å¤±è´¥ï¼šåœ¨éå†æ—¶ä¼šåœ¨é›†åˆäºŒå±‚åšä¸€ä¸ªæ‹·è´ï¼Œæ‰€ä»¥åœ¨ä¿®æ”¹é›†åˆä¸Šå±‚å…ƒç´ ä¸ä¼šå½±å“ä¸‹å±‚ã€‚åœ¨java.util.concurrentä¸‹éƒ½æ˜¯å®‰å…¨å¤±è´¥ã€‚ çº¿ç¨‹å®‰å…¨è¯¦è§£å‚è€ƒçº¿ç¨‹å®‰å…¨é—®é¢˜]]></content>
  </entry>
  <entry>
    <title><![CDATA[äºŒå‰æ ‘ä¸“é¢˜æ€»ç»“]]></title>
    <url>%2F2020%2F01%2F10%2F%E4%BA%8C%E5%8F%89%E6%A0%91%E4%B8%93%E9%A2%98%E9%83%A8%E5%88%86.html</url>
    <content type="text"><![CDATA[å››ç§éå†å…ˆåºã€ä¸­åºã€ååºéå†ï¼Œéå¸¸ç®€å•ï¼æ¥ä¸‹æ¥æˆ‘ä¼šç”¨ä¸€ç§é€šç”¨çš„æ–¹å¼å®Œæˆè¿™ä¸‰ç§éå†å“Ÿï¼ ä¿è¯ä½ çœ‹å®Œèƒ½è¿…é€Ÿæ‰‹å†™ä¸‰ç§éå†çš„éé€’å½’ï¼ å…ˆåºéå†é€’å½’1234567891011121314class Solution &#123; public List&lt;Integer&gt; preorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; result = new LinkedList&lt;&gt;(); preorderHelper(root, result); return result; &#125; private void preorderHelper(TreeNode root, List&lt;Integer&gt; result) &#123; if (root == null) return; result.add(root.val); // è®¿é—®æ ¹èŠ‚ç‚¹ preorderHelper(root.left, result); // é€’å½’éå†å·¦å­æ ‘ preorderHelper(root.right, result); //é€’å½’éå†å³å­æ ‘ &#125;&#125; éé€’å½’12345678910111213141516171819202122232425/** * å†å†™ä¸€ä¸ªéé€’å½’çš„ * ç»Ÿä¸€å…ˆåºä¸­åºååºçš„å†™æ³• * ä»æ­¤å‹æ ˆæ—¶å†æ— å·¦å­æ ‘å‹æ ˆï¼Œå…¨éƒ¨éƒ½æ˜¯æ ¹èŠ‚ç‚¹å’Œå…¶å³å­æ ‘ï¼ * @param root */private List&lt;Integer&gt; preorderTraversalByIteration(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); //å¾—ç”¨ä¸€ä¸ªæ ˆæ¥è¿›è¡Œå¤„ç† Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); TreeNode cur = root; while(cur != null || !stack.isEmpty())&#123; while (cur != null)&#123; //å…ˆæŠŠæ ¹èŠ‚ç‚¹åŠ å…¥åˆ°listï¼Œç„¶åæŠŠæ‰€æœ‰çš„æ ¹èŠ‚ç‚¹åŠ å…¥ //å·¦èŠ‚ç‚¹å…¶å®ä¹Ÿå°±æ˜¯å­æ ‘çš„æ ¹èŠ‚ç‚¹ res.add(cur.val); stack.push(cur); cur = cur.left; &#125; //ç„¶åæ‹¿åˆ°æ ¹èŠ‚ç‚¹çš„å³å­æ ‘ï¼Œè¿›è¡Œéå† TreeNode top = stack.pop(); cur = top.right; &#125; return res;&#125; Tip: æˆ‘è¿™é‡Œå†æ‹“å±•ä¸€ç§éé€’å½’çš„æƒ³æ³•å§â€¦ä½†æ˜¯æˆ‘è§‰å¾—è¿™ç§æƒ³æ³•ä¸æ˜¯å¾ˆå¥½ï¼Œæ²¡æœ‰é€šç”¨çš„éé€’å½’æ€æƒ³ç®€å•ï¼å¼ºçƒˆå»ºè®®ä½¿ç”¨ä¸Šé¢çš„éé€’å½’æ€æƒ³ï¼ï¼ï¼ è‡³äºä¸ºä½•éè¦æè¿™ç§æ€æƒ³æï¼ŒåŸå› å°±æ˜¯ æ ˆ å¦‚æœæ¢æˆ é˜Ÿåˆ—ï¼Œå·¦å³èŠ‚ç‚¹é¡ºåºè°ƒä¸€ä¸‹ï¼Œå°±æ˜¯å±‚åºéå†äº†ï¼ æ€æƒ³ï¼š ä¸Šé¢çš„éé€’å½’çš„åšæ³•æ˜¯æŠŠä¸€æ£µæ ‘çœ‹åšåªæœ‰æ ¹èŠ‚ç‚¹å’Œå³èŠ‚ç‚¹ï¼Œå…ˆå…¨éƒ¨æŠŠæ ¹èŠ‚ç‚¹è¯»å®Œäº†ï¼Œå†å»è¯»å…¶å³èŠ‚ç‚¹ï¼Œè¿™æ ·ä¹Ÿå°±åšåˆ°äº† æ ¹ - å·¦ - å³ ä¸‹é¢è¦è®²çš„éé€’å½’çš„åšæ³•æ˜¯ å…ˆè¯»æ ¹èŠ‚ç‚¹ï¼Œç„¶åå°†å…¶åŠ å…¥æ ˆï¼Œç„¶ååªè¦æ ˆéç©ºï¼Œå°±å¼¹æ ˆï¼Œå°†å…¶åŠ å…¥éœ€è¦è¿”å›çš„åˆ—è¡¨ä¸­ï¼Œç„¶åå…ˆå°†å…¶å³å­æ ‘èŠ‚ç‚¹åŠ å…¥åˆ°æ ˆä¸­ï¼Œç„¶åå°†å·¦å­æ ‘èŠ‚ç‚¹åŠ å…¥åˆ°æ ˆä¸­ï¼Œæ³¨æ„ï¼Œè¿™é‡Œæ˜¯å…ˆå³å­æ ‘ï¼Œåå·¦å­æ ‘ï¼Œå› ä¸ºæ ˆæ˜¯åè¿›å…ˆå‡ºï¼ä¸‹ä¸€æ­¥å°±æ˜¯å·¦å­æ ‘å‡ºæ ˆï¼Œå°†å…¶åŠ å…¥åˆ—è¡¨ä¸­ã€‚ 12345678910111213141516class Solution &#123; public List&lt;Integer&gt; preorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; result = new LinkedList&lt;&gt;(); if (root == null) return result; Stack&lt;TreeNode&gt; toVisit = new Stack&lt;&gt;(); toVisit.push(root); TreeNode cur; while (!toVisit.isEmpty()) &#123; cur = toVisit.pop(); result.add(cur.val); // è®¿é—®æ ¹èŠ‚ç‚¹ if (cur.right != null) toVisit.push(cur.right); // å³èŠ‚ç‚¹å…¥æ ˆ if (cur.left != null) toVisit.push(cur.left); // å·¦èŠ‚ç‚¹å…¥æ ˆ &#125; return result; &#125;&#125; ä¸­åºéå†é€’å½’1234567891011121314class Solution &#123; public List&lt;Integer&gt; preorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; result = new LinkedList&lt;&gt;(); preorderHelper(root, result); return result; &#125; private void preorderHelper(TreeNode root, List&lt;Integer&gt; result) &#123; if (root == null) return; preorderHelper(root.left, result); // é€’å½’éå†å·¦å­æ ‘ result.add(root.val); // è®¿é—®æ ¹èŠ‚ç‚¹ preorderHelper(root.right, result); //é€’å½’éå†å³å­æ ‘ &#125;&#125; éé€’å½’123456789101112131415161718private List&lt;Integer&gt; inorderTraversalByIteration(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); TreeNode cur = root; while(cur != null || !stack.isEmpty())&#123; while (cur != null)&#123; //å·¦èŠ‚ç‚¹å…¶å®ä¹Ÿå°±æ˜¯å­æ ‘çš„æ ¹èŠ‚ç‚¹ stack.push(cur); cur = cur.left; &#125; //ä»æœ€åº•ä¸‹çš„æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ”¾å…¥åˆ—è¡¨ TreeNode top = stack.pop(); res.add(top.val); //ç„¶åæ‹¿åˆ°æ ¹èŠ‚ç‚¹çš„å³å­æ ‘ï¼Œè¿›è¡Œéå† cur = top.right; &#125; return res;&#125; ååºéå†é€’å½’1234567891011121314class Solution &#123; public List&lt;Integer&gt; preorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; result = new LinkedList&lt;&gt;(); preorderHelper(root, result); return result; &#125; private void preorderHelper(TreeNode root, List&lt;Integer&gt; result) &#123; if (root == null) return; preorderHelper(root.left, result); // é€’å½’éå†å·¦å­æ ‘ preorderHelper(root.right, result); //é€’å½’éå†å³å­æ ‘ result.add(root.val); // è®¿é—®æ ¹èŠ‚ç‚¹ &#125;&#125; éé€’å½’ååºéé€’å½’ç›¸å¯¹å‰ä¸¤ä¸ªéå†çš„éé€’å½’éœ€è¦ä¸€ä¸ªå°æŠ€å·§ï¼ ååºæ˜¯ å·¦ - å³ - æ ¹ï¼Œåè¿‡æ¥å°±æ˜¯æ ¹ - å³ - å·¦,é‚£å…¶å®è·Ÿå…ˆåºåŸºæœ¬å°±ä¸€æ¨¡ä¸€æ ·äº†ï¼Œå…ˆåºæ˜¯æ ¹ - å·¦ - å³ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨å…ˆåºçš„éé€’å½’ä¸­ æ”¹ä¸¤è¡Œä»£ç  + åŠ ä¸€è¡Œä»£ç  å°±å®Œæˆäº†ï¼ 12345678910111213141516private List&lt;Integer&gt; postorderTraversalByIteration(TreeNode root)&#123; List&lt;Integer&gt; list = new ArrayList&lt;&gt;(); TreeNode cur = root; Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); while(cur != null || !stack.isEmpty())&#123; while(cur != null)&#123; list.add(cur.val); stack.push(cur); cur = cur.right; &#125; TreeNode top = stack.pop(); cur = top.left; &#125; Collections.reverse(list); return list;&#125; å±‚åºéå†å±‚åºæ˜¯ä¸æ˜¯è¿˜æœ‰ä¸€ä¸ªåå­— å« BFS é€’å½’è¿™ä¸ªç«Ÿç„¶æ—¶é—´å’Œç©ºé—´å‡»è´¥äº†100%çš„äººâ€¦ è«åæœ‰ç‚¹å¼€å¿ƒå•Š 123456789101112131415161718192021public List&lt;List&lt;Integer&gt;&gt; levelOrder(Node root) &#123; if (root == null) return res; List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); helper(root, 0, res); return res;&#125;private void helper(Node root, int depth, List&lt;List&lt;Integer&gt;&gt; res) &#123; if (root == null) return; //åˆ¤æ–­æ˜¯å¦æ˜¯æ–°çš„ä¸€å±‚ if (depth + 1 &gt; res.size()) &#123; res.add(new ArrayList&lt;&gt;()); &#125; res.get(depth).add(root.val); //å¤„ç†å­èŠ‚ç‚¹ for (Node node : root.children) &#123; if (node != null) &#123; helper(node, depth + 1, res); &#125; &#125;&#125; éé€’å½’ä¸Šé¢è®²äº†ä¸€ç§ç”¨é˜Ÿåˆ—å®ç°çš„éé€’å½’æ€æƒ³ 1234567891011121314public static List&lt;Integer&gt; levelOrder(TreeNode root) &#123; List&lt;Integer&gt; result = new LinkedList&lt;&gt;(); if (root == null) return result; Queue&lt;TreeNode&gt; toVisit = new ArrayDeque&lt;&gt;(); toVisit.add(root); TreeNode cur; while (!toVisit.isEmpty()) &#123; cur = toVisit.poll(); result.add(cur.val); // è®¿é—®æ ¹èŠ‚ç‚¹ if (cur.left != null) toVisit.add(cur.left); // å·¦èŠ‚ç‚¹å…¥é˜Ÿåˆ— if (cur.right != null) toVisit.add(cur.right); // å³èŠ‚ç‚¹å…¥é˜Ÿåˆ— &#125; return result;&#125; 1234567891011121314151617181920212223242526272829/** * éé€’å½’æ–¹æ³•äºŒï¼Œè¿”å›å€¼ä¸ä¸€æ · * @param root * @return */public List&lt;List&lt;Integer&gt;&gt; levelOrderBy(TreeNode root) &#123; List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); if (root == null) return res; Queue&lt;TreeNode&gt; queue = new ArrayDeque&lt;&gt;(); queue.add(root); TreeNode cur; while (!queue.isEmpty()) &#123; List&lt;Integer&gt; list = new ArrayList&lt;&gt;(); int pre_number = queue.size(); while(pre_number &gt; 0)&#123; cur = queue.poll(); pre_number--; list.add(cur.val); if (cur.left != null)&#123; queue.add(cur.left); // å·¦èŠ‚ç‚¹å…¥é˜Ÿåˆ— &#125; if (cur.right != null) &#123; queue.add(cur.right); // å³èŠ‚ç‚¹å…¥é˜Ÿåˆ— &#125; &#125; res.add(list); &#125; return res;&#125; ç›¸å…³é¢˜å‹äºŒå‰æ ‘çš„å³è§†å›¾é¢˜ç›®ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œæƒ³è±¡è‡ªå·±ç«™åœ¨å®ƒçš„å³ä¾§ï¼ŒæŒ‰ç…§ä»é¡¶éƒ¨åˆ°åº•éƒ¨çš„é¡ºåºï¼Œè¿”å›ä»å³ä¾§æ‰€èƒ½çœ‹åˆ°çš„èŠ‚ç‚¹å€¼ã€‚ ç¤ºä¾‹: 123456789è¾“å…¥: [1,2,3,null,5,null,4]è¾“å‡º: [1, 3, 4]è§£é‡Š: 1 &lt;--- / \2 3 &lt;--- \ \ 5 4 &lt;--- æ€è·¯ å±‚åºéå† BFSã€‚å…ˆå†™å‡ºåŒé‡ list çš„å±‚åºéå†ï¼Œç„¶ååœ¨æ¯ä¸€ä¸ªå†…å±‚listä¸­æ‹¿åˆ°æœ€åä¸€ä¸ªå€¼å³å¯ï¼› æ·±åº¦éå† DFSã€‚é€’å½’ DFSï¼Œä»å³å‘å·¦ï¼Œæ‹¿åˆ°ç¬¬ä¸€ä¸ªæ•°å³å¯ã€‚ å®ç° BFS 123456789101112131415161718192021222324252627282930313233343536373839404142434445/** * Definition for a binary tree node. * public class TreeNode &#123; * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public List&lt;Integer&gt; rightSideView(TreeNode root) &#123; List&lt;List&lt;Integer&gt;&gt; lists = levelOrderBy(root); List&lt;Integer&gt; res = new ArrayList(); for(List&lt;Integer&gt; list : lists)&#123; res.add(list.get(list.size()-1)); &#125; return res; &#125;public List&lt;List&lt;Integer&gt;&gt; levelOrderBy(TreeNode root) &#123; List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); if (root == null) return res; Queue&lt;TreeNode&gt; queue = new ArrayDeque&lt;&gt;(); queue.add(root); TreeNode cur; while (!queue.isEmpty()) &#123; List&lt;Integer&gt; list = new ArrayList&lt;&gt;(); int pre_number = queue.size(); while(pre_number &gt; 0)&#123; cur = queue.poll(); pre_number--; list.add(cur.val); if (cur.left != null)&#123; queue.add(cur.left); // å·¦èŠ‚ç‚¹å…¥é˜Ÿåˆ— &#125; if (cur.right != null) &#123; queue.add(cur.right); // å³èŠ‚ç‚¹å…¥é˜Ÿåˆ— &#125; &#125; res.add(list); &#125; return res;&#125;&#125; DFS 1234567891011121314151617class Solution &#123; public List&lt;Integer&gt; rightSideView(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); solve(root, 0, res); return res; &#125; public void solve(TreeNode root, int level, List&lt;Integer&gt; res) &#123; if (root != null) &#123; if (res.size() == level) &#123; res.add(root.val); &#125; solve(root.right, level + 1, res); solve(root.left, level + 1, res); &#125; &#125;&#125; å¯¹ç§°äºŒå‰æ ‘é¢˜ç›®ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ£€æŸ¥å®ƒæ˜¯å¦æ˜¯é•œåƒå¯¹ç§°çš„ã€‚ ä¾‹å¦‚ï¼ŒäºŒå‰æ ‘ [1,2,2,3,4,4,3] æ˜¯å¯¹ç§°çš„ã€‚ 12345 1 / \ 2 2 / \ / \3 4 4 3 ä½†æ˜¯ä¸‹é¢è¿™ä¸ª [1,2,2,null,3,null,3] åˆ™ä¸æ˜¯é•œåƒå¯¹ç§°çš„: 12345 1 / \2 2 \ \ 3 3 æ€è·¯ å…ˆè®²ä¸€ä¸‹è‡ªå·±çš„æ€è·¯: åˆ©ç”¨å±‚åºéé€’å½’ï¼Œç”¨åŒå±‚Listå­˜å‚¨æ ‘çš„èŠ‚ç‚¹ï¼Œæ¯ä¸€å±‚å­˜å…¥ä¸€ä¸ªå•å±‚Listä¸­ï¼Œç„¶åå•å±‚Listå¯ä»¥é‡‡ç”¨äºŒåˆ†åˆ¤æ–­æ˜¯å¦å¯¹ç§°ï¼ ç­”æ¡ˆæ€è·¯ï¼šæ ‘çš„å¤åˆ¶ï¼Œè¿™ä¸ªæƒ³æ³•å¾ˆniceï¼å¤åˆ¶åŸæ ‘ï¼Œåˆ¤æ–­å…¶å·¦å­æ ‘èŠ‚ç‚¹æ˜¯å¦å’Œå³å­æ ‘èŠ‚ç‚¹ç›¸åŒä¸”åˆ¤æ–­å…¶å·¦å­æ ‘çš„å·¦æ˜¯å¦ç­‰äºå³å­æ ‘çš„å³ï¼Œå·¦å­æ ‘çš„å³æ˜¯å¦ç­‰äºå³å­æ ‘çš„å·¦ã€‚åœ¨éé€’å½’çš„å†™æ³•ä¸­ï¼Œæ ‘çš„å¤åˆ¶è¿™ç§æ€æƒ³ä½“ç°çš„æ›´åŠ æ˜æ˜¾ï¼Œè¿™ä¸ªå°±æ˜¯å…¸å‹çš„ç”¨ç©ºé—´æ¢æ—¶é—´ï¼ å®ç° æ ‘å¤åˆ¶æ€æƒ³ä¹‹é€’å½’ 12345678910111213141516171819202122232425262728293031323334/** * å¯¹ç§°äºŒå‰æ ‘ é€’å½’åšæ³• * æˆ‘çš„æƒ³æ³•æ˜¯ä½¿ç”¨å±‚åºéå†ï¼Œæ‰¾åˆ°å¯¹ç§°ç‚¹ï¼Œæ¯ä¸€å±‚åˆ¤æ–­å®Œå³å¯ï¼ * ç»“æœæ˜¯æ²¡å†™å‡ºæ¥ * çœ‹äº†ç­”æ¡ˆæ˜¯è‡ªå·±è·Ÿè‡ªå·±é•œåƒæ¯”è¾ƒï¼Œå¤ªå¦™äº†ï¼ï¼ * @param root * @return */ private static boolean isSymmetricByRecursion(TreeNode root)&#123; if (root == null) return true; return helper(root.left,root.right); &#125; /** * é€’å½’ä¸‰éƒ¨æ›² * 1ã€ç¡®å®šé€’å½’å‡ºå£ï¼Œå½“èŠ‚ç‚¹ä¸ºç©ºæ—¶ï¼Œå³æ— éœ€å†é€’å½’ * 2ã€ç¡®å®šè¿”å›å€¼ï¼Œè¿”å›å€¼ä¸ºbooleanï¼Œåˆ¤æ–­å½“å‰ * 3ã€é•œåƒå˜¿å˜¿ï¼Œè¿™ä¸ªæƒ³æ³•å¾ˆnice * @param tree1 * @param tree2 * @return */ private static boolean helper(TreeNode tree1, TreeNode tree2) &#123; //åˆ¤æ–­æ˜¯å¦æ˜¯æ–°çš„ä¸€å±‚ if(tree1 == null &amp;&amp; tree2 == null)&#123; return true; &#125; else if(tree1 == null || tree2 == null)&#123; return false; &#125; else &#123; return tree1.val == tree2.val &amp;&amp; helper(tree1.left,tree2.right) &amp;&amp; helper(tree1.right,tree2.left); &#125; &#125; æ ‘å¤åˆ¶ä¹‹éé€’å½’ Tip: åœ¨å¤ç°éé€’å½’æ—¶ï¼Œå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯Queueçš„å®ç°ç±»ArrayDequeæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å…¶ä¸å…è®¸å­˜å‚¨nullå…ƒç´ ï¼Œè¿™ä¸ªè·ŸArrayListã€LinkedListã€HashMapã€TreeMapç­‰éçº¿ç¨‹å®‰å…¨çš„é›†åˆä¸åŒï¼ï¼ï¼ï¼å› ä¸ºç³»ç»Ÿæ ¹æ®æŸä¸ªä½ç½®æ˜¯å¦ä¸ºnullæ¥åˆ¤æ–­å…ƒç´ çš„å­˜åœ¨ï¼Œnullæ’å…¥ç›´æ¥ä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚[ArrayDequeå½“ä½œä¸ºæ ˆä½¿ç”¨æ—¶ï¼Œæ€§èƒ½æ¯”Stackå¥½ï¼›å½“ä½œä¸ºé˜Ÿåˆ—ä½¿ç”¨æ—¶ï¼Œæ€§èƒ½æ¯”LinkedListå¥½ã€‚] æ‰€ä»¥è¿™é‡Œä½¿ç”¨äº†Queueçš„å¦å¤–ä¸€ä¸ªå®ç°ç±»LinkedListï¼Œå®ƒä¹Ÿæ˜¯éçº¿ç¨‹å®‰å…¨çš„å“Ÿï¼Œä½†æ˜¯å¯ä»¥å­˜å‚¨nullï¼ï¼ï¼ 123456789101112131415161718private static boolean isSymmetricByIteration(TreeNode root)&#123; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); if(root == null) return true; queue.add(root.left); queue.add(root.right); while(!queue.isEmpty())&#123; TreeNode tree1 = queue.poll(); TreeNode tree2 = queue.poll(); if(tree1 == null &amp;&amp; tree2 == null ) continue; if(tree1 == null || tree2 == null) return false; if(tree1.val != tree2.val) return false; queue.add(tree1.left); queue.add(tree2.right); queue.add(tree1.right); queue.add(tree2.left); &#125; return true;&#125; å±‚åºéé€’å½’ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** * è¿­ä»£ * @param root * @return */ private static boolean isSymmetricByLevel(TreeNode root)&#123; List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); if (root == null) return true; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.add(root); TreeNode cur; //å¾—åˆ°åŒå±‚list while (!queue.isEmpty()) &#123; List&lt;Integer&gt; list = new LinkedList&lt;&gt;(); int pre_number = queue.size(); System.out.println(pre_number); while(pre_number &gt; 0 )&#123; cur = queue.poll(); pre_number--; if(cur == null) &#123; list.add(null); continue; &#125; list.add(cur.val); if (cur.left != null)&#123; queue.add(cur.left); // å·¦èŠ‚ç‚¹å…¥é˜Ÿåˆ— &#125; else&#123; queue.add(null); &#125; if (cur.right != null) &#123; queue.add(cur.right); // å³èŠ‚ç‚¹å…¥é˜Ÿåˆ— &#125; else&#123; queue.add(null); &#125; &#125; res.add(list); &#125; //å¯¹æ¯ä¸€å±‚listè¿›è¡Œåˆ¤æ–­ï¼Œçœ‹æ˜¯å¦æ˜¯å¯¹ç§°çš„ï¼Œå¯ä»¥ä½¿ç”¨dp for(List list:res)&#123; int size = list.size(); for(int i = 0;i &lt; size/2;i++)&#123; if(list.get(i) != list.get(size-1-i))&#123; return false; &#125; &#125; &#125; return true; &#125; äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦å–ï¼è¿™ä¸ªæ˜¯äºŒå‰æ ‘æœ€ç®€å•çš„é¢˜ç›®äº†å§â€¦ä½†æ˜¯ç»å¯¹æ˜¯ä¸€é“ç»å…¸å¥½é¢˜ï¼ä¸‹é¢å°†ç”¨æœ€å¸¸ç”¨çš„ä¸‰ç§æ–¹æ³•è§£å†³å®ƒï¼ é¢˜ç›®ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚ äºŒå‰æ ‘çš„æ·±åº¦ä¸ºæ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚ è¯´æ˜: å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ ç¤ºä¾‹ï¼š ç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]ï¼Œ 3 / \ 9 20 / \ 15 7 è¿”å›å®ƒçš„æœ€å¤§æ·±åº¦ 3 ã€‚ æ€è·¯ æ–¹æ³•ä¸€ï¼šé€’å½’ã€‚è¿™ä¸ªæˆ‘åœ¨å¦å¤–ä¸€ç¯‡é€’å½’ä¸­çš„æ–‡ç« ä¸­æœ‰æåˆ°ï¼Œå¯ä»¥ä¸€è¡Œä»£ç è§£å†³å“Ÿï¼ æ–¹æ³•äºŒï¼šå±‚åºéå†ã€‚å³ç”¨BFSè§£å†³ï¼Œæ¯éå†å®Œä¸€å±‚å°±è®°å½•æ·±åº¦ã€‚ æ–¹æ³•ä¸‰ï¼šDFSã€‚ç”¨æ ˆå®ç°å³å¯ã€‚(è¿˜å­¦åˆ°Pairè¿™ç©æ„â€¦ä¸ºä½•æˆ‘ä»¥å‰éƒ½ä¸çŸ¥é“) å®ç° é€’å½’ 1ã€æ‰¾å‡ºå£ï¼ŒèŠ‚ç‚¹ä¸ºç©ºå³å¯é€€å‡ºé€’å½’ã€‚ 2ã€æ‰¾è¿”å›å€¼ï¼Œè¿”å›çš„æ˜¯è¯¥èŠ‚ç‚¹æ‰€åœ¨å±‚çš„æ·±åº¦ã€‚ 3ã€ç¡®å®šä¸€æ¬¡é€’å½’éœ€è¦åšä»€ä¹ˆã€‚å½“å‰èŠ‚ç‚¹æ·±åº¦ = å­èŠ‚ç‚¹æœ€å¤§æ·±åº¦ + 1ã€‚ 12345class Solution &#123; public int maxDepth(TreeNode root) &#123; return root == null ? 0 : Math.max(maxDepth(root.left), maxDepth(root.right)) + 1; &#125;&#125; BFS å±‚åºéé€’å½’éå†ï¼Œç¨å¾®æ”¹å†™ä¸€ä¸‹å°±å¥½äº†ï¼Œè¿™é‡Œä¸éœ€è¦å­˜å‚¨èŠ‚ç‚¹ï¼Œæ‰€ä»¥åªéœ€è¦ç”¨ä¸€ä¸ªå€¼æ¥è®°å½•æ·±åº¦å³å¯ã€‚ ç¬¬ä¸€ç§éé€’å½’æ–¹å¼æ”¹å†™ 12345678910111213141516171819import javafx.util.Pair;class Solution &#123; public int maxDepth(TreeNode root) &#123; List&lt;Integer&gt; result = new LinkedList&lt;&gt;(); if (root == null) return 0; Queue&lt;Pair&lt;TreeNode,Integer&gt;&gt; toVisit = new ArrayDeque&lt;&gt;(); toVisit.add(new Pair&lt;&gt;(root,1)); Pair&lt;TreeNode,Integer&gt; cur; int max_depth = 0; while (!toVisit.isEmpty()) &#123; cur = toVisit.poll(); int depth = cur.getValue(); max_depth = Math.max(max_depth,depth); if (cur.getKey().left != null) toVisit.add(new Pair&lt;&gt;(cur.getKey().left,depth + 1)); // å·¦èŠ‚ç‚¹å…¥é˜Ÿåˆ— if (cur.getKey().right != null) toVisit.add(new Pair&lt;&gt;(cur.getKey().right,depth + 1)); // å³èŠ‚ç‚¹å…¥é˜Ÿåˆ— &#125; return max_depth; &#125;&#125; ç¬¬äºŒç§éé€’å½’æ–¹å¼æ”¹å†™ 1234567891011121314151617181920212223242526272829303132333435363738/** * Definition for a binary tree node. * public class TreeNode &#123; * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public int maxDepth(TreeNode root) &#123; // List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); //è¿™é‡Œæ— éœ€å­˜å‚¨èŠ‚ç‚¹ï¼Œåªéœ€è®°å½•æ·±åº¦å³å¯ int depth = 0; if (root == null) return depth; Queue&lt;TreeNode&gt; queue = new ArrayDeque&lt;&gt;(); queue.add(root); TreeNode cur; while (!queue.isEmpty()) &#123;// List&lt;Integer&gt; list = new ArrayList&lt;&gt;(); int pre_number = queue.size(); while(pre_number &gt; 0)&#123; cur = queue.poll(); pre_number--;// list.add(cur.val); //è¿™é‡Œå¯ä»¥ä¸ç”¨åŠ å…¥åˆ—è¡¨ if (cur.left != null)&#123; queue.add(cur.left); // å·¦èŠ‚ç‚¹å…¥é˜Ÿåˆ— &#125; if (cur.right != null) &#123; queue.add(cur.right); // å³èŠ‚ç‚¹å…¥é˜Ÿåˆ— &#125; &#125;// res.add(list); depth++; &#125;// return res.size(); return depth; &#125;&#125; DFS å…¶å®å°±æ˜¯åœ¨å…ˆåºéé€’å½’çš„åŸºç¡€ä¸Šç¨åŠ æ”¹åŠ¨ï¼Œå‹æ ˆçš„ä¸å†åªæ˜¯èŠ‚ç‚¹ï¼Œè¿˜åŒ…æ‹¬äº†èŠ‚ç‚¹çš„æ·±åº¦ï¼Œç”¨Pairç±»å‹å­˜å‚¨ï¼ å°è¯•äº†ç”¨Mapç±»å‹å­˜å‚¨ï¼Œå‘ç°è¡Œä¸é€šâ€¦å› ä¸ºæ‹¿ä¸åˆ°æ ˆé¡¶çš„èŠ‚ç‚¹ï¼ 123456789101112131415161718192021222324import javafx.util.Pair;class Solution &#123; public int maxDepth(TreeNode root) &#123; //å¾—ç”¨ä¸€ä¸ªæ ˆæ¥è¿›è¡Œå¤„ç† Stack&lt;Pair&lt;TreeNode,Integer&gt;&gt; stack = new Stack&lt;&gt;(); TreeNode cur = root; int depth= 0; int MaxDepth = 0; while(cur != null || !stack.isEmpty())&#123; while (cur != null)&#123; //å·¦èŠ‚ç‚¹å…¶å®ä¹Ÿå°±æ˜¯å­æ ‘çš„æ ¹èŠ‚ç‚¹ depth++; stack.push(new Pair&lt;&gt;(cur,depth)); cur = cur.left; &#125; //ç„¶åæ‹¿åˆ°æ ¹èŠ‚ç‚¹çš„å³å­æ ‘ï¼Œè¿›è¡Œéå† Pair&lt;TreeNode,Integer&gt; top = stack.pop(); depth = top.getValue(); MaxDepth = Math.max(depth,MaxDepth); cur = top.getKey().right; &#125; return MaxDepth; &#125;&#125; è·¯å¾„æ€»å’Œé¢˜ç›®ç»™å®šä¸€ä¸ªäºŒå‰æ ‘å’Œä¸€ä¸ªç›®æ ‡å’Œï¼Œåˆ¤æ–­è¯¥æ ‘ä¸­æ˜¯å¦å­˜åœ¨æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ï¼Œè¿™æ¡è·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹å€¼ç›¸åŠ ç­‰äºç›®æ ‡å’Œã€‚ è¯´æ˜: å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ ç¤ºä¾‹:ç»™å®šå¦‚ä¸‹äºŒå‰æ ‘ï¼Œä»¥åŠç›®æ ‡å’Œ sum = 22ï¼Œ 5 / \ 4 8 / / \ 11 13 4 / \ \ 7 2 1 è¿”å› true, å› ä¸ºå­˜åœ¨ç›®æ ‡å’Œä¸º 22 çš„æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ 5-&gt;4-&gt;11-&gt;2ã€‚ æ€è·¯ é€’å½’ã€‚æˆ‘éƒ½é€’å½’çš„è¦åäº†ï¼ŒäºŒå‰æ ‘æ—¥å¸¸é€’å½’ï¼ DFSï¼Œè‡ªå·±å»ºæ ˆæ¨¡æ‹Ÿé€’å½’ã€‚ å®ç° é€’å½’ 1 ï¼ˆä¸‰å…ƒè¡¨è¾¾å¼çº¯ç²¹è£…é€¼å“ˆå“ˆå“ˆï¼‰ 12345678910class Solution &#123; public boolean hasPathSum(TreeNode root, int sum) &#123; return root == null ? false : hasPathSumByRecursion(root,0,sum); &#125; private boolean hasPathSumByRecursion(TreeNode root, int total, int sum) &#123; if(root == null) return false; total = total + root.val; return (root.left == null &amp;&amp; root.right == null) ? total == sum : hasPathSumByRecursion(root.left,total,sum) || hasPathSumByRecursion(root.right,total,sum); &#125;&#125; é€’å½’ 2 12345678public boolean hasPathSum(TreeNode root,int sum)&#123; if(root == null) return false; sum-=root.val; if(root.left == null &amp;&amp; root.right == null)&#123; return sum == 0; &#125; return hasPathSum(root.left,sum) || hasPathSum(root.right,sum);&#125; DFS æˆ‘è§‰å¾—æ€æƒ³éƒ½å¾ˆç®€å•å•Šï¼Œå…¶å®äºŒå‰æ ‘çš„åŸºæœ¬ä¸Šæ‰€æœ‰çš„é¢˜ç›®éƒ½æ˜¯å»ºç«‹åœ¨å‰åºå’Œå±‚åºéå†çš„åŸºç¡€ä¸Šçš„ï¼Œç†Ÿç»ƒæŒæ¡äº†å‰åºå’Œå±‚åºçš„é€’å½’éé€’å½’å°±åŸºæœ¬èƒ½è§£æ‰€æœ‰é¢˜ç›®äº†â€¦ (åœ¨å‰åºéé€’å½’çš„åŸºç¡€ä¸Šç¨åŠ æ”¹åŠ¨å°±è¡Œäº†â€¦) 123456789101112131415import javafx.util.Pair;class Solution &#123; public boolean hasPathSum(TreeNode root, int sum) &#123; if (root == null) return false; Stack&lt;Pair&lt;TreeNode,Integer&gt;&gt; toVisit = new Stack&lt;&gt;(); toVisit.push(new Pair&lt;&gt;(root,root.val)); while (!toVisit.isEmpty())&#123; Pair&lt;TreeNode,Integer&gt; cur = toVisit.pop(); if (cur.getKey().right != null) toVisit.push(new Pair&lt;&gt;(cur.getKey().right,cur.getValue()+cur.getKey().right.val)); // å³èŠ‚ç‚¹å…¥æ ˆ if (cur.getKey().left != null) toVisit.push(new Pair&lt;&gt;(cur.getKey().left,cur.getValue()+cur.getKey().left.val)); // å·¦èŠ‚ç‚¹å…¥æ ˆ if(cur.getKey().left == null &amp;&amp; cur.getKey().right == null &amp;&amp; cur.getValue() == sum) return true; &#125; return false; &#125;&#125; ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘é¢˜ç›®æ ¹æ®ä¸€æ£µæ ‘çš„ä¸­åºéå†ä¸ååºéå†æ„é€ äºŒå‰æ ‘ã€‚ æ³¨æ„:ä½ å¯ä»¥å‡è®¾æ ‘ä¸­æ²¡æœ‰é‡å¤çš„å…ƒç´ ã€‚ ä¾‹å¦‚ï¼Œç»™å‡º 12ä¸­åºéå† inorder = [9,3,15,20,7]ååºéå† postorder = [9,15,7,20,3] è¿”å›å¦‚ä¸‹çš„äºŒå‰æ ‘ï¼š 12345 3 / \9 20 / \ 15 7 æ€è·¯æˆ‘å†™çš„åº”è¯¥æ¯”è¾ƒç®€æ´ï¼Œå‚æ•°å°‘çš„åŸå› æ˜¯æŠ“ä½äº†ååºæ˜¯å·¦--å³--æ ¹çš„ç‰¹ç‚¹ï¼Œæ‰€ä»¥ååºéå†ä»åå‘å‰æ˜¯æ ¹--å³--å·¦ï¼Œæ•…åœ¨é€’å½’æ—¶æ ¹æœ¬æ²¡æœ‰å¿…è¦å°†ååºéå†çš„æ•°ç»„ç•Œé™ä¼ å…¥ï¼Œæ¯æ¬¡æœ‰èŠ‚ç‚¹åŠ å…¥å°±è‡ªå‡ä¸€å°±è¡Œï¼Œåªè¦æ»¡è¶³äº†å…ˆæ‹¿åˆ°æ ¹èŠ‚ç‚¹ç„¶åéå†å³å­æ ‘ï¼Œå†éå†å·¦å­æ ‘è¿™ä¸ªåŸåˆ™å°±Okayã€‚ è‡³äºé€’å½’å¦‚ä½•å†™ï¼Œå…¶å®æŠŠæ¡ä¸‰ä¸ªåŸåˆ™å°±è¡Œï¼š é€’å½’å‡ºå£ï¼Œè¿™é‡Œå°±ä¸è§£é‡Šäº† æ¯æ¬¡é€’å½’çš„è¿”å›å€¼ï¼Œè¿™é‡Œå¾ˆæ˜æ˜¾å°±æ˜¯é¢˜ç›®è¦æ±‚çš„rootèŠ‚ç‚¹ å•æ¬¡é€’å½’éœ€è¦åšçš„äº‹ï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªæ ‘ï¼Œé‚£ä¹ˆå•æ¬¡é€’å½’å°±æ˜¯æ‹¿åˆ°æ ¹èŠ‚ç‚¹ï¼Œå¹¶ä¸”æŒ‡å‘æ­£ç¡®çš„å·¦å³å­æ ‘å³å¯ã€‚ ä»£ç 123456789101112131415161718192021222324class Solution &#123; int index; Map&lt;Integer,Integer&gt; map = new HashMap&lt;&gt;(); public TreeNode buildTree(int[] inorder,int[] postorder)&#123; index = inorder.length - 1; for(int i = 0;i &lt;= index; i++)&#123; map.put(inorder[i],i); &#125; return buildTreeByRecursion(inorder,postorder,0,index); &#125; private TreeNode buildTreeByRecursion(int[] inorder,int[] postorder,int inorder_start,int inorder_end)&#123; if(inorder_start &gt; inorder_end) return null; //å…ˆæ‹¿åˆ°æ ¹èŠ‚ç‚¹çš„å€¼,ç¡®å®šå…¶åœ¨ä¸­åºéå†çš„ä½ç½®ï¼Œå¹¶ä¸”å°†å…¶ååºéå†çš„ç´¢å¼•å€¼çš„æœ«å°¾å¾€å‰ä¸€ä½ int inorder_root = map.get(postorder[index]); TreeNode root = new TreeNode(postorder[index--]); //ç„¶åç¡®å®šå·¦å³å­æ ‘ï¼Œå¹¶ä¸”é€’å½’å³å¯ // æ³¨æ„å“¦ï¼æ˜¯å¿…é¡»å…ˆé€’å½’å³å­æ ‘ï¼Œå†é€’å½’å·¦å­æ ‘ï¼Œå› ä¸ºååºæ˜¯å·¦å³æ ¹çš„é¡ºåºï¼Œååºæœ«å°¾è‡ªå‡ä¸€ï¼Œæ­¤æ—¶åº”è¯¥æ˜¯å³å­æ ‘çš„æ ¹èŠ‚ç‚¹ï¼ // æ‰€ä»¥å¿…é¡»å…¨éƒ¨å³å­æ ‘æ„å»ºå®Œæˆå†å»æ„å»ºå·¦å­æ ‘ root.right = buildTreeByRecursion(inorder,postorder,inorder_root + 1,inorder_end); root.left = buildTreeByRecursion(inorder,postorder,inorder_start,inorder_root - 1); return root; &#125;&#125; ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘é¢˜ç›®æ ¹æ®ä¸€æ£µæ ‘çš„å‰åºéå†ä¸ä¸­åºéå†æ„é€ äºŒå‰æ ‘ã€‚ æ³¨æ„:ä½ å¯ä»¥å‡è®¾æ ‘ä¸­æ²¡æœ‰é‡å¤çš„å…ƒç´ ã€‚ ä¾‹å¦‚ï¼Œç»™å‡º 12å‰åºéå† preorder = [3,9,20,15,7]ä¸­åºéå† inorder = [9,3,15,20,7] è¿”å›å¦‚ä¸‹çš„äºŒå‰æ ‘ï¼š 12345 3 / \9 20 / \ 15 7 æ€è·¯è·Ÿä¸Šé¢çš„æ€è·¯ä¸€è‡´ï¼Œå°±æ˜¯åˆšå¥½ç›¸åè€Œå·²å˜›â€¦ ä»£ç 1234567891011121314151617181920212223class Solution &#123; int pre = 0; Map&lt;Integer,Integer&gt; pre_in_map = new HashMap&lt;&gt;(); public TreeNode buildTree(int[] preorder,int[] inorder)&#123; int inorder_end = inorder.length - 1; for(int i = 0;i &lt;= inorder_end; i++)&#123; pre_in_map.put(inorder[i],i); &#125; return buildTreeByRecursion(preorder,inorder,0,inorder_end); &#125; private TreeNode buildTreeByRecursion(int[] preorder,int[] inorder,int inorder_start,int inorder_end)&#123; if(inorder_start &gt; inorder_end) return null; //å…ˆæ‹¿åˆ°æ ¹èŠ‚ç‚¹çš„å€¼,ç¡®å®šå…¶åœ¨ä¸­åºéå†çš„ä½ç½®ï¼Œå¹¶ä¸”å°†å…ˆåºéå†çš„ç´¢å¼•å€¼çš„å¼€å§‹å€¼å‘å‰ä¸€ä½ int inorder_root = pre_in_map.get(preorder[pre]); TreeNode root = new TreeNode(preorder[pre++]); //ç„¶åç¡®å®šå·¦å³å­æ ‘ï¼Œå¹¶ä¸”é€’å½’å³å¯ // æ³¨æ„å“¦ï¼æ˜¯å¿…é¡»å…ˆé€’å½’å·¦å­æ ‘ï¼Œå†é€’å½’å³å­æ ‘ï¼Œå› ä¸ºå…ˆåºæ˜¯æ ¹å·¦å³çš„é¡ºåº // æ‰€ä»¥å¿…é¡»å…¨éƒ¨å·¦å­æ ‘æ„å»ºå®Œæˆå†å»æ„å»ºå³å­æ ‘ root.left = buildTreeByRecursion(preorder,inorder,inorder_start,inorder_root - 1); root.right = buildTreeByRecursion(preorder,inorder,inorder_root + 1,inorder_end); return root; &#125;&#125; å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆé¢˜ç›®ç»™å®šä¸€ä¸ªå®Œç¾äºŒå‰æ ‘ï¼Œå…¶æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ï¼Œæ¯ä¸ªçˆ¶èŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚äºŒå‰æ ‘å®šä¹‰å¦‚ä¸‹ï¼š 123456struct Node &#123; int val; Node *left; Node *right; Node *next;&#125; å¡«å……å®ƒçš„æ¯ä¸ª next æŒ‡é’ˆï¼Œè®©è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ã€‚å¦‚æœæ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œåˆ™å°† next æŒ‡é’ˆè®¾ç½®ä¸º NULLã€‚ åˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰ next æŒ‡é’ˆéƒ½è¢«è®¾ç½®ä¸º NULLã€‚ ç¤ºä¾‹ï¼š æ€è·¯ æœ€ç®€å•çš„æ€è·¯ï¼šå±‚åºéå†ï¼Œåˆ†åˆ«è·å¾—æ¯å±‚çš„èŠ‚ç‚¹ï¼Œç„¶åç”Ÿæˆé“¾è¡¨ï¼Œæ‰€ä»¥è¿™ä¸ªä¸æ˜¯å®Œç¾äºŒå‰æ ‘ä¹Ÿå¯ä»¥åšï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰ç”¨åˆ° å®Œå…¨äºŒå‰æ ‘ çš„æ€§è´¨ï¼æ‰€ä»¥å¿…å®šä¸æ˜¯æœ€ä¼˜è§£ï¼è€Œä¸”è¿™ä¸ªä½¿ç”¨çš„ä¸æ˜¯å¸¸é‡çº§çš„ç©ºé—´ï¼Œå…¶å®æ˜¯ä¸å¤ªç¬¦åˆè¦æ±‚çš„ã€‚ (çœ‹äº†ç­”æ¡ˆçš„)é«˜èµçš„ æ‹‰æ‹‰é“¾è§£æ³•ï¼Œå°†ä¸€æ£µå¤§çš„äºŒå‰æ ‘ä¸€åˆ†ä¸ºäºŒï¼Œå¤„ç†ä¸¤æ£µå°äºŒå‰æ ‘çš„è¿æ¥ï¼Œå†é€’å½’è§£å†³å°äºŒå‰æ ‘å†…éƒ¨è¿æ¥ã€‚ è¿˜æœ‰ä¸€ç§éé€’å½’çš„æ–¹æ³•ï¼Œä¸ªäººè§‰å¾—ä¹Ÿæ˜¯éå¸¸çš„ç²¾å¦™ï¼Œä¹‹å‰æˆ‘ä»¬æ˜¯ç”¨åˆ—è¡¨ä¿å­˜æ¯ä¸€å±‚çš„èŠ‚ç‚¹ï¼Œå…¶å®è¿™æ˜¯ä¸€ç§æµªè´¹ã€‚åªéœ€è¦è§£å†³ä¸‰ä¸ªé—®é¢˜å°±å¤Ÿäº†ã€‚å‚è€ƒç½‘å€ æ¯ä¸€å±‚æ€ä¹ˆéå†ï¼Ÿ ä¹‹å‰æ˜¯ç”¨é˜Ÿåˆ—å°†ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ä¿å­˜äº†èµ·æ¥ã€‚ è¿™é‡Œçš„è¯ï¼Œå…¶å®åªéœ€è¦æå‰æŠŠä¸‹ä¸€å±‚çš„nextæ„é€ å®Œæˆï¼Œåˆ°äº†ä¸‹ä¸€å±‚çš„æ—¶å€™å°±å¯ä»¥éå†äº†ã€‚ ä»€ä¹ˆæ—¶å€™è¿›å…¥ä¸‹ä¸€å±‚ï¼Ÿ ä¹‹å‰æ˜¯å¾—åˆ°å½“å‰é˜Ÿåˆ—çš„å…ƒç´ ä¸ªæ•°ï¼Œç„¶åéå†é‚£ä¹ˆå¤šæ¬¡ã€‚ â€‹ è¿™é‡Œçš„è¯ï¼Œæ³¨æ„åˆ°æœ€å³è¾¹çš„èŠ‚ç‚¹çš„nextä¸ºnullï¼Œæ‰€ä»¥å¯ä»¥åˆ¤æ–­å½“å‰éå†çš„èŠ‚ç‚¹æ˜¯ä¸æ˜¯nullã€‚ æ€ä¹ˆå¾—åˆ°æ¯å±‚å¼€å¤´èŠ‚ç‚¹ï¼Ÿ ä¹‹å‰é˜Ÿåˆ—æŠŠå½“å‰å±‚çš„æ‰€ä»¥èŠ‚ç‚¹å­˜äº†èµ·æ¥ï¼Œå¾—åˆ°å¼€å¤´èŠ‚ç‚¹å½“ç„¶å¾ˆå®¹æ˜“ã€‚ è¿™é‡Œçš„è¯ï¼Œæˆ‘ä»¬é¢å¤–éœ€è¦ä¸€ä¸ªå˜é‡æŠŠå®ƒå­˜èµ·æ¥ã€‚ ä¸‰ä¸ªé—®é¢˜éƒ½è§£å†³äº†ï¼Œå°±å¯ä»¥å†™ä»£ç äº†ã€‚åˆ©ç”¨ä¸‰ä¸ªæŒ‡é’ˆï¼ŒstartæŒ‡çš„æ˜¯å½“å‰å±‚çš„æœ€å·¦èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æœ¬å±‚çš„èµ·ç‚¹ï¼ŒcuræŒ‡çš„æ˜¯å½“å‰æ­£åœ¨éå†çš„èŠ‚ç‚¹ï¼Œcur.nextæŒ‡çš„æ˜¯æ­£åœ¨éå†çš„èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼æˆ‘è§‰å¾—è¿™ä¸ªæ–¹æ³•æœ€éš¾æƒ³çš„å°±æ˜¯ åœ¨éå†æœ¬å±‚çš„æ—¶å€™ï¼Œå°†ä¸‹å±‚çš„nextæ„é€ å®Œæˆï¼ï¼ï¼ ä»£ç  æ–¹æ³•ä¸€ï¼šå±‚åºéå† 12345678910111213141516171819202122232425262728293031/** * å±‚åºéå† * @param root * @return */public Node connect1(Node root) &#123; if (root == null) &#123; return root; &#125; Queue&lt;Node&gt; queue = new LinkedList&lt;Node&gt;(); queue.offer(root); while (!queue.isEmpty()) &#123; int size = queue.size(); Node pre = null; for (int i = 0; i &lt; size; i++) &#123; Node cur = queue.poll(); //ä»ç¬¬äºŒä¸ªèŠ‚ç‚¹å¼€å§‹ï¼Œå°†å‰ä¸€ä¸ªèŠ‚ç‚¹çš„ pre æŒ‡å‘å½“å‰èŠ‚ç‚¹ if (i &gt; 0) &#123; pre.next = cur; &#125; pre = cur; if (cur.left != null) &#123; queue.offer(cur.left); &#125; if (cur.right != null) &#123; queue.offer(cur.right); &#125; &#125; &#125; return root;&#125; æ–¹æ³•äºŒï¼šæ‹‰æ‹‰é“¾æ³• 123456789101112131415161718/** * æ–¹æ³•äºŒ æ‹‰æ‹‰é“¾æ³• * @param root * @return */public Node connect2(Node root)&#123; if(root == null) return null; Node left = root.left; Node right = root.right; while(left != null)&#123; left.next = right; left = left.right; right = right.left; &#125; connect1(root.left); connect1(root.right); return root;&#125; æ–¹æ³•ä¸‰ï¼šéé€’å½’è§£æ³•ï¼ˆä¸ªäººæœ€æ¨èçš„åšæ³•ï¼‰ 12345678910111213141516171819/** * éé€’å½’è§£æ³•ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯æœ€ç¬¦åˆé¢˜æ„çš„è§£æ³• * @param root * @return */public Node connect3(Node root)&#123; if(root == null) return null; Node start = root; while(start.left != null)&#123; Node cur = start; while(cur != null)&#123; cur.left.next = cur.right; if(cur.next != null) cur.right.next = cur.next.left; cur = cur.next; &#125; start = start.left; &#125; return root;&#125; å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ IIé¢˜ç›®ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ 123456struct Node &#123; int val; Node *left; Node *right; Node *next;&#125; å¡«å……å®ƒçš„æ¯ä¸ª next æŒ‡é’ˆï¼Œè®©è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ã€‚å¦‚æœæ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œåˆ™å°† next æŒ‡é’ˆè®¾ç½®ä¸º NULLã€‚ åˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰ next æŒ‡é’ˆéƒ½è¢«è®¾ç½®ä¸º NULLã€‚ è¿›é˜¶ï¼š ä½ åªèƒ½ä½¿ç”¨å¸¸é‡çº§é¢å¤–ç©ºé—´ã€‚ ä½¿ç”¨é€’å½’è§£é¢˜ä¹Ÿç¬¦åˆè¦æ±‚ï¼Œæœ¬é¢˜ä¸­é€’å½’ç¨‹åºå ç”¨çš„æ ˆç©ºé—´ä¸ç®—åšé¢å¤–çš„ç©ºé—´å¤æ‚åº¦ã€‚ ç¤ºä¾‹ï¼š 123è¾“å…¥ï¼šroot = [1,2,3,4,5,null,7]è¾“å‡ºï¼š[1,#,2,3,#,4,5,7,#]è§£é‡Šï¼šç»™å®šäºŒå‰æ ‘å¦‚å›¾ A æ‰€ç¤ºï¼Œä½ çš„å‡½æ•°åº”è¯¥å¡«å……å®ƒçš„æ¯ä¸ª next æŒ‡é’ˆï¼Œä»¥æŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œå¦‚å›¾ B æ‰€ç¤ºã€‚ æç¤ºï¼š æ ‘ä¸­çš„èŠ‚ç‚¹æ•°å°äº 6000 -100 &lt;= node.val &lt;= 100 æ€è·¯ æ–¹æ³•ä¸€ï¼šä¸Šä¸€é¢˜å·²ç»è®²è¿‡ï¼Œä¾æ—§å¯ä»¥ç”¨ä¸Šé¢çš„ä»£ç ï¼ŒBFSã€‚ æ–¹æ³•äºŒï¼šé¢˜ç›®è¦æ±‚åªèƒ½ä½¿ç”¨å¸¸é‡çº§é¢å¤–ç©ºé—´ï¼Œæ„å‘³ç€å…¶å®ä¸¥æ ¼ä¸Šä¸èƒ½ä½¿ç”¨é˜Ÿåˆ—ï¼Œé‚£æ€ä¹ˆåšå‘¢ï¼Ÿ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå°¾æŒ‡é’ˆï¼Œå°†æ‰€æœ‰çš„èŠ‚ç‚¹è¿æ¥èµ·æ¥ï¼Œåˆšå¥½å°±æ˜¯é¢˜ç›®çš„nextæŒ‡é’ˆï¼Œå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œè‡³äºæ¯ä¸€å±‚å¦‚ä½•å¼€å§‹ï¼Œåªéœ€è¦å†å¼•å…¥ä¸€ä¸ªæŒ‡é’ˆè¿›è¡Œæ ‡è®°å³å¯ï¼Œä¸åŒäºBFSçš„æ˜¯ï¼ŒBFSåœ¨éå†å½“å‰å±‚æ—¶ï¼Œæ˜¯å¤„ç†å½“å‰å±‚çš„æ¨ªå‘è¿æ¥ï¼Œå¹¶ä¸”å°†å­èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—ä¸­ä»¥ä¾¿ä¸‹ä¸€æ¬¡çš„éå†ï¼Œè€Œæ–¹æ³•äºŒåˆ™æ˜¯åœ¨æ¯æ¬¡å¾ªç¯æ—¶ï¼Œç›´æ¥å¤„ç†ä¸‹ä¸€å±‚èŠ‚ç‚¹çš„æ¨ªå‘è¿æ¥é—®é¢˜ï¼Œå› ä¸ºæˆ‘å¹¶ä¸çŸ¥é“æ¯ä¸€å±‚çš„èŠ‚ç‚¹æ•°é‡å’Œå…·ä½“ä½ç½®(æ— æ³•ä¿å­˜)ï¼Œåªèƒ½æ˜¯å¦‚æœè¯¥å±‚ä¸‹çš„å­èŠ‚ç‚¹å­˜åœ¨ï¼Œå°±å°†ä»–ä»¬è¿æ¥ï¼ 1234567891011cur æŒ‡é’ˆåˆ©ç”¨ next ä¸åœçš„éå†å½“å‰å±‚ã€‚å¦‚æœ cur çš„å­©å­ä¸ä¸º null å°±å°†å®ƒæ¥åˆ° tail åè¾¹ï¼Œç„¶åæ›´æ–°tailã€‚å½“ cur ä¸º null çš„æ—¶å€™ï¼Œå†åˆ©ç”¨ dummy æŒ‡é’ˆå¾—åˆ°æ–°çš„ä¸€å±‚çš„å¼€å§‹èŠ‚ç‚¹ã€‚dummy æŒ‡é’ˆåœ¨é“¾è¡¨ä¸­ç»å¸¸ç”¨åˆ°ï¼Œä»–åªæ˜¯ä¸ºäº†å¤„ç†å¤´ç»“ç‚¹çš„æƒ…å†µï¼Œå®ƒå¹¶ä¸å±äºå½“å‰é“¾è¡¨ã€‚ä½œè€…ï¼šwindliangé“¾æ¥ï¼šhttps://leetcode-cn.com/problems/populating-next-right-pointers-in-each-node-ii/solution/xiang-xi-tong-su-de-si-lu-fen-xi-duo-jie-fa-by-28/æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰ ä»£ç  æ–¹æ³•ä¸€ï¼šåŒä¸Š(ç•¥) æ–¹æ³•äºŒï¼š 12345678910111213141516171819202122232425public Node connectII(Node root)&#123; if(root == null) return null; Node cur = root; //éå†çš„å½“å‰èŠ‚ç‚¹ Node tail; //ä¸­é—´èŠ‚ç‚¹ï¼Œèµ·æ‰¿æ¥çš„ä½œç”¨ while(cur != null)&#123; //éå†æ•´æ£µæ ‘ //æ³¨æ„è¿™é‡Œçš„startåº”è¯¥æ˜¯ä¸€ä¸ªé“¾è¡¨å¤´ç»“ç‚¹ï¼Œå…¶æŒ‡å‘çš„nextä¸ºå½“å‰å±‚çš„ä¸‹ä¸€å±‚çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ Node start = new Node(); tail = start; //éå†å½“å‰å±‚ while(cur != null)&#123; if(cur.left != null)&#123; tail.next = cur.left; tail = tail.next; &#125; if(cur.right != null)&#123; tail.next = cur.right; tail = tail.next; &#125; cur = cur.next; &#125; cur = start.next; &#125; return root;&#125; äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆé¢˜ç›®ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚ ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€ ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æ ‘: root = [3,5,1,6,2,0,8,null,null,7,4] ç¤ºä¾‹ 1: 123è¾“å…¥: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 1è¾“å‡º: 3è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 3ã€‚ ç¤ºä¾‹ 2: 123è¾“å…¥: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 4è¾“å‡º: 5è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 5ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚ è¯´æ˜: æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚ pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æ ‘ä¸­ã€‚ æ€è·¯æ³¨æ„p,qå¿…ç„¶å­˜åœ¨æ ‘å†…, ä¸”æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å”¯ä¸€ï¼ï¼ï¼é€’å½’æ€æƒ³ï¼Œå¯¹ä»¥rootä¸ºæ ¹çš„(å­)æ ‘è¿›è¡ŒæŸ¥æ‰¾på’Œqï¼Œå¦‚æœroot == null || p || q ç›´æ¥è¿”å›rootè¡¨ç¤ºå¯¹äºå½“å‰æ ‘çš„æŸ¥æ‰¾å·²ç»å®Œæ¯•ï¼Œå¦åˆ™å¯¹å·¦å³å­æ ‘è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ ¹æ®å·¦å³å­æ ‘çš„è¿”å›å€¼åˆ¤æ–­: å·¦å³å­æ ‘çš„è¿”å›å€¼éƒ½ä¸ä¸ºnull, ç”±äºå€¼å”¯ä¸€å·¦å³å­æ ‘çš„è¿”å›å€¼å°±æ˜¯på’Œq, æ­¤æ—¶rootä¸ºLCA å¦‚æœå·¦å³å­æ ‘è¿”å›å€¼åªæœ‰ä¸€ä¸ªä¸ä¸ºnull, è¯´æ˜åªæœ‰på’Œqå­˜åœ¨äºå·¦æˆ–å³å­æ ‘ä¸­, æœ€å…ˆæ‰¾åˆ°çš„é‚£ä¸ªèŠ‚ç‚¹ä¸ºLCA å·¦å³å­æ ‘è¿”å›å€¼å‡ä¸ºnull, på’Œqå‡ä¸åœ¨æ ‘ä¸­, è¿”å›null ä»£ç 123456789class Solution &#123; public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) &#123; if(root == null || p == root || q == root)return root; TreeNode left = lowestCommonAncestor(root.left,p,q); TreeNode right = lowestCommonAncestor(root.right,p,q); if(left!=null &amp;&amp; right != null)return root; return left == null ? right : left; &#125;&#125; äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–é¢˜ç›®åºåˆ—åŒ–æ˜¯å°†ä¸€ä¸ªæ•°æ®ç»“æ„æˆ–è€…å¯¹è±¡è½¬æ¢ä¸ºè¿ç»­çš„æ¯”ç‰¹ä½çš„æ“ä½œï¼Œè¿›è€Œå¯ä»¥å°†è½¬æ¢åçš„æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å†…å­˜ä¸­ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªè®¡ç®—æœºç¯å¢ƒï¼Œé‡‡å–ç›¸åæ–¹å¼é‡æ„å¾—åˆ°åŸæ•°æ®ã€‚ è¯·è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥å®ç°äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚è¿™é‡Œä¸é™å®šä½ çš„åºåˆ— / ååºåˆ—åŒ–ç®—æ³•æ‰§è¡Œé€»è¾‘ï¼Œä½ åªéœ€è¦ä¿è¯ä¸€ä¸ªäºŒå‰æ ‘å¯ä»¥è¢«åºåˆ—åŒ–ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å¹¶ä¸”å°†è¿™ä¸ªå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºåŸå§‹çš„æ ‘ç»“æ„ã€‚ ç¤ºä¾‹: 123456789ä½ å¯ä»¥å°†ä»¥ä¸‹äºŒå‰æ ‘ï¼š 1 / \ 2 3 / \ 4 5åºåˆ—åŒ–ä¸º "[1,2,3,null,null,4,5]" æç¤º: è¿™ä¸ LeetCode ç›®å‰ä½¿ç”¨çš„æ–¹å¼ä¸€è‡´ï¼Œè¯¦æƒ…è¯·å‚é˜… LeetCode åºåˆ—åŒ–äºŒå‰æ ‘çš„æ ¼å¼ã€‚ä½ å¹¶éå¿…é¡»é‡‡å–è¿™ç§æ–¹å¼ï¼Œä½ ä¹Ÿå¯ä»¥é‡‡ç”¨å…¶ä»–çš„æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ è¯´æ˜: ä¸è¦ä½¿ç”¨ç±»çš„æˆå‘˜ / å…¨å±€ / é™æ€å˜é‡æ¥å­˜å‚¨çŠ¶æ€ï¼Œä½ çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç®—æ³•åº”è¯¥æ˜¯æ— çŠ¶æ€çš„ã€‚ æ€è·¯è¿™é¢˜åšäº†ä¸¤ä¸ªå°æ—¶â€¦è¿˜æ²¡æ•´å‡ºæ¥â€¦æ€è·¯å…¶å®ç‰¹åˆ«çš„ç®€å•ï¼Œå°±æ˜¯ç”¨å±‚åºéå†ï¼Œå°†æ‰€æœ‰ç»“ç‚¹å­˜å…¥åˆ—è¡¨ä¸­ï¼ˆåŒ…æ‹¬äº†ç©ºèŠ‚ç‚¹ï¼‰ï¼Œç„¶åè½¬æˆå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²å†è½¬æˆåˆ—è¡¨ç„¶åå»ºç«‹æ ‘ å¡åœ¨å»ºç«‹æ ‘è¿™å—â€¦å¿ƒæ€æœ‰ç‚¹ç‚¸â€¦å†·é™ä¼š ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576public class Codec &#123; // Encodes a tree to a single string. public String serialize(TreeNode root) &#123; if (root == null) &#123; return "[]"; &#125; Queue&lt;String&gt; res = new LinkedList&lt;&gt;(); Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.offer(root); res.offer(String.valueOf(root.val)); while(!queue.isEmpty()) &#123; TreeNode node = queue.poll(); // æœ‰å·¦èŠ‚ç‚¹å°±æ’å…¥å·¦èŠ‚ç‚¹ï¼Œæ²¡æœ‰å°±æ’å…¥null if (node.left != null) &#123; queue.offer(node.left); res.offer(String.valueOf(node.left.val)); &#125; else &#123; res.offer("null"); &#125; // æœ‰å³èŠ‚ç‚¹å°±æ’å…¥å³èŠ‚ç‚¹ï¼Œæ²¡æœ‰å°±æ’å…¥null if (node.right != null) &#123; queue.offer(node.right); res.offer(String.valueOf(node.right.val)); &#125; else &#123; res.offer("null"); &#125; &#125; StringBuilder sb = new StringBuilder(); sb.append("["); while(!res.isEmpty()) &#123; sb.append(res.poll()); if (!res.isEmpty()) &#123; sb.append(","); &#125; &#125; sb.append("]"); return sb.toString(); &#125; // Decodes your encoded data to tree. public TreeNode deserialize(String data) &#123; data = data.substring(1, data.length()-1); if (data.length() == 0) &#123; return null; &#125; Queue&lt;String&gt; ls = new LinkedList&lt;&gt;(Arrays.asList(data.split(","))); Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); TreeNode root = null; while(!ls.isEmpty()) &#123; String res = ls.poll(); // åˆ›å»ºæ ¹èŠ‚ç‚¹ if (root == null) &#123; root = new TreeNode(Integer.valueOf(res)); queue.offer(root); continue; &#125; // æ³¨æ„ï¼šlsçš„é•¿åº¦æ€»æ˜¯å¥‡æ•°çš„ï¼Œæ‰€ä»¥é™¤äº†æ ¹èŠ‚ç‚¹ï¼Œå…¶ä½™èŠ‚ç‚¹åˆ›å»ºæ—¶å¯ä»¥ä¸€æ¬¡å–ä¸¤ä¸ªlsä¸­çš„å…ƒç´  TreeNode father = queue.poll(); // åˆ›å»ºå·¦èŠ‚ç‚¹ if (!res.equals("null")) &#123; TreeNode curr = new TreeNode(Integer.valueOf(res)); father.left = curr; queue.offer(curr); &#125; // åˆ›å»ºå³èŠ‚ç‚¹ res = ls.poll(); if (!res.equals("null")) &#123; TreeNode curr = new TreeNode(Integer.valueOf(res)); father.right = curr; queue.offer(curr); &#125; &#125; return root; &#125;&#125; ç¿»è½¬äºŒå‰æ ‘é¢˜ç›®ç¿»è½¬ä¸€æ£µäºŒå‰æ ‘ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š 4 / \ 2 7 / \ / \ 1 3 6 9 è¾“å‡ºï¼š 4 / \ 7 2 / \ / \ 9 6 3 1 æ€è·¯é€’å½’â€¦æ³¨é‡Šæœ‰è¯´ ä»£ç 1234567891011121314151617/** * é€’å½’ä¸‰éƒ¨æ›² * 1ã€æ‰¾åˆ°å‡ºå£ï¼ŒèŠ‚ç‚¹ä¸ºç©ºå³ä¸ºå‡ºå£ * 2ã€æ‰¾åˆ°è¿”å›å€¼ï¼Œè¿”å›å€¼ï¼Œè¿”å›å€¼åº”è¯¥æ˜¯å­æ ‘çš„æ ¹èŠ‚ç‚¹ * 3ã€ä¸€æ¬¡é€’å½’éœ€è¦åšå•¥ï¼Œéœ€è¦å°†å·¦å³å­æ ‘ç¿»è½¬ï¼Œç°åœ¨æˆ‘ä»¬æ‰‹ä¸Šä¹Ÿå°±æ˜¯ä¸‰ä¸ªèŠ‚ç‚¹ * åˆ†åˆ«æ˜¯æ ¹èŠ‚ç‚¹ï¼Œå·¦å­æ ‘æ ¹èŠ‚ç‚¹ï¼Œå³å­æ ‘æ ¹èŠ‚ç‚¹ï¼Œè¦åšçš„å°±åªæ˜¯å·¦å³å­æ ‘æ ¹èŠ‚ç‚¹ç¿»è½¬å³å¯ * @param root * @return */private static TreeNode invertTree(TreeNode root)&#123; if(root == null) return null; TreeNode left = invertTree(root.left); TreeNode right = invertTree(root.right); root.left = right; root.right = left; return root;&#125; åˆå¹¶äºŒå‰æ ‘é¢˜ç›®ç»™å®šä¸¤ä¸ªäºŒå‰æ ‘ï¼Œæƒ³è±¡å½“ä½ å°†å®ƒä»¬ä¸­çš„ä¸€ä¸ªè¦†ç›–åˆ°å¦ä¸€ä¸ªä¸Šæ—¶ï¼Œä¸¤ä¸ªäºŒå‰æ ‘çš„ä¸€äº›èŠ‚ç‚¹ä¾¿ä¼šé‡å ã€‚ ä½ éœ€è¦å°†ä»–ä»¬åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„äºŒå‰æ ‘ã€‚åˆå¹¶çš„è§„åˆ™æ˜¯å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹é‡å ï¼Œé‚£ä¹ˆå°†ä»–ä»¬çš„å€¼ç›¸åŠ ä½œä¸ºèŠ‚ç‚¹åˆå¹¶åçš„æ–°å€¼ï¼Œå¦åˆ™ä¸ä¸º NULL çš„èŠ‚ç‚¹å°†ç›´æ¥ä½œä¸ºæ–°äºŒå‰æ ‘çš„èŠ‚ç‚¹ã€‚ ç¤ºä¾‹ 1: 1234567891011121314è¾“å…¥: Tree 1 Tree 2 1 2 / \ / \ 3 2 1 3 / \ \ 5 4 7 è¾“å‡º: åˆå¹¶åçš„æ ‘: 3 / \ 4 5 / \ \ 5 4 7 æ³¨æ„: åˆå¹¶å¿…é¡»ä»ä¸¤ä¸ªæ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹ã€‚ æ€è·¯ä½¿ç”¨é€’å½’ã€‚æˆ‘ä»¬å¯ä»¥å¯¹è¿™ä¸¤æ£µæ ‘åŒæ—¶è¿›è¡Œå‰åºéå†ï¼Œå¹¶å°†å¯¹åº”çš„èŠ‚ç‚¹è¿›è¡Œåˆå¹¶ã€‚åœ¨éå†æ—¶ï¼Œå¦‚æœä¸¤æ£µæ ‘çš„å½“å‰èŠ‚ç‚¹å‡ä¸ä¸ºç©ºï¼Œæˆ‘ä»¬å°±å°†å®ƒä»¬çš„å€¼è¿›è¡Œç›¸åŠ ï¼Œå¹¶å¯¹å®ƒä»¬çš„å·¦å­©å­å’Œå³å­©å­è¿›è¡Œé€’å½’åˆå¹¶ï¼›å¦‚æœå…¶ä¸­æœ‰ä¸€æ£µæ ‘ä¸ºç©ºï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿”å›å¦ä¸€é¢—æ ‘ä½œä¸ºç»“æœï¼›å¦‚æœä¸¤æ£µæ ‘å‡ä¸ºç©ºï¼Œæ­¤æ—¶è¿”å›ä»»æ„ä¸€æ£µæ ‘å‡å¯ï¼ˆå› ä¸ºéƒ½æ˜¯ç©ºï¼‰ã€‚ ä»£ç 123456789101112131415161718192021/** * Definition for a binary tree node. * public class TreeNode &#123; * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) &#123; val = x; &#125; * &#125; */public class Solution &#123; public TreeNode mergeTrees(TreeNode t1, TreeNode t2) &#123; if (t1 == null) return t2; if (t2 == null) return t1; t1.val += t2.val; t1.left = mergeTrees(t1.left, t2.left); t1.right = mergeTrees(t1.right, t2.right); return t1; &#125;&#125; éªŒè¯äºŒå‰æœç´¢æ ‘é¢˜ç›®ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘ã€‚ å‡è®¾ä¸€ä¸ªäºŒå‰æœç´¢æ ‘å…·æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š èŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å«å°äºå½“å‰èŠ‚ç‚¹çš„æ•°ã€‚ èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å«å¤§äºå½“å‰èŠ‚ç‚¹çš„æ•°ã€‚ æ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚ ç¤ºä¾‹ 1: 12345è¾“å…¥: 2 / \ 1 3è¾“å‡º: true ç¤ºä¾‹ 2: 123456789è¾“å…¥: 5 / \ 1 4 / \ 3 6è¾“å‡º: falseè§£é‡Š: è¾“å…¥ä¸º: [5,1,4,null,null,3,6]ã€‚æ ¹èŠ‚ç‚¹çš„å€¼ä¸º 5 ï¼Œä½†æ˜¯å…¶å³å­èŠ‚ç‚¹å€¼ä¸º 4 ã€‚ æ€è·¯äºŒå‰æœç´¢æ ‘çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯æ ¹èŠ‚ç‚¹è¦å¤§äºå·¦å­æ ‘å…¨éƒ¨èŠ‚ç‚¹çš„æ•°ï¼Œå°äºå³å­æ ‘å…¨éƒ¨èŠ‚ç‚¹çš„æ•°ï¼Œæ•…å¦‚æœæˆ‘ä»¬æ˜¯ä¸­åºéå†ï¼Œåˆ™äºŒå‰æœç´¢æ ‘éå†çš„èŠ‚ç‚¹çš„å€¼ä¸€å®šæ˜¯é€’å¢çš„ï¼å½“ç„¶æˆ‘ä»¬æ²¡æœ‰å¿…è¦ç”¨ä¸€ä¸ªæ•°ç»„å°†æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å­˜èµ·æ¥ï¼Œåªéœ€è¦å­˜å‚¨å½“å‰éå†èŠ‚ç‚¹çš„ä¹‹å‰ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼å³å¯ï¼ ä»£ç 123456789101112131415class Solution &#123; public boolean isValidBST(TreeNode root) &#123; // ä¸ç”¨int[]æ˜¯ä¸ºäº†é˜²æ­¢åˆå§‹åŒ–å€¼ç­‰äºTreeNodeä¸­çš„val return validByInorderTraversal(root, new long[] &#123;Long.MIN_VALUE&#125;); &#125; boolean validByInorderTraversal(TreeNode root, long[] prev) &#123; if (root == null) return true; if (!validByInorderTraversal(root.left, prev)) return false; // æ¯æ¬¡è·Ÿåªè·Ÿå‰ä¸€ä¸ªå…ƒç´ åšåˆ¤æ–­ï¼Œç¬¦åˆæ¡ä»¶åˆ™æ›¿æ¢ï¼Œå¦åˆ™è¿”å›false if (prev[0] &gt;= root.val) return false; prev[0] = root.val; if (!validByInorderTraversal(root.right, prev)) return false; return true; &#125;&#125; äºŒå‰æ ‘çš„ç›´å¾„é¢˜ç›®ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œä½ éœ€è¦è®¡ç®—å®ƒçš„ç›´å¾„é•¿åº¦ã€‚ä¸€æ£µäºŒå‰æ ‘çš„ç›´å¾„é•¿åº¦æ˜¯ä»»æ„ä¸¤ä¸ªç»“ç‚¹è·¯å¾„é•¿åº¦ä¸­çš„æœ€å¤§å€¼ã€‚è¿™æ¡è·¯å¾„å¯èƒ½ç©¿è¿‡æ ¹ç»“ç‚¹ã€‚ ç¤ºä¾‹ :ç»™å®šäºŒå‰æ ‘ 12345 1 / \ 2 3 / \ 4 5 è¿”å› 3, å®ƒçš„é•¿åº¦æ˜¯è·¯å¾„ [4,2,1,3] æˆ–è€… [5,2,1,3]ã€‚ æ³¨æ„ï¼šä¸¤ç»“ç‚¹ä¹‹é—´çš„è·¯å¾„é•¿åº¦æ˜¯ä»¥å®ƒä»¬ä¹‹é—´è¾¹çš„æ•°ç›®è¡¨ç¤ºã€‚ æ€è·¯æŒ‰ç…§å¸¸ç”¨æ–¹æ³•è®¡ç®—ä¸€ä¸ªèŠ‚ç‚¹çš„æ·±åº¦ï¼šmax(depth of node.left, depth of node.right) + 1ã€‚åœ¨è®¡ç®—çš„åŒæ—¶ï¼Œç»è¿‡è¿™ä¸ªèŠ‚ç‚¹çš„æœ€å¤§ç›´å¾„ä¸º (depth of node.left) + (depth of node.right) ã€‚æœç´¢æ¯ä¸ªèŠ‚ç‚¹å¹¶è®°å½•è¿™äº›è·¯å¾„ç»è¿‡çš„ç‚¹æ•°æœ€å¤§å€¼ï¼ŒæœŸæœ›é•¿åº¦æ˜¯å°±æ˜¯ç»“æœã€‚ ä»£ç 12345678910111213141516class Solution &#123; int ans; public int diameterOfBinaryTree(TreeNode root) &#123; ans = 0; //æ‹¿åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘çš„æ·±åº¦çš„å’Œï¼Œansä»£è¡¨äº†æœ€é•¿ç›´å¾„ï¼Œå…¶å®ä¹Ÿå°±æ˜¯æœ€å¤§çš„å·¦å³å­æ ‘æ·±åº¦ä¹‹å’Œ depth(root); return ans; &#125; public int depth(TreeNode node) &#123; if (node == null) return 0; int L = depth(node.left); int R = depth(node.right); ans = Math.max(ans, L+R); return Math.max(L, R) + 1; &#125;&#125; æŠŠäºŒå‰æœç´¢æ ‘è½¬æ¢ä¸ºç´¯åŠ æ ‘é¢˜ç›®ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘ï¼ˆBinary Search Treeï¼‰ï¼ŒæŠŠå®ƒè½¬æ¢æˆä¸ºç´¯åŠ æ ‘ï¼ˆGreater Tree)ï¼Œä½¿å¾—æ¯ä¸ªèŠ‚ç‚¹çš„å€¼æ˜¯åŸæ¥çš„èŠ‚ç‚¹å€¼åŠ ä¸Šæ‰€æœ‰å¤§äºå®ƒçš„èŠ‚ç‚¹å€¼ä¹‹å’Œã€‚ ä¾‹å¦‚ï¼š 123456789101112è¾“å…¥: äºŒå‰æœç´¢æ ‘: 5 / \ 2 13è¾“å‡º: è½¬æ¢ä¸ºç´¯åŠ æ ‘: 18 / \ 20 13æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/convert-bst-to-greater-tree æ€è·¯äºŒå‰æœç´¢æ ‘ï¼Œç¬¬ä¸€æƒ³æ³•å°±æ˜¯ç”¨ä¸­åºé€’å½’å»åšï¼Œç´¯åŠ æ ‘çš„æ„æ€æ˜¯ æ ¹èŠ‚ç‚¹çš„å€¼ = æ ¹èŠ‚ç‚¹çš„å€¼ + å³å­æ ‘çš„å€¼ ï¼Œç„¶åå†æ›´æ–°å·¦å­æ ‘çš„å€¼ = æ ¹èŠ‚ç‚¹çš„å€¼ + å·¦å­æ ‘çš„å€¼ï¼Œæ‰€ä»¥å°±ç¬¦åˆå³ä¸­å·¦çš„éå†é¡ºåºï¼Œåªè¦å†™å‡ºæ¥å³ä¸­å·¦çš„é€’å½’ï¼Œç„¶åç”¨ä¸€ä¸ªå…¨å±€å˜é‡è®°å½•ä¸Šä¸€ä¸ªéå†çš„èŠ‚ç‚¹çš„å€¼å†åŠ ä¸Šæœ¬èº«çš„å€¼ï¼Œå°±okayäº†ï¼ ä»£ç 1234567891011class Solution &#123; int add = 0; public TreeNode convertBST(TreeNode root) &#123; if (root == null) return root; convertBST(root.right); root.val += add; add = root.val; convertBST(root.left); return root; &#125;&#125; Tip: å…¶å®ä¸ªäººè§‰å¾—è¿™ä¸ªé¢˜ç›®æœ‰é—®é¢˜ï¼Œæ—¢ç„¶æ˜¯ç´¯åŠ æ ‘ï¼Œä¸ºä½•æ˜¯æŒ‰ç…§å³ä¸­å·¦çš„éå†é¡ºåºæ¥ç´¯åŠ å‘¢â€¦æˆ‘çš„æ ¹èŠ‚ç‚¹è¿˜å¾—åŠ åˆ°æˆ‘å·¦å­æ ‘çš„æœ€å³å¶å­èŠ‚ç‚¹ä¸Šï¼çœŸçš„è’å”å•Šâ€¦ äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨é¢˜ç›®ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼ŒåŸåœ°å°†å®ƒå±•å¼€ä¸ºé“¾è¡¨ã€‚ ä¾‹å¦‚ï¼Œç»™å®šäºŒå‰æ ‘ 12345 1 / \ 2 5 / \ \3 4 6 å°†å…¶å±•å¼€ä¸ºï¼š 12345678910111 \ 2 \ 3 \ 4 \ 5 \ 6 æ€è·¯æ³¨æ„é¢˜ç›®çš„è¦æ±‚æ˜¯ åŸåœ° å±•å¼€ï¼ è¿™é‡Œå¼ºæ¨ä¸€æ‰‹é¢˜è§£é‡Œä¸€ä½å¤§ä½¬å†™çš„ï¼æ€»å…±3ä¸ªå¤§æ–¹æ³•ï¼Œéå¸¸å¥½ï¼ï¼ï¼ äºŒå‰æ ‘è½¬æ¢æˆé“¾è¡¨ è§£æ³•ä¸€[è‡ªé¡¶å‘ä¸‹éé€’å½’]å¯ä»¥å‘ç°å±•å¼€çš„é¡ºåºå…¶å®å°±æ˜¯äºŒå‰æ ‘çš„å…ˆåºéå†ã€‚ç®—æ³•å’Œ 94 é¢˜ä¸­åºéå†çš„ Morris ç®—æ³•æœ‰äº›ç¥ä¼¼ã€‚ å°†å·¦å­æ ‘æ’å…¥åˆ°å³å­æ ‘çš„åœ°æ–¹ å°†åŸæ¥çš„å³å­æ ‘æ¥åˆ°å·¦å­æ ‘çš„æœ€å³è¾¹èŠ‚ç‚¹ ä»£ç çš„è¯ä¹Ÿå¾ˆå¥½å†™ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ‰¾å‡ºå·¦å­æ ‘æœ€å³è¾¹çš„èŠ‚ç‚¹ä»¥ä¾¿æŠŠå³å­æ ‘æ¥è¿‡æ¥ã€‚ 1234567891011121314151617181920public void flatten(TreeNode root) &#123; while (root != null) &#123; //å·¦å­æ ‘ä¸º nullï¼Œç›´æ¥è€ƒè™‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ if (root.left == null) &#123; root = root.right; &#125; else &#123; // æ‰¾å·¦å­æ ‘æœ€å³è¾¹çš„èŠ‚ç‚¹ TreeNode pre = root.left; while (pre.right != null) &#123; pre = pre.right; &#125; //å°†åŸæ¥çš„å³å­æ ‘æ¥åˆ°å·¦å­æ ‘çš„æœ€å³è¾¹èŠ‚ç‚¹ pre.right = root.right; // å°†å·¦å­æ ‘æ’å…¥åˆ°å³å­æ ‘çš„åœ°æ–¹ root.right = root.left; root.left = null; // è€ƒè™‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ root = root.right; &#125; &#125; è§£æ³•äºŒ[è‡ªé¡¶å‘ä¸Šï¼Œæ¨è]é¢˜ç›®ä¸­ï¼Œè¦æ±‚è¯´æ˜¯ in-placeï¼Œä¹‹å‰ä¸€ç›´ä»¥ä¸ºè¿™ä¸ªæ„æ€å°±æ˜¯è¦æ±‚ç©ºé—´å¤æ‚åº¦æ˜¯ O(1)ã€‚å¶ç„¶çœ‹è§è¯„è®ºåŒºå¤§ç¥çš„è§£é‡Šï¼Œ in-place çš„æ„æ€å¯èƒ½æ›´å¤šè¯´çš„æ˜¯ç›´æ¥åœ¨åŸæ¥çš„èŠ‚ç‚¹ä¸Šæ”¹å˜æŒ‡å‘ï¼Œç©ºé—´å¤æ‚åº¦å¹¶æ²¡æœ‰è¦æ±‚ã€‚æ‰€ä»¥è¿™é“é¢˜ä¹Ÿå¯ä»¥ç”¨é€’å½’è§£ä¸€ä¸‹ã€‚åˆ©ç”¨å˜å½¢çš„ååºéå† å³å·¦æ ¹å³å¯ã€‚ 1234567891011private TreeNode pre = null;public void flatten(TreeNode root) &#123; if (root == null) return; flatten(root.right); flatten(root.left); root.right = pre; root.left = null; pre = root;&#125; ç›¸åº”çš„å·¦å­©å­ä¹Ÿè¦ç½®ä¸º nullï¼ŒåŒæ ·çš„ä¹Ÿä¸ç”¨æ‹…å¿ƒå·¦å­©å­ä¸¢å¤±ï¼Œå› ä¸ºæ˜¯ååºéå†ï¼Œå·¦å­©å­å·²ç»éå†è¿‡äº†ã€‚å’Œ 112 é¢˜ä¸€æ ·ï¼Œéƒ½å·§å¦™çš„åˆ©ç”¨äº†ååºéå†ã€‚ æ—¢ç„¶ååºéå†è¿™ä¹ˆæœ‰ç”¨ï¼Œåˆ©ç”¨ 112 é¢˜ä»‹ç»çš„ååºéå†çš„è¿­ä»£æ–¹æ³•ï¼ŒæŠŠè¿™é“é¢˜ä¹Ÿæ”¹ä¸€ä¸‹å§ã€‚ 12345678910111213141516171819202122232425public void flatten(TreeNode root) &#123; Stack&lt;TreeNode&gt; toVisit = new Stack&lt;&gt;(); TreeNode cur = root; TreeNode pre = null; while (cur != null || !toVisit.isEmpty()) &#123; while (cur != null) &#123; toVisit.push(cur); // æ·»åŠ æ ¹èŠ‚ç‚¹ cur = cur.right; // é€’å½’æ·»åŠ å³èŠ‚ç‚¹ &#125; cur = toVisit.peek(); // å·²ç»è®¿é—®åˆ°æœ€å³çš„èŠ‚ç‚¹äº† // åœ¨ä¸å­˜åœ¨å·¦èŠ‚ç‚¹æˆ–è€…å³èŠ‚ç‚¹å·²ç»è®¿é—®è¿‡çš„æƒ…å†µä¸‹ï¼Œè®¿é—®æ ¹èŠ‚ç‚¹ if (cur.left == null || cur.left == pre) &#123; toVisit.pop(); /**************ä¿®æ”¹çš„åœ°æ–¹***************/ cur.right = pre; cur.left = null; /*************************************/ pre = cur; cur = null; &#125; else &#123; cur = cur.left; // å·¦èŠ‚ç‚¹è¿˜æ²¡æœ‰è®¿é—®è¿‡å°±å…ˆè®¿é—®å·¦èŠ‚ç‚¹ &#125; &#125; &#125; è§£æ³•ä¸‰[è‡ªé¡¶å‘ä¸Š]è§£æ³•äºŒä¸­æåˆ°å¦‚æœç”¨å…ˆåºéå†çš„è¯ï¼Œä¼šä¸¢å¤±æ‰å³å­©å­ï¼Œé™¤äº†ç”¨ååºéå†ï¼Œè¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„æ–¹æ³•é¿å…è¿™ä¸ªé—®é¢˜ã€‚åœ¨ Discuss åˆå‘ç°äº†ä¸€ç§è§£æ³•ã€‚ ä¸ºäº†æ›´å¥½çš„æ§åˆ¶ç®—æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨å…ˆåºéå†è¿­ä»£çš„å½¢å¼ï¼Œæ­£å¸¸çš„å…ˆåºéå†ä»£ç å¦‚ä¸‹ï¼Œ 123456789101112131415public static void preOrderStack(TreeNode root) &#123; if (root == null) &#123; return; &#125; Stack&lt;TreeNode&gt; s = new Stack&lt;TreeNode&gt;(); while (root != null || !s.isEmpty()) &#123; while (root != null) &#123; System.out.println(root.val); s.push(root); root = root.left; &#125; root = s.pop(); root = root.right; &#125;&#125; è¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„å…ˆåºéå†ï¼Œæå‰å°†å³å­©å­ä¿å­˜åˆ°æ ˆä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ç§éå†æ–¹å¼å°±å¯ä»¥é˜²æ­¢å³å­©å­çš„ä¸¢å¤±äº†ã€‚ç”±äºæ ˆæ˜¯å…ˆè¿›åå‡ºï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå°†å³èŠ‚ç‚¹å…¥æ ˆã€‚ 1234567891011121314151617public static void preOrderStack(TreeNode root) &#123; if (root == null)&#123; return; &#125; Stack&lt;TreeNode&gt; s = new Stack&lt;TreeNode&gt;(); s.push(root); while (!s.isEmpty()) &#123; TreeNode temp = s.pop(); System.out.println(temp.val); if (temp.right != null)&#123; s.push(temp.right); &#125; if (temp.left != null)&#123; s.push(temp.left); &#125; &#125;&#125; ä¹‹å‰æˆ‘ä»¬çš„æ€è·¯å¦‚ä¸‹ï¼š é¢˜ç›®å…¶å®å°±æ˜¯å°†äºŒå‰æ ‘é€šè¿‡å³æŒ‡é’ˆï¼Œç»„æˆä¸€ä¸ªé“¾è¡¨ã€‚ 11 -&gt; 2 -&gt; 3 -&gt; 4 -&gt; 5 -&gt; 6 æˆ‘ä»¬çŸ¥é“é¢˜ç›®ç»™å®šçš„éå†é¡ºåºå…¶å®å°±æ˜¯å…ˆåºéå†çš„é¡ºåºï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…ˆåºéå†çš„ä»£ç ï¼Œæ¯éå†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±å°†ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å³æŒ‡é’ˆæ›´æ–°ä¸ºå½“å‰èŠ‚ç‚¹ã€‚12345å…ˆåºéå†çš„é¡ºåºæ˜¯ 1 2 3 4 5 6ã€‚éå†åˆ° 2ï¼ŒæŠŠ 1 çš„å³æŒ‡é’ˆæŒ‡å‘ 2ã€‚1 -&gt; 2 3 4 5 6ã€‚éå†åˆ° 3ï¼ŒæŠŠ 2 çš„å³æŒ‡é’ˆæŒ‡å‘ 3ã€‚1 -&gt; 2 -&gt; 3 4 5 6ã€‚ å› ä¸ºæˆ‘ä»¬ç”¨æ ˆä¿å­˜äº†å³å­©å­ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‹…å¿ƒå³å­©å­ä¸¢å¤±äº†ã€‚ç”¨ä¸€ä¸ª pre å˜é‡ä¿å­˜ä¸Šæ¬¡éå†çš„èŠ‚ç‚¹ã€‚ä¿®æ”¹çš„ä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526public void flatten(TreeNode root) &#123; if (root == null)&#123; return; &#125; Stack&lt;TreeNode&gt; s = new Stack&lt;TreeNode&gt;(); s.push(root); TreeNode pre = null; while (!s.isEmpty()) &#123; TreeNode temp = s.pop(); /***********ä¿®æ”¹çš„åœ°æ–¹*************/ if(pre!=null)&#123; pre.right = temp; pre.left = null; &#125; /********************************/ if (temp.right != null)&#123; s.push(temp.right); &#125; if (temp.left != null)&#123; s.push(temp.left); &#125; /***********ä¿®æ”¹çš„åœ°æ–¹*************/ pre = temp; /********************************/ &#125;&#125; æ€»ç»“è§£æ³•ä¸€å’Œè§£æ³•ä¸‰å¯ä»¥çœ‹ä½œè‡ªé¡¶å‘ä¸‹çš„è§£å†³é—®é¢˜ï¼Œè§£æ³•äºŒå¯ä»¥çœ‹ä½œè‡ªåº•å‘ä¸Šã€‚ä»¥å‰è§‰å¾—ååºéå†æ¯”è¾ƒéº»çƒ¦ï¼Œæ²¡æƒ³åˆ°ç«Ÿç„¶è¿ç»­é‡åˆ°äº†ååºéå†çš„åº”ç”¨ã€‚å…ˆåºéå†çš„ä¸¤ç§æ–¹å¼è‡ªå·±ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ„è¯†åˆ°ï¼Œä¹‹å‰éƒ½æ˜¯ç”¨çš„ç¬¬ä¸€ç§æ­£å¸¸çš„æ–¹å¼ã€‚ ä½œè€…ï¼šwindliangé“¾æ¥ï¼šhttps://leetcode-cn.com/problems/flatten-binary-tree-to-linked-list/solution/xiang-xi-tong-su-de-si-lu-fen-xi-duo-jie-fa-by--26/ Tips: è¿™ä¸ªå¤§ä½¬å†™çš„æ˜¯çœŸå¥½ï¼ æ·±åº¦å’Œå¹¿åº¦ä¼˜å…ˆæœç´¢]]></content>
  </entry>
  <entry>
    <title><![CDATA[å¤è¯•å‡†å¤‡]]></title>
    <url>%2F2020%2F01%2F05%2F%E5%A4%8D%E8%AF%95%E5%87%86%E5%A4%87.html</url>
    <content type="text"><![CDATA[å¤è¯•å‡†å¤‡å¤§æ¦‚è¯´ä¸€ä¸‹å‡†å¤‡ç­–ç•¥å§â€¦æœ€è¿‘æœ‰è€ƒè¯•ï¼Œä¹Ÿæ²¡å•¥æ—¶é—´ï¼Œå°±åˆç•¥çš„å†™ä¸€ä¸‹å­â€¦å‡‘åˆçœ‹ï¼ æ¦‚è¿°ä»Šå¹´çš„å¤è¯•è·Ÿå»å¹´åªæœ‰ä¸€ä¸ªä¸åŒï¼Œå°±æ˜¯å°†å¾€å¹´çš„30åˆ†çš„è®¡ç®—æœºç½‘ç»œæ›´æ¢ä¸ºç®—æ³•è®¾è®¡ä¸åˆ†æï¼Œå…¶ä»–å…¨éƒ¨ä¿æŒä¸€è‡´ã€‚ å¤è¯•åˆ†ä¸ºæœºè¯•(200) + é¢è¯•(140) + è‹±è¯­ç¬”è¯•(10)ï¼Œæ€»åˆ†å…±è®¡350åˆ†ï¼Œæœ€ååˆ†æ•°æ˜¯ç›´æ¥ä¸åˆè¯•åˆ†æ•°ç›¸åŠ ï¼ŒæŒ‰ç…§æ€»æˆç»© åˆ†æ•°è¿›è¡Œæ’åï¼Œå…¶ä¸­æœºè¯•å°¤ä¸ºå…³é”®ï¼ŒæŒ‰ç…§å¾€å¹´ç»éªŒæ¥è¯´ï¼Œæœºè¯•åˆ†å·®åœ¨50åˆ†å·¦å³éƒ½æ˜¯éå¸¸å¸¸è§çš„ï¼è‡³äºé¢è¯•ï¼Œå¤§å®¶ å·®çš„éƒ½ä¸å¤šï¼Œæˆ‘ä¸‹é¢ä¼šä¸»è¦è®²ä¸€ä¸‹æœºè¯•å‡†å¤‡ï¼Œé¡ºå¸¦è®²ä¸€ä¸‹é¢è¯•ï¼ å¤è¯•æµç¨‹ä¸€èˆ¬ä¼šåœ¨3æœˆåˆè¿›è¡Œå¤è¯•ï¼Œæˆ‘ä»¬å»å¹´æ˜¯2æœˆ14å‡ºçš„æˆç»©ï¼Œ3æœˆ7å·å°±å¾—åˆ°è¾¾å“ˆå°”æ»¨è¿›è¡Œè€ƒå‰çš„ä¸€äº›æ‰‹ç»­åŠç†ï¼Œä¸­é—´å¤§æ¦‚åªæœ‰15å¤©çš„æ—¶é—´å‡†å¤‡ï¼Œæ‰€ä»¥åŠ¡å¿…è¦æå‰å¤‡è€ƒ(æˆ‘å°±å¾ˆåæ‚”æ²¡æœ‰æå‰å¤‡è€ƒâ€¦æµä¸‹æ‚”æ¨çš„æ³ªæ°´å•Šâ€¦) è€ƒå‰ä¸€ä¸¤å¤©ä¼šå…ˆè®©ä½ äº¤å„ç§ææ–™ï¼Œç„¶åå¿ƒç†æµ‹è¯„ï¼Œç„¶åå°±å¼€å§‹å¤è¯•ã€‚å¤è¯•æ˜¯ä¸€æ•´å¤©çš„ï¼Œä¸Šåˆæœºè¯•ï¼Œä¸‹åˆé¢è¯•ï¼Œæœºè¯•æ—¶é—´æ˜¯ä¸¤å°æ—¶ï¼Œæ—¶é—´æ˜¯æ¯”è¾ƒç´§å¼ çš„ï¼Œå› ä¸ºé¢˜é‡æ¯”è¾ƒå¤§ï¼Œä¸‹é¢æˆ‘ä¼šè¯¦ç»†è¯´çš„ï¼åœ¨æœºè¯•å¼€å§‹ä¹‹å‰ï¼Œä¼šè®©ä½ å…ˆåšè‹±è¯­ç¬”è¯•ï¼Œä¹Ÿå°±æ˜¯ååœ¨ç”µè„‘é¢å‰ä¼šå…ˆç»™ä½ å‘ä¸€å¼ è‹±è¯­è¯•å·(å…¶å®å°±æ˜¯ä¸€ç¯‡è‹±æ–‡è®ºæ–‡)ï¼Œç„¶åä½ éœ€è¦çœ‹è¿™ç¯‡è®ºæ–‡ï¼Œå›ç­”ç›¸å…³çš„5ä¸ªé—®é¢˜ï¼Œä¸€å…±10åˆ†ï¼Œæ¯å°é—®2åˆ†(è¿™ä¸ªå¤§å®¶éƒ½å·®ä¸å¤šçš„ï¼Œä¸è¦å½±å“è‡ªå·±çš„æœºè¯•å°±è¡Œï¼) ç„¶åæ˜¯å¼€å§‹æœºè¯•ï¼ä¸¤ä¸ªå°æ—¶ï¼Œåº”è¯¥æ˜¯9ç‚¹åŠåˆ°11ç‚¹åŠï¼Ÿ(æˆ‘ä¹Ÿä¸è®°å¾—äº†å‘€) ï¼Œæœºè¯•å®Œä¹‹ååŸºæœ¬æ²¡æœ‰ä¼‘æ¯ï¼Œå¤§æ¦‚ä¸­åˆä¸€ç‚¹å°±éœ€è¦è¿›å…¥é¢è¯•å‡†å¤‡äº†ï¼Œæ‰€æœ‰äººä¼šæ”¾åˆ°ä¸€ä¸ªå¤§æˆ¿é—´é‡Œï¼Œå»å¹´æ˜¯æœ‰8æ¡çº¿ï¼Œæ¯æ¡çº¿éƒ½æ˜¯ä¸ä¸€æ ·çš„è€å¸ˆï¼Œä¹Ÿå°±æ˜¯æµæ°´çº¿ä½œä¸šï¼Œä¸€å…±æœ‰å››è½®é¢è¯•ï¼Œæ¯è½®35åˆ†ï¼Œå…±140åˆ†ï¼Œæ¯ä¸ªäººä¼šåˆ†åˆ°ä¸€ä¸ªæ•°å­—ï¼Œä»£è¡¨ä½ æ˜¯8æ¡çº¿çš„å“ªä¸€æ¡ï¼Œç„¶åè¿›è¡Œé¢è¯•ï¼Œç„¶ååªæœ‰ç­‰åˆ°æ‰€æœ‰äººå…¨éƒ¨é¢è¯•ç»“æŸï¼Œæ–¹å¯ç¦»å¼€ã€‚ å¤è¯•å®Œå½“å¤©å°±ä¼šæœ‰æ·±åœ³æ ¡åŒºçš„å®£è®²ä¼šï¼Œæ‰€æœ‰è€å¸ˆéƒ½ä¼šåˆ°åœºï¼ï¼ï¼æŠ¥è€ƒæ·±åœ³çš„ï¼ï¼ï¼ï¼åƒä¸‡åƒä¸‡ä¸è¦é”™è¿‡ï¼Œè„¸çš®ä¸€å®šè¦åšï¼ï¼ï¼ï¼ï¼å½“å¤©å°±éœ€è¦ç¡®å®šå¯¼å¸ˆçš„ï¼Œå¦‚æœä½ ä¸å»æ‰¾ï¼Œåˆ°æ—¶å€™ä¸Šçº¿äº†åªèƒ½æŒ‘åˆ«äººå‰©ä¸‹çš„ï¼Œæ‰€ä»¥ä¸ç®¡ä½ å¤è¯•åˆ°åº•æˆç»©å’‹æ ·(å¤è¯•æˆç»©ä¼šåœ¨ä¹‹åä¸¤å¤©æ‰å‡º)ï¼Œå…ˆæ‰¾è€å¸ˆï¼Œä¸Šçº¿äº†å°±å¯ä»¥ç›´æ¥è·Ÿä»–èµ°ï¼Œæ²¡ä¸Šçº¿çš„è¯å°±å†è”ç³»æœ¬éƒ¨è€å¸ˆå°±è¡Œäº†ï¼ Tip: å½“ç„¶äº†ï¼ŒæŠ¥è€ƒæœ¬éƒ¨çš„ï¼ŒæŒ‰ç†è¯´åœ¨å‡ºåˆ†åç¬¬ä¸€æ—¶é—´å°±åº”è¯¥å»è”ç³»è€å¸ˆï¼Œå› ä¸ºä¸€èˆ¬éƒ½æ˜¯å…ˆåˆ°å…ˆå¾—çš„ï¼Œåˆ°åå¤´å¯èƒ½å°±åªèƒ½æ˜¯æŒ‘å‰©ä¸‹çš„äº†â€¦ æœºè¯•éƒ¨åˆ†é¦–å…ˆæ˜¯200åˆ†çš„æœºè¯•ï¼ŒæŒ‰ç…§å¾€å¹´æ¨ç®—ï¼Œä»Šå¹´åº”è¯¥é¢˜å‹å¤§æ¦‚ä¿æŒä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯120åˆ†é€‰æ‹©é¢˜ + 80åˆ†ä¸»è§‚é¢˜ï¼Œå…¶ä¸­80åˆ†ä¸»è§‚é¢˜å»å¹´æ˜¯åˆ†ä¸º20åˆ†ç¼–ç¨‹é¢˜ + 60åˆ†æ”¹é”™é¢˜ã€‚è¿™é‡Œå¼ºçƒˆå¼ºçƒˆå¼ºçƒˆå»ºè®®ä¸€å®šè¦å…ˆå…¨éƒ¨çœ‹ä¸€ä¸‹é¢˜å‹ï¼Œå› ä¸ºæœºè¯•å¯èƒ½æ¯å¹´çš„é¢˜å‹éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘è€ƒè¯•çš„æ—¶å€™å°±æ²¡çœ‹åé¢çš„é¢˜ç›®ï¼Œå°±åšç€åšç€ï¼Œè¿˜å‰©50æ¥åˆ†é’Ÿåšå¤§é¢˜ï¼Œçªç„¶å‘ç°æ”¹é”™ç”±ä¸€é¢˜å˜ä¸ºäº†ä¸‰é¢˜ï¼Œç¬é—´å°±æ…Œäº†â€¦ é€‰æ‹©é¢˜ï¼š120åˆ†é€‰æ‹©é¢˜ï¼ŒåŒ…å«äº†æ•°æ®åº“ç³»ç»Ÿã€ç¦»æ•£æ•°å­¦ã€ç®—æ³•è®¾è®¡ä¸åˆ†æã€é€»è¾‘æ€ç»´èƒ½åŠ›ã€‚ä¹Ÿå°±æ˜¯å„å 30åˆ†ï¼Œå…¶ä¸­è¦è¯´æ˜çš„æ˜¯æ•°æ®åº“ç³»ç»Ÿã€ç¦»æ•£æ•°å­¦ã€ç®—æ³•è®¾è®¡ä¸åˆ†æéƒ½æ˜¯2åˆ†ä¸€é¢˜ï¼Œä¹Ÿå°±æ˜¯å…±æœ‰45é¢˜ï¼Œè€Œé€»è¾‘æ€ç»´é¢˜æ˜¯6åˆ†ä¸€é¢˜(å¿˜äº†æ˜¯5åˆ†è¿˜æ˜¯6åˆ†äº†â€¦)ï¼Œæ‰€ä»¥åŠ èµ·æ¥é€‰æ‹©é¢˜æœ‰50æ¥é“ï¼Œè¿™ä¸ªé¢˜é‡æ˜¯å¾ˆå¤§çš„ï¼ŒåŠ¡å¿…è¦è€ƒå‰è®¡åˆ’å¥½æ—¶é—´ï¼ï¼ï¼ï¼å› ä¸ºå»å¹´åæˆ‘æ—è¾¹çš„ä¸¤ä½å¤§å“¥â€¦æˆ‘é€‰æ‹©é¢˜éƒ½åšå®Œäº†ä»–ä»¬è¿˜åœ¨åš20é¢˜ï¼Œæœ€åä»–ä»¬æˆ‘çœ‹åˆ†æ•°éƒ½æ˜¯80ä¸Šä¸‹â€¦ é€‰æ‹©é¢˜çš„è¯ï¼Œæˆ‘å†å¤šå˜´ä¸€å¥ï¼Œæœ€å¥½æ˜¯å…ˆå»åšé€»è¾‘é¢˜ï¼Œå› ä¸ºè¿™ä¸ªè™½ç„¶ç®€å•ä½†æ˜¯è¿˜æ˜¯éœ€è¦å……è£•çš„æ—¶é—´å»æ¨ç†çš„ï¼Œå»å¹´åæˆ‘æ—è¾¹çš„ä¸¤ä½å¤§å“¥å°±å¾ˆå¯æƒœâ€¦é€»è¾‘é¢˜å¥½å‡ é¢˜æ²¡å†™â€¦ ä¸»è§‚é¢˜ï¼š80åˆ†ï¼Œæˆ‘åªè®²å»å¹´çš„é¢˜å‹ã€‚60åˆ†æ”¹é”™ï¼Œ20åˆ†ç¼–ç¨‹é¢˜ã€‚ å…ˆè®²20åˆ†ç¼–ç¨‹é¢˜ï¼Œé¢˜ç›®è¦æ±‚ç”¨Cè¯­è¨€ä½œç­”ï¼é¢˜ç›®çš„éš¾åº¦åŸºæœ¬ä¸Cè¯­è¨€é‚£æœ¬ä¹¦(è‹å°çº¢çš„)çš„è¯¾åé¢˜æŒå¹³ï¼Œæˆ–è€…è¯´ ç•¥å¾®éš¾ä¸€äº›äº›ï¼Œå»å¹´æ˜¯è€ƒçš„å­—ç¬¦ä¸²æ’åºä¹‹ç±»çš„(æˆ‘ä¹Ÿæœ‰ç‚¹å¿˜è®°å•¦ï¼Œä½ ä»¬å¯ä»¥ä¸Šç‹é“è®ºå›çœ‹çœ‹æœ€æ–°çš„å¤è¯•è¯•å·ï¼Œæˆ‘æ˜¯æ²¡æœ‰æ”¶é›†çš„å“ˆ~æˆ‘ç»™çš„èµ„æ–™éƒ½æ˜¯æˆ‘å»å¹´çš„ï¼Œæ²¡æœ‰é›†åˆ19å¹´çš„)ã€‚ å†è®²60åˆ†æ”¹é”™ã€‚æ”¹é”™ä¹Ÿæ˜¯ç»™ä½ ä¸€é“é¢˜ï¼Œç»™ä½ ä»£ç ï¼Œç„¶åä½ ä¿®æ”¹ï¼Œå…¨éƒ¨æ”¹å¯¹æ‰èƒ½acï¼Œå¦åˆ™å°±æ˜¯0åˆ†ï¼Œä¸€å…±3é¢˜ï¼Œæ¯é¢˜20åˆ†ï¼éš¾åº¦ç•¥é«˜ï¼Œæ”¾æœ€ååšå§ã€‚ æ•°æ®åº“ç³»ç»Ÿè€ƒè¯•é¢˜ç›®æ˜¯åœ¨ä¸­å›½å¤§å­¦MOOCä¸­æˆ˜å¾·è‡£è®²çš„ã€Šæ•°æ®åº“ç³»ç»Ÿã€‹ä¸­çš„æµ‹éªŒé‡Œçš„é¢˜ç›®å‡ºï¼Œä¸ä¼šè¶…å‡ºè¿™ä¸ªèŒƒå›´å“Ÿï¼ï¼ï¼ï¼ï¼å¦‚æœåæœŸæ—¶é—´ä¸å¤ªå¤Ÿï¼Œå¯ä»¥ç›´æ¥çœ‹é¢˜ç›®èƒŒç­”æ¡ˆï¼Œå½“ç„¶ä½ éœ€è¦èƒŒçš„å¾ˆç†Ÿå“¦(æˆ‘å½“æ—¶æ˜¯åˆ·äº†å¾ˆå¤šéï¼Œç›´æ¥èƒŒçš„é¢˜ç›®å’Œç­”æ¡ˆï¼Œçœ‹åˆ°é¢˜ç›®å°±çŸ¥é“ç­”æ¡ˆï¼)ï¼Œå› ä¸ºæˆ‘å½“æ—¶æ—¶é—´å¾ˆç´§è¿«ï¼Œå°±æ²¡æœ‰å…¨éƒ¨çœ‹å®Œè§†é¢‘ï¼Œå› ä¸ºè§†é¢‘å¤ªå¤šäº†â€¦ä¸Šä¸­ä¸‹â€¦æ„Ÿè§‰å¾—çœ‹å‡ æ˜ŸæœŸã€‚ é¢„æœŸå¦‚æœä¸€è¾¹çœ‹è§†é¢‘ï¼Œä¸€è¾¹èƒŒé¢˜çš„è¯ï¼Œä¸€æ˜ŸæœŸå¤§æ¦‚å°±èƒ½æ‹¿ä¸‹ï¼ä½ å¯ä»¥è‡ªå·±å»æ„Ÿå—ä¸‹é¢˜é‡è¿˜æœ‰è§†é¢‘çš„å¤šå°‘ï¼Œç„¶åè‡ªå·±ä¼°è®¡éœ€è¦å¤šä¹…æ—¶é—´ï¼Œèƒ½æŠŠé‡Œé¢çš„é¢˜ç›®å…¨éƒ¨åšä¼šï¼Œå¹¶ä¸”è¦ååº”ç‰¹åˆ«å¿«ï¼Œè¿™æ ·ä¼šç»™æœºè¯•äº‰å–å¤§é‡æ—¶é—´â€¦è¿™å¯èƒ½å°±æ˜¯æˆ‘æœºè¯•æ¯”åˆ«äººåšå¾—å¿«çš„åŸå› å§â€¦ ç¦»æ•£æ•°å­¦è¿™æ˜¯æ‰€æœ‰å¤è¯•ç§‘ç›®é‡Œé¢æœ€éš¾çš„ä¸€é—¨ï¼ï¼å› ä¸ºåŒ…æ‹¬äº†é›†åˆè®ºä¸å›¾è®ºä»¥åŠè¿‘ä¸–ä»£æ•°ï¼å»ºè®®çœ‹Moocï¼Œçœ‹å’±å·¥å¤§è€å¸ˆçš„ç¦»æ•£æ•°å­¦ï¼å…·ä½“åå­—æˆ‘ç»™å¿˜äº†ï¼ä¸€å®šè¦è¶æ—©å¤ä¹ ï¼Œä¸ç„¶åŸºæœ¬ä¸ŠåæœŸå°±æ˜¯å®Œå…¨æ”¾å¼ƒçš„çŠ¶æ€ï¼Œè¿™ä¸ªä¸€å®šææ—©å¤ä¹ ï¼Œé¢„æœŸå¤ä¹ æ—¶é—´è‡³å°‘è¦ç»™åˆ° 15-20 å¤©â€¦ ä¹ é¢˜çš„è¯å»ºè®®æŠŠæˆ‘èµ„æ–™é‡Œé‚£äº›ç¦»æ•£æ•°å­¦éƒ¨åˆ†çš„ä¹ é¢˜åšå®Œå°±å·®ä¸å¤šäº†ï¼Œéš¾åº¦åŸºæœ¬ä¸ä¹‹æŒå¹³ã€‚ ç®—æ³•è®¾è®¡ä¸åˆ†æè¿™ä¸ªæˆ‘æ²¡è€ƒè¿‡..é¢„æœŸæ˜¯ç®—æ—¶é—´å¤æ‚åº¦ä¹‹ç±»çš„é¢˜å‹å§â€¦æ¯•ç«Ÿæ˜¯é€‰æ‹©é¢˜â€¦ é€»è¾‘æ€ç»´èƒ½åŠ›è¿™ä¸ªè€ƒå‰æ— éœ€å‡†å¤‡ï¼Œç¨å¾®çœ‹ä¸€ä¸‹æˆ‘ç»™çš„èµ„æ–™é‡Œçš„é¢˜ç›®å°±è¡Œï¼Œé¢˜ç›®æ¯”è¾ƒç®€å•ï¼Œå»ºè®®è€ƒè¯•å…ˆåšè¿™ä¸ªï¼Œåˆ†å€¼å¾ˆé‡ï¼Œå¾ˆå¤šåŒå­¦åœ¨è€ƒè¯•çš„æ—¶å€™æœ€åéƒ½æ²¡æ—¶é—´åšè¿™ä¸ªï¼ï¼ï¼ï¼è´¼å¯æƒœçš„å–ï¼ï¼é€åˆ†é¢˜å˜æˆäº†é€å‘½é¢˜â€¦ Cè¯­è¨€è¿™ä¸ª80åˆ†æ˜¯å¤§å¤´å“Ÿï¼ŒåŸºæœ¬ä¸Šå†³å®šä½ èƒ½ä¸èƒ½ä¸Šä½ çš„ä¸€å¿—æ„¿ï¼åŸºæœ¬ä¸Šåšå‡ºä¸¤é“æ”¹é”™å°±å¾ˆç¨³äº†ï¼Œæ¯•ç«Ÿ20åˆ†ä¸€é¢˜å–ï¼æˆ‘å»ºè®®è¿™ä¸ªåœ¨å‡ºåˆ†å‰å°±åŸºæœ¬è¦å‡†å¤‡å®Œæˆï¼Œå‡ºåˆ†åå¯ä»¥è¿›è¡Œæ•°æ®åº“ç³»ç»Ÿçš„å¤ä¹ å’Œç¦»æ•£æ•°å­¦è¿‘ä¸–ä»£æ•°éƒ¨åˆ†å¤ä¹ ã€‚å‡†å¤‡æ–¹å¼å°±æ˜¯åˆ·è‹å°çº¢è€å¸ˆé‚£æœ¬Cè¯­è¨€çš„ä¹¦ï¼ŒæŠŠé‡è¦ç« èŠ‚(å­—ç¬¦ä¸²é‚£å‡ ç« )è¯¾åé¢˜å…¨éƒ¨åˆ·ä¸€éï¼Œæ‰¾åˆ° ac é¢˜ç›®çš„æ„Ÿè§‰ï¼ŒåŒæ—¶æ¸©é¦¨æé†’å¯ä»¥ä¸Š LeetCode æ‰¾ä¸€äº›ç›¸å…³çš„ä¸“é¢˜è¿›è¡Œç»ƒä¹ ï¼Œè¿™æ ·åœ¨è€ƒåœºä¼šæœ‰ä¸€ç§ç†Ÿæ‚‰çš„æ„Ÿè§‰ï¼ è¿™ä¸ªå‡†å¤‡èµ·æ¥æ—¶é—´åº”è¯¥å·®ä¸å¤š15å¤©å·¦å³ï¼Œä¸€å®šè¦å¤šå†™ä»£ç ï¼Œæœ‰æ„Ÿè§‰æ˜¯æœ€é‡è¦çš„ã€‚ é¢è¯•éƒ¨åˆ†ä¸Šé¢æœ‰è®²è¿‡ï¼Œé¢è¯•æ˜¯åœ¨ä¸‹åˆ1ç‚¹å·¦å³å°±å·®ä¸å¤šå‡†å¤‡å¼€å§‹çš„ã€‚å…± 4 è½®ï¼Œæ¯è½® 35 åˆ†ã€‚é¢è¯•çš„æ•´ä½“æµç¨‹æ˜¯ï¼Œä¼šç»™ä½ æ’å·ï¼Œç„¶ååˆ°ä½ äº†ä¼šå«ä½ å‡ºå»ï¼Œç„¶ååˆ°æŒ‡å®šæ•™å®¤çš„é—¨å¤–ï¼Œæ‹¿åˆ°ä¸€å¼ çº¸ï¼Œä¸Šé¢æœ‰è¯¥è½®é¢è¯•è¦é—®çš„é¢˜ç›®ï¼Œä½ åœ¨é—¨å¤–å‡†å¤‡ 5åˆ†é’Ÿå·¦å³ï¼Œç„¶åè¿›å»ç›´æ¥ä½œç­”å°±å¥½ï¼Œä¸€è½®é¢è¯•å¤§æ¦‚æ˜¯ 5 åˆ†é’Ÿå·¦å³ï¼Œæ—¶é—´å¾ˆçŸ­ã€‚ ä¸€é¢ 35 åˆ†ï¼Œç¬¬ä¸€é¢è‡ªæˆ‘ä»‹ç»ï¼Œé¢˜ç›®å¤§æ¦‚æ˜¯ï¼Œç»™ä½ ä¸€å¼ å›¾ï¼Œè®©ä½ çœ‹çœ‹èƒ½çœ‹åˆ°å•¥(é¬¼çŸ¥é“è¿™æ˜¯åœ¨æ•´å•¥ç©æ„â€¦)ï¼Œå…¨ç¨‹å¯ä»¥é€‰æ‹©è‹±æ–‡ or ä¸­æ–‡ï¼Œå¯èƒ½ç”¨è‹±æ–‡å…¨ç¨‹ä½œç­”ä¼šæœ‰ç‚¹åŠ åˆ†å§â€¦ äºŒé¢ 35 åˆ†ï¼Œç¬¬äºŒé¢æ˜¯è®²ç«èµ›ç»å†å’Œé¡¹ç›®ç»å†ï¼Œä¸»è¦æ˜¯çœ‹è¯ä¹¦(å¥–å­¦é‡‘è¯ä¹¦å•¥çš„æ²¡ç”¨å“ˆ)ï¼Œè¦çš„æ˜¯CCFä¹‹ç±»çš„è·å¥–è¯ä¹¦ï¼Œå…¶ä»–çš„ä¸€å¾‹ä¸çœ‹ï¼è¿™ä¸€é¢å¦‚æœæ²¡æœ‰ç«èµ›ç»å†å’Œè·å¥–ç»å†æ‰£åˆ†ä¼šæ¯”è¾ƒä¸¥é‡ï¼Œé¡¹ç›®çš„è¯å»ºè®®è‡ªå·±åŒ…è£…ä¸€ä¸‹ï¼Œæœ€å¥½æ˜¯èƒ½å•†ç”¨çš„é¡¹ç›®è®²å‡ºæ¥ï¼Œç„¶åæ¶‰åŠçš„æŠ€æœ¯æ ˆæœ€å¥½ä¹Ÿæ˜¯ä¼ä¸šæ­£åœ¨ç”¨çš„ï¼Œä¸¾ä¸ªå°ä¾‹å­ï¼Œå°±æ¯”å¦‚ web å¼€å‘ï¼Œæ­£å¸¸ç°åœ¨éƒ½æ˜¯å‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯ react/vueï¼Œåç«¯ springbootï¼Œç„¶åå¤–å¸¦å¾®æœåŠ¡ springCloud/Dubboï¼Œå¹¶ä¸”ä½¿ç”¨å®¹å™¨æŠ€æœ¯ Docker/K8sï¼Œä½¿ç”¨æ•°æ®åº“ Redisï¼Œç©¿æ’ä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ RabbitMQ/Kafkaï¼Œå¤§æ¦‚è¿™æ ·åŒ…è£…ä¸€ä¸‹æˆ‘è§‰å¾—å‡ åˆ†é’Ÿä¸‹æ¥è€å¸ˆæ˜¯é—®ä¸å‡ºä»€ä¹ˆç ´ç»½çš„ï¼Œæœ€å¥½æ˜¯å…¨ç¨‹éƒ½æ˜¯ä½ åœ¨è®²è¿™æ ·å­ï¼Œæ•ˆæœä¼šå¥½ä¸€äº›ã€‚ ä¸‰é¢æ˜¯ä¸“ä¸šé¢ï¼Œ35 åˆ†ï¼Œå°±æ˜¯ç»™ä½ ä¸€é“é¢˜ï¼Œä½ åœ¨å¤–é¢æ€è€ƒ5åˆ†é’Ÿï¼Œä¸€èˆ¬å°±æ˜¯æ™®é€šçš„æ™ºåŠ›é¢˜ï¼Œä¸ç”¨å¤ªæ‹…å¿ƒï¼ŒæŒºç®€å•çš„ï¼Œæˆ‘å½“æ—¶çš„é¢˜ç›®æ˜¯çˆ¬å±±é—®é¢˜ï¼Œä¸€ä¸ªäººä»å±±ä¸‹çˆ¬ä¸Šå»ï¼Œä¸€ä¸ªä»å±±ä¸‹ä¸‹æ¥ï¼Œä»€ä¹ˆæ—¶å€™ç›¸é‡â€¦è¿™ç±»çš„é—®é¢˜ã€‚ä¸ªäººæ„Ÿè§‰è¿™ä¸€é¢æƒ³è€ƒå¯Ÿçš„è¿˜æ˜¯ä½ å¯¹å…·ä½“ç”Ÿæ´»åœºæ™¯çš„æŠ½è±¡åŒ–ï¼Œèƒ½å¤Ÿè½¬æ¢æˆè®¡ç®—æœºæ€ç»´çš„æ–¹å¼ï¼Œå¹¶ä¸”å°½å¯èƒ½çš„è€ƒè™‘é—®é¢˜å…¨é¢ä¸€äº›ï¼Œå°¤å…¶æ˜¯ä¸€äº›æ¡ä»¶çš„è®¾å®šï¼Œå¯ä»¥è·Ÿè€å¸ˆå¤šæ¢è®¨ä¸€ä¸‹ï¼Œä¸»è¦è¿˜æ˜¯ä¸è¦å†·åœºï¼Œå…¨ç¨‹éƒ½æœ‰åœ¨äº¤æµæˆ‘è§‰å¾—å°±æ¯”è¾ƒ okay çš„ã€‚ å››é¢ï¼ï¼ï¼ï¼35 åˆ†ï¼Œè¿™ä¸ªæˆ‘æœ€æƒ³è®²ï¼Œå› ä¸ºæˆ‘é¢çš„ä¸å¥½ï¼Œæ²¡æœ‰å‡†å¤‡ï¼Œä¹Ÿæ²¡ç»éªŒï¼ï¼æˆ‘çš„å»ºè®®æ˜¯ï¼šä¸€å®šè¦çœ‹çœ‹äººå·¥æ™ºèƒ½ï¼Œè‡ªç„¶è¯­è¨€ï¼Œæœºå™¨ç¿»è¯‘ï¼Œæ¨¡å¼è¯†åˆ«ç­‰ç­‰ä¹‹ç±»çš„ä¸œè¥¿ï¼Œè¿™ä¸€é¢ä¸»è¦å°±é—®è¿™ä¸ªï¼Œæˆ‘å½“æ—¶æ˜¯é¢çš„äººå·¥æ™ºèƒ½ï¼Œå¦ˆå‘€å•¥ä¹Ÿä¸ä¼šå•Šï¼Œè®²ä¸å‡ºè¯â€¦ä½ å‡†å¤‡çš„è¯å°±å¤§æ¦‚çœ‹çœ‹äººå·¥æ™ºèƒ½æ˜¯ä¸ªå•¥â€¦ç”¨äºå“ªäº›é¢†åŸŸï¼Œæœ‰å¤§æ¦‚å“ªäº›æŠ€æœ¯ï¼Œåˆç•¥çš„å¤§æ¦‚çœ‹çœ‹å°±è¡Œã€‚å¯¹äº†ï¼Œå¥½åƒä¹Ÿæœ‰ä¸€ä¸¤æ¡çº¿ä¼šé—®ç¼–è¯‘åŸç†å’Œæ“ä½œç³»ç»Ÿçš„é—®é¢˜ï¼Œæˆ‘è¿™æ¡çº¿å€’æ˜¯æ²¡é—®è¿‡ï¼Œå¦‚æœæœ‰æ—¶é—´çš„è¯å¯ä»¥å›é¡¾ä¸€ä¸‹æœ¬ç§‘çš„ pptï¼Œåº”è¯¥å°±å·®ä¸å¤šäº†ã€‚]]></content>
  </entry>
  <entry>
    <title><![CDATA[é€’å½’æ€»ç»“(è½¬)]]></title>
    <url>%2F2020%2F01%2F04%2F%E9%80%92%E5%BD%92%E8%AF%A6%E8%A7%A3.html</url>
    <content type="text"><![CDATA[3é“é¢˜å½»åº•æå®šï¼šå¥—è·¯è§£å†³é€’å½’é—®é¢˜(è½¬)å‰è¨€è½¬çš„å“ˆ~æˆ‘è‡ªå·±å­¦ä¹ çœ‹çš„ï¼ï¼ åŸæ–‡é“¾æ¥ â€”â€”-&gt; è§£å†³é€’å½’ ç›¸ä¿¡ä¸å°‘åŒå­¦å’Œæˆ‘ä¸€æ ·ï¼Œåœ¨åˆšå­¦å®Œæ•°æ®ç»“æ„åå¼€å§‹åˆ·ç®—æ³•é¢˜æ—¶ï¼Œé‡åˆ°é€’å½’çš„é—®é¢˜æ€»æ˜¯å¾ˆå¤´ç–¼ï¼Œè€Œä¸€çœ‹è§£ç­”ï¼Œå´å‘ç°å¤§ä½¬ä»¬å‡ è¡Œé€’å½’ä»£ç å°±ä¼˜é›…çš„è§£å†³äº†é—®é¢˜ã€‚ä»æˆ‘è‡ªå·±çš„å­¦ä¹ ç»å†æ¥çœ‹ï¼Œåˆšå¼€å§‹ç†è§£é€’å½’æ€è·¯éƒ½å¾ˆå›°éš¾ï¼Œæ›´åˆ«è¯´è‡ªå·±å†™äº†ã€‚ æˆ‘ä¸€ç›´è§‰å¾—åˆ·ç®—æ³•é¢˜å’Œåº”è¯•ä¸€æ ·ï¼Œæ—¢ç„¶æ˜¯åº”è¯•å°±ä¸€å®šæœ‰å¥—è·¯å­˜åœ¨ã€‚åœ¨åˆ·é¢˜ä¸­ï¼Œæˆ‘æ€»ç»“å‡ºäº†ä¸€å¥—è§£å†³é€’å½’é—®é¢˜çš„æ¨¡ç‰ˆæ€è·¯ä¸è§£æ³•ï¼Œç”¨è¿™ä¸ªæ€è·¯å¯ä»¥ç§’è§£å¾ˆå¤šé€’å½’é—®é¢˜ã€‚ é€’å½’è§£é¢˜ä¸‰éƒ¨æ›²ä½•ä¸ºé€’å½’ï¼Ÿç¨‹åºåå¤è°ƒç”¨è‡ªèº«å³æ˜¯é€’å½’ã€‚ æˆ‘è‡ªå·±åœ¨åˆšå¼€å§‹è§£å†³é€’å½’é—®é¢˜çš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼šå»çº ç»“è¿™ä¸€å±‚å‡½æ•°åšäº†ä»€ä¹ˆï¼Œå®ƒè°ƒç”¨è‡ªèº«åçš„ä¸‹ä¸€å±‚å‡½æ•°åˆåšäº†ä»€ä¹ˆâ€¦ç„¶åå°±ä¼šè§‰å¾—å®ç°ä¸€ä¸ªé€’å½’è§£æ³•ååˆ†å¤æ‚ï¼Œæ ¹æœ¬å°±æ— ä»ä¸‹æ‰‹ã€‚ ç›¸ä¿¡å¾ˆå¤šåˆå­¦è€…å’Œæˆ‘ä¸€æ ·ï¼Œè¿™æ˜¯ä¸€ä¸ªæ€ç»´è¯¯åŒºï¼Œä¸€å®šè¦èµ°å‡ºæ¥ã€‚æ—¢ç„¶é€’å½’æ˜¯ä¸€ä¸ªåå¤è°ƒç”¨è‡ªèº«çš„è¿‡ç¨‹ï¼Œè¿™å°±è¯´æ˜å®ƒæ¯ä¸€çº§çš„åŠŸèƒ½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å…³æ³¨ä¸€çº§é€’å½’çš„è§£å†³è¿‡ç¨‹å³å¯ã€‚ æˆ‘ä»¬éœ€è¦å…³å¿ƒçš„ä¸»è¦æ˜¯ä»¥ä¸‹ä¸‰ç‚¹ï¼š æ•´ä¸ªé€’å½’çš„ç»ˆæ­¢æ¡ä»¶ã€‚ ä¸€çº§é€’å½’éœ€è¦åšä»€ä¹ˆï¼Ÿ åº”è¯¥è¿”å›ç»™ä¸Šä¸€çº§çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼Ÿ å› æ­¤ï¼Œä¹Ÿå°±æœ‰äº†æˆ‘ä»¬è§£é€’å½’é¢˜çš„ä¸‰éƒ¨æ›²ï¼š æ‰¾æ•´ä¸ªé€’å½’çš„ç»ˆæ­¢æ¡ä»¶ï¼šé€’å½’åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™ç»“æŸï¼Ÿ æ‰¾è¿”å›å€¼ï¼šåº”è¯¥ç»™ä¸Šä¸€çº§è¿”å›ä»€ä¹ˆä¿¡æ¯ï¼Ÿ æœ¬çº§é€’å½’åº”è¯¥åšä»€ä¹ˆï¼šåœ¨è¿™ä¸€çº§é€’å½’ä¸­ï¼Œåº”è¯¥å®Œæˆä»€ä¹ˆä»»åŠ¡ï¼Ÿ ä¸€å®šè¦ç†è§£è¿™3æ­¥ï¼Œè¿™å°±æ˜¯ä»¥åé€’å½’ç§’æ€ç®—æ³•é¢˜çš„ä¾æ®å’Œæ€è·¯ã€‚ ä½†è¿™ä¹ˆè¯´å¥½åƒå¾ˆç©ºï¼Œæˆ‘ä»¬æ¥ä»¥é¢˜ç›®ä½œä¸ºä¾‹å­ï¼Œçœ‹çœ‹æ€ä¹ˆå¥—è¿™ä¸ªæ¨¡ç‰ˆï¼Œç›¸ä¿¡3é“é¢˜ä¸‹æ¥ï¼Œä½ å°±èƒ½æ…¢æ…¢ç†è§£è¿™ä¸ªæ¨¡ç‰ˆã€‚ä¹‹åå†è§£è¿™ç§å¥—è·¯é€’å½’é¢˜éƒ½èƒ½ç›´æ¥ç§’äº†ã€‚ ä¾‹1ï¼šæ±‚äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦å…ˆçœ‹ä¸€é“ç®€å•çš„Leetcodeé¢˜ç›®ï¼š Leetcode 104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ é¢˜ç›®å¾ˆç®€å•ï¼Œæ±‚äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œé‚£ä¹ˆç›´æ¥å¥—é€’å½’è§£é¢˜ä¸‰éƒ¨æ›²æ¨¡ç‰ˆï¼š æ‰¾ç»ˆæ­¢æ¡ä»¶ã€‚ ä»€ä¹ˆæƒ…å†µä¸‹é€’å½’ç»“æŸï¼Ÿå½“ç„¶æ˜¯æ ‘ä¸ºç©ºçš„æ—¶å€™ï¼Œæ­¤æ—¶æ ‘çš„æ·±åº¦ä¸º0ï¼Œé€’å½’å°±ç»“æŸäº†ã€‚ æ‰¾è¿”å›å€¼ã€‚ åº”è¯¥è¿”å›ä»€ä¹ˆï¼Ÿé¢˜ç›®æ±‚çš„æ˜¯æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œæˆ‘ä»¬éœ€è¦ä»æ¯ä¸€çº§å¾—åˆ°çš„ä¿¡æ¯è‡ªç„¶æ˜¯å½“å‰è¿™ä¸€çº§å¯¹åº”çš„æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œå› æ­¤æˆ‘ä»¬çš„è¿”å›å€¼åº”è¯¥æ˜¯å½“å‰æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œè¿™ä¸€æ­¥å¯ä»¥ç»“åˆç¬¬ä¸‰æ­¥æ¥çœ‹ã€‚ æœ¬çº§é€’å½’åº”è¯¥åšä»€ä¹ˆã€‚ é¦–å…ˆï¼Œè¿˜æ˜¯å¼ºè°ƒè¦èµ°å‡ºä¹‹å‰çš„æ€ç»´è¯¯åŒºï¼Œé€’å½’åæˆ‘ä»¬çœ¼é‡Œçš„æ ‘ä¸€å®šæ˜¯è¿™ä¸ªæ ·å­çš„ï¼Œçœ‹ä¸‹å›¾ã€‚æ­¤æ—¶å°±ä¸‰ä¸ªèŠ‚ç‚¹ï¼šrootã€root.leftã€root.rightï¼Œå…¶ä¸­æ ¹æ®ç¬¬äºŒæ­¥ï¼Œroot.leftå’Œroot.rightåˆ†åˆ«è®°å½•çš„æ˜¯rootçš„å·¦å³å­æ ‘çš„æœ€å¤§æ·±åº¦ã€‚é‚£ä¹ˆæœ¬çº§é€’å½’åº”è¯¥åšä»€ä¹ˆå°±å¾ˆæ˜ç¡®äº†ï¼Œè‡ªç„¶å°±æ˜¯åœ¨rootçš„å·¦å³å­æ ‘ä¸­é€‰æ‹©è¾ƒå¤§çš„ä¸€ä¸ªï¼Œå†åŠ ä¸Š1å°±æ˜¯ä»¥rootä¸ºæ ¹çš„å­æ ‘çš„æœ€å¤§æ·±åº¦äº†ï¼Œç„¶åå†è¿”å›è¿™ä¸ªæ·±åº¦å³å¯ã€‚ å…·ä½“Javaä»£ç å¦‚ä¸‹ï¼š 12345678910111213class Solution &#123; public int maxDepth(TreeNode root) &#123; //ç»ˆæ­¢æ¡ä»¶ï¼šå½“æ ‘ä¸ºç©ºæ—¶ç»“æŸé€’å½’ï¼Œå¹¶è¿”å›å½“å‰æ·±åº¦0 if(root == null)&#123; return 0; &#125; //rootçš„å·¦ã€å³å­æ ‘çš„æœ€å¤§æ·±åº¦ int leftDepth = maxDepth(root.left); int rightDepth = maxDepth(root.right); //è¿”å›çš„æ˜¯å·¦å³å­æ ‘çš„æœ€å¤§æ·±åº¦+1 return Math.max(leftDepth, rightDepth) + 1; &#125;&#125; å½“è¶³å¤Ÿç†Ÿç»ƒåï¼Œä¹Ÿå¯ä»¥å’ŒLeetcodeè¯„è®ºåŒºä¸€æ ·ï¼Œå¾ˆéªšçš„å‡ è¡Œä»£ç æå®šé—®é¢˜ï¼Œè®©ä¹‹åçš„æ–°æ‰‹çœ‹çš„ä¸€è„¸æ‡µé€¼(è¿™é“é¢˜ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡ä¸€è¡Œä»£ç æå®šä¸€é“Leetcodeé¢˜)ï¼š 12345class Solution &#123; public int maxDepth(TreeNode root) &#123; return root == null ? 0 : Math.max(maxDepth(root.left), maxDepth(root.right)) + 1; &#125;&#125; ä¾‹2ï¼šä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹çœ‹äº†ä¸€é“é€’å½’å¥—è·¯è§£å†³äºŒå‰æ ‘çš„é—®é¢˜åï¼Œæœ‰ç‚¹å¥—è·¯æå®šé€’å½’çš„æ„Ÿè§‰äº†å—ï¼Ÿæˆ‘ä»¬å†æ¥çœ‹ä¸€é“Leetcodeä¸­ç­‰éš¾åº¦çš„é“¾è¡¨çš„é—®é¢˜ï¼ŒæŒæ¡å¥—è·¯åè¿™ç§ä¸­ç­‰éš¾åº¦çš„é—®é¢˜çœŸçš„å°±æ˜¯ç§’ï¼šLeetcode 24. ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ ç›´æ¥ä¸Šä¸‰éƒ¨æ›²æ¨¡ç‰ˆï¼š æ‰¾ç»ˆæ­¢æ¡ä»¶ã€‚ ä»€ä¹ˆæƒ…å†µä¸‹é€’å½’ç»ˆæ­¢ï¼Ÿæ²¡å¾—äº¤æ¢çš„æ—¶å€™ï¼Œé€’å½’å°±ç»ˆæ­¢äº†å‘—ã€‚å› æ­¤å½“é“¾è¡¨åªå‰©ä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…æ²¡æœ‰èŠ‚ç‚¹çš„æ—¶å€™ï¼Œè‡ªç„¶é€’å½’å°±ç»ˆæ­¢äº†ã€‚ æ‰¾è¿”å›å€¼ã€‚ æˆ‘ä»¬å¸Œæœ›å‘ä¸Šä¸€çº§é€’å½’è¿”å›ä»€ä¹ˆä¿¡æ¯ï¼Ÿç”±äºæˆ‘ä»¬çš„ç›®çš„æ˜¯ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå› æ­¤è‡ªç„¶å¸Œæœ›äº¤æ¢ç»™ä¸Šä¸€çº§é€’å½’çš„æ˜¯å·²ç»å®Œæˆäº¤æ¢å¤„ç†ï¼Œå³å·²ç»å¤„ç†å¥½çš„é“¾è¡¨ã€‚ æœ¬çº§é€’å½’åº”è¯¥åšä»€ä¹ˆã€‚ ç»“åˆç¬¬äºŒæ­¥ï¼Œçœ‹ä¸‹å›¾ï¼ç”±äºåªè€ƒè™‘æœ¬çº§é€’å½’ï¼Œæ‰€ä»¥è¿™ä¸ªé“¾è¡¨åœ¨æˆ‘ä»¬çœ¼é‡Œå…¶å®ä¹Ÿå°±ä¸‰ä¸ªèŠ‚ç‚¹ï¼šheadã€head.nextã€å·²å¤„ç†å®Œçš„é“¾è¡¨éƒ¨åˆ†ã€‚è€Œæœ¬çº§é€’å½’çš„ä»»åŠ¡ä¹Ÿå°±æ˜¯äº¤æ¢è¿™3ä¸ªèŠ‚ç‚¹ä¸­çš„å‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå°±å¾ˆeasyäº†ã€‚ é™„ä¸ŠJavaä»£ç ï¼š 123456789101112131415class Solution &#123; public ListNode swapPairs(ListNode head) &#123; //ç»ˆæ­¢æ¡ä»¶ï¼šé“¾è¡¨åªå‰©ä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…æ²¡èŠ‚ç‚¹äº†ï¼Œæ²¡å¾—äº¤æ¢äº†ã€‚è¿”å›çš„æ˜¯å·²ç»å¤„ç†å¥½çš„é“¾è¡¨ if(head == null || head.next == null)&#123; return head; &#125; //ä¸€å…±ä¸‰ä¸ªèŠ‚ç‚¹:head, next, swapPairs(next.next) //ä¸‹é¢çš„ä»»åŠ¡ä¾¿æ˜¯äº¤æ¢è¿™3ä¸ªèŠ‚ç‚¹ä¸­çš„å‰ä¸¤ä¸ªèŠ‚ç‚¹ ListNode next = head.next; head.next = swapPairs(next.next); next.next = head; //æ ¹æ®ç¬¬äºŒæ­¥ï¼šè¿”å›ç»™ä¸Šä¸€çº§çš„æ˜¯å½“å‰å·²ç»å®Œæˆäº¤æ¢åï¼Œå³å¤„ç†å¥½äº†çš„é“¾è¡¨éƒ¨åˆ† return next; &#125;&#125; ä¾‹3ï¼šå¹³è¡¡äºŒå‰æ ‘ç›¸ä¿¡ç»è¿‡ä»¥ä¸Š2é“é¢˜ï¼Œä½ å·²ç»å¤§æ¦‚ç†è§£äº†è¿™ä¸ªæ¨¡ç‰ˆçš„è§£é¢˜æµç¨‹äº†ã€‚ é‚£ä¹ˆè¯·ä½ å…ˆä¸çœ‹ä»¥ä¸‹éƒ¨åˆ†ï¼Œå°è¯•è§£å†³ä¸€ä¸‹è¿™é“easyéš¾åº¦çš„Leetcodeé¢˜ï¼ˆä¸ªäººè§‰å¾—æ­¤é¢˜æ¯”ä¸Šé¢çš„mediuméš¾åº¦è¦éš¾ï¼‰ï¼šLeetcode 110. å¹³è¡¡äºŒå‰æ ‘ æˆ‘è§‰å¾—è¿™ä¸ªé¢˜çœŸçš„æ˜¯é›†åˆäº†æ¨¡ç‰ˆçš„ç²¾é«“æ‰€åœ¨ï¼Œä¸‹é¢å¥—ä¸‰éƒ¨æ›²æ¨¡ç‰ˆï¼š æ‰¾ç»ˆæ­¢æ¡ä»¶ã€‚ ä»€ä¹ˆæƒ…å†µä¸‹é€’å½’åº”è¯¥ç»ˆæ­¢ï¼Ÿè‡ªç„¶æ˜¯å­æ ‘ä¸ºç©ºçš„æ—¶å€™ï¼Œç©ºæ ‘è‡ªç„¶æ˜¯å¹³è¡¡äºŒå‰æ ‘äº†ã€‚ åº”è¯¥è¿”å›ä»€ä¹ˆä¿¡æ¯ï¼š ä¸ºä»€ä¹ˆæˆ‘è¯´è¿™ä¸ªé¢˜æ˜¯é›†åˆäº†æ¨¡ç‰ˆç²¾é«“ï¼Ÿæ­£æ˜¯å› ä¸ºæ­¤é¢˜çš„è¿”å›å€¼ã€‚è¦çŸ¥é“æˆ‘ä»¬æè¿™ä¹ˆå¤šèŠ±é‡Œèƒ¡å“¨çš„ï¼Œéƒ½æ˜¯ä¸ºäº†èƒ½å†™å‡ºæ­£ç¡®çš„é€’å½’å‡½æ•°ï¼Œå› æ­¤åœ¨è§£è¿™ä¸ªé¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦æ€è€ƒï¼Œæˆ‘ä»¬åˆ°åº•å¸Œæœ›è¿”å›ä»€ä¹ˆå€¼ï¼Ÿ ä½•ä¸ºå¹³è¡¡äºŒå‰æ ‘ï¼Ÿå¹³è¡¡äºŒå‰æ ‘å³å·¦å³ä¸¤æ£µå­æ ‘é«˜åº¦å·®ä¸å¤§äº1çš„äºŒå‰æ ‘ã€‚è€Œå¯¹äºä¸€é¢—æ ‘ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¹³è¡¡äºŒå‰æ ‘éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼šå®ƒçš„å·¦å­æ ‘æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œå®ƒçš„å³å­æ ‘æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œå®ƒçš„å·¦å³å­æ ‘çš„é«˜åº¦å·®ä¸å¤§äº1ã€‚æ¢å¥è¯è¯´ï¼šå¦‚æœå®ƒçš„å·¦å­æ ‘æˆ–å³å­æ ‘ä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œæˆ–è€…å®ƒçš„å·¦å³å­æ ‘é«˜åº¦å·®å¤§äº1ï¼Œé‚£ä¹ˆå®ƒå°±ä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ã€‚ è€Œåœ¨æˆ‘ä»¬çœ¼é‡Œï¼Œè¿™é¢—äºŒå‰æ ‘å°±3ä¸ªèŠ‚ç‚¹ï¼šrootã€leftã€rightã€‚é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥è¿”å›ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœè¿”å›ä¸€ä¸ªå½“å‰æ ‘æ˜¯å¦æ˜¯å¹³è¡¡äºŒå‰æ ‘çš„booleanç±»å‹çš„å€¼ï¼Œé‚£ä¹ˆæˆ‘åªçŸ¥é“leftå’Œrightè¿™ä¸¤æ£µæ ‘æ˜¯å¦æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œæ— æ³•å¾—å‡ºleftå’Œrightçš„é«˜åº¦å·®æ˜¯å¦ä¸å¤§äº1ï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•å¾—å‡ºrootè¿™æ£µæ ‘æ˜¯å¦æ˜¯å¹³è¡¡äºŒå‰æ ‘äº†ã€‚è€Œå¦‚æœæˆ‘è¿”å›çš„æ˜¯ä¸€ä¸ªå¹³è¡¡äºŒå‰æ ‘çš„é«˜åº¦çš„intç±»å‹çš„å€¼ï¼Œé‚£ä¹ˆæˆ‘å°±åªçŸ¥é“ä¸¤æ£µæ ‘çš„é«˜åº¦ï¼Œä½†æ— æ³•çŸ¥é“è¿™ä¸¤æ£µæ ‘æ˜¯ä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œè‡ªç„¶ä¹Ÿå°±æ²¡æ³•åˆ¤æ–­rootè¿™æ£µæ ‘æ˜¯ä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘äº†ã€‚ å› æ­¤ï¼Œè¿™é‡Œæˆ‘ä»¬è¿”å›çš„ä¿¡æ¯åº”è¯¥æ˜¯æ—¢åŒ…å«å­æ ‘çš„æ·±åº¦çš„intç±»å‹çš„å€¼ï¼ŒåˆåŒ…å«å­æ ‘æ˜¯å¦æ˜¯å¹³è¡¡äºŒå‰æ ‘çš„booleanç±»å‹çš„å€¼ã€‚å¯ä»¥å•ç‹¬å®šä¹‰ä¸€ä¸ªReturnNodeç±»ï¼Œå¦‚ä¸‹ï¼š 123456789class ReturnNode&#123; boolean isB; int depth; //æ„é€ æ–¹æ³• public ReturnNode(boolean isB, int depth)&#123; this.isB = isB; this.depth = depth; &#125;&#125; æœ¬çº§é€’å½’åº”è¯¥åšä»€ä¹ˆã€‚ çŸ¥é“äº†ç¬¬äºŒæ­¥çš„è¿”å›å€¼åï¼Œè¿™ä¸€æ­¥å°±å¾ˆç®€å•äº†ã€‚ç›®å‰æ ‘æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼šrootï¼Œleftï¼Œrightã€‚æˆ‘ä»¬é¦–å…ˆåˆ¤æ–­leftå­æ ‘å’Œrightå­æ ‘æ˜¯å¦æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œå¦‚æœä¸æ˜¯åˆ™ç›´æ¥è¿”å›falseã€‚å†åˆ¤æ–­ä¸¤æ ‘é«˜åº¦å·®æ˜¯å¦ä¸å¤§äº1ï¼Œå¦‚æœå¤§äº1ä¹Ÿç›´æ¥è¿”å›falseã€‚å¦åˆ™è¯´æ˜ä»¥rootä¸ºèŠ‚ç‚¹çš„å­æ ‘æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œé‚£ä¹ˆå°±è¿”å›trueå’Œå®ƒçš„é«˜åº¦ã€‚ å…·ä½“çš„Javaä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536class Solution &#123; //è¿™ä¸ªReturnNodeæ˜¯å‚è€ƒæˆ‘æè¿°çš„é€’å½’å¥—è·¯çš„ç¬¬äºŒæ­¥ï¼šæ€è€ƒè¿”å›å€¼æ˜¯ä»€ä¹ˆ //ä¸€æ£µæ ‘æ˜¯BSTç­‰ä»·äºå®ƒçš„å·¦ã€å³ä¿©å­æ ‘éƒ½æ˜¯BSTä¸”ä¿©å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡1 //å› æ­¤æˆ‘è®¤ä¸ºè¿”å›å€¼åº”è¯¥åŒ…å«å½“å‰æ ‘æ˜¯å¦æ˜¯BSTå’Œå½“å‰æ ‘çš„é«˜åº¦è¿™ä¸¤ä¸ªä¿¡æ¯ private class ReturnNode&#123; boolean isB; int depth; public ReturnNode(int depth, boolean isB)&#123; this.isB = isB; this.depth = depth; &#125; &#125; //ä¸»å‡½æ•° public boolean isBalanced(TreeNode root) &#123; return isBST(root).isB; &#125; //å‚è€ƒé€’å½’å¥—è·¯çš„ç¬¬ä¸‰éƒ¨ï¼šæè¿°å•æ¬¡æ‰§è¡Œè¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ //è¿™é‡Œçš„å•æ¬¡æ‰§è¡Œè¿‡ç¨‹å…·ä½“å¦‚ä¸‹ï¼š //æ˜¯å¦ç»ˆæ­¢?-&gt;æ²¡ç»ˆæ­¢çš„è¯ï¼Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³ä¸å¹³è¡¡çš„ä¸‰ä¸ªæ¡ä»¶-&gt;è¿”å›å€¼ public ReturnNode isBST(TreeNode root)&#123; if(root == null)&#123; return new ReturnNode(0, true); &#125; //ä¸å¹³è¡¡çš„æƒ…å†µæœ‰3ç§ï¼šå·¦æ ‘ä¸å¹³è¡¡ã€å³æ ‘ä¸å¹³è¡¡ã€å·¦æ ‘å’Œå³æ ‘å·®çš„ç»å¯¹å€¼å¤§äº1 ReturnNode left = isBST(root.left); ReturnNode right = isBST(root.right); if(left.isB == false || right.isB == false)&#123; return new ReturnNode(0, false); &#125; if(Math.abs(left.depth - right.depth) &gt; 1)&#123; return new ReturnNode(0, false); &#125; //ä¸æ»¡è¶³ä¸Šé¢3ç§æƒ…å†µï¼Œè¯´æ˜å¹³è¡¡äº†ï¼Œæ ‘çš„æ·±åº¦ä¸ºå·¦å³ä¿©å­æ ‘æœ€å¤§æ·±åº¦+1 return new ReturnNode(Math.max(left.depth, right.depth) + 1, true); &#125;&#125; ä¸€äº›å¯ä»¥ç”¨è¿™ä¸ªå¥—è·¯è§£å†³çš„é¢˜æš‚æ—¶å°±å†™è¿™ä¹ˆå¤šå•¦ï¼Œä½œä¸ºä¸€ä¸ªé«˜è€ƒè¯­æ–‡åŠæ ¼åˆ†ï¼Œå¤§å­¦åˆå­¦äº†å·¥ç§‘çš„äººï¼Œè¡¨è¿°èƒ½åŠ›å®åœ¨å·®å› æ­¤å•°å•°å—¦å—¦å†™äº†ä¸€å¤§å †ï¼Œå¸Œæœ›å¤§å®¶èƒ½ç†è§£è¿™ä¸ªå¾ˆå¥½ç”¨çš„å¥—è·¯ã€‚ ä¸‹é¢æˆ‘å†åˆ—ä¸¾å‡ é“æˆ‘åœ¨åˆ·é¢˜è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¹Ÿæ˜¯ç”¨è¿™ä¸ªå¥—è·¯ç§’çš„é¢˜ï¼ŒçœŸçš„å¤ªå¤šäº†ï¼Œå¤§éƒ¨åˆ†é“¾è¡¨å’Œæ ‘çš„é€’å½’é¢˜éƒ½èƒ½è¿™ä¹ˆç§’ï¼Œå› ä¸ºæ ‘å’Œé“¾è¡¨å¤©ç”Ÿå°±æ˜¯é€‚åˆé€’å½’çš„ç»“æ„ã€‚ æˆ‘ä¼šéšæ—¶è¡¥å……ï¼Œæ­£å¥½å¤§å®¶å¯ä»¥çœ‹äº†ä¸Šé¢ä¸‰ä¸ªé¢˜åå¯ä»¥æ‹¿è¿™äº›é¢˜æ¥ç»ƒç»ƒæ‰‹ï¼Œçœ‹çœ‹è‡ªå·±æ˜¯å¦èƒ½ç‹¬ç«‹å¿«é€Ÿå‡†ç¡®çš„å†™å‡ºé€’å½’è§£æ³•äº†ã€‚ Leetcode 101. å¯¹ç§°äºŒå‰æ ‘ Leetcode 111. äºŒå‰æ ‘çš„æœ€å°æ·±åº¦ Leetcode 226. ç¿»è½¬äºŒå‰æ ‘ï¼šè¿™ä¸ªé¢˜çš„å¤‡æ³¨æ˜¯æœ€éªšçš„ã€‚Mac OSä¸‹è½½ç¥å™¨homebrewçš„å¤§ä½¬ä½œè€…å»é¢è¯•è°·æ­Œï¼Œæ²¡åšå‡ºæ¥è¿™é“ç®—æ³•é¢˜ï¼Œç„¶åè¢«è°·æ­Œé¢è¯•å®˜æ€¼äº†ï¼šâ€æˆ‘ä»¬90ï¼…çš„å·¥ç¨‹å¸ˆä½¿ç”¨æ‚¨ç¼–å†™çš„è½¯ä»¶(Homebrew)ï¼Œä½†æ˜¯æ‚¨å´æ— æ³•åœ¨é¢è¯•æ—¶åœ¨ç™½æ¿ä¸Šå†™å‡ºç¿»è½¬äºŒå‰æ ‘è¿™é“é¢˜ï¼Œè¿™å¤ªç³Ÿç³•äº†ã€‚â€ Leetcode 617. åˆå¹¶äºŒå‰æ ‘ Leetcode 654. æœ€å¤§äºŒå‰æ ‘ Leetcode 83. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´  Leetcode 206. ç¿»è½¬é“¾è¡¨]]></content>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>recrusion</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å†å¹´é¢ç»æ€»ç»“]]></title>
    <url>%2F2019%2F12%2F27%2F%E5%8E%86%E5%B9%B4%E9%9D%A2%E7%BB%8F%E6%80%BB%E7%BB%93.html</url>
    <content type="text"><![CDATA[å¿«æ‰‹ç¯‡æ•°æ®ç»“æ„ è¯´è¯´B+æ ‘å’ŒBæ ‘çš„åŒºåˆ«ï¼Œä¼˜ç¼ºç‚¹ç­‰ï¼Ÿ B æ ‘æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å­˜å‚¨ DateåŸŸï¼Œå¹¶ä¸” B æ ‘çš„å¶å­èŠ‚ç‚¹å¹¶æ²¡æœ‰ç”¨é“¾è¡¨è¿æ¥ï¼Œä½†æ˜¯ B+ æ ‘æ¯ä¸ªéå¶å­èŠ‚ç‚¹åªæœ‰ç´¢å¼•å€¼å’ŒæŒ‡é’ˆåŸŸï¼Œå¹¶ä¸å­˜å‚¨ DateåŸŸï¼Œå¹¶ä¸”å…¶å¶å­èŠ‚ç‚¹å­˜å‚¨ Date ç”¨é“¾è¡¨è¿æ¥ï¼ŒBæ ‘çš„è¯æ¯”å¹³è¡¡äºŒå‰æ ‘ã€Œæ˜¯ä¸€æ£µç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ã€è€Œè¨€ï¼Œå¢åŠ å’Œåˆ é™¤èŠ‚ç‚¹æ”¹åŠ¨å¾ˆå°‘ï¼Œæ•ˆç‡é«˜ï¼ŒB+æ˜¯ä¸ºäº†æ•°æ®åº“è€Œç”Ÿçš„ï¼Œå…¶é“¾è¡¨å¯ä»¥æ›´å¥½çš„æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œå¹¶ä¸”ç”±äºä»–çš„éå¶å­èŠ‚ç‚¹æ˜¯ä¸å­˜å‚¨ DateåŸŸçš„ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯é‡‡ç”¨çš„ç£ç›˜é¢„è¯»ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªèŠ‚ç‚¹å ç”¨ä¸€é¡µçš„æ•°æ®ï¼Œè¿™æ ·çš„è¯B+ åœ¨ä¸€é¡µä¸­å¯ä»¥å­˜å‚¨æ›´å¤šçš„æŒ‡é’ˆåŸŸï¼Œè¿™æ ·å°±å¤§å¤§é™ä½äº†æ ‘çš„é«˜åº¦ï¼Œè¿™æ ·ç£ç›˜è¯»å†™çš„æ¬¡æ•°å°±ä¸‹é™äº†ï¼Œéå¸¸å¥½ã€‚ ç»æœ‰ä¸€ä¸ªæŸ¥è¯¢å¥½å‹çš„æ¥å£ï¼Œè®¾è®¡ä¸€ä¸ªå¾®ä¿¡æœ‹å‹åœˆï¼Œå¯ä»¥å®ç°å‘è¡¨æœ‹å‹åœˆï¼Œæ·»åŠ è¯„è®ºï¼ŒæŸ¥çœ‹è¯„è®ºç­‰åŠŸèƒ½ã€‚ä¸»è¦æ˜¯è®¾è®¡æ•°æ®ç»“æ„ æ“ä½œç³»ç»Ÿè®¡ç®—æœºç½‘ç»œ TCPä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ä¸­æœåŠ¡ç«¯çš„å“ªå‡ ç§çŠ¶æ€ï¼Œå“ªå‡ ç§åŒ… ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘ä¸€ä¸ª syn æœåŠ¡å™¨ç«¯å‘ä¸€ä¸ª syn ack ç„¶åå®¢æˆ·ç«¯å‘ä¸€ä¸ªack å››æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯å‘ä¸€ä¸ª fin æœåŠ¡å™¨ç«¯å‘é€ä¸€ä¸ª ack ç„¶åå‘é€ä¸€ä¸ª fin ç„¶åå®¢æˆ·ç«¯å†å‘é€ä¸€ä¸ªack ç®—æ³• ç®—æ³•é¢˜ï¼šæ— åºæ•°åˆ—ä¸­æ±‚ç¬¬kå¤§çš„æ•°(ç»´æŠ¤æœ€å°å †ï¼Œç„¶åä¾æ¬¡éå†ï¼Œä¸å †é¡¶æ¯”è¾ƒ å†™ä¸€ä¸ªé€‰æ‹©æ’åºæˆ–è€…æ’å…¥æ’åº å†™ä¸€ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€… ã€ŒGet!!!ã€ ä¸‰ç§æ–¹æ³•ã€‚ synchronizedï¼ˆObjectï¼‰çš„ wait/notifyï¼› ReentrantLock ä¸­çš„ Condition çš„ await/signalï¼› é˜»å¡é˜Ÿåˆ—ç›´æ¥å®ç°ï¼šLinkedBlockingQueue ä¸€ä¸ªäºŒç»´çŸ©é˜µè¿›è¡Œé€†ç½®æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¡Œå˜åˆ—åˆ—å˜è¡Œã€‚æ‰©å±•ä¸€ä¸‹ï¼ŒäºŒç»´æ•°ç»„å­˜åœ¨500gçš„æ–‡ä»¶ä¸­ï¼Œæ€ä¹ˆåšæ‰èƒ½å®Œæˆä¸Šé¢ç®—æ³•çš„æ“ä½œï¼Œæˆ‘å°±è¯´å…ˆæŒ‰è¡Œæ‹†åˆ†ï¼Œæœ€åå†æ‹¼æ¥ã€‚ javaåŸºç¡€ HashMapçš„åº•å±‚æ•°æ®ç»“æ„ ã€ŒGet!!!ã€ çº¢é»‘æ ‘+é“¾è¡¨+æ•°ç»„ HashMapå“ˆå¸Œå‡½æ•°çš„è®¤è¯†ï¼ŒJDK1.8é‡‡ç”¨çš„hashå‡½æ•° ã€ŒGet!!!ã€ æ‰°åŠ¨å‡½æ•°ï¼Œé«˜16ä½å’Œä½16ä½ç›¸å¼‚æˆ–ï¼Œ32ä½éƒ½å‚ä¸è¿ç®—ï¼Œè¿™æ ·hashæ›´å‡åŒ€ è‡³äºå¦‚ä½•è®¡ç®—æ‰€åœ¨çš„æ•°ç»„ä½ç½®ï¼Œç›´æ¥ hash ^ tab.length ç›¸ä¸ å¤šçº¿ç¨‹ Qï¼šå¤šçº¿ç¨‹JUCåŒ…ä¸‹çš„ä¸€äº›å¸¸è§çš„ç±»ï¼Œæ¯”å¦‚CountDownLatchã€Semaphoreç­‰ ã€ŒGet!!!ã€ CountDownLatch å€’è®¡æ—¶å™¨ Semphore ä¿¡å·é‡ Qï¼šé”çš„æ¦‚å¿µï¼Œé”ç›¸å…³çš„å…³é”®å­—ï¼Œvolatileï¼Œsynchronizedã€‚è¿˜æ¯”è¾ƒäº†ReentrantLockä¸synchronizedã€‚ ã€ŒGet!!!ã€ ReentrantLock &amp; syncronized åŒºåˆ« ReentrantLock æœ‰ä¸‰ä¸ª syncronized æ²¡æœ‰çš„ç‰¹æ€§ï¼Œç¬¬ä¸€ä¸ªæ˜¯ æ¡ä»¶é˜Ÿåˆ—å¯ä»¥æœ‰å¤šä¸ªï¼ŒCondition å¯ä»¥åˆ†ç»„ï¼Œä½†æ˜¯ syncronized ä¸å¯ä»¥ï¼›ç¬¬äºŒä¸ªæ˜¯ ReentrantLock æä¾› å…¬å¹³é” å’Œ éå…¬å¹³é”çš„é€‰æ‹©ï¼Œä½†æ˜¯ syncronized ä¸æä¾›ï¼›ç¬¬ä¸‰ä¸ªæ˜¯ ReentrantLockæœ‰ lockInterruptibly() æ–¹æ³•ï¼Œæä¾›ä¼˜å…ˆå“åº”ä¸­æ–­ï¼Œå°±æ˜¯å½“çº¿ç¨‹æ­£åœ¨ç­‰å¾…æ—¶ï¼Œå¯ä»¥è°ƒç”¨è¿™ä¸ªç­‰å¾…çº¿ç¨‹çš„ Thread.interrupt()ï¼Œåœæ­¢ç­‰å¾…ï¼Œç›´æ¥è¿”å›ã€‚ ReentrantLock æ˜¯ä¸€ä¸ªç±»ï¼Œjdkå±‚é¢å®ç°ï¼Œè€Œ syncronized åˆ™æ˜¯ jvmå±‚é¢å®ç°ï¼Œæ˜¯ä¸€ä¸ªå…³é”®å­—ï¼› å½“ç„¶äº†ï¼Œéƒ½æ˜¯å¯é‡å…¥é”ï¼Œè€Œä¸”ç°åœ¨ syncronized çš„æ€§èƒ½å·²ç»åŸºæœ¬æŒå¹³ ReentrantLock äº†ã€‚ Qï¼šçº¿ç¨‹æ± æœ‰å“ªäº›å‚æ•°ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆç”¨ï¼Ÿå¦‚æœä»»åŠ¡æ•°è¶…è¿‡çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿé˜»å¡é˜Ÿåˆ—å¤§å°æ˜¯å¤šå°‘ï¼Ÿ ã€ŒGet!!!ã€ çº¿ç¨‹æ± çš„å‚æ•°æœ‰ corePoolSizeï¼ˆçº¿ç¨‹æ± æ ¸å¿ƒæ•°ï¼‰ã€çº¿ç¨‹æœ€å¤§æ•°ï¼ˆmaxmiumPoolSizeï¼‰ã€é˜»å¡é˜Ÿåˆ—(worQueue)ã€keepAliveTime(çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´)ã€çº¿ç¨‹å·¥å‚ï¼ˆThreadFactoryï¼‰ã€æ‹’ç»ç­–ç•¥ï¼ˆhandlerï¼‰ã€‚å¦‚æœä»»åŠ¡æ•°è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä¼šå…ˆå°†ä»»åŠ¡æ”¾åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œç„¶åå¦‚æœé˜»å¡é˜Ÿåˆ—æ»¡ï¼Œåˆ™æ‰©å¤§çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—å¤§å°åˆ†ä¸ºæ— ç•Œé˜»å¡é˜Ÿåˆ—å’Œæœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ Qï¼šåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ€ä¹ˆé€‰æ‹©æœ€ä¼˜çš„çº¿ç¨‹æ•°é‡å‘¢ï¼Ÿé€‰æ‹©åŸåˆ™åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿçº¿ç¨‹æ•°æ˜¯ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Ÿ ã€ŒGet!!!ã€ é€‰æ‹©çº¿ç¨‹æ± çš„æ•°é‡éœ€è¦ä» CPU çš„è§’åº¦è€ƒè™‘ï¼Œå› ä¸ºè€ƒè™‘ä¸€ä¸ªç³»ç»Ÿçš„ååé‡ä¸Šé™å°±æ˜¯CPUï¼Œå……åˆ†åˆ©ç”¨ cpu æ˜¯å…³é”®ã€‚CPUå¯†é›†å‹åº”ç”¨ï¼Œåˆ™çº¿ç¨‹æ± å¤§å°è®¾ç½®ä¸ºN+1ï¼ˆç”±äºcpuå¾ˆå¿™ï¼Œæ‰€ä»¥é¢å¤–çš„åˆ‡æ¢ä¸Šä¸‹æ–‡éå¸¸çš„æ¶ˆè€—èµ„æºï¼Œæ‰€ä»¥ä¸€ä¸ªçº¿ç¨‹å¹²æ´»å¯¹åº”ä¸€æ ¸cpuå³å¯ï¼Œå¤šçš„é‚£ä¸€ä¸ªæ˜¯ä¸ºäº†é˜²æ­¢æŸä¸ªçº¿ç¨‹å¤±è´¥æˆ–è€…æŒ‚èµ·å¯¼è‡´æµªè´¹cpuæ—¶é’Ÿï¼‰ï¼ŒIOå¯†é›†å‹ï¼Œçº¿ç¨‹æ± å¤§å°æ˜¯ 2N+1,å‡†ç¡®çš„è¯´æ˜¯ æœ€ä½³çº¿ç¨‹æ•°ç›® = ï¼ˆï¼ˆçº¿ç¨‹ç­‰å¾…æ—¶é—´+çº¿ç¨‹CPUæ—¶é—´ï¼‰/çº¿ç¨‹CPUæ—¶é—´ ï¼‰* CPUæ•°ç›®ï¼Œæ··åˆå‹çš„è¯å°±å°†äºŒè€…ç»“åˆå°±å¥½ã€‚å½“ç„¶ï¼Œè¦æƒ³æé«˜ç³»ç»Ÿååé‡ï¼ŒçœŸæ­£çš„æ˜¯è¦å»è§£å†³çŸ­æ¿æ•ˆåº”ï¼Œä¹Ÿå°±æ˜¯ I/Oï¼Œå¯ä»¥å°†å…¶å˜ä¸º NIO ä¹‹ç±»çš„ã€‚ çº¿ç¨‹æ•°è‚¯å®šä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œé¦–å…ˆ cpu å°±é‚£å‡ ä¸ªï¼Œå¹¶è¡Œçš„ä¹Ÿå°±é‚£å‡ ä¸ªï¼ŒåŠ ä¸Šåˆ‡æ¢çº¿ç¨‹ä¸Šä¸‹æ–‡ä¹Ÿæ˜¯éœ€è¦æ¶ˆè€—çš„ã€‚ https://www.cnblogs.com/jpfss/p/10967703.html Qï¼šæœ‰å“ªäº›æ¯”è¾ƒå¥½çš„çº¿ç¨‹æ± ï¼Œå„è‡ªçš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ ã€ŒGet!!!ã€ å››å¤§çº¿ç¨‹æ±  ä¸‹é¢æœ‰å†™ Qï¼šæ€ä¹ˆå®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨ï¼Ÿ ã€ŒGet!!!ã€ ä½¿ç”¨åŠ é”çš„æ–¹å¼ï¼Œsynchronized or ReentrantLock éƒ½å¯ä»¥ï¼Œæˆ–è€…ä½¿ç”¨ juc åŒ…ä¸‹çš„ Atomic åŸå­ç±»ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ 123456789101112131415161718&gt; public class Count1 &#123;&gt; // 1. ä½¿ç”¨ synchronizedï¼Œç”¨ä¸ç”¨ volatile éƒ½æ˜¯å¯ä»¥çš„&gt; private static int a = 0;&gt; &gt; public static void main(String[] args) &#123;&gt; final ExecutorService executorService = Executors.newCachedThreadPool();&gt; // å¯åŠ¨1000ä¸ªçº¿ç¨‹&gt; for (int i = 0; i &lt; 1000; i++) &#123;&gt; executorService.execute(() -&gt; count());&gt; &#125;&gt; executorService.shutdown();&gt; System.out.println(a);&gt; &#125;&gt; private static synchronized void count() &#123;&gt; a++;&gt; &#125;&gt; &#125;&gt; 123456789101112131415161718192021222324252627&gt; class Count2 &#123;&gt; // 1. ä½¿ç”¨ volatile + ReentrantLock&gt; // ä¸ç”¨ volatile ä¹Ÿæ˜¯å¯ä»¥çš„&gt; private static int a = 0;&gt; private static final ReentrantLock lock = new ReentrantLock();&gt; &gt; public static void main(String[] args) &#123;&gt; final ExecutorService executorService = Executors.newCachedThreadPool();&gt; // å¯åŠ¨1000ä¸ªçº¿ç¨‹&gt; for (int i = 0; i &lt; 1000; i++) &#123;&gt; executorService.execute(() -&gt; count());&gt; &#125;&gt; executorService.shutdown();&gt; System.out.println(a);&gt; &#125;&gt; &gt; private static void count() &#123;&gt; try &#123;&gt; lock.lock();&gt; a++;&gt; &#125; finally &#123;&gt; lock.unlock();&gt; &#125;&gt; &gt; &#125;&gt; &#125;&gt; 123456789101112131415&gt; class Count3 &#123;&gt; // 1. ç›´æ¥ä½¿ç”¨ Atomicå°±å¯ä»¥äº†&gt; private static AtomicInteger a = new AtomicInteger(0);&gt; &gt; public static void main(String[] args) &#123;&gt; final ExecutorService executorService = Executors.newCachedThreadPool();&gt; // å¯åŠ¨1000ä¸ªçº¿ç¨‹&gt; for (int i = 0; i &lt; 10000; i++) &#123;&gt; executorService.execute(() -&gt; a.getAndIncrement());&gt; &#125;&gt; executorService.shutdown();&gt; System.out.println(a.get());&gt; &#125;&gt; &#125;&gt; æ¥ç€èŠConcurrentHashMapï¼Œåº•å±‚å®ç° ã€ŒGet!!!ã€ åº•å±‚å®ç°ï¼Ÿ çº¢é»‘æ ‘+æ•°ç»„+é“¾è¡¨ Javaå¤šçº¿ç¨‹äº†è§£ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™ä¸€ä¸ªintï¼Œç±»å‹çš„æ“ä½œæ˜¯ä¸å®‰å…¨çš„ï¼Œè‡ªåŠ å‘¢ï¼Œèµ‹å€¼å‘¢ã€‚å¦‚æœä½¿ç”¨volatileä¿®é¥°çš„è¯æœ‰ä»€ä¹ˆä½œç”¨ã€‚ ã€ŒGet!!!ã€ è‡ªåŠ ï¼Œä¸å®‰å…¨ï¼›èµ‹å€¼ï¼Œå®‰å…¨ã€‚å› ä¸ºå‰è€…æœ‰è¯»å’Œå†™ä¸¤ä¸ªæ“ä½œï¼Œåè€…åªæœ‰å†™æ“ä½œ ç”¨volatile ä¹Ÿä¸€æ ·ï¼Œvolatileä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œå¯ä»¥ä½¿ç”¨åŠ é”æˆ–è€…ä½¿ç”¨ AtomicåŸå­ç±»ã€‚ æœ‰ä¸€ä¸ªåœºæ™¯ï¼Œå¤šçº¿ç¨‹å¹¶å‘ï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹å®‰æ’ä¸€ä¸ªéšæœºçš„ç¡çœ æ—¶é—´ï¼Œè®¾æƒ³ä¸€ç§æ•°æ®ç»“æ„å»å”¤é†’ç¡çœ æ—¶é—´ç»“æŸçš„çº¿ç¨‹ï¼Œåº”è¯¥ç”¨å“ªç§ç»“æ„ ã€ŒGet!!!ã€ åº”è¯¥ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯å°é¡¶å †ï¼Œé¡¶éƒ¨æ˜¯å‰©ä½™ç¡çœ æ—¶é—´æœ€çŸ­çš„é‚£ä¸ªçº¿ç¨‹ã€‚PriorityQueueã€‚ JVM ä½ äº†è§£å“ªäº›æ”¶é›†å™¨ï¼ŸCMSå’ŒG1ã€‚è¯¦ç»†è°ˆè°ˆG1çš„ä¼˜ç‚¹ï¼Ÿä»€ä¹ˆæ—¶å€™è¿›è¡ŒFull GCå‘¢ï¼Ÿ Serial Serial Old ParNew Parllelscatwã€‚ã€‚ã€‚ parallelOld CMS G1 G1ä¼˜ç‚¹ï¼š ä¸åŒºåˆ†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ˜¯è¿ç»­çš„ç©ºé—´ï¼Œç„¶åæ˜¯ä¸€ä¸ªä¸€ä¸ªrezoneè¿›è¡Œç®¡ç†ï¼Œæœ‰ä¸€ä¸ªä¼˜å…ˆçº§çš„æ’åºï¼Œå°±æ˜¯ä¼šæŠŠè¿™ä¸ªrezoneåƒåœ¾æœ€å¤šçš„å…ˆå›æ”¶ï¼Œç„¶åæ˜¯é‡‡ç”¨çš„æ ‡è®°æ•´ç†è§£å†³å†…å­˜çš„ç¢ç‰‡é—®é¢˜ï¼Œå…¼é¡¾äº† CMS ä½å»¶è¿Ÿçš„ä¸€ä¸ªç‰¹æ€§å’Œ Parallel Scavenge é«˜ååç‡çš„ç‰¹æ€§ã€‚ è€å¹´ä»£åŒºåŸŸæ»¡äº†ä¸å°± Full GC äº†å—â€¦ æ¶ˆæ¯ä¸­é—´ä»¶springå…¨å®¶æ¡¶ Springä¸­æ¶‰åŠçš„ä¸€äº›è®¾è®¡æ¨¡å¼ èŠèŠSpringï¼Œä¸»è¦IOCç­‰ç­‰ æ•°æ®åº“ MySQLåˆ›å»ºç´¢å¼•çš„åŸåˆ™ï¼Œå¥½å¤„ æ•°æ®åº“ç´¢å¼•ï¼Œç´¢å¼•åº•å±‚çš„å®ç°ï¼ŒB+æ ‘çš„ç»“æ„ä»¥åŠä¸æ™®é€šæŸ¥æ‰¾æ ‘çš„ä¼˜ç‚¹ MySQLå’Œredisçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ ä¸ºä»€ä¹ˆMySQLå’ŒRediséƒ½è¦ä½¿ç”¨ç‹¬ç«‹è¿›ç¨‹æ¥éƒ¨ç½²ï¼Œå¼€æ”¾ç«¯å£æ¥æä¾›æœåŠ¡ï¼Œä¸ºä»€ä¹ˆä¸å†™åœ¨å†…æ ¸ä¸­ã€‚ å…¶ä»– è®¾è®¡æ¨¡å¼ï¼šè®²äº†å•ä¾‹ï¼Œå·¥å‚æ–¹æ³•ï¼ŒæŠ½è±¡å·¥å‚ï¼Œç­–ç•¥æ¨¡å¼ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ï¼Œä»£ç†æ¨¡å¼ï¼Œè¿˜é¡ºä¾¿è®²äº†ä¸‹springåŠ¨æ€ä»£ç†çš„å®ç°åŸç† çº¢é»‘æ ‘çš„å…·ä½“ç»“æ„åŠå®ç°ï¼Œçº¢é»‘æ ‘ä¸æŸ¥æ‰¾æ ‘çš„åŒºåˆ«ä½“ç° è¿™ä¸ªæˆ‘ä¼šâ€¦å¤ä¹ ä¸€æ³¢ é¡¹ç›®ä¸­ç”¨åˆ°dubboï¼Ÿé‚£ä½ è¯´è¯´ä»€ä¹ˆæ˜¯rpcæ¡†æ¶ï¼Ÿå’Œhttpè°ƒç”¨çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ Redisæœ‰å“ªäº›æ•°æ®ç»“æ„ï¼ŸæŒä¹…åŒ–æ–¹æ¡ˆå’ŒåŒºåˆ«ï¼Ÿ Rediså“¨å…µã€é›†ç¾¤çš„è®¾è®¡åŸç†å’ŒåŒºåˆ«ï¼Ÿ Redisç¼“å­˜å’Œæ•°æ®åº“ä¼šå­˜åœ¨ä¸€è‡´æ€§é—®é¢˜å—ï¼Ÿæ€ä¹ˆè§£å†³ Kafkaæ€ä¹ˆä¿è¯æ•°æ®å¯é æ€§ï¼Ÿè®²äº†ç”Ÿäº§è€…ç«¯å‘é€æ¶ˆæ¯åˆ°brokeræŒä¹…åŒ–ï¼Œåˆ†åŒºå’Œå‰¯æœ¬æœºåˆ¶ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯çš„at-least-onceå’Œat-most-onceï¼Ÿæ€ä¹ˆå®ç°Exactly-Onceï¼Ÿ å­—èŠ‚ç¯‡æ•°æ®ç»“æ„æ“ä½œç³»ç»Ÿ ç”¨æˆ·æ€å¦‚ä½•åˆ‡æ¢åˆ°å†…æ ¸æ€ è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼ï¼Œå“ªç§æœ€å¿« è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼ŒInterProcess Communicationï¼‰æ˜¯æŒ‡åœ¨ä¸åŒè¿›ç¨‹ä¹‹é—´ä¼ æ’­æˆ–äº¤æ¢ä¿¡æ¯ã€‚ IPCçš„æ–¹å¼é€šå¸¸æœ‰ç®¡é“ï¼ˆåŒ…æ‹¬æ— åç®¡é“å’Œå‘½åç®¡é“ï¼‰ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡ã€å…±äº«å­˜å‚¨ã€Socketã€Streamsç­‰ã€‚å…¶ä¸­ Socketå’ŒStreamsæ”¯æŒä¸åŒä¸»æœºä¸Šçš„ä¸¤ä¸ªè¿›ç¨‹IPCã€‚ 1.è¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼šå…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ã€‚çº¿ç¨‹ï¼šè¿›ç¨‹çš„ä¸€ä¸ªå®ä½“ã€‚æ¯”å–»ï¼šä¸€åˆ—ç«è½¦æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œç«è½¦çš„æ¯ä¸€èŠ‚è½¦å¢æ˜¯çº¿ç¨‹ã€‚ 2.è¿›ç¨‹ä¸çº¿ç¨‹çš„è”ç³» â‘ ä¸€ä¸ªçº¿ç¨‹åªèƒ½å±äºä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼›â‘¡ç³»ç»Ÿèµ„æºåˆ†é…ç»™è¿›ç¨‹ï¼ŒåŒä¸€è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹çš„æ‰€æœ‰èµ„æºï¼›â‘¢çœŸæ­£åœ¨å¤„ç†æœºä¸Šè¿è¡Œçš„æ˜¯çº¿ç¨‹ï¼›â‘£ä¸åŒè¿›ç¨‹çš„çº¿ç¨‹é—´åˆ©ç”¨æ¶ˆæ¯é€šä¿¡çš„æ–¹å¼å®ç°åŒæ­¥ã€‚ 3.è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ« â‘ è°ƒåº¦ï¼šçº¿ç¨‹æ˜¯ç³»ç»Ÿè°ƒåº¦å’Œåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œè¿›ç¨‹æ˜¯ä½œä¸ºæ‹¥æœ‰ç³»ç»Ÿèµ„æºçš„åŸºæœ¬å•ä½ï¼›â‘¡å¹¶å‘æ€§ï¼šè¿›ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œï¼ŒåŒä¸€è¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹æ—¶é—´äº¦å¯ä»¥å¹¶å‘æ‰§è¡Œï¼›â‘¢æ‹¥æœ‰èµ„æºï¼šè¿›ç¨‹æ˜¯æ‹¥æœ‰èµ„æºçš„ç‹¬ç«‹å•ä½ï¼Œçº¿ç¨‹ä¸æ‹¥æœ‰èµ„æºï¼Œä½†å¯ä»¥è®¿é—®éš¶å±äºè¿›ç¨‹çš„èµ„æºï¼›â‘£ç³»ç»Ÿå¼€é”€ï¼šåˆ›å»ºå’Œæ’¤é”€è¿›ç¨‹çš„å¼€é”€æ›´å¤§ï¼›è¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹çš„å´©æºƒä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹ï¼›çº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡ï¼Œæ²¡æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œå› æ­¤è¿›ç¨‹é‡Œçš„ä¸€ä¸ªçº¿ç¨‹å´©æºƒä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹å‡å´©æºƒã€‚ 4.è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ è¿›ç¨‹é—´é€šä¿¡æ–¹å¼æœ‰å¾ˆå¤šï¼Œç½‘ä¸Šä¸€è¯´æœ‰åå‡ ç§ã€‚é¢è¯•çš„æ—¶å€™è¯´ä¸Šä»¥ä¸‹å‡ ç§å·®ä¸å¤šï¼šâ‘ ç®¡é“ï¼šåŠåŒå·¥çš„é€šä¿¡æ–¹å¼ï¼Œæ•°æ®åªèƒ½å•å‘æµåŠ¨ï¼Œä¸”åªèƒ½åœ¨æœ‰äº²ç¼˜å…³ç³»ï¼ˆçˆ¶å­è¿›ç¨‹æˆ–å…„å¼Ÿè¿›ç¨‹ï¼‰çš„è¿›ç¨‹é—´ä½¿ç”¨ï¼›â‘¡å‘½åç®¡é“ï¼šFIFOï¼ŒåŠåŒå·¥çš„é€šä¿¡æ–¹å¼ï¼Œä½†å…è®¸åœ¨æ— äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡ï¼›â‘¢æ¶ˆæ¯é˜Ÿåˆ—ï¼šæ¶ˆæ¯çš„é“¾è¡¨ï¼Œå­˜æ”¾åœ¨å†…æ ¸ä¸­ï¼Œå¹¶ç”±æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦æ ‡è¯†ã€‚æ¶ˆæ¯é˜Ÿåˆ—å…‹æœäº†ä¿¡å·ä¼ é€’ä¿¡æ¯å°‘ã€ç®¡é“åªèƒ½æ‰¿è½½æ— æ ¼å¼å­—èŠ‚æµä»¥åŠç¼“å†²åŒºå¤§å°å—é™ç­‰ç¼ºç‚¹ï¼›â‘£ä¿¡å·é‡ï¼šæ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºæ§åˆ¶å¤šä¸ªè¿›ç¨‹é—´å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼›â‘¤å…±äº«å†…å­˜ï¼šæ˜ å°„ä¸€æ®µèƒ½è¢«å…¶ä»–è¿›ç¨‹è®¿é—®çš„å†…å­˜ï¼Œè¿™æ®µå†…å­˜ç”±ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºï¼Œä½†å¤šä¸ªè¿›ç¨‹éƒ½å¯ä»¥è®¿é—®ï¼›ã€Œæœ€å¿«ï¼Œå¯ä»¥è”ç³»åˆ°é›¶æ‹·è´æŠŠ mmapã€â‘¥å¥—æ¥å­— 5.çº¿ç¨‹é—´é€šä¿¡æ–¹å¼ å¤šä¸ªçº¿ç¨‹åœ¨å¤„ç†åŒä¸€ä¸ªèµ„æºï¼Œå¹¶ä¸”ä»»åŠ¡ä¸åŒæ—¶ï¼Œéœ€è¦çº¿ç¨‹é€šä¿¡æ¥å¸®åŠ©è§£å†³çº¿ç¨‹ä¹‹é—´å¯¹åŒä¸€ä¸ªå˜é‡çš„ä½¿ç”¨æˆ–æ“ä½œã€‚å°±æ˜¯å¤šä¸ªçº¿ç¨‹åœ¨æ“ä½œåŒä¸€ä»½æ•°æ®æ—¶ï¼Œ é¿å…å¯¹åŒä¸€å…±äº«å˜é‡çš„äº‰å¤ºã€‚â‘ é”æœºåˆ¶ï¼šåŒ…æ‹¬äº’æ–¥é”ã€æ¡ä»¶å˜é‡ã€è¯»å†™é” äº’æ–¥é”æä¾›äº†ä»¥æ’ä»–æ–¹å¼é˜²æ­¢æ•°æ®ç»“æ„è¢«å¹¶å‘ä¿®æ”¹çš„æ–¹æ³•ã€‚è¯»å†™é”å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å…±äº«æ•°æ®ï¼Œè€Œå¯¹å†™æ“ä½œæ˜¯äº’æ–¥çš„ã€‚æ¡ä»¶å˜é‡å¯ä»¥ä»¥åŸå­çš„æ–¹å¼é˜»å¡è¿›ç¨‹ï¼Œç›´åˆ°æŸä¸ªç‰¹å®šæ¡ä»¶ä¸ºçœŸä¸ºæ­¢ã€‚å¯¹æ¡ä»¶çš„æµ‹è¯•æ˜¯åœ¨äº’æ–¥é”çš„ä¿æŠ¤ä¸‹è¿›è¡Œçš„ã€‚æ¡ä»¶å˜é‡å§‹ç»ˆä¸äº’æ–¥é”ä¸€èµ·ä½¿ç”¨ã€‚â‘¡ä¿¡å·é‡æœºåˆ¶(Semaphore)ï¼šåŒ…æ‹¬æ— åçº¿ç¨‹ä¿¡å·é‡å’Œå‘½åçº¿ç¨‹ä¿¡å·é‡â‘¢ä¿¡å·æœºåˆ¶(Signal)ï¼šç±»ä¼¼è¿›ç¨‹é—´çš„ä¿¡å·å¤„ç†çº¿ç¨‹é—´çš„é€šä¿¡ç›®çš„ä¸»è¦æ˜¯ç”¨äºçº¿ç¨‹åŒæ­¥ï¼Œæ‰€ä»¥çº¿ç¨‹æ²¡æœ‰åƒè¿›ç¨‹é€šä¿¡ä¸­çš„ç”¨äºæ•°æ®äº¤æ¢çš„é€šä¿¡æœºåˆ¶ã€‚â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œå†¯Jungleã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/sinat_21107433/article/details/82809946 ä¿¡å·é‡æ€ä¹ˆå®ç°å¯¹å…±äº«èµ„æºçš„è®¿é—® ã€ŒGet!!!ã€ semphoreï¼Œå…±äº«é”åŠ ä¸€ä¸ªè®¿é—®æ•°é‡çš„é™åˆ¶ï¼Œä¸»ä½“è¿˜æ˜¯ AQS çš„å…±äº«é”å®ç°ï¼Œè¶…è¿‡äº†ä¿¡å·é‡çš„å€¼å°±åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ç­‰å¾…ï¼Œè¿™é‡Œçš„ç­‰å¾…é˜Ÿåˆ—å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ Queueï¼Œä¸åƒAQSä¸­çš„ CLH é˜Ÿåˆ—ã€‚ selectå’Œepoll åœ¨Linux SocketæœåŠ¡å™¨çŸ­ç¼–ç¨‹æ—¶ï¼Œä¸ºäº†å¤„ç†å¤§é‡å®¢æˆ·çš„è¿æ¥è¯·æ±‚ï¼Œéœ€è¦ä½¿ç”¨éé˜»å¡I/Oå’Œå¤ç”¨ï¼Œselectã€pollå’Œepollæ˜¯Linux APIæä¾›çš„I/Oå¤ç”¨æ–¹å¼ï¼Œè‡ªä»Linux 2.6ä¸­åŠ å…¥äº†epollä¹‹åï¼Œåœ¨é«˜æ€§èƒ½æœåŠ¡å™¨é¢†åŸŸå¾—åˆ°å¹¿æ³›çš„åº”ç”¨ï¼Œç°åœ¨æ¯”è¾ƒå‡ºåçš„nginxå°±æ˜¯ä½¿ç”¨epollæ¥å®ç°I/Oå¤ç”¨æ”¯æŒé«˜å¹¶å‘ï¼Œç›®å‰åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œnginxè¶Šæ¥è¶Šæ”¶åˆ°æ¬¢è¿ã€‚ (1)select==&gt;æ—¶é—´å¤æ‚åº¦O(n) å®ƒä»…ä»…çŸ¥é“äº†ï¼Œæœ‰I/Oäº‹ä»¶å‘ç”Ÿäº†ï¼Œå´å¹¶ä¸çŸ¥é“æ˜¯å“ªé‚£å‡ ä¸ªæµï¼ˆå¯èƒ½æœ‰ä¸€ä¸ªï¼Œå¤šä¸ªï¼Œç”šè‡³å…¨éƒ¨ï¼‰ï¼Œæˆ‘ä»¬åªèƒ½æ— å·®åˆ«è½®è¯¢æ‰€æœ‰æµï¼Œæ‰¾å‡ºèƒ½è¯»å‡ºæ•°æ®ï¼Œæˆ–è€…å†™å…¥æ•°æ®çš„æµï¼Œå¯¹ä»–ä»¬è¿›è¡Œæ“ä½œã€‚æ‰€ä»¥selectå…·æœ‰O(n)çš„æ— å·®åˆ«è½®è¯¢å¤æ‚åº¦ï¼ŒåŒæ—¶å¤„ç†çš„æµè¶Šå¤šï¼Œæ— å·®åˆ«è½®è¯¢æ—¶é—´å°±è¶Šé•¿ã€‚ (2)poll==&gt;æ—¶é—´å¤æ‚åº¦O(n) pollæœ¬è´¨ä¸Šå’Œselectæ²¡æœ‰åŒºåˆ«ï¼Œå®ƒå°†ç”¨æˆ·ä¼ å…¥çš„æ•°ç»„æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œç„¶åæŸ¥è¯¢æ¯ä¸ªfdå¯¹åº”çš„è®¾å¤‡çŠ¶æ€ï¼Œ ä½†æ˜¯å®ƒæ²¡æœ‰æœ€å¤§è¿æ¥æ•°çš„é™åˆ¶ï¼ŒåŸå› æ˜¯å®ƒæ˜¯åŸºäºé“¾è¡¨æ¥å­˜å‚¨çš„. (3)epoll==&gt;æ—¶é—´å¤æ‚åº¦O(1) epollå¯ä»¥ç†è§£ä¸ºevent pollï¼Œä¸åŒäºå¿™è½®è¯¢å’Œæ— å·®åˆ«è½®è¯¢ï¼Œepollä¼šæŠŠå“ªä¸ªæµå‘ç”Ÿäº†æ€æ ·çš„I/Oäº‹ä»¶é€šçŸ¥æˆ‘ä»¬ã€‚æ‰€ä»¥æˆ‘ä»¬è¯´epollå®é™…ä¸Šæ˜¯äº‹ä»¶é©±åŠ¨ï¼ˆæ¯ä¸ªäº‹ä»¶å…³è”ä¸Šfdï¼‰çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯¹è¿™äº›æµçš„æ“ä½œéƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚ï¼ˆå¤æ‚åº¦é™ä½åˆ°äº†O(1)ï¼‰ selectï¼Œpollï¼Œepolléƒ½æ˜¯IOå¤šè·¯å¤ç”¨çš„æœºåˆ¶ã€‚I/Oå¤šè·¯å¤ç”¨å°±é€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥ç›‘è§†å¤šä¸ªæè¿°ç¬¦ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ªï¼‰ï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œã€‚ä½†selectï¼Œpollï¼Œepollæœ¬è´¨ä¸Šéƒ½æ˜¯åŒæ­¥I/Oï¼Œå› ä¸ºä»–ä»¬éƒ½éœ€è¦åœ¨è¯»å†™äº‹ä»¶å°±ç»ªåè‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¯»å†™è¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œè€Œå¼‚æ­¥I/Oåˆ™æ— éœ€è‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œå¼‚æ­¥I/Oçš„å®ç°ä¼šè´Ÿè´£æŠŠæ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚ è®¡ç®—æœºç½‘ç»œ TCPçš„æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ ä¸€ã€æµé‡æ§åˆ¶ 1.ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶ Sender wonâ€™t overflow receiverâ€™s buffer by transmitting too much, too fast. ï¼ˆé˜²æ­¢å‘é€æ–¹å‘çš„å¤ªå¿«ï¼Œè€—å°½æ¥æ”¶æ–¹çš„èµ„æºï¼Œä»è€Œä½¿æ¥æ”¶æ–¹æ¥ä¸åŠå¤„ç†ï¼‰2.æµé‡æ§åˆ¶çš„ä¸€äº›çŸ¥è¯†ç‚¹ ï¼ˆ1ï¼‰æ¥æ”¶ç«¯æŠ‘åˆ¶å‘é€ç«¯çš„ä¾æ®ï¼šæ¥æ”¶ç«¯ç¼“å†²åŒºçš„å¤§å°ï¼ˆ2ï¼‰æµé‡æ§åˆ¶çš„ç›®æ ‡æ˜¯æ¥æ”¶ç«¯ï¼Œæ˜¯æ€•æ¥æ”¶ç«¯æ¥ä¸åŠå¤„ç†ï¼ˆ3ï¼‰æµé‡æ§åˆ¶çš„æœºåˆ¶æ˜¯ä¸¢åŒ…3.æ€ä¹ˆæ ·å®ç°æµé‡æ§åˆ¶ï¼Ÿ ä½¿ç”¨æ»‘åŠ¨çª—å£æ»‘åŠ¨çª—å£1.æ»‘åŠ¨çª—å£æ˜¯ä»€ä¹ˆï¼Ÿæ»‘åŠ¨çª—å£æ˜¯ç±»ä¼¼äºä¸€ä¸ªçª—å£ä¸€æ ·çš„ä¸œè¥¿ï¼Œæ˜¯ç”¨æ¥å‘Šè¯‰å‘é€ç«¯å¯ä»¥å‘é€æ•°æ®çš„å¤§å°æˆ–è€…è¯´æ˜¯çª—å£æ ‡è®°äº†æ¥æ”¶ç«¯ç¼“å†²åŒºçš„å¤§å°ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°psï¼šçª—å£æŒ‡çš„æ˜¯ä¸€æ¬¡æ‰¹é‡çš„å‘é€å¤šå°‘æ•°æ®2.ä¸ºä»€ä¹ˆä¼šå‡ºç°æ»‘åŠ¨çª—å£ï¼Ÿ åœ¨ç¡®è®¤åº”ç­”ç­–ç•¥ä¸­ï¼Œå¯¹æ¯ä¸€ä¸ªå‘é€çš„æ•°æ®æ®µï¼Œéƒ½è¦ç»™ä¸€ä¸ªACKç¡®è®¤åº”ç­”ï¼Œæ”¶åˆ°ACKåå†å‘é€ä¸‹ä¸€ä¸ªæ•°æ®æ®µï¼Œè¿™æ ·åšæœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç¼ºç‚¹ï¼Œå°±æ˜¯æ€§èƒ½æ¯”è¾ƒå·®ï¼Œå°¤å…¶æ˜¯æ•°æ®å¾€è¿”çš„æ—¶é—´é•¿çš„æ—¶å€™ä½¿ç”¨æ»‘åŠ¨çª—å£ï¼Œå°±å¯ä»¥ä¸€æ¬¡å‘é€å¤šæ¡æ•°æ®ï¼Œä»è€Œå°±æé«˜äº†æ€§èƒ½3.æ»‘åŠ¨çª—å£çš„ä¸€äº›çŸ¥è¯†ç‚¹ ï¼ˆ1ï¼‰æ¥æ”¶ç«¯å°†è‡ªå·±å¯ä»¥æ¥æ”¶çš„ç¼“å†²åŒºå¤§å°æ”¾å…¥TCPé¦–éƒ¨ä¸­çš„â€œçª—å£å¤§å°â€å­—æ®µï¼Œé€šè¿‡ACKæ¥é€šçŸ¥å‘é€ç«¯ï¼ˆ2ï¼‰çª—å£å¤§å°å­—æ®µè¶Šå¤§ï¼Œè¯´æ˜ç½‘ç»œçš„ååç‡è¶Šé«˜ï¼ˆ3ï¼‰çª—å£å¤§å°æŒ‡çš„æ˜¯æ— éœ€ç­‰å¾…ç¡®è®¤åº”ç­”è€Œå¯ä»¥ç»§ç»­å‘é€æ•°æ®çš„æœ€å¤§å€¼ï¼Œå³å°±æ˜¯è¯´ä¸éœ€è¦æ¥æ”¶ç«¯çš„åº”ç­”ï¼Œå¯ä»¥ä¸€æ¬¡è¿ç»­çš„å‘é€æ•°æ®ï¼ˆ4ï¼‰æ“ä½œç³»ç»Ÿå†…æ ¸ä¸ºäº†ç»´æŠ¤æ»‘åŠ¨çª—å£ï¼Œéœ€è¦å¼€è¾Ÿå‘é€ç¼“å†²åŒºï¼Œæ¥è®°å½•å½“å‰è¿˜æœ‰é‚£äº›æ•°æ®æ²¡æœ‰åº”ç­”ï¼Œåªæœ‰ç¡®è®¤åº”ç­”è¿‡çš„æ•°æ®ï¼Œæ‰èƒ½ä»ç¼“å†²åŒºåˆ æ‰psï¼šå‘é€ç¼“å†²åŒºå¦‚æœå¤ªå¤§ï¼Œå°±ä¼šæœ‰ç©ºé—´å¼€é”€ äºŒã€æ‹¥å¡æ§åˆ¶ æ…¢å¼€å§‹( slow-start )ã€æ‹¥å¡é¿å…( congestion avoidance )ã€å¿«é‡ä¼ ( fast retransmit )å’Œå¿«æ¢å¤( fast recovery )ã€‚ ã€Œä¹˜æ³•å‡å°‘ï¼ŒåŠ æ³•å¢åŠ ã€ ä¸‰ã€æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶çš„åŒºåˆ«1.ç›¸åŒç‚¹ ï¼ˆ1ï¼‰ç°è±¡éƒ½æ˜¯ä¸¢åŒ…ï¼›ï¼ˆ2ï¼‰å®ç°æœºåˆ¶éƒ½æ˜¯è®©å‘é€æ–¹å‘çš„æ…¢ä¸€ç‚¹ï¼Œå‘çš„å°‘ä¸€ç‚¹2.ä¸åŒç‚¹ ï¼ˆ1ï¼‰ä¸¢åŒ…ä½ç½®ä¸åŒæµé‡æ§åˆ¶ä¸¢åŒ…ä½ç½®æ˜¯åœ¨æ¥æ”¶ç«¯ä¸Šæ‹¥å¡æ§åˆ¶ä¸¢åŒ…ä½ç½®æ˜¯åœ¨è·¯ç”±å™¨ä¸Šï¼ˆ2ï¼‰ä½œç”¨çš„å¯¹è±¡ä¸åŒæµé‡æ§åˆ¶çš„å¯¹è±¡æ˜¯æ¥æ”¶æ–¹ï¼Œæ€•å‘é€æ–¹å‘çš„å¤ªå¿«ï¼Œä½¿å¾—æ¥æ”¶æ–¹æ¥ä¸åŠå¤„ç†æ‹¥å¡æ§åˆ¶çš„å¯¹è±¡æ˜¯ç½‘ç»œï¼Œæ€•å‘é€å‘å‘çš„å¤ªå¿«ï¼Œé€ æˆç½‘ç»œæ‹¥å¡ï¼Œä½¿å¾—ç½‘ç»œæ¥ä¸åŠå¤„ç†3.è”ç³»æ‹¥å¡æ§åˆ¶ æ‹¥å¡æ§åˆ¶é€šå¸¸è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå…¨å±€æ€§çš„è¿‡ç¨‹ï¼Œå®ƒä¼šæ¶‰åŠåˆ°ç½‘ç»œä¸­æ‰€æœ‰çš„ä¸»æœºã€ æ‰€æœ‰çš„è·¯ç”±å™¨å’Œé™ä½ç½‘ç»œä¼ è¾“æ€§èƒ½çš„æ‰€æœ‰å› ç´ æµé‡æ§åˆ¶ æµé‡æ§åˆ¶å‘ç”Ÿåœ¨å‘é€ç«¯å’Œæ¥æ”¶ç«¯ä¹‹é—´ï¼Œåªæ˜¯ç‚¹åˆ°ç‚¹ä¹‹é—´çš„æ§åˆ¶ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œdangzhangjing97ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/dangzhangjing97/article/details/81008836 ä¸åŒå­ç½‘å¯ä»¥é€šè¿‡ARPè·å–macåœ°å€å— æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€åˆ°è·å¾—é¡µé¢çš„å…¨è¿‡ç¨‹ è¾“å…¥ www.baidu.comï¼Œæ€ä¹ˆå˜æˆ https://www.baidu.com çš„ï¼Œæ€ä¹ˆç¡®å®šç”¨HTTPè¿˜æ˜¯HTTPS ä¸‰æ¬¡æ¡æ‰‹ æ¡æ‰‹æ—¶äº§ç”Ÿçš„åºåˆ—å·å¹²ä»€ä¹ˆç”¨çš„ è®²ä¸€ä¸‹æ¥æ”¶çª—å£ TCPå’ŒUDPçš„æœ¬è´¨åŒºåˆ« ä»€ä¹ˆæ—¶å€™é€‰æ‹©TCP/UDP HTTPSçš„è¿æ¥è¿‡ç¨‹ 7å±‚æ¨¡å‹å’Œ4å±‚æ¨¡å‹ï¼Œæ¯ä¸€å±‚æœ‰å“ªäº›å¸¸è§åè®®ï¼Ÿ è·¯ç”±å™¨/äº¤æ¢æœºæ˜¯å“ªä¸€å±‚ ç½‘ç»œå±‚ç”¨æ¥å¹²å˜›ï¼Ÿä¼ è¾“å±‚ç”¨æ¥å¹²å˜›ï¼Ÿ HTTPå¯ä»¥ä½¿ç”¨UDPå— HTTPSæ€ä¹ˆç¡®è®¤æ”¶åˆ°çš„åŒ…å°±æ˜¯æœåŠ¡å™¨å‘æ¥çš„ ç¡®å®šå‘é€çª—å£çš„å¤§å°ï¼Œå¦‚ä½•æœ€å¤§åˆ©ç”¨å¸¦å®½ï¼Œå‡è®¾å»¶è¿Ÿ100msï¼Œå‘é€ç«¯10Mb/sï¼Œæ¥æ”¶ç«¯100Mb/s ç½‘ç»œäº”å±‚æ¨¡å‹ï¼Œæ¯ä¸€å±‚åˆ†åˆ«æœ‰å“ªäº›åè®® ICMPï¼ŒTCPï¼ŒIPï¼ŒHTTPåˆ†åˆ«æ˜¯å“ªä¸€å±‚ï¼Œä¸ºä»€ä¹ˆç½‘ç»œæ¨¡å‹è¦åˆ†å±‚ï¼Œæ¯ä¸€å±‚ä¹‹é—´æ€ä¹ˆä¼ é€’ httpå¤´é‡Œçš„gzip åå‘***è¯´ä¸€ä¸‹ ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡ï¼Œæ¯ä¸€æ¬¡åˆ†åˆ«ç¡®è®¤äº†ä»€ä¹ˆ TCPåè®®çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ï¼Ÿ Tcpæ€ä¹ˆä¿è¯å¯é çš„ ç¡®è®¤é‡ä¼ æœºåˆ¶ï¼› æµé‡æ§åˆ¶ï¼Œæ»‘åŠ¨çª—å£åè®® æ‹¥å¡æ§åˆ¶ï¼šæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é‡ä¼ ã€å¿«æ¢å¤ ç®—æ³• æ±‚xçš„yæ¬¡æ–¹ï¼Œæƒ³å‡ºæ¯”ç›´æ¥forå¾ªç¯æ›´å¥½çš„æ–¹æ¡ˆ æ±‚ç»å¯¹ä¼—æ•° ç®—æ³•é¢˜ï¼šçº¢è“ä¸¤ç§çƒï¼Œæ€»å…±Nä¸ªï¼Œ N&gt;2, æ’åˆ—ç»„åˆï¼Œè¿ç»­3ä¸ªé¢œè‰²ä¸€æ ·æ˜¯éæ³•çš„ï¼Œæ±‚åˆæ³•çš„æ’åˆ—æ•°é‡ æè¿°ä¸€ä¸‹å †æ’çš„è¿‡ç¨‹ï¼Ÿå»ºå †çš„æ—¶é—´å¤æ‚åº¦ï¼Ÿæœ€å¤§å †ä¸­æ±‚å‰kä¸ªæœ€å¤§å€¼çš„æ—¶é—´å¤æ‚åº¦ï¼Ÿ ç®—æ³•é¢˜ï¼šæµ·å²›é¢ç§¯è®¡ç®—é¢˜ï¼Œç»™ä¸€ä¸ªçŸ©é˜µï¼Œ0è¡¨ç¤ºæµ·æ°´ï¼Œç›¸è¿çš„1è¡¨ç¤ºæµ·å²›ï¼Œä¸Šä¸‹å·¦å³è¡¨ç¤ºç›¸è¿ã€‚000111101110001ï¼ˆ1ï¼‰æ±‚æœ€å¤§æµ·å²›é¢ç§¯ã€‚ï¼ˆ2ï¼‰æ±‚æœ€å¤§æµ·å²›é¢ç§¯å’Œå¯¹åº”æµ·å²›çš„æ‰€æœ‰åæ ‡ã€‚ï¼ˆ3ï¼‰æ±‚æ‰€æœ‰æµ·å²›çš„æ‰€æœ‰åæ ‡ï¼ŒæŒ‰æµ·å²›åˆ†ã€‚æ¯å°é¢˜è®²æ€è·¯ï¼Œæœ€åå†™ç¬¬äºŒé¢˜ã€‚ javaåŸºç¡€ Beançš„é»˜è®¤ä½œç”¨èŒƒå›´æ˜¯ä»€ä¹ˆï¼Ÿå…¶ä»–çš„ä½œç”¨èŒƒå›´ï¼Ÿ å¹³å¸¸ç”¨çº¿ç¨‹ä¸»è¦æ˜¯æ€ä¹ˆå†™çš„ï¼Œä¼šç”¨ä¸€äº›çº¿ç¨‹æ¡†æ¶å—ï¼Ÿï¼ˆæ²¡æœ‰ç”¨æ¡†æ¶ï¼‰Javaçº¿ç¨‹æ± çš„æ¦‚å¿µï¼Ÿçº¿ç¨‹æ± æœ‰å“ªäº›ï¼Ÿçº¿ç¨‹æ± å·¥å‚æœ‰å“ªäº›çº¿ç¨‹æ± ç±»å‹ï¼ŒåŠå…¶çº¿ç¨‹æ± å‚æ•°æ˜¯ä»€ä¹ˆï¼Ÿ ç”¨çº¿ç¨‹éƒ½å¯ä»¥å•Šï¼Œçº¿ç¨‹æ±  or ç›´æ¥ new Thread çº¿ç¨‹æ¡†æ¶ Executorä¸­çš„ ThreadPoolExecutorã€FutureTask Fork-join Exchanger Semphore CycliBarrier CountDownLatch çº¿ç¨‹æ± çš„æ¦‚å¿µï¼šå°±æ˜¯ä¼šå¤ç”¨ä¸€å †çº¿ç¨‹ å››ä¸ªä¸»è¦ä½¿ç”¨çš„çº¿ç¨‹æ± ï¼Œ newFixedThreadPoolæ˜¯ä¸€ä¸ªå…¸å‹ä¸”ä¼˜ç§€çš„çº¿ç¨‹æ± ï¼Œå®ƒå…·æœ‰çº¿ç¨‹æ± çš„é«˜æ•ˆç‡å’ŒèŠ‚çœåˆ›å»ºçº¿ç¨‹æ—¶æ‰€è€—çš„å¼€é”€çš„ä¼˜ç‚¹ã€‚ä½†æ˜¯åœ¨çº¿ç¨‹æ± ç©ºé—²æ—¶ï¼Œå³çº¿ç¨‹æ± ä¸­æ²¡æœ‰å¯è¿è¡Œä»»åŠ¡æ—¶ï¼Œå®ƒä¸ä¼šé‡Šæ”¾å·¥ä½œçº¿ç¨‹ï¼Œè¿˜ä¼šå ç”¨ä¸€å®šçš„ç³»ç»Ÿèµ„æºã€‚ä½†æ˜¯æ³¨æ„å…¶åªæœ‰æ ¸å¿ƒçº¿ç¨‹æ± ï¼Œåœ¨çº¿ç¨‹æ± ä¸­æ²¡æœ‰é¢å¤–çš„çº¿ç¨‹ã€‚ä½¿ç”¨çš„æ˜¯ LinkedBlockingQueueã€‚æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿˜è¦æŒ‡å®šæ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ä¸€è‡´ï¼Œè¿™é‡Œçš„ LinkedBlockingQueue æ˜æ˜å°±æ˜¯æ— ç•Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å¯èƒ½ä¼šå»ä½¿ç”¨åˆ°æ ¸å¿ƒçº¿ç¨‹ä»¥å¤–çš„çº¿ç¨‹ã€‚ newCachedThreadPoolçš„ç‰¹ç‚¹å°±æ˜¯åœ¨çº¿ç¨‹æ± ç©ºé—²æ—¶ï¼Œå³çº¿ç¨‹æ± ä¸­æ²¡æœ‰å¯è¿è¡Œä»»åŠ¡æ—¶ï¼Œå®ƒä¼šé‡Šæ”¾å·¥ä½œçº¿ç¨‹ï¼Œä»è€Œé‡Šæ”¾å·¥ä½œçº¿ç¨‹æ‰€å ç”¨çš„èµ„æºã€‚ä½†æ˜¯å½“å‡ºç°æ–°ä»»åŠ¡æ—¶ï¼Œåˆè¦åˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹ï¼Œè¿™ä¼šå¸¦æ¥ä¸€å®šçš„ç³»ç»Ÿå¼€é”€ã€‚å¹¶ä¸”åœ¨ä½¿ç”¨CachedThreadPoolæ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ§åˆ¶ä»»åŠ¡çš„æ•°é‡ï¼Œå¦åˆ™å¤§é‡çº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œå¯èƒ½ä¼šé€ æˆç³»ç»Ÿç˜«ç—ªã€‚ä½¿ç”¨çš„æ˜¯ SynchronousQueueã€‚å› ä¸ºä»–æ˜¯æ— ç•Œçš„ï¼Œå…¶å®ä¹Ÿæ˜¯ç©ºé˜Ÿåˆ—ï¼Œçº¿ç¨‹æ•°æ²¡æœ‰é™åˆ¶ï¼Œä»»åŠ¡æ¥äº†ï¼Œå¦‚æœæ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œç›´æ¥new ä¸€ä¸ªçº¿ç¨‹ã€‚corePoolSizeè®¾ç½®ä¸º0ï¼Œå°†maximumPoolSizeè®¾ç½®ä¸ºInteger.MAX_VALUEã€‚ newScheduledThreadPoolæ˜¯å‘¨æœŸçº¿ç¨‹æ± ã€‚æ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚ä½¿ç”¨çš„æ˜¯ DelayBlockingQueueã€‚ newSingleThreadPoolæ˜¯ä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œã€‚å½“ç„¶å¦‚æœå½“å‰çº¿ç¨‹æ­»äº†ï¼Œä¼šæ–°å»ºä¸€ä¸ªé‡æ–°æ‰§è¡Œä»»åŠ¡ã€‚å°†corePoolSizeå’ŒmaximumPoolSizeéƒ½è®¾ç½®ä¸º1ï¼Œä¹Ÿä½¿ç”¨çš„LinkedBlockingQueueï¼› ConcurrentHashMapè®²ä¸€è®²ï¼Ÿ è®²ä»€ä¹ˆâ€¦ç®€å•çš„è¦æ­»çš„ä¸œè¥¿å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆâ€¦å¥½å­è¿™ç§é—®é¢˜å¥½æ²¡æ„æ€ Java binåŒ…ä¸‹é¢çš„å·¥å…·ç”¨è¿‡å“ªäº›ï¼Ÿ åŒæ­¥IOå’Œå¼‚æ­¥IOçš„åŒºåˆ«ï¼Ÿ çº¿ç¨‹å¦‚ä½•å®ç°åŒæ­¥ï¼Ÿ synchronized lock ConcurrentHashMap åœ¨Java7å’ŒJava8ä¸­çš„åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆJava8å¹¶å‘æ•ˆç‡æ›´å¥½ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ç”¨HashMapï¼Œä»€ä¹ˆæƒ…å†µç”¨ConcurrentHashMapï¼Ÿ å› ä¸ºé”ç²’åº¦æ›´åŠ ç»†ç²’åº¦äº†ï¼Œå¹¶ä¸”ä½¿ç”¨äº†è½»é‡çº§é”ã€åå‘é”ã€‚ çº¿ç¨‹å®‰å…¨ä½¿ç”¨ ConcurrentHashMapï¼Œçº¿ç¨‹ä¸å®‰å…¨ä½¿ç”¨ HashMap åŠ é”æœ‰ä»€ä¹ˆæœºåˆ¶ï¼Ÿ Synchronized lock ThreadLocalï¼Ÿåº”ç”¨åœºæ™¯ï¼Ÿ çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œåº”ç”¨åœºæ™¯ä¸ºå˜é‡æ˜¯çº¿ç¨‹é—´éš”ç¦»ï¼Œçº¿ç¨‹å†…å…¨å±€å˜é‡ä½¿ç”¨ï¼Œè€Œä¸”è¿˜å¯ä»¥åšåˆ°å±€éƒ¨å˜é‡åšä¸åˆ°çš„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è·¨çº¿ç¨‹é€šä¿¡ã€‚ Spring å•ä¾‹beanã€hibernateä¸­çš„sessionç­‰ç­‰éƒ½ä½¿ç”¨äº† ThreadLocalã€‚ å¤šçº¿ç¨‹JVM Java GCæœºåˆ¶ï¼ŸGC Rootsæœ‰å“ªäº›ï¼Ÿ æ¶ˆæ¯ä¸­é—´ä»¶springå…¨å®¶æ¡¶ å¾®æœåŠ¡æ³¨å†Œå‘ç°ï¼Œä¸ºä»€ä¹ˆç”¨å¾®æœåŠ¡ï¼Œgrpcï¼Œprotobufï¼Œdubboè®²ä¸€ä¸‹ IoCæ˜¯ä»€ä¹ˆæ¦‚å¿µï¼Ÿ Webå®¹å™¨ç”¨çš„ä»€ä¹ˆï¼Ÿä½ é¡¹ç›®é‡Œæ¶‰åŠäº†SSMæ¡†æ¶ï¼Œä¸€ä¸ªè¯·æ±‚åˆ°Tomcatå®¹å™¨äº†ï¼Œæ€ä¹ˆåˆ°SSMä»£ç ä¸­å»ï¼Ÿ æ•°æ®åº“ äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ åŸå­æ€§ã€éš”ç¦»æ€§ã€ å››ç§éš”ç¦»çº§åˆ« ä»€ä¹ˆæ˜¯å¹»è¯» InnoDB æ€ä¹ˆé˜²æ­¢å¹»è¯» B+æ ‘åŸç†ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨B+è€Œä¸æ˜¯äºŒå‰å¹³è¡¡æ ‘ 1000ä¸‡ä¸ªobjectçš„æ–‡ä»¶ï¼Œæœ‰ABCä¸‰ä¸ªdate memberï¼Œæ€ä¹ˆæ ¹æ®ABCçš„æ¡ä»¶æŸ¥è¯¢æ¯”è¾ƒå¿« è”åˆç´¢å¼• ç´¢å¼•æ˜¯ä»€ä¹ˆæ¦‚å¿µæœ‰ä»€ä¹ˆä½œç”¨ï¼ŸMySQLé‡Œä¸»è¦æœ‰å“ªäº›ç´¢å¼•ç»“æ„ï¼Ÿå“ˆå¸Œç´¢å¼•å’ŒB+æ ‘ç´¢å¼•æ¯”è¾ƒï¼Ÿ MySQLäº†è§£åˆ°ä»€ä¹ˆç¨‹åº¦ï¼ŸbinLogçŸ¥é“å—ï¼Ÿ å…¶ä»– redisåˆ†å¸ƒå¼é”ä¸¤ç§å®ç° æ€ä¹ˆç†è§£å¾®æœåŠ¡ ä»€ä¹ˆæ˜¯Pythonç”Ÿæˆå™¨ï¼Œè¿­ä»£å™¨ï¼› ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼› æµè§ˆå™¨ç¼“å­˜ã€CPUçš„ç¼“å­˜å’ŒRedisçš„ç¼“å­˜çš„å…³ç³»ï¼Œä¸ºä»€ä¹ˆè¦æœ‰ç¼“å­˜ å…ƒç»„å’Œlistçš„åŒºåˆ«ï¼› Pythonä¸­çš„dictåº•å±‚æ€ä¹ˆå®ç°çš„ listçš„åº•å±‚æ€ä¹ˆå®ç°çš„ï¼› åŒç­‰äºå’Œisæœ‰ä»€ä¹ˆåŒºåˆ« JSONå’ŒprotobufåŒºåˆ« BloomFilterå¹²å˜›çš„ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜ REST apiå’ŒRPC ä¸ºä»€ä¹ˆprotobufæ•ˆç‡æ›´é«˜ï¼ŒJSONç¼ºç‚¹ 1000ä¸‡æ¡ç›¸åŒclassæ ¼å¼objectç»„æˆçš„jsonï¼Œæ€ä¹ˆå‹ç¼© 123456789è®¾è®¡é¢˜ï¼šä¸€ä¸ªæ•°æ®åº“å­˜äº†ä»¥ä¸‹æ•°æ®ï¼šç”¨æˆ·idï¼Œç™»å½•æ—¶é—´ï¼Œç™»å‡ºæ—¶é—´ï¼›å¦‚ä½•æ‰¾åˆ°ä¸€å¤©å½“ä¸­çš„ç”¨æˆ·å³°å€¼ï¼ˆç”¨ä¸€ä¸ªhash mapå­˜æ‰€æœ‰ç§’æ•°çš„åœ¨çº¿äººæ•°ï¼‰ä¸ºä»€ä¹ˆè¦åˆ†ç”¨æˆ·æ€å’Œå†…æ ¸æ€Git åˆ‡æ¢åˆ†æ”¯ï¼Œæäº¤ï¼Œå…·ä½“å¦‚ä½•åˆå¹¶åˆ†æ”¯Pythonå¤šçº¿ç¨‹ç”¨äº†å‡ ä¸ªCPUç®—æ³•ï¼šäºŒå‰æ ‘ï¼Œè¾“å‡ºæ‰€æœ‰å’Œä¸ºnçš„è·¯å¾„ï¼ˆå¯ä»¥ä»ä¸­é—´ç»“ç‚¹åˆ°ä¸­é—´ç»“ç‚¹ï¼‰ é˜¿é‡Œæ•°æ®ç»“æ„æ“ä½œç³»ç»Ÿè®¡ç®—æœºç½‘ç»œç®—æ³• çº¢é»‘æ ‘ã€äºŒå‰æ ‘çš„ç®—æ³• javaåŸºç¡€ Servletè§„èŒƒäº†è§£å—ï¼ŸServletçš„æ•´ä¸ªä¸šåŠ¡æµç¨‹ï¼Ÿsessionå’Œcookieçš„åŒºåˆ«ï¼Ÿsessionæ€ä¹ˆå˜æˆcookieï¼Œæ€ä¹ˆå˜å›sessionï¼Ÿè°æ¥å®ç°æ•´ä¸ªæµç¨‹ï¼Ÿ åˆšæ‰æåˆ°çš„åˆ†å¸ƒå¼å®ç°å¤šä¸ªåº”ç”¨çš„Sessionå…±äº«é—®é¢˜ï¼Ÿ å¤šçº¿ç¨‹JVMæ¶ˆæ¯ä¸­é—´ä»¶springå…¨å®¶æ¡¶ é¡¹ç›®æåˆ°çš„SSMæ¡†æ¶é‡Œé¢äº†è§£å“ªäº›ï¼ŸSpring IoCä¸­Beançš„ç”Ÿå‘½å‘¨æœŸï¼Ÿè°æ¥ç®¡ç†Beançš„ç”Ÿå‘½å‘¨æœŸï¼ŸBeanFactoryå’ŒApplicationContextçš„å…³ç³»ï¼Ÿ@Autowiredå’Œ@Resourceçš„åŒºåˆ«ï¼Ÿ Springçš„è‡ªåŠ¨æ‰«ææ€ä¹ˆå®ç°çš„ï¼Ÿè°å®ç°çš„ï¼Ÿ MyBatisä»‹ç»ä¸€ä¸‹ï¼Ÿä½ è¯´åˆ°è¿™æ˜¯ä¸€ä¸ªæŒä¹…å±‚æ¡†æ¶ï¼Œé‚£ä½ äº†è§£JPAè§„èŒƒå—ï¼Ÿ æ•°æ®åº“å…¶ä»– UMLäº†è§£å—ï¼Ÿï¼ˆä¸ä¼šï¼‰è®¾è®¡æ¨¡å¼ï¼Ÿ Zookeeperäº†è§£å—ï¼Ÿ å•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€***æ¨¡å¼â€¦â€¦å•ä¾‹æ¨¡å¼æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„å—ï¼Ÿï¼ˆå¤šçº¿ç¨‹å¹¶å‘é—®é¢˜ï¼šsynchronized+volatileï¼‰ä½ å†™å•ä¾‹çš„æ—¶å€™å¦‚æœè¿™ä¸ªå•ä¾‹å¯¹è±¡æœ‰å­—æ®µå€¼ï¼Œä½ ä¼šå»æ”¹å˜è¿™äº›å­—æ®µå€¼å—ï¼Ÿä¸ºä»€ä¹ˆå‘¢ï¼Ÿ é¹…å‚æ•°æ®ç»“æ„æ“ä½œç³»ç»Ÿè®¡ç®—æœºç½‘ç»œ httpä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹ HTTPå¸¸è§é”™è¯¯ç ï¼ŸTCPä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ ç®—æ³• æµ·é‡æ•°æ®å¯»æ‰¾TopK æµ·é‡æ•°æ®æ’åº 16Gçš„æ–‡ä»¶å‚¨å­˜çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¦æ±‚åªç”¨1Gå†…å­˜æŠŠä»–ä»¬æ’å¥½åºã€‚ æ’åºç®—æ³•äº†è§£å“ªäº›ï¼ŸJavaé‡Œå†…ç½®çš„æ˜¯ç”¨ä»€ä¹ˆæ’åºæ–¹æ³•ï¼Ÿå¿«æ’æ˜¯ç¨³å®šçš„å—ï¼Ÿå¿«æ’æ’å¯¹è±¡çš„æ—¶å€™æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆæç¤ºæˆ‘ï¼Œä¸‰ä¸ªå­—æ®µï¼Œç¬¬ä¸€ä¸ªå­—æ®µå’Œç¬¬äºŒä¸ªå­—æ®µåšhashï¼Œç¬¬ä¸‰ä¸ªä¸åšï¼Œè¿˜æ˜¯ä¸å¤ªæ‡‚ï¼‰ åäº¿ä¸ªIPï¼Œè·å¾—è®¿é—®æ¬¡æ•°æœ€å¤šçš„åä¸ªã€‚ äº”ä¸ªå•è¯ï¼Œåœ¨ä¸€ä¸ªé•¿æ–‡æœ¬ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ã€‚ å¿«é€Ÿæ’åºç®—æ³• javaåŸºç¡€ Javaä¸­å„ç§é”èŠä¸€ä¸‹ï¼ŒCASæœºåˆ¶ã€‚ stlè¯´ä¸€ä¸‹ï¼ŒmapåŸç†ï¼Œæ—¶é—´å¤æ‚åº¦ HashMapæœ‰äº†è§£å—ï¼ŸHashMapçš„æ—¶é—´å¤æ‚åº¦ï¼ŸHashMapä¸­Hashå†²çªæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿé“¾è¡¨çš„ä¸Šä¸€çº§ç»“æ„æ˜¯ä»€ä¹ˆï¼ŸJava8ä¸­çš„HashMapæœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿçº¢é»‘æ ‘éœ€è¦æ¯”è¾ƒå¤§å°æ‰èƒ½è¿›è¡Œæ’å…¥ï¼Œæ˜¯ä¾æ®ä»€ä¹ˆè¿›è¡Œæ¯”è¾ƒçš„ï¼Ÿå…¶ä»–Hashå†²çªè§£å†³æ–¹å¼ï¼Ÿ å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ï¼ŸThreadLocalåŸç†ï¼Ÿçº¿ç¨‹æ± äº†è§£å—è¯´è¯´çœ‹ï¼Ÿè‡ªå·±ç”¨çº¿ç¨‹æ± æ€ä¹ˆå®šå‚æ•°ï¼Ÿ å¤šçº¿ç¨‹ volatileæœ‰ç”¨è¿‡ä¹ˆï¼Œåº•å±‚å®ç°ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯è®²åˆ°äº†CPUå¡«å……ç¼“å­˜è¡ŒæŒ‡ä»¤ã€‚ Javaçº¿ç¨‹æ±  JVM GCå›æ”¶å™¨JVMè°ƒä¼˜å‚æ•°é…ç½® JJavaå †ä¸­æ€ä¹ˆåˆ†åŒºï¼Ÿæ€ä¹ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦éœ€è¦å›æ”¶ï¼ŸJavaå†…å­˜å ç”¨è¿‡å¤§æ€ä¹ˆæŸ¥çœ‹ï¼ŸJavaå†…å­˜æº¢å‡ºæœ‰ç¢°åˆ°è¿‡å—ï¼ŸJavaå†…å­˜æº¢å‡ºæ€ä¹ˆå®šä½ï¼Ÿ æ¶ˆæ¯ä¸­é—´ä»¶springå…¨å®¶æ¡¶æ•°æ®åº“ æ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œmvccæœºåˆ¶èŠä¸€ä¸‹ã€‚ æ•°æ®åº“ç´¢å¼•ï¼ŒB+æ ‘ç»“æ„å’Œç‰¹ç‚¹ã€‚æ€ä¹ˆè¿›è¡Œä¼˜åŒ– mysqlé—´éš™é”ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œä»€ä¹ˆæ¡ä»¶ä¸‹ä¼šè§¦å‘ã€‚ MySQLæ•°æ®åº“å¼•æ“ï¼Ÿåº”ç”¨åœºæ™¯ï¼ŸæŸ¥è¯¢ä¼˜åŒ–ï¼ŸNoSQLæœ‰ç”¨æˆ–äº†è§£å—ï¼Ÿ å…¶ä»– çº¢é»‘æ ‘ï¼ŒAVLæ ‘ï¼ŒæŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ç”¨çº¢é»‘æ ‘è€Œä¸ç”¨map è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿå¹³å¸¸çš„å¼€å‘ç¯å¢ƒæ˜¯Windowsè¿˜æ˜¯Linuxï¼ŸLinuxå‘½ä»¤çŸ¥é“å“ªäº›ï¼Ÿè¦åœ¨å¤šä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­æ‰¾ä¸€ä¸ªå…³é”®è¯ç”¨ä»€ä¹ˆå‘½ä»¤ï¼Ÿï¼ˆgrepï¼‰ç½‘ç»œç›¸å…³çš„å‘½ä»¤æ˜¯ä»€ä¹ˆï¼Ÿ åº¦å¨˜æ•°æ®ç»“æ„æ“ä½œç³»ç»Ÿè®¡ç®—æœºç½‘ç»œç®—æ³•javaåŸºç¡€å¤šçº¿ç¨‹JVMæ¶ˆæ¯ä¸­é—´ä»¶springå…¨å®¶æ¡¶ springbootå’Œspringæ¯”æœ‰ä»€ä¹ˆä¼˜ç‚¹ springbootè‡ªåŠ¨é…ç½®åŸç† æ•°æ®åº“ é«˜å¹¶å‘æ•°æ®åº“å¤§è¡¨ä¼˜åŒ–ï¼Œåˆ†åº“åˆ†è¡¨ï¼Œæ°´å¹³æ€ä¹ˆæ‹†ï¼Œå‚ç›´æ€ä¹ˆæ‹† çŸ¥é“å“ªäº›ç´¢å¼•ï¼Œç´¢å¼•æ•°æ®ç»“æ„ è”åˆç´¢å¼•è§„åˆ™ æ•°æ®åº“æ€ä¹ˆä¼˜åŒ–ï¼ŒæŸ¥è¯¢æ€§èƒ½ç“¶é¢ˆæ€ä¹ˆæŸ¥ï¼ˆexplainï¼‰ å…¶ä»–ç¾å›¢æ•°æ®ç»“æ„æ“ä½œç³»ç»Ÿè®¡ç®—æœºç½‘ç»œç®—æ³•javaåŸºç¡€å¤šçº¿ç¨‹JVMæ¶ˆæ¯ä¸­é—´ä»¶springå…¨å®¶æ¡¶æ•°æ®åº“å…¶ä»–æ‹¼å¤•å¤•æ•°æ®ç»“æ„ äºŒå‰æ ‘çš„ååºéå†ï¼Œéé€’å½’ç®—æ³•ã€‚ æ“ä½œç³»ç»Ÿè®¡ç®—æœºç½‘ç»œ TCPä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ï¼Œå¦‚æœæ²¡æœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ ç®—æ³•javaåŸºç¡€ å¦‚ä½•è®¿é—®ä¸€ä¸ªæ–‡ä»¶çš„å­—èŠ‚æµå‘¢ å¤šçº¿ç¨‹ åšçš„ä¸»è¦æ˜¯Javaå¯¹å§ï¼Œè®²ä¸€ä¸‹å¤šçº¿ç¨‹æŠŠï¼Œç”¨åˆ°å“ªäº›å†™ä¸€ä¸‹ï¼Œå†™äº†threadå’Œrunnableï¼Œç„¶åå†™äº†çº¿ç¨‹æ± ï¼Œå¥¹é—®æˆ‘çº¿ç¨‹æ± ç”±å“ªäº›ç»„ä»¶ç»„æˆï¼Œæœ‰å“ªäº›çº¿ç¨‹æ± ï¼Œåˆ†åˆ«æ€ä¹ˆä½¿ç”¨ï¼Œä»¥åŠæ‹’ç»ç­–ç•¥æœ‰å“ªäº›ã€‚ ä»€ä¹ˆæ—¶å€™å¤šçº¿ç¨‹ä¼šå‘ç”Ÿæ­»é”ï¼Œå†™ä¸€ä¸ªä¾‹å­å§ï¼Œç„¶åæˆ‘å†™äº†ä¸€ä¸ªä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸¤ä¸ªé”ï¼Œåˆ†åˆ«æŒæœ‰ä¸€ä¸ªï¼Œè¯·æ±‚å¦ä¸€ä¸ªçš„æ­»é”å®ä¾‹ é›†åˆç±»ç†Ÿæ‚‰å§ï¼Œå†™ä¸€ä¸ªé¢˜ç›®ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²é›†åˆï¼Œæ‰¾å‡ºpddå¹¶ä¸”åˆ é™¤ï¼Œæˆ‘ç›´æ¥å†™äº†ä¸€ä¸ªlistç„¶åforå¾ªç¯åˆ¤æ–­ç›¸ç­‰æ—¶åˆ é™¤ï¼Œå¥¹è¯´æ˜æ˜¾é—®é¢˜ï¼Œæˆ‘æ‰å‘ç°listç›´æ¥åˆ ä½ç½®ä¼šå‡ºé”™ï¼Œäºæ˜¯æˆ‘è¯´æ”¹ç”¨æ•°ç»„ï¼Œå¥¹è¯´ä¸å¤ªç¬¦åˆè¦æ±‚ï¼Œæ‰€ä»¥åº”è¯¥ä½¿ç”¨iteratoråˆ é™¤ä¼šå¥½ä¸€ç‚¹ï¼Œä¿®æ”¹ä¼šåæ˜ åˆ°é›†åˆç±»ï¼Œå¹¶ä¸”ä¸ä¼šå‡ºé”™ã€‚ ç„¶åè¯´ä¸€ä¸‹Rediså§ï¼Œæ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼ŒRedisçš„åˆ†å¸ƒå¼æ€ä¹ˆåšï¼Œè¯´äº†é›†ç¾¤ã€‚ RPCäº†è§£ä¹ˆï¼Œæˆ‘è¯´äº†ä¸»è¦æ˜¯åè®®æ ˆ+æ•°æ®æ ¼å¼+åºåˆ—åŒ–æ–¹å¼ï¼Œç„¶åéœ€è¦æœ‰æœåŠ¡æ³¨å†Œä¸­å¿ƒç®¡ç†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œä»–é—®æˆ‘æ³¨å†Œä¸­å¿ƒå®•æœºæ€ä¹ˆåŠï¼Œæˆ‘è¯´å¯ä»¥åšé«˜å¯ç”¨ï¼Œä»–è¯´è¦é—®çš„ä¸æ˜¯è¿™ä¸ªï¼Œæ˜¯æƒ³é—®æˆ‘æ³¨å†Œä¸­å¿ƒå®•æœºæ—¶æ¶ˆè´¹è€…æ˜¯å¦èƒ½è®¿é—®ç”Ÿäº§è€…ã€‚ çº¿ç¨‹æ•°å¾ˆå¤šä¼šæ€ä¹ˆæ ·ï¼Œæˆ‘è¯´ä¼šå å†…å­˜ï¼Œè¿˜æœ‰å°±æ˜¯åˆ‡æ¢çº¿ç¨‹æ¯”è¾ƒé¢‘ç¹ï¼Œä»–é—®åˆ‡æ¢çº¿ç¨‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œåº”è¯¥å°±æ˜¯CPUåˆ‡æ¢ä¸Šä¸‹æ–‡ï¼Œå…·ä½“å°±æ˜¯å¯„å­˜å™¨å’Œå†…å­˜åœ°å€çš„åˆ·æ–°ã€‚ JVMæ¶ˆæ¯ä¸­é—´ä»¶springå…¨å®¶æ¡¶æ•°æ®åº“ MySQLçš„ä¸»ä»å¤åˆ¶æ€ä¹ˆåšçš„ï¼Œç­”æ—¥å¿—ï¼Œå…·ä½“åŸç†æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ã€‚ å…¶ä»– Redisäº†è§£å“ªäº›å†…å®¹ï¼Œæ˜¯å•çº¿ç¨‹ä¹ˆï¼Œä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹å‘¢ï¼Œæ•°æ®ä¸€å®šæ˜¯å­˜åœ¨ç‰©ç†å†…å­˜ä¸­ä¹ˆï¼Œæˆ‘ä¸æ‡‚è¿™è¯å•¥æ„æ€ï¼Œå°±é—®äº†ä¸€ä¸‹æ˜¯ä¸æ˜¯æŒ‡å¯èƒ½ä¹Ÿåœ¨è™šæ‹Ÿå†…å­˜ä¸­ã€‚ä»–è¯´é‚£è®²ä¸€ä¸‹è™šæ‹Ÿå†…å­˜çš„æœºåˆ¶æŠŠï¼Œæˆ‘å°±è®²äº†åˆ†é¡µï¼Œé¡µè¡¨ï¼Œæ¢é¡µè¿™äº›ä¸œè¥¿ã€‚ åˆ†å¸ƒå¼äº†è§£å“ªäº›ä¸œè¥¿ï¼Œæ¶ˆæ¯é˜Ÿåˆ—äº†è§£ä¹ˆï¼Œç”¨åœ¨ä»€ä¹ˆåœºæ™¯ï¼Œè¯´äº†å‰Šå³°ï¼Œé™æµå’Œå¼‚æ­¥ã€‚è¯´äº†kafkaï¼Œé—®æˆ‘æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä»¥åŠç¡®ä¿æ¶ˆæ¯ä¸ä¼šè¢«é‡å¤æ¶ˆè´¹ã€‚è¿˜é—®äº†æ¶ˆæ¯é€è¾¾ç¡®è®¤æ˜¯æ€ä¹ˆåšçš„ã€‚ capäº†è§£ä¹ˆï¼Œåˆ†åˆ«æŒ‡ä»€ä¹ˆï¼Œbaseå‘¢ï¼Œå¼ºä¸€è‡´æ€§å’Œå¼±ä¸€è‡´æ€§æœ‰ä»€ä¹ˆæ–¹æ³•æ¥åšï¼Œ2pcäº†è§£ä¹ˆï¼Œè¯´ä¸€ä¸‹å¤§æ¦‚è¿‡ç¨‹ã€‚ è¿™æ ·ä¸€ä¸ªé¢˜ç›®ï¼Œä¸€ä¸ªèŠ‚ç‚¹è¦å’Œå®¢æˆ·è¿æ¥å»ºç«‹å¿ƒè·³æ£€æµ‹ï¼Œå¤§æ¦‚æœ‰ç™¾ä¸‡æ•°é‡çš„è¿æ¥ï¼Œå¹¶ä¸”ä¼šå®šæœŸå‘é€å¿ƒè·³åŒ…ï¼Œè¦å†™ä¸€ä¸ªupdateæ–¹æ³•å’Œcheckæ–¹æ³•ï¼Œupdateæ–¹æ³•æ›´æ–°å¿ƒè·³çŠ¶æ€ï¼Œcheckåˆ é™¤è¶…æ—¶èŠ‚ç‚¹ï¼Œæ€ä¹ˆåšï¼Œåˆšå¼€å§‹åšäº†ä¸ªhashå‘ç°checkè¦è½®è¯¢å¤ªæ…¢äº†ï¼Œç„¶åç”¨è®¡æ—¶å™¨å’Œå¼€çº¿ç¨‹æ£€æµ‹ä¹Ÿä¸è¡Œï¼Œæœ€åè¯´äº†ä¸ªLRUï¼Œä»–è¯´OKçš„ã€‚ åä¸ºæ•°æ®ç»“æ„æ“ä½œç³»ç»Ÿè®¡ç®—æœºç½‘ç»œç®—æ³•javaåŸºç¡€å¤šçº¿ç¨‹JVMæ¶ˆæ¯ä¸­é—´ä»¶springå…¨å®¶æ¡¶ è¯·æ±‚åˆ°SSHæ¡†æ¶çš„æµç¨‹å›¾ç”»ä¸€ä¸‹ï¼Ÿè¿œç¨‹è°ƒç”¨Shellè„šæœ¬ç”¨åˆ°å“ªäº›å‘½ä»¤ï¼Ÿ æ•°æ®åº“ æ•°æ®é‡å¤šå¤§ï¼Ÿé¡¹ç›®PGï¼ˆPostgreSQLï¼‰ç‰ˆæœ¬ï¼Ÿéç»“æ„åŒ–æ•°æ®æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿæœ‰æ²¡æœ‰è€ƒè™‘è¿‡nosqlï¼Ÿåˆ†åº“åˆ†è¡¨æ€ä¹ˆåˆ†ï¼ŸæŸ¥è¯¢çš„è¡¨ä¼šåˆå¹¶åœ¨ä¸€èµ·å—ï¼Ÿ é¡¹ç›®æ€§èƒ½æœ‰æ²¡æœ‰è€ƒè™‘è¿‡ï¼Ÿï¼ˆæˆ‘æ˜¯åšæœåŠ¡ç«¯çš„ï¼Œä¸»è¦è€ƒè™‘è¯·æ±‚å¹¶å‘é‡ï¼‰æ•°æ®åº“æ€§èƒ½å‘¢ï¼Ÿï¼ˆäº†è§£ä¸€ç‚¹ï¼ŒMySQLä¸»ä»ç»“æ„ï¼‰ å…¶ä»– NginxåŸç†äº†è§£å—ï¼Ÿï¼ˆåªç”¨åˆ°è´Ÿè½½å‡è¡¡ï¼Œä»‹ç»äº†ä¸€ä¸‹è´Ÿè½½å‡è¡¡ç­–ç•¥ ç½‘æ˜“æ•°æ®ç»“æ„æ“ä½œç³»ç»Ÿè®¡ç®—æœºç½‘ç»œç®—æ³• åˆ¤æ–­æ ‘å¯¹ç§° æ•°ç»„é¡ºæ—¶é’ˆæ—‹è½¬90åº¦ ç”¨waitå’Œnotifyæ¨¡æ‹Ÿç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ javaåŸºç¡€ public protected privateåŒºåˆ«ï¼Ÿfinalå’ŒfinallyåŒºåˆ«ï¼Ÿfinalå¯ä»¥ç”¨åœ¨æ–¹æ³•å‚æ•°ä¸Šå—ï¼ŸRuntimeExceptionå’ŒéRuntimeExceptionï¼Ÿå„ä¸¾å‡ ä¸ªä¾‹å­ï¼Ÿæ¯”æ–¹è¯´æ–‡ä»¶è¯»å†™çš„æ—¶å€™ä¼šæœ‰ä»€ä¹ˆå¼‚å¸¸ï¼Ÿæ€ä¹ˆå®ç°åºåˆ—åŒ–ï¼Ÿé™¤äº†JavaåŸç”Ÿåºåˆ—åŒ–æ–¹æ³•ï¼Œåºåˆ—åŒ–è¿˜æœ‰ä»€ä¹ˆæ ¼å¼ï¼Ÿ ArrayListå’ŒLinkedListåŒºåˆ«ï¼Ÿ ArrayListå’ŒLinkedListæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿä¸ºä»€ä¹ˆè¯´ä»–ä»¬ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸¾å®é™…åœºæ™¯ï¼Ÿ æœ‰ä»€ä¹ˆçº¿ç¨‹å®‰å…¨çš„Listï¼Ÿï¼ˆCopyOnWriteArrayListï¼‰è®²ä¸€ä¸‹æ€ä¹ˆå®ç°çº¿ç¨‹å®‰å…¨çš„ï¼Ÿï¼ˆè¯»æ—¶å…±äº«ï¼Œå†™æ—¶å¤åˆ¶ï¼ŒåŠ é”æœºåˆ¶ï¼‰ çº¿ç¨‹Aå’Œçº¿ç¨‹BåŒæ—¶é’ˆå¯¹ä¸€ä¸ªå…±äº«å˜é‡è¿›è¡Œæ“ä½œï¼Œå¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ï¼Ÿ å¹³å¸¸æ€ä¹ˆåˆ›å»ºçº¿ç¨‹ï¼Ÿçº¿ç¨‹æ± é‡Œé—²ç½®çº¿ç¨‹æ€ä¹ˆä¿æ´»ï¼Ÿï¼ˆä¸æ¸…æ¥šï¼Œè¯´äº†è‡ªå·±çš„æƒ³æ³•ï¼‰é‚£æ€ä¹ˆå”¤é†’ï¼Ÿå¦‚æœç”¨wait()å’Œnotify()ï¼Œå¯¹è°åŠ é”ï¼ŸFF synchronized å’Œ ReentrantLockçš„åŒºåˆ«ï¼Ÿå¹³å¸¸æœ‰ç”¨å“ªäº›é›†åˆç±»ï¼ŸConcurrentåŒ…æœ‰ç”¨å—ï¼Ÿ å¤šçº¿ç¨‹JVM JVMå†…å­˜æ¨¡å‹ï¼Ÿå¦‚æœç»™ä¸€ä¸ªç±»ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªmainæ–¹æ³•ï¼Œæ–¹æ³•é‡Œé¢åªæœ‰ä¸€å¥System.out.println(â€œhelloworldâ€)ï¼Œé—®è¿è¡Œè¿™ä¸ªç±»ä¼šåœ¨Javaå†…å­˜æ¨¡å‹é‡Œå‘ç”Ÿä»€ä¹ˆï¼Ÿ â€œhelloworldâ€å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ JVMå†…å­˜æ¨¡å‹ï¼Ÿæ¯ä¸ªåŒºæ˜¯åšä»€ä¹ˆçš„ï¼Ÿåƒåœ¾å›æ”¶æœºåˆ¶ï¼Ÿ æ¶ˆæ¯ä¸­é—´ä»¶springå…¨å®¶æ¡¶ Springä¸­Beanç”Ÿå‘½å‘¨æœŸï¼Ÿæåˆ°çš„Awareç›¸å…³æ¥å£æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿå¹³å¸¸ä¼šè‡ªå·±ä¼šç”¨Awareç›¸å…³æ¥å£å—ï¼ŸBeanç”Ÿå‘½å‘¨æœŸè¿™ä¹ˆé•¿æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ æ•°æ®åº“ ç»™ä¸€ä¸ªæ•°æ®åº“è¡¨ï¼ŒIDã€scoreä¸¤ä¸ªå­—æ®µåˆ†åˆ«ä»£è¡¨å­¦ç”ŸIDå’Œæˆç»©ï¼Œå†™SQLè¯­å¥æ±‚ID=ï¼Ÿçš„å­¦ç”Ÿæ’ç¬¬å‡ åï¼Ÿ å‡è®¾æ˜¯InnoDBï¼Œç»™ä¸Šè¿°SQLè¯­å¥åŠ ç´¢å¼•æ€ä¹ˆåŠ ï¼Ÿä¸ºä»€ä¹ˆè¿™æ ·å»ºç«‹ï¼Ÿèšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ MySQLæ•°æ®åº“ï¼Œç»™ä¸€ä¸ªç”¨æˆ·è¡¨æ ¼ï¼ŒIDã€ç”¨æˆ·åã€æ€§åˆ«ã€ç”¨æˆ·ä¿¡æ¯â€¦ï¼Œå‡è®¾ç»å¸¸å¯¹æ€§åˆ«å­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œé—®æ€ä¹ˆå»ºç«‹ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿå‡è®¾ç”¨æˆ·åéœ€è¦æ˜¯å”¯ä¸€çš„ï¼Œé—®æ€ä¹ˆå»ºç´¢å¼•ï¼Ÿ æ·»åŠ ç´¢å¼•çš„SQLè¯­å¥ï¼Ÿç»™ä¸€ä¸ªabcä¸‰ä¸ªå­—æ®µçš„ç´¢å¼•ï¼Œwhere a=0 order by cèƒ½ç”¨åˆ°ç´¢å¼•å—ï¼Ÿwhere a=0 and bå¤§äº0 order by cèƒ½ç”¨åˆ°ç´¢å¼•å—ï¼ŸHashç´¢å¼•å’ŒBæ ‘ç´¢å¼•çš„åŒºåˆ«ï¼ŸHashç´¢å¼•æœ‰åŒºé—´æŸ¥è¯¢å—ï¼Ÿæœ‰æ²¡æœ‰ç”¨nosqlï¼Ÿ å…¶ä»– ä»‹ç»ä¸€ä¸‹è§‰å¾—åšå¾—æœ€å¥½çš„é¡¹ç›®ï¼Ÿç”»ä¸€ä¸‹é¡¹ç›®çš„æ¡†æ¶ç»“æ„å›¾ï¼ŸNginxç”¨æ¥åšä»€ä¹ˆï¼Ÿé‡‡ç”¨äº†ä»€ä¹ˆè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿä¸‡ä¸€æŸä¸€ä¸ªæœåŠ¡å™¨æŒ‚æ‰æ€ä¹ˆåŠï¼Ÿï¼ˆä¸€è‡´æ€§hashï¼‰å¦‚æœæ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹å‘¢ï¼Ÿ å¹³å¸¸ç”¨åˆ°å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿä»‹ç»ä¸€ä¸‹æ¨¡å¼ï¼Ÿæ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼åŒºåˆ«ï¼Ÿ NIOå’ŒBIOåŒºåˆ«ï¼ŸNIOæ€ä¹ˆå†™ï¼Ÿé˜»å¡å’Œéé˜»å¡ï¼ŒåŒæ­¥å’Œå¼‚æ­¥åŒºåˆ«ï¼Ÿ CVTEæ•°æ®ç»“æ„æ“ä½œç³»ç»Ÿè®¡ç®—æœºç½‘ç»œç®—æ³•javaåŸºç¡€ Javaä¸ºä»€ä¹ˆè¯´æ˜¯é¢å‘å¯¹è±¡çš„ï¼Ÿ avaçš„ä¸‰å¤§ç‰¹æ€§ï¼Ÿå¦‚æœè¯´æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼ŒåŒååŒå‚æ•°ä½†ä¸åŒè¿”å›å€¼ï¼Œé—®æ˜¯é‡è½½å—ï¼Ÿ å¹³å¸¸ç”¨åˆ°å“ªäº›é›†åˆç±»ï¼ŸArrayListå’ŒLinkedListåŒºåˆ«ï¼ŸHashMapå†…éƒ¨æ•°æ®ç»“æ„ï¼ŸConcurrentHashMapåˆ†æ®µé”ï¼Ÿ å¤šçº¿ç¨‹ Volatileå…³é”®è¯ï¼Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ å¦‚ä½•å®ç°synchronizedä¸€æ ·çš„æ•ˆæœï¼Ÿ JVMæ¶ˆæ¯ä¸­é—´ä»¶springå…¨å®¶æ¡¶ Spring Cloudç”¨åˆ°ä»€ä¹ˆä¸œè¥¿ï¼Ÿå¦‚ä½•å®ç°è´Ÿè½½å‡è¡¡ï¼ŸæœåŠ¡æŒ‚äº†æ³¨å†Œä¸­å¿ƒæ€ä¹ˆåˆ¤æ–­ Springçš„ä¼˜ç‚¹ï¼ŸSpring AOPå®ç°åŸç†ï¼ŸAOPåº”ç”¨åœºæ™¯ï¼Ÿæ‹¦æˆªå™¨ç”¨æ¥åšä»€ä¹ˆä¸šåŠ¡ï¼Ÿ æ•°æ®åº“ MySQLæ•°æ®åº“å¼•æ“å’Œåº”ç”¨åœºæ™¯ MySQLè¡Œé”æ˜¯å¦ä¼šæœ‰æ­»é”çš„æƒ…å†µï¼Ÿ MySQLäº‹åŠ¡éš”ç¦»çº§åˆ« MySQLå¹³å¸¸æœ‰ç´¢å¼•ä¼˜åŒ–å—ï¼Ÿæ€ä¹ˆå»çŸ¥é“ä¸€ä¸ªSQLè¯­å¥éœ€ä¸éœ€è¦ä¼˜åŒ–ï¼Ÿä¸€ä¸ªè¡¨ï¼Œå»ºç«‹äº†ç´¢å¼•ï¼ˆBï¼ŒAï¼‰ï¼Œé—®where A=1 and B=2ç´¢å¼•æ˜¯å¦èƒ½å¤Ÿç”Ÿæ•ˆï¼Ÿ ä¹è§‚é”å’Œæ‚²è§‚é”äº†è§£å—ï¼ŸJDKä¸­æ¶‰åŠåˆ°ä¹è§‚é”å’Œæ‚²è§‚é”çš„å†…å®¹ å…¶ä»– Nginxè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ ip_hashçš„ä¼˜ç¼ºç‚¹ï¼Ÿ Nginxå’Œå…¶ä»–è´Ÿè½½å‡è¡¡æ¡†æ¶å¯¹æ¯”è¿‡å—ï¼Ÿ Tomcaté›†ç¾¤Sessionå…±äº«é—®é¢˜ï¼Ÿ MySQLé‡‡ç”¨äº†ä»€ä¹ˆå­˜å‚¨å¼•æ“ï¼Œä¸ºä»€ä¹ˆï¼Ÿ åˆ†å¸ƒå¼é”ï¼Ÿ]]></content>
      <tags>
        <tag>é¢ç»</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ»‘åŠ¨çª—å£æŠ€å·§æ±‡æ€»]]></title>
    <url>%2F2019%2F12%2F24%2F%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%8A%80%E5%B7%A7%E6%B1%87%E6%80%BB.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡è¯¦è§£ã€Œæ»‘åŠ¨çª—å£ã€è¿™ç§é«˜çº§åŒæŒ‡é’ˆæŠ€å·§çš„ç®—æ³•æ¡†æ¶ï¼Œå¸¦ä½ ç§’æ€å‡ é“é«˜éš¾åº¦çš„å­å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜ã€‚ LeetCode ä¸Šè‡³å°‘æœ‰ 9 é“é¢˜ç›®å¯ä»¥ç”¨æ­¤æ–¹æ³•é«˜æ•ˆè§£å†³ã€‚ä½†æ˜¯æœ‰å‡ é“æ˜¯ VIP é¢˜ç›®ï¼Œæœ‰å‡ é“é¢˜ç›®è™½ä¸éš¾ä½†å¤ªå¤æ‚ï¼Œæ‰€ä»¥æœ¬æ–‡åªé€‰æ‹©ç‚¹èµæœ€é«˜ï¼Œè¾ƒä¸ºç»å…¸çš„ï¼Œæœ€èƒ½å¤Ÿè®²æ˜ç™½çš„ä¸‰é“é¢˜æ¥è®²è§£ã€‚ç¬¬ä¸€é¢˜ä¸ºäº†è®©è¯»è€…æŒæ¡ç®—æ³•æ¨¡æ¿ï¼Œç¯‡å¹…ç›¸å¯¹é•¿ï¼Œåä¸¤é¢˜å°±åŸºæœ¬ç§’æ€äº†ã€‚ æœ¬æ–‡ä»£ç ä¸º C++ å®ç°ï¼Œä¸ä¼šç”¨åˆ°ä»€ä¹ˆç¼–ç¨‹æ–¹é¢çš„å¥‡æŠ€æ·«å·§ï¼Œä½†æ˜¯è¿˜æ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹ä¸€äº›ç”¨åˆ°çš„æ•°æ®ç»“æ„ï¼Œä»¥å…æœ‰çš„è¯»è€…å› ä¸ºè¯­è¨€çš„ç»†èŠ‚é—®é¢˜é˜»ç¢å¯¹ç®—æ³•æ€æƒ³çš„ç†è§£ï¼š unordered_map å°±æ˜¯å“ˆå¸Œè¡¨ï¼ˆå­—å…¸ï¼‰ï¼Œå®ƒçš„ä¸€ä¸ªæ–¹æ³• count(key) ç›¸å½“äº containsKey(key) å¯ä»¥åˆ¤æ–­é”® key æ˜¯å¦å­˜åœ¨ã€‚ å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·è®¿é—®é”®å¯¹åº”çš„å€¼ map[key]ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¯¥ key ä¸å­˜åœ¨ï¼ŒC++ ä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ª keyï¼Œå¹¶æŠŠ map[key] èµ‹å€¼ä¸º 0ã€‚ æ‰€ä»¥ä»£ç ä¸­å¤šæ¬¡å‡ºç°çš„ map[key]++ ç›¸å½“äº Java çš„ map.put(key, map.getOrDefault(key, 0) + 1)ã€‚ æœ¬æ–‡å¤§éƒ¨åˆ†ä»£ç éƒ½æ˜¯å›¾ç‰‡å½¢å¼ï¼Œå¯ä»¥ç‚¹å¼€æ”¾å¤§ï¼Œæ›´é‡è¦çš„æ˜¯å¯ä»¥å·¦å³æ»‘åŠ¨æ–¹ä¾¿å¯¹æ¯”ä»£ç ã€‚ä¸‹é¢è¿›å…¥æ­£é¢˜ã€‚ ä¸€ã€æœ€å°è¦†ç›–å­ä¸² é¢˜ç›®é“¾æ¥ é¢˜ç›®ä¸éš¾ç†è§£ï¼Œå°±æ˜¯è¯´è¦åœ¨ S(source) ä¸­æ‰¾åˆ°åŒ…å« T(target) ä¸­å…¨éƒ¨å­—æ¯çš„ä¸€ä¸ªå­ä¸²ï¼Œé¡ºåºæ— æ‰€è°“ï¼Œä½†è¿™ä¸ªå­ä¸²ä¸€å®šæ˜¯æ‰€æœ‰å¯èƒ½å­ä¸²ä¸­æœ€çŸ­çš„ã€‚ å¦‚æœæˆ‘ä»¬ä½¿ç”¨æš´åŠ›è§£æ³•ï¼Œä»£ç å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š 1234for (int i = 0; i &lt; s.size(); i++) for (int j = i + 1; j &lt; s.size(); j++) if s[i:j] åŒ…å« t çš„æ‰€æœ‰å­—æ¯: æ›´æ–°ç­”æ¡ˆ æ€è·¯å¾ˆç›´æ¥å§ï¼Œä½†æ˜¯æ˜¾ç„¶ï¼Œè¿™ä¸ªç®—æ³•çš„å¤æ‚åº¦è‚¯å®šå¤§äº O(N^2) äº†ï¼Œä¸å¥½ã€‚ æ»‘åŠ¨çª—å£ç®—æ³•çš„æ€è·¯æ˜¯è¿™æ ·ï¼š 1ã€æˆ‘ä»¬åœ¨å­—ç¬¦ä¸² S ä¸­ä½¿ç”¨åŒæŒ‡é’ˆä¸­çš„å·¦å³æŒ‡é’ˆæŠ€å·§ï¼Œåˆå§‹åŒ– left = right = 0ï¼ŒæŠŠç´¢å¼•é—­åŒºé—´ [left, right] ç§°ä¸ºä¸€ä¸ªã€Œçª—å£ã€ã€‚ 2ã€æˆ‘ä»¬å…ˆä¸æ–­åœ°å¢åŠ  right æŒ‡é’ˆæ‰©å¤§çª—å£ [left, right]ï¼Œç›´åˆ°çª—å£ä¸­çš„å­—ç¬¦ä¸²ç¬¦åˆè¦æ±‚ï¼ˆåŒ…å«äº† T ä¸­çš„æ‰€æœ‰å­—ç¬¦ï¼‰ã€‚ 3ã€æ­¤æ—¶ï¼Œæˆ‘ä»¬åœæ­¢å¢åŠ  rightï¼Œè½¬è€Œä¸æ–­å¢åŠ  left æŒ‡é’ˆç¼©å°çª—å£ [left, right]ï¼Œç›´åˆ°çª—å£ä¸­çš„å­—ç¬¦ä¸²ä¸å†ç¬¦åˆè¦æ±‚ï¼ˆä¸åŒ…å« T ä¸­çš„æ‰€æœ‰å­—ç¬¦äº†ï¼‰ã€‚åŒæ—¶ï¼Œæ¯æ¬¡å¢åŠ  leftï¼Œæˆ‘ä»¬éƒ½è¦æ›´æ–°ä¸€è½®ç»“æœã€‚ 4ã€é‡å¤ç¬¬ 2 å’Œç¬¬ 3 æ­¥ï¼Œç›´åˆ° right åˆ°è¾¾å­—ç¬¦ä¸² S çš„å°½å¤´ã€‚ è¿™ä¸ªæ€è·¯å…¶å®ä¹Ÿä¸éš¾ï¼Œç¬¬ 2 æ­¥ç›¸å½“äºåœ¨å¯»æ‰¾ä¸€ä¸ªã€Œå¯è¡Œè§£ã€ï¼Œç„¶åç¬¬ 3 æ­¥åœ¨ä¼˜åŒ–è¿™ä¸ªã€Œå¯è¡Œè§£ã€ï¼Œæœ€ç»ˆæ‰¾åˆ°æœ€ä¼˜è§£ã€‚å·¦å³æŒ‡é’ˆè½®æµå‰è¿›ï¼Œçª—å£å¤§å°å¢å¢å‡å‡ï¼Œçª—å£ä¸æ–­å‘å³æ»‘åŠ¨ã€‚ ä¸‹é¢ç”»å›¾ç†è§£ä¸€ä¸‹ï¼Œneeds å’Œ window ç›¸å½“äºè®¡æ•°å™¨ï¼Œåˆ†åˆ«è®°å½• T ä¸­å­—ç¬¦å‡ºç°æ¬¡æ•°å’Œçª—å£ä¸­çš„ç›¸åº”å­—ç¬¦çš„å‡ºç°æ¬¡æ•°ã€‚ åˆå§‹çŠ¶æ€ï¼š 0 å¢åŠ  rightï¼Œç›´åˆ°çª—å£ [left, right] åŒ…å«äº† T ä¸­æ‰€æœ‰å­—ç¬¦ï¼š 0 ç°åœ¨å¼€å§‹å¢åŠ  leftï¼Œç¼©å°çª—å£ [left, right]ã€‚ 0 ç›´åˆ°çª—å£ä¸­çš„å­—ç¬¦ä¸²ä¸å†ç¬¦åˆè¦æ±‚ï¼Œleft ä¸å†ç»§ç»­ç§»åŠ¨ã€‚ 0 ä¹‹åé‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œå…ˆç§»åŠ¨ rightï¼Œå†ç§»åŠ¨ leftâ€¦â€¦ ç›´åˆ° right æŒ‡é’ˆåˆ°è¾¾å­—ç¬¦ä¸² S çš„æœ«ç«¯ï¼Œç®—æ³•ç»“æŸã€‚ å¦‚æœä½ èƒ½å¤Ÿç†è§£ä¸Šè¿°è¿‡ç¨‹ï¼Œæ­å–œï¼Œä½ å·²ç»å®Œå…¨æŒæ¡äº†æ»‘åŠ¨çª—å£ç®—æ³•æ€æƒ³ã€‚è‡³äºå¦‚ä½•å…·ä½“åˆ°é—®é¢˜ï¼Œå¦‚ä½•å¾—å‡ºæ­¤é¢˜çš„ç­”æ¡ˆï¼Œéƒ½æ˜¯ç¼–ç¨‹é—®é¢˜ï¼Œç­‰ä¼šæä¾›ä¸€å¥—æ¨¡æ¿ï¼Œç†è§£ä¸€ä¸‹å°±ä¼šäº†ã€‚ ä¸Šè¿°è¿‡ç¨‹å¯ä»¥ç®€å•åœ°å†™å‡ºå¦‚ä¸‹ä¼ªç æ¡†æ¶ï¼š 123456789101112131415161718string s, t;// åœ¨ s ä¸­å¯»æ‰¾ t çš„ã€Œæœ€å°è¦†ç›–å­ä¸²ã€int left = 0, right = 0;string res = s;while(right &lt; s.size()) &#123; window.add(s[right]); right++; // å¦‚æœç¬¦åˆè¦æ±‚ï¼Œç§»åŠ¨ left ç¼©å°çª—å£ while (window ç¬¦åˆè¦æ±‚) &#123; // å¦‚æœè¿™ä¸ªçª—å£çš„å­ä¸²æ›´çŸ­ï¼Œåˆ™æ›´æ–° res res = minLen(res, window); window.remove(s[left]); left++; &#125;&#125;return res; å¦‚æœä¸Šè¿°ä»£ç ä½ ä¹Ÿèƒ½å¤Ÿç†è§£ï¼Œé‚£ä¹ˆä½ ç¦»è§£é¢˜æ›´è¿‘äº†ä¸€æ­¥ã€‚ç°åœ¨å°±å‰©ä¸‹ä¸€ä¸ªæ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ï¼šå¦‚ä½•åˆ¤æ–­ window å³å­ä¸² s[leftâ€¦right] æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œæ˜¯å¦åŒ…å« t çš„æ‰€æœ‰å­—ç¬¦å‘¢ï¼Ÿ å¯ä»¥ç”¨ä¸¤ä¸ªå“ˆå¸Œè¡¨å½“ä½œè®¡æ•°å™¨è§£å†³ã€‚ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ needs è®°å½•å­—ç¬¦ä¸² t ä¸­åŒ…å«çš„å­—ç¬¦åŠå‡ºç°æ¬¡æ•°ï¼Œç”¨å¦ä¸€ä¸ªå“ˆå¸Œè¡¨ window è®°å½•å½“å‰ã€Œçª—å£ã€ä¸­åŒ…å«çš„å­—ç¬¦åŠå‡ºç°çš„æ¬¡æ•°ï¼Œå¦‚æœ window åŒ…å«æ‰€æœ‰ needs ä¸­çš„é”®ï¼Œä¸”è¿™äº›é”®å¯¹åº”çš„å€¼éƒ½å¤§äºç­‰äº needs ä¸­çš„å€¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥çŸ¥é“å½“å‰ã€Œçª—å£ã€ç¬¦åˆè¦æ±‚äº†ï¼Œå¯ä»¥å¼€å§‹ç§»åŠ¨ left æŒ‡é’ˆäº†ã€‚ ç°åœ¨å°†ä¸Šé¢çš„æ¡†æ¶ç»§ç»­ç»†åŒ–ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142string s, t;// åœ¨ s ä¸­å¯»æ‰¾ t çš„ã€Œæœ€å°è¦†ç›–å­ä¸²ã€int left = 0, right = 0;string res = s;// ç›¸å½“äºä¸¤ä¸ªè®¡æ•°å™¨unordered_map&lt;char, int&gt; window;unordered_map&lt;char, int&gt; needs;for (char c : t) needs[c]++;// è®°å½• window ä¸­å·²ç»æœ‰å¤šå°‘å­—ç¬¦ç¬¦åˆè¦æ±‚äº†int match = 0; while (right &lt; s.size()) &#123; char c1 = s[right]; if (needs.count(c1)) &#123; window[c1]++; // åŠ å…¥ window if (window[c1] == needs[c1]) // å­—ç¬¦ c1 çš„å‡ºç°æ¬¡æ•°ç¬¦åˆè¦æ±‚äº† match++; &#125; right++; // window ä¸­çš„å­—ç¬¦ä¸²å·²ç¬¦åˆ needs çš„è¦æ±‚äº† while (match == needs.size()) &#123; // æ›´æ–°ç»“æœ res res = minLen(res, window); char c2 = s[left]; if (needs.count(c2)) &#123; window[c2]--; // ç§»å‡º window if (window[c2] &lt; needs[c2]) // å­—ç¬¦ c2 å‡ºç°æ¬¡æ•°ä¸å†ç¬¦åˆè¦æ±‚ match--; &#125; left++; &#125;&#125;return res; ä¸Šè¿°ä»£ç å·²ç»å…·å¤‡å®Œæ•´çš„é€»è¾‘äº†ï¼Œåªæœ‰ä¸€å¤„ä¼ªç ï¼Œå³æ›´æ–° res çš„åœ°æ–¹ï¼Œä¸è¿‡è¿™ä¸ªé—®é¢˜å¤ªå¥½è§£å†³äº†ï¼Œç›´æ¥çœ‹è§£æ³•å§ï¼ 123456789101112131415161718192021222324252627282930313233343536373839404142string minWindow(string s, string t) &#123; // è®°å½•æœ€çŸ­å­ä¸²çš„å¼€å§‹ä½ç½®å’Œé•¿åº¦ int start = 0, minLen = INT_MAX; int left = 0, right = 0; unordered_map&lt;char, int&gt; window; unordered_map&lt;char, int&gt; needs; for (char c : t) needs[c]++; int match = 0; while (right &lt; s.size()) &#123; char c1 = s[right]; if (needs.count(c1)) &#123; window[c1]++; if (window[c1] == needs[c1]) match++; &#125; right++; while (match == needs.size()) &#123; if (right - left &lt; minLen) &#123; // æ›´æ–°æœ€å°å­ä¸²çš„ä½ç½®å’Œé•¿åº¦ start = left; minLen = right - left; &#125; char c2 = s[left]; if (needs.count(c2)) &#123; window[c2]--; if (window[c2] &lt; needs[c2]) match--; &#125; left++; &#125; &#125; return minLen == INT_MAX ? "" : s.substr(start, minLen);&#125; å¦‚æœç›´æ¥ç”©ç»™ä½ è¿™ä¹ˆä¸€å¤§æ®µä»£ç ï¼Œæˆ‘æƒ³ä½ çš„å¿ƒæ€æ˜¯çˆ†ç‚¸çš„ï¼Œä½†æ˜¯é€šè¿‡ä¹‹å‰çš„æ­¥æ­¥è·Ÿè¿›ï¼Œä½ æ˜¯å¦èƒ½å¤Ÿç†è§£è¿™ä¸ªç®—æ³•çš„å†…åœ¨é€»è¾‘å‘¢ï¼Ÿä½ æ˜¯å¦èƒ½æ¸…æ™°çœ‹å‡ºè¯¥ç®—æ³•çš„ç»“æ„å‘¢ï¼Ÿ è¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(M + N)ï¼ŒM å’Œ N åˆ†åˆ«æ˜¯å­—ç¬¦ä¸² S å’Œ T çš„é•¿åº¦ã€‚å› ä¸ºæˆ‘ä»¬å…ˆç”¨ for å¾ªç¯éå†äº†å­—ç¬¦ä¸² T æ¥åˆå§‹åŒ– needsï¼Œæ—¶é—´ O(N)ï¼Œä¹‹åçš„ä¸¤ä¸ª while å¾ªç¯æœ€å¤šæ‰§è¡Œ 2M æ¬¡ï¼Œæ—¶é—´ O(M)ã€‚ è¯»è€…ä¹Ÿè®¸è®¤ä¸ºåµŒå¥—çš„ while å¾ªç¯å¤æ‚åº¦åº”è¯¥æ˜¯å¹³æ–¹çº§ï¼Œä½†æ˜¯ä½ è¿™æ ·æƒ³ï¼Œwhile æ‰§è¡Œçš„æ¬¡æ•°å°±æ˜¯åŒæŒ‡é’ˆ left å’Œ right èµ°çš„æ€»è·¯ç¨‹ï¼Œæœ€å¤šæ˜¯ 2M å˜›ã€‚ äºŒã€æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯ é¢˜ç›®é“¾æ¥ è¿™é“é¢˜çš„éš¾åº¦æ˜¯ Easyï¼Œä½†æ˜¯è¯„è®ºåŒºç‚¹èµæœ€å¤šçš„ä¸€æ¡æ˜¯è¿™æ ·ï¼š 1How can this problem be marked as easy??? å®é™…ä¸Šï¼Œè¿™ä¸ª Easy æ˜¯å±äºäº†è§£åŒæŒ‡é’ˆæŠ€å·§çš„äººçš„ï¼Œåªè¦æŠŠä¸Šä¸€é“é¢˜çš„ä»£ç æ”¹ä¸­æ›´æ–° res éƒ¨åˆ†çš„ä»£ç ç¨åŠ ä¿®æ”¹å°±æˆäº†è¿™é“é¢˜çš„è§£ï¼š 12345678910111213141516171819202122232425262728293031323334353637vector&lt;int&gt; findAnagrams(string s, string t) &#123; // ç”¨æ•°ç»„è®°å½•ç­”æ¡ˆ vector&lt;int&gt; res; int left = 0, right = 0; unordered_map&lt;char, int&gt; needs; unordered_map&lt;char, int&gt; window; for (char c : t) needs[c]++; int match = 0; while (right &lt; s.size()) &#123; char c1 = s[right]; if (needs.count(c1)) &#123; window[c1]++; if (window[c1] == needs[c1]) match++; &#125; right++; while (match == needs.size()) &#123; // å¦‚æœ window çš„å¤§å°åˆé€‚ // å°±æŠŠèµ·å§‹ç´¢å¼• left åŠ å…¥ç»“æœ if (right - left == t.size()) &#123; res.push_back(left); &#125; char c2 = s[left]; if (needs.count(c2)) &#123; window[c2]--; if (window[c2] &lt; needs[c2]) match--; &#125; left++; &#125; &#125; return res;&#125; å› ä¸ºè¿™é“é¢˜å’Œä¸Šä¸€é“çš„åœºæ™¯ç±»ä¼¼ï¼Œä¹Ÿéœ€è¦ window ä¸­åŒ…å«ä¸² t çš„æ‰€æœ‰å­—ç¬¦ï¼Œä½†ä¸Šä¸€é“é¢˜è¦æ‰¾é•¿åº¦æœ€çŸ­çš„å­ä¸²ï¼Œè¿™é“é¢˜è¦æ‰¾é•¿åº¦ç›¸åŒçš„å­ä¸²ï¼Œä¹Ÿå°±æ˜¯ã€Œå­—æ¯å¼‚ä½è¯ã€å˜›ã€‚ ä¸‰ã€æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸² é¢˜ç›®é“¾æ¥ é‡åˆ°å­ä¸²é—®é¢˜ï¼Œé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æ»‘åŠ¨çª—å£æŠ€å·§ã€‚ ç±»ä¼¼ä¹‹å‰çš„æ€è·¯ï¼Œä½¿ç”¨ window ä½œä¸ºè®¡æ•°å™¨è®°å½•çª—å£ä¸­çš„å­—ç¬¦å‡ºç°æ¬¡æ•°ï¼Œç„¶åå…ˆå‘å³ç§»åŠ¨ rightï¼Œå½“ window ä¸­å‡ºç°é‡å¤å­—ç¬¦æ—¶ï¼Œå¼€å§‹ç§»åŠ¨ left ç¼©å°çª—å£ï¼Œå¦‚æ­¤å¾€å¤ï¼š 123456789101112131415161718192021int lengthOfLongestSubstring(string s) &#123; int left = 0, right = 0; unordered_map&lt;char, int&gt; window; int res = 0; // è®°å½•æœ€é•¿é•¿åº¦ while (right &lt; s.size()) &#123; char c1 = s[right]; window[c1]++; right++; // å¦‚æœ window ä¸­å‡ºç°é‡å¤å­—ç¬¦ // å¼€å§‹ç§»åŠ¨ left ç¼©å°çª—å£ while (window[c1] &gt; 1) &#123; char c2 = s[left]; window[c2]--; left++; &#125; res = max(res, right - left); &#125; return res;&#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬è¦æ±‚çš„æ˜¯æœ€é•¿å­ä¸²ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ¯æ¬¡ç§»åŠ¨ right å¢å¤§çª—å£æ—¶æ›´æ–° resï¼Œè€Œä¸æ˜¯åƒä¹‹å‰çš„é¢˜ç›®åœ¨ç§»åŠ¨ left ç¼©å°çª—å£æ—¶æ›´æ–° resã€‚ æœ€åæ€»ç»“é€šè¿‡ä¸Šé¢ä¸‰é“é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºæ»‘åŠ¨çª—å£ç®—æ³•çš„æŠ½è±¡æ€æƒ³ï¼š 12345678910111213int left = 0, right = 0;while (right &lt; s.size()) &#123; window.add(s[right]); right++; while (valid) &#123; window.remove(s[left]); left++; &#125;&#125; å…¶ä¸­ window çš„æ•°æ®ç±»å‹å¯ä»¥è§†å…·ä½“æƒ…å†µè€Œå®šï¼Œæ¯”å¦‚ä¸Šè¿°é¢˜ç›®éƒ½ä½¿ç”¨å“ˆå¸Œè¡¨å……å½“è®¡æ•°å™¨ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªæ•°ç»„å®ç°åŒæ ·æ•ˆæœï¼Œå› ä¸ºæˆ‘ä»¬åªå¤„ç†è‹±æ–‡å­—æ¯ã€‚ ç¨å¾®éº»çƒ¦çš„åœ°æ–¹å°±æ˜¯è¿™ä¸ª valid æ¡ä»¶ï¼Œä¸ºäº†å®ç°è¿™ä¸ªæ¡ä»¶çš„å®æ—¶æ›´æ–°ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå†™å¾ˆå¤šä»£ç ã€‚æ¯”å¦‚å‰ä¸¤é“é¢˜ï¼Œçœ‹èµ·æ¥è§£æ³•ç¯‡å¹…é‚£ä¹ˆé•¿ï¼Œå®é™…ä¸Šæ€æƒ³è¿˜æ˜¯å¾ˆç®€å•ï¼Œåªæ˜¯å¤§å¤šæ•°ä»£ç éƒ½åœ¨å¤„ç†è¿™ä¸ªé—®é¢˜è€Œå·²ã€‚]]></content>
      <tags>
        <tag>java</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
        <tag>æ»‘åŠ¨çª—å£</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŒæŒ‡é’ˆæŠ€å·§æ±‡æ€»]]></title>
    <url>%2F2019%2F12%2F24%2F%E5%8F%8C%E6%8C%87%E9%92%88%E6%8A%80%E5%B7%A7%E6%B1%87%E6%80%BB.html</url>
    <content type="text"><![CDATA[æˆ‘æŠŠåŒæŒ‡é’ˆæŠ€å·§å†åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ã€Œå¿«æ…¢æŒ‡é’ˆã€ï¼Œä¸€ç±»æ˜¯ã€Œå·¦å³æŒ‡é’ˆã€ã€‚å‰è€…è§£å†³ä¸»è¦è§£å†³é“¾è¡¨ä¸­çš„é—®é¢˜ï¼Œæ¯”å¦‚å…¸å‹çš„åˆ¤å®šé“¾è¡¨ä¸­æ˜¯å¦åŒ…å«ç¯ï¼›åè€…ä¸»è¦è§£å†³æ•°ç»„ï¼ˆæˆ–è€…å­—ç¬¦ä¸²ï¼‰ä¸­çš„é—®é¢˜ï¼Œæ¯”å¦‚äºŒåˆ†æŸ¥æ‰¾ã€‚ ä¸€ã€å¿«æ…¢æŒ‡é’ˆçš„å¸¸è§ç®—æ³•å¿«æ…¢æŒ‡é’ˆä¸€èˆ¬éƒ½åˆå§‹åŒ–æŒ‡å‘é“¾è¡¨çš„å¤´ç»“ç‚¹ headï¼Œå‰è¿›æ—¶å¿«æŒ‡é’ˆ fast åœ¨å‰ï¼Œæ…¢æŒ‡é’ˆ slow åœ¨åï¼Œå·§å¦™è§£å†³ä¸€äº›é“¾è¡¨ä¸­çš„é—®é¢˜ã€‚ 1ã€åˆ¤å®šé“¾è¡¨ä¸­æ˜¯å¦å«æœ‰ç¯ è¿™åº”è¯¥å±äºé“¾è¡¨æœ€åŸºæœ¬çš„æ“ä½œäº†ï¼Œå¦‚æœè¯»è€…å·²ç»çŸ¥é“è¿™ä¸ªæŠ€å·§ï¼Œå¯ä»¥è·³è¿‡ã€‚ å•é“¾è¡¨çš„ç‰¹ç‚¹æ˜¯æ¯ä¸ªèŠ‚ç‚¹åªçŸ¥é“ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸€ä¸ªæŒ‡é’ˆçš„è¯æ— æ³•åˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦å«æœ‰ç¯çš„ã€‚ å¦‚æœé“¾è¡¨ä¸­ä¸å«ç¯ï¼Œé‚£ä¹ˆè¿™ä¸ªæŒ‡é’ˆæœ€ç»ˆä¼šé‡åˆ°ç©ºæŒ‡é’ˆ null è¡¨ç¤ºé“¾è¡¨åˆ°å¤´äº†ï¼Œè¿™è¿˜å¥½è¯´ï¼Œå¯ä»¥åˆ¤æ–­è¯¥é“¾è¡¨ä¸å«ç¯ã€‚ 12345boolean hasCycle(ListNode head) &#123; while (head != null) head = head.next; return false;&#125; ä½†æ˜¯å¦‚æœé“¾è¡¨ä¸­å«æœ‰ç¯ï¼Œé‚£ä¹ˆè¿™ä¸ªæŒ‡é’ˆå°±ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œå› ä¸ºç¯å½¢æ•°ç»„ä¸­æ²¡æœ‰ null æŒ‡é’ˆä½œä¸ºå°¾éƒ¨èŠ‚ç‚¹ã€‚ ç»å…¸è§£æ³•å°±æ˜¯ç”¨ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªè·‘å¾—å¿«ï¼Œä¸€ä¸ªè·‘å¾—æ…¢ã€‚å¦‚æœä¸å«æœ‰ç¯ï¼Œè·‘å¾—å¿«çš„é‚£ä¸ªæŒ‡é’ˆæœ€ç»ˆä¼šé‡åˆ° nullï¼Œè¯´æ˜é“¾è¡¨ä¸å«ç¯ï¼›å¦‚æœå«æœ‰ç¯ï¼Œå¿«æŒ‡é’ˆæœ€ç»ˆä¼šè¶…æ…¢æŒ‡é’ˆä¸€åœˆï¼Œå’Œæ…¢æŒ‡é’ˆç›¸é‡ï¼Œè¯´æ˜é“¾è¡¨å«æœ‰ç¯ã€‚ 123456789101112boolean hasCycle(ListNode head) &#123; ListNode fast, slow; fast = slow = head; while (fast != null &amp;&amp; fast.next != null) &#123; fast = fast.next.next; slow = slow.next; if (fast == slow) return true; &#125; return false;&#125; 2ã€å·²çŸ¥é“¾è¡¨ä¸­å«æœ‰ç¯ï¼Œè¿”å›è¿™ä¸ªç¯çš„èµ·å§‹ä½ç½® 1 è¿™ä¸ªé—®é¢˜ä¸€ç‚¹éƒ½ä¸å›°éš¾ï¼Œæœ‰ç‚¹ç±»ä¼¼è„‘ç­‹æ€¥è½¬å¼¯ï¼Œå…ˆç›´æ¥çœ‹ä»£ç ï¼š 12345678910111213141516ListNode detectCycle(ListNode head) &#123; ListNode fast, slow; fast = slow = head; while (fast != null &amp;&amp; fast.next != null) &#123; fast = fast.next.next; slow = slow.next; if (fast == slow) break; &#125; // ä¸Šé¢çš„ä»£ç ç±»ä¼¼ hasCycle å‡½æ•° slow = head; while (slow != fast) &#123; fast = fast.next; slow = slow.next; &#125; return slow;&#125; å¯ä»¥çœ‹åˆ°ï¼Œå½“å¿«æ…¢æŒ‡é’ˆç›¸é‡æ—¶ï¼Œè®©å…¶ä¸­ä»»ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œç„¶åè®©å®ƒä¿©ä»¥ç›¸åŒé€Ÿåº¦å‰è¿›ï¼Œå†æ¬¡ç›¸é‡æ—¶æ‰€åœ¨çš„èŠ‚ç‚¹ä½ç½®å°±æ˜¯ç¯å¼€å§‹çš„ä½ç½®ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ ç¬¬ä¸€æ¬¡ç›¸é‡æ—¶ï¼Œå‡è®¾æ…¢æŒ‡é’ˆ slow èµ°äº† k æ­¥ï¼Œé‚£ä¹ˆå¿«æŒ‡é’ˆ fast ä¸€å®šèµ°äº† 2k æ­¥ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯” slow å¤šèµ°äº† k æ­¥ï¼ˆä¹Ÿå°±æ˜¯ç¯çš„é•¿åº¦ï¼‰ã€‚ 2 è®¾ç›¸é‡ç‚¹è·ç¯çš„èµ·ç‚¹çš„è·ç¦»ä¸º mï¼Œé‚£ä¹ˆç¯çš„èµ·ç‚¹è·å¤´ç»“ç‚¹ head çš„è·ç¦»ä¸º k - mï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä» head å‰è¿› k - m æ­¥å°±èƒ½åˆ°è¾¾ç¯èµ·ç‚¹ã€‚ å·§çš„æ˜¯ï¼Œå¦‚æœä»ç›¸é‡ç‚¹ç»§ç»­å‰è¿› k - m æ­¥ï¼Œä¹Ÿæ°å¥½åˆ°è¾¾ç¯èµ·ç‚¹ã€‚ 3 æ‰€ä»¥ï¼Œåªè¦æˆ‘ä»¬æŠŠå¿«æ…¢æŒ‡é’ˆä¸­çš„ä»»ä¸€ä¸ªé‡æ–°æŒ‡å‘ headï¼Œç„¶åä¸¤ä¸ªæŒ‡é’ˆåŒé€Ÿå‰è¿›ï¼Œk - m æ­¥åå°±ä¼šç›¸é‡ï¼Œç›¸é‡ä¹‹å¤„å°±æ˜¯ç¯çš„èµ·ç‚¹äº†ã€‚ 3ã€å¯»æ‰¾é“¾è¡¨çš„ä¸­ç‚¹ ç±»ä¼¼ä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®©å¿«æŒ‡é’ˆä¸€æ¬¡å‰è¿›ä¸¤æ­¥ï¼Œæ…¢æŒ‡é’ˆä¸€æ¬¡å‰è¿›ä¸€æ­¥ï¼Œå½“å¿«æŒ‡é’ˆåˆ°è¾¾é“¾è¡¨å°½å¤´æ—¶ï¼Œæ…¢æŒ‡é’ˆå°±å¤„äºé“¾è¡¨çš„ä¸­é—´ä½ç½®ã€‚ 123456while (fast != null &amp;&amp; fast.next != null) &#123; fast = fast.next.next; slow = slow.next;&#125;// slow å°±åœ¨ä¸­é—´ä½ç½®return slow; å½“é“¾è¡¨çš„é•¿åº¦æ˜¯å¥‡æ•°æ—¶ï¼Œslow æ°å·§åœåœ¨ä¸­ç‚¹ä½ç½®ï¼›å¦‚æœé•¿åº¦æ˜¯å¶æ•°ï¼Œslow æœ€ç»ˆçš„ä½ç½®æ˜¯ä¸­é—´åå³ï¼š center å¯»æ‰¾é“¾è¡¨ä¸­ç‚¹çš„ä¸€ä¸ªé‡è¦ä½œç”¨æ˜¯å¯¹é“¾è¡¨è¿›è¡Œå½’å¹¶æ’åºã€‚ å›æƒ³æ•°ç»„çš„å½’å¹¶æ’åºï¼šæ±‚ä¸­ç‚¹ç´¢å¼•é€’å½’åœ°æŠŠæ•°ç»„äºŒåˆ†ï¼Œæœ€ååˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ã€‚å¯¹äºé“¾è¡¨ï¼Œåˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨æ˜¯å¾ˆç®€å•çš„ï¼Œéš¾ç‚¹å°±åœ¨äºäºŒåˆ†ã€‚ ä½†æ˜¯ç°åœ¨ä½ å­¦ä¼šäº†æ‰¾åˆ°é“¾è¡¨çš„ä¸­ç‚¹ï¼Œå°±èƒ½å®ç°é“¾è¡¨çš„äºŒåˆ†äº†ã€‚å…³äºå½’å¹¶æ’åºçš„å…·ä½“å†…å®¹æœ¬æ–‡å°±ä¸å…·ä½“å±•å¼€äº†ã€‚ 4ã€å¯»æ‰¾é“¾è¡¨çš„å€’æ•°ç¬¬ k ä¸ªå…ƒç´  æˆ‘ä»¬çš„æ€è·¯è¿˜æ˜¯ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œè®©å¿«æŒ‡é’ˆå…ˆèµ° k æ­¥ï¼Œç„¶åå¿«æ…¢æŒ‡é’ˆå¼€å§‹åŒé€Ÿå‰è¿›ã€‚è¿™æ ·å½“å¿«æŒ‡é’ˆèµ°åˆ°é“¾è¡¨æœ«å°¾ null æ—¶ï¼Œæ…¢æŒ‡é’ˆæ‰€åœ¨çš„ä½ç½®å°±æ˜¯å€’æ•°ç¬¬ k ä¸ªé“¾è¡¨èŠ‚ç‚¹ï¼ˆä¸ºäº†ç®€åŒ–ï¼Œå‡è®¾ k ä¸ä¼šè¶…è¿‡é“¾è¡¨é•¿åº¦ï¼‰ï¼š 1234567891011ListNode slow, fast;slow = fast = head;while (k-- &gt; 0) fast = fast.next;while (fast != null) &#123; slow = slow.next; fast = fast.next;&#125;return slow; äºŒã€å·¦å³æŒ‡é’ˆçš„å¸¸ç”¨ç®—æ³•å·¦å³æŒ‡é’ˆåœ¨æ•°ç»„ä¸­å®é™…æ˜¯æŒ‡ä¸¤ä¸ªç´¢å¼•å€¼ï¼Œä¸€èˆ¬åˆå§‹åŒ–ä¸º left = 0, right = nums.length - 1 ã€‚ 1ã€äºŒåˆ†æŸ¥æ‰¾ å‰æ–‡ã€ŒäºŒåˆ†æŸ¥æ‰¾ã€æœ‰è¯¦ç»†è®²è§£ï¼Œè¿™é‡Œåªå†™æœ€ç®€å•çš„äºŒåˆ†ç®—æ³•ï¼Œæ—¨åœ¨çªå‡ºå®ƒçš„åŒæŒ‡é’ˆç‰¹æ€§ï¼š 1234567891011121314int binarySearch(int[] nums, int target) &#123; int left = 0; int right = nums.length - 1; while(left &lt;= right) &#123; int mid = (right + left) / 2; if(nums[mid] == target) return mid; else if (nums[mid] &lt; target) left = mid + 1; else if (nums[mid] &gt; target) right = mid - 1; &#125; return -1;&#125; 2ã€ä¸¤æ•°ä¹‹å’Œ ç›´æ¥çœ‹ä¸€é“ LeetCode é¢˜ç›®å§ï¼š title åªè¦æ•°ç»„æœ‰åºï¼Œå°±åº”è¯¥æƒ³åˆ°åŒæŒ‡é’ˆæŠ€å·§ã€‚è¿™é“é¢˜çš„è§£æ³•æœ‰ç‚¹ç±»ä¼¼äºŒåˆ†æŸ¥æ‰¾ï¼Œé€šè¿‡è°ƒèŠ‚ left å’Œ right å¯ä»¥è°ƒæ•´ sum çš„å¤§å°ï¼š 123456789101112131415int[] twoSum(int[] nums, int target) &#123; int left = 0, right = nums.length - 1; while (left &lt; right) &#123; int sum = nums[left] + nums[right]; if (sum == target) &#123; // é¢˜ç›®è¦æ±‚çš„ç´¢å¼•æ˜¯ä» 1 å¼€å§‹çš„ return new int[]&#123;left + 1, right + 1&#125;; &#125; else if (sum &lt; target) &#123; left++; // è®© sum å¤§ä¸€ç‚¹ &#125; else if (sum &gt; target) &#123; right--; // è®© sum å°ä¸€ç‚¹ &#125; &#125; return new int[]&#123;-1, -1&#125;;&#125; 3ã€åè½¬æ•°ç»„ 1234567891011void reverse(int[] nums) &#123; int left = 0; int right = nums.length - 1; while (left &lt; right) &#123; // swap(nums[left], nums[right]) int temp = nums[left]; nums[left] = nums[right]; nums[right] = temp; left++; right--; &#125;&#125; 4ã€æ»‘åŠ¨çª—å£ç®—æ³• è¿™ä¹Ÿè®¸æ˜¯åŒæŒ‡é’ˆæŠ€å·§çš„æœ€é«˜å¢ƒç•Œäº†ï¼Œå¦‚æœæŒæ¡äº†æ­¤ç®—æ³•ï¼Œå¯ä»¥è§£å†³ä¸€å¤§ç±»å­å­—ç¬¦ä¸²åŒ¹é…çš„é—®é¢˜ï¼Œä¸è¿‡ã€Œæ»‘åŠ¨çª—å£ã€ç¨å¾®æ¯”ä¸Šè¿°çš„è¿™äº›ç®—æ³•å¤æ‚äº›ã€‚ å¹¸è¿çš„æ˜¯ï¼Œè¿™ç±»ç®—æ³•æ˜¯æœ‰æ¡†æ¶æ¨¡æ¿çš„ï¼Œä¸‹ç¯‡æ–‡ç« å°±å‡†å¤‡è®²è§£ã€Œæ»‘åŠ¨çª—å£ã€ç®—æ³•æ¨¡æ¿ï¼Œå¸®å¤§å®¶ç§’æ€å‡ é“ LeetCode å­ä¸²åŒ¹é…çš„é—®é¢˜ã€‚]]></content>
      <tags>
        <tag>java</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[labuladongå…¬ä¼—å·ç¬”è®°]]></title>
    <url>%2F2019%2F12%2F22%2Flabuladong%E5%85%AC%E4%BC%97%E5%8F%B7%E7%AC%94%E8%AE%B0(dp%26%26%E4%BA%8C%E5%88%86).html</url>
    <content type="text"><![CDATA[åŠ¨æ€è§„åˆ’ï¼šä¸åŒçš„å®šä¹‰äº§ç”Ÿä¸åŒçš„è§£æ³•æ–‡ç« é“¾æ¥é”®ç›˜ç»„åˆé—®é¢˜ æ”¶è·å¯¹çŠ¶æ€æœºçš„å®šä¹‰ä¸åŒï¼Œå¾—åˆ°çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹å°±å®Œå…¨ä¸åŒ ç»å…¸é¢è¯•é¢˜ï¼šæœ€é•¿å›æ–‡å­ä¸²ï¼ˆLeetCodeç¬¬5é¢˜ï¼‰æ–‡ç« é“¾æ¥ç»å…¸é¢è¯•é¢˜ï¼šæœ€é•¿å›æ–‡å­ä¸² æ”¶è·å›æ–‡å­ä¸²æœ‰ä¸¤ä¸ªåšæ³•ï¼Œä¸€ä¸ªæ˜¯ä»ä¸­é—´å±•å¼€çš„ç®—æ³•ï¼Œä¸€ä¸ªæ˜¯ä¸¤ä¾§å‘ä¸­é—´é é½çš„dp å•è°ƒæ ˆæ–‡ç« é“¾æ¥å•è°ƒæ ˆ Monotonic Stack çš„ä½¿ç”¨ æ”¶è· å•è°ƒæ ˆç®—æ³•è¿‡ç¨‹ å¤„ç†Next Greater Numberï¼Œä»åå‘å‰éå† å…ˆåˆ¤æ–­ æ ˆæ˜¯å¦ä¸ºç©º å’Œ æ ˆé¡¶çš„å€¼æ˜¯ä¸æ˜¯æ¯”å³å°†å…¥æ ˆçš„å€¼å° å¦‚æœæ ˆç©ºï¼Œåˆ™è¯´æ˜æ‰¾ä¸åˆ°æ¯”è¯¥æ•°å¤§çš„æ•°ï¼Œå°†å…¶Next Greater Numberç½®ä¸º-1 æ ˆä¸ä¸ºç©ºï¼Œç›´åˆ°æ‰¾åˆ°æ¯”è¯¥æ•°å¤§çš„æ•°ï¼Œå°†å…¶ç½®ä¸ºæ ˆé¡¶ï¼Œæ¯”å…¶å°çš„ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº† ç„¶åå°†è¯¥æ•°çš„Next Greater Numberå®šä¸ºæ ˆé¡¶å…ƒç´ ï¼Œå¹¶å°†è¯¥æ•°åŠ å…¥æ ˆä¸­ å¤„ç†å¾ªç¯æ•°ç»„ å°†è¯¥æ•°ç»„çš„åŒå€é•¿åº¦æ„é€ å‡ºæ¥ï¼Œè¿™æ ·çš„è¯å°±å°±ä¸ä»…èƒ½æ¯”è¾ƒå³è¾¹çš„æ•°ï¼Œè¿˜èƒ½æ¯”è¾ƒå·¦è¾¹çš„æ•°äº† äºŒåˆ†æŸ¥æ‰¾ç®—æ³•è¯¦è§£æ–‡ç« é“¾æ¥äºŒåˆ†æŸ¥æ‰¾ç®—æ³•è¯¦è§£ äºŒåˆ†æŸ¥æ‰¾çš„æ¡†æ¶ æœ€åŸºæœ¬çš„æ¡†æ¶1ï¼ˆå½¢å¼æ˜¯[a,b)ï¼‰ 123456789101112131415int binarySearch(int nums[],int target)&#123; int left = 0; int right = nums.length; while(left &lt; right)&#123; //é˜²æ­¢è®¡ç®—midæ—¶æº¢å‡º int mid = left + (right - left) / 2; if(nums[mid] == target) return mid; else if(nums[mid] &lt; target) left = mid + 1; else if(nums[mid] &gt; target) right = mid; &#125; return -1;&#125; æœ€åŸºæœ¬çš„æ¡†æ¶2 (å½¢å¼æ˜¯[a,b]) 123456789101112131415int binarySearch(int nums[],int target)&#123; int left = 0; int right = nums.length - 1; while(left &lt;= right)&#123; //é˜²æ­¢è®¡ç®—midæ—¶æº¢å‡º int mid = left + (right - left) / 2; if(nums[mid] == target) return mid; else if(nums[mid] &lt; target) left = mid + 1; else if(nums[mid] &gt; target) right = mid - 1; &#125; return -1;&#125; å¯»æ‰¾å·¦ä¾§è¾¹ç•Œçš„äºŒåˆ†æœç´¢ 12345678910111213141516171819202122232425/** * è¿”å›çš„æ˜¯æ¯”targetå°çš„æ•°é‡ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœ€å·¦targetçš„ä¸‹æ ‡ * @param nums * @param target * @return */int binarySearchLeft(int nums[],int target)&#123; int left = 0; int right = nums.length; while(left &lt; right)&#123; //é˜²æ­¢è®¡ç®—midæ—¶æº¢å‡º int mid = left + (right - left) / 2; if(nums[mid] == target) right = mid; else if(nums[mid] &lt; target) left = mid + 1; else if(nums[mid] &gt; target) right = mid; &#125; //è¦æ—¶åˆ»æ³¨æ„å¤„ç†è¾¹ç•Œï¼Œå¦‚æœæ•´ä¸ªæ•°ç»„éƒ½æ²¡æœ‰è¿™ä¸ªtargetï¼Œåˆ™leftä¼šåˆ°nums.length // target æ¯”æ‰€æœ‰æ•°éƒ½å¤§ if (left == nums.length) return -1; // ç±»ä¼¼ä¹‹å‰ç®—æ³•çš„å¤„ç†æ–¹å¼ return nums[left] == target ? left : -1;&#125; å¯»æ‰¾å³ä¾§è¾¹ç•Œçš„äºŒåˆ†æœç´¢ 1234567891011121314151617181920212223242526/** * è¿”å›çš„æ˜¯æœ€å³targetçš„ä¸‹æ ‡ * @param nums * @param target * @return */int binarySearchRight(int nums[],int target)&#123; int left = 0; int right = nums.length; while(left &lt; right)&#123; //é˜²æ­¢è®¡ç®—midæ—¶æº¢å‡º int mid = left + (right - left) / 2; if(nums[mid] == target) left = mid + 1; else if(nums[mid] &lt; target) left = mid + 1; else if(nums[mid] &gt; target) right = mid; &#125; //è¦æ—¶åˆ»æ³¨æ„å¤„ç†è¾¹ç•Œï¼Œå¦‚æœæ•´ä¸ªæ•°ç»„éƒ½æ²¡æœ‰è¿™ä¸ªtargetï¼Œåˆ™leftä¼šåˆ°nums.length // target æ¯”æ‰€æœ‰æ•°éƒ½å¤§ // return left - 1; if (left == 0) return -1; // ç±»ä¼¼ä¹‹å‰ç®—æ³•çš„å¤„ç†æ–¹å¼ return nums[left-1] == target ? (left-1) : -1;&#125; æ”¶è· å·¦ä¾§è¾¹ç•Œçš„äºŒåˆ†æœç´¢ï¼Œleftå³ä»£è¡¨æ¯”targetå°çš„æ•°çš„æ•°é‡ å³ä¾§è¾¹ç•Œçš„äºŒåˆ†æœç´¢ï¼Œleftå³ä»£è¡¨æ¯”targetå¤§çš„ç¬¬ä¸€ä¸ªæ•°çš„ä¸‹æ ‡ï¼Œæ¯”å¦‚æ˜¯5ï¼Œåˆ™ä»£è¡¨ç´¢å¼•ä¸º4æ˜¯targetçš„æœ€å³ä¾§æ•° æœ€é•¿é€’å½’å­åºåˆ—(LeetCodeç¬¬300é¢˜)æ–‡ç« é“¾æ¥åŠ¨æ€è§„åˆ’ä¹‹æœ€é•¿é€’å½’å­åºåˆ— ä¸¤ä¸ªæ–¹æ³•ï¼š dp æ‰‘å…‹ç‰Œç®—æ³•ï¼Œè¿ç”¨äºŒåˆ†æŸ¥æ‰¾ dpæ³¨æ„äº‹é¡¹æœ€é‡è¦çš„æ˜¯å…ˆç¡®å®šçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œå¹¶ä¸”æ˜ç¡®dpæ•°ç»„çš„å«ä¹‰ï¼Œè¿™é‡Œè¦æ±‚çš„æ˜¯æœ€é•¿é€’å½’å­åºåˆ—ï¼Œæ‰€å»ºç«‹çš„dpæ•°ç»„æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„(ä¸ºä½•é€‰å–çš„æ˜¯ä¸€ç»´æ•°ç»„å‘¢ï¼Ÿ)ï¼Œå¹¶ä¸”dp[i]çš„å«ä¹‰æ˜¯æŒ‡ä»¥ç´¢å¼•iç»“å°¾çš„æœ€é•¿é€’å½’å­åºåˆ—ã€‚ é‡‡ç”¨å½’çº³æ³•å¯çŸ¥ï¼Œè‹¥dp[0â€¦i-1]å¯çŸ¥ï¼Œåˆ™ 1234for(int j = 0; j &lt; i;j++)&#123; if(nums[j] &lt; nums[i]) dp[i] = Math.max(dp[i],dp[j]+1);&#125; å³dp[i]æ˜¯ä¹‹å‰çš„dp[0â€¦i-1]ï¼Œåˆ¤æ–­å…¶æ˜¯å¦å°äºnums[i]ï¼Œè‹¥å°äºåˆ™nums[i]å¯ä»¥æ¥åˆ°å…¶åé¢ï¼Œæœ€åé€‰å–ä¸€ä¸ªæœ€é•¿çš„é€’å½’å­åºåˆ—å³å¯ã€‚ è¿˜æœ‰è¦è€ƒè™‘çš„å°±æ˜¯base caseï¼Œç”±äºæ˜¯æœ€çŸ­é€’å½’å­åºåˆ—è‡³å°‘ä¸º1ï¼Œæ‰€ä»¥base caseä¸º1ï¼Œæ‰€ä»¥dpæ•°ç»„å…¨éƒ¨åˆå§‹åŒ–ä¸º1å³å¯ã€‚ ä»£ç 123456789101112131415public int lengthOfLtsByDp(int nums[])&#123; int[] dp = new int[nums.length]; Arrays.fill(dp,1); for(int i = 0;i &lt; nums.length;i++)&#123; for(int j = 0; j &lt; i;j++)&#123; if(nums[j] &lt; nums[i]) dp[i] = Math.max(dp[i],dp[j]+1); &#125; &#125; int res = 0; for(int i = 0; i &lt; dp.length; i++)&#123; res = Math.max(res,dp[i]); &#125; return res;&#125; æ‰‘å…‹ç‰Œç®—æ³•æœ€é•¿é€’å½’å­åºåˆ—å…¶å®ç±»ä¼¼äºæˆ‘ä»¬å¹³æ—¶ç©çš„èœ˜è››çº¸ç‰Œï¼Œegï¼š2ï¼Œ3ï¼Œ1ï¼Œ9ï¼Œ7ï¼Œ4ï¼Œ6ï¼Œ3 ï¼ŒåŒä¸€å †çš„ç‰Œåªèƒ½æ˜¯å°çš„æ”¾åœ¨å¤§çš„ä¸Šé¢ï¼Œå¦‚ä¸Šï¼Œå°±åˆ†æˆ2ï¼Œ1 3 9ï¼Œ7ï¼Œ6ï¼Œ3 4 ä¸€å…±4å †ï¼Œåˆ™æœ€é•¿é€’å½’å­åºåˆ—æ•°ä¸º 4 ã€‚ è‡³äºå¦‚ä½•å¤„ç†æ‰‘å…‹ç‰Œæ”¾ç½®é—®é¢˜ï¼Œåˆ™å¯ä»¥é‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œå› ä¸ºå †é¡¶éƒ½æ˜¯æœ‰åºçš„ã€‚ 12345678910111213141516171819202122232425public int lengthOfLtsByBinarySearch(int[] nums)&#123; //å †çš„ä¸ªæ•° int piles = 0; //è®°å½•æ¯ä¸ªå †çš„æœ€ä¸Šé¢çš„ç‰Œï¼Œä¿è¯æœ‰åºï¼Œæ‰€ä»¥å¿…é¡»åˆ©ç”¨æœ€å·¦ä¾§è¾¹ç•Œçš„äºŒåˆ†æ³• int[] top = new int[nums.length]; for(int i = 0;i &lt; nums.length;i++)&#123; int poker = nums[i]; int left = 0; int right = piles; while(left &lt; right)&#123; int mid = left + (right - left) / 2; if(poker &lt; top[mid]) right = mid; else if(poker &gt; top[mid]) left = mid + 1; else right = mid; &#125; //leftçš„å–å€¼æœ‰[0,nums.length],å½“leftä¸ºnums.lengthæ—¶ï¼Œè¿™é‡Œæ˜¯pilesï¼Œè¯´æ˜ç‰Œå †ä¸Šçš„ç¬¬ä¸€å¼ ç‰Œå…¨éƒ¨æ¯”å®ƒå°ï¼Œåˆ™è¯´æ˜æ­¤æ—¶éœ€è¦æ–°å»ºä¸€ä¸ªç‰Œå † if (left == piles) piles++; top[left] = poker; &#125; return piles;&#125; â€‹ å­åºåˆ—è§£é¢˜æ¨¡æ¿æ–‡ç« é“¾æ¥å­åºåˆ—è§£é¢˜æ¨¡æ¿ æ”¶è·ä¸¤ç§æ€è·¯ dpæ•°ç»„ä¸ºä¸€ç»´æ•°ç»„ã€‚å¸¸è§é¢˜å‹æœ‰ æœ€é•¿é€’å¢å­åºåˆ—ã€‚åœ¨å­æ•°ç»„array[0..i]ä¸­ï¼Œä»¥array[i]ç»“å°¾çš„ç›®æ ‡å­åºåˆ—ï¼ˆæœ€é•¿é€’å¢å­åºåˆ—ï¼‰çš„é•¿åº¦æ˜¯dp[i]ã€‚ æ¨¡æ¿ï¼š 12345678int n = array.length;int[] dp = new int[n];for (int i = 1; i &lt; n; i++) &#123; for (int j = 0; j &lt; i; j++) &#123; dp[i] = æœ€å€¼(dp[i], dp[j] + ...) &#125;&#125; dpæ•°ç»„ä¸ºäºŒç»´æ•°ç»„ã€‚äºŒç»´æ•°ç»„åˆåˆ†ä¸ºæ˜¯å¯¹ä¸¤å­—ç¬¦ä¸²è€Œè¨€å’Œä¸€ä¸ªå­—ç¬¦ä¸²è€Œè¨€ã€‚ æ¨¡æ¿ï¼š 1234567891011int n = arr.length;int[][] dp = new dp[n][n];for (int i = 0; i &lt; n; i++) &#123; for (int j = 1; j &lt; n; j++) &#123; if (arr[i] == arr[j]) dp[i][j] = dp[i][j] + ... else dp[i][j] = æœ€å€¼(...) &#125;&#125; å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨çš„dpä¸ºäºŒç»´æ•°ç»„ã€‚å¸¸è§é¢˜å‹æœ‰ä¹‹å‰åšè¿‡çš„ æœ€é•¿å›æ–‡å­ä¸²ï¼Œä½¿ç”¨åŒæŒ‡é’ˆï¼Œä»ä¸¤è¾¹å‘ä¸­é—´é æ‹¢ï¼ŒäºŒç»´åˆ†åˆ«æŒ‡çš„æ˜¯å·¦ä¾§æŒ‡é’ˆå’Œå³ä¾§æŒ‡é’ˆçš„ç´¢å¼•å€¼ã€‚å¯ä»¥æ¨å¹¿åˆ°æœ€é•¿å›æ–‡å­åºåˆ—ã€‚ å¯¹ä¸¤ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨çš„dpä¸ºäºŒç»´æ•°ç»„ã€‚ä¾‹å¦‚ ç¼–è¾‘è·ç¦» å’Œ æœ€é•¿å…¬å…±å­åºåˆ— å›æ–‡å­åºåˆ—çš„æ±‚è§£(LeetCodeç¬¬516é¢˜)å›æ–‡å­åºåˆ—çš„æ±‚è§£ï¼Œæ˜¯åœ¨å›æ–‡å­ä¸²çš„åŸºç¡€ä¸Šè¿›è¡Œçš„ï¼Œdp[i][j] çš„é•¿åº¦å–å†³äºs[i]å’Œs[j]ä»¥åŠdp[i+1][j-1] å½“s[i] == s[j]æ—¶ï¼Œdp[i][j] = dp[i+1][j-1] + 2 å½“s[i] != s[j]æ—¶ï¼Œ dp[i][j] = Math.max(dp[i][j-1]ï¼Œdp[i+1][j]) å½“è½¬ç§»æ–¹ç¨‹å†™å¥½åï¼Œæœ€å¤§çš„éš¾ç‚¹å°±æ˜¯å¦‚ä½•éå†dpï¼Œå»ºè®®é‡‡ç”¨è¡¨çš„å½¢å¼ï¼Œä»æ–¹ç¨‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¿…é¡»å¾—åˆ°å·¦è¾¹ã€ä¸‹è¾¹ã€å·¦ä¸‹ï¼Œä¸‰ä¸ªdpè¡¨è¾¾å¼æ‰èƒ½å¾—åˆ°ä¸‹ä¸€ä¸ªdpè¡¨è¾¾å¼ï¼Œæ•…å¯ä»¥é‡‡ç”¨æ–œç€éå†çš„æ–¹å¼å’Œé€†å¾ªç¯ä»ä¸‹å¾€ä¸Šéå†å³å¯ã€‚ 123456789101112131415161718192021222324/** * æ–œç€éå†çš„dp * @param nums * @return */ private static int dp(int[] nums)&#123; int[][] dp = new int[nums.length][nums.length];// Arrays.fill(dp, 0); int j = 0; for(int i = 0;i &lt; nums.length;i++)&#123; dp[i][i] = 1; &#125; //æ–œç€å¾ªç¯éå† for(int n = 1;n &lt; nums.length;n++)&#123; for(int i = 0; i &lt; nums.length - n;i++)&#123; j = i + n; if(nums[i] == nums[j]) dp[i][j] = dp[i+1][j-1] + 2; else dp[i][j] = Math.max(dp[i][j-1],dp[i+1][j]); &#125; &#125; return dp[0][nums.length-1]; &#125; 12345678910111213141516171819202122232425 /** * é€†å¾ªç¯éå†çš„dp * @param nums * @return */ private static int dpByInverse(int[] nums)&#123; int[][] dp = new int[nums.length][nums.length];// Arrays.fill(dp, 0);// int j = 0; int n = nums.length; for(int i = 0;i &lt; nums.length;i++)&#123; dp[i][i] = 1; &#125; // åç€éå†ä¿è¯æ­£ç¡®çš„çŠ¶æ€è½¬ç§» for (int i = n - 1; i &gt;= 0; i--) &#123; for (int j = i + 1; j &lt; n; j++) &#123; // çŠ¶æ€è½¬ç§»æ–¹ç¨‹ if (nums[i] == nums[j]) dp[i][j] = dp[i + 1][j - 1] + 2; else dp[i][j] = Math.max(dp[i + 1][j], dp[i][j - 1]); &#125; &#125; return dp[0][nums.length-1]; &#125; ç¼–è¾‘è·ç¦»ï¼ˆLeetCodeç¬¬72é¢˜ï¼‰å…ˆæ€»ç»“ä¸€å“ˆï¼šä»åå¾€å‰ï¼Œç„¶åå†™é€’å½’å‡½æ•°ï¼Œç„¶åç”»DP Tableï¼Œå†™éé€’å½’ï¼Œæ³¨æ„Base caseï¼ æ–‡ç« é“¾æ¥ç¼–è¾‘è·ç¦» é¢˜ç›®ç»™å®šä¸¤ä¸ªå•è¯ word1 å’Œ word2ï¼Œè®¡ç®—å‡ºå°† word1 è½¬æ¢æˆ word2 æ‰€ä½¿ç”¨çš„æœ€å°‘æ“ä½œæ•° ã€‚ ä½ å¯ä»¥å¯¹ä¸€ä¸ªå•è¯è¿›è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š æ’å…¥ä¸€ä¸ªå­—ç¬¦åˆ é™¤ä¸€ä¸ªå­—ç¬¦æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ç¤ºä¾‹ 1: 123456è¾“å…¥: word1 = "horse", word2 = "ros"è¾“å‡º: 3è§£é‡Š: horse -&gt; rorse (å°† 'h' æ›¿æ¢ä¸º 'r')rorse -&gt; rose (åˆ é™¤ 'r')rose -&gt; ros (åˆ é™¤ 'e') ç¤ºä¾‹ 2: 12345678è¾“å…¥: word1 = "intention", word2 = "execution"è¾“å‡º: 5è§£é‡Š: intention -&gt; inention (åˆ é™¤ 't')inention -&gt; enention (å°† 'i' æ›¿æ¢ä¸º 'e')enention -&gt; exention (å°† 'n' æ›¿æ¢ä¸º 'x')exention -&gt; exection (å°† 'n' æ›¿æ¢ä¸º 'c')exection -&gt; execution (æ’å…¥ 'u') æ€è·¯ä¸ªäººè§‰å¾—å…¬ä¼—å·è¯´çš„æœ‰çš„å•°å—¦å“ˆ~ æˆ‘å°±ç¨å¾®æ€»ç»“ä¸€ä¸‹æˆ‘çš„æƒ³æ³•ï¼š æ‹¿åˆ°é¢˜ç›®ï¼Œåˆæ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹é—´çš„é—®é¢˜ï¼Œæ¯«æ— ç–‘é—®ç¬¬ä¸€æƒ³æ³•æƒ³åˆ°ä½¿ç”¨åŒæŒ‡é’ˆçš„dpï¼Œå› ä¸ºä¸€èˆ¬é‡åˆ°ä¸¤ä¸ªå­—ç¬¦ä¸²çš„é—®é¢˜éƒ½æ˜¯é‡‡ç”¨dpäºŒç»´æ•°ç»„è§£å†³(åŒæŒ‡é’ˆ)ï¼› dpè§£å†³é—®é¢˜ï¼Œé¦–å…ˆå°±è¦ææ¸…æ¥šdpæ•°ç»„ä»£è¡¨ä»€ä¹ˆï¼Œå…¶æ¬¡å°±æ˜¯çŠ¶æ€è½¬ç§»æœ‰å“ªå‡ ç§æƒ…å†µï¼ ä¸€èˆ¬dpäºŒç»´æ•°ç»„ dp[i][j] ,ä»£è¡¨ä»¥s1[i-1]ã€s2[j-1]ç»“å°¾çš„è½¬æ¢çš„æœ€å°‘æ“ä½œæ•°ï¼Œä¸ºå•¥æ˜¯i-1,j-1ï¼å› ä¸ºdpæ˜¯ä»dp[1][1]å¼€å§‹çš„ï¼Œä»£è¡¨å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼ï¼ ææ˜ç™½äº†dpæ•°ç»„æ˜¯å•¥å«ä¹‰ï¼Œç°åœ¨å°±è¦ææ¸…æ¥šæœ‰å“ªå‡ ç§çŠ¶æ€è½¬ç§»ï¼Œä»å…¬ä¼—å·ä¸­å¯ä»¥çœ‹åˆ°ï¼Œdp[i][j]æƒ³è¦å¾€å‰ç§»åŠ¨ï¼Œåˆ™å¯ä»¥è¿›è¡Œåˆ é™¤ã€ä¿®æ”¹ã€æ’å…¥æ“ä½œï¼Œå¦‚æœåŒæŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦ç›¸åŒï¼Œåˆ™æ— éœ€è¿›è¡Œä»»ä½•æ“ä½œï¼Œç›´æ¥å‘å‰ç§»åŠ¨å°±è¡Œï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶ dp[i][j] = dp[i-1][j-1] ; å‰©ä¸‹çš„æ’å…¥ã€åˆ é™¤ã€ä¿®æ”¹å¦‚ä½•åšå‘¢â€¦å–ä¸‰è€…æœ€å°å€¼å°±å¥½äº†å˜›ï¼ï¼ï¼ å…¶å®è¿™ä¸ªç”»ä¸ªDPè¡¨å°±éå¸¸çš„æ¸…æ™°äº†ï¼Œç”»DPè¡¨ä¹Ÿèƒ½æé†’æˆ‘ä»¬æ³¨æ„Base Case,å› ä¸ºæ²¡æœ‰Base Case ï¼Œæˆ‘ä»¬æ˜¯è‚¯å®šå†™ä¸å‡ºæ¥DPè¡¨ä¸­çš„å€¼çš„ï¼› æœ‰ä¸ªæ³¨æ„çš„ç‚¹ï¼Œå°±æ˜¯å¤‡å¿˜å½•åšæ³•æ˜¯ä»0å¼€å§‹çš„ï¼Œæ‰€ä»¥å½“iæˆ–è€…j = -1æ—¶ï¼Œæ­¤æ—¶çš„iã€jä»£è¡¨çš„æ˜¯æ•°ç»„çš„ä¸‹æ ‡ï¼Œæ˜¯ä»0å¼€å§‹çš„ï¼Œæ¯”å¦‚è¯´æ­¤æ—¶j = 5çš„ï¼Œè¯´æ˜è¿˜æœ‰6ä¸ªå­—ç¬¦éœ€è¦åˆ é™¤ï¼Œæ‰€ä»¥è¦è®°å¾—+1 ï¼Œè€Œdpæ˜¯ä»dp[1][1]å¼€å§‹çš„(æ¯”å¦‚ä¸¤ä¸ªå­—ç¬¦ä¸²â€™â€™abcâ€â€acdâ€ï¼Œdp[1][1]æŒ‡çš„æ˜¯éƒ½æŒ‡å‘a)ï¼ï¼ï¼ï¼è¿™ä¸ªå¾ˆå®¹æ˜“é”™ï¼ ä¸‰ç§åšæ³• å¸¸è§„æš´åŠ›é€’å½’(è¶…æ—¶) 123456789101112131415161718192021class Solution &#123; public int minDistance(String word1, String word2) &#123; int len = dp_violence(word1,word2,word1.length()-1,word2.length()-1); return len; &#125; private int dp_violence(String s1,String s2,int i, int j) &#123; if(i == -1) return j + 1; if(j == -1) return i + 1; if(s1.charAt(i) == s2.charAt(j))&#123; return dp_violence(s1,s2,i-1,j-1); &#125; else&#123; int min = Math.min(dp_violence(s1,s2,i-1,j-1)+1, dp_violence(s1,s2,i-1,j)+1); min = Math.min( dp_violence(s1,s2,i,j-1)+1,min); return min; &#125; &#125;&#125; å¸¦å¤‡å¿˜å½•çš„é€’å½’(è¿™ä¸ªè²Œä¼¼æ¯”dpæ›´ä¼˜ç§€) 1234567891011121314151617181920212223242526272829class Solution &#123; public int minDistance(String word1, String word2) &#123; int[][] beiwanglu = new int[word1.length()][word2.length()]; int len = dp_beiwanglu(beiwanglu,word1,word2,word1.length()-1,word2.length()-1); return len; &#125; private int dp_beiwanglu(int[][] beiwanglu,String s1, String s2, int i, int j) &#123; if(i == -1) return j + 1; if(j == -1) return i + 1; if(beiwanglu[i][j] != 0)&#123; return beiwanglu[i][j]; &#125; if(s1.charAt(i) == s2.charAt(j))&#123; beiwanglu[i][j] = dp_beiwanglu(beiwanglu,s1,s2,i-1,j-1); return dp_beiwanglu(beiwanglu,s1,s2,i-1,j-1); &#125; else&#123; int min = Math.min(dp_beiwanglu(beiwanglu,s1,s2,i-1,j-1)+1, dp_beiwanglu(beiwanglu,s1,s2,i-1,j)+1); min = Math.min( dp_beiwanglu(beiwanglu,s1,s2,i,j-1)+1,min); beiwanglu[i][j] = min; return min; &#125; &#125;&#125; dp 1234567891011121314151617181920212223class Solution &#123; public int minDistance(String s1, String s2) &#123; int[][] dp = new int[s1.length()+1][s2.length()+1]; for(int i = 0;i&lt;= s1.length();i++)&#123; dp[i][0] = i; &#125; for(int j = 0;j&lt;=s2.length();j++)&#123; dp[0][j] = j; &#125; for(int i = 1;i&lt;= s1.length();i++)&#123; for(int j = 1;j &lt;= s2.length();j++)&#123; if(s1.charAt(i-1) == s2.charAt(j-1))&#123; dp[i][j] = dp[i-1][j-1]; &#125; else&#123; dp[i][j] = Math.min(dp[i-1][j-1] + 1,dp[i-1][j] + 1); dp[i][j] = Math.min(dp[i][j],dp[i][j-1] + 1); &#125; &#125; &#125; return dp[s1.length()][s2.length()]; &#125;&#125; æœ€é•¿å…¬å…±å­åºåˆ—é—®é¢˜ï¼ˆLeetCodeç¬¬1143é¢˜ï¼‰å…¸å‹çš„dpäºŒç»´æ•°ç»„è§£å†³ï¼Œå¤ªç®€å•äº†â€¦ ç¬¬ä¸€ä¸ªè¦æ³¨æ„çš„å°±æ˜¯è¯¥dpå¯ä»¥ä¼˜åŒ–ï¼Œå½“åŒæŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦ä¸ç­‰æ—¶ï¼Œdp[i-1][j-1]å¯ä»¥ä¸ç”¨è€ƒè™‘ï¼ï¼ï¼ï¼å› ä¸ºmax(dp[i][j-1],dp[i-1][j],dp[i-1][j-1])æ˜¯ä¸€å®šè½®ä¸åˆ°æœ€åè¿™ä¸ªçš„ï¼› ç¬¬äºŒä¸ªè¦æ³¨æ„çš„ç‚¹å°±æ˜¯è®°å¾—Base Case,è®°å¾—è¦ç”»DPè¡¨ï¼ åŒæ ·è¦æ³¨æ„è¿™é‡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹åº”çš„å°±æ˜¯dp[1][1]ï¼ï¼ï¼ï¼ï¼ ä»£ç 1234567891011121314151617class Solution &#123; public int longestCommonSubsequence(String text1, String text2) &#123; int[][] dp = new int[text1.length() + 1][text2.length() + 1]; for(int i = 1;i &lt;= text1.length();i++)&#123; for(int j = 1;j &lt;=text2.length();j++)&#123; if(text1.charAt(i-1) == text2.charAt(j-1))&#123; dp[i][j] = dp[i-1][j-1] + 1; &#125; else&#123; dp[i][j] = Math.max(dp[i-1][j],dp[i][j-1]); &#125; &#125; &#125; return dp[text1.length()][text2.length()]; &#125;&#125; æ»‘åŠ¨çª—å£ç®—æ³•(ç¤ºä¾‹:LeetCodeç¬¬1143ï¼šæœ€å°è¦†ç›–å­ä¸²é—®é¢˜) Tipï¼šæœ€é‡è¦çš„æ˜¯è¿‡æœ€åä¸€ä¸ªç”¨ä¾‹çš„è‰°è¾›ï¼Œå› ä¸ºéœ€è¦è€ƒè™‘åˆ°Integeræ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¶…è¿‡-127~128ä¹‹åä¼šnewä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¯¼è‡´å°±ç®—æ˜¯å€¼ç›¸ç­‰ï¼Œå…¶ä¹Ÿä¼šæ˜¾ç¤ºä¸ç›¸ç­‰ï¼ï¼ï¼ï¼ï¼ï¼ï¼ æ–‡ç« é“¾æ¥æ»‘åŠ¨çª—å£ç®—æ³• ä»£ç æ–‡ç« ä¸­ä½¿ç”¨C++å®ç°çš„ï¼Œæˆ‘æ˜¯åœ¨LeetCodeç”¨çš„Javaå®ç°çš„ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566class Solution &#123; public String minWindow(String s, String t) &#123; // åˆ©ç”¨åŒæŒ‡é’ˆçš„æ€æƒ³ï¼Œå…ˆè®°å½•ä¸‹tä¼šå‡ºç°çš„å•è¯ä»¥åŠæ¬¡æ•° // ç„¶åå³æŒ‡é’ˆå¼€å§‹éå†ï¼Œæ¯å½“ä¸€ä¸ªå•è¯åŠå…¶æ¬¡æ•°åˆ°ä½åï¼Œå½“å‰å•è¯å°±åŒ¹é…å®Œæˆï¼Œç›´åˆ°æ‰€æœ‰å•è¯éƒ½åŒ¹é…å®Œæˆ // ç„¶åè®°å½•ä¸‹å½“å‰çš„å­ä¸²çš„å¼€å§‹å’Œç»“å°¾ï¼Œå³å·¦å³æŒ‡é’ˆçš„ä½ç½® // ç„¶åå¼€å§‹è¯•å›¾ç§»åŠ¨å·¦æŒ‡é’ˆï¼Œå½“ç„¶å‰ææ˜¯tä¸­æ‰€æœ‰å­—ç¬¦ç„¶åå…¨éƒ¨åŒ¹é…å®Œæˆï¼Œå¦åˆ™å°±è·³å‡ºå¾ªç¯ï¼Œç»§ç»­èµ°å³è¾¹æŒ‡é’ˆ // ç›´åˆ°å³è¾¹æŒ‡é’ˆèµ°åˆ°åº•ï¼Œå¦‚æœèµ°åˆ°åº•é•¿åº¦ä¾æ—§æ²¡æœ‰ï¼Œåˆ™è¯´æ˜æ‰¾ä¸åˆ°æœ€å°å­ä¸²ï¼Œè¿”å›"" å¦åˆ™è¿”å›é€‚å½“çš„å­ä¸² int left = 0,right = 0; //è®¡ç®—åŒ¹é…çš„å•è¯æ•°é‡ int match = 0; //ç»Ÿè®¡ç›®æ ‡å­—ç¬¦ä¸²çš„ä¸åŒå­—ç¬¦çš„ä¸ªæ•° int nums = 0; int min_length = Integer.MAX_VALUE; int start = 0; char[] t_char = t.toCharArray(); char[] s_char = s.toCharArray(); HashMap&lt;Character, Integer&gt; windows = new HashMap&lt;Character, Integer&gt;(); HashMap&lt;Character,Integer&gt; tt = new HashMap&lt;Character, Integer&gt;(); // ç”¨ä¸¤ä¸ªmapæ¥å­˜å‚¨ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå­˜å‚¨æ–¹å¼ä¸ºkeyä¸ºå•è¯ï¼Œvalueä¸ºå•è¯å‡ºç°çš„æ•°é‡ // for (char t1: t_char)&#123; if(tt.containsKey(t1)) &#123; int value = tt.get(t1).intValue(); tt.put(t1, ++value); &#125; else&#123; nums++; tt.put(t1,1); &#125; &#125; while(right &lt; s.length())&#123; if(windows.containsKey(s_char[right]))&#123; int windows_value = windows.get(s_char[right]).intValue(); windows.put(s_char[right],++windows_value); &#125; else&#123; windows.put(s_char[right],1); &#125; //å¦‚æœå…¨éƒ¨ç¬¦åˆè¦æ±‚ if(tt.containsKey(s_char[right]) &amp;&amp; windows.get(s_char[right]).intValue() == tt.get(s_char[right]).intValue())&#123; match++; &#125; right++; while(match == nums)&#123; //è¯´æ˜å·²ç»æ‰¾åˆ°ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„äº†ï¼Œè®°å½•ä¸‹è¯¥å­—ç¬¦ä¸²çš„èµ·å§‹å’Œç»“æŸä½ç½® int Len = right - left; if(Len &lt; min_length) &#123; min_length = Math.min(min_length,Len); start = left; &#125; int left_value = windows.get(s_char[left]).intValue(); left_value--; windows.put(s_char[left],left_value); if(tt.containsKey(s_char[left]) &amp;&amp; windows.get(s_char[left]).intValue() &lt; tt.get(s_char[left]).intValue())&#123; match--; &#125; left++; &#125; &#125; return min_length == Integer.MAX_VALUE ? "" : s.substring(start,min_length +start); &#125;&#125; æœ€å¤§å­åºåˆ—å’Œ(LeetCodeç¬¬53é¢˜)å…ˆæ€»ç»“ä¸€ä¸‹ï¼Œå¯ä»¥è¿ç”¨ dp å’Œ æ»‘åŠ¨çª—å£ ä¸¤ç§æ–¹æ³•ï¼ï¼ï¼ é¢˜ç›®ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚ ç¤ºä¾‹: 123è¾“å…¥: [-2,1,-3,4,-1,2,1,-5,4],è¾“å‡º: 6è§£é‡Š: è¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚ æ€è·¯ dp è¦çš„æ˜¯å­ä¸²ï¼Œå¿…ç„¶å¯ä»¥ç”¨dpï¼Œè€Œä¸”æ˜¯å•å­ä¸²ä¸”éå›æ–‡ï¼Œåˆ™å¿…ç„¶ä½¿ç”¨ä¸€ç»´dpæ•°ç»„ åªè¦å®šä¹‰å¥½äº†dpæ•°ç»„ï¼Œè¿™é“é¢˜å°±æ²¡æœ‰ä»»ä½•éš¾åº¦ï¼Œdp[i]å®šä¹‰ä¸ºä»¥iä¸ºç´¢å¼•çš„å­—ç¬¦ç»“å°¾çš„æœ€å¤§å’Œ åˆ™dp[i] = Math.max(dp[i-1],nums[i])ï¼Œç„¶åå–dp[i]ä¸­æœ€å¤§çš„å³å¯ï¼ è¿™é¢˜åªæœ‰ä¸€ä¸ªå°éš¾ç‚¹ï¼Œé‚£å°±æ˜¯æ‰¾Base Case,å¥½åƒå¹¶ä¸å­˜åœ¨Base Case,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ›é€ Base Case,å¯ä»¥ä»¤dp[0] = nums[0]ï¼Œè¿™æ ·å°±æœ‰Base Caseäº†ï¼ŒåŒæ—¶æ³¨æ„å“ˆï¼Œè¿™é‡Œä¸éœ€è¦å°†dpæ•°ç»„çš„å¤§å°å˜ä¸ºnums.length+1,å› ä¸ºè¿™ä¸ªé¢˜ç›®ä¸å­˜åœ¨Base Case,æ‰€ä»¥dpåªä¼šäº§ç”Ÿnä¸ªæ•°ï¼Œä¸éœ€è¦n+1ä¸ªå­˜å‚¨ç©ºé—´ï¼Œåƒä¸Šæ–‡çš„dpäºŒç»´æ•°ç»„ï¼Œå°±å­˜åœ¨BaseCaseï¼Œå½“æœ‰ä¸€ä¸ªä¸º0æ—¶ï¼Œæœ‰ç›¸åº”çš„å–å€¼ï¼æ€»è€Œè¨€ä¹‹ï¼Œä¸€å®šè¦ç‰¹åˆ«æ³¨æ„dpçš„æ•°ç»„å¤§å°ä»¥åŠBaseCaseã€‚ æ»‘åŠ¨çª—å£ æ¯”è¾ƒç®€å•çš„æ€è·¯ã€‚å°±æ˜¯sumå¦‚æœå¤§äº0äº†ï¼Œå°±ç§»åŠ¨å³æŒ‡é’ˆå°±è¡Œï¼Œå¦‚æœæ˜¯å°äº0äº†ï¼Œå°±æ¯”è¾ƒsumå’Œnum[i]ï¼Œå–æœ€å¤§å€¼(ç›¸å½“äºç§»åŠ¨å·¦æŒ‡é’ˆ)ï¼Œç›´åˆ°å¾ªç¯ç»“æŸã€‚ ä»£ç  dp 12345678910111213class Solution &#123; public int maxSubArray(int[] nums) &#123; //res[i] = Math.max(res[i-1] + nums[i],nums[i]) int[] res = new int[nums.length]; res[0] = nums[0]; int max = res[0]; for(int i = 1;i &lt; nums.length;i++)&#123; res[i] = Math.max(res[i-1] + nums[i],nums[i]); max = Math.max(res[i],max); &#125; return max; &#125;&#125; æ»‘åŠ¨çª—å£ 1234567891011121314class Solution &#123; public int maxSubArray(int[] nums) &#123; int res = nums[0]; int sum = 0; for(int num:nums)&#123; if(sum &gt; 0) sum += num; else sum = num; res = Math.max(sum,res); &#125; return res; &#125;&#125; æ‰“å®¶åŠ«èˆ Iã€IIã€III (LeetCodeç¬¬198ã€213ã€337)æ–‡ç« é“¾æ¥æ‰“å®¶åŠ«èˆç³»åˆ— I çš„ä»£ç  è‡ªå·±å†™çš„(æ„Ÿè§‰å†™çš„æœ‰ç‚¹å•°å—¦~) 123456789101112131415161718192021222324252627class Solution &#123; public int rob(int[] nums) &#123; int[] dp = new int[nums.length]; int res = 0; if(nums.length == 0 )&#123; return 0; &#125; if(nums.length == 1)&#123; dp[0] = nums[0]; res = dp[0]; return res; &#125; if(nums.length == 2)&#123; dp[1] = Math.max(nums[1],nums[0]); res = dp[1]; return res; &#125; dp[0] = nums[0]; dp[1] = Math.max(nums[1],nums[0]); for(int i = 2;i &lt; nums.length;i++)&#123; dp[i] = Math.max(dp[i-1],dp[i-2]+nums[i]); &#125; res = Math.max(dp[nums.length-1],res) return res; &#125;&#125; é«˜åˆ†é¢˜è§£ 123456789101112class Solution &#123; public int rob(int[] nums) &#123; int n = nums.length; if (n &lt;= 1) return n == 0 ? 0 : nums[0]; int[] memo = new int[n]; memo[0] = nums[0]; memo[1] = Math.max(nums[0], nums[1]); for (int i = 2; i &lt; n; i++) memo[i] = Math.max(memo[i - 1], nums[i] + memo[i - 2]); return memo[n - 1]; &#125;&#125; II çš„ä»£ç åˆ†ä¸¤æ¬¡dpå°±å¥½äº†ï¼Œä¸€æ¬¡[0,nums.length-2]ï¼Œä¸€æ¬¡[1,nums.length-1]ï¼Œå–æœ€å¤§å€¼å°±å¥½~ 12345678910111213141516171819202122232425262728293031class Solution &#123; public int rob(int[] nums) &#123; int[] dp = new int[nums.length]; int res = 0; if(nums.length == 0 )&#123; return 0; &#125; if(nums.length == 1)&#123; dp[0] = nums[0]; res = dp[0]; return res; &#125; if(nums.length == 2)&#123; dp[1] = Math.max(nums[1],nums[0]); res = dp[1]; return res; &#125; dp[0] = nums[0]; dp[1] = Math.max(nums[1],nums[0]); for(int i = 2;i &lt; nums.length-1;i++)&#123; dp[i] = Math.max(dp[i-1],dp[i-2]+nums[i]); &#125; dp[1] = nums[1]; dp[2] = Math.max(nums[1],nums[2]); for(int i = 3;i &lt; nums.length;i++)&#123; dp[i] = Math.max(dp[i-1],dp[i-2]+nums[i]); &#125; res = Math.max(dp[nums.length-1],dp[nums.length-2]); return res; &#125;&#125; III çš„ä»£ç è¿™æ˜¯ä¸€ä¸ªæ ‘å½¢çš„dpé—®é¢˜ï¼Œè§£å†³æ–¹æ³•æ˜¯é‡‡ç”¨ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œä¹‹å‰çš„I IIåªç”¨åˆ°äº†dp[nums.length-1]ï¼Œè¿™é‡Œç”¨åˆ°äº†ä¸¤ä¸ª,è€Œä¸”è¿™é‡Œçš„dpç«Ÿç„¶ç”¨äº†é€’å½’å“Ÿâ€¦ Tip:ç‰¹æ®Šåšæ³•è®°å¿†è®°å¿†è®°å¿†ï¼ï¼ï¼ 12345678910111213141516171819202122232425262728293031/** * Definition for a binary tree node. * public class TreeNode &#123; * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public int rob(TreeNode root) &#123; int[] res = robIn(root); return Math.max(res[0],res[1]); &#125; private static int[] robIn(TreeNode root)&#123; //ç”¨ä¸€ä¸ªæ•°ç»„è®°å½•å·æ ¹èŠ‚ç‚¹å’Œä¸å·æ ¹èŠ‚ç‚¹ä¸¤ç§æƒ…å†µï¼Œè¿™é‡Œå¾ˆç‰¹æ®Šç”¨äº†dpåŒæ—¶è¿˜æ­é…äº†é€’å½’ //è¿™å°±æ˜¯è‡ªåº•å‘ä¸Šçš„é€’å½’ï¼Œè¯¦æƒ…å¯ä»¥è§LeetCodeé€’å½’ä¸“é¢˜ int[] res = new int[2]; if(root == null)&#123; return res; &#125; int[] left = robIn(root.left); int[] right = robIn(root.right); //å·æ ¹èŠ‚ç‚¹ res[0] = root.val + left[1] + right[1]; //ä¸å·æ ¹èŠ‚ç‚¹ res[1] = Math.max(left[0],left[1]) + Math.max(right[0],right[1]); return res; &#125;&#125;]]></content>
      <categories>
        <category>ç¨‹åºå‘˜</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>LeetCode</tag>
        <tag>dp</tag>
        <tag>äºŒåˆ†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æƒ³å­¦çš„ä¸œè¥¿]]></title>
    <url>%2F2019%2F12%2F20%2F%E6%83%B3%E5%AD%A6%E7%9A%84%E4%B8%9C%E8%A5%BF.html</url>
    <content type="text"><![CDATA[dp äºŒå‰æ ‘é—®é¢˜ç»ƒä¹  é“¾è¡¨é—®é¢˜é›†ä¸­ç»ƒä¹  å¾®æœåŠ¡ è®¾è®¡æ¨¡å¼ javaåŸºç¡€ é¢ç»springå¸¸é—®çš„é—®é¢˜ å¹¶å‘ã€JVM]]></content>
  </entry>
  <entry>
    <title><![CDATA[SpringCloud å¾®æœåŠ¡ç¬”è®°]]></title>
    <url>%2F2019%2F12%2F13%2FSpringCloud%E7%AC%94%E8%AE%B0.html</url>
    <content type="text"><![CDATA[å¾®æœåŠ¡æ¶æ„æ¦‚è¿°å•ä½“æ¶æ„ä¸€ä¸ªå½’æ¡£åŒ…(waræ ¼å¼)åŒ…å«æ‰€æœ‰åŠŸèƒ½çš„åº”ç”¨ç¨‹åºï¼Œé€šå¸¸ç§°ä¸ºå•ä½“åº”ç”¨ã€‚ å­˜åœ¨çš„é—®é¢˜ï¼š å¤æ‚æ€§é«˜ æŠ€æœ¯å€ºåŠ¡(ä¸åä¸ä¿®) éƒ¨ç½²é¢‘ç‡ä½ å¯é æ€§å·® æ‰©å±•èƒ½åŠ›å—é™ï¼Œä¸åŒæ¨¡å—å¯èƒ½éœ€è¦çš„é…ç½®ä¸ä¸€æ ·ï¼Œæœ‰çš„éœ€è¦CPUå¥½ä¸€ç‚¹çš„ï¼Œæœ‰çš„éœ€è¦å­˜å‚¨å¤§ä¸€ç‚¹çš„ï¼Œä¸èƒ½æ ¹æ®ä¸šåŠ¡æ¨¡å—çš„éœ€è¦è¿›è¡Œä¼¸ç¼© é˜»ç¢æŠ€æœ¯åˆ›æ–°ï¼Œå•ä½“åº”ç”¨å¾€å¾€ä½¿ç”¨ç»Ÿä¸€çš„æŠ€æœ¯å¹³å°æˆ–è€…æ–¹æ¡ˆè§£å†³æ‰€æœ‰çš„é—®é¢˜ å¾®æœåŠ¡å¾®æœåŠ¡æ¶æ„é£æ ¼ï¼šå°†ä¸€ä¸ªå•ä¸€åº”ç”¨ç¨‹åºå¼€å‘ä¸ºä¸€ç»„å°å‹æœåŠ¡çš„æ–¹æ³•ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡é—´é€šä¿¡é‡‡ç”¨è½»é‡çº§é€šä¿¡æœºåˆ¶ï¼Œå¯é€šè¿‡å…¨è‡ªåŠ¨éƒ¨ç½²æœºåˆ¶ç‹¬ç«‹éƒ¨ç½²ã€‚è¿™äº›æœåŠ¡å…±ç”¨ä¸€ä¸ªæœ€å°å‹çš„é›†ä¸­å¼çš„ç®¡ç†ï¼Œä¸åŒæœåŠ¡å¯ä»¥é‡‡ç”¨ä¸åŒçš„è¯­è¨€å¼€å‘ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®å­˜å‚¨æŠ€æœ¯ã€‚ ç‰¹æ€§ æ¯ä¸ªå¾®æœåŠ¡å¯ä»¥ç‹¬ç«‹è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­ æ¯ä¸ªæœåŠ¡ä¸ºç‹¬ç«‹çš„ä¸šåŠ¡å¼€å‘ å¾®æœåŠ¡é€šè¿‡ç±»ä¼¼äºRESTful APIç­‰ä¸€äº›è½»é‡çº§çš„é€šä¿¡æœºåˆ¶è¿›è¡Œé€šä¿¡ å…¨è‡ªåŠ¨çš„éƒ¨ç½²æœºåˆ¶ ä¼˜ç‚¹ æ˜“äºå¼€å‘å’Œç»´æŠ¤ å¯åŠ¨é€Ÿåº¦å¿« å±€éƒ¨ä¿®æ”¹æ˜“éƒ¨ç½² æŠ€æœ¯æ ˆå¹¶ä¸å—é™ æŒ‰éœ€ä¼¸ç¼© ç¼ºç‚¹ è¿ç»´è¦æ±‚é«˜ï¼Œå› ä¸ºä¼šæœ‰å‡ åç”šè‡³ä¸Šç™¾ä¸ªæœåŠ¡åä½œè¿è¡Œ åˆ†å¸ƒå¼å›ºæœ‰çš„å¤æ‚æ€§ æ¥å£è°ƒæ•´æˆæœ¬é«˜ é‡å¤åŠ³åŠ¨ å¾®æœåŠ¡è®¾è®¡åŸåˆ™ å•ä¸€èŒè´£åŸåˆ™(SOLIDåŸåˆ™ä¹‹ä¸€) æœåŠ¡è‡ªæ²»åŸåˆ™ã€‚å³æ¯ä¸ªå¾®æœåŠ¡åº”å…·å¤‡ç‹¬ç«‹çš„ä¸šåŠ¡èƒ½åŠ›ã€ä¾èµ–ä¸è¿è¡Œç¯å¢ƒã€‚ è½»é‡çº§é€šä¿¡æœºåˆ¶ã€‚å¸¸ç”¨çš„æœ‰RESTã€AMQPã€STOMPã€MQTTç­‰ã€‚ å¾®æœåŠ¡ç²’åº¦ã€‚è¿™ä¸ªæ¯”è¾ƒéš¾ä»¥æ§åˆ¶ï¼Œä¸€èˆ¬é€šè¿‡é¢†åŸŸé©±åŠ¨è®¾è®¡(Domain Driven Designï¼ŒDDD)ä¸­çš„é™å®šä¸Šä¸‹æ–‡å¯ä½œä¸ºåˆ’åˆ†å¾®æœåŠ¡è¾¹ç•Œã€ç¡®å®šå¾®æœåŠ¡ç²’åº¦ã€‚ å¾®æœåŠ¡æ¶æ„æŠ€æœ¯é€‰å‹ä¸»æµçš„è§£å†³æ–¹æ¡ˆæ˜¯ SpringCloudã€Dubbo å…·ä½“çš„æ¡†æ¶å¯¹æ¯”ï¼šDubbo VS SpringCloud å¾®æœåŠ¡å¼€å‘æ¡†æ¶â€”â€”Spring CloudSpring Cloud ç®€ä»‹ å¹¶ä¸æ˜¯äº‘è®¡ç®—è§£å†³æ–¹æ¡ˆï¼Œæ˜¯åœ¨Spring BootåŸºç¡€ä¸Šç”¨äºå¿«é€Ÿæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„é€šç”¨æ¨¡å¼çš„å·¥å…·é›† ä½¿ç”¨Spring Cloudå¼€å‘çš„ç¨‹åºéå¸¸é€‚åˆåœ¨Dockeræˆ–è€…PaaSä¸Šéƒ¨ç½²,æ‰€ä»¥åˆå«äº‘åŸç”Ÿåº”ç”¨ï¼Œäº‘åŸç”Ÿå¯ç†è§£ä¸ºé¢å‘äº‘ç¯å¢ƒçš„è½¯ä»¶æ¶æ„ äº‘åŸç”Ÿæ¶æ„çš„æ–¹æ³•è®ºå’Œæœ€ä½³å®è·µï¼š12-factor Apps Tipsï¼š äº‘æœåŠ¡åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯ IaaS(åŸºç¡€è®¾æ–½æœåŠ¡)ã€PaaS(å¹³å°æœåŠ¡)ã€SaaS(è½¯ä»¶æœåŠ¡) ä¼ é€é—¨ï¼šIaaSï¼ŒPaaSï¼ŒSaaS çš„åŒºåˆ« Spring Cloud å’Œ Spring Boot çš„è”ç³»é¦–å…ˆï¼ŒçŸ¥ä¹ä¸Šå¯¹è¿™ä¸ªæœ‰æ¯”è¾ƒå¥½çš„å›ç­”ï¼šSpring Cloud &amp; Spring Boot æ€»ç»“ä¸€ä¸‹è¯´çš„æ¯”è¾ƒå¥½çš„ï¼š spring Cloudæ˜¯ä¸€ä¸ªåŸºäºSpring Bootå®ç°çš„äº‘åº”ç”¨å¼€å‘å·¥å…·ï¼Œå®ƒä¸ºåŸºäºJVMçš„äº‘åº”ç”¨å¼€å‘ä¸­çš„é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€æ–­è·¯å™¨ã€æ™ºèƒ½è·¯ç”±ã€å¾®ä»£ç†ã€æ§åˆ¶æ€»çº¿ã€å…¨å±€é”ã€å†³ç­–ç«é€‰ã€åˆ†å¸ƒå¼ä¼šè¯å’Œé›†ç¾¤çŠ¶æ€ç®¡ç†ç­‰æ“ä½œæä¾›äº†ä¸€ç§ç®€å•çš„å¼€å‘æ–¹å¼ã€‚ spring boot çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å¿«é€Ÿå¯åŠ¨ï¼Œå¿«é€Ÿæ„å»ºåº”ç”¨ç¨‹åºï¼Œè€Œä¸éœ€è¦å¤ªå¤šçš„é…ç½®æ–‡ä»¶ã€‚ spring cloud æ˜¯åˆ†å¸ƒå¼å¼€å‘çš„è§£å†³æ–¹æ¡ˆï¼ŒåŸºäºspring boot,åœ¨spring bootåšè¾ƒå°‘çš„é…ç½®ï¼Œä¾¿å¯æˆä¸º spring cloud ä¸­çš„ä¸€ä¸ªå¾®æœåŠ¡ã€‚ æœ€åŸºç¡€çš„éƒ½æ˜¯springï¼Œç„¶ååœ¨è¿™ä¸ªåŸºç¡€ä¸Šspring bootåšäº†ä¸€äº›è‡ªåŠ¨é…ç½®å’Œå®ç°ï¼Œç„¶ååˆåœ¨spring bootçš„åŸºç¡€ä¸ŠåŠ å…¥äº†åˆ†å¸ƒå¼è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ï¼Œè¿™æ‰æœ‰äº†spring cloudã€‚ Spring cloudæ˜¯å¾®æœåŠ¡å¼€å‘å¥—ä»¶ã€‚springboot=spring+springmvcï¼Œspringcloud=springboot+ribbon+æ³¨å†Œä¸­å¿ƒ+ç†”æ–­å™¨+â€¦ç­‰ä¸€ç³»åˆ—ç»„ä»¶ã€‚ Spring Cloud ç‰¹ç‚¹ çº¦å®šä¼˜äºé…ç½® éšè—äº†ç»„ä»¶å¤æ‚æ€§ï¼Œå¹¶ä¸”æä¾›å£°æ˜å¼çš„é…ç½®æ–¹å¼ è½»é‡çº§çš„ç»„ä»¶ï¼Œå¦‚Eurekaã€Zuulç­‰ è§£è€¦ï¼Œçµæ´» Spring Cloud ç‰ˆæœ¬ä»¥SRXå½¢å¼å‘½åç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·å‰é¢ä¼šæœ‰ä¸€ä¸ª release trainã€‚ ä»ä»¥å¾€çš„ç‰ˆæœ¬æœ‰Dalstonã€Edgwareã€Finchleyã€Greenwichï¼Œæ­£åœ¨å­µåŒ–çš„æœ‰SpringCloud Alibabaã€‚ Spring Cloud å®æˆ˜å¾®æœåŠ¡(Finchleyç‰ˆæœ¬)æ¦‚è¿°Spring Cloudæ”¯æŒçš„æ’ä»¶ä¼—å¤šï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹Spring Cloudä¸­æ–‡ç½‘æä¾›çš„æ¯”è¾ƒä¼˜ç§€çš„æ’ä»¶ï¼š Spring Cloudé›†æˆçš„ç›¸å…³ä¼˜è´¨é¡¹ç›®æ¨è Eurekaï¼šæ³¨å†Œä¸­å¿ƒï¼Œäº‘ç«¯æœåŠ¡å‘ç°ï¼Œå®ç°äº‘ç«¯ä¸­é—´å±‚æœåŠ¡å‘ç°å’Œæ•…éšœè½¬ç§» Ribbonï¼šè´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥æœ‰å¤šç§è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ä¾›é€‰æ‹©ï¼Œå¯é…åˆEurekaå’ŒHystrixä½¿ç”¨ Hystrixï¼šç†”æ–­å™¨ï¼Œå®¹é”™ç®¡ç†å·¥å…·ï¼Œæ—¨åœ¨é€šè¿‡ç†”æ–­æœºåˆ¶æ§åˆ¶æœåŠ¡å’Œç¬¬ä¸‰æ–¹åº“çš„èŠ‚ç‚¹,ä»è€Œå¯¹å»¶è¿Ÿå’Œæ•…éšœæä¾›æ›´å¼ºå¤§çš„å®¹é”™èƒ½åŠ› Turbineï¼šTurbineæ˜¯èšåˆæœåŠ¡å™¨å‘é€äº‹ä»¶æµæ•°æ®çš„ä¸€ä¸ªå·¥å…·ï¼Œç”¨æ¥ç›‘æ§é›†ç¾¤ä¸‹hystrixçš„metricsæƒ…å†µï¼ˆå¯è§†åŒ–ï¼‰ Feignï¼šå£°æ˜å¼ã€æ¨¡å—åŒ–çš„HTTPå®¢æˆ·ç«¯ï¼Œé›†æˆäº†è´Ÿè½½å‡è¡¡ Zuulï¼šäº‘å¹³å°ä¸Šæä¾›åŠ¨æ€è·¯ç”±ï¼Œç›‘æ§ï¼Œå¼¹æ€§ï¼Œå®‰å…¨ç­‰è¾¹ç¼˜æœåŠ¡çš„æ¡†æ¶ã€‚Zuul ç›¸å½“äºæ˜¯è®¾å¤‡å’Œ Netflix æµåº”ç”¨çš„ Web ç½‘ç«™åç«¯æ‰€æœ‰è¯·æ±‚çš„å‰é—¨ Configï¼šé…ç½®ç®¡ç†å·¥å…·åŒ…ï¼Œè®©ä½ å¯ä»¥æŠŠé…ç½®æ”¾åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œé›†ä¸­åŒ–ç®¡ç†é›†ç¾¤é…ç½®ï¼Œç›®å‰æ”¯æŒæœ¬åœ°å­˜å‚¨ã€Gitä»¥åŠSubversion Busï¼šäº‹ä»¶ã€æ¶ˆæ¯æ€»çº¿ï¼Œç”¨äºåœ¨é›†ç¾¤ï¼ˆä¾‹å¦‚ï¼Œé…ç½®å˜åŒ–äº‹ä»¶ï¼‰ä¸­ä¼ æ’­çŠ¶æ€å˜åŒ–ï¼Œå¯ä¸Spring Cloud Configè”åˆå®ç°çƒ­éƒ¨ç½² Sleuthï¼šæ—¥å¿—æ”¶é›†å·¥å…·åŒ…ï¼Œå°è£…äº†Dapperå’Œlog-basedè¿½è¸ªä»¥åŠZipkinå’ŒHTraceæ“ä½œï¼Œä¸ºSpringCloudåº”ç”¨å®ç°äº†ä¸€ç§åˆ†å¸ƒå¼è¿½è¸ªè§£å†³æ–¹æ¡ˆ Streamï¼šæ•°æ®æµæ“ä½œå¼€å‘åŒ…ï¼Œå°è£…äº†ä¸Redis,Rabbitã€Kafkaç­‰å‘é€æ¥æ”¶æ¶ˆæ¯ Securityï¼šåŸºäºspring securityçš„å®‰å…¨å·¥å…·åŒ…ï¼Œä¸ºä½ çš„åº”ç”¨ç¨‹åºæ·»åŠ å®‰å…¨æ§åˆ¶ å®ä¾‹ä½¿ç”¨æœåŠ¡æä¾›è€…ä¸æœåŠ¡æ¶ˆè´¹è€…æ¥æè¿°å¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€‚ä¸‹è¡¨è§£é‡Šäº†æœåŠ¡æä¾›è€…ä¸æœåŠ¡æ¶ˆè´¹è€…ã€‚ â€‹ è¡¨-æœåŠ¡æä¾›è€…ä¸æœåŠ¡æ¶ˆè´¹è€… åè¯ å®šä¹‰ æœåŠ¡æä¾›è€… æœåŠ¡çš„è¢«è°ƒç”¨æ–¹ï¼ˆå³ï¼šä¸ºå…¶ä»–æœåŠ¡æä¾›æœåŠ¡çš„æœåŠ¡ï¼‰ æœåŠ¡æ¶ˆè´¹è€… æœåŠ¡çš„è°ƒç”¨æ–¹ï¼ˆå³ï¼šä¾èµ–å…¶ä»–æœåŠ¡çš„æœåŠ¡ï¼‰ ä»¥ç”µå½±å”®ç¥¨ç³»ç»Ÿä¸ºä¾‹ã€‚å¦‚å›¾ï¼Œç”¨æˆ·å‘ç”µå½±å¾®æœåŠ¡å‘èµ·äº†ä¸€ä¸ªè´­ç¥¨çš„è¯·æ±‚ã€‚åœ¨è¿›è¡Œè´­ç¥¨çš„ä¸šåŠ¡æ“ä½œå‰ï¼Œç”µå½±å¾®æœåŠ¡éœ€è¦è°ƒç”¨ç”¨æˆ·å¾®æœåŠ¡çš„æ¥å£ï¼ŒæŸ¥è¯¢å½“å‰ç”¨æˆ·çš„ä½™é¢æ˜¯å¤šå°‘ã€æ˜¯ä¸æ˜¯ç¬¦åˆè´­ç¥¨æ ‡å‡†ç­‰ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œç”¨æˆ·å¾®æœåŠ¡å°±æ˜¯ä¸€ä¸ªæœåŠ¡æä¾›è€…ï¼Œç”µå½±å¾®æœåŠ¡åˆ™æ˜¯ä¸€ä¸ªæœåŠ¡æ¶ˆè´¹è€…ã€‚ å›´ç»•è¯¥åœºæ™¯ï¼Œå…ˆæ¥ç¼–å†™ä¸€ä¸ªç”¨æˆ·å¾®æœåŠ¡ï¼Œç„¶åç¼–å†™ä¸€ä¸ªç”µå½±å¾®æœåŠ¡ã€‚ Eurekaæ³¨å†Œä¸­å¿ƒï¼Œäº‘ç«¯æœåŠ¡å‘ç°ï¼Œå®ç°äº‘ç«¯ä¸­é—´å±‚æœåŠ¡å‘ç°å’Œæ•…éšœè½¬ç§» ä¸å¦¨å…ˆæ€è€ƒä¸€ä¸‹ï¼Œæ€æ ·æ‰èƒ½è®©æœåŠ¡æ¶ˆè´¹è€…æ€»èƒ½æ‰¾åˆ°æœåŠ¡æä¾›è€…å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œæ€æ ·æ‰èƒ½è®©æœåŠ¡æ¶ˆè´¹è€…æ„ŸçŸ¥åˆ°æœåŠ¡æä¾›è€…åœ°å€çš„å˜åŒ–å‘¢ï¼Ÿ TIPS ç›®å‰å¸‚é¢ä¸ŠæŠŠæœåŠ¡æ¶ˆè´¹è€…æ‰¾åˆ°æœåŠ¡æä¾›è€…çš„è¿™ç§æœºåˆ¶ç§°ä¸ºæœåŠ¡å‘ç°ï¼Œåˆæˆ–è€…æœåŠ¡æ³¨å†Œã€‚ä¸‹é¢æ¥æ¢ç´¢æœåŠ¡å‘ç°ç©¶ç«Ÿæ˜¯æ€ä¹ˆå›äº‹ã€‚ æœåŠ¡å‘ç°åŸç†åˆæ¢å…¶å®ï¼ŒæœåŠ¡å‘ç°æœºåˆ¶éå¸¸ç®€å•ï¼Œä¸å¦¨ç”¨å¤§å®¶ç†Ÿæ‚‰çš„MySQLæ¥ç±»æ¯”â€”â€”åªéœ€ä¸€å¼ è¡¨ï¼ˆå›¾ä¸­çš„registryè¡¨ï¼‰å³å¯å®ç°æœåŠ¡å‘ç°ï¼ å¦‚å›¾ï¼Œå¦‚æœæˆ‘ä»¬èƒ½åœ¨ï¼š åº”ç”¨å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨å¾€registryè¡¨ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œæ•°æ®åŒ…æ‹¬æœåŠ¡åç§°ã€IPã€ç«¯å£ç­‰ä¿¡æ¯ã€‚ åº”ç”¨åœæ­¢æ—¶ï¼Œè‡ªåŠ¨æŠŠè‡ªå·±åœ¨registryè¡¨ä¸­çš„æ•°æ®çš„statusè®¾ä¸ºDOWN ã€‚ è¿™æ ·ï¼ŒæœåŠ¡æ¶ˆè´¹è€…ä¸å°±æ°¸è¿œéƒ½èƒ½æ‰¾åˆ°æœåŠ¡æä¾›è€…äº†å˜›ï¼å½“æœåŠ¡æ¶ˆè´¹è€…æƒ³è°ƒç”¨æœåŠ¡æä¾›è€…æ¥å£æ—¶ï¼Œåªéœ€å‘æ•°æ®åº“å‘é€SQLè¯­å¥ SELECT * FROM registry where service_name = &#39;user&#39; and status = &#39;UP&#39; å³å¯æ‰¾åˆ°æœåŠ¡æä¾›è€…çš„æ‰€æœ‰å®ä¾‹ï¼IPã€ç«¯å£å•¥çš„éƒ½æœ‰äº†ï¼Œè‡ªå·±æ‹¼æ¥ä¸€ä¸‹ï¼Œå†å»è°ƒç”¨å°±è¡Œäº†ï¼ TIPS çœ‹ï¼ŒæœåŠ¡å‘ç°æœºåˆ¶æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿç¨‹åºçŒ¿ç»™å›¾ä¸­çš„â€MySQLâ€œçš„ç»„ä»¶èµ·äº†ä¸€ä¸ªç‰›å‰çš„åå­—å«ï¼šâ€æ³¨å†Œä¸­å¿ƒâ€œï¼Œä¹Ÿæœ‰çš„ä¹¦å°†å…¶ç§°ä¸ºâ€æœåŠ¡å‘ç°ç»„ä»¶â€œã€‚ ä½†ï¼Œè¿™æ¯•ç«Ÿåªæ˜¯ä¸€ä¸ªæœ€ç®€é™‹çš„æœåŠ¡å‘ç°åŸç†ã€‚å®Œæ•´çš„æœåŠ¡å‘ç°è¦è€ƒè™‘çš„é—®é¢˜æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼š å½“æœåŠ¡æŠ‘æˆ–æ‰€åœ¨ä¸»æœºçªç„¶å´©æºƒæˆ–è€…è¿›å…¥æŸç§ä¸æ­£å¸¸çš„æƒ…å†µæ— æ³•æä¾›æœåŠ¡ï¼ˆä¾‹å¦‚åº”ç”¨çš„æ•°æ®åº“æŒ‚äº†ï¼‰æ—¶ï¼Œå¯¹åº”çš„æ•°æ®ç†åº”æ ‡è®°DOWNï¼Œæˆ–è€…ç´¢æ€§åˆ é™¤ï¼› å¦‚æœæ¯æ¬¡è°ƒç”¨ä¹‹å‰ï¼Œéƒ½å¾—å‘æœåŠ¡å‘ç°ç»„ä»¶å‘é€ç±»ä¼¼SELECT * FROM registry where service_name = &#39;user&#39; and status = &#39;UP&#39; çš„è¯­å¥ï¼Œé‚£ä¹ˆæœåŠ¡å‘ç°ç»„ä»¶çš„å‹åŠ›å¾—æœ‰å¤šå¤§ï¼Ÿæ›´é‡è¦çš„ï¼Œè¿™ä¸å½“ä¸‹æµè¡Œçš„å»ä¸­å¿ƒåŒ–è®¾è®¡çš„æ€æƒ³ç›¸æ‚–ï¼› æœåŠ¡å‘ç°ç»„ä»¶å³ä½¿æŒ‚æ‰ï¼Œä¹Ÿä¸åº”è¯¥å½±å“å¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ã€‚ é‚£ä¹ˆï¼Œä¸€ä¸ªå®Œå–„çš„æœåŠ¡å‘ç°ç»„ä»¶åº”è¯¥å…·å¤‡å“ªäº›èƒ½åŠ›å‘¢ï¼Ÿ æœåŠ¡å‘ç°åŸç†æ·±å…¥ä¸å¦¨æ¥çœ‹ä¸€ä¸‹ä½¿ç”¨æœåŠ¡å‘ç°ç»„ä»¶åçš„æ¶æ„å›¾ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ æœåŠ¡æä¾›è€…ã€æœåŠ¡æ¶ˆè´¹è€…ã€æœåŠ¡å‘ç°ç»„ä»¶è¿™ä¸‰è€…ä¹‹é—´çš„å…³ç³»å¤§è‡´å¦‚ä¸‹ï¼š å„ä¸ªå¾®æœåŠ¡åœ¨å¯åŠ¨æ—¶ï¼Œå°†è‡ªå·±çš„ç½‘ç»œåœ°å€ç­‰ä¿¡æ¯æ³¨å†Œåˆ°æœåŠ¡å‘ç°ç»„ä»¶ä¸­ï¼ŒæœåŠ¡å‘ç°ç»„ä»¶ä¼šå­˜å‚¨è¿™äº›ä¿¡æ¯ï¼› æœåŠ¡æ¶ˆè´¹è€…å¯ä»æœåŠ¡å‘ç°ç»„ä»¶æŸ¥è¯¢æœåŠ¡æä¾›è€…çš„ç½‘ç»œåœ°å€ï¼Œå¹¶ä½¿ç”¨è¯¥åœ°å€è°ƒç”¨æœåŠ¡æä¾›è€…çš„æ¥å£ï¼› å„ä¸ªå¾®æœåŠ¡ä¸æœåŠ¡å‘ç°ç»„ä»¶ä½¿ç”¨ä¸€å®šæœºåˆ¶ï¼ˆä¾‹å¦‚å¿ƒè·³ï¼‰é€šä¿¡ã€‚æœåŠ¡å‘ç°ç»„ä»¶å¦‚é•¿æ—¶é—´æ— æ³•ä¸æŸå¾®æœåŠ¡å®ä¾‹é€šä¿¡ï¼Œå°±ä¼šè‡ªåŠ¨æ³¨é”€ï¼ˆå³ï¼šåˆ é™¤ï¼‰è¯¥å®ä¾‹ï¼› å½“å¾®æœåŠ¡ç½‘ç»œåœ°å€å‘ç”Ÿå˜æ›´ï¼ˆä¾‹å¦‚å®ä¾‹å¢å‡æˆ–è€…IPç«¯å£å‘ç”Ÿå˜åŒ–ç­‰ï¼‰æ—¶ï¼Œä¼šé‡æ–°æ³¨å†Œåˆ°æœåŠ¡å‘ç°ç»„ä»¶ï¼› å®¢æˆ·ç«¯ç¼“å­˜ï¼šå„ä¸ªå¾®æœåŠ¡å°†éœ€è¦è°ƒç”¨æœåŠ¡çš„åœ°å€ç¼“å­˜åœ¨æœ¬åœ°ï¼Œå¹¶ä½¿ç”¨ä¸€å®šæœºåˆ¶æ›´æ–°ï¼ˆä¾‹å¦‚å®šæ—¶ä»»åŠ¡æ›´æ–°ã€äº‹ä»¶æ¨é€æ›´æ–°ç­‰ï¼‰ã€‚è¿™æ ·æ—¢èƒ½é™ä½æœåŠ¡å‘ç°ç»„ä»¶çš„å‹åŠ›ï¼ŒåŒæ—¶ï¼Œå³ä½¿æœåŠ¡å‘ç°ç»„ä»¶å‡ºé—®é¢˜ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ã€‚ ç»¼ä¸Šï¼ŒæœåŠ¡å‘ç°ç»„ä»¶åº”å…·å¤‡ä»¥ä¸‹åŠŸèƒ½ã€‚ æœåŠ¡æ³¨å†Œè¡¨ï¼šæœåŠ¡æ³¨å†Œè¡¨æ˜¯æœåŠ¡å‘ç°ç»„ä»¶çš„æ ¸å¿ƒï¼ˆå…¶å®å°±æ˜¯ç±»ä¼¼äºä¸Šé¢çš„registryè¡¨ï¼‰ï¼Œå®ƒç”¨æ¥è®°å½•å„ä¸ªå¾®æœåŠ¡çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å¾®æœåŠ¡çš„åç§°ã€IPã€ç«¯å£ç­‰ã€‚æœåŠ¡æ³¨å†Œè¡¨æä¾›æŸ¥è¯¢APIå’Œç®¡ç†APIï¼ŒæŸ¥è¯¢APIç”¨äºæŸ¥è¯¢å¯ç”¨çš„å¾®æœåŠ¡å®ä¾‹ï¼Œç®¡ç†APIç”¨äºæœåŠ¡çš„æ³¨å†Œå’Œæ³¨é”€ï¼› æœåŠ¡æ³¨å†Œä¸æœåŠ¡å‘ç°ï¼šæœåŠ¡æ³¨å†Œæ˜¯æŒ‡å¾®æœåŠ¡åœ¨å¯åŠ¨æ—¶ï¼Œå°†è‡ªå·±çš„ä¿¡æ¯æ³¨å†Œåˆ°æœåŠ¡å‘ç°ç»„ä»¶ä¸Šçš„è¿‡ç¨‹ã€‚æœåŠ¡å‘ç°æ˜¯æŒ‡æŸ¥è¯¢å¯ç”¨å¾®æœåŠ¡åˆ—è¡¨åŠå…¶ç½‘ç»œåœ°å€çš„æœºåˆ¶ï¼› æœåŠ¡æ£€æŸ¥ï¼šæœåŠ¡å‘ç°ç»„ä»¶ä½¿ç”¨ä¸€å®šæœºåˆ¶å®šæ—¶æ£€æµ‹å·²æ³¨å†Œçš„æœåŠ¡ï¼Œå¦‚å‘ç°æŸå®ä¾‹é•¿æ—¶é—´æ— æ³•è®¿é—®ï¼Œå°±ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­ç§»é™¤è¯¥å®ä¾‹ã€‚ ç”¨é€”å°†å¾®æœåŠ¡çš„æä¾›è€…å’Œæ¶ˆè´¹è€…éƒ½æ³¨å†Œåˆ°EurekaæœåŠ¡å™¨ä¸Šï¼Œç”±EurekaæœåŠ¡å™¨è¿›è¡Œç®¡ç† æºç åˆ†æEurekaåŸç†åˆ†æ é›†æˆæ–¹å¼ç¼–å†™Eureka Server åŠ ä¾èµ– 123456&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; åŠ æ³¨è§£ 1234567@SpringBootApplication@EnableEurekaServerpublic class EurekaApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(EurekaApplication.class, args); &#125;&#125; å†™é…ç½® 12345678910server: port: 8761eureka: client: # æ˜¯å¦è¦æ³¨å†Œåˆ°å…¶ä»–Eureka Serverå®ä¾‹ register-with-eureka: false # æ˜¯å¦è¦ä»å…¶ä»–Eureka Serverå®ä¾‹è·å–æ•°æ® fetch-registry: false service-url: defaultZone: http://localhost:8761/eureka/ TIPS è¿™é‡Œï¼Œå¤§å®¶å¯å…ˆä¸å»æ¢ç©¶registerWithEureka ä»¥åŠfetchRegistry ç©¶ç«Ÿæ˜¯ä»€ä¹ˆé¬¼ï¼Œç¬”è€…å°†åœ¨ä¸‹ä¸€èŠ‚ä¸ºå¤§å®¶æ­æ™“ã€‚ å°†åº”ç”¨æ³¨å†Œåˆ°Eureka Serverä¸Š åŠ ä¾èµ– 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;&lt;/dependency&gt; åŠ æ³¨è§£ 123456@SpringBootApplicationpublic class ProviderUserApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(ProviderUserApplication.class, args); &#125;&#125; æ³¨æ„ï¼šæ—©æœŸçš„ç‰ˆæœ¬ï¼ˆDalstonåŠæ›´æ—©ç‰ˆæœ¬ï¼‰è¿˜éœ€åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£@EnableDiscoveryClient æˆ–@EnableEurekaClient ï¼Œä»Edgwareå¼€å§‹ï¼Œè¯¥æ³¨è§£å¯çœç•¥ã€‚ æ·»åŠ é…ç½®ï¼š 123456789101112spring: application: # æŒ‡å®šæ³¨å†Œåˆ°eureka serverä¸Šçš„æœåŠ¡åç§°ï¼Œå¯¹äºç”µå½±å¾®æœåŠ¡ï¼Œæœ¬ç³»åˆ—å°†åç§°è®¾ä¸ºmicroservice-consumer-movie name: microservice-provider-usereureka: client: service-url: # æŒ‡å®šeureka serveré€šä¿¡åœ°å€ï¼Œæ³¨æ„/eureka/å°å°¾å·´ä¸èƒ½å°‘ defaultZone: http://localhost:8761/eureka/ instance: # æ˜¯å¦æ³¨å†ŒIPåˆ°eureka serverï¼Œå¦‚ä¸æŒ‡å®šæˆ–è®¾ä¸ºfalseï¼Œé‚£å°±ä¼šæ³¨å†Œä¸»æœºååˆ°eureka server prefer-ip-address: true æµ‹è¯• ä¾æ¬¡å¯åŠ¨Eureka Serverä»¥åŠç”¨æˆ·å¾®æœåŠ¡ã€ç”µå½±å¾®æœåŠ¡ï¼› è®¿é—®http://localhost:8761 å¯è§‚å¯Ÿåˆ°ç±»ä¼¼å¦‚ä¸‹ç•Œé¢ï¼š å°†ç”¨æˆ·å¾®æœåŠ¡åœæ­¢ï¼Œå¯çœ‹åˆ°Eureka Serveré¦–é¡µå˜æˆç±»ä¼¼å¦‚ä¸‹ç•Œé¢ï¼š Ribbonç”¨é€”ä¸€èˆ¬æ¥è¯´ï¼Œæåˆ°è´Ÿè½½å‡è¡¡ï¼Œå¤§å®¶ä¸€èˆ¬å¾ˆå®¹æ˜“æƒ³åˆ°æµè§ˆå™¨ -&gt; NGINX -&gt; åå‘ä»£ç†å¤šä¸ªTomcatè¿™æ ·çš„æ¶æ„å›¾â€”â€”ä¸šç•Œç®¡è¿™ç§è´Ÿè½½å‡è¡¡æ¨¡å¼å«â€œæœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡â€ï¼Œå› ä¸ºæ­¤ç§æ¨¡å¼ä¸‹ï¼Œè´Ÿè½½å‡è¡¡ç®—æ³•æ˜¯NGINXæä¾›çš„ï¼Œè€ŒNGINXéƒ¨ç½²åœ¨æœåŠ¡å™¨ç«¯ã€‚ Nginxæ‰«ç›² æœ¬èŠ‚æ‰€è®²çš„Ribbonåˆ™æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ä¾§è´Ÿè½½å‡è¡¡ç»„ä»¶â€”â€”é€šä¿—åœ°è¯´ï¼Œå°±æ˜¯é›†æˆåœ¨å®¢æˆ·ç«¯ï¼ˆæœåŠ¡æ¶ˆè´¹è€…ä¸€ä¾§ï¼‰ï¼Œå¹¶æä¾›è´Ÿè½½å‡è¡¡ç®—æ³•çš„ä¸€ä¸ªç»„ä»¶ã€‚ Ribboné»˜è®¤ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šçš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œä¾‹å¦‚è½®è¯¢ã€éšæœºã€å“åº”æ—¶é—´åŠ æƒç­‰â€”â€”å½“ç„¶ï¼Œä¸ºRibbonè‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç®—æ³•ä¹Ÿéå¸¸å®¹æ˜“ï¼Œåªéœ€å®ç°IRule æ¥å£å³å¯ã€‚ å†…ç½®è´Ÿè½½å‡è¡¡çš„è§„åˆ™è´Ÿè½½å‡è¡¡è§„åˆ™æ˜¯Ribbonçš„æ ¸å¿ƒï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹Ribbonå†…ç½®çš„è´Ÿè½½å‡è¡¡è§„åˆ™ã€‚ AvailabilityFilteringRuleï¼šè¿‡æ»¤æ‰ä¸€ç›´è¿æ¥å¤±è´¥çš„è¢«æ ‡è®°ä¸ºcircuit trippedçš„åç«¯Serverï¼Œå¹¶è¿‡æ»¤æ‰é‚£äº›é«˜å¹¶å‘çš„åç«¯Serveræˆ–è€…ä½¿ç”¨ä¸€ä¸ªAvailabilityPredicateæ¥åŒ…å«è¿‡æ»¤serverçš„é€»è¾‘ï¼Œå…¶å®å°±å°±æ˜¯æ£€æŸ¥statusé‡Œè®°å½•çš„å„ä¸ªServerçš„è¿è¡ŒçŠ¶æ€ï¼› BestAvailableRuleï¼šé€‰æ‹©ä¸€ä¸ªæœ€å°çš„å¹¶å‘è¯·æ±‚çš„Serverï¼Œé€ä¸ªè€ƒå¯ŸServerï¼Œå¦‚æœServerè¢«trippedäº†ï¼Œåˆ™è·³è¿‡ã€‚ RandomRuleï¼šéšæœºé€‰æ‹©ä¸€ä¸ªServerï¼› ResponseTimeWeightedRuleï¼šä½œç”¨åŒWeightedResponseTimeRuleï¼ŒäºŒè€…ä½œç”¨ä¸€æ ·ï¼› RetryRuleï¼šå¯¹é€‰å®šçš„è´Ÿè½½å‡è¡¡ç­–ç•¥æœºä¸Šé‡è¯•æœºåˆ¶ï¼Œåœ¨ä¸€ä¸ªé…ç½®æ—¶é—´æ®µå†…å½“é€‰æ‹©Serverä¸æˆåŠŸï¼Œåˆ™ä¸€ç›´å°è¯•ä½¿ç”¨subRuleçš„æ–¹å¼é€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„serverï¼› RoundRobinRuleï¼šè½®è¯¢é€‰æ‹©ï¼Œ è½®è¯¢indexï¼Œé€‰æ‹©indexå¯¹åº”ä½ç½®çš„Serverï¼› WeightedResponseTimeRuleï¼šæ ¹æ®å“åº”æ—¶é—´åŠ æƒï¼Œå“åº”æ—¶é—´è¶Šé•¿ï¼Œæƒé‡è¶Šå°ï¼Œè¢«é€‰ä¸­çš„å¯èƒ½æ€§è¶Šä½ï¼› ZoneAvoidanceRuleï¼šå¤åˆåˆ¤æ–­Serveræ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’ŒServerçš„å¯ç”¨æ€§é€‰æ‹©Serverï¼› å¦‚éœ€è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œåªéœ€å®ç°IRule æ¥å£æˆ–ç»§æ‰¿AbstractLoadBalancerRule ã€PredicateBasedRuleå³å¯ ï¼Œå¯å‚è€ƒRandomRule ã€RoundRobinRule ã€ZoneAvoidanceRule ç­‰å†…ç½®Ruleç¼–å†™è‡ªå·±çš„è´Ÿè½½å‡è¡¡è§„åˆ™ã€‚ å¼•å…¥Ribbonåœ¨Spring Cloudä¸­ï¼Œå½“Ribbonä¸Eurekaé…åˆä½¿ç”¨æ—¶ï¼ŒRibbonå¯è‡ªåŠ¨ä»Eureka Serverè·å–æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ï¼Œå¹¶åŸºäºè´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰æ‹©å…¶ä¸­ä¸€ä¸ªæœåŠ¡æä¾›è€…å®ä¾‹ã€‚ä¸‹å›¾å±•ç¤ºäº†Ribbonä¸Eurekaé…åˆä½¿ç”¨æ—¶çš„å¤§è‡´æ¶æ„ã€‚ é›†æˆæ–¹å¼ä»£ç ç¤ºä¾‹ å¤åˆ¶é¡¹ç›®microservice-consumer-movie ï¼Œå°†ArtifactIdä¿®æ”¹ä¸ºmicroservice-consumer-movie-ribbon ã€‚ åŠ ä¾èµ–ï¼šç”±äºspring-cloud-starter-netflix-eureka-client å·²ç»åŒ…å«spring-cloud-starter-netfilx-ribbon ï¼Œæ•…è€Œæ— éœ€é¢å¤–æ·»åŠ ä¾èµ–ã€‚ å†™ä»£ç ï¼š 12345@Bean@LoadBalancedpublic RestTemplate restTemplate() &#123; return new RestTemplate();&#125; å¦‚ä»£ç æ‰€ç¤ºï¼Œåªéœ€åœ¨RestTemplate ä¸Šæ·»åŠ LoadBalanced æ³¨è§£ï¼Œå³å¯è®©RestTemplateæ•´åˆRibbonï¼ è°ƒç”¨ï¼š 1234567891011@GetMapping("/users/&#123;id&#125;")public User findById(@PathVariable Long id) &#123; // è¿™é‡Œç”¨åˆ°äº†RestTemplateçš„å ä½ç¬¦èƒ½åŠ› User user = this.restTemplate.getForObject( "http://microservice-provider-user/users/&#123;id&#125;", User.class, id ); // ...ç”µå½±å¾®æœåŠ¡çš„ä¸šåŠ¡... return user;&#125; ç”±ä»£ç å¯çŸ¥ï¼Œæˆ‘ä»¬å°†è¯·æ±‚çš„ç›®æ ‡æœåŠ¡æ”¹æˆäº†http://microservice-provider-user/users/{id} ï¼Œä¹Ÿå°±æ˜¯http://{ç›®æ ‡æœåŠ¡åç§°}/{ç›®æ ‡æœåŠ¡ç«¯ç‚¹} çš„å½¢å¼ï¼ŒRibbonä¼šè‡ªåŠ¨åœ¨å®é™…è°ƒç”¨æ—¶ï¼Œå°†ç›®æ ‡æœåŠ¡åæ›¿æ¢ä¸ºè¯¥æœåŠ¡çš„IPå’Œç«¯å£ã€‚ æµ‹è¯• ä¾æ¬¡å¯åŠ¨microservice-discovery-eureka ã€microservice-provider-user ä¸¤ä¸ªå®ä¾‹ã€microservice-consumer-movie-ribbon è®¿é—®http://localhost:8010/movies/users/1 å¤šæ¬¡ï¼Œä¼šå‘ç°ä¸¤ä¸ªuseræœåŠ¡å®ä¾‹éƒ½ä¼šæ‰“å°æ—¥å¿—ã€‚ Feignç®€ä»‹Feignæ˜¯Netflixå¼€å‘çš„å£°æ˜å¼ã€æ¨¡æ¿åŒ–çš„HTTPå®¢æˆ·ç«¯ï¼Œé›†æˆäº† RestTemplate + Eureka + Ribbon + Hystrix é›†æˆæ–¹å¼ä¸‹é¢æ¥å°†å‰é¢çš„ä¾‹å­ç”¨Feignæ”¹å†™ï¼Œè®©å…¶è¾¾åˆ°ä¸Ribbon + RestTemplateç›¸åŒçš„æ•ˆæœã€‚ å¤åˆ¶é¡¹ç›®microservice-consumer-movieï¼Œå°†ArtifactIdä¿®æ”¹ä¸ºmicroservice-consumer-movie-feign ï¼› åŠ ä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;&lt;/dependency&gt; åŠ æ³¨è§£ï¼šå¯åŠ¨ç±»ä¸Šæ·»åŠ @EnableFeignClients ï¼› ç¼–å†™Feign Clientï¼š 12345@FeignClient(name = "microservice-provider-user")public interface UserFeignClient &#123; @GetMapping("/users/&#123;id&#125;") User findById(@PathVariable("id") Long id);&#125; è¿™æ ·ä¸€ä¸ªFeign Clientå°±å†™å®Œå•¦ï¼å…¶ä¸­ï¼Œ@FeignClient æ³¨è§£ä¸­çš„microservice-provider-useræ˜¯æƒ³è¦è¯·æ±‚æœåŠ¡çš„åç§°ï¼Œè¿™æ˜¯ç”¨æ¥åˆ›å»ºRibbon Clientçš„ï¼ˆFeignæ•´åˆäº†Ribbonï¼‰ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œç”±äºä½¿ç”¨äº†Eurekaï¼Œæ‰€ä»¥Ribbonä¼šæŠŠmicroservice-provider-user è§£ææˆEureka Serverä¸­çš„æœåŠ¡ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä½¿ç”¨urlå±æ€§æŒ‡å®šè¯·æ±‚çš„URLï¼ˆURLå¯ä»¥æ˜¯å®Œæ•´çš„URLæˆ–ä¸»æœºåï¼‰ï¼Œä¾‹å¦‚@FeignClient(name = &quot;abcde&quot;, url = &quot;http://localhost:8000/&quot;) ã€‚æ­¤æ—¶ï¼Œnameå¯ä»¥æ˜¯ä»»æ„å€¼ï¼Œä½†ä¸å¯çœç•¥ï¼Œå¦åˆ™åº”ç”¨å°†æ— æ³•å¯åŠ¨ï¼ Controllerï¼š 1234567891011@RequestMapping("/movies")@RestControllerpublic class MovieController &#123; @Autowired private UserFeignClient userFeignClient; @GetMapping("/users/&#123;id&#125;") public User findById(@PathVariable Long id) &#123; return this.userFeignClient.findById(id); &#125;&#125; åªéœ€ä½¿ç”¨@Autowireæ³¨è§£ï¼Œå³å¯æ³¨å…¥ä¸Šé¢ç¼–å†™çš„Feign Clientã€‚ RestTemplateä¸Feignå¯¹æ¯”ç›¸ä¿¡é€šè¿‡æœ¬æ–‡çš„ä¾‹å­ï¼Œèªæ˜çš„ä½ å¯¹å¦‚ä½•ä½¿ç”¨Feignå·²ç»äº†ç„¶äºå¿ƒäº†ã€‚æ–‡ç« çš„æœ€åï¼Œå¯¹æ¯”ä¸€ä¸‹RestTemplate + Ribbonä¸Feignã€‚ è§’åº¦ RestTemplate + Ribbon Feignï¼ˆè‡ªå¸¦Ribbonï¼‰ å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ æ¬ ä½³ï¼ˆæ— æ³•ä»URLç›´è§‚äº†è§£è¿™ä¸ªè¿œç¨‹è°ƒç”¨æ˜¯å¹²ä»€ä¹ˆçš„ï¼‰ æä½³ï¼ˆèƒ½åœ¨æ¥å£ä¸Šå†™æ³¨é‡Šï¼Œæ–¹æ³•åç§°ä¹Ÿæ˜¯å¯è¯»çš„ï¼Œèƒ½ä¸€çœ¼çœ‹å‡ºè¿™ä¸ªè¿œç¨‹è°ƒç”¨æ˜¯å¹²ä»€ä¹ˆçš„ï¼‰ å¼€å‘ä½“éªŒ æ¬ ä½³ï¼ˆéœ€è¦æ‹¼å‡‘URLï¼‰ æä½³ï¼ˆæ— éœ€æ‹¼å‡‘urlï¼Œè‡ªåŠ¨é›†åˆEurekaå’ŒRibbonï¼‰ é£æ ¼ä¸€è‡´æ€§ æ¬ ä½³ï¼ˆæœ¬åœ°APIè°ƒç”¨å’ŒRestTemplateè°ƒç”¨çš„ä»£ç é£æ ¼æˆªç„¶ä¸åŒï¼‰ æä½³ï¼ˆå®Œå…¨ä¸€è‡´ï¼Œä¸ç‚¹å¼€Feignçš„æ¥å£ï¼Œæ ¹æœ¬ä¸ä¼šå¯Ÿè§‰è¿™æ˜¯ä¸€ä¸ªè¿œç¨‹è°ƒç”¨è€Œéæœ¬åœ°APIè°ƒç”¨ï¼‰ æ€§èƒ½ è¾ƒå¥½ ä¸­ç­‰ï¼ˆæ€§èƒ½æ˜¯RestTemplateçš„50%å·¦å³ï¼›å¦‚æœä¸ºFeigné…ç½®è¿æ¥æ± ï¼Œæ€§èƒ½å¯æå‡15%å·¦å³ï¼‰ çµæ´»æ€§ æä½³ ä¸­ç­‰ï¼ˆå†…ç½®åŠŸèƒ½èƒ½æ»¡è¶³å¤§å¤šæ•°é¡¹ç›®çš„éœ€æ±‚ï¼‰ Hystrixå®¹é”™æŠ€æœ¯çš„å¼•å…¥è‡³æ­¤ï¼Œæˆ‘ä»¬å·²å®ç°æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ï¼ŒåŒæ—¶ï¼Œä½¿ç”¨Feignä¹Ÿå®ç°äº†è‰¯å¥½çš„è¿œç¨‹è°ƒç”¨â€”â€”æˆ‘ä»¬çš„ä»£ç æ˜¯å¯è¯»ã€å¯ç»´æŠ¤çš„ã€‚ç†è®ºä¸Šï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»èƒ½æ„å»ºä¸€ä¸ªä¸é”™çš„åˆ†å¸ƒå¼åº”ç”¨äº†ï¼Œä½†å¾®æœåŠ¡ä¹‹é—´æ˜¯é€šè¿‡ç½‘ç»œé€šä¿¡çš„ï¼Œç½‘ç»œå¯èƒ½å‡ºé—®é¢˜ï¼›å¾®æœåŠ¡æœ¬èº«ä¹Ÿä¸å¯èƒ½100%å¯ç”¨ã€‚ å¦‚ä½•æå‡åº”ç”¨çš„å¯ç”¨æ€§å‘¢ï¼Ÿè¿™æ˜¯æˆ‘ä»¬å¿…é¡»è€ƒè™‘çš„é—®é¢˜â€”â€” ä¸¾ä¸ªä¾‹å­ï¼šæŸå¤§å‹ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡Aè°ƒç”¨æœåŠ¡Bï¼ŒæŸä¸ªæ—¶åˆ»ï¼Œå¾®æœåŠ¡Bçªç„¶å´©æºƒäº†ã€‚å¾®æœåŠ¡Aä¸­ï¼Œä¾ç„¶æœ‰å¤§é‡è¯·æ±‚åœ¨è¯·æ±‚Bï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•æªæ–½ï¼Œå¾®æœåŠ¡Aå¾ˆå¯èƒ½å¾ˆå¿«å°±ä¼šè¢«æ‹–æ­»â€”â€”å› ä¸ºåœ¨Javaä¸­ï¼Œä¸€æ¬¡è¯·æ±‚å¾€å¾€å¯¹åº”ç€ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœä¸åšä»»ä½•æªæ–½ï¼Œé‚£æ„å‘³ç€å¾®æœåŠ¡Aè¯·æ±‚Bçš„çº¿ç¨‹è¦ç­‰Feign Client/RestTemplateè¶…æ—¶æ‰ä¼šé‡Šæ”¾ï¼ˆè¿™ä¸ªæ—¶é—´ä¸€èˆ¬éå¸¸é•¿ï¼Œé•¿è¾¾å‡ åç§’ï¼‰ï¼Œäºæ˜¯å°±ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹è¢«é˜»å¡ï¼Œè€Œçº¿ç¨‹åˆå¯¹åº”ç€è®¡ç®—èµ„æºï¼ˆCPU/å†…å­˜ï¼‰ï¼Œäºæ˜¯ä¹ï¼Œå¤§é‡çš„èµ„æºè¢«æµªè´¹ï¼Œå¹¶ä¸”è¶Šç§¯è¶Šå¤šï¼Œæœ€ç»ˆæœåŠ¡å™¨ç»ˆäºæ²¡æœ‰èµ„æºç»™å¾®æœåŠ¡Aæµªè´¹äº†ï¼Œå¾®æœåŠ¡Aä¹ŸæŒ‚äº†ã€‚ å› æ­¤ï¼Œåœ¨å¤§å‹åº”ç”¨ä¸­ï¼Œå¾®æœåŠ¡ä¹‹é—´çš„å®¹é”™å¿…ä¸å¯å°‘ï¼Œä¸‹é¢æ¥è®¨è®ºå¦‚ä½•å®ç°å¾®æœåŠ¡çš„å®¹é”™ã€‚ å®¹é”™ä¸‰æ¿æ–§ è¶…æ—¶æœºåˆ¶ï¼šä¸€æ—¦è¶…æ—¶ï¼Œå°±é‡Šæ”¾èµ„æºã€‚ç”±äºé‡Šæ”¾èµ„æºé€Ÿåº¦è¾ƒå¿«ï¼Œåº”ç”¨å°±ä¸ä¼šé‚£ä¹ˆå®¹æ˜“è¢«æ‹–æ­»ã€‚ èˆ±å£æ¨¡å¼ï¼šä¸æŠŠé¸¡è›‹æ”¾åœ¨ä¸€ä¸ªç¯®å­é‡Œã€‚ä½ æœ‰ä½ çš„çº¿ç¨‹æ± ï¼Œæˆ‘æœ‰æˆ‘çš„çº¿ç¨‹æ± ï¼Œä½ çš„çº¿ç¨‹æ± æ»¡äº†å’Œæˆ‘æ²¡å…³ç³»ï¼Œä½ æŒ‚äº†ä¹Ÿå’Œæˆ‘æ²¡å…³ç³»ã€‚ æ–­è·¯å™¨ï¼šå®æ—¶ç›‘æµ‹åº”ç”¨ï¼Œå¦‚æœå‘ç°åœ¨ä¸€å®šæ—¶é—´å†…å¤±è´¥æ¬¡æ•°/å¤±è´¥ç‡è¾¾åˆ°ä¸€å®šé˜ˆå€¼ï¼Œå°±â€œè·³é—¸â€ï¼Œæ–­è·¯å™¨æ‰“å¼€â€”â€”æ­¤æ—¶ï¼Œè¯·æ±‚ç›´æ¥è¿”å›ï¼Œè€Œä¸å»è°ƒç”¨åŸæœ¬è°ƒç”¨çš„é€»è¾‘ã€‚ è·³é—¸ä¸€æ®µæ—¶é—´åï¼ˆä¾‹å¦‚15ç§’ï¼‰ï¼Œæ–­è·¯å™¨ä¼šè¿›å…¥åŠå¼€çŠ¶æ€ï¼Œè¿™æ˜¯ä¸€ä¸ªç¬é—´æ€ï¼Œæ­¤æ—¶å…è®¸ä¸€æ¬¡è¯·æ±‚è°ƒç”¨è¯¥è°ƒçš„é€»è¾‘ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™æ–­è·¯å™¨å…³é—­ï¼Œåº”ç”¨æ­£å¸¸è°ƒç”¨ï¼›å¦‚æœè°ƒç”¨ä¾ç„¶ä¸æˆåŠŸï¼Œæ–­è·¯å™¨ç»§ç»­å›åˆ°æ‰“å¼€çŠ¶æ€ï¼Œè¿‡æ®µæ—¶é—´å†è¿›å…¥åŠå¼€çŠ¶æ€å°è¯•â€”â€”é€šè¿‡â€è·³é—¸â€œï¼Œåº”ç”¨å¯ä»¥ä¿æŠ¤è‡ªå·±ï¼Œè€Œä¸”é¿å…æµªè´¹èµ„æºï¼›è€Œé€šè¿‡åŠå¼€çš„è®¾è®¡ï¼Œå¯å®ç°åº”ç”¨çš„â€œè‡ªæˆ‘ä¿®å¤â€œã€‚ æ–­è·¯å™¨çŠ¶æ€è½¬æ¢ å¼•å…¥HystrixHystrixæ˜¯ç”±Netflixå¼€æºçš„ä¸€ä¸ªå»¶è¿Ÿå’Œå®¹é”™åº“ï¼Œç”¨äºéš”ç¦»è®¿é—®è¿œç¨‹ç³»ç»Ÿã€æœåŠ¡æˆ–è€…ç¬¬ä¸‰æ–¹åº“ï¼Œé˜²æ­¢çº§è”å¤±è´¥ï¼Œä»è€Œæå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ä¸å®¹é”™æ€§ã€‚Hystrixä¸»è¦é€šè¿‡ä»¥ä¸‹å‡ ç‚¹å®ç°å»¶è¿Ÿå’Œå®¹é”™ã€‚ åŒ…è£¹è¯·æ±‚ ä½¿ç”¨HystrixCommandï¼ˆæˆ–HystrixObservableCommandï¼‰åŒ…è£¹å¯¹ä¾èµ–çš„è°ƒç”¨é€»è¾‘ï¼Œæ¯ä¸ªå‘½ä»¤åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œã€‚è¿™ä½¿ç”¨åˆ°äº†è®¾è®¡æ¨¡å¼ä¸­çš„â€œ å‘½ä»¤æ¨¡å¼ â€ã€‚ è·³é—¸æœºåˆ¶ï¼ˆæ–­è·¯å™¨çš„åº”ç”¨ï¼‰ å½“æŸæœåŠ¡çš„é”™è¯¯ç‡è¶…è¿‡ä¸€å®šé˜ˆå€¼æ—¶ï¼ŒHystrixå¯ä»¥è‡ªåŠ¨æˆ–è€…æ‰‹åŠ¨è·³é—¸ï¼Œåœæ­¢è¯·æ±‚è¯¥æœåŠ¡ä¸€æ®µæ—¶é—´ã€‚ èµ„æºéš”ç¦»ï¼ˆèˆ±å£æ¨¡å¼çš„åº”ç”¨ï¼‰ Hystrixä¸ºæ¯ä¸ªä¾èµ–éƒ½ç»´æŠ¤äº†ä¸€ä¸ªå°å‹çš„çº¿ç¨‹æ± ï¼ˆæˆ–è€…ä¿¡å·é‡ï¼‰ã€‚å¦‚æœè¯¥çº¿ç¨‹æ± å·²æ»¡ï¼Œå‘å¾€è¯¥ä¾èµ–çš„è¯·æ±‚å°±è¢«ç«‹å³æ‹’ç»ï¼Œè€Œä¸æ˜¯æ’é˜Ÿç­‰å€™ï¼Œä»è€ŒåŠ é€Ÿå¤±è´¥åˆ¤å®šã€‚ ç›‘æ§ï¼ˆè¶…æ—¶æ¨¡å¼çš„åº”ç”¨ï¼‰ Hystrixå¯ä»¥è¿‘ä¹å®æ—¶åœ°ç›‘æ§è¿è¡ŒæŒ‡æ ‡å’Œé…ç½®çš„å˜åŒ–ï¼Œä¾‹å¦‚æˆåŠŸã€å¤±è´¥ã€è¶…æ—¶ã€ä»¥åŠè¢«æ‹’ç»çš„è¯·æ±‚ç­‰ã€‚ å›é€€æœºåˆ¶ å½“è¯·æ±‚å¤±è´¥ã€è¶…æ—¶ã€è¢«æ‹’ç»ï¼Œæˆ–å½“æ–­è·¯å™¨æ‰“å¼€æ—¶ï¼Œæ‰§è¡Œå›é€€é€»è¾‘ã€‚å›é€€é€»è¾‘å¯ç”±å¼€å‘äººå‘˜è‡ªè¡Œæä¾›ï¼Œä¾‹å¦‚è¿”å›ä¸€ä¸ªç¼ºçœå€¼ã€‚ è‡ªæˆ‘ä¿®å¤ æ–­è·¯å™¨æ‰“å¼€ä¸€æ®µæ—¶é—´åï¼Œä¼šè‡ªåŠ¨è¿›å…¥â€œåŠå¼€â€çŠ¶æ€ã€‚æ–­è·¯å™¨æ‰“å¼€ã€å…³é—­ã€åŠå¼€çš„é€»è¾‘è½¬æ¢ï¼Œå‰é¢æˆ‘ä»¬å·²ç»è¯¦ç»†æ¢è®¨è¿‡äº†ï¼Œä¸å†èµ˜è¿°ã€‚ é€šç”¨æ–¹å¼ä½¿ç”¨HystrixæœåŠ¡é™çº§ åŠ ä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;&lt;/dependency&gt; åŠ æ³¨è§£ï¼šåœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ @EnableCircuitBreaker æ³¨è§£ã€‚ ä½¿ç”¨ï¼š 12345678910111213141516@HystrixCommand(fallbackMethod = "findByIdFallback")@GetMapping("/users/&#123;id&#125;")public User findById(@PathVariable Long id) &#123; // è¿™é‡Œç”¨åˆ°äº†RestTemplateçš„å ä½ç¬¦èƒ½åŠ› User user = this.restTemplate.getForObject( "http://microservice-provider-user/users/&#123;id&#125;", User.class, id ); // ...ç”µå½±å¾®æœåŠ¡çš„ä¸šåŠ¡... return user;&#125;public User findByIdFallback(Long id) &#123; return new User(id, "é»˜è®¤ç”¨æˆ·", "é»˜è®¤ç”¨æˆ·", 0, new BigDecimal(1));&#125; ç”±ä»£ç å¯çŸ¥ï¼Œåªéœ€ä½¿ç”¨@HystrixCommand æ³¨è§£ï¼Œå°±å¯ä¿æŠ¤è¯¥APIã€‚è¿™é‡Œçš„â€ä¿æŠ¤â€œï¼Œå…¶å®å¸¦æœ‰ä¸‰å±‚å«ä¹‰â€”â€”â€è¶…æ—¶æœºåˆ¶â€œã€â€ä»“å£æ¨¡å¼â€œã€â€æ–­è·¯å™¨â€œï¼ TIPS æœ¬ä¾‹ä½¿ç”¨äº†fallbackMethod å±æ€§ï¼ŒæŒ‡å®šäº†ä¸€ä¸ªé™çº§æ–¹æ³•ï¼Œå¦‚ä¸æŒ‡å®šï¼ŒHystrixä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„é™çº§æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯æŠ›å¼‚å¸¸ï¼Œå“ˆå“ˆå“ˆã€‚ å¦‚ä½•çŸ¥é“æ–­è·¯å™¨æ‰“å¼€è¿˜æ˜¯å…³é—­å‘¢ï¼Ÿåªéœ€è®¿é—®åº”ç”¨çš„/actuator/health ç«¯ç‚¹ï¼Œå³å¯æŸ¥çœ‹ï¼æ–­è·¯å™¨çš„çŠ¶æ€â€”â€”å½“ç„¶ï¼Œä½ å¿…é¡»æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š 1234management: endpoint: health: show-details: always æµ‹è¯• å¯åŠ¨microservice-discovery-eureka å¯åŠ¨microservice-provider-user å¯åŠ¨microservice-consumer-movie-ribbon-hystrix-common è®¿é—®http://localhost:8010/movies/users/1 ï¼Œèƒ½æ­£å¸¸è¿”å›ç»“æœ å…³é—­microservice-provider-user ï¼Œå†æ¬¡è®¿é—®http://localhost:8010/movies/users/1 ï¼Œå¯è¿”å›ç±»ä¼¼å¦‚ä¸‹ç»“æœï¼Œè¯´æ˜å½“æœåŠ¡æä¾›è€…æ—¶ï¼ŒæœåŠ¡æ¶ˆè´¹è€…è¿›å…¥äº†å›é€€æ–¹æ³•ã€‚ 1&#123;"id":1,"username":"é»˜è®¤ç”¨æˆ·","name":"é»˜è®¤ç”¨æˆ·","age":0,"balance":1&#125; è®¿é—®http://localhost:8010/actuator/health ï¼Œå¯è·å¾—ç±»ä¼¼å¦‚ä¸‹ç»“æœï¼š 1234567891011&#123; "status": "UP", "details": &#123; "diskSpace": ..., "refreshScope": ..., "discoveryComposite": ..., "hystrix": &#123; "status": "UP" &#125; &#125;&#125; ç”±ç»“æœä¸éš¾å‘ç°ï¼Œæ­¤æ—¶æ–­è·¯å™¨å¹¶æœªæ‰“å¼€ï¼è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ åŸå› æ˜¯ï¼šæ­¤æ—¶åªè¯·æ±‚äº†ä¸€æ¬¡ï¼Œæ²¡æœ‰è¾¾åˆ°Hystrixçš„é˜ˆå€¼â€”â€”Hystrixè®¾è®¡æ¥ä¿æŠ¤é«˜å¹¶å‘åº”ç”¨çš„ï¼Œå®ƒè¦æ±‚10ç§’ï¼ˆå¯ç”¨hystrix.command.default.metrics.rollingStats.timeInMilliseconds è‡ªå®šä¹‰ï¼‰ä»¥å†…APIé”™è¯¯æ¬¡æ•°è¶…è¿‡20æ¬¡ï¼ˆç”¨circuitBreaker.requestVolumeThreshold è‡ªå®šä¹‰ï¼‰ï¼Œæ­¤æ—¶æ‰å¯èƒ½è§¦å‘æ–­è·¯å™¨ã€‚ æŒç»­ä¸æ–­åœ°è®¿é—®http://localhost:8010/movies/users/1 å¤šæ¬¡ï¼ˆè‡³å°‘20æ¬¡ï¼‰ å†æ¬¡è®¿é—®http://localhost:8010/actuator/health ï¼Œå¯è·å¾—ç±»ä¼¼å¦‚ä¸‹ç»“æœï¼š 1234567891011121314&#123; "status": "UP", "details": &#123; "diskSpace": ..., "refreshScope": ..., "discoveryComposite": ..., "hystrix": &#123; "status": "CIRCUIT_OPEN", "details": &#123; "openCircuitBreakers": ["MovieController::findById"] &#125; &#125; &#125;&#125; ç”±ç»“æœå¯çŸ¥ï¼Œæ­¤æ—¶æ–­è·¯å™¨å·²ç»æ‰“å¼€ï¼Œå¹¶ä¸”åˆ—å‡ºäº†æ˜¯å“ªä¸ªAPIçš„æ–­è·¯å™¨è¢«æ‰“å¼€äº†ã€‚ è·å¾—é€ æˆfallbackçš„åŸå› åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¾ˆå¯èƒ½éœ€è¦è·å¾—é€ æˆfallbackçš„åŸå› ï¼Œæ­¤æ—¶å¯å°†ä»£ç ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š 1234567891011121314151617@HystrixCommand(fallbackMethod = "findByIdFallback")@GetMapping("/users/&#123;id&#125;")public User findById(@PathVariable Long id) &#123; // è¿™é‡Œç”¨åˆ°äº†RestTemplateçš„å ä½ç¬¦èƒ½åŠ› User user = this.restTemplate.getForObject( "http://microservice-provider-user/users/&#123;id&#125;", User.class, id ); // ...ç”µå½±å¾®æœåŠ¡çš„ä¸šåŠ¡... return user;&#125;public User findByIdFallback(Long id, Throwable throwable) &#123; log.error("è¿›å…¥å›é€€æ–¹æ³•", throwable); return new User(id, "é»˜è®¤ç”¨æˆ·", "é»˜è®¤ç”¨æˆ·", 0, new BigDecimal(1));&#125; Feign æ•´åˆ Hystrixé»˜è®¤Feignæ˜¯ä¸å¯ç”¨Hystrixçš„ï¼Œå¦‚æœéœ€è¦å¯ç”¨ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å³å¯ï¼š 123feign: hystrix: enabled: true Hystrix Command è¯¦è§£ç›‘æ§ç«¯ç‚¹ä¸æ•°æ®åº”ç”¨æ•´åˆHystrixï¼ŒåŒæ—¶åº”ç”¨åŒ…å«spring-boot-starter-actuator ä¾èµ–ï¼Œå°±ä¼šå­˜åœ¨ä¸€ä¸ª/actuator/hystrix.stream ç«¯ç‚¹ï¼Œç”¨æ¥ç›‘æ§Hystrix Commandã€‚å½“è¢«@HystrixCommand æ³¨è§£äº†çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå°±ä¼šäº§ç”Ÿç›‘æ§ä¿¡æ¯ï¼Œå¹¶æš´éœ²åˆ°è¯¥ç«¯ç‚¹ä¸­ã€‚å½“ç„¶ï¼Œè¯¥ç«¯ç‚¹é»˜è®¤æ˜¯ä¸ä¼šæš´éœ²çš„ï¼Œéœ€ä½¿ç”¨å¦‚ä¸‹é…ç½®å°†å…¶æš´éœ²ã€‚ 12345management: endpoints: web: exposure: include: 'hystrix.stream' æ­¤æ—¶ï¼Œè®¿é—®/actuator/hystrix.stream å¯è¿”å›å¦‚ä¸‹ç»“æœï¼š 1&#123;"type":"HystrixCommand","name":"findById","group":"MovieController","currentTime":1547905939151,"isCircuitBreakerOpen":false,"errorPercentage":0,"errorCount":0,"requestCount":0,"rollingCountBadRequests":0,"rollingCountCollapsedRequests":0,"rollingCountEmit":0,"rollingCountExceptionsThrown":0,"rollingCountFailure":0,"rollingCountFallbackEmit":0,"rollingCountFallbackFailure":0,"rollingCountFallbackMissing":0,"rollingCountFallbackRejection":0,"rollingCountFallbackSuccess":0,"rollingCountResponsesFromCache":0,"rollingCountSemaphoreRejected":0,"rollingCountShortCircuited":0,"rollingCountSuccess":0,"rollingCountThreadPoolRejected":0,"rollingCountTimeout":0,"currentConcurrentExecutionCount":0,"rollingMaxConcurrentExecutionCount":0,"latencyExecute_mean":0,"latencyExecute":&#123;"0":0,"25":0,"50":0,"75":0,"90":0,"95":0,"99":0,"99.5":0,"100":0&#125;,"latencyTotal_mean":0,"latencyTotal":&#123;"0":0,"25":0,"50":0,"75":0,"90":0,"95":0,"99":0,"99.5":0,"100":0&#125;,"propertyValue_circuitBreakerRequestVolumeThreshold":20,"propertyValue_circuitBreakerSleepWindowInMilliseconds":5000,"propertyValue_circuitBreakerErrorThresholdPercentage":50,"propertyValue_circuitBreakerForceOpen":false,"propertyValue_circuitBreakerForceClosed":false,"propertyValue_circuitBreakerEnabled":true,"propertyValue_executionIsolationStrategy":"THREAD","propertyValue_executionIsolationThreadTimeoutInMilliseconds":1000,"propertyValue_executionTimeoutInMilliseconds":1000,"propertyValue_executionIsolationThreadInterruptOnTimeout":true,"propertyValue_executionIsolationThreadPoolKeyOverride":null,"propertyValue_executionIsolationSemaphoreMaxConcurrentRequests":10,"propertyValue_fallbackIsolationSemaphoreMaxConcurrentRequests":10,"propertyValue_metricsRollingStatisticalWindowInMilliseconds":10000,"propertyValue_requestCacheEnabled":true,"propertyValue_requestLogEnabled":true,"reportingHosts":1,"threadPool":"MovieController"&#125; å¯¹äºFeignå‰é¢è®²è¿‡Feigné»˜è®¤å·²ç»æ•´åˆäº†Hystrixï¼Œä½†è¿™ä¸ªæ•´åˆå…¶å®æ˜¯â€œä¸å®Œæ•´â€ï¼Œå› ä¸ºå®ƒé»˜è®¤ä¸å¸¦æœ‰ç›‘æ§ç«¯ç‚¹ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨Feignçš„åŒæ—¶ï¼Œä¹Ÿæƒ³ä½¿ç”¨ç›‘æ§ç«¯ç‚¹ï¼Œéœ€æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ“ä½œï¼š åŠ ä¾èµ– 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;&lt;/dependency&gt; åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£@EnableCircuitBreaker åœ¨application.yml ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š 12345management: endpoints: web: exposure: include: 'hystrix.stream' å¯è§†åŒ–ç›‘æ§æ•°æ®è‡³æ­¤ï¼Œæˆ‘ä»¬å·²å¯é€šè¿‡/actuator/hystrix.strem ç«¯ç‚¹è§‚å¯ŸHystrixè¿è¡Œæƒ…å†µï¼Œä½†æ–‡å­—å½¢å¼çš„ç›‘æ§æ•°æ®å¾ˆä¸ç›´è§‚ã€‚ç°å®é¡¹ç›®ä¸­ä¸€èˆ¬éƒ½éœ€è¦ä¸€ä¸ªå¯è§†åŒ–çš„ç•Œé¢ï¼Œè¿™æ ·æ‰èƒ½è¿…é€Ÿäº†è§£ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µã€‚Hystrixæä¾›äº†ä¸€ä¸ªè½®å­â€”â€”Hystrix Dashboardï¼Œå®ƒçš„ä½œç”¨åªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯å°†æ–‡å­—å½¢å¼çš„ç›‘æ§æ•°æ®è½¬æ¢æˆå›¾è¡¨å±•ç¤ºã€‚ ç¼–å†™Hystrix Dashboard åŠ ä¾èµ– 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt;&lt;/dependency&gt; åŠ æ³¨è§£ï¼š@EnableHystrixDashboard å†™é…ç½®ï¼š 123# ç«¯å£éšä¾¿å†™ï¼Œè¿™é‡Œåªæ˜¯è¡¨æ˜ä¸‹è‡ªå·±çš„ç«¯å£è§„åˆ’è€Œå·²server: port: 8030 å¯åŠ¨åï¼Œè®¿é—®http://localhost:8030/hystrix å³å¯çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„ç•Œé¢ï¼š å°†ä¸Šæ–‡çš„/actuator/hystrix.stream ç«¯ç‚¹çš„åœ°å€è´´åˆ°å›¾ä¸­ï¼Œå¹¶æŒ‡å®šTitleï¼Œç„¶åç‚¹å‡»Monitor Stream æŒ‰é’®ï¼Œå³å¯çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„å›¾è¡¨ï¼š å›¾è¡¨è§£è¯»Turbine Turbineä¸Šæ–‡çš„Hystrix Dashboardåªæ”¯æŒä¸€æ¬¡ç›‘æ§ä¸€ä¸ªå¾®æœåŠ¡å®ä¾‹ï¼Œæ˜¾ç„¶æ˜¯ä¸èƒ½æ»¡è¶³éœ€æ±‚çš„ï¼Œæ‰€ä»¥ä¸ºäº†èƒ½ç›‘æ§å¤šä¸ªå¾®æœåŠ¡ï¼ŒNetflixå®˜æ–¹å†æ¬¡å‘æŒ¥é€ è½®å­çš„ç²¾ç¥â€”â€”å®ƒä»¬åˆç¼–å†™äº†ä¸€ä¸ªç»„ä»¶ï¼ŒTurbineã€‚ ä¸è¿‡è¿™ä¸ªé¡¹ç›®åˆšå‡ºç”Ÿå°±æ­»äº†ï¼Œ14å¹´å‘å¸ƒåå°±å†ä¹Ÿæ²¡æœ‰è¿›è¡Œæ›´æ–°ç»´æŠ¤ã€‚ ç®€ä»‹Turbineæ˜¯ä¸€ä¸ªèšåˆHystrixç›‘æ§æ•°æ®çš„å·¥å…·ï¼Œå®ƒå¯å°†æ‰€æœ‰ç›¸å…³/hystrix.streamç«¯ç‚¹çš„æ•°æ®èšåˆåˆ°ä¸€ä¸ªç»„åˆçš„/turbine.streamä¸­ï¼Œä»è€Œè®©é›†ç¾¤çš„ç›‘æ§æ›´åŠ æ–¹ä¾¿ã€‚ å¼•å…¥Turbineåï¼Œæ¶æ„å›¾å¦‚ä¸‹ï¼š å¼•å…¥Turbineç¼–å†™Turbine Server åŠ ä¾èµ– 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-turbine&lt;/artifactId&gt;&lt;/dependency&gt; åŠ æ³¨è§£ï¼š@EnableTurbine å†™é…ç½®ï¼š 123456789101112131415server: port: 8031spring: application: name: microservice-hystrix-turbineeureka: client: service-url: defaultZone: http://localhost:8761/eureka/ instance: prefer-ip-address: trueturbine: # è¦ç›‘æ§çš„å¾®æœåŠ¡åˆ—è¡¨ï¼Œå¤šä¸ªç”¨,åˆ†éš” appConfig: microservice-consumer-movie,microservice-consumer-movie-feign clusterNameExpression: "'default'" æµ‹è¯•è¿™æ ·ï¼ŒTubineå³å¯èšåˆmicroservice-consumer-movie,microservice-consumer-movie-feignä¸¤ä¸ªæœåŠ¡çš„/actuator/hystrix.stream ä¿¡æ¯ï¼Œå¹¶æš´éœ²åœ¨http://localhost:8031/turbine.stream ï¼Œå°†è¯¥åœ°å€è´´åˆ°Hystrix Dashboardä¸Šï¼Œå³å¯çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„å›¾è¡¨ï¼š Zuul]]></content>
      <tags>
        <tag>SpringCloud</tag>
        <tag>å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŠ¨æ€è§„åˆ’ç¬”è®°]]></title>
    <url>%2F2019%2F12%2F09%2F%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E7%AC%94%E8%AE%B0.html</url>
    <content type="text"><![CDATA[é€’å½’ã€é€’æ¨ é€’å½’ è‡ªé¡¶å‘ä¸‹ é€’æ¨ è‡ªåº•å‘ä¸Š åŠ¨æ€è§„åˆ’é¢˜çš„ä¸€èˆ¬æ€è·¯ å…ˆå†™å‡ºé€’å½’æ€è·¯ ç„¶åå‰ªæ(å‰é¢äºŒè€…éƒ½æ˜¯è‡ªä¸Šè€Œä¸‹) ç„¶åå†™å‡ºdp(ä¸åŒäºå‰ªæçš„æ˜¯ dpæ˜¯è‡ªåº•å‘ä¸Š) dpé—®é¢˜æ ¸å¿ƒæ˜¯ç©·ä¸¾ï¼Œdpç‰¹ç‚¹æ˜¯å­˜åœ¨ é‡å å­é—®é¢˜ æœ€ä¼˜å­ç»“æ„ ç„¶ååªè¦åœ¨æ­¤åŸºç¡€ä¸Šåˆ—å‡º çŠ¶æ€è½¬ç§»æ–¹ç¨‹ å³å¯ åŠ¨æ€è§„åˆ’çš„ä¸‰è¦ç´ ï¼š é‡å å­é—®é¢˜ æœ€ä¼˜å­ç»“æ„ çŠ¶æ€è½¬ç§»æ–¹ç¨‹ æ€ç»´æ¡†æ¶ï¼š æ˜ç¡®ã€ŒçŠ¶æ€ã€ -&gt; å®šä¹‰ dp æ•°ç»„/å‡½æ•°çš„å«ä¹‰ -&gt; æ˜ç¡®ã€Œé€‰æ‹©ã€-&gt; æ˜ç¡® base caseã€‚]]></content>
  </entry>
  <entry>
    <title><![CDATA[jvmç¬”è®°]]></title>
    <url>%2F2019%2F12%2F04%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%94%E8%AE%B0.html</url>
    <content type="text"><![CDATA[ç¬¬äºŒç«  Javaå†…å­˜åŒºåŸŸä¸å†…å­˜æº¢å‡ºå¼‚å¸¸1. è¿è¡Œæ—¶æ•°æ®åŒºåŸŸåŒ…æ‹¬ æ–¹æ³•åŒºã€å †ï¼ˆå‰ä¸¤è€…éƒ½æ˜¯å…±äº«çš„ï¼‰ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨ï¼ˆä¸‰è€…æ˜¯çº¿ç¨‹ç§æœ‰ï¼‰ã€‚ æ–¹æ³•åŒºï¼šä¸Javaå †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼Œåˆ«åç§°ä¸ºNon-Heapã€‚ å †ï¼šJava Heapæ˜¯Javaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚Javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œæ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼ŒåŒæ—¶Javaå †æ˜¯åƒåœ¾æ”¶é›†ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå¾ˆå¤šæ—¶å€™ä¹Ÿè¢«ç§°ä¸º GCå †ã€‚ è™šæ‹Ÿæœºæ ˆï¼šæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼Œå³æ¯ä¸ªæ–¹æ³•ä¼šåœ¨æ‰§è¡Œçš„åŒæ—¶åˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚ç»å¸¸æœ‰äººæŠŠJavaå†…å­˜åˆ†ä¸ºå †å†…å­˜å’Œæ ˆå†…å­˜ï¼Œè¿™é‡Œçš„æ ˆå†…å­˜å°±æ˜¯æŒ‡çš„è™šæ‹Ÿæœºæ ˆã€‚ æœ¬åœ°æ–¹æ³•æ ˆï¼šä¸è™šæ‹Ÿæœºæ ˆå‘æŒ¥çš„åŠŸèƒ½åŸºæœ¬ä¸€è‡´ï¼ŒåŒºåˆ«ä¸è¿‡æ˜¯è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³•æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Nativeæ–¹æ³•æœåŠ¡ã€‚ ç¨‹åºè®¡æ•°å™¨ï¼šä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚ è¿è¡Œæ—¶å¸¸é‡æ± ï¼šæ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚å¸¸é‡æ± ï¼ˆç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼‰ã€‚ ç›´æ¥å†…å­˜ï¼šå¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸã€‚ã€ŒNIO ä¸­ä¼šä½¿ç”¨ã€ å¯¹å®ƒçš„ä½¿ç”¨è¿˜æ˜¯ä¸æ˜¯ç‰¹åˆ«äº†è§£â€¦ å †å¤–å†…å­˜ï¼šhttps://blog.csdn.net/y3over/article/details/88791958 2. OutOfMemoryErrorå¼‚å¸¸åŒ…æ‹¬ Javaå †æº¢å‡ºã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡ºã€æ–¹æ³•åŒºå’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡ºã€æœ¬æœºç›´æ¥å†…å­˜æº¢å‡ºã€‚ å †æº¢å‡ºï¼Œä¸»è¦å°±æ˜¯ä¸åœçš„ new å¯¹è±¡å³å¯ï¼›ã€Œ-Xmsã€ æ ˆæº¢å‡ºï¼Œä¸»è¦æ˜¯å®šä¹‰å¤§é‡çš„æœ¬åœ°å˜é‡ï¼Œç„¶åé€’å½’ï¼Œä½¿å¾—çˆ†æ ˆï¼Œè¿™æ ·ä¼šæœ‰ StackOverflowErrorï¼Œå¦‚æœæƒ³è¦æœ‰ OOMï¼Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯ä¸åœçš„åˆ›å»ºçº¿ç¨‹ï¼Œå› ä¸ºç³»ç»Ÿåˆ†é…ç»™æ ˆçš„å†…å­˜æ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚ä¸€èˆ¬æ€»çš„æ˜¯ 2Gï¼Œç„¶åå‡å»å †å’Œæ–¹æ³•åŒºçš„å®¹é‡ï¼Œå°±æ˜¯æ ˆçš„å®¹é‡äº†ï¼Œå¦‚æœä¸æ–­åœ° new çº¿ç¨‹çš„è¯ï¼Œé‚£ä¹ˆæ€»æœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šå†…å­˜ä¸å¤Ÿï¼Œæ­¤æ—¶å°±èƒ½å¤Ÿå¼¹å‡º OOM äº†ï¼›ã€Œã€ æ–¹æ³•åŒºä¸­çš„è¿è¡Œæ—¶å¸¸é‡æ± çš„æº¢å‡ºï¼Œä¸€èˆ¬ä¹Ÿå°±æ˜¯ä½¿ç”¨ String.inter() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€æ—¦æ± ä¸­æ²¡æœ‰éœ€è¦çš„å¸¸é‡ï¼Œå°±å®šä¹‰ä¸€ä¸ªæ”¾åˆ°æ± ä¸­å»ï¼Œå¦åˆ™å°±æ‹¿å‡ºè¿™ä¸ªå¸¸é‡çš„åœ°å€ï¼Œæˆ‘ä¸æ–­çš„å®šä¹‰å¸¸é‡æ”¾å…¥å¸¸é‡æ± ï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“ OOMï¼›ã€ŒPermGen Spaceã€ æ–¹æ³•åŒºæº¢å‡ºï¼Œæœ€åŸºæœ¬çš„æ€è·¯å°±æ˜¯è¿è¡Œæ—¶äº§ç”Ÿå¤§é‡çš„ç±»å»å¡«æ»¡æ–¹æ³•åŒºç›´åˆ°æº¢å‡ºï¼Œè¿™é‡Œå€ŸåŠ©çš„æ˜¯ GGLib ç›´æ¥æ“ä½œå­—èŠ‚ç ç”Ÿæˆå¤§é‡çš„åŠ¨æ€ç±»ã€‚ã€Œè¿™ä¸ªåœ°æ–¹æˆ‘ä¸å¤ªä¼šâ€¦ã€ã€Œ-XX:PermSizeã€ æœ¬æœºç›´æ¥å†…å­˜æº¢å‡ºã€Œ-XX:MaxDirectMemorySizeã€ 3. è¡¥å……ï¼šè™šæ‹Ÿæœºéƒ¨åˆ†å‚æ•°-vmargs -Xms128M -Xmx512M -XX:PermSize=64M -XX:MaxPermSize=128M-vmargs è¯´æ˜åé¢æ˜¯VMçš„å‚æ•°ï¼Œæ‰€ä»¥åé¢çš„å…¶å®éƒ½æ˜¯JVMçš„å‚æ•°äº†-Xms128m JVMåˆå§‹åˆ†é…çš„å †å†…å­˜-Xmx512m JVMæœ€å¤§å…è®¸åˆ†é…çš„å †å†…å­˜ï¼ŒæŒ‰éœ€åˆ†é…-XX:PermSize=64M JVMåˆå§‹åˆ†é…çš„éå †å†…å­˜-XX:MaxPermSize=128M JVMæœ€å¤§å…è®¸åˆ†é…çš„éå †å†…å­˜ï¼ŒæŒ‰éœ€åˆ†é… ç¬¬ä¸‰ç«  åƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥é—®é¢˜ï¼š å“ªäº›å†…å­˜éœ€è¦å›æ”¶ ä»€ä¹ˆæ—¶å€™å›æ”¶ å¦‚ä½•å›æ”¶ Qï¼šå“ªäº›å†…å­˜éœ€è¦å›æ”¶ï¼Ÿ å…¶ä¸­ï¼Œç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆä¸‰ä¸ªåŒºåŸŸéšçº¿ç¨‹è€Œç”Ÿã€éšçº¿ç¨‹è€Œç­ï¼Œæ¯ä¸€ä¸ªæ ˆå¸§åˆ†é…å¤šå°‘å†…å­˜åŸºæœ¬ä¸Šæ˜¯åœ¨ç±»ç»“æ„ç¡®å®šä¸‹æ¥æ—¶å°±å·²çŸ¥çš„ï¼ˆå°½ç®¡ JIT ç¼–è¯‘æœŸä¼šåœ¨è¿è¡ŒæœŸé—´è¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œä½†å¤§ä½“å¯ä»¥ç†è§£ä¸ºç¼–è¯‘æœŸé—´å°±å¯çŸ¥ï¼‰ï¼Œæ‰€ä»¥è¿™å‡ ä¸ªåŒºåŸŸçš„åˆ†é…å’Œå›æ”¶éƒ½å…·å¤‡ç¡®å®šæ€§ï¼Œä¸éœ€è¦è¿‡å¤šè€ƒè™‘å›æ”¶çš„é—®é¢˜ï¼Œä½†æ˜¯ Java å †å’Œæ–¹æ³•åŒº å°±ä¸ä¸€æ ·äº†ï¼Œè¿™é‡Œæ˜¯å…¬å…±åŒºåŸŸï¼Œä¸æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ‰€ä»¥åªæœ‰åœ¨è¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå†…å­˜çš„å ç”¨åˆ†é…æƒ…å†µï¼Œè¿™éƒ¨åˆ†çš„å†…å­˜çš„åˆ†é…å’Œå›æ”¶éƒ½æ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥ GC å°±æ˜¯æŒ‡çš„è¿™ä¸€å—çš„å†…å­˜ã€‚ å¾ˆå¤šäººè®¤ä¸ºæ–¹æ³•åŒºï¼ˆæˆ–è€…è¯´ HotSpot è™šæ‹Ÿæœºä¸­çš„æ°¸ä¹…ä»£ï¼‰æ˜¯æ²¡æœ‰åƒåœ¾æ”¶é›†æœºåˆ¶çš„ï¼Œçš„ç¡®åœ¨ java è™šæ‹Ÿæœºè§„åˆ’ä¸­ç¡®å®æ²¡æœ‰è¦æ±‚è¦åœ¨æ–¹æ³•åŒºå®ç°åƒåœ¾æ”¶é›†ï¼Œå› ä¸ºæ€§ä»·æ¯”å¾ˆä½ï¼Œåœ¨å †ä¸­ï¼Œå°¤å…¶æ˜¯æ–°ç”Ÿä»£ä¸­ï¼Œå¸¸è§„åº”ç”¨ä¸€æ¬¡åƒåœ¾æ”¶é›†å¯ä»¥å›æ”¶ 70% - 95% çš„ç©ºé—´ï¼Œè€Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†æ•ˆç‡è¿œä½äºæ­¤ã€‚ ä½†æ˜¯ï¼Œå…¶å®è¿˜æ˜¯æœ‰å¿…è¦è¿›è¡Œåƒåœ¾æ”¶é›†çš„ï¼Œå°¤å…¶æ˜¯åœ¨å¤§é‡ä½¿ç”¨åå°„ã€åŠ¨æ€ä»£ç†ã€GGLibç­‰ bytecode æ¡†æ¶çš„åœºæ™¯æ˜¯éœ€è¦å…·å¤‡ç±»å¸è½½çš„åŠŸèƒ½é˜²æ­¢æ–¹æ³•åŒº OOM çš„ã€‚æ°¸ä¹…ä»£çš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†ï¼šåºŸå¼ƒå¸¸é‡å’Œæ— ç”¨çš„ç±»ï¼ŒåºŸå¼ƒå¸¸é‡çš„æ”¶é›†æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ²¡äººç”¨äº†ï¼Œå°±ä¼šè¢«è¯·å‡ºå¸¸é‡æ± ï¼Œä½†æ˜¯æ— ç”¨çš„ç±»è¿™ä¸ªæ¡ä»¶å°±å¾ˆä¸¥è‹›äº†ï¼Œåªæœ‰åŒæ—¶ï¼Œæ³¨æ„ä½¿ç”¨æ—¶æ»¡è¶³ä¸‹é¢ 3 ä¸ªæ¡ä»¶æ‰èƒ½ç®—æ˜¯â€œæ— ç”¨çš„ç±»â€ï¼š è¯¥ç±»æ‰€æœ‰å®ä¾‹è¢«å›æ”¶ï¼› åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶ï¼› è¯¥ç±»å¯¹åº”çš„ java.lang.Class å¯¹è±¡æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œä¸”æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚ã€Œè¿™ä¸ªå¥½åƒéå¸¸çš„ä¸¥æ ¼â€¦ã€ Qï¼šä»€ä¹ˆæ—¶å€™å›æ”¶ï¼Ÿ ç¬¬ä¸€æ­¥è‚¯å®šæ˜¯ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å¦è¿˜â€œæ´»ç€â€ã€‚é‚£ä¹ˆå¦‚ä½•ç¡®å®šå‘¢ï¼Ÿæœ‰å“ªäº›æ–¹æ³•å‘¢ï¼Ÿ ç¬¬ä¸€ç§æ–¹æ³•è™½ç„¶ä¸æ˜¯ Java ä¸­ä½¿ç”¨çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›è‘—åæ¡ˆä¾‹ä½¿ç”¨è¿‡ã€‚é‚£å°±æ˜¯è®¡æ•°ç®—æ³•ï¼šç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¼•ç”¨äº†ä¸€æ¬¡å°±åŠ ä¸€ï¼Œå¼•ç”¨å¤±æ•ˆå°±å‡ä¸€ï¼Œåœ¨ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨éƒ½ä¸º0çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ï¼Œå°±å¯ä»¥å›æ”¶ã€‚ä½†æ˜¯è¿™é‡Œæ¼æ‰äº†ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯ç±»ä¼¼äºæ­»é”çš„æƒ…å†µï¼Œä¸€ä¸ªå¼•ç”¨äº’ç›¸æŒæœ‰å¦å¤–ä¸€ä¸ªå¼•ç”¨ï¼Œè¿™æ ·è™½ç„¶è®¡æ•°å™¨çš„å€¼éƒ½ä¸º 1 ï¼Œä½†æ˜¯äºŒè€…å…¶å®å·²ç»ä¸å¯èƒ½å†è¢«è®¿é—®äº†ï¼Œç†åº”è¢«å›æ”¶ï¼Œä½†è¿™ä¸ªç®—æ³•åšä¸åˆ°ï¼› ç¬¬äºŒç§æ–¹æ³•å°±æ˜¯ Java å’Œ C# ç”¨çš„æ–¹æ³•äº†ï¼Œä¸ºæ ¹æœç´¢ç®—æ³•ï¼Œç®—æ³•çš„åŸºæœ¬æ€è·¯å°±æ˜¯ï¼šå¦‚æœ GC Roots å¯¹è±¡åˆ°è¿™ä¸ªå¯¹è±¡ä¸å¯è¾¾ï¼Œåˆ™è¿™ä¸ªå¯¹è±¡ä¸å¯ç”¨ã€‚ å¤§å®¶å¯èƒ½ä¼šé—®äº†ï¼Œä»€ä¹ˆæ˜¯ GC Roots å¯¹è±¡ï¼Œåˆå¦‚ä½•å®šä¹‰ä¸å¯è¾¾ï¼Ÿ å¯ä»¥åš GC Roots çš„ï¼Œå…¶å®å°±æ˜¯éƒ¨åˆ†å¯¹è±¡ï¼š æ ˆä¸­æœ¬åœ°å˜é‡è¡¨ or native æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼› æ–¹æ³•åŒº(non-heap)ä¸­çš„ç±»é™æ€å±æ€§å¼•ç”¨çš„å˜é‡ï¼› æ–¹æ³•åŒº(non-heap)ä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼› é‚£ä¹ˆåˆå¦‚ä½•å®šä¹‰ä¸å¯è¾¾å‘¢ï¼Ÿå³ä»¥ GC Roots çš„å¯¹è±¡ä¸ºèµ·å§‹ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å‘ä¸‹æœç´¢ï¼Œæ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“GC Roots å’Œè¿™ä¸ªå¯¹è±¡ä¸å­˜åœ¨å¼•ç”¨é“¾ï¼Œé‚£å°±æ˜¯ä¸å¯è¾¾ã€‚ ç°åœ¨æˆ‘ä»¬å·²ç»æ¸…æ¥šäº†å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯ â€œæ´»ç€â€ è¿˜æ˜¯ â€œæ­»äº¡â€ äº†ï¼Œé‚£æ˜¯ä¸æ˜¯å¯¹è±¡ â€œæ´»ç€â€ å®ƒå°±ä¸ä¼šè¢«å›æ”¶å‘¢ï¼Œå¯¹è±¡ â€œæ­»äº¡â€ æˆ‘ä»¬å°±è¦å°†å…¶å›æ”¶å‘¢ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼ˆå¦‚æœæ˜¯è‚¯å®šçš„æˆ‘è¿˜è¯´ä¸ªæ¯›å•Šå“ˆå“ˆå“ˆå“ˆï¼‰ã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„ä¸¤å¥è¯éƒ½æ˜¯ä¸å¯¹çš„ã€‚ é¦–å…ˆæ˜¯ â€œæ´»ç€â€ çš„å¯¹è±¡ä¸æ˜¯ä¸€å®šä¸è¢«å›æ”¶çš„ï¼Œè¦â€œæ´»ç€â€ï¼Œä¹Ÿè¦çœ‹å®ƒæ€ä¹ˆæ´»ï¼Œæ€ä¹ˆä¸ªæ´»æ³•ï¼Œå°±æ˜¯å¯¹åº”ç€è¿™ä¸ªé“¾è·¯çš„å¼ºåº¦ï¼Œåœ¨ jdk1.2 ä»¥åï¼Œå¼•ç”¨åˆ†ä¸ºäº†å››ç±»ï¼Œè¿™ä¸ªæˆ‘åœ¨ å¤šçº¿ç¨‹ï¼ˆå››ï¼‰â€” ThreadLocal ä¸€æ–‡ä¸­çš„å†…å­˜æ³„æ¼ä¹Ÿæœ‰æåŠã€‚ä»¥ä¸‹çš„é¡ºåºï¼Œå°±æ˜¯å¼•ç”¨ä»å¼ºåˆ°å¼±çš„é¡ºåºã€‚ å¼ºå¼•ç”¨ã€‚å¬è¿™ä¸ªåå­—å°±çŸ¥é“è¿™æ˜¯ä¸Šç­‰äººï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åœ¨ç¨‹åºä»£ç ä¸­æ™®éå­˜åœ¨çš„ï¼Œç±»ä¼¼äº â€œObject obj = new Object()â€ ï¼Œåªè¦å¯¹è±¡çš„å¼ºå¼•ç”¨è¿˜åœ¨ï¼Œä»–å°±ä¸€å®šèƒ½å¥½å¥½çš„æ´»ç€ï¼Œä¸ä¼šè¢« GC å›æ”¶ï¼›ã€ŒReferenceç±»ã€ è½¯å¼•ç”¨ã€‚å°±æ˜¯ä¸€äº›æœ‰ç”¨ä½†æ˜¯åˆä¸æ˜¯å¿…è¦çš„ï¼Œç±»ä¼¼äºå·¥å…·äººï¼Œè¢«è½¯å¼•ç”¨å…³è”çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå³å°†è¦å‘ç”ŸOOMæ—¶ï¼Œä¼šå°†è¿™äº›å¯¹è±¡è¿›è¡Œå›æ”¶ï¼Œå›æ”¶ä¹‹åå‘ç°è¿˜æ˜¯å†…å­˜ä¸å¤Ÿï¼Œæ‰ä¼šæŠ›å‡º OOM å¼‚å¸¸ã€‚ã€ŒsoftReferenceç±»ã€ å¼±å¼•ç”¨ã€‚è¿™ä¸ªæ›´æ²¡ç”¨ï¼Œä»–çš„ç”Ÿå­˜å‘¨æœŸå¾ˆçŸ­ï¼Œåªèƒ½æ´»åœ¨ä¸‹ä¸€æ¬¡ GC å·¥ä½œä¹‹å‰ï¼Œå½“ GC å¼€å§‹å¹²æ´»æ—¶ï¼Œè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡å°±å¾—æ»šè›‹äº†ã€‚ã€ŒWeakReferenceã€è¿™é‡Œå†å” å¨ä¸€ä¸‹ï¼ŒThreadLocalMap ä¸­çš„ key å¯¹ ThreadLocal çš„å¼•ç”¨å°±æ˜¯å¼±å¼•ç”¨ï¼Œç›®çš„å°±æ˜¯ä¸ºé˜²æ­¢å†…å­˜æ³„æ¼æ·»åŠ ä¸€ä¸ªä¿éšœï¼Œå½“ ThreadLocal å¤±å»äº†å¼ºå¼•ç”¨åï¼Œä¼šè¢« GC å¤„ç†ï¼Œè€Œæ­¤æ—¶ key ä¸º nullï¼Œå¯ä»¥è§¦å‘ThreadLocalMapä¸­æ¸…é™¤è„ Entry çš„æ–¹æ³•é˜²æ­¢å†…å­˜æ³„æ¼ã€‚ è™šå¼•ç”¨ã€‚è¿™ä¸ªåˆè¢«ç§°ä¸ºå¹½çµå¼•ç”¨æˆ–è€…å¹»å½±å¼•ç”¨(å¦ˆçš„æˆ‘æœ‰ç‚¹æ€•é¬¼..)ï¼Œä¸€ä¸ªå¯¹è±¡è¢«è¿™ä¸ªè™šå¼•ç”¨å…³è”ï¼Œç­‰äºæ²¡å…³è”ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥å–å¾—ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œå”¯ä¸€çš„ä½œç”¨å°±æ˜¯å¯ä»¥åœ¨è¿™ä¸ªå¯¹è±¡è¢« GC å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå°±æ˜¯é˜ç‹çˆ·æ¥æ”¶å°¸å‰æ´¾æ¥å‘Šè¯‰ä½ è¦æ­»çš„é‚£å‡ ä¸ªå°å…µçš„ä½œç”¨(æŠŠæˆ‘è‡ªå·±è¯´æ€•äº†â€¦)ã€‚ã€ŒPhantomReferenceã€ å†æ¥è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯â€œæ­»äº¡â€ çš„å¯¹è±¡ï¼Œä¹Ÿä¸ä¸€å®šå°±è¦è¢«å›æ”¶ï¼Œä»–åªæ˜¯å¤„äºç¼“åˆ‘é˜¶æ®µï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸Šè¯‰æ¥æ´»ç€å“ˆå“ˆã€‚(è¿™ä¸€ç« æ˜¯çœŸçš„æœ‰æ„æ€å•Š) è¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼šç¬¬ä¸€æ¬¡æ ‡è®°å°±æ˜¯æ ‡è®°å®ƒä¸å¯è¾¾ï¼Œå³â€œæ­»äº¡â€çš„çŠ¶æ€ï¼ŒåŒæ—¶ä»–æœ‰ä¸€æ¬¡â€œä¸Šè¯‰â€çš„æœºä¼šï¼Œå¾ˆæ˜æ˜¾ä¸Šè¯‰æˆåŠŸå°±ä¸ä¼šæ­»ï¼Œä¸Šè¯‰å¤±è´¥é‚£è‚¯å®šæ­»å®šäº†ã€‚é‚£ï¼Œå¦‚ä½•æ‰èƒ½æ‹¥æœ‰è¿™æ¬¡éš¾å¾—çš„æœºä¼šå‘¢ï¼Ÿé‚£å°±æ˜¯è¿™ä¸ªè¢«æ ‡è®°ä¸ºâ€œæ­»äº¡â€çš„å¯¹è±¡æœ‰è¦†ç›– finalize() æ–¹æ³•ï¼Œå¹¶ä¸”ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œæ³¨æ„ï¼Œä»–åªæœ‰ä¸€æ¬¡â€œä¸Šè¯‰â€çš„æœºä¼šã€‚å½“æ»¡è¶³ä¸Šè¯‰æœºä¼šçš„æ—¶å€™ï¼Œå³å¤å†™ finalize() å¹¶ä¸”æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œå®ƒä¼šè¢«æ”¾ç½®åˆ° F-Queueä¸­ï¼Œå¹¶åœ¨ç¨åç”±ä¸€æ¡ç”±è™šæ‹Ÿæœºè‡ªåŠ¨åˆ›å»ºçš„ã€ä½ä¼˜å…ˆçº§çš„ Finalizer å»è§¦å‘è¿™ä¸ª ä»–å¤å†™çš„ finalize()ã€Œæ³¨æ„ï¼Œè¿™é‡Œçš„ Finalizerç”±äºä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨çº¿ç¨‹ä¸­ç­‰å¾…ä»–ä¸€æ®µæ—¶é—´ï¼Œä»¥ç¡®ä¿å®ƒå·²ç»æ‰§è¡Œäº†ã€‚åŒæ—¶ï¼Œæ³¨æ„ï¼Œè¿™ä¸ª Finalizer å¾ˆä¸¥è‹›ï¼Œå®ƒä¸ä¼šå…è®¸ finalize() ä¸€ç›´æ‰§è¡Œï¼Œæ˜¯æœ‰æ—¶é—´é™åˆ¶çš„ï¼Œå°±è·Ÿä¸Šè¯‰ä¸€æ ·ï¼Œæ˜¯æœ‰æœŸé™çš„ï¼Œè¿‡äº†è¿™ä¸ªæœŸé™å°±æ²¡ç”¨äº†ã€‚ã€ï¼Œé‚£è½¬æœºè‚¯å®šå°±åœ¨è¿™ä¸ª finalize() ä¸­äº†ï¼Œåªè¦â€œæ­»äº¡â€çš„å¯¹è±¡åœ¨è¿™ä¸ªæ—¶å€™å°†è‡ªå·±ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”ï¼Œæ¯”å¦‚è‡ªå·±èµ‹å€¼ç»™æŸä¸ªç±»æˆå‘˜å˜é‡ï¼Œè¿™å°±æ„å‘³ç€ä¸Šè¯‰æˆåŠŸå¹¶ä¸”å¾—åˆ°è§£æ”¾å•¦ï¼å½“ç„¶å¦‚æœæ²¡æŠ“ä½è¿™æ¬¡æœºä¼šï¼Œé‚£è‚¯å®šå°±æ­»å®šäº†ã€‚ æ³¨æ„è¿™é‡Œ finalize() åªæœ‰ä¸€æ¬¡æœºä¼šå“¦ã€‚åœ¨å‘¨è€å¸ˆçš„ä¹¦ä¸­ï¼Œä¹Ÿå»ºè®®æˆ‘ä»¬é¿å…ä½¿ç”¨å®ƒï¼Œè™½ç„¶æŒºå¥½ç©çš„â€¦ä½†æ˜¯ finalize() æ²¡å•¥ç”¨ï¼Œè€Œä¸”è¿è¡Œä»£ä»·é«˜æ˜‚ï¼Œä¸ç¡®å®šæ€§å¤§ï¼Œå®ƒèƒ½åšçš„å·¥ä½œ try-finally å®Œå…¨å¯ä»¥åšçš„æ›´å¥½ã€‚ Qï¼šå¦‚ä½•å›æ”¶ï¼Ÿ è¿™ä¸ªé—®é¢˜æ¯”è¾ƒå®½æ³›ï¼Œæˆ‘ä»¬åšä¸€ä»¶äº‹ï¼Œé¦–å…ˆéœ€è¦ç†è®ºçš„æŒ‡å¯¼ï¼Œç„¶åå†å»å®è·µã€‚åœ¨å¦‚ä½•å›æ”¶è¿™ä»¶é—®é¢˜ä¸Šï¼Œæˆ‘ä»¬å…ˆè¦æå‡ºä¸€äº›åƒåœ¾æ”¶é›†ï¼ˆå›æ”¶ï¼‰çš„ç®—æ³•ï¼Œç„¶åå†åˆ©ç”¨è¿™ä¸ªæ–¹æ³•è®ºå»å…·ä½“å®ç°å†…å­˜çš„å›æ”¶â€”â€”-åƒåœ¾æ”¶é›†å™¨ã€‚ åƒåœ¾æ”¶é›†ç®—æ³•ã€‚å…¶å®å°±æ˜¯ä»¥ä¸€ç§æ–¹æ³•ä¸ºåŸºç¡€ï¼Œç„¶åä¸¤ç§æ–¹æ³•åœ¨æŸä¸ªé¢†åŸŸï¼ˆæ–°ç”Ÿä»£ or è€å¹´ä»£ï¼‰æ›´ä¸“ä¸šï¼Œæœ€åä¸€ç§æ–¹æ³•é›†å¤§æˆã€‚ æœ€åŸºç¡€çš„æ–¹æ³•ï¼Œæ ‡è®°-æ¸…é™¤ç®—æ³•ã€‚åˆ†ä¸ºä¸¤æ­¥ï¼Œå³â€œæ ‡è®°â€ å’Œ â€œæ¸…é™¤â€ï¼šé¦–å…ˆæ ‡è®°å‡ºè¦å›æ”¶çš„å¯¹è±¡ï¼Œç„¶åå†æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰ã€‚ç¼ºç‚¹ï¼šä¸€ä¸ªæ˜¯æ•ˆç‡é—®é¢˜ï¼Œæ ‡è®°å’Œæ¸…é™¤éƒ½æ˜¯éœ€è¦è¾ƒå¤šæ—¶é—´ï¼Œæ•ˆç‡ä½ï¼Œä¸€ä¸ªæ˜¯ç©ºé—´é—®é¢˜ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åå®¹æ˜“äº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œéå¸¸å®¹æ˜“é€ æˆä¸‹ä¸€æ¬¡æƒ³åˆ†é…å¯¹è±¡æ—¶æ‰¾ä¸åˆ°è¿ç»­å†…å­˜è€Œä¸å¾—è§¦å‘å†ä¸€æ¬¡çš„ GC ï¼› å¤åˆ¶ç®—æ³•ã€‚ä¸»è¦æ˜¯ç”¨åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œå› ä¸ºæ–°ç”Ÿä»£ 98% çš„å¯¹è±¡éƒ½æ˜¯æ­»å¾—å¿«çš„â€¦æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å†…å­˜åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„ Eden ç©ºé—´å’Œä¸¤å—è¾ƒå°çš„ Survivor ç©ºé—´ã€Œä¸ºä»€ä¹ˆè¦è®¾ç«‹ Survivor åŒºï¼Œä¸ºä½•æ˜¯ä¸¤å—ï¼Œä¸ºä½•ä¸æ˜¯ä¸€å—ã€ä¸‰å—ã€å››å—ï¼Ÿè®¾ç«‹ Survivor åŒºä¸»è¦æ˜¯è€ƒè™‘åˆ°é˜²æ­¢é¢‘ç¹ full gcï¼Œè€Œè®¾ç«‹ä¸¤å—ï¼Œåˆ™æ˜¯ä¸ºäº†è§£å†³minor gcå†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œè®¾ç«‹å¤ªå¤šåè€Œä¼šé€ æˆ Survivorç©ºé—´å¤ªå°ï¼Œå¯¼è‡´full gc é¢‘ç¹ï¼Œæ‰€ä»¥ä¸¤å— Survivor æ˜¯æœ€å¥½çš„ã€‚ã€ï¼Œç„¶åæ¯æ¬¡ä½¿ç”¨ Eden å’Œ ä¸€å— Survivorï¼Œå¦å¤–ä¸€å— Survivor å°±å¯ä»¥ç”¨æ¥å­˜åƒåœ¾æ”¶é›†å®Œä¹‹åè¿˜å­˜æ´»ç€çš„å¯¹è±¡ï¼Œè¿™æ ·æ¸…ç†ä¹Ÿæ–¹ä¾¿ï¼Œæ•ˆç‡å¾—åˆ°è§£å†³ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šæœ‰ç©ºé—´ä¸Šçš„é—®é¢˜ï¼Œå› ä¸ºå¯ä»¥åœ¨å¤åˆ¶çš„æ—¶å€™ç›´æ¥ç§»åŠ¨å †é¡¶æŒ‡é’ˆæŒ‰é¡ºåºåˆ†é…å°±è¡Œäº†ã€‚ä½†æ˜¯å§ï¼Œè¿™ä¹Ÿæœ‰ä¸ªå¾ˆæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œå°±æ˜¯ Survivor è¿™å—å†…å­˜è¢«æµªè´¹äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬å¹¶ä¸èƒ½ä¿è¯æ¯æ¬¡å›æ”¶ä¹‹åçš„å¯¹è±¡å¤§å°ä¸è¶…è¿‡ Survivorï¼Œå½“ Survivor ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç”¨åˆ°ä¸€ä¸ªç­–ç•¥ï¼šåˆ†é…æ‹…ä¿ã€‚å³å½“ Survivor ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œè¿™äº›å¯¹è±¡ä¼šç›´æ¥é€šè¿‡åˆ†é…æ‹…ä¿ç­–ç•¥è¿›å…¥åˆ°è€å¹´ä»£ï¼› æ ‡è®°-æ•´ç†ç®—æ³•ã€‚å› ä¸ºè€å¹´ä»£å­˜æ´»ç‡å¾ˆé«˜ï¼Œè‚¯å®šå°±ä¸èƒ½ç”¨å¤åˆ¶ç®—æ³•äº†ï¼Œè¿™é‡Œçš„æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œå°±æ˜¯å¯¹æ ‡è®°-æ¸…é™¤çš„å‡çº§ï¼Œåœ¨æ¸…ç†ä¹‹å‰ï¼Œç”±äºä¸èƒ½åƒå¤åˆ¶ç®—æ³•ä¸€æ ·ç›´æ¥æ¸…ç†ï¼Œåªèƒ½æ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åå†æ¸…ç†æ‰è¾¹ç•Œä»¥å¤–çš„å†…å­˜ï¼› ã€ŒG1 å°±ç”¨äº†è¿™ç§ç®—æ³•ã€‚ã€ åˆ†ä»£æ”¶é›†ç®—æ³•ã€‚åªæ˜¯æ ¹æ®å¯¹è±¡çš„å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œç„¶åæ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£ä½¿ç”¨æ ‡è®°-æ¸…ç† or æ ‡è®°-æ•´ç†ã€‚ åƒåœ¾æ”¶é›†ç®—æ³•çš„å®ç°â€”â€”åƒåœ¾æ”¶é›†å™¨ æ—¢ç„¶åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ˜¯æŒ‰ç…§æ–°ç”Ÿä»£å’Œè€å¹´ä»£åˆ†åˆ«å»è®¾è®¡çš„ï¼Œé‚£è‡ªç„¶åƒåœ¾æ”¶é›†å™¨è‚¯å®šä¹Ÿæ˜¯æŒ‰ç…§æ–°ç”Ÿä»£å’Œè€å¹´ä»£å»å®ç°ã€‚ æ–°ç”Ÿä»£çš„æ”¶é›†å™¨åŒ…æ‹¬ Serial ParNew Parallel Scavenge 2.è€å¹´ä»£çš„æ”¶é›†å™¨åŒ…æ‹¬ Serial Old Parallel Old CMS 3.å›æ”¶æ•´ä¸ªJavaå †(æ–°ç”Ÿä»£å’Œè€å¹´ä»£) G1æ”¶é›†å™¨ å…·ä½“çš„æ­é…å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ä¸‹é¢å…·ä½“è®²ä¸€ä¸‹ç”¨çš„åœºæ™¯å’Œä¼˜ç¼ºç‚¹ã€‚ æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼š Serialä¸²è¡Œæ”¶é›†å™¨-å¤åˆ¶ç®—æ³• Serialæ”¶é›†å™¨æ˜¯æ–°ç”Ÿä»£å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä¼˜ç‚¹æ˜¯ç®€å•é«˜æ•ˆï¼Œæ˜¯æœ€åŸºæœ¬ã€å‘å±•å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨ã€‚å®ƒåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒæ”¶é›†å®Œæˆã€‚ä½†ä¾ç„¶æ˜¯è™šæ‹Ÿæœºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå¯¹äºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ ParNewæ”¶é›†å™¨-å¤åˆ¶ç®—æ³• ä¹Ÿæ˜¯æ–°ç”Ÿä»£å¹¶è¡Œæ”¶é›†å™¨ï¼Œå…¶å®å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚ä¸»ä¹‰åªèƒ½åšåˆ°å¹¶è¡Œï¼Œä¸èƒ½å¹¶å‘ã€‚é™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†ä¹‹å¤–ï¼Œå…¶ä½™è¡Œä¸ºåŒ…æ‹¬Serialæ”¶é›†å™¨å¯ç”¨çš„æ‰€æœ‰æ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ã€Stop The Worldã€å¯¹è±¡åˆ†é…è§„åˆ™ã€å›æ”¶ç­–ç•¥ç­‰éƒ½ä¸Serial æ”¶é›†å™¨å®Œå…¨ä¸€æ ·ã€‚ å¹¶è¡Œï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ï¼› å¹¶å‘ï¼šç”¨æˆ·çº¿ç¨‹å’Œå¤šåƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼ˆä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„ï¼Œå¯èƒ½æ˜¯äº¤æ›¿æ‰§è¡Œï¼‰ Parallel Scavengeï¼ˆå¹¶è¡Œå›æ”¶ï¼‰æ”¶é›†å™¨-å¤åˆ¶ç®—æ³•æ–°ç”Ÿä»£å¹¶è¡Œæ”¶é›†å™¨ï¼Œè¿½æ±‚é«˜ååé‡ï¼Œé«˜æ•ˆåˆ©ç”¨ CPUã€‚è¯¥æ”¶é›†å™¨çš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThroughputï¼‰ã€‚æ‰€è°“ååé‡å°±æ˜¯CPUç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸CPUæ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ï¼Œå³ ååé‡=è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´/ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰ï¼Œæ‰€ä»¥è¯¥æ”¶é›†å™¨ä¹Ÿè¢«å¸¸ç§°ä¸º â€œååé‡ä¼˜å…ˆâ€æ”¶é›†å™¨ã€‚ å®ƒå’Œ ParNew çš„ä¸»è¦åŒºåˆ«æœ‰ä¸¤ä¸ªï¼š å…³æ³¨ç‚¹ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯ä¸ºäº†åœé¡¿æ—¶é—´æ›´çŸ­ï¼Œè¿™é€‚åˆç”¨æˆ·äº¤äº’ï¼Œä¸€ä¸ªåˆ™æ˜¯ä¸ºäº†æœ€é«˜çš„åˆ©ç”¨ CPU æ—¶é—´ï¼Œé€‚åˆåå°è¿ç®—ï¼› Parallel Scanvenge æœ‰ GC è‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼Œæ— éœ€è‡ªå·±è®¾ç½®æ–°ç”Ÿä»£å¤§å°ã€Eden å’Œ Survivorçš„æ¯”ä¾‹ç­‰ç­‰ï¼Œåªéœ€è¦æŠŠåŸºæœ¬çš„å†…å­˜æ•°æ®ï¼ˆå¦‚å †å¤§å°ã€ååé‡ï¼‰è®¾ç½®å¥½å³å¯ã€‚ å¥½åƒéƒ½æ˜¯ä¼˜ç‚¹ï¼Œä½†æ˜¯å…¶æœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼Œå°±æ˜¯å®ƒä¸èƒ½è·Ÿ CMS æ­é…ï¼Œæ‰€ä»¥CMS è¿˜æ˜¯ä¸€èˆ¬å’Œ ParNew è”åˆä½¿ç”¨ã€‚ è€å¹´ä»£æ”¶é›†å™¨ï¼š Serial Old æ”¶é›†å™¨-æ ‡è®° - æ•´ç†ç®—æ³• Serial Oldæ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹(ä¸²è¡Œ)æ”¶é›†å™¨ï¼Œä½¿ç”¨æ ‡è®°æ•´ç†ç®—æ³•ã€‚è¿™ä¸ªæ”¶é›†å™¨çš„ä¸»è¦æ„ä¹‰ä¹Ÿæ˜¯åœ¨äºç»™Clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚ å¦‚æœåœ¨Serveræ¨¡å¼ä¸‹ï¼Œä¸»è¦ä¸¤å¤§ç”¨é€”ï¼š ï¼ˆ1ï¼‰åœ¨JDK1.5ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä¸Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼› ï¼ˆ2ï¼‰ä½œä¸ºCMSæ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”ŸConcurrent Mode Failureæ—¶ä½¿ç”¨ã€‚ Parallel Old æ”¶é›†å™¨-æ ‡è®° - æ•´ç†ç®—æ³• Parallel Old æ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å’Œâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚è¿™ä¸ªæ”¶é›†å™¨åœ¨1.6ä¸­æ‰å¼€å§‹æä¾›ã€‚ CMS æ”¶é›†å™¨-æ ‡è®° - æ¸…é™¤ç®—æ³• CMS(Concurrent Mark Sweep)æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚é€‚ç”¨äºäº’è”ç½‘ç«™çš„æœåŠ¡å™¨ç«¯ã€‚æé«˜å“åº”é€Ÿåº¦ã€‚ å®ƒçš„è¿ä½œè¿‡ç¨‹ç›¸å¯¹å‰é¢å‡ ç§æ”¶é›†å™¨æ¥è¯´æ›´å¤æ‚ä¸€äº›ï¼Œæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸º4ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®°ã€‚æ ‡è®° GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦éå¸¸å¿«ï¼› å¹¶å‘æ ‡è®°ï¼Œæ”¶é›†å™¨çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹åŒæ­¥è¿›è¡Œï¼› é‡æ–°æ ‡è®°ï¼Œä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´çš„å˜åŒ–ï¼› å¹¶å‘æ¸…é™¤ã€‚ æ‰€ä»¥ä¼˜ç‚¹å¾ˆæ˜æ˜¾ï¼š1. å¹¶å‘æ”¶é›†ï¼›2. ä½åœé¡¿ï¼Œæ‰€ä»¥åˆç§°ä¸º â€œå¹¶å‘ä½åœé¡¿æ”¶é›†å™¨â€ï¼› ç¼ºç‚¹ä¹Ÿæœ‰ï¼š å¯¹ CPU èµ„æºæ•æ„Ÿï¼Œé»˜è®¤å¯ç”¨ ï¼ˆCPU æ•°é‡ + 3ï¼‰/4ï¼Œcpuå°‘çš„è¯é‚£å½±å“å¾ˆå¤§ï¼› æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ã€Œæ¸…ç†é˜¶æ®µå¯èƒ½ä¼šæœ‰æ–°çš„åƒåœ¾äº§ç”Ÿã€ï¼Œå¯èƒ½å‡ºç°â€œConcurrent Mode Failureâ€å¤±è´¥è€Œå¯¼è‡´å¦ä¸€æ¬¡Full GCçš„äº§ç”Ÿã€‚åœ¨JDK1.5çš„é»˜è®¤è®¾ç½®ä¸‹ï¼ŒCMSæ”¶é›†å™¨å½“è€å¹´ä»£ä½¿ç”¨äº†68%çš„ç©ºé—´åå°±ä¼šè¢«æ¿€æ´»ã€‚ CMSæ˜¯åŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œæ‰‹æœºç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚ç©ºé—´ç¢ç‰‡è¿‡å¤šï¼Œå¯èƒ½ä¼šå‡ºç°è€å¹´ä»£è¿˜æœ‰å¾ˆå¤§ç©ºé—´å‰©ä½™ï¼Œä½†æ˜¯æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œä¸å¾—ä¸æå‰è§¦å‘FullGCã€‚ æ–°ç”Ÿä»£å’Œè€å¹´ä»£åƒåœ¾æ”¶é›†å™¨ï¼š G1 æ”¶é›†å™¨-åˆ†ä»£æ”¶é›†ç®—æ³• â€” å…¼é¡¾ ååé‡ &amp; ä½åœé¡¿ ç‹¬ç‰¹çš„åˆ†ä»£åƒåœ¾å›æ”¶å™¨,åˆ†ä»£GC: åˆ†ä»£æ”¶é›†å™¨, åŒæ—¶å…¼é¡¾å¹´è½»ä»£å’Œè€å¹´ä»£ï¼› ä½¿ç”¨åˆ†åŒºç®—æ³•, ä¸è¦æ±‚eden, å¹´è½»ä»£æˆ–è€å¹´ä»£çš„ç©ºé—´éƒ½è¿ç»­ï¼› å¹¶è¡Œæ€§: å›æ”¶æœŸé—´, å¯ç”±å¤šä¸ªçº¿ç¨‹åŒæ—¶å·¥ä½œ, æœ‰æ•ˆåˆ©ç”¨å¤šæ ¸cpuèµ„æºï¼› ç©ºé—´æ•´ç†: å›æ”¶è¿‡ç¨‹ä¸­, ä¼šè¿›è¡Œé€‚å½“å¯¹è±¡ç§»åŠ¨, å‡å°‘ç©ºé—´ç¢ç‰‡ï¼› å¯é¢„è§æ€§: G1å¯é€‰å–éƒ¨åˆ†åŒºåŸŸè¿›è¡Œå›æ”¶, å¯ä»¥ç¼©å°å›æ”¶èŒƒå›´, å‡å°‘å…¨å±€åœé¡¿ã€‚ G1æ”¶é›†å™¨çš„é˜¶æ®µåˆ†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š 1ã€åˆå§‹æ ‡è®°ï¼ˆå®ƒæ ‡è®°äº†ä»GC Rootå¼€å§‹ç›´æ¥å¯è¾¾çš„å¯¹è±¡ï¼‰ï¼› 2ã€å¹¶å‘æ ‡è®°ï¼ˆä»GC Rootså¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ï¼‰ï¼› 3ã€æœ€ç»ˆæ ‡è®°ï¼ˆæ ‡è®°é‚£äº›åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µå‘ç”Ÿå˜åŒ–çš„å¯¹è±¡ï¼Œå°†è¢«å›æ”¶ï¼‰ï¼› 4ã€ç­›é€‰å›æ”¶ï¼ˆé¦–å…ˆå¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸå¾…çš„GCåœé¡¿æ—¶é—´æŒ‡å®šå›æ”¶è®¡åˆ’ï¼Œä¼˜å…ˆå›æ”¶åƒåœ¾æœ€å¤šçš„Regionï¼Œå› æ­¤ç§°ä¸º Garbage Firstï¼‰ã€‚ ç»å¸¸ä½¿ç”¨çš„å‚æ•°ï¼š -XX:+UseSerialGCï¼šåœ¨æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä½¿ç”¨ä¸²è¡Œæ”¶é›†å™¨-XX:+UseParNewGCï¼šåœ¨æ–°ç”Ÿä»£ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨-XX:+UseParallelGC ï¼šæ–°ç”Ÿä»£ä½¿ç”¨å¹¶è¡Œå›æ”¶æ”¶é›†å™¨ï¼Œæ›´åŠ å…³æ³¨ååé‡-XX:+UseParallelOldGCï¼šè€å¹´ä»£ä½¿ç”¨å¹¶è¡Œå›æ”¶æ”¶é›†å™¨-XX:ParallelGCThreadsï¼šè®¾ç½®ç”¨äºåƒåœ¾å›æ”¶çš„çº¿ç¨‹æ•°-XX:+UseConcMarkSweepGCï¼šæ–°ç”Ÿä»£ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨ï¼Œè€å¹´ä»£ä½¿ç”¨CMS+ä¸²è¡Œæ”¶é›†å™¨-XX:ParallelCMSThreadsï¼šè®¾å®šCMSçš„çº¿ç¨‹æ•°é‡-XX:+UseG1GCï¼šå¯ç”¨G1åƒåœ¾å›æ”¶å™¨ ä¸Šé¢ä¸‰ä¸ªé—®é¢˜ï¼ŒåŸºæœ¬è§£å†³äº†åƒåœ¾æ”¶é›†æ–¹é¢çš„é—®é¢˜äº†ï¼Œé‚£å›è¿‡å¤´æ¥ï¼Œå¯¹è±¡åˆæ˜¯å¦‚ä½•åˆ†é…å†…å­˜çš„å‘¢ï¼Ÿ å¯¹è±¡ä¼˜å…ˆåœ¨æ–°ç”Ÿä»£ Eden åŒºä¸­åˆ†é…ï¼Œå½“ Eden åŒºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºä¼šå‘èµ·ä¸€æ¬¡ Minor GCï¼Œå°† GC åè¿˜å­˜æ´»çš„å¯¹è±¡è½¬ç§»SurvivoråŒºï¼Œå¦‚æœSurvivoråŒºæº¢å‡ºäº†ä¼šè½¬ç§»åˆ°è€å¹´ä»£ä¸­ã€‚ æ–°ç”Ÿä»£GCï¼ˆMinor GCï¼‰ï¼šæŒ‡å‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼Œå› ä¸º Java å¯¹è±¡å¤§éƒ½å…·æœ‰æ­»å¾—å¿«çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ Minor GC ä¼šéå¸¸çš„é¢‘ç¹ï¼Œé€Ÿåº¦ä¹Ÿå¾ˆå¿«ï¼› è€å¹´ä»£GCï¼ˆMajor GC/Full GCï¼‰:æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ GCï¼Œå‡ºç°äº† Major GCï¼Œç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡ Minor GCï¼Œå½“ç„¶ä¹Ÿå¹¶éç»å¯¹ï¼Œåœ¨ ParallelScaVenge å°±æœ‰ç›´æ¥è¿›è¡Œ Major GC çš„ç­–ç•¥é€‰æ‹©è¿‡ç¨‹ã€‚Major GC çš„é€Ÿåº¦æ¯” Minor GC æ…¢ 10å€ä»¥ä¸Šã€‚ å¤§å¯¹è±¡ä¼šç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œå› ä¸ºå°±ç®—å®‰æ’è¿›æ–°ç”Ÿä»£çš„ Eden åŒºï¼ŒEden åŒºåŠä¸¤ä¸ª SurvivoråŒºä¹‹é—´ä¼šè¿›è¡Œå¤§é‡çš„å†…å­˜æ‹·è´ï¼Œè€Œä¸”ææœ‰å¯èƒ½ Survivor è£…ä¸ä¸‹è¿›è€Œè§¦å‘åˆ†é…æ‹…ä¿æœºåˆ¶è½¬ç§»åˆ°è€å¹´ä»£ï¼Œä¸å…¶è¿™æ ·ï¼Œä¸å¦‚ç›´æ¥å°†å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚ ä¸Šæ–‡ä¸€ç›´åœ¨è®²æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œé‚£äºŒè€…åˆ°åº•æ˜¯å¦‚ä½•ç•Œå®šå‘¢ï¼Ÿ è™šæ‹Ÿæœºç»™æ¯ä¸ªå¯¹è±¡éƒ½å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡å¹´é¾„è®¡æ•°å™¨ï¼Œå¦‚æœå¯¹è±¡åœ¨æ–°ç”Ÿä»£çš„ Eden åŒºåŸŸå‡ºç”Ÿå¹¶ä¸”ç»è¿‡ç¬¬ä¸€æ¬¡ Minor GC åä»ç„¶ç•™åœ¨ Survivor ä¸­ï¼Œé‚£ä¹ˆä»–çš„å¯¹è±¡å¹´é¾„å˜ä¸º 1 å²ï¼Œä»æ­¤ä¹‹åï¼Œè¯¥å¯¹è±¡åœ¨ Survivor æ¯ç†¬è¿‡ä¸€æ¬¡ Minor GC ï¼Œå¹´é¾„å°±ä¼šå¢åŠ ä¸€å²ï¼Œé»˜è®¤ä¼šåˆ° 15 å²æ‰æ™‹å‡åˆ°è€å¹´ä»£ä¸­ï¼Œé˜ˆå€¼å¯ä»¥é€šè¿‡å‚æ•° -XX:MaxTenuringThresholdè®¾ç½®ã€‚ å½“ç„¶ï¼Œä¸ºäº†é€‚åº”ä¸åŒç¨‹åºçš„å†…å­˜æƒ…å†µï¼Œè™šæ‹Ÿæœºå¹¶ä¸ä¼šæ€»æ˜¯æŒ‰ç…§å¯¹è±¡å¹´é¾„å¤§äºMaxTenuringThresholdæ‰æ™‹å‡åˆ°è€å¹´ä»£ï¼Œå¦‚æœ Survivor ç©ºé—´ä¸­ç›¸åŒå¹´é¾„çš„å¯¹è±¡çš„æ€»å¤§å°å·²ç»è¶…è¿‡äº† Survivor çš„ç©ºé—´çš„ä¸€åŠï¼Œåˆ™å¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡ç›´æ¥å°±å¯ä»¥æ™‹å‡åˆ°è€å¹´ä»£ã€‚ é‚£ä¸ºä½•è¦æœ‰è¿™ç§åŠ¨æ€å¹´é¾„è®¡ç®—å‘¢ï¼Ÿ å¦‚æœå›ºå®šæŒ‰ç…§MaxTenuringThresholdè®¾å®šçš„é˜ˆå€¼ä½œä¸ºæ™‹å‡æ¡ä»¶ï¼š aï¼‰MaxTenuringThresholdè®¾ç½®çš„è¿‡å¤§ï¼ŒåŸæœ¬åº”è¯¥æ™‹å‡çš„å¯¹è±¡ä¸€ç›´åœç•™åœ¨SurvivoråŒºï¼Œç›´åˆ°SurvivoråŒºæº¢å‡ºï¼Œä¸€æ—¦æº¢å‡ºå‘ç”Ÿï¼ŒEden+Svuvivorä¸­å¯¹è±¡å°†ä¸å†ä¾æ®å¹´é¾„å…¨éƒ¨æå‡åˆ°è€å¹´ä»£ï¼Œè¿™æ ·å¯¹è±¡è€åŒ–çš„æœºåˆ¶å°±å¤±æ•ˆäº†ã€‚ bï¼‰MaxTenuringThresholdè®¾ç½®çš„è¿‡å°ï¼Œâ€œè¿‡æ—©æ™‹å‡â€å³å¯¹è±¡ä¸èƒ½åœ¨æ–°ç”Ÿä»£å……åˆ†è¢«å›æ”¶ï¼Œå¤§é‡çŸ­æœŸå¯¹è±¡è¢«æ™‹å‡åˆ°è€å¹´ä»£ï¼Œè€å¹´ä»£ç©ºé—´è¿…é€Ÿå¢é•¿ï¼Œå¼•èµ·é¢‘ç¹çš„Major GCã€‚åˆ†ä»£å›æ”¶å¤±å»äº†æ„ä¹‰ï¼Œä¸¥é‡å½±å“GCæ€§èƒ½ã€‚ åœ¨æœ¬ç« çš„æœ€åï¼Œå†æ¥è¯¦ç»†å™è¿°ä¸€ä¸‹ç©ºé—´åˆ†é…æ‹…ä¿ã€‚ åœ¨å‘ç”Ÿ Minor GCæ—¶ï¼Œè™šæ‹Ÿæœº ä¼šæ£€æµ‹ä¸€ä¸‹ä¹‹å‰æ¯æ¬¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹³å‡å¤§å°æ˜¯å¦å¤§äºè€å¹´ä»£çš„å‰©ä½™ç©ºé—´å¤§å°ï¼ˆå› ä¸ºåœ¨å®é™…å›æ”¶ä¹‹å‰æ˜¯æ— æ³•ç¡®å®šæœ¬è½®çš„å¯¹è±¡å¤§å°æ˜¯å¤šå°‘ï¼Œåªèƒ½æŒ‰ä»¥å¾€çš„ç»éªŒå€¼ä¼°è®¡ï¼‰ å¦‚æœå¤§äºï¼Œè¯´æ˜ï¼Œå´©äº†ï¼Œåªèƒ½è¿›è¡Œ Full GCäº†; å¦‚æœå°äºï¼Œåˆ™å†æŸ¥çœ‹ HandlePromotionFailureï¼ˆå¤„ç†æ™‹å‡å¤±è´¥ï¼‰çš„è®¾ç½®ï¼ˆé»˜è®¤æ‰“å¼€ï¼Œä¸ç„¶Full GC å¤ªé¢‘ç¹äº†ï¼Œæ…¢çš„ä¸€æ‰¹ï¼‰ï¼Œ å¦‚æœå…è®¸ï¼Œåˆ™åªä¼šè¿›è¡Œ Minor GCï¼Œå¦‚æœMinor GCåæ‹…ä¿å¤±è´¥ï¼Œé‚£å°±æ²¡åŠæ³•äº†åªèƒ½é€‰æ‹©Full GCï¼Œå¦åˆ™å¦‚æœä¸å…è®¸å¤±è´¥ï¼Œé‚£å°±åªèƒ½è¿›è¡Œ Full GCã€‚ è°ˆåˆ°è¿™ä¹ˆå¤šæ¬¡ Full GCï¼ŒMinor GCé‚£æˆ‘æƒ³é—®ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœ Full GC or Minor GC é¢‘ç¹ï¼Œæœ‰å“ªäº›åŸå› å¯¼è‡´ï¼Ÿ Full GC é¢‘ç¹ï¼š å…ˆæ¥åˆ†æä¸€ä¸‹ï¼Œä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘ Full GC: ç¨‹åºæ‰§è¡Œäº†System.gc() //å»ºè®®jvmæ‰§è¡Œfullgcï¼Œå¹¶ä¸ä¸€å®šä¼šæ‰§è¡Œ æ‰§è¡Œäº†jmap -histo:live pidå‘½ä»¤ //è¿™ä¸ªä¼šç«‹å³è§¦å‘fullgcâ€¦è¿™ä¸ªå¯ä»¥ä¸è®² åœ¨æ‰§è¡Œminor gcçš„æ—¶å€™è¿›è¡Œçš„ä¸€ç³»åˆ—æ£€æŸ¥ // ä¸‰æ¬¡ fullgc çš„å¯èƒ½ ä½¿ç”¨äº†å¾ˆå¤šçŸ­å‘½çš„å¤§å¯¹è±¡ // å¤§å¯¹è±¡ç›´æ¥è¿›å…¥åˆ°è€å¹´ä»£ åœ¨ç¨‹åºä¸­é•¿æœŸæŒæœ‰äº†å¯¹è±¡çš„å¼•ç”¨ //å¯¹è±¡å¹´é¾„è¾¾åˆ°æŒ‡å®šé˜ˆå€¼ä¹Ÿä¼šè¿›å…¥è€å¹´ä»£ é¦–å…ˆ 1 2 è¿™ä¸¤æƒ…å†µæˆ‘ä»¬ä¸è€ƒè™‘ï¼Œç¬¬ 4 5 ç§æƒ…å†µä¹Ÿä¸ç”¨åˆ†æäº†ï¼Œé‡ç‚¹æ˜¯ç¬¬ 3 ç§æƒ…å†µï¼Œminor gc åå¯¼è‡´ full gcï¼Œæˆ‘è§‰å¾—åŸå› å¯èƒ½æœ‰ï¼š Eden è®¾ç½®è¿‡å° or Survivor è®¾ç½®è¿‡å°ï¼Œå¯¼è‡´é¢‘ç¹è§¦å‘ minor gc or æ‹…ä¿ç­–ç•¥è§¦å‘ï¼Œè¿™ç§æƒ…å†µä¸‹ä¸€æ¬¡ full gcåï¼Œå‰©ä½™çš„å¯¹è±¡åº”è¯¥å¾ˆå°‘ã€‚ å¯èƒ½æ˜¯è€å¹´ä»£å†…å­˜è®¾ç½®è¿‡å°ï¼Œå¯¼è‡´å¾ˆå®¹æ˜“ full gcã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€æ¬¡ full gc åï¼Œåœ¨è€å¹´ä»£ä¸­å†…å­˜åº”è¯¥ä¸ä¼šå‡å°‘å¾ˆå¤šï¼Œå›æ”¶ç‡å¾ˆä½ã€‚ æ‰€ä»¥æ€»çš„æ¥è¯´ï¼Œå…ˆçœ‹ä¸€æ¬¡å›æ”¶ full gc åçš„ç»“æœï¼Œç„¶åå†è¿›è¡Œåˆ¤æ–­ã€‚ Minor GC é¢‘ç¹ï¼š é‚£å°±åªèƒ½æ˜¯ Eden è®¾ç½®çš„å¤ªå°äº†ã€‚ JVM è°ƒä¼˜çš„åŸºæœ¬æ€è·¯ï¼š å¦‚æœæ˜¯ CMS é€šè¿‡çœ‹JDKè‡ªå¸¦çš„å›¾å½¢åŒ–å·¥å…·ï¼Œæ£€æŸ¥çº¿ç¨‹çš„çŠ¶æ€ã€‚äº†è§£åˆ°ä¸€ä¸ªJavaè¿›ç¨‹æœ‰å¤šå°‘çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä»€ä¹ˆçŠ¶æ€ï¼Œæ˜¯ä¸æ˜¯åœ¨ç­‰ç€é”ï¼šè¿›ç¨‹çš„CPUå’Œå†…å­˜å ç”¨äº†å¤šå°‘ï¼› å¦‚æœå‘ç°ç¨‹åºè·‘å¾—å¾ˆæ…¢ï¼Œå°±ç”¨å›¾å½¢åŒ–ç•Œé¢å»çœ‹ GC æ—¥å¿—ï¼› æ€»çš„æ¥è¯´å°±æ˜¯è¦å»åˆç†è®¾ç½®å¹´è½»ä»£å’Œè€å¹´ä»£çš„å¤§å°ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿­ä»£çš„è¿‡ç¨‹ï¼Œå¯ä»¥é‡‡ç”¨ JVM é»˜è®¤çš„é…ç½®é€šè¿‡å‹åŠ›æµ‹è¯•å»åˆ†æ GC æ—¥å¿—ï¼› å¦‚æœå‘ç°ç»å¸¸ Minor GCï¼Œå¹¶ä¸”å›æ”¶ç‡å¹¶ä¸é«˜ï¼Œåˆ™è¯´æ˜ Eden åŒºè®¾ç½®çš„è¿‡å°ï¼› å¦‚æœå‘ç°ç»å¸¸ Full GCï¼Œå…ˆè€ƒè™‘æ˜¯ä¸å¸¦è‡ªå·±å†™çš„ä»£ç æœ‰é—®é¢˜ï¼Œæ¯”å¦‚æ‰§è¡Œäº† System.gc()ã€ä½¿ç”¨äº†è¿‡å¤šå…¨å±€å˜é‡ã€ä½¿ç”¨äº†å¾ˆå¤šçŸ­å‘½çš„å¤§å¯¹è±¡ï¼Œç„¶åå¦‚æœæ’æŸ¥ä¸å‡ºæ¥ï¼› å†è€ƒè™‘å‚æ•°è°ƒä¼˜ï¼Œå¦‚æœå‘ç° Full GC åå†…å­˜å æœ‰ç‡ä¸‹æ¥äº†ï¼Œè¯´æ˜æ¸…é™¤äº†å¤§é‡åƒåœ¾ï¼Œå¯ä»¥è€ƒè™‘è°ƒå¤§å¹´è½»ä»£ Eden or Survivorï¼Œå¦‚æœæ²¡ä¸‹æ¥ï¼Œå¯èƒ½æ˜¯ å†…å­˜æ³„æ¼ or è€å¹´ä»£å¤ªå°ã€‚ å¦‚æœæ˜¯ G1ï¼Œåˆ™ç›´æ¥è°ƒå¤§å †çš„å†…å­˜åº”è¯¥å°±è¡Œäº†ã€‚å› ä¸ºG1æ”¶é›†å™¨é‡‡ç”¨äº†å±€éƒ¨åŒºåŸŸæ”¶é›†ç­–ç•¥ï¼Œå•æ¬¡åƒåœ¾æ”¶é›†çš„æ—¶é—´å¯æ§ï¼Œå¯ä»¥ç®¡ç†è¾ƒå¤§çš„Javaå †ã€‚ ç¬¬å…­ç«  ç±»æ–‡ä»¶ç»“æ„ç¼–è¯‘è¿‡ç¨‹è¿™ä¸€ç« å…¶å®è¿˜æ˜¯æ¯”è¾ƒç®€å•ä½†æ˜¯æ¯ç‡¥çš„ï¼Œä¸»è¦æ˜¯è®²äº† Class æ–‡ä»¶å­—èŠ‚ç ç»“æ„ã€‚ å°† .java æ–‡ä»¶å˜æˆ .class æ–‡ä»¶ï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œè¿™ä¸€è¿‡ç¨‹æ˜¯é  javac è¿™ä¸ªç¼–è¯‘å™¨å®Œæˆçš„ã€‚Java å’Œ C/C++ ä¸ä¸€æ ·ï¼ŒC/C++ æ˜¯é€šè¿‡ç›´æ¥å°†æºä»£ç ç¼–è¯‘æˆç›®æ ‡æœºå™¨ç ï¼ˆCPUç›´æ¥æ‰§è¡Œçš„æŒ‡ä»¤é›†åˆï¼‰ï¼Œè€Œ Java åˆ™æ˜¯åœ¨ä¸­é—´åŠ äº†ä¸€å±‚å­—èŠ‚ç ï¼Œä¹Ÿå°±æ˜¯æŠŠ javaæ–‡ä»¶è½¬æ¢æˆ class å­—èŠ‚ç ï¼Œç„¶å JVM èƒ½å¤Ÿè¯†åˆ«å­—èŠ‚ç ï¼Œä¹Ÿå°±æ˜¯èƒ½å¤ŸåŠ è½½ .class æ–‡ä»¶ï¼ˆè¿›è€Œå†é€šè¿‡ JVM å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç ï¼Œè¿™ä¸€æ­¥ä¹Ÿå¯æ²¡æœ‰ï¼‰ã€‚ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œéº¦ç”°ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/itmyhome1990/article/details/78847266 Class æ–‡ä»¶ç»„æˆä»»ä½•ä¸€ä¸ªClassæ–‡ä»¶éƒ½å¯¹åº”ç€å”¯ä¸€ä¸€ä¸ªç±»æˆ–æ¥å£çš„å®šä¹‰ä¿¡æ¯ï¼Œä½†åè¿‡æ¥è¯´ï¼Œç±»æˆ–æ¥å£å¹¶ä¸ä¸€å®šéƒ½å¾—å®šä¹‰åœ¨æ–‡ä»¶é‡Œï¼ˆè­¬å¦‚ç±»æˆ–æ¥å£ä¹Ÿå¯ä»¥é€šè¿‡ç±»åŠ è½½å™¨ç›´æ¥ç”Ÿæˆï¼‰ã€‚Class æ–‡ä»¶æ˜¯ä¸€ç»„ä»¥ 8 ä½å­—èŠ‚ä¸ºåŸºç¡€å•ä½çš„äºŒè¿›åˆ¶æµã€‚ æ ¹æ® Java è™šæ‹Ÿæœºè§„èŒƒçš„è§„å®šï¼ŒClass æ–‡ä»¶æ ¼å¼é‡‡ç”¨ä¸€ç§ç±»ä¼¼äºCè¯­è¨€ç»“æ„ä½“çš„ä¼ªç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™ç§ä¼ªç»“æ„ä¸­åªæœ‰ä¸¤ç§æ•°æ®ç±»å‹ï¼šæ— ç¬¦å·æ•°å’Œè¡¨ æ— ç¬¦å·æ•°å±äºåŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä»¥u1ã€ u2ã€ u4ã€ u8æ¥åˆ†åˆ«ä»£è¡¨1ä¸ªå­—èŠ‚ã€ 2ä¸ªå­—èŠ‚ã€ 4ä¸ªå­—èŠ‚å’Œ8ä¸ªå­—èŠ‚çš„æ— ç¬¦å·æ•°ï¼Œæ— ç¬¦å·æ•°å¯ä»¥ç”¨æ¥æè¿°æ•°å­—ã€ ç´¢å¼•å¼•ç”¨ã€ æ•°é‡å€¼æˆ–è€…æŒ‰ç…§UTF-8ç¼–ç æ„æˆå­—ç¬¦ä¸²å€¼ã€‚ è¡¨æ˜¯ç”±å¤šä¸ªæ— ç¬¦å·æ•°æˆ–è€…å…¶ä»–è¡¨ä½œä¸ºæ•°æ®é¡¹æ„æˆçš„å¤åˆæ•°æ®ç±»å‹ï¼Œæ‰€æœ‰è¡¨éƒ½ä¹ æƒ¯æ€§åœ°ä»¥â€œ_infoâ€ç»“å°¾ã€‚ è¡¨ç”¨äºæè¿°æœ‰å±‚æ¬¡å…³ç³»çš„å¤åˆç»“æ„çš„æ•°æ®ï¼Œæ•´ä¸ª Class æ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€å¼ è¡¨ï¼Œå®ƒç”±å¦‚ä¸‹è¡¨æ‰€ç¤ºçš„æ•°æ®é¡¹æ„æˆã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•´ä¸ª Class æ–‡ä»¶ æŒ‰å¦‚ä¸‹æ’åˆ—ï¼šé­”æ•°(4) â€“ æ¬¡ç‰ˆæœ¬å·(2) â€“ ä¸»ç‰ˆæœ¬å·(2) â€“ å¸¸é‡æ± å¸¸é‡æ•°(2) â€“ å¸¸é‡æ± è¡¨(ä¸ç¡®å®šé•¿åº¦) â€“ è®¿é—®æ ‡å¿—(2) â€“ ç±»ç´¢å¼•(2) â€“ çˆ¶ç±»ç´¢å¼•(2) â€“ å®ç°çš„æ¥å£æ•°(2) â€“ å®ç°çš„æ¥å£é›†åˆ(2) â€“ å®ç°çš„å­—æ®µæ•°(2) â€“ å­—æ®µé›†åˆè¡¨(ä¸ç¡®å®šé•¿åº¦) â€“ æ–¹æ³•æ•°(2) â€“ æ–¹æ³•é›†åˆè¡¨(ä¸ç¡®å®šé•¿åº¦) â€“ å±æ€§æ•°(2) â€“ å±æ€§é›†åˆè¡¨(ä¸ç¡®å®šé•¿åº¦)ã€‚ å…·ä½“ç»„æˆéƒ¨åˆ†1. é­”æ•°æ¯ä¸ªClassæ–‡ä»¶çš„å¤´4ä¸ªå­—èŠ‚ç§°ä¸ºé­”æ•°ï¼ˆMagic Numberï¼‰ï¼Œå®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥å—çš„Classæ–‡ä»¶ã€‚ 2. Classæ–‡ä»¶çš„ç‰ˆæœ¬ç´§æ¥ç€é­”æ•°çš„4ä¸ªå­—èŠ‚å­˜å‚¨çš„æ˜¯Classæ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼šç¬¬5å’Œç¬¬6ä¸ªå­—èŠ‚æ˜¯æ¬¡ç‰ˆæœ¬å·ï¼ˆMinorVersionï¼‰ï¼Œç¬¬7å’Œç¬¬8ä¸ªå­—èŠ‚æ˜¯ä¸»ç‰ˆæœ¬å·ï¼ˆMajor Versionï¼‰ã€‚ Javaçš„ç‰ˆæœ¬å·æ˜¯ä»45å¼€å§‹çš„ï¼ŒJDK 1.1ä¹‹åçš„æ¯ä¸ªJDKå¤§ç‰ˆæœ¬å‘å¸ƒä¸»ç‰ˆæœ¬å·å‘ä¸ŠåŠ 1ï¼ˆJDK 1.0ï½1.1ä½¿ç”¨äº†45.0ï½45.3çš„ç‰ˆæœ¬å·ï¼‰ï¼Œé«˜ç‰ˆæœ¬çš„JDKèƒ½å‘ä¸‹å…¼å®¹ä»¥å‰ç‰ˆæœ¬çš„Classæ–‡ä»¶ï¼Œä½†ä¸èƒ½è¿è¡Œä»¥åç‰ˆæœ¬çš„Classæ–‡ä»¶ï¼Œå³ä½¿æ–‡ä»¶æ ¼å¼å¹¶æœªå‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œè™šæ‹Ÿæœºä¹Ÿå¿…é¡»æ‹’ç»æ‰§è¡Œè¶…è¿‡å…¶ç‰ˆæœ¬å·çš„Classæ–‡ä»¶ã€‚ 3. å¸¸é‡æ± å¸¸é‡æ± å¯ä»¥ç†è§£ä¸ºClassæ–‡ä»¶ä¹‹ä¸­çš„èµ„æºä»“åº“ï¼Œå®ƒæ˜¯Classæ–‡ä»¶ç»“æ„ä¸­ä¸å…¶ä»–é¡¹ç›®å…³è”æœ€å¤šçš„æ•°æ®ç±»å‹ï¼Œä¹Ÿæ˜¯å ç”¨Classæ–‡ä»¶ç©ºé—´æœ€å¤§çš„æ•°æ®é¡¹ç›®ä¹‹ä¸€ï¼ŒåŒæ—¶å®ƒè¿˜æ˜¯åœ¨Classæ–‡ä»¶ä¸­ç¬¬ä¸€ä¸ªå‡ºç°çš„è¡¨ç±»å‹æ•°æ®é¡¹ç›®ã€‚ å¸¸é‡æ± ä¸­ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡ï¼ˆLiteralï¼‰å’Œç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰ã€‚å­—é¢é‡æ¯”è¾ƒæ¥è¿‘äºJavaè¯­è¨€å±‚é¢çš„å¸¸é‡æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€ å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰ã€‚ è€Œç¬¦å·å¼•ç”¨åˆ™å±äºç¼–è¯‘åŸç†æ–¹é¢çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬äº†ä¸‹é¢ä¸‰ç±»å¸¸é‡ï¼š ç±»å’Œæ¥å£çš„å…¨é™å®šåï¼ˆFully Qualified Nameï¼‰ å­—æ®µçš„åç§°å’Œæè¿°ç¬¦ï¼ˆDescriptorï¼‰ æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ å¸¸é‡æ± ä¸­çš„æ¯ä¸€é¡¹åˆå¯¹åº”ç€ä¸€ä¸ªè¡¨ï¼Œæ€»å…±11ç§æ•°æ®ç±»å‹çš„ç»“æ„ï¼Œæ³¨æ„ tag = 2 è¿™ä¸ªå€¼æ²¡æœ‰ï¼š 4. è®¿é—®æ ‡å¿—åœ¨å¸¸é‡æ± ç»“æŸä¹‹åï¼Œç´§æ¥ç€çš„ä¸¤ä¸ªå­—èŠ‚ä»£è¡¨è®¿é—®æ ‡å¿—(access_flags),è¿™ä¸ªæ ‡å¿—ç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šè¿™ä¸ªClassæ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼›æ˜¯å¦å®šä¹‰ä¸ºpublicç±»å‹ï¼›æ˜¯å¦å®šä¹‰ä¸ºabstractç±»å‹ï¼›å¦‚æœæ˜¯ç±»çš„è¯ï¼Œæ˜¯å¦è¢«å£°æ˜ä¸ºfinalç­‰ã€‚ 5. ç±»ç´¢å¼•ã€ çˆ¶ç±»ç´¢å¼•ä¸æ¥å£ç´¢å¼•é›†åˆç±»ç´¢å¼•ï¼ˆthis_classï¼‰å’Œçˆ¶ç±»ç´¢å¼•ï¼ˆsuper_classï¼‰éƒ½æ˜¯ä¸€ä¸ªu2ç±»å‹çš„æ•°æ®ï¼Œè€Œæ¥å£ç´¢å¼•é›†åˆï¼ˆinterfacesï¼‰æ˜¯ä¸€ç»„u2ç±»å‹çš„æ•°æ®çš„é›†åˆï¼ŒClassæ–‡ä»¶ä¸­ç”±è¿™ä¸‰é¡¹æ•°æ®æ¥ç¡®å®šè¿™ä¸ªç±»çš„ç»§æ‰¿å…³ç³»ã€‚ ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šåï¼Œçˆ¶ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåã€‚ ç”±äºJavaè¯­è¨€ä¸å…è®¸å¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥çˆ¶ç±»ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œé™¤äº†java.lang.Objectä¹‹å¤–ï¼Œæ‰€æœ‰çš„Javaç±»éƒ½æœ‰çˆ¶ç±»ï¼Œå› æ­¤é™¤äº†java.lang.Objectå¤–ï¼Œæ‰€æœ‰Javaç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸º0ã€‚ æ¥å£ç´¢å¼•é›†åˆå°±ç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†å“ªäº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰implementsè¯­å¥ï¼ˆå¦‚æœè¿™ä¸ªç±»æœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåˆ™åº”å½“æ˜¯extendsè¯­å¥ï¼‰åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚ ç±»ç´¢å¼•ã€ çˆ¶ç±»ç´¢å¼•å’Œæ¥å£ç´¢å¼•é›†åˆéƒ½æŒ‰é¡ºåºæ’åˆ—åœ¨è®¿é—®æ ‡å¿—ä¹‹åï¼Œç±»ç´¢å¼•å’Œçˆ¶ç±»ç´¢å¼•ç”¨ä¸¤ä¸ªu2ç±»å‹çš„ç´¢å¼•å€¼è¡¨ç¤ºï¼Œå®ƒä»¬å„è‡ªæŒ‡å‘ä¸€ä¸ªç±»å‹ä¸ºCONSTANT_Class_infoçš„ç±»æè¿°ç¬¦å¸¸é‡ï¼Œé€šè¿‡CONSTANT_Class_infoç±»å‹çš„å¸¸é‡ä¸­çš„ç´¢å¼•å€¼å¯ä»¥æ‰¾åˆ°å®šä¹‰åœ¨CONSTANT_Utf8_infoç±»å‹çš„å¸¸é‡ä¸­çš„å…¨é™å®šåå­—ç¬¦ä¸²ã€‚ å¯¹äºæ¥å£ç´¢å¼•é›†åˆï¼Œå…¥å£çš„ç¬¬ä¸€é¡¹â€”â€”u2ç±»å‹çš„æ•°æ®ä¸ºæ¥å£è®¡æ•°å™¨ï¼ˆinterfaces_countï¼‰ï¼Œè¡¨ç¤ºç´¢å¼•è¡¨çš„å®¹é‡ã€‚ å¦‚æœè¯¥ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œåˆ™è¯¥è®¡æ•°å™¨å€¼ä¸º0ï¼Œåé¢æ¥å£çš„ç´¢å¼•è¡¨ä¸å†å ç”¨ä»»ä½•å­—èŠ‚ã€‚ 6. å­—æ®µè¡¨é›†åˆå­—æ®µè¡¨ï¼ˆfield_infoï¼‰ç”¨äºæè¿°æ¥å£æˆ–è€…ç±»ä¸­å£°æ˜çš„å˜é‡ã€‚å…¶å®ä¹Ÿå°±æ˜¯ç±»çš„é™æ€å˜é‡æˆ–è€…æ˜¯å®ä¾‹æˆå‘˜å˜é‡ã€‚ å­—æ®µï¼ˆfieldï¼‰åŒ…æ‹¬ç±»çº§å˜é‡ä»¥åŠå®ä¾‹çº§å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬åœ¨æ–¹æ³•å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡ã€‚ æˆ‘ä»¬å¯ä»¥æƒ³ä¸€æƒ³åœ¨Javaä¸­æè¿°ä¸€ä¸ªå­—æ®µå¯ä»¥åŒ…å«ä»€ä¹ˆä¿¡æ¯ï¼Ÿå¯ä»¥åŒ…æ‹¬çš„ä¿¡æ¯æœ‰ï¼šå­—æ®µçš„ä½œç”¨åŸŸï¼ˆpublicã€ privateã€ protectedä¿®é¥°ç¬¦ï¼‰ã€ æ˜¯å®ä¾‹å˜é‡è¿˜æ˜¯ç±»å˜é‡ï¼ˆstaticä¿®é¥°ç¬¦ï¼‰ã€ å¯å˜æ€§ï¼ˆfinalï¼‰ã€ å¹¶å‘å¯è§æ€§ï¼ˆvolatileä¿®é¥°ç¬¦ï¼Œæ˜¯å¦å¼ºåˆ¶ä»ä¸»å†…å­˜è¯»å†™ï¼‰ã€ å¯å¦è¢«åºåˆ—åŒ–ï¼ˆtransientä¿®é¥°ç¬¦ï¼‰ã€ å­—æ®µæ•°æ®ç±»å‹ï¼ˆåŸºæœ¬ç±»å‹ã€ å¯¹è±¡ã€ æ•°ç»„ï¼‰ã€ å­—æ®µåç§°ã€‚ ä¸Šè¿°è¿™äº›ä¿¡æ¯ä¸­ï¼Œå„ä¸ªä¿®é¥°ç¬¦éƒ½æ˜¯å¸ƒå°”å€¼ï¼Œè¦ä¹ˆæœ‰æŸä¸ªä¿®é¥°ç¬¦ï¼Œè¦ä¹ˆæ²¡æœ‰ï¼Œå¾ˆé€‚åˆä½¿ç”¨æ ‡å¿—ä½æ¥è¡¨ç¤ºã€‚ è€Œå­—æ®µå«ä»€ä¹ˆåå­—ã€ å­—æ®µè¢«å®šä¹‰ä¸ºä»€ä¹ˆæ•°æ®ç±»å‹ï¼Œè¿™äº›éƒ½æ˜¯æ— æ³•å›ºå®šçš„ï¼Œåªèƒ½å¼•ç”¨å¸¸é‡æ± ä¸­çš„å¸¸é‡æ¥æè¿°ã€‚ 7. æ–¹æ³•è¡¨é›†åˆå’Œå­—æ®µè¡¨åŸºæœ¬ä¸€æ ·ï¼Œä»…åœ¨è®¿é—®æ ‡å¿—å’Œå±æ€§è¡¨é›†åˆçš„å¯é€‰é¡¹æœ‰äº›åŒºåˆ«ã€‚å°±æ˜¯çœ‹æ–¹æ³•æœ‰æ²¡æœ‰è¢« synchronizedã€abstractã€finalç­‰ä¿®é¥°ã€‚ 8. å±æ€§è¡¨é›†åˆå±æ€§è¡¨é›†åˆä¸­åŒ…å«äº†å¤§é‡çš„æ•°æ®ä¿¡æ¯ï¼Œä¸Šé¢çš„æ‰€æœ‰ç±»å‹éƒ½æœ‰ååˆ†ä¸¥æ ¼é¡ºåºï¼Œé•¿åº¦ï¼Œå¤§å°ã€‚è€Œå±æ€§è¡¨ä¸­å°±æ²¡æœ‰é‚£ä¹ˆä¸¥æ ¼äº†ï¼Œæˆ‘ä»¬ç¼–å†™çš„æœ€å¤šçš„Codeå°±å­˜æ”¾åœ¨å±æ€§è¡¨é›†åˆä¸­çš„CODEè¡¨ä¸­ï¼Œä¸€å…±æœ‰21é¡¹æ¯”å¦‚è¿˜åŒ…å«ï¼šExceptionè¡¨ç­‰ç­‰ã€‚å…·ä½“çš„æ¯ä¸€ä¸ªé¡¹éƒ½æ˜¯æœ‰æ„ä¹‰çš„ï¼Œæœ‰ç‚¹å¤šç®€å•çš„ä»‹ç»ä¸€ä¸‹ä¸»è¦çš„ï¼š 1ã€Code å±æ€§ Javaæ–¹æ³•ä½“é‡Œé¢çš„ä»£ç ç»è¿‡Javacç¼–è¯‘ä¹‹åï¼Œæœ€ç»ˆå˜ä¸ºå­—èŠ‚ç æŒ‡ä»¤å­˜å‚¨åœ¨Codeå±æ€§å†…ï¼ŒCodeå±æ€§å‡ºç°åœ¨æ–¹æ³•è¡¨çš„å±æ€§é›†åˆä¸­ï¼Œä½†åœ¨æ¥å£æˆ–æŠ½è±¡ç±»ä¸­å°±ä¸å­˜åœ¨Codeå±æ€§ã€‚ 2ã€Exceptionå±æ€§ åˆ—ä¸¾å‡ºæ–¹æ³•ä¸­å¯èƒ½æŠ›å‡ºçš„å—æŸ¥å¼‚å¸¸ã€‚ 3ã€LineNumberTableå±æ€§ æè¿°Javaæºç è¡Œå·ä¸å­—èŠ‚ç è¡Œå·ï¼ˆå­—èŠ‚ç çš„åç§»é‡ï¼‰ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚ä¸»è¦æ˜¯å¦‚æœæŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ˜¾ç¤ºè¡Œå·ï¼Œå°±æ˜¯è¿™ä¸ªå±æ€§çš„ä½œç”¨ã€‚ 4ã€LocalVariableTableå±æ€§ æè¿°æ ˆå¸§ä¸­å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡ä¸Javaæºç ä¸­å®šä¹‰çš„å˜é‡ä¹‹é—´çš„å…³ç³»ã€‚ç”¨å¤„åœ¨äºå½“åˆ«äººä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ˜¯èƒ½å¤Ÿæ˜¾ç¤ºå‡ºæ–¹æ³•å®šä¹‰çš„å‚æ•°åã€‚ 5ã€SourseFileå±æ€§ è®°å½•ç”Ÿæˆè¿™ä¸ªClassæ–‡ä»¶çš„æºç æ–‡ä»¶åç§°ï¼ŒæŠ›å‡ºå¼‚å¸¸æ—¶èƒ½å¤Ÿæ˜¾ç¤ºé”™è¯¯ä»£ç æ‰€å±çš„æ–‡ä»¶åã€‚ 6ã€ConstantValueå±æ€§ é€šçŸ¥è™šæ‹Ÿæœºè‡ªåŠ¨ä¸ºé™æ€å˜é‡èµ‹å€¼ï¼Œåªæœ‰è¢«staticå­—ç¬¦ä¿®é¥°çš„å˜é‡ï¼ˆç±»å˜é‡ï¼‰æ‰å¯ä»¥æœ‰è¿™é¡¹å±æ€§ã€‚ 7ã€InnerClasså±æ€§ ç”¨äºè®°å½•å†…éƒ¨ç±»ä¸å®¿ä¸»ç±»ä¹‹é—´çš„å…³è”ã€‚ 8ã€Deprecatedå’ŒSyntheticå±æ€§ è¿™ä¸¤ä¸ªéƒ½æ˜¯æ ‡å¿—ç±»å‹çš„å¸ƒå°”å±æ€§ï¼ŒDeprecatedè¡¨ç¤ºä¸å†æ¨èä½¿ç”¨ï¼Œæ³¨è§£@deprecatedSyntheticè¡¨ç¤ºæ­¤å­—æ®µæˆ–æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªè¡Œæ·»åŠ çš„ã€‚ Demoä¸ºäº†æ›´å¥½çš„ç†è§£ Class çš„ç»„æˆéƒ¨åˆ†ï¼Œæˆ‘å†³å®šå†™ä¸€ä¸ª demoï¼Œè®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥åˆ†æä¸€ä¸‹ã€‚ æºä»£ç 12345678910111213141516package JVM;public class SubClass extends SuperClass &#123; @Override public void A()&#123; super.A(); System.out.println(2222); &#125; public static void main(String[] args) &#123; test_heap_outOfMemory t = new test_heap_outOfMemory(); t.C(); SubClass subClass = new SubClass(); subClass.A(); &#125;&#125; Byte Code viewer123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869// class version 52.0 (52)// access flags 0x21public class JVM/SubClass extends JVM/SuperClass &#123; // compiled from: SubClass.java // access flags 0x1 public &lt;init&gt;()V L0 LINENUMBER 3 L0 ALOAD 0 INVOKESPECIAL JVM/SuperClass.&lt;init&gt; ()V RETURN L1 LOCALVARIABLE this LJVM/SubClass; L0 L1 0 MAXSTACK = 1 MAXLOCALS = 1 // access flags 0x1 public A()V L0 LINENUMBER 6 L0 ALOAD 0 INVOKESPECIAL JVM/SuperClass.A ()V L1 LINENUMBER 7 L1 GETSTATIC java/lang/System.out : Ljava/io/PrintStream; SIPUSH 2222 INVOKEVIRTUAL java/io/PrintStream.println (I)V L2 LINENUMBER 8 L2 RETURN L3 LOCALVARIABLE this LJVM/SubClass; L0 L3 0 MAXSTACK = 2 MAXLOCALS = 1 // access flags 0x9 public static main([Ljava/lang/String;)V L0 LINENUMBER 11 L0 NEW JVM/test_heap_outOfMemory DUP INVOKESPECIAL JVM/test_heap_outOfMemory.&lt;init&gt; ()V ASTORE 1 L1 LINENUMBER 12 L1 ALOAD 1 INVOKEVIRTUAL JVM/test_heap_outOfMemory.C ()V L2 LINENUMBER 13 L2 NEW JVM/SubClass DUP INVOKESPECIAL JVM/SubClass.&lt;init&gt; ()V ASTORE 2 L3 LINENUMBER 14 L3 ALOAD 2 INVOKEVIRTUAL JVM/SubClass.A ()V L4 LINENUMBER 17 L4 RETURN L5 LOCALVARIABLE args [Ljava/lang/String; L0 L5 0 LOCALVARIABLE t LJVM/test_heap_outOfMemory; L1 L5 1 LOCALVARIABLE subClass LJVM/SubClass; L3 L5 2 MAXSTACK = 2 MAXLOCALS = 3&#125; jsclasslibæˆ‘ä»¬ä½¿ç”¨ jsclasslib è¿™ä¸ªå¯è§†åŒ–ç•Œé¢æ¥çœ‹ä¸€ä¸‹å…·ä½“çš„ class ä¿¡æ¯ã€‚ é¦–å…ˆå¯ä»¥çœ‹åˆ°ï¼Œ jdkçš„ç‰ˆæœ¬çš„ä¸»ç‰ˆæœ¬å·æ˜¯ 1.8ï¼Œæ¬¡ç‰ˆæœ¬å·æ˜¯ 0ï¼Œå¸¸é‡æ± çš„æ€»æ•°æ˜¯34ï¼Œè®¿é—®æ ‡å¿—ï¼Œå³è¯¥ç±»æ˜¯ public or defaultï¼Œç„¶åå·¦è¾¹å¯¹åº”çš„æœ‰å¸¸é‡æ± ã€æ¥å£è¡¨ã€å­—æ®µè¡¨ã€å±æ€§è¡¨ã€æ–¹æ³•è¡¨ã€‚ è¯¦ç»†åˆ†æå¯ä»¥çœ‹è¿™ä¸ªï¼šhttps://juejin.im/post/5b5ac6d76fb9a04f8d6bc7d6#heading-29 ç¬¬ä¸ƒç«  è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶ å‚è€ƒï¼šhttps://juejin.im/post/5ae2d580f265da0b851c95ea#heading-17 1. æ¦‚è¿°åœ¨ç¬¬å…­ç« ï¼Œè®²åˆ°äº† Class æ–‡ä»¶ï¼Œé‚£æˆ‘ä»¬æ˜¯å¦‚ä½•å°† Class æ–‡ä»¶åŠ è½½åˆ°è™šæ‹Ÿæœºï¼Œç„¶åè¿è¡Œå’Œä½¿ç”¨å‘¢ï¼Ÿ 1.1 è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶çš„æ¦‚å¿µè™šæ‹ŸæœºæŠŠæè¿°ç±»çš„æ•°æ®ä»classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è½¬æ¢è§£æå’Œåˆå§‹åŒ–ã€‚æœ€ç»ˆå½¢æˆå¯ä»¥è¢«è™šæ‹Ÿæœºæœ€ç›´æ¥ä½¿ç”¨çš„javaç±»å‹çš„è¿‡ç¨‹å°±æ˜¯è™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶ã€‚ 1.2 Javaè¯­è¨€çš„åŠ¨æ€åŠ è½½å’ŒåŠ¨æ€è¿æ¥å¦å¤–éœ€è¦æ³¨æ„çš„å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼šjavaè¯­è¨€ä¸­ç±»å‹çš„åŠ è½½è¿æ¥ä»¥åŠåˆå§‹åŒ–è¿‡ç¨‹éƒ½æ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´å®Œæˆçš„ï¼Œè¿™ç§ç­–ç•¥è™½ç„¶ä¼šä½¿ç±»åŠ è½½æ—¶ç¨å¾®å¢åŠ ä¸€äº›æ€§èƒ½å¼€é”€ï¼Œä½†æ˜¯ä¼šä¸ºjavaåº”ç”¨ç¨‹åºæä¾›é«˜åº¦çš„çµæ´»æ€§ã€‚javaé‡Œå¤©ç”Ÿå°±å¯ä»¥åŠ¨æ€æ‰©å±•è¯­è¨€ç‰¹æ€§å°±æ˜¯ä¾èµ–è¿è¡ŒæœŸé—´åŠ¨æ€åŠ è½½å’ŒåŠ¨æ€è¿æ¥è¿™ä¸ªç‰¹ç‚¹å®ç°çš„ã€‚æ¯”å¦‚ï¼Œå¦‚æœç¼–å†™ä¸€ä¸ªé¢å‘æ¥å£çš„ç¨‹åºï¼Œå¯ä»¥ç­‰åˆ°è¿è¡Œæ—¶å†æŒ‡å®šå…¶å…·ä½“å®ç°ç±»ã€‚ æ³¨æ„ï¼Œä¸‹æ–‡çš„ Class æ–‡ä»¶å…¶å®æ˜¯æŒ‡ä¸€ä¸²äºŒè¿›åˆ¶çš„å­—èŠ‚æµï¼Œå¯ä»¥æ²¡æœ‰å¿…è¦æ˜¯æ–‡ä»¶å½¢å¼ï¼ŒåŒæ—¶ï¼Œæ¯ä¸ª Class æ–‡ä»¶éƒ½å¯èƒ½ä»£è¡¨ä¸€ä¸ªç±»æˆ–æ¥å£ã€‚ 2. ç±»åŠ è½½æ—¶æœºç±»çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼š åŠ è½½(Loading) â€”â€” éªŒè¯(Verification) â€”â€” å‡†å¤‡(Preparation) â€”â€” åˆå§‹åŒ–(Initialization) â€”â€”- ä½¿ç”¨(Using) â€”â€” å¸è½½(Unloading) ï¼Œå…¶ä¸­ éªŒè¯ã€å‡†å¤‡ã€è§£æ ç»Ÿç§°ä¸ºè¿æ¥(Linking) éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–ã€å¸è½½è¿™ 5 ä¸ªé˜¶æ®µçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œå½“ç„¶ç¡®å®šçš„ä¹Ÿåªæ˜¯å¼€å§‹çš„æ—¶é—´ï¼Œå› ä¸ºè¿™äº›é˜¶æ®µéƒ½æ˜¯äº’ç›¸äº¤å‰åœ°æ··åˆè¿›è¡Œï¼Œé€šå¸¸ä¼šåœ¨ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œçš„è¿‡ç¨‹ä¸­å»å¯¹è°ƒç”¨å’Œæ¿€æ´»å¦å¤–ä¸€ä¸ªé˜¶æ®µã€‚è€Œè§£æé˜¶æ®µï¼Œå¯ä»¥åœ¨åˆå§‹åŒ–åå†å¼€å§‹ï¼Œè¿™å°±æ˜¯ä¸ºäº†æ”¯æŒ Java çš„è¿è¡Œæ—¶ç»‘å®šã€‚ è™šæ‹Ÿæœº jvm å¹¶æ²¡æœ‰è§„èŒƒä»€ä¹ˆæ—¶å€™å¼€å§‹åŠ è½½ï¼Œä½†æ˜¯è§„å®šäº†åˆå§‹åŒ–çš„æ—¶é—´ï¼Œæœ‰ä¸”åªæœ‰4ç§æƒ…å†µæ‰ä¼šç«‹å³å¯¹ç±»è¿›è¡Œâ€œåˆå§‹åŒ–â€(è‡ªç„¶åŠ è½½ã€éªŒè¯ã€å‡†å¤‡éƒ½è¦åœ¨ä¹‹å‰å¼€å§‹)ï¼š ä½¿ç”¨ new å…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ã€è¯»å–æˆ–è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µçš„æ—¶å€™ï¼ˆæ³¨æ„ï¼šfinalä¿®é¥°å¹¶ä¸”åœ¨ç¼–è¯‘å‰é—´å°±å·²ç»å°†ç»“æœæ”¾ç½®åœ¨äº†å¸¸é‡æ± ä¸­çš„é™æ€å­—æ®µé™¤å¤–ï¼‰ï¼Œä»¥åŠè°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•çš„æ—¶å€™ï¼› ä½¿ç”¨java.lang.reflectåŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»æ²¡æœ‰åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ã€Œåå°„çš„è¿‡ç¨‹æˆ‘åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« å·²ç»è®²è¿‡äº†ã€‚ã€ å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»æ²¡æœ‰è¢«åˆå§‹åŒ–å°±ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶ç±»ã€‚ å½“è™šæ‹Ÿæœºå¯åŠ¨çš„æ—¶å€™ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆå°±æ˜¯åŒ…å«main()æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªç±»ï¼› ä»¥ä¸Š 4 ç§ç§°ä¹‹ä¸ºå¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¼šè§¦å‘ç›¸åº”çš„åˆå§‹åŒ–ï¼Œè€Œæ¯”è¾ƒå…¸å‹å‡ ç§è¢«åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šè§¦å‘åˆå§‹åŒ–çš„æƒ…å†µæœ‰ï¼š é€šè¿‡å­ç±»è®¿é—®çˆ¶ç±»çš„ static å˜é‡ï¼Œä¸ä¼šå¼•èµ·å­ç±»çš„åˆå§‹åŒ–ï¼› å®šä¹‰å¼•ç”¨æ•°ç»„ï¼Œä¸ä¼šåˆå§‹åŒ–ç±»ï¼› 12Obj[] arrays = new Obj[10]; ä¸Šé¢è¯´çš„ï¼Œç”¨ final ä¿®é¥°å¹¶ä¸”åœ¨ç¼–è¯‘æœŸé—´(ç”Ÿæˆ.classæ–‡ä»¶æœŸé—´)å°±å·²ç»å°†ç»“æœå†™å…¥äº†å¸¸é‡æ± ä¸­ã€‚ å½“ç„¶ï¼Œå¯¹äºæ¥å£æ¥è¯´ï¼Œä¸ç±»ç›¸æ¯”åœ¨åˆå§‹åŒ–é˜¶æ®µä¹Ÿç•¥æœ‰ä¸åŒï¼ˆä¸»åŠ¨ä½¿ç”¨åªæœ‰3ç§æƒ…å†µï¼‰ï¼Œå°±æ˜¯åœ¨åˆå§‹åŒ–ä¸€ä¸ªæ¥å£æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶äº²æ¥å£æ²¡æœ‰åˆå§‹åŒ–ï¼Œå¹¶ä¸ä¼šå»åˆå§‹åŒ–çˆ¶äº²æ¥å£ï¼Œè€Œæ˜¯ç­‰ç”¨åˆ°äº†æ‰ä¼šå»åˆå§‹åŒ–ã€‚ 3. ç±»åŠ è½½è¿‡ç¨‹æ¥ä¸‹æ¥è¯¦ç»†è®²ä¸€ä¸‹ç±»åŠ è½½çš„å…¨è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–è¿™ 5 ä¸ªé˜¶æ®µçš„è¿‡ç¨‹ã€‚ 3.1 åŠ è½½â€œåŠ è½½â€ æ˜¯ â€œç±»åŠ è½½â€ è¿‡ç¨‹çš„ä¸€ä¸ªé˜¶æ®µï¼Œåˆ‡ä¸å¯å°†äºŒè€…æ··æ·†ã€‚ åŠ è½½é˜¶æ®µç”±ä¸‰ä¸ªåŸºæœ¬åŠ¨ä½œç»„æˆï¼š é€šè¿‡ç±»å‹çš„å®Œå…¨é™å®šåï¼Œäº§ç”Ÿä¸€ä¸ªä»£è¡¨è¯¥ç±»å‹çš„äºŒè¿›åˆ¶æ•°æ®æµï¼ˆæ ¹æœ¬æ²¡æœ‰æŒ‡æ˜ä»å“ªé‡Œè·å–ã€æ€æ ·è·å–ï¼Œå¯ä»¥è¯´ä¸€ä¸ªéå¸¸å¼€æ”¾çš„å¹³å°äº†ï¼‰ï¼› è§£æè¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®æµä¸ºæ–¹æ³•åŒºå†…çš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼› åœ¨ Java å †ä¸­åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºè¯¥ç±»å‹çš„java.lang.Classç±»çš„å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚ é€šè¿‡ç±»å‹çš„å®Œå…¨é™å®šåï¼Œäº§ç”Ÿä¸€ä¸ªä»£è¡¨è¯¥ç±»å‹çš„äºŒè¿›åˆ¶æ•°æ®æµçš„å‡ ç§å¸¸è§å½¢å¼ï¼š ä»zipåŒ…ä¸­è¯»å–ï¼Œæˆä¸ºæ—¥åJARã€EARã€WARæ ¼å¼çš„åŸºç¡€ï¼› ä»ç½‘ç»œä¸­è·å–ï¼Œè¿™ç§åœºæ™¯æœ€å…¸å‹çš„åº”ç”¨å°±æ˜¯Appletï¼› è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆï¼Œè¿™ç§åœºæ™¯æœ€å¸¸ç”¨çš„å°±æ˜¯åŠ¨æ€ä»£ç†æŠ€æœ¯äº†ï¼› ç”±å…¶ä»–æ–‡ä»¶ç”Ÿæˆï¼Œæ¯”å¦‚æˆ‘ä»¬çš„JSPã€‚ 3.2 éªŒè¯éªŒè¯æ˜¯è¿æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚ è™šæ‹Ÿæœºå¦‚æœä¸æ£€æŸ¥è¾“å…¥çš„å­—èŠ‚æµï¼Œå¹¶å¯¹å…¶å®Œå…¨ä¿¡ä»»çš„è¯ï¼Œå¾ˆå¯èƒ½ä¼šå› ä¸ºè½½å…¥äº†æœ‰å®³çš„å­—èŠ‚æµè€Œå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œæ‰€ä»¥éªŒè¯æ˜¯è™šæ‹Ÿæœºå¯¹è‡ªèº«ä¿æŠ¤çš„ä¸€é¡¹é‡è¦å·¥ä½œã€‚è¿™ä¸ªé˜¶æ®µæ˜¯å¦ä¸¥è°¨ï¼Œç›´æ¥å†³å®šäº†javaè™šæ‹Ÿæœºæ˜¯å¦èƒ½æ‰¿å—æ¶æ„ä»£ç çš„æ”»å‡»ã€‚ ä»æ•´ä½“ä¸Šçœ‹ï¼ŒéªŒè¯é˜¶æ®µå¤§è‡´ä¸Šä¼šå®Œæˆ4ä¸ªé˜¶æ®µçš„æ ¡éªŒå·¥ä½œï¼šæ–‡ä»¶æ ¼å¼éªŒè¯ã€å…ƒæ•°æ®éªŒè¯ã€å­—èŠ‚ç éªŒè¯ã€ç¬¦å·å¼•ç”¨éªŒè¯ã€‚ æ–‡ä»¶æ ¼å¼éªŒè¯ã€‚ä¸»è¦æ˜¯ç¡®ä¿è¾“å…¥çš„å­—èŠ‚æµèƒ½å¤Ÿæ­£ç¡®çš„è§£æå¹¶å­˜å‚¨äºæ–¹æ³•åŒºä¹‹ä¸­ï¼Œè¿™é˜¶æ®µçš„éªŒè¯åŸºäºå­—èŠ‚æµè¿›è¡Œï¼Œè¯¥éªŒè¯ç»“æŸåï¼Œå­—èŠ‚æµå°±è¿›å…¥åˆ°äº†å†…å­˜ä¸­çš„æ–¹æ³•åŒºï¼Œè¿›è¡Œå­˜å‚¨ï¼Œæ‰€ä»¥åç»­ä¸‰ä¸ªéªŒè¯é˜¶æ®µå…¨æ˜¯åŸºäºæ–¹æ³•åŒºçš„å­˜å‚¨ç»“æ„ï¼› å…ƒæ•°æ®éªŒè¯ã€‚ç°åœ¨å…¶å® jdk1.8 ä¹‹åæ²¡æœ‰æ–¹æ³•åŒºäº†ï¼Œæ”¹åå«åšå…ƒæ•°æ®åŒºã€‚è¿™ä¸ªé˜¶æ®µæ˜¯å¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œä¿è¯æ˜¯ javaè§„èŒƒçš„ä¿¡æ¯ï¼› å­—èŠ‚ç éªŒè¯ã€‚éªŒè¯ä¸­æœ€å¤æ‚çš„ï¼Œä¸»è¦å·¥ä½œæ˜¯è¿›è¡Œæ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œä¿è¯ç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºå®‰å…¨çš„è¡Œä¸ºï¼› ç¬¦å·å¼•ç”¨éªŒè¯ã€‚è¿™ä¸ªéªŒè¯ä¼šå‘ç”Ÿåœ¨è™šæ‹Ÿæœºå°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯åœ¨è§£æè¿‡ç¨‹ä¸­çš„å‘ç”Ÿï¼Œå¯ä»¥çœ‹ä½œæ˜¯å¯¹ç±»è‡ªèº«ä»¥å¤–çš„ä¿¡æ¯è¿›è¡ŒåŒ¹é…æ€§çš„æ ¡éªŒï¼Œç¡®ä¿è§£æåŠ¨ä½œèƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œã€‚ éªŒè¯çš„å†…å®¹ä¸»è¦æœ‰ï¼š ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦ä¸²æè¿°çš„å…¨é™å®šåæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ç±»ï¼› åœ¨æŒ‡å®šç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦å·æ–¹æ³•çš„å­—æ®µæè¿°åŠç®€å•åç§°æ‰€æè¿°çš„æ–¹æ³•å’Œå­—æ®µï¼› ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ã€å­—æ®µå’Œæ–¹æ³•çš„è®¿é—®æ€§ï¼ˆprivateã€protectedã€publicã€defaultï¼‰æ˜¯å¦å¯è¢«å½“å‰ç±»è®¿é—®ã€‚ 3.3 å‡†å¤‡ è¿™ä¸€å—æˆ‘æœ‰ä¸€äº›ä¸å¤ªç†è§£ï¼Œä¸ºä»€ä¹ˆåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œå­—èŠ‚ç å°±è¢«ç¼–è¯‘æˆæŒ‡ä»¤å­˜æ”¾åœ¨æ„é€ å™¨\() æ–¹æ³•ä¸­äº†ï¼Ÿï¼Ÿï¼Ÿï¼Ÿå•¥æ—¶å€™ç¼–è¯‘æˆæŒ‡ä»¤çš„å•Šï¼Œè¿™ä¸ªæ„é€ æ–¹æ³•åˆæ˜¯ä»€ä¹ˆæ—¶å€™äº§ç”Ÿçš„ã€‚ã€‚ã€‚ã€‚ã€‚ å›ç­”ï¼šç¼–è¯‘æˆæŒ‡ä»¤ï¼Œæ˜¯åœ¨æºä»£ç é€šè¿‡ javac ç¼–è¯‘æˆ class æ–‡ä»¶æ—¶ç”Ÿæˆçš„ï¼Œåœ¨ç¬¬å…­ç« æœ‰è®²ï¼Œåœ¨æ–¹æ³•è¡¨ä¸­ï¼Œæœ‰å­˜æ”¾å±æ€§è¡¨ï¼Œè€Œå±æ€§è¡¨é‡Œæœ‰ä¸€ä¸ª Code å±æ€§ï¼Œé‡Œé¢å°±æ˜¯å­˜å‚¨çš„ Java ä»£ç ç¼–è¯‘åçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚ å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µï¼Œè¿™äº›å˜é‡æ‰€ä½¿ç”¨çš„å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…ã€‚ï¼ˆå¤‡æ³¨ï¼šè¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆè¢«staticä¿®é¥°çš„å˜é‡ï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡å°†ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åœ¨Javaå †ä¸­ï¼‰ã€‚ åˆå§‹å€¼é€šå¸¸æ˜¯æ•°æ®ç±»å‹çš„é›¶å€¼ï¼š å¯¹äºï¼š 1public static int value = 123; é‚£ä¹ˆå˜é‡valueåœ¨å‡†å¤‡é˜¶æ®µè¿‡åçš„åˆå§‹å€¼ä¸º0è€Œä¸æ˜¯123ï¼Œè¿™æ—¶å€™å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½•javaæ–¹æ³•ï¼ŒæŠŠvalueèµ‹å€¼ä¸º123çš„åŠ¨ä½œå°†åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šè¢«æ‰§è¡Œã€‚ ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼š å¯¹äºï¼š 1public static final int value = 123; ç¼–è¯‘æ—¶ Javac å°†ä¼šä¸º value ç”Ÿæˆ ConstantValueå±æ€§ï¼Œåœ¨å‡†å¤‡é˜¶æ®µ è™šæ‹Ÿæœº å°±ä¼šæ ¹æ® ConstantValue çš„è®¾ç½®å°† value èµ‹å€¼ä¸º123ã€‚ åŸºæœ¬æ•°æ®ç±»å‹çš„é›¶å€¼ï¼š 3.4 è§£æè§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ é‚£ä¹ˆç¬¦å·å¼•ç”¨ä¸ç›´æ¥å¼•ç”¨æœ‰ä»€ä¹ˆå…³è”å‘¢ï¼Ÿ 3.4.1 çœ‹ä¸¤è€…çš„æ¦‚å¿µç¬¦å·å¼•ç”¨(Symbolic References)ï¼š ç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ç¬¦åˆçº¦å®šçš„ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œç¬¦å·å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡å¹¶ä¸ä¸€å®šå·²ç»åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ ç›´æ¥å¼•ç”¨ï¼ˆDirect Referencesï¼‰: ç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚ç›´æ¥å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€ç›¸å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»åœ¨å†…å­˜ä¸­å­˜åœ¨ã€‚ è™šæ‹Ÿæœºè§„èŒƒæ²¡æœ‰è§„å®šè§£æé˜¶æ®µå‘ç”Ÿçš„å…·ä½“æ—¶é—´ï¼Œè™šæ‹Ÿæœºå®ç°å¯ä»¥æ ¹æ®éœ€è¦æ¥åˆ¤æ–­åˆ°åº•æ˜¯åœ¨ç±»è¢«åŠ è½½æ—¶è§£æã€Œä¸€èˆ¬æ˜¯é™æ€æ–¹æ³•å’Œç§æœ‰æ–¹æ³•ä¸¤å¤§ç±»ï¼Œç¬¦åˆâ€œç¼–è¯‘æœŸå¯çŸ¥ï¼Œè¿è¡ŒæœŸä¸å¯å˜â€ï¼Œå› ä¸ºè¿™ä¸¤ç±»æ–¹æ³•ä¸å¯èƒ½é€šè¿‡ç»§æ‰¿æˆ–è€…å…¶ä»–æ–¹å¼è¿›è¡Œé‡å†™ã€‚ç¬¬å…«ç« æœ‰è¯¦ç»†è®²ã€‚ã€è¿˜æ˜¯ç­‰åˆ°ä¸€ä¸ªç¬¦å·å¼•ç”¨å°†è¦è¢«ä½¿ç”¨å‰æ‰å»è§£æã€‚ 3.4.2 å¯¹è§£æç»“æœè¿›è¡Œç¼“å­˜åŒä¸€ç¬¦å·å¼•ç”¨è¿›è¡Œå¤šæ¬¡è§£æè¯·æ±‚æ˜¯å¾ˆå¸¸è§çš„ï¼Œé™¤ invokedynamic æŒ‡ä»¤ä»¥å¤–ï¼Œè™šæ‹Ÿæœºå®ç°å¯ä»¥å¯¹ç¬¬ä¸€æ¬¡è§£æç»“æœè¿›è¡Œç¼“å­˜ï¼Œæ¥é¿å…è§£æåŠ¨ä½œé‡å¤è¿›è¡Œã€‚æ— è®ºæ˜¯å¦çœŸæ­£æ‰§è¡Œäº†å¤šæ¬¡è§£æåŠ¨ä½œï¼Œè™šæ‹Ÿæœºéœ€è¦ä¿è¯çš„æ˜¯åœ¨åŒä¸€ä¸ªå®ä½“ä¸­ï¼Œå¦‚æœä¸€ä¸ªå¼•ç”¨ç¬¦å·ä¹‹å‰å·²ç»è¢«æˆåŠŸè§£æè¿‡ï¼Œé‚£ä¹ˆåç»­çš„å¼•ç”¨è§£æè¯·æ±‚å°±åº”å½“ä¸€ç›´æˆåŠŸï¼›åŒæ ·çš„ï¼Œå¦‚æœ ç¬¬ä¸€æ¬¡è§£æå¤±è´¥ï¼Œé‚£ä¹ˆå…¶ä»–æŒ‡ä»¤å¯¹è¿™ä¸ªç¬¦å·çš„è§£æè¯·æ±‚ä¹Ÿåº”è¯¥æ”¶åˆ°ç›¸åŒçš„å¼‚å¸¸ã€‚ 3.4.3 è§£æåŠ¨ä½œçš„ç›®æ ‡è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦7ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚å‰é¢å››ç§å¼•ç”¨çš„è§£æè¿‡ç¨‹ï¼Œå¯¹äºåé¢ä¸‰ç§ï¼Œä¸JDK1.7æ–°å¢çš„åŠ¨æ€è¯­è¨€æ”¯æŒæ¯æ¯ç›¸å…³ï¼Œç”±äºjavaè¯­è¨€æ˜¯ä¸€é—¨é™æ€ç±»å‹è¯­è¨€ï¼Œå› æ­¤æ²¡æœ‰ä»‹ç» invokedynamic æŒ‡ä»¤çš„è¯­ä¹‰ä¹‹å‰ï¼Œæ²¡æœ‰åŠæ³•å°†ä»–ä»¬å’Œç°åœ¨çš„javaè¯­è¨€å¯¹åº”ä¸Šã€‚ 3.5 åˆå§‹åŒ–ç±»åˆå§‹åŒ–é˜¶æ®µæ˜¯ç±»åŠ è½½çš„æœ€åä¸€æ­¥ï¼Œå‰é¢çš„ç±»åŠ è½½è¿‡ç¨‹ä¸­ï¼Œé™¤äº†åœ¨åŠ è½½é˜¶æ®µç”¨æˆ·åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨å‚ä¸ä¹‹å¤–ï¼Œå…¶ä½™åŠ¨ä½œå®Œå…¨ç”±è™šæ‹Ÿæœºä¸»å¯¼å’Œæ§åˆ¶ã€‚åˆ°äº†åˆå§‹åŒ–é˜¶æ®µï¼Œæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„javaç¨‹åºä»£ç ï¼ˆæˆ–è€…è¯´æ˜¯å­—èŠ‚ç ï¼‰ã€‚ åˆå§‹åŒ–é˜¶æ®µï¼Œä¸»è¦è¿˜æ˜¯å»æ‰§è¡Œç±»æ„é€ å™¨ \() æ–¹æ³•çš„è¿‡ç¨‹ã€‚ã€Œå•¥æ—¶å€™æœ‰è¿™ä¸ªæ„é€ æ–¹æ³•çš„ä¹¦ä¸­è¯´åé¢ä¼šè¯´ã€‚ã€‚ã€‚ã€‚å¥½çš„å§ã€‚ã€‚ã€‚ã€‚ç»§ç»­å¾€ä¸‹çœ‹ã€ä¹Ÿå°±æ˜¯è¿›è¡Œç¬¬äºŒæ¬¡çš„èµ‹å€¼ï¼Œå…¶ä¸­ \() ï¼š \() æ˜¯ç”±ç¼–è¯‘å™¨(javac???)è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—(ä¹Ÿå°±æ˜¯æ‰€æœ‰ static å˜é‡ å’Œ é™æ€è¯­å¥å—) åˆå¹¶äº§ç”Ÿçš„ï¼Œé¡ºåºæŒ‰ç…§å…ˆåé¡ºåºã€‚åŒæ—¶æ³¨æ„å“¦ï¼Œstatic é™æ€ä»£ç å—ï¼Œå¯ä»¥èµ‹å€¼åé¢å®šä¹‰çš„é™æ€å˜é‡ï¼Œä¸è¿‡è²Œä¼¼æ²¡æ¯›ç”¨ã€‚ã€‚ã€‚ã€‚ 12345678public class SuperClass &#123; static &#123; System.out.println("SubClass init!"); A = 2; // åæ­£å®ƒä¹Ÿä¸ä¼šè¢« usedï¼Œå› ä¸ºä¼šè¢«è¦†ç›–æ‰ &#125; public static int A = 1;&#125; \() è¿™ä¸ªæ–¹æ³•å¾ˆç‰›å‰ï¼Œä¸ºå•¥å‘¢ï¼Œå› ä¸ºå®ƒä¼šé»˜è®¤å…ˆè°ƒç”¨çˆ¶ç±»çš„ \() ï¼Œå‹æ ¹å°±ä¸éœ€è¦å»æ˜¾ç¤ºçš„è°ƒç”¨ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„ \() æ–¹æ³•çš„ç±»è‚¯å®šæ˜¯java.lang.Objectï¼› æ—¢ç„¶çˆ¶ç±»è¦å…ˆæ‰§è¡Œï¼Œé‚£è‚¯å®šé™æ€è¯­å¥å—è‚¯å®šä¹Ÿæ˜¯ä¼˜å…ˆæ‰§è¡Œçš„ï¼Œè¿™ä¸ªè®©æˆ‘æƒ³åˆ°äº†ä¹‹å‰çš„è¢«åŠ¨è°ƒç”¨ç±»çš„ä¾‹å­ï¼Œå¦‚æœå­ç±»è°ƒç”¨çˆ¶ç±»çš„ static å˜é‡ï¼Œé‚£ä¹ˆå­ç±»æ˜¯ä¸ä¼šè¢«åˆå§‹åŒ–çš„ï¼› \() å¯¹äºç±»æˆ–è€…æ¥å£ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœæ²¡æœ‰ static å˜é‡ å’Œ é™æ€è¯­å¥å—ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæœ‰è¿™ä¸ªæ–¹æ³•ï¼Œå½“ç„¶æ¥å£æœ¬èº«å°±ä¸å¯èƒ½æœ‰ é™æ€è¯­å¥å—ï¼ŒåŒæ—¶è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰§è¡Œæ¥å£çš„ \() æ–¹æ³•ä¸éœ€è¦å»å…ˆæ‰§è¡Œ çˆ¶æ¥å£çš„ \() ï¼Œçˆ¶æ¥å£åªæœ‰è¢«è°ƒç”¨çš„æ—¶å€™æ‰å»æ‰§è¡Œï¼Œè¿™ç‚¹è·Ÿæ¥å£ä¸»åŠ¨è°ƒç”¨åŸåˆ™ä¿æŒä¸€è‡´ã€‚ \() çº¿æ€§å®‰å…¨ï¼Œæ˜¯é€šè¿‡åŠ é”ä¿æŒåŒæ­¥çš„ã€‚ 4. ç±»åŠ è½½å™¨å›é¡¾ä¸€ä¸‹ï¼Œç±»åŠ è½½çš„ç¬¬ä¸€æ­¥ â€œåŠ è½½â€ æ€»å…±è¿›è¡Œäº†ä¸‰ä¸ªåŸºæœ¬åŠ¨ä½œï¼š é€šè¿‡ç±»å‹çš„å®Œå…¨é™å®šåï¼Œäº§ç”Ÿä¸€ä¸ªä»£è¡¨è¯¥ç±»å‹çš„äºŒè¿›åˆ¶æ•°æ®æµï¼ˆæ ¹æœ¬æ²¡æœ‰æŒ‡æ˜ä»å“ªé‡Œè·å–ã€æ€æ ·è·å–ï¼Œå¯ä»¥è¯´ä¸€ä¸ªéå¸¸å¼€æ”¾çš„å¹³å°äº†ï¼‰ï¼› è§£æè¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®æµä¸ºæ–¹æ³•åŒºå†…çš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼› åœ¨ Java å †ä¸­åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºè¯¥ç±»å‹çš„java.lang.Classç±»çš„å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œç¬¬ä¸€ä¸ªåŠ¨ä½œï¼Œå¾ˆç‰›é€¼ï¼Œåªè¦å¾—åˆ°ç±»å‹çš„å®Œå…¨é™å®šåï¼Œå°±èƒ½äº§ç”Ÿä¸€ä¸ªä»£è¡¨è¯¥ç±»å‹çš„äºŒè¿›åˆ¶æ•°æ®æµï¼Œé‚£è¿™ä¸ªæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿå°±æ˜¯é€šè¿‡ç±»åŠ è½½å™¨ï¼Œæ³¨æ„å“¦ï¼Œè¿™ä¸ªæ˜¯æ”¾åˆ°äº† jvm å¤–éƒ¨å»å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå·±å†³å®šå¦‚ä½•å»è·å–éœ€è¦çš„ç±»ï¼Œåªè¦ä½ æŠŠäºŒè¿›åˆ¶æ•°æ®æµæ²¡æ¯›ç—…çš„è½¬åŒ–åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„å³å¯ã€‚ 4.1 ç±»ä¸ç±»åŠ è½½å™¨å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½éœ€è¦ç”±åŠ è½½å®ƒçš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€åŒç¡®ç«‹å…¶åœ¨Javaè™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§ã€‚å¦‚æœä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰ã€‚å…¶å®å¾ˆå®¹æ˜“ç†è§£ï¼Œç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£äº§ç”Ÿçš„äºŒè¿›åˆ¶æµå¿…ç„¶ä¸åŒã€‚ 4.2 ç±»åŠ è½½å™¨ä»‹ç»ä» Java è™šæ‹Ÿæœºçš„è§’åº¦åˆ†ä¸ºä¸¤ç§ä¸åŒçš„ç±»åŠ è½½å™¨ï¼š å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼Œä½¿ç”¨C++è¯­è¨€å®ç°ï¼Œæ˜¯è™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†ï¼› å…¶ä»–ç±»åŠ è½½å™¨ã€‚ç”±Javaè¯­è¨€å®ç°ï¼Œç‹¬ç«‹äºè™šæ‹Ÿæœºä¹‹å¤–ï¼Œå¹¶ä¸”å…¨éƒ½ç»§æ‰¿è‡ªjava.lang.ClassLoaderç±»ã€‚ï¼ˆè¿™é‡Œåªé™äºHotSpotè™šæ‹Ÿæœºï¼‰ã€‚ ä» Java å¼€å‘äººå‘˜çš„è§’åº¦çœ‹ï¼Œå¤§éƒ¨åˆ†Javaç¨‹åºéƒ½ä¼šä½¿ç”¨åˆ°ä»¥ä¸‹3ç§ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨ï¼š å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼š è¿™ä¸ªç±»åŠ è½½å™¨è´Ÿè´£å°†å­˜æ”¾åœ¨&lt;JAVA_HOME&gt;\libç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢«-Xbootclasspathå‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„ï¼Œå¹¶ä¸”æ˜¯è™šæ‹Ÿæœºè¯†åˆ«çš„ï¼ˆä»…æŒ‰ç…§æ–‡ä»¶åè¯†åˆ«ï¼Œå¦‚rt.jarï¼Œåå­—ä¸ç¬¦åˆçš„ç±»åº“å³ä½¿æ”¾åœ¨libç›®å½•ä¸­ä¹Ÿä¸ä¼šè¢«åŠ è½½ï¼‰ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­ã€‚ æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼š è¿™ä¸ªåŠ è½½å™¨ç”±sun.misc.Launcher$ExtClassLoaderå®ç°ï¼Œå®ƒè´Ÿè´£åŠ è½½&lt;JAVA_HOME&gt;\lib\extç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢«java.ext.dirsç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨ã€‚ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ï¼š è¿™ä¸ªç±»åŠ è½½å™¨ç”±sun.misc.Launcher$AppClassLoaderå®ç°ã€‚ç”±äºè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ClassLoaderä¸­çš„getSystemClassLoader()æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¹Ÿç§°å®ƒä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚å®ƒè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰ä¸Šæ‰€æŒ‡å®šçš„ç±»åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚ æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéƒ½æ˜¯ç”±è¿™3ç§ç±»åŠ è½½å™¨äº’ç›¸é…åˆè¿›è¡ŒåŠ è½½çš„ï¼Œå¦‚æœæœ‰å¿…è¦ï¼Œè¿˜å¯ä»¥åŠ å…¥è‡ªå·±å®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚ 4.3 åŒäº²å§”æ´¾æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä»¥å¤–ï¼Œæ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½åº”è¯¥æœ‰çˆ¶ç±»åŠ è½½å™¨ï¼Œè¿™é‡Œçš„çˆ¶å­å…³ç³»ä¸æ˜¯é€šè¿‡ç»§æ‰¿æ¥çš„ï¼Œè€Œæ˜¯é€šè¿‡ç»„åˆå…³ç³»ã€‚ Tip: ç»„åˆå’Œç»§æ‰¿çš„åŒºåˆ«ä¸è”ç³» ç»§æ‰¿ä¸ç»„åˆéƒ½æ˜¯é¢å‘å¯¹è±¡ä¸­ä»£ç å¤ç”¨çš„æ–¹å¼ã€‚ ç»§æ‰¿åœ¨ç¼–ç è¿‡ç¨‹ä¸­å°±è¦æŒ‡å®šå…·ä½“çš„çˆ¶ç±»ï¼Œå…¶å…³ç³»åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šï¼Œè€Œç»„åˆçš„å…³ç³»ä¸€èˆ¬åœ¨è¿è¡Œæ—¶ç¡®å®šã€‚ ç»§æ‰¿å¼ºè°ƒçš„æ˜¯ is-a çš„å…³ç³»ï¼Œè€Œç»„åˆå¼ºè°ƒçš„æ˜¯has-a çš„å…³ç³»ã€‚ å…¶å®å¾ˆå¥½ç†è§£å•¦ï¼Œç»§æ‰¿å°±æ˜¯è¦åœ¨ç±»å£°æ˜æ—¶æ˜¾å¼ extendsï¼Œè€Œç»„åˆä¸ç”¨ï¼Œç»„åˆå¯ä»¥ç®€å•çš„ç†è§£ä¸ºåœ¨ä¸€ä¸ªå¯¹è±¡ï¼ˆç±»ï¼‰ä¸­ç”¨åˆ°äº†å¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼ˆç±»ï¼‰ã€‚ ä¸€èˆ¬ä¼˜å…ˆè€ƒè™‘ç»„åˆï¼Œå› ä¸ºjavaé‡Œä¸å…è®¸å¤šé‡ç»§æ‰¿ã€‚ å“ˆå“ˆå“ˆï¼Œæˆ‘åˆæœ‰é—®é¢˜äº†ï¼Œä¸ºä»€ä¹ˆ java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿å‘¢ï¼Ÿ æˆ‘è§‰å¾—ä¸»è¦æ˜¯æœ‰ä¸€ç§æƒ…å†µå¾ˆå®¹æ˜“é€ æˆäºŒä¹‰æ€§ï¼Œå°±æ˜¯ A æ˜¯æœ€é¡¶å±‚çš„ï¼Œç„¶å B å’Œ C ç»§æ‰¿äº† A ï¼ŒåŒæ—¶å¤å†™äº† A çš„ ä¸€ä¸ªæ–¹æ³•ï¼Œå¦‚æœ D æ­¤æ—¶å¤šé‡ç»§æ‰¿ B å’Œ Cï¼Œé‚£è°ƒç”¨åŒæ ·çš„æ–¹æ³•çš„æ—¶å€™å°±ä¼šäº§ç”ŸäºŒä¹‰æ€§äº†â€¦ åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹ï¼š å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå…ˆæŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼ˆæ‰€ä»¥æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼‰ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚(å®ƒçš„æœç´¢èŒƒå›´æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€è¦çš„ç±»)æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚ ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹æ¥ç»„ç»‡ç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»ï¼Œæœ‰ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„å¥½å¤„å°±æ˜¯javaç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ã€‚ æ³¨æ„ï¼šåŒäº²å§”æ´¾æ¨¡å‹æ˜¯ Java è®¾è®¡è€…ä»¬æ¨èç»™å¼€å‘è€…ä»¬çš„ä¸€ç§ç±»åŠ è½½å™¨å®ç°æ–¹å¼ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå¼ºåˆ¶æ€§ çš„çº¦æŸæ¨¡å‹ã€‚åœ¨ Java çš„ä¸–ç•Œä¸­å¤§éƒ¨åˆ†çš„ç±»åŠ è½½å™¨éƒ½éµå¾ªè¿™ä¸ªæ¨¡å‹ï¼Œä½†ä¹Ÿæœ‰ä¾‹å¤–ã€‚ 4.4 ç ´ååŒäº²å§”æ´¾æ¨¡å‹ä¸‰æ¬¡å¤§ç ´åã€‚ ç¬¬ä¸€æ¬¡ç ´åæ˜¯å› ä¸ºç±»åŠ è½½å™¨å’ŒæŠ½è±¡ç±»java.lang.ClassLoaderåœ¨JDK1.0å°±å­˜åœ¨çš„ï¼Œè€ŒåŒäº²å§”æ´¾æ¨¡å‹åœ¨JDK1.2ä¹‹åæ‰è¢«å¼•å…¥ï¼Œä¸ºäº†å…¼å®¹å·²ç»å­˜åœ¨çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œå¼•å…¥åŒäº²å§”æ´¾æ¨¡å‹æ—¶åšäº†ä¸€å®šçš„å¦¥åï¼šåœ¨java.lang.ClassLoaderä¸­å¼•å…¥äº†ä¸€ä¸ªfindClass()æ–¹æ³•ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œç”¨æˆ·å»ç»§æ‰¿java.lang.Classloaderçš„å”¯ä¸€ç›®çš„å°±æ˜¯é‡å†™loadClass()æ–¹æ³•ã€‚JDK1.2ä¹‹åä¸æå€¡ç”¨æˆ·å»è¦†ç›–loadClass()æ–¹æ³•ï¼Œè€Œæ˜¯æŠŠè‡ªå·±çš„ç±»åŠ è½½é€»è¾‘å†™åˆ°findClass()æ–¹æ³•ä¸­ï¼Œå¦‚æœloadClass()æ–¹æ³•ä¸­å¦‚æœçˆ¶ç±»åŠ è½½å¤±è´¥ï¼Œåˆ™ä¼šè°ƒç”¨è‡ªå·±çš„findClass()æ–¹æ³•æ¥å®ŒæˆåŠ è½½ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æ–°å†™å‡ºæ¥çš„ç±»åŠ è½½å™¨æ˜¯ç¬¦åˆåŒäº²å§”æ´¾æ¨¡å‹è§„åˆ™çš„ã€‚ ç¬¬äºŒæ¬¡ç ´åæ˜¯å› ä¸ºæ¨¡å‹è‡ªèº«çš„ç¼ºé™·ï¼Œç°å®ä¸­å­˜åœ¨è¿™æ ·çš„åœºæ™¯ï¼šåŸºç¡€çš„ç±»åŠ è½½å™¨éœ€è¦æ±‚è°ƒç”¨ç”¨æˆ·çš„ä»£ç ï¼Œè€ŒåŸºç¡€çš„ç±»åŠ è½½å™¨å¯èƒ½ä¸è®¤è¯†ç”¨æˆ·çš„ä»£ç ã€‚ä¸ºæ­¤ï¼ŒJavaè®¾è®¡å›¢é˜Ÿå¼•å…¥çš„è®¾è®¡æ˜¯ â€œçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆThread Context ClassLoaderï¼‰â€ã€‚è¿™æ ·å¯ä»¥é€šè¿‡çˆ¶ç±»åŠ è½½å™¨è¯·æ±‚å­ç±»åŠ è½½å™¨å»å®Œæˆç±»åŠ è½½åŠ¨ä½œã€‚å·²ç»è¿èƒŒäº†åŒäº²å§”æ´¾æ¨¡å‹çš„ä¸€èˆ¬æ€§åŸåˆ™ã€‚ ç¬¬ä¸‰æ¬¡ç ´å æ˜¯ç”±äºç”¨æˆ·å¯¹ç¨‹åºåŠ¨æ€æ€§çš„è¿½æ±‚å¯¼è‡´çš„ã€‚è¿™é‡Œæ‰€è¯´çš„åŠ¨æ€æ€§æ˜¯æŒ‡ï¼šâ€œä»£ç çƒ­æ›¿æ¢â€ã€â€œæ¨¡å—çƒ­éƒ¨ç½²â€ç­‰ç­‰æ¯”è¾ƒçƒ­é—¨çš„è¯ã€‚è¯´ç™½äº†å°±æ˜¯å¸Œæœ›åº”ç”¨ç¨‹åºèƒ½å¤Ÿåƒæˆ‘ä»¬çš„è®¡ç®—æœºå¤–è®¾ä¸€æ ·ï¼Œæ¥ä¸Šé¼ æ ‡ã€Uç›˜ä¸ç”¨é‡å¯æœºå™¨å°±èƒ½ç«‹å³ä½¿ç”¨ã€‚OSGiæ˜¯å½“å‰ä¸šç•Œâ€œäº‹å®ä¸Šâ€çš„Javaæ¨¡å—åŒ–æ ‡å‡†ï¼ŒOSGiå®ç°æ¨¡å—åŒ–çƒ­éƒ¨ç½²çš„å…³é”®æ˜¯å®ƒè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æœºåˆ¶çš„å®ç°ã€‚æ¯ä¸€ä¸ªç¨‹åºæ¨¡å—ï¼ˆOSGiä¸­ç§°ä¸ºBundleï¼‰éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œå½“éœ€è¦æ›´æ¢ä¸€ä¸ªBundleæ—¶ï¼Œå°±æŠŠBundleè¿åŒç±»åŠ è½½å™¨ä¸€èµ·æ¢æ‰ä»¥å®ç°ä»£ç çš„çƒ­æ›¿æ¢ã€‚åœ¨OSGiç¯å¢ƒä¸‹ï¼Œç±»åŠ è½½å™¨ä¸å†æ˜¯åŒäº²å§”æ´¾æ¨¡å‹ä¸­çš„æ ‘çŠ¶ç»“æ„ï¼Œè€Œæ˜¯è¿›ä¸€æ­¥å‘å±•ä¸ºæ›´åŠ å¤æ‚çš„ç½‘çŠ¶ç»“æ„ã€‚ ã€Œå¥½å­ï¼Œè¿™ä¸€å—æˆ‘ä¸å¤ªæ‡‚â€¦ã€ ç¬¬å…«ç«  è™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“ 1. æ¦‚è¿°æ‰§è¡Œå¼•æ“æ˜¯è™šæ‹Ÿæœºä¸­æœ€æ ¸å¿ƒçš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ï¼Œâ€œè™šæ‹Ÿæœºâ€å¯ä»¥è‡ªè¡Œåˆ¶å®šæŒ‡ä»¤é›†ä¸æ‰§è¡Œå¼•æ“çš„ç»“æ„ä½“ç³»ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ‰§è¡Œé‚£äº›ä¸è¢«ç¡¬ä»¶ç›´æ¥æ”¯æŒçš„æŒ‡ä»¤é›†æ ¼å¼ã€‚ åœ¨ Java è™šæ‹Ÿæœºè§„èŒƒä¸­ï¼Œç½®é¡¶äº†è™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“çš„æ¦‚å¿µæ¨¡å‹ï¼Œè¿™ä¸ªæ¦‚å¿µæ¨¡å‹æˆä¸ºäº†å„ä¸ªè™šæ‹Ÿæœºæ‰§è¡Œå¼•æ“çš„ç»Ÿä¸€å¤–è§‚ï¼Œä½†æ˜¯å†…éƒ¨å®ç°å„ä¸ç›¸åŒï¼Œæœ‰çš„æ˜¯é€šè¿‡è§£é‡Šå™¨è§£é‡Šæ‰§è¡Œï¼Œæœ‰çš„åˆ™æ˜¯é€šè¿‡å³æ—¶ç¼–è¯‘å™¨(JIT)æ‰§è¡Œï¼Œä½†ä»å¤–è§‚ä¸Šçœ‹ï¼Œéƒ½æ˜¯è¾“å…¥å­—èŠ‚ç æ–‡ä»¶ï¼Œè¾“å‡ºæ‰§è¡Œç»“æœã€‚ 2. è¿è¡Œæ—¶æ ˆå¸§æ ˆå¸§ï¼ˆStack Frameï¼‰æ˜¯ç”¨äºæ”¯æŒè™šæ‹Ÿæœºè¿›è¡Œ æ–¹æ³•è°ƒç”¨å’Œæ–¹æ³•æ‰§è¡Œ çš„æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºä¸­çš„è™šæ‹Ÿæœºæ ˆçš„æ ˆå…ƒç´ ï¼Œæ¯ä¸€ä¸ªæ ˆå¸§éƒ½åŒ…å«äº† å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥ã€æ–¹æ³•è¿”å›åœ°å€å’Œä¸€äº›é¢å¤–çš„é™„åŠ ä¿¡æ¯ã€‚æ ˆå¸§çš„å¤§å°æ—©å°±å†™å…¥åˆ°äº† class æ–‡ä»¶ä¸­çš„ code å±æ€§ä¸­äº†ï¼Œå¹¶ä¸”å¯¹äºæ‰§è¡Œå¼•æ“æ¥è¯´ï¼Œåªæœ‰æ ˆé¡¶çš„æ ˆå¸§æ‰æ˜¯æœ‰æ•ˆçš„ï¼Œç§°ä¸ºå½“å‰æ ˆå¸§ï¼Œè¿™ä¸ªæ ˆå¸§æ‰€å…³è”çš„æ–¹æ³•ç§°ä¸ºå½“å‰æ–¹æ³•ã€‚ 2.1 å±€éƒ¨å˜é‡è¡¨å±€éƒ¨å˜é‡è¡¨æ˜¯ä¸€ç»„å˜é‡å€¼å­˜å‚¨ç©ºé—´ï¼Œç”¨äºå­˜æ”¾æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…å®šä¹‰çš„å±€éƒ¨å˜é‡ã€‚ å½“ç„¶ï¼Œå±€éƒ¨å˜é‡è¡¨çš„å¤§å°æ—©åœ¨ Code å±æ€§çš„ max_locals æ•°æ®é¡¹ä¸­å°±å®šä¹‰äº†ã€‚ å±€éƒ¨å˜é‡è¡¨ä»¥ å˜é‡æ§½ï¼ˆSlotï¼‰ ä¸ºæœ€å°å•ä½ï¼Œé»˜è®¤ä¸€ä¸ª Slot ä¸º32ä½ï¼Œå¦‚æœæ˜¯64ä½çš„æ•°æ®ç»“æ„ä¼šä¸ºå…¶åˆ†é…è¿ç»­ä¸¤ä¸ª Slot ç©ºé—´ã€‚ å¯¹äºå±€éƒ¨å˜é‡è¡¨ï¼Œæœ‰ä¸‰ç‚¹éœ€è¦æé†’ï¼š æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆä»æ“ä½œæ ˆæ ˆé¡¶çš„å‚æ•°å€¼åˆ°å‚æ•°å˜é‡åˆ—è¡¨çš„ä¼ é€’è¿‡ç¨‹ï¼Œå¦‚æœæ˜¯å®ä¾‹æ–¹æ³•åˆ™ç¬¬ä¸€ä¸ªå‚æ•°é»˜è®¤æ˜¯å¯¹è±¡å®ä¾‹çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯thisï¼Œå‰©ä¸‹çš„å‚æ•°ä» 1 å¼€å§‹ï¼› Slot æ˜¯å¯ä»¥é‡ç”¨çš„ï¼› å±€éƒ¨å˜é‡å¹¶æ²¡æœ‰åƒç±»å˜é‡ä¸€æ ·å­˜åœ¨â€œå‡†å¤‡é˜¶æ®µâ€(ç±»åŠ è½½çš„è¿æ¥è¿‡ç¨‹çš„ç¬¬äºŒæ­¥)ï¼Œæ‰€ä»¥å¦‚æœè¦ä½¿ç”¨å±€éƒ¨å˜é‡è‚¯å®šè¦å…ˆèµ‹åˆå€¼ã€‚ 2.2 æ“ä½œæ•°æ ˆæ“ä½œæ•°æ ˆï¼Œä¹Ÿè¢«ç§°ä¸ºæ“ä½œæ ˆï¼ŒåŒå±€éƒ¨å˜é‡è¡¨ä¸€æ ·ï¼Œå®¹é‡ä¹Ÿæ˜¯åœ¨ Code å±æ€§çš„ max_stacks æ•°æ®é¡¹ä¹‹ä¸­æ—©å°±å†™å…¥äº†ï¼ŒåŒæ ·çš„ï¼Œæ ˆä¸­çš„åŸºæœ¬å•ä½ä¹Ÿæ˜¯ Slot(32ä½)ï¼Œ32ä½æ•°æ®ç±»å‹å æ ˆå®¹é‡ä¸º 1ï¼Œ64 ä½çš„å  2 ï¼Œæ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå°±æ˜¯å…¥æ ˆå‡ºæ ˆçš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ï¼ŒJava è™šæ‹Ÿæœºçš„è§£é‡Šæ‰§è¡Œå¼•æ“ç§°ä¸º â€œåŸºäºæ ˆçš„æ‰§è¡Œå¼•æ“â€ã€‚ å¦å¤–ï¼Œåœ¨æ¦‚å¿µæ¨¡å‹ä¸­ï¼Œä¸¤ä¸ªæ ˆå¸§ä½œä¸ºè™šæ‹Ÿæœºæ ˆçš„å…ƒç´ ï¼Œç›¸äº’ä¹‹é—´æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œä½†æ˜¯åœ¨å¤§å¤šæ•°è™šæ‹Ÿæœºä¸­ä¼šåšå‡ºä¼˜åŒ–â€”â€” ä»¤ä¸¤ä¸ªæ ˆå¸§å‡ºç°ä¸€éƒ¨åˆ†é‡å ï¼Œè¿™æ ·åœ¨è¿›è¡Œæ–¹æ³•è°ƒç”¨çš„æ—¶å€™å°±å¯ä»¥å…±ç”¨ä¸€éƒ¨åˆ†æ•°æ®ï¼Œæ— éœ€è¿›è¡Œé¢å¤–çš„å‚æ•°å¤åˆ¶ä¼ é€’äº†ã€‚ 2.3 åŠ¨æ€è¿æ¥åŠ¨æ€è¿æ¥å°±æ˜¯ç”¨æ¥å­˜å‚¨éƒ¨åˆ†æœªè½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨çš„ç¬¦å·å¼•ç”¨ï¼Œå°†å…¶è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ã€‚åœ¨ä¹‹å‰çš„ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„è§£æéƒ¨åˆ†æˆ‘ä»¬è°ˆåˆ°è¿‡ï¼ŒClass æ–‡ä»¶çš„å¸¸é‡æ± å­˜å‚¨äº†å¤§é‡çš„ç¬¦å·å¼•ç”¨ï¼Œå› ä¸º java ä¸åƒ C++ ä¸€æ ·åœ¨ç¼–è¯‘ä¹‹å‰æœ‰è¿æ¥çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ java åœ¨ä¸­é—´ç©¿æ’äº†è¿æ¥è¿‡ç¨‹ï¼Œç¬¬ä¸€æ¬¡å°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨æ˜¯åœ¨ç±»åŠ è½½ä¸­çš„è§£æï¼Œè¿™ç§è½¬åŒ–ç§°ä¸ºé™æ€è§£æï¼Œç¬¬äºŒæ¬¡åˆ™æ˜¯åœ¨æ¯ä¸€æ¬¡çš„è¿è¡ŒæœŸé—´è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼Œç§°ä¸º åŠ¨æ€è¿æ¥ã€‚ è‡³äºå“ªäº›ç¬¦å·å¼•ç”¨æ˜¯é™æ€è§£æå®Œæˆï¼Œå“ªäº›æ˜¯åŠ¨æ€è¿æ¥ï¼Œä¼šåœ¨æ¥ä¸‹æ¥çš„æ–¹æ³•è°ƒç”¨ä¸€èŠ‚ä¸­è°ˆåˆ°ã€‚ 2.4 æ–¹æ³•è¿”å›åœ°å€å­˜å‚¨çš„å°±æ˜¯ ç”¨æ¥å¸®åŠ©æ¢å¤ä¸Šå±‚æ–¹æ³•çš„æ‰§è¡ŒçŠ¶æ€ çš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚æœæ–¹æ³•æ˜¯æ­£å¸¸é€€å‡ºçš„ï¼Œé‚£ä¹ˆä¸€èˆ¬ä¼šå­˜å‚¨è°ƒç”¨è€…ï¼ˆä¸Šå±‚æ–¹æ³•ï¼‰çš„ PC è®¡æ•°å€¼ï¼Œæ¥ä½œä¸ºè¿”å›åœ°å€ã€‚è€Œæ–¹æ³•å¼‚å¸¸é€€å‡ºçš„è¯ï¼Œè¿”å›åœ°å€ä¸€èˆ¬å°±æ˜¯é€šè¿‡å¼‚å¸¸å¤„ç†å™¨è¡¨æ¥ç¡®å®šäº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæ–¹æ³•è¿”å›åœ°å€è¿™ä¸€å—ä¸€èˆ¬ä¸ä¼šä¿å­˜ä»»ä½•ä¿¡æ¯ã€‚ è¿™é‡Œæåˆ°äº†ä¸¤ç§é€€å‡ºæ–¹å¼ï¼š æ­£å¸¸å®Œæˆå‡ºå£ï¼ˆNormal Method Invocation Completionï¼Œè¯è¯´ç¿»è¯‘ä¸åº”è¯¥æ˜¯æ­£å¸¸çš„å®Œæˆæ–¹æ³•è°ƒç”¨ï¼Ÿï¼Ÿï¼Ÿï¼‰ã€‚æ­¤æ—¶é€€å‡ºæ–¹æ³•çš„æ“ä½œåº”è¯¥æ˜¯ï¼šæ¢å¤ä¸Šå±‚æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆï¼Œå¦‚æœæœ‰è¿”å›å€¼å°±å‹å…¥è°ƒç”¨è€…çš„æ ˆå¸§ä¸­çš„æ“ä½œæ•°æ ˆä¸­ï¼Œç„¶åè°ƒæ•´PCè®¡æ•°å€¼ã€‚ å¼‚å¸¸å®Œæˆå‡ºå£ï¼ˆAbrupt Method Invocation Completionï¼Œæˆ‘è§‰å¾—ç¿»è¯‘æˆå¼‚å¸¸çš„æ–¹æ³•è°ƒç”¨ä¼šæ›´å¥½â€¦ï¼‰ã€‚æ­¤æ—¶é€€å‡ºæ–¹æ³•çš„æ“ä½œåº”è¯¥å’Œä¸Šè€…ä¸€æ ·ï¼Œå½“ç„¶äº†ï¼Œè¿™é‡Œè‚¯å®šæ˜¯ä¸ä¼šæœ‰è¿”å›å€¼çš„ã€‚ 2.5 é™„åŠ ä¿¡æ¯å¯ä»¥å¢åŠ ä¾‹å¦‚è°ƒè¯•ç›¸å…³çš„ä¿¡æ¯ï¼Œä¸€èˆ¬åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¼šæŠŠ åŠ¨æ€è¿æ¥ã€æ–¹æ³•è¿”å›åœ°å€å’Œé™„åŠ ä¿¡æ¯å½’ä¸ºä¸€ç±»ï¼Œç§°ä¹‹ä¸ºæ ˆå¸§ä¿¡æ¯ã€‚ 3. æ–¹æ³•è°ƒç”¨æ–¹æ³•è°ƒç”¨çš„å”¯ä¸€ä»»åŠ¡å°±æ˜¯æŠŠè¯¥æ–¹æ³•è°ƒç”¨çš„æ–¹æ³•ç¡®å®šï¼Œæš‚æ—¶ä¸æ¶‰åŠåˆ°æ–¹æ³•å†…éƒ¨çš„å…·ä½“è¿è¡Œè¿‡ç¨‹ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªè¦å•ç‹¬æ‹å‡ºæ¥è®²å‘¢ï¼Ÿå› ä¸ºåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè¿›è¡Œæ–¹æ³•è°ƒç”¨æ—¶æœ€æ™®éã€æœ€é¢‘ç¹çš„æ“ä½œï¼Œå¹¶ä¸”ç”±äºåŠ¨æ€è¿æ¥çš„åŸå› ï¼Œæ‰€ä»¥æ–¹æ³•è°ƒç”¨è¿˜æ˜¯æŒºå¤æ‚çš„â€¦ 3.1 è§£æä¹‹å‰åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­å·²ç»è§è¿‡ä¸€æ¬¡ è§£æ äº†ï¼Œæ²¡é”™ï¼Œè¿™ä¸¤ä¸ªè§£ææ˜¯ä¸€ä¸ªæ„æ€ã€‚ä¹‹å‰æ²¡å…·ä½“è®²çš„åŸå› æ˜¯ï¼Œè¿™é‡Œåˆè¦è®²ä¸€éâ€¦ åœ¨ç±»åŠ è½½çš„è§£æé˜¶æ®µï¼Œä¼šå°†å…¶ä¸­çš„ä¸€éƒ¨åˆ†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†è¦å…·å¤‡ä¸‹é¢è¿™ä¸ªæ¡ä»¶ï¼šæ–¹æ³•åœ¨ç¨‹åºè¿è¡Œä¹‹å‰å°±æœ‰ä¸€ä¸ªå¯ç¡®å®šçš„è°ƒç”¨æ¨¡æ¿ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ç‰ˆæœ¬åœ¨è¿è¡ŒæœŸé—´æ˜¯ä¸å¯ä»¥æ”¹å˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»åœ¨javacç¼–è¯‘æ—¶å°±éœ€è¦ç¡®å®šä¸‹æ¥ï¼Œç¬¦åˆâ€œç¼–è¯‘æœŸå¯çŸ¥ï¼Œè¿è¡ŒæœŸä¸å¯å˜çš„è¦æ±‚â€ã€‚è¿™ç±»æ–¹æ³•è°ƒç”¨å°±ç§°ä¹‹ä¸ºè§£æã€‚ ç¬¦åˆè¿™ä¸ªè¦æ±‚çš„æœ‰ï¼š é™æ€æ–¹æ³•ï¼Œä¸ç±»å‹ç›´æ¥ç›¸å…³ï¼Œä¸ä¼šè¢«é‡å†™ï¼› privateä¿®é¥°çš„æ–¹æ³•ï¼Œä¸ä¼šè¢«å¤–éƒ¨è®¿é—®è€Œå¯¼è‡´é‡å†™ï¼› å®ä¾‹åŒ–æ„é€ å™¨\æ–¹æ³•ï¼Œä¹ŸåŒæ ·ç¬¦åˆâ€œç¼–è¯‘æœŸå¯çŸ¥ï¼Œè¿è¡ŒæœŸä¸å¯å˜â€ï¼Œä¸ä¼šè¢«é‡å†™ï¼› çˆ¶ç±»æ–¹æ³•ã€‚è¿™ä¸ªåœ°æ–¹æ˜¯éš¾ç‚¹ï¼Œå¯èƒ½ç†è§£ä¸Šä¼šæœ‰ç‚¹æ­§ä¹‰ï¼Œè¿™é‡Œè®²çš„æ˜¯æŒ‡åœ¨é‡å†™çš„æ–¹æ³•ä¸­è°ƒç”¨ super.æ–¹æ³•å()ï¼Œåœ¨è¿™é‡Œè°ƒç”¨çˆ¶ç±»çš„è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç¡®ä¿ä¸ä¼šè¢«é‡å†™ï¼Œæ˜¯å›ºå®šçš„è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š 12345678910package JVM;public class SuperClass &#123; protected void A() &#123; System.out.println("aaaaaa"); &#125; protected void B() &#123; System.out.println("bbbbbb"); &#125;&#125; 1234567891011121314151617package JVM;public class SubClass extends SuperClass &#123; @Override public void A()&#123; super.A(); // invokespecial System.out.println(2222); &#125; public static void main(String[] args) &#123; test_heap_outOfMemory t = new test_heap_outOfMemory(); t.C(); SubClass subClass = new SubClass(); subClass.A(); // invokevirtual,å› ä¸ºå¯èƒ½è¢«é‡å†™ // subClass.B() ä¹Ÿæ˜¯ invokevirtualï¼Œå› ä¸ºä¹Ÿå¯èƒ½è¢«é‡å†™ &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869// class version 52.0 (52)// access flags 0x21public class JVM/SubClass extends JVM/SuperClass &#123; // compiled from: SubClass.java // access flags 0x1 public &lt;init&gt;()V L0 LINENUMBER 3 L0 ALOAD 0 INVOKESPECIAL JVM/SuperClass.&lt;init&gt; ()V RETURN L1 LOCALVARIABLE this LJVM/SubClass; L0 L1 0 MAXSTACK = 1 MAXLOCALS = 1 // access flags 0x1 public A()V L0 LINENUMBER 6 L0 ALOAD 0 INVOKESPECIAL JVM/SuperClass.A ()V L1 LINENUMBER 7 L1 GETSTATIC java/lang/System.out : Ljava/io/PrintStream; SIPUSH 2222 INVOKEVIRTUAL java/io/PrintStream.println (I)V L2 LINENUMBER 8 L2 RETURN L3 LOCALVARIABLE this LJVM/SubClass; L0 L3 0 MAXSTACK = 2 MAXLOCALS = 1 // access flags 0x9 public static main([Ljava/lang/String;)V L0 LINENUMBER 11 L0 NEW JVM/test_heap_outOfMemory DUP INVOKESPECIAL JVM/test_heap_outOfMemory.&lt;init&gt; ()V ASTORE 1 L1 LINENUMBER 12 L1 ALOAD 1 INVOKEVIRTUAL JVM/test_heap_outOfMemory.C ()V L2 LINENUMBER 13 L2 NEW JVM/SubClass DUP INVOKESPECIAL JVM/SubClass.&lt;init&gt; ()V ASTORE 2 L3 LINENUMBER 14 L3 ALOAD 2 INVOKEVIRTUAL JVM/SubClass.A ()V L4 LINENUMBER 17 L4 RETURN L5 LOCALVARIABLE args [Ljava/lang/String; L0 L5 0 LOCALVARIABLE t LJVM/test_heap_outOfMemory; L1 L5 1 LOCALVARIABLE subClass LJVM/SubClass; L3 L5 2 MAXSTACK = 2 MAXLOCALS = 3&#125; å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œè°ˆåˆ°çš„ invokespecialã€invokestatic å°±æ˜¯è§£æé˜¶æ®µè°ƒç”¨çš„æŒ‡ä»¤ï¼Œå…·ä½“çš„è°ƒç”¨å­—èŠ‚ç æŒ‡ä»¤å¦‚ä¸‹ï¼š invokestaticï¼šè°ƒç”¨é™æ€æ–¹æ³•ï¼› invokespecialï¼šè°ƒç”¨å®ä¾‹æ„é€ å™¨æ–¹æ³• \ã€ç§æœ‰æ–¹æ³•ã€çˆ¶ç±»æ–¹æ³•ï¼› invokevirtualï¼šè°ƒç”¨æ‰€æœ‰çš„è™šæ–¹æ³•ï¼› invokeinterfaceï¼šè°ƒç”¨æ¥å£æ–¹æ³•ï¼Œä¼šåœ¨è¿è¡Œæ—¶ç¡®è®¤ä¸€ä¸ªå®ç°æ­¤æ¥å£çš„å¯¹è±¡ï¼› invokedynamicï¼šJDK1.7æ–°åŠ å…¥çš„ä¸€ä¸ªè™šæ‹ŸæœºæŒ‡ä»¤ï¼Œç›¸æ¯”äºä¹‹å‰çš„å››æ¡æŒ‡ä»¤ï¼Œä»–ä»¬çš„åˆ†æ´¾é€»è¾‘éƒ½æ˜¯å›ºåŒ–åœ¨JVMå†…éƒ¨ï¼Œè€Œ invokedynamic åˆ™ç”¨äºå¤„ç†æ–°çš„æ–¹æ³•åˆ†æ´¾ï¼šå®ƒå…è®¸åº”ç”¨çº§åˆ«çš„ä»£ç æ¥ç¡®å®šæ‰§è¡Œå“ªä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œåªæœ‰åœ¨è°ƒç”¨è¦æ‰§è¡Œçš„æ—¶å€™ï¼Œæ‰ä¼šè¿›è¡Œè¿™ç§åˆ¤æ–­,ä»è€Œè¾¾åˆ°åŠ¨æ€è¯­è¨€çš„æ”¯æŒã€‚(Invoke dynamic method) åªè¦è¢« invokestaticã€invokespecialè°ƒç”¨çš„æ–¹æ³•éƒ½æ˜¯å¯ä»¥åœ¨è§£æé˜¶æ®µç¡®å®šå”¯ä¸€çš„è°ƒç”¨ç‰ˆæœ¬çš„ï¼Œæ‰€ä»¥ä»–ä»¬åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±ä¼šæŠŠç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºå¯¹è¯¥æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ï¼Œè¿™å››ç±»æ–¹æ³•ï¼ˆé™æ€æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€çˆ¶ç±»æ–¹æ³•ï¼‰ç»Ÿç§°ä¸ºéè™šæ–¹æ³•ã€Œå½“ç„¶å…¶å®éè™šæ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ç±»ï¼Œé‚£å°±æ˜¯ç”¨ final ä¿®é¥°çš„æ–¹æ³•ã€ï¼Œå…¶ä»–æ–¹æ³•ç»Ÿç§°ä¸ºè™šæ–¹æ³•ï¼ˆfinal ä¿®é¥°çš„æ–¹æ³•é™¤å¤–ï¼‰ã€‚å…¶å® final ä¿®é¥°çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šçš„ï¼Œä½†æ˜¯å®ƒæ¯”è¾ƒç‰¹æ®Šï¼Œå¹¶ä¸æ˜¯ç”¨çš„ä¸Šè¿°ä¸¤ä¸ªæŒ‡ä»¤å®Œæˆè°ƒç”¨ï¼Œè€Œæ˜¯ä½¿ç”¨äº† invokevirtualâ€¦ è‡³äºä¸ºä»€ä¹ˆï¼Œæˆ‘è§‰å¾—è¿™ä½æœ‹å‹è¯´çš„æŒºå¥½çš„çš„ï¼š ä½œè€…ï¼šRednaxelaFXé“¾æ¥ï¼šhttps://www.zhihu.com/question/45131640/answer/98820081æ¥æºï¼šçŸ¥ä¹è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ Qï¼šä¸ºä»€ä¹ˆjavaä¸­è°ƒç”¨finalæ–¹æ³•æ˜¯ç”¨invokevirtualæŒ‡ä»¤è€Œä¸æ˜¯invokespecial? Aï¼š ä¸çŸ¥é“å½“æ—¶é«˜å¸ä»¤å’Œå›¢é˜Ÿæˆå‘˜å®é™…æ˜¯å‡ºäºä»€ä¹ˆåŸå› è¿™æ ·è®¾è®¡çš„ã€‚è¿™é‡Œæˆ‘åªèƒ½åšäº›æ¨æ–­ã€‚ è¢«finalä¿®é¥°çš„non-privateæ–¹æ³•ï¼Œç¡®å®è·Ÿprivateæ–¹æ³•ä¸€æ ·å¯ä»¥é™æ€åˆ¤å®šè°ƒç”¨ç›®æ ‡ã€‚æˆ‘ä»¬è¯´è¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥è¢«statically resolvedã€‚ å®ƒä»¬æœ€å¤§çš„ä¸€ä¸ªå·®åˆ«æ˜¯ï¼š ä¸€ä¸ªprivateæ–¹æ³•æ˜¯åªå¯èƒ½åœ¨ä¸€ä¸ªç±»é‡Œå£°æ˜å¹¶å®šä¹‰çš„ï¼Œå®ƒä¸å¯èƒ½è¦†å†™ï¼ˆoverrideï¼‰ä»»ä½•åŸºç±»çš„æ–¹æ³•ã€‚ è€Œä¸€ä¸ªfinal non-privateæ–¹æ³•åˆ™å¯ä»¥è¦†å†™åŸºç±»çš„è™šæ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥è¢«åŸºç±»å¼•ç”¨é€šè¿‡invokevirtualè°ƒç”¨åˆ°ã€‚ å‰è€…å¾ˆæ˜æ˜¾ï¼Œä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹åè€…ã€‚ 1234567891011121314151617181920&gt; &gt; class Base &#123;&gt; void foo() &#123; System.out.println("Base"); &#125;&gt; &#125;&gt; &gt; class Derived extends Base &#123;&gt; @Override&gt; final void foo() &#123; System.out.println("Derived"); &#125;&gt; &#125;&gt; &gt; public class Test &#123;&gt; public static void main(String[] args) &#123;&gt; Derived d = new Derived();&gt; d.foo(); // (1) é¢˜ä¸»çš„é—®é¢˜æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªæƒ…å†µä¸‹ä»ç„¶ç”¨invokevirtual&gt; Base b = d; // (2) Baseç±»å‹å¼•ç”¨æŒ‡å‘Derivedç±»å‹å®ä¾‹&gt; b.foo(); // é€šè¿‡invokevirtualè°ƒç”¨åˆ°final Derived.foo()&gt; &#125;&gt; &#125;&gt; &gt; æ‰€ä»¥ï¼ŒåŸå§‹è®¾è®¡è€…æˆ–è®¸æ˜¯å‡ºäºä¸€è‡´æ€§çš„è€ƒè™‘ï¼Œé€‰æ‹©è®©è¿™äº›finalæ–¹æ³•ä¹Ÿç”¨invokevirtualæ¥è°ƒç”¨ï¼Œè€Œä¸æ˜¯ç”¨invokespecialã€‚å¦å¤–æ­£å¦‚è¯„è®ºåŒºæ‰€è¯´ï¼Œè¿™ä¸€è‡´æ€§ä¹Ÿå¸¦æ¥äº†æ›´å¥½çš„äºŒè¿›åˆ¶å…¼å®¹æ€§â€”â€”å¦‚æœä¸Šä¾‹ä¸­Testä¸Derivedåˆ†ç¦»ç¼–è¯‘ï¼Œåœ¨Testç¼–è¯‘æ—¶Derived.foo()æ˜¯finalï¼Œè€Œåæ¥Derivedå»æ‰äº†foo()çš„finalå¹¶ä¸”å•ç‹¬é‡æ–°ç¼–è¯‘äº†çš„è¯ï¼Œå·²ç¼–è¯‘çš„Testä»£ç ä»ç„¶å¯ä»¥æ­£ç¡®æ‰§è¡Œâ€”â€”ç”šè‡³å¦‚æœDerivedè¿›ä¸€æ­¥æœ‰å­ç±»è¦†å†™äº†foo()ä¹Ÿæ²¡é—®é¢˜ã€‚ äºŒè¿›åˆ¶å…¼å®¹æ€§ï¼ˆbinary compatibilityï¼‰å’Œåˆ†ç¦»ç¼–è¯‘ï¼ˆseparate compilationï¼‰å¯æ˜¯Javaçš„å–ç‚¹ï¼Œç„¶è€ŒåŒæ—¶ä¹Ÿæ˜¯æ¯’ç˜¤â€¦ï¼ˆå¹æ°” å…³äºæ€§èƒ½ äº‹å®ä¸Šæ­¤å¤„åœ¨Classæ–‡ä»¶é‡Œä½¿ç”¨invokevirtualæ¥å®ç°å¯¹finalæ–¹æ³•çš„è°ƒç”¨å¹¶ä¸ä¼šå½±å“ä¸€ä¸ªå®ç°å¾—å¥½çš„JVMçš„æ€§èƒ½ã€‚HotSpot VMä¼šå¯¹ä¸Šè¿°(1)çš„æƒ…å†µåœ¨è§£é‡Šå™¨é‡Œå¯ä»¥æŠŠinvokevirtualæ”¹å†™ä¸ºä¸€ä¸ªè¡Œä¸ºè·Ÿinvokespecialç›¸ä¼¼çš„å†…éƒ¨å­—èŠ‚ç æŒ‡ä»¤ï¼Œå«åšfast_invokevfinalï¼Œä¸éœ€è¦æŸ¥vtableå°±å¯ä»¥è°ƒç”¨åˆ°ç›®æ ‡æ–¹æ³•ï¼ˆä¸è¿‡ç›®å‰åœ¨x86ä¸ŠHotSpotå¹¶æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªä¼˜åŒ–ï¼‰ã€‚SPARCä¸Šçš„ä¾‹å­çœ‹è¿™é‡Œï¼šjdk8u/jdk8u/hotspot: d109bda16490 src/cpu/sparc/vm/templateTable_sparc.cppè€Œåœ¨JITç¼–è¯‘å™¨é‡Œè¿™ç§invokevirtualä¹Ÿä¼šè¢«çœ‹ä½œè·Ÿinvokespecialä¸€æ ·æ¥å¤„ç†ã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­å¯ä»¥çœ‹C1è¿™é‡Œï¼šjdk8u/jdk8u/hotspot: d109bda16490 src/share/vm/c1/c1_GraphBuilder.cpp é™æ€è§£æçš„æ–¹æ³•è°ƒç”¨ç§°ä¸ºè§£æè°ƒç”¨ï¼Œè¿˜æœ‰ä¸€ç§è°ƒç”¨æ–¹å¼ï¼Œç§°ä¸º åˆ†æ´¾è°ƒç”¨ï¼ˆDispatchï¼‰ 3.2 åˆ†æ´¾è°ƒç”¨å³å°†è¦è®²çš„åˆ†æ´¾è°ƒç”¨ï¼Œå…¶å®å›Šæ‹¬äº†è§£æè°ƒç”¨çš„æ­¥éª¤ï¼Œè§£æä¸åˆ†æ´¾å¹¶ä¸æ˜¯æ’ä»–äº’æ–¥çš„å…³ç³»ï¼Œè€Œæ˜¯ä¸åŒå±‚æ¬¡ä¸Šç­›é€‰å’Œç¡®å®šç›®æ ‡æ–¹æ³•çš„è¿‡ç¨‹ï¼ŒäºŒè€…æ˜¯è”åˆèµ·æ¥ä¸€èµ·ä½¿ç”¨çš„ï¼Œè¿™é‡Œçš„åˆ†æ´¾æ›´å¤šçš„æ˜¯æ­ç¤ºå¤šæ€æ€§çš„ç‰¹å¾ã€‚ã€Œå¥½å­ï¼Œè¿™ä¸€å—å…¶å®æˆ‘æ˜¯æœ‰ç‚¹ä¸èµåŒçš„ï¼Œæˆ‘è§‰å¾—å°±æ˜¯æœ‰ç‚¹äº’æ–¥çš„æ„Ÿè§‰å•Šï¼Œä¸€ä¸ªæ˜¯ç”¨åœ¨éè™šå‡½æ•°ï¼Œä¸€ä¸ªç”¨åœ¨äº†è™šå‡½æ•°ã€‚ã€ 3.2.1 é™æ€åˆ†æ´¾ â€” é‡è½½ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å¤šæ€ä¸­çš„é‡è½½è¿‡ç¨‹ã€‚è™šæ‹Ÿæœºï¼ˆå‡†ç¡®çš„è¯´æ˜¯ç¼–è¯‘æœŸï¼‰åœ¨é‡è½½æ—¶æ˜¯é€šè¿‡å‚æ•°çš„é™æ€ç±»å‹è€Œä¸æ˜¯å®é™…ç±»å‹ä½œä¸ºåˆ¤å®šä¾æ®çš„ã€‚å¹¶ä¸”ç”±äºé™æ€ç±»å‹åœ¨ç¼–è¯‘æœŸé—´å°±å¯çŸ¥ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æœŸé—´ï¼Œjavac ç¼–è¯‘æœŸå°±æ ¹æ®å‚æ•°çš„é™æ€ç±»å‹å†³å®šäº†ä½¿ç”¨å“ªä¸ªé‡è½½ç‰ˆæœ¬ã€‚ æ‰€æœ‰ä¾èµ–é™æ€ç±»å‹æ¥å®šä½æ–¹æ³•æ‰§è¡Œç‰ˆæœ¬çš„åˆ†æ´¾åŠ¨ä½œï¼Œå°±ç§°ä¸ºé™æ€åˆ†æ´¾ï¼Œæœ€å…¸å‹çš„å°±æ˜¯æ–¹æ³•é‡è½½ï¼Œå› æ­¤ç¡®å®šé™æ€åˆ†æ´¾çš„åŠ¨ä½œå®é™…ä¸Šå¹¶ä¸æ˜¯ç”±jvmæ¥å®Œæˆçš„ã€‚å¦å¤–ï¼Œç¼–è¯‘æœŸè™½ç„¶èƒ½å¤Ÿç¡®å®šå‡ºæ–¹æ³•çš„é‡è½½ç‰ˆæœ¬ï¼Œä½†æ˜¯åœ¨å¾ˆå¤šæƒ…å†µä¸‹è¿™ä¸ªé‡è½½ç‰ˆæœ¬å¹¶ä¸æ˜¯â€œå”¯ä¸€çš„â€ï¼Œå¾€å¾€åªèƒ½å»ç¡®å®šä¸€ä¸ªâ€œæ›´åŠ åˆé€‚çš„â€ç‰ˆæœ¬ï¼Œç”šè‡³æœ‰çš„æ—¶å€™ä¼šå› ä¸ºç±»å‹ä¸æ˜ç¡®ï¼Œé€‰æ‹©è¿‡å¤šï¼ˆå®ç°çš„æ¥å£å¾ˆå¤šï¼‰ï¼Œè€Œå¯¼è‡´æŠ¥é”™ã€‚ å½“ç„¶ï¼Œè¿™é‡Œå¾—æ˜ç¡®ä¸€ä¸‹é™æ€ç±»å‹å’Œå®é™…ç±»å‹çš„æ¦‚å¿µã€‚ Human human = new Man() å›ºå®šå¯¹è±¡.æ–¹æ³•(human) é™æ€ç±»å‹ï¼šå˜é‡ human çš„é™æ€ç±»å‹ä¸º Human åŠ¨æ€ç±»å‹ï¼šå˜é‡ human çš„åŠ¨æ€ç±»å‹ä¸º Man ç®€å•è®°å¿†ï¼Œé‡è½½å°±æ˜¯åŒä¸€ä¸ªç±»ä¸‹åŒåæ–¹æ³•å‚æ•°ä¸åŒï¼Œæ‰€ä»¥å†³å®šæƒåœ¨å‚æ•°ï¼Œå¦‚æœå‚æ•°ä¸ªæ•°ç›¸åŒï¼Œé‚£å†³å®šæƒå°±æ˜¯å‚æ•°çš„ç±»å‹ï¼Œè€Œå‚æ•°çš„ç±»å‹åœ¨ç¼–è¯‘æœŸé—´å°±å·²ç»ç¡®å®šäº†ï¼Œæ˜¯ç”±å…¶é™æ€ç±»å‹å†³å®šçš„ã€‚ 3.2.2 åŠ¨æ€åˆ†æ´¾ â€” é‡å†™é‡å†™è·Ÿé‡è½½å¾ˆä¸ä¸€æ ·ï¼Œé‡å†™æ˜¯ç±»å¯¹æ¥å£æˆ–çˆ¶ç±»æ–¹æ³•çš„é‡å†™ï¼Œè¿™ä¸ªæ—¶å€™å¯¹è±¡éƒ½ä¸ä¸€æ ·äº†ï¼Œæ‰€ä»¥ä¼šç”¨åˆ°å®é™…ç±»å‹ã€‚ People human = new Human(); human.æ–¹æ³•() ç®€å•è®°å¿†ï¼Œé‡å†™å°±æ˜¯ä¸€ä¸ªç±»è¦†ç›–äº†æ¥å£æˆ–è€…çˆ¶ç±»çš„æ–¹æ³•ï¼Œæ­¤æ—¶çš„å˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸æ˜¯ä¸Šæ–‡çš„å‚æ•°ï¼Œæ‰€ä»¥æ­¤æ—¶è‚¯å®šå°±æ˜¯ç”±åŠ¨æ€ç±»å‹å†³å®šäº†ã€‚ 3.2.3 å•åˆ†æ´¾å’Œå¤šåˆ†æ´¾å®—é‡ï¼šæ–¹æ³•çš„æ¥æ”¶è€…ä¸æ–¹æ³•çš„å‚æ•°ç»Ÿç§°ä¸ºæ–¹æ³•çš„å®—é‡ã€‚ é™æ€åˆ†æ´¾æ˜¯å¤šåˆ†æ´¾ç±»å‹ï¼ŒåŠ¨æ€åˆ†æ´¾æ˜¯å•åˆ†æ´¾ç±»å‹â€¦ã€Œå¥½ç»•å•Šâ€¦ä¸å¤ªæ‡‚â€¦ã€ æ€»è€Œè¨€ä¹‹ï¼Œé™æ€å¤šåˆ†æ´¾ã€åŠ¨æ€å•åˆ†æ´¾ã€‚ã€‚ã€‚ã€‚ 3.2.4 åŠ¨æ€å•åˆ†æ´¾çš„å®ç°ä¼˜åŒ–ç”±äºåŠ¨æ€å•åˆ†æ´¾æ˜¯éå¸¸é¢‘ç¹çš„åŠ¨ä½œï¼Œæ‰€ä»¥åŸºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œä»¥ç©ºé—´æ¢æ—¶é—´ï¼Œæœ€å¸¸ç”¨çš„â€œç¨³å®šä¼˜åŒ–â€æ‰‹æ®µå°±æ˜¯åœ¨æ–¹æ³•åŒºä¸­å»ºç«‹ä¸€ä¸ª è™šæ–¹æ³•è¡¨ã€‚å¦‚æœå­ç±»é‡å†™äº†çˆ¶ç±»æ–¹æ³•ï¼Œåˆ™ä¸¤è€…å¯¹è±¡çš„æ–¹æ³•çš„å…¥å£åœ°å€ä¸ä¸€æ ·ï¼Œå¦‚æœå­ç±»æ²¡æœ‰é‡å†™ï¼Œåˆ™éƒ½æŒ‡å‘çˆ¶ç±»çš„æ–¹æ³•çš„å…¥å£åœ°å€ã€‚ é™¤äº†å»ºç«‹è™šæ–¹æ³•è¡¨ï¼Œè¿˜ä¼šä½¿ç”¨ â€œå†…è”ç¼“å­˜â€ å’Œ åŸºäº â€œç±»å‹ç»§æ‰¿å…³ç³»åˆ†æâ€ æŠ€æœ¯çš„å®ˆæŠ¤å†…è”ä¸¤ç§éç¨³å®šçš„ä¼˜åŒ–æ–¹å¼ã€‚ 4. åŸºäºæ ˆçš„å­—èŠ‚ç è§£é‡Šæ‰§è¡Œå¼•æ“ä¸Šä¸€èŠ‚è®²å®Œäº†å¦‚ä½•è°ƒç”¨æ–¹æ³•ï¼Œè¿™ä¸€èŠ‚è®²å¦‚ä½•æ‰§è¡Œæ–¹æ³•å†…çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚æ‰§è¡Œæ–¹æ³•å†…çš„å­—èŠ‚ç æŒ‡ä»¤æœ‰ä¸¤ç§æ–¹æ³•ï¼šé€šè¿‡è§£é‡Šå™¨è§£é‡Šæ‰§è¡Œ å’Œ é€šè¿‡ JIT ç­‰å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼Œä¸‹é¢è®²ä¸€ä¸‹ç¬¬ä¸€ç§ï¼šåŸºäºæ ˆçš„å­—èŠ‚ç è§£é‡Šæ‰§è¡Œã€‚ Java ç¼–è¯‘å™¨è¾“å‡ºçš„æŒ‡ä»¤æµï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ç§åŸºäºæ ˆçš„æŒ‡ä»¤é›†æ¶æ„ï¼ŒæŒ‡ä»¤æµé‡Œé¢çš„æŒ‡ä»¤å¤§éƒ¨åˆ†éƒ½æ˜¯é›¶åœ°å€æŒ‡ä»¤ï¼Œå› ä¸ºéƒ½ä¾èµ–æ“ä½œæ•°æ ˆè¿›è¡Œå·¥ä½œã€‚è€Œä¸»æµçš„åŸºäºå¯„å­˜å™¨çš„æŒ‡ä»¤é›†ä¸€èˆ¬éƒ½æ˜¯äºŒåœ°å€æŒ‡ä»¤é›†ã€‚ åŸºäºæ ˆçš„æŒ‡ä»¤é›†æœ€å¤§ä¼˜ç‚¹å°±æ˜¯å¯ç§»æ¤æ€§ï¼Œç¼–è¯‘å™¨å®ç°æ›´ç®€å•ã€ä»£ç æ›´ç´§å‡‘â€¦ä½†æ˜¯ç¼ºç‚¹å°±æ˜¯æ…¢,è€Œä¸”è¦é¢‘ç¹çš„å…¥æ ˆå‡ºæ ˆï¼Œæ„å‘³ç€é¢‘ç¹è®¿é—®å†…å­˜ï¼Œé€Ÿåº¦å°±ä¸‹æ¥äº†ï¼Œè™½ç„¶å¯ä»¥é‡‡ç”¨æ ˆé¡¶ç¼“å­˜ï¼Œä½†æ˜¯æ¯•ç«Ÿæ²»æ ¹ä¸æ²»æœ¬â€¦ ç¬¬ä¹ç«  ç±»åŠ è½½åŠæ‰§è¡Œå­ç³»ç»Ÿçš„æ¡ˆä¾‹ä¸å®æˆ˜åœ¨ Class æ–‡ä»¶æ ¼å¼å’Œæ‰§è¡Œå¼•æ“æ“ä½œè¿™éƒ¨åˆ†é‡Œï¼ŒåŸºæœ¬éƒ½æ˜¯æœ‰è™šæ‹Ÿæœºç›´æ¥æ§åˆ¶ï¼Œç”¨æˆ·ç¨‹åºæ— æ³•å¯¹å…¶è¿›è¡Œæ”¹å˜ã€‚èƒ½é€šè¿‡ç¨‹åºè¿›è¡Œæ“ä½œçš„ï¼Œä¸»è¦æ˜¯å­—èŠ‚ç ç”Ÿæˆä¸ç±»åŠ è½½å™¨è¿™ä¸¤éƒ¨åˆ†çš„åŠŸèƒ½ã€‚ ç±»åŠ è½½å™¨çš„å¢å¼º ä¸»è¦æ˜¯ TomcatæœåŠ¡å™¨çš„ç±»åŠ è½½å™¨ å’Œ OSGi è¿™ä¸ªçµæ´»çš„ç±»åŠ è½½å™¨æ¶æ„ å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯ä¸åŠ¨æ€ä»£ç†çš„å®ç° åŒ…æ‹¬ javacã€AOPã€åŠ¨æ€ä»£ç†ã€åå°„ç­‰éƒ½ç”¨åˆ°äº†å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯ã€‚ ç¬¬åç«  æ—©æœŸï¼ˆç¼–è¯‘æœŸï¼‰ä¼˜åŒ–1. æ¦‚è¿°ç¼–è¯‘æœŸï¼Œåœ¨ java é‡Œåˆ†ä¸ºä¸‰ç±»ï¼Œ ä¸€ç±»æ˜¯ä» .java æ–‡ä»¶ è½¬å˜ä¸º .class æ–‡ä»¶çš„è¿‡ç¨‹ï¼Œè¿™æ˜¯å‰ç«¯ç¼–è¯‘çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¹‹å‰æåˆ°çš„ç¼–è¯‘å™¨éƒ½æ˜¯æŒ‡è¿™ä¸ªã€‚ä½¿ç”¨åˆ°çš„å‰ç«¯ç¼–è¯‘å™¨ä¸€èˆ¬å°±æ˜¯ javacã€‚ è¿˜æœ‰æŒ‡è™šæ‹Ÿæœºçš„åç«¯è¿è¡ŒæœŸç¼–è¯‘ï¼ŒæŠŠå­—èŠ‚ç è½¬å˜æˆæœºå™¨ç çš„è¿‡ç¨‹ã€‚ä½¿ç”¨åˆ°çš„åç«¯è¿è¡ŒæœŸç¼–è¯‘å™¨æœ‰ JITç¼–è¯‘å™¨ï¼ˆJust In Time Compilerï¼‰ã€‚ è¿˜æœ‰ä¸€ç±»å¾ˆå°‘è§ï¼Œç§°ä¸ºé™æ€æå‰ç¼–è¯‘å™¨ï¼ˆAOTç¼–è¯‘å™¨ï¼ŒAhead Of Time Compilerï¼‰ç›´æ¥æŠŠ *.java æ–‡ä»¶ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ä»£ç çš„è¿‡ç¨‹ã€‚ å¯¹äº Javac ç¼–è¯‘å™¨æ¥è¯´ï¼Œå¯¹ä»£ç çš„è¿è¡Œæ•ˆç‡æ²¡æœ‰ä¼˜åŒ–æªæ–½ï¼Œä½†æ˜¯å¯¹ç¨‹åºå‘˜çš„ç¼–ç é£æ ¼å’Œç¼–ç æ•ˆç‡åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå¯¹äº JIT æ¥è¯´ï¼Œå¯¹ç¨‹åºä¼˜åŒ–åšäº†å¾ˆå¤šä¼˜åŒ–ã€‚ 2. Javac ç¼–è¯‘å™¨2.1 ç¼–è¯‘è¿‡ç¨‹ç¼–è¯‘è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹ï¼š è§£æä¸å¡«å……ç¬¦å·è¡¨çš„è¿‡ç¨‹ï¼› æ’å…¥å¼æ³¨è§£å¤„ç†å™¨çš„æ³¨è§£å¤„ç†è¿‡ç¨‹ï¼› è¯­ä¹‰åˆ†æä¸å­—èŠ‚ç ç”Ÿæˆè¿‡ç¨‹ã€‚ 2.2 è§£æä¸å¡«å……ç¬¦å·è¡¨è§£ææ­¥éª¤ ç”± parseFiles() æ–¹æ³•å®Œæˆï¼ŒåŒ…æ‹¬äº†è¯æ³•åˆ†æã€è¯­æ³•åˆ†æï¼› è¯æ³•åˆ†æå°±æ˜¯å°†æºä»£ç çš„å­—ç¬¦æµè½¬å˜ä¸ºæ ‡è®°ï¼ˆTokenï¼‰é›†åˆï¼Œè¯æ³•åˆ†æè¿‡ç¨‹ç”± com.sun.tools.javac.parser.Scanner ç±»å®ç°ï¼› è¯­æ³•åˆ†æå°±æ˜¯æ ¹æ® Token åºåˆ—æ¥æ„é€ æŠ½è±¡è¯­æ³•æ ‘çš„è¿‡ç¨‹ï¼ŒæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼ŒAbstract Syntax Treeï¼‰æ˜¯ä¸€ç§ç”¨æ¥æè¿°ç¨‹åºä»£ç è¯­æ³•ç»“æ„çš„æ ‘å½¢è¡¨ç¤ºæ–¹æ³•ã€‚ å¡«å……ç¬¦å·è¡¨ç¬¦å·è¡¨ï¼ˆSymbol Tableï¼‰æ˜¯ä¸€ç»„ç”±ç¬¦å·åœ°å€å’Œç¬¦å·ä¿¡æ¯æ„æˆçš„è¡¨æ ¼ï¼Œç±»ä¼¼äºé”®å€¼å¯¹å½¢å¼ã€‚ ç¬¦å·è¡¨ä¸­æ‰€ç™»è®°çš„ä¿¡æ¯åœ¨ç¼–è¯‘çš„ä¸åŒé˜¶æ®µéƒ½è¦ç”¨åˆ°ã€‚åœ¨è¯­ä¹‰åˆ†æä¸­ï¼Œç¬¦å·è¡¨æ‰€ç™»è®°çš„å†…å®¹å°†ç”¨äºè¯­ä¹‰æ£€æŸ¥å’Œäº§ç”Ÿä¸­é—´ä»£ç ã€‚åœ¨ç›®æ ‡ä»£ç ç”Ÿæˆé˜¶æ®µï¼Œå½“å¯¹ç¬¦å·è¡¨è¿›è¡Œåœ°å€åˆ†é…æ—¶ï¼Œç¬¦å·è¡¨æ˜¯åœ°å€åˆ†é…çš„ä¾æ®ã€‚ç”± com.sun.tools.javac.comp.Enter ç±»å®ç°ã€‚ 2.3 æ³¨è§£å¤„ç†å™¨ç±»ä¼¼äºç¼–è¯‘å™¨çš„æ’ä»¶ã€‚æ’å…¥å¼æ³¨è§£å¤„ç†å™¨çš„åˆå§‹è¿‡ç¨‹æ˜¯åœ¨ initPorcessAnnotations() æ–¹æ³•ä¸­å®Œæˆçš„ï¼Œè€Œæ‰§è¡Œè¿‡ç¨‹æ˜¯åœ¨ processAnnotations() æ–¹æ³•ä¸­å®Œæˆçš„ã€‚ 2.4 è¯­ä¹‰åˆ†æä¸å­—èŠ‚ç ç”Ÿæˆè¯­æ³•åˆ†æä¹‹åï¼Œç¼–è¯‘å™¨è·å¾—äº†ç¨‹åºä»£ç çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œè¯­æ³•æ ‘èƒ½è¡¨ç¤ºä¸€ä¸ªç»“æ„æ­£ç¡®çš„æºç¨‹åºçš„æŠ½è±¡ï¼Œä½†æ˜¯å´æ— æ³•ä¿è¯æºç¨‹åºæ˜¯ç¬¦åˆé€»è¾‘çš„ã€‚è€Œè¯­ä¹‰åˆ†æçš„ä¸»è¦ä»»åŠ¡å°±æ˜¯å¯¹ç»“æ„ä¸Šæ­£ç¡®çš„æºç¨‹åºè¿›è¡Œä¸Šä¸‹æ–‡æœ‰å…³æ€§è´¨çš„å®¡æŸ¥ã€‚ è¯­ä¹‰åˆ†æçš„å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š æ ‡è®°æ£€æŸ¥ï¼šæ£€æŸ¥è¯¸å¦‚å˜é‡ä½¿ç”¨å‰æ˜¯å¦å·²ç»è¢«å£°æ˜ã€å˜é‡ä¸èµ‹å€¼ä¹‹é—´çš„æ•°æ®ç±»å‹èƒ½å¤ŸåŒ¹é…ç­‰ç­‰ï¼› æ•°æ®åŠæ§åˆ¶æµåˆ†æï¼šå››é˜Ÿä¸Šä¸‹æ–‡é€»è¾‘æ›´è¿›ä¸€æ­¥çš„éªŒè¯ï¼Œå¯ä»¥ç›‘å¯Ÿå¤„è¯¸å¦‚ç¨‹åºå±€éƒ¨å˜é‡åœ¨ä½¿ç”¨å‰æ˜¯å¦æœ‰èµ‹å€¼ã€æ–¹æ³•çš„æ¯æ¡è·¯å¾„æ˜¯å¦éƒ½æœ‰è¿”å›å€¼ã€æ˜¯å¦æ‰€æœ‰çš„å—æŸ¥å¼‚å¸¸éƒ½è¢«æ­£ç¡®å¤„ç†äº†ç­‰é—®é¢˜ã€‚ è§£è¯­æ³•ç³–ï¼šè¯­æ³•ç³–ï¼Œä¹Ÿç§°ç³–è¡£è¯­æ³•ï¼ŒæŒ‡çš„æ˜¯åœ¨è®¡ç®—æœºè¯­è¨€ä¸­æ·»åŠ çš„æŸç§è¯­æ³•ï¼Œè¿™ç§è¯­æ³•å¯¹è¯­è¨€çš„åŠŸèƒ½å¹¶æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯ä¼šæ›´æ–¹ä¾¿ç¨‹åºå‘˜ä½¿ç”¨ã€‚é€šå¸¸æ¥è¯´è¯­æ³•ç³–èƒ½å¤Ÿå¢åŠ ç¨‹åºçš„å¯è¯»æ€§ï¼Œå‡å°‘ç¨‹åºå‡ºé”™çš„æœºä¼šã€‚ç”± desugar() æ–¹æ³•è§¦å‘ã€‚ å­—èŠ‚ç ç”Ÿæˆï¼Œè¿™æ˜¯ç¼–è¯‘è¿‡ç¨‹çš„æœ€åä¸€ä¸ªé˜¶æ®µï¼ŒæŠŠå‰é¢å„ä¸ªæ­¥éª¤ç”Ÿæˆçš„ä¿¡æ¯ï¼ˆè¯­æ³•æ ‘ã€ç¬¦å·è¡¨ï¼‰è½¬æ¢æˆå­—èŠ‚ç å†™åˆ°ç£ç›˜å»ï¼Œè¿˜è¿›è¡Œäº†å°‘é‡çš„ä»£ç æ·»åŠ å’Œè½¬æ¢å·¥ä½œï¼Œä¾‹å¦‚ä¹‹å‰ä¸€ç›´æ²¡æœ‰è§£å†³çš„ ç±»æ„é€ å™¨ \ è¿˜è¦ å®ä¾‹æ„é€ å™¨ \æ–¹æ³•ã€Œè¿™é‡Œçš„å®ä¾‹æ„é€ å™¨ä¸æ˜¯é»˜è®¤çš„æ„é€ å™¨ã€å°±æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µè¢«æ·»åŠ åˆ°è¯­æ³•æ ‘ä¹‹ä¸­å»çš„ã€‚ 3. Java è¯­æ³•ç³–çš„å‘³é“3.1 æ³›å‹æœ¬è´¨æ˜¯å‚æ•°åŒ–ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æ“ä½œçš„æ•°æ®ç±»å‹è¢«æŒ‡å®šä¸ºä¸€ä¸ªå‚æ•°ï¼Œè¿™ç§å‚æ•°ç±»å‹å¯ä»¥ç”¨åœ¨ç±»ã€æ¥å£ã€æ–¹æ³•çš„åˆ›å»ºä¸­ï¼Œåˆ†ä¸ºæ³›å‹ç±»ã€æ³›å‹æ¥å£ã€æ³›å‹æ–¹æ³•ã€‚ java é‡Œé¢çš„æ³›å‹æ˜¯ä¼ªæ³›å‹ï¼Œå¹¶ä¸æ˜¯åƒ C++ ä¸€æ ·çœŸæ­£çš„æ³›å‹ï¼ŒJava é‡Œé¢çš„æ³›å‹å®ç°æ–¹å¼ç§°ä¸º ç±»å‹æ“¦é™¤ã€‚ 12345678910import java.util.List;public class Test &#123; public static void method(List&lt;Integer&gt; list)&#123; System.out.println("Integer çš„æ³›å‹"); &#125; public static void method(List&lt;String&gt; list)&#123; System.out.println("String çš„æ³›å‹"); &#125;&#125; è¿™æ ·çš„å†™æ³•åœ¨ idea ä¸­å¹¶ä¸èƒ½é€šè¿‡ï¼Œä¼šæç¤ºä¸¤ä¸ªæ–¹æ³•ä¸€æ ·ï¼Œæ— æ³•é‡è½½ï¼ŒåŸå› å°±æ˜¯åœ¨ç¼–è¯‘æ—¶å°±ä¼šå°†ä¸¤è€…çš„æ³›å‹æ“¦é™¤ã€‚ 3.2 è‡ªåŠ¨è£…ç®±ã€æ‹†ç®±ã€éå†å¾ªç¯123456789101112131415161718192021222324252627282930313233import java.util.Arrays;import java.util.Iterator;import java.util.List;/** * è‡ªåŠ¨è£…ç®±ã€æ‹†ç®±ã€éå†å¾ªç¯ */public class Test &#123; public static void main(String[] args) &#123; // è‡ªåŠ¨è£…ç®±ã€æ‹†ç®±ã€éå†å¾ªç¯çš„è¯­æ³•ç³– List&lt;Integer&gt; list1 = Arrays.asList(1,2,3,4); // æˆ–è€…å†™æˆ List&lt;Integer&gt; list = [1,2,3,4]; int sum1 = 0; for(int i : list1)&#123; sum1 = sum1 + i; &#125; System.out.println(sum1); // ç¼–è¯‘ä¹‹åçš„åŸæ · List list2 = Arrays.asList(new Integer[]&#123; Integer.valueOf(1), Integer.valueOf(2), Integer.valueOf(3), Integer.valueOf(4), &#125;); int sum2 = 0; Iterator localIterator = list2.iterator(); while(localIterator.hasNext())&#123; sum2 = sum2 + ((Integer) localIterator.next()).intValue(); &#125; System.out.println(sum2); &#125;&#125; 123456789101112131415161718192021/** * è‡ªåŠ¨è£…ç®±çš„é™·é˜± */class Test2&#123; public static void main(String[] args) &#123; Integer a = 1; Integer b = 2; Integer c = 3; Integer d = 3; Integer e = 321; Integer f = 321; Long g = 3L; System.out.println(c == d); // true System.out.println(e == f); // false System.out.println(c == (a + b)); // true System.out.println(c.equals(a + b)); // true// System.out.println(g == d); // æŠ¥é”™ï¼Œå› ä¸º == ä¸ä¼šè‡ªåŠ¨æ‹†ç®±ï¼Œåªæœ‰é‡åˆ°äº†ç®—æœ¯è¿ç®—æ‰ä¼šæ‹†ç®± System.out.println(g == (a + b)); // true System.out.println(g.equals(a + b)); // falseï¼Œè™½ç„¶ equals()ä¼šè‡ªåŠ¨æ‹†ç®±ï¼Œä½†æ˜¯ä¸ä¼šå¤„ç†æ•°æ®è½¬å‹çš„é—®é¢˜ &#125;&#125; Tip: Integer çš„ç¼“å­˜é—®é¢˜ï¼Œä¹‹å‰åˆ· LeetCode å°±å·²ç»é‡åˆ°è¿‡äº†ã€‚è¿™é‡Œå†æåŠä¸€æ¬¡ï¼ å…·ä½“çš„ Integer å’Œ int çš„åŒºåˆ«è§ â€œé›¶ç¢çŸ¥è¯†ç‚¹â€ è¿™ç¯‡æ–‡ç« ï¼ ç¬¬åä¸€ç«  æ™šæœŸï¼ˆè¿è¡ŒæœŸï¼‰ä¼˜åŒ–1. æ¦‚è¿°å³æ—¶ç¼–è¯‘å™¨ï¼ˆJust In Time Compilerï¼‰ï¼Œä¹Ÿç§°ä¸º JIT ç¼–è¯‘å™¨ï¼Œå®ƒçš„ä¸»è¦å·¥ä½œæ˜¯æŠŠçƒ­ç‚¹ä»£ç ç¼–è¯‘æˆä¸æœ¬åœ°å¹³å°ç›¸å…³çš„æœºå™¨ç ï¼Œå¹¶è¿›è¡Œå„ç§å±‚æ¬¡çš„ä¼˜åŒ–ï¼Œä»è€Œæé«˜ä»£ç æ‰§è¡Œçš„æ•ˆç‡ã€‚å®ƒå¹¶ä¸æ˜¯å¿…éœ€çš„ã€‚ é‚£ä¹ˆä»€ä¹ˆæ˜¯çƒ­ç‚¹ä»£ç å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“è™šæ‹Ÿæœºé€šè¿‡è§£é‡Šå™¨ï¼ˆInterpreterï¼‰æ¥æ‰§è¡Œå­—èŠ‚ç æ–‡ä»¶ï¼Œå½“è™šæ‹Ÿæœºå‘ç°æŸä¸ªæ–¹æ³•æˆ–ä»£ç å—çš„è¿è¡Œç‰¹åˆ«é¢‘ç¹æ—¶ï¼Œå°±ä¼šæŠŠè¿™äº›ä»£ç è®¤å®šä¸ºâ€œçƒ­ç‚¹ä»£ç â€ï¼ˆHot Spot Codeï¼‰ã€‚ å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ€§èƒ½çš„å¥½åã€ä»£ç ä¼˜åŒ–ç¨‹åº¦çš„é«˜ä½æ˜¯è¡¡é‡ä¸€æ¬¾å•†ç”¨è™šæ‹Ÿæœºä¼˜ç§€ä¸å¦çš„å…³é”®æŒ‡æ ‡ä¹‹ä¸€ï¼Œå®ƒä¹Ÿæ˜¯è™šæ‹Ÿæœºæœ€æ ¸å¿ƒä¸”æœ€èƒ½ä½“ç°æŠ€æœ¯æ°´å¹³çš„éƒ¨åˆ†ã€‚ 2. HotSpotè™šæ‹Ÿæœºå†…çš„å³æ—¶ç¼–è¯‘å™¨2.1 è§£é‡Šå™¨ä¸ç¼–è¯‘å™¨HotSpot è™šæ‹ŸæœºåŒ…å«è§£é‡Šå™¨å’Œç¼–è¯‘å™¨ã€‚å®ƒä»¬æ˜¯æ€ä¹ˆæ­é…å·¥ä½œçš„å‘¢ï¼Ÿå½“ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œè§£é‡Šå™¨é¦–å…ˆå‘æŒ¥ä½œç”¨ï¼Œå®ƒèƒ½ç›´æ¥è¿è¡Œå­—èŠ‚ç æ–‡ä»¶ï¼›éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¶Šæ¥è¶Šå¤šçš„çƒ­ç‚¹ä»£ç è¢«ç¼–è¯‘å™¨ç¼–è¯‘æˆæœºå™¨ç ï¼Œä»è€Œè·å–æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚åŒæ—¶ï¼Œè§£é‡Šå™¨è¿˜å¯ä»¥ä½œä¸ºç¼–è¯‘å™¨æ¿€è¿›ä¼˜åŒ–æ—¶çš„ä¸€ä¸ªâ€œé€ƒç”Ÿé—¨â€ï¼Œå½“ç¼–è¯‘å™¨çš„æ¿€è¿›ä¼˜åŒ–æ‰‹æ®µä¸æˆç«‹æ—¶ï¼Œå¦‚åŠ è½½äº†æ–°ç±»åç±»å‹ç»§æ‰¿ç»“æ„å‡ºç°å˜åŒ–ç­‰ï¼Œå¯ä»¥é€šè¿‡é€†ä¼˜åŒ–ï¼ˆDeoptimizationï¼‰é€€å›åˆ°è§£é‡ŠçŠ¶æ€ç»§ç»­ç”±è§£é‡Šå™¨æ‰§è¡Œã€‚è§£é‡Šå™¨ä¸ç¼–è¯‘å™¨çš„äº¤äº’å¦‚å›¾æ‰€ç¤ºï¼š HotSpotä¸­çš„ç¼–è¯‘å™¨åˆåˆ†ä¸ºä¸¤ç§ï¼ŒC1 ç¼–è¯‘å™¨ï¼ˆClient Compilerï¼‰å’Œ C2 ç¼–è¯‘å™¨ï¼ˆServer Compilerï¼‰ï¼ŒHotSpot è™šæ‹Ÿæœºä¼šé€‰æ‹©å“ªä¸ªç¼–è¯‘å™¨æ˜¯ç”±è™šæ‹Ÿæœºè¿è¡Œäº Client æ¨¡å¼è¿˜æ˜¯ Server æ¨¡å¼å†³å®šçš„ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œè™šæ‹Ÿæœºé‡‡ç”¨è§£é‡Šå™¨å’Œä¸€ç§ç¼–è¯‘å™¨æ­é…çš„æ–¹å¼å·¥ä½œï¼Œä½†æ˜¯åœ¨åˆ†å±‚ç¼–è¯‘ç­–ç•¥ä¸‹ï¼ŒC1 ç¼–è¯‘å™¨å’Œ C2 ç¼–è¯‘å™¨å°†ä¼šåŒæ—¶å·¥ä½œï¼Œåˆ†å±‚ç¼–è¯‘æ ¹æ®ç¼–è¯‘å™¨ç¼–è¯‘ã€ä¼˜åŒ–çš„è§„æ¨¡å’Œè€—æ—¶ï¼Œåˆ’åˆ†å‡ºä¸åŒçš„ç¼–è¯‘å±‚æ¬¡ï¼š ç¬¬0å±‚ï¼šç¨‹åºè§£é‡Šæ‰§è¡Œï¼Œè§£é‡Šå™¨ä¸å¼€å¯æ€§èƒ½ç›‘æ§åŠŸèƒ½ï¼Œè§¦å‘ C1 ç¼–è¯‘ã€‚ ç¬¬1å±‚ï¼šC1 ç¼–è¯‘ï¼Œå°†å­—èŠ‚ç ç¼–è¯‘æˆæœ¬åœ°ä»£ç ï¼Œè¿›è¡Œç®€å•ã€å¯é çš„ä¼˜åŒ–ï¼Œå¦‚æœ‰å¿…è¦è§£é‡Šå™¨å°†å¼€å§‹æ€§èƒ½ç›‘æ§ã€‚ ç¬¬2å±‚ï¼šC2 ç¼–è¯‘ï¼Œå°†å­—èŠ‚ç ç¼–è¯‘æˆæœ¬åœ°ä»£ç ï¼Œå¯ç”¨ä¸€äº›ç¼–è¯‘è€—æ—¶è¾ƒé•¿çš„ä¼˜åŒ–ï¼Œç”šè‡³ä¼šæ ¹æ®æ€§èƒ½ç›‘æ§ä¿¡æ¯è¿›è¡Œä¸€äº›ä¸å¯é çš„æ¿€è¿›ä¼˜åŒ–ã€‚ tipsï¼š ä½¿ç”¨ â€œ-clientâ€ å¼ºåˆ¶è™šæ‹Ÿæœºè¿è¡Œäº Client æ¨¡å¼ã€‚ ä½¿ç”¨ â€œ-serverâ€ å¼ºåˆ¶è™šæ‹Ÿæœºè¿è¡Œäº Server æ¨¡å¼ã€‚ ä½¿ç”¨ â€œ-Xintâ€ å¼ºåˆ¶è™šæ‹Ÿæœºåªä½¿ç”¨è§£é‡Šå™¨æ‰§è¡Œç¨‹åºï¼Œç¼–è¯‘å™¨ä¸å·¥ä½œã€‚ ä½¿ç”¨ â€œ-Xcompâ€ å¼ºåˆ¶è™šæ‹Ÿæœºåªä½¿ç”¨ç¼–è¯‘å™¨æ‰§è¡Œç¨‹åºï¼Œè§£é‡Šå™¨ä½œä¸ºç¼–è¯‘å™¨çš„â€œé€ƒç”Ÿé—¨â€ã€‚ ä½¿ç”¨ â€œ-XX:+TieredCompilationâ€ å¼€å¯åˆ†å±‚ç¼–è¯‘ã€‚è™šæ‹Ÿæœº Server æ¨¡å¼ä¸‹é»˜è®¤å¼€å¯ã€‚ 2.2 ç¼–è¯‘å¯¹è±¡ä¸è§¦å‘æ¡ä»¶â€œçƒ­ç‚¹ä»£ç â€ åˆ†ä¸ºä¸¤ç±»ï¼š è¢«å¤šæ¬¡è°ƒç”¨çš„æ–¹æ³•ï¼›ã€Œæ™®é€šçš„ç¼–è¯‘è¯·æ±‚ã€ã€Œæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ã€ è¢«å¤šæ¬¡æ‰§è¡Œçš„å¾ªç¯ä½“ã€‚ã€ŒOSRç¼–è¯‘è¯·æ±‚ã€ã€Œå›è¾¹è®¡æ•°å™¨ã€ è¦æµ‹è¯•å…¶æˆä¸ºâ€œçƒ­ç‚¹ä»£ç â€ï¼Œæœ‰ä¸¤ç§æ¯”è¾ƒä¸»æµçš„çƒ­ç‚¹æ¢æµ‹æ–¹å¼ï¼š åŸºäºé‡‡æ ·çš„çƒ­ç‚¹æ¢æµ‹ï¼Œå‘¨æœŸæ€§æ¢æµ‹å„ä¸ªçº¿ç¨‹æ ˆé¡¶ï¼Œè™½ç„¶ç®€å•é«˜æ•ˆï¼Œä½†æ˜¯å®¹æ˜“å—åˆ°çº¿ç¨‹é˜»å¡çš„å½±å“è€Œæ‰°ä¹±æ¢æµ‹ï¼› åŸºäºè®¡æ•°å™¨çš„çƒ­ç‚¹æ¢æµ‹ï¼Œä¸ºæ¯ä¸ªæ–¹æ³•ï¼ˆç”šè‡³æ˜¯ä»£ç å—ï¼‰å»ºç«‹è®¡æ•°å™¨ï¼Œç»Ÿè®¡æ‰§è¡Œæ¬¡æ•°ï¼Œå¦‚æœæ‰§è¡Œæ¬¡æ•°è¾¾åˆ°ä¸€å®šçš„é˜ˆå€¼ï¼Œå°±æŠŠè¿™éƒ¨åˆ†ä»£ç ç¼–è¯‘æˆæœºå™¨ç ã€‚ HotSpot é‡‡ç”¨çš„æ˜¯åŸºäºè®¡æ•°å™¨çš„çƒ­ç‚¹æ¢æµ‹ï¼Œä¸ºæ¯ä¸ªæ–¹æ³•å‡†å¤‡äº†ä¸¤ä¸ªè®¡æ•°å™¨ï¼šæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ï¼ˆInvocation Counterï¼‰å’Œ å›è¾¹è®¡æ•°å™¨ï¼ˆBack Edge Counterï¼‰ã€‚ åœ¨é»˜è®¤è®¾ç½®ä¸‹ï¼Œæ–¹æ³•è®¡æ•°å™¨ç»Ÿè®¡çš„å¹¶ä¸æ˜¯æ–¹æ³•è¢«è°ƒç”¨çš„ç»å¯¹æ¬¡æ•°ï¼Œè€Œæ˜¯ä¸€å®šæ—¶é—´å†…çš„æ‰§è¡Œæ¬¡æ•°ï¼Œè¶…è¿‡äº†æ—¶é—´å¦‚æœè¿˜æ²¡æœ‰è¾¾åˆ°é˜ˆå€¼ï¼Œå°±ä¼šå°†æ–¹æ³•è®¡æ•°å™¨çš„å€¼å‡å»ä¸€åŠï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º æ–¹æ³•è®¡æ•°å™¨çš„ çƒ­åº¦è¡°å‡ï¼ˆCounter Decayï¼‰ï¼Œè€Œè¿™æ®µæ—¶é—´å°±ç§°ä¸ºæ­¤æ–¹æ³•ç»Ÿè®¡çš„åŠè¡°å‘¨æœŸï¼ˆCounter Half Life Timeï¼‰ï¼Œè¿›è¡Œçƒ­åº¦è¡°å‡çš„åŠ¨ä½œå®åœ¨è™šæ‹Ÿæœºè¿›è¡Œåƒåœ¾æ”¶é›†é¡ºå¸¦è¿›è¡Œçš„ã€‚è€Œå›è¾¹è®¡æ•°å™¨é€‚ç”¨äºç»Ÿè®¡æ–¹æ³•ä¸­å¾ªç¯ä½“ä»£ç çš„æ‰§è¡Œæ¬¡æ•°ï¼Œä¹‹æ‰€ä»¥å«â€œå›è¾¹â€ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå¾ªç¯ä½“ç»“æŸä¸€æ¬¡åˆå›åˆ°å¼€å¤´ï¼ˆæ­»ç©ºå¾ªç¯ä¸ç®—å›è¾¹ï¼‰ï¼Œæ˜¾ç„¶å»ºç«‹å›è¾¹è®¡æ•°å™¨ç»Ÿè®¡çš„ç›®çš„æ˜¯ä¸ºäº†è§¦å‘OSRï¼ˆOn Stack Replacementï¼Œæ ˆä¸Šæ›¿æ¢ï¼‰ç¼–è¯‘ã€‚å›è¾¹è®¡æ•°å™¨æ²¡æœ‰è®¡æ•°çƒ­åº¦è¡°å‡çš„è¿‡ç¨‹ï¼Œç»Ÿè®¡çš„å°±æ˜¯æ–¹æ³•ä½“å†…å¾ªç¯ä½“æ‰§è¡Œçš„ç»å¯¹æ¬¡æ•°ã€‚ 3. ä¼˜åŒ–æŠ€æœ¯3.1 æ–¹æ³•å†…è”æ–¹æ³•å†…è”çš„é‡è¦æ€§è¦ä¼˜äºå…¶ä»–ä¼˜åŒ–æªæ–½ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æœ‰ä¸¤ä¸ªï¼Œä¸€æ˜¯å»é™¤æ–¹æ³•è°ƒç”¨çš„æˆæœ¬ï¼ŒäºŒæ˜¯ä¸ºå…¶ä»–ä¼˜åŒ–å»ºç«‹è‰¯å¥½çš„åŸºç¡€ã€‚ æ–¹æ³•å†…è”çš„è¡Œä¸ºå¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠç›®æ ‡æ–¹æ³•çš„ä»£ç â€œå¤åˆ¶â€åˆ°å‘èµ·è°ƒç”¨çš„æ–¹æ³•ä¹‹ä¸­ï¼Œé¿å…å‘ç”ŸçœŸå®çš„æ–¹æ³•è°ƒç”¨è€Œå·²ã€‚åœ¨åˆ†æ´¾è°ƒç”¨ä¸­è®²è¿‡ã€‚ 3.2 å…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤å¦‚æœä¸€ä¸ªè¡¨è¾¾å¼ E å·²ç»è®¡ç®—è¿‡äº†ï¼Œå¹¶ä¸”ä»å…ˆå‰çš„è®¡ç®—åˆ°ç°åœ¨ E ä¸­æ‰€æœ‰å˜é‡çš„å€¼éƒ½æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆ E çš„è¿™æ¬¡å‡ºç°å°±æˆä¸ºäº†å…¬å…±å­è¡¨è¾¾å¼ã€‚å¯¹äºè¿™ç§è¡¨è¾¾å¼ï¼Œæ²¡æœ‰å¿…è¦èŠ±æ—¶é—´å†å¯¹å®ƒè¿›è¡Œè®¡ç®—ï¼Œåªéœ€è¦ç›´æ¥ç”¨å‰é¢è®¡ç®—è¿‡çš„è¡¨è¾¾å¼ç»“æœä»£æ›¿ E å°±å¯ä»¥äº†ã€‚æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­æ¥æ¨¡æ‹Ÿä¸‹å®ƒçš„ä¼˜åŒ–è¿‡ç¨‹ï¼š 1234567891011public static void main(String[] args) &#123; int a = 1; int b = 1; int c = 1; int d = (c * b) * 12 + a + (a + b * c); // 1. æå–å…¬å…±å­è¡¨è¾¾å¼ int E = c * b; d = E * 12 + a + (a + E); // 2. ä»£æ•°åŒ–ç®€ d = E * 13 + a * 2;&#125; 3.3 æ•°ç»„è¾¹ç•Œæ£€æŸ¥æ¶ˆé™¤å½“æˆ‘ä»¬å°è¯•å¯¹æ•°ç»„è¶Šç•Œè®¿é—®çš„æ—¶å€™ï¼ŒJava ä¼šå‘æˆ‘ä»¬æŠ›ä¸€ä¸ª java.lang.ArrayIndexOutOfBoundsExceptionï¼Œè¿™å¯¹è½¯ä»¶å¼€å‘è€…æ¥è¯´æ˜¯ä¸€ä»¶å¾ˆå¥½çš„äº‹æƒ…ï¼Œå³ä½¿æ²¡æœ‰ä¸“é—¨ç¼–å†™é˜²å¾¡ä»£ç ï¼Œä¹Ÿå¯ä»¥é¿å…å¤§éƒ¨åˆ†çš„æº¢å‡ºæ”»å‡»ï¼Œä½†æ˜¯å¯¹è™šæ‹Ÿæœºæ¥è¯´ï¼Œæ„å‘³ç€æ¯ä¸€æ¬¡çš„æ•°ç»„è®¿é—®éƒ½å¸¦æœ‰ä¸€æ¬¡éšå«çš„æ¡ä»¶åˆ¤å®šæ“ä½œï¼Œå³æ•°ç»„è¾¹ç•Œæ£€æŸ¥ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•æ¶ˆé™¤è¿™ç§æ£€æŸ¥å‘¢ï¼Ÿ è™šæ‹Ÿæœºä¸€èˆ¬æ˜¯åœ¨å³æ—¶ç¼–è¯‘æœŸé—´é€šè¿‡æ•°æ®æµåˆ†ææ¥ç¡®å®šæ˜¯å¦å¯ä»¥æ¶ˆé™¤è¿™ç§æ£€æŸ¥ï¼Œæ¯”å¦‚ foo[3] çš„è®¿é—®ï¼Œåªæœ‰åœ¨ç¼–è¯‘çš„æ—¶å€™ç¡®å®š 3 ä¸ä¼šè¶…è¿‡ foo.length - 1 çš„å€¼ï¼Œå°±å¯ä»¥åˆ¤æ–­è¯¥æ¬¡æ•°ç»„è®¿é—®æ²¡æœ‰è¶Šç•Œï¼Œå°±å¯ä»¥æŠŠæ•°ç»„è¾¹ç•Œæ£€æŸ¥æ¶ˆé™¤ã€‚ 3.4 é€ƒé€¸åˆ†æé€ƒé€¸åˆ†æçš„åŸºæœ¬è¡Œä¸ºå°±æ˜¯åˆ†æå¯¹è±¡åŠ¨æ€ä½œç”¨åŸŸï¼šå½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•è¢«å®šä¹‰åï¼Œå®ƒå¯èƒ½è¢«å¤–éƒ¨æ–¹æ³•æ‰€å¼•ç”¨ï¼Œä¾‹å¦‚ä½œä¸ºè°ƒç”¨å‚æ•°ä¼ é€’åˆ°å…¶ä»–æ–¹æ³•ä¸­ï¼Œç§°ä¸ºæ–¹æ³•é€ƒé€¸ï¼›ç”šè‡³è¿˜æœ‰å¯èƒ½è¢«å¤–éƒ¨çº¿ç¨‹è®¿é—®åˆ°ï¼Œè­¬å¦‚èµ‹å€¼ç»™ç±»å˜é‡æˆ–å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­è®¿é—®çš„å®ä¾‹å˜é‡ï¼Œç§°ä¸ºçº¿ç¨‹é€ƒé€¸ã€‚ å¦‚æœèƒ½è¯æ˜ä¸€ä¸ªå¯¹è±¡ä¸ä¼šé€ƒé€¸åˆ°æ–¹æ³•æˆ–è€…çº¿ç¨‹ä¹‹å¤–ï¼Œåˆ™å¯ä»¥ä¸ºè¿™ä¸ªå˜é‡è¿›è¡Œä¸€äº›é«˜æ•ˆçš„ä¼˜åŒ–ï¼š 1) æ ˆä¸Šåˆ†é…å¦‚æœç¡®å®šä¸€ä¸ªå¯¹è±¡ä¸ä¼šé€ƒé€¸å‡ºæ–¹æ³•ä¹‹å¤–ï¼Œå‡å¦‚èƒ½ä½¿ç”¨æ ˆä¸Šåˆ†é…è¿™ä¸ªå¯¹è±¡ï¼Œé‚£å¤§é‡çš„å¯¹è±¡å°±ä¼šéšç€æ–¹æ³•çš„ç»“æŸè€Œè‡ªåŠ¨é”€æ¯äº†ï¼Œåƒåœ¾æ”¶é›†ç³»ç»Ÿçš„å‹åŠ›å°†ä¼šå°å¾ˆå¤šã€‚ç„¶è€Œé—æ†¾çš„æ˜¯ï¼Œç›®å‰çš„ HotSpot è™šæ‹Ÿæœºè¿˜æ²¡æœ‰å®ç°è¿™é¡¹ä¼˜åŒ–ã€‚ 2ï¼‰åŒæ­¥æ¶ˆé™¤å¦‚æœç¡®å®šä¸€ä¸ªå¯¹è±¡ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹è®¿é—®åˆ°ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡å°±ä¸å­˜åœ¨çº¿ç¨‹é—´çš„äº‰æŠ¢ï¼Œå¯¹è¿™ä¸ªå˜é‡å®æ–½çš„åŒæ­¥æªæ–½ä¹Ÿå¯ä»¥æ¶ˆé™¤æ‰ã€‚ 3ï¼‰æ ‡é‡æ›¿æ¢æ ‡é‡ï¼šæ— æ³•è¢«è¿›ä¸€æ­¥åˆ†è§£çš„æ•°æ®ï¼Œæ¯”å¦‚åŸå§‹æ•°æ®ç±»å‹ï¼ˆintã€longä»¥åŠ reference ç±»å‹ï¼‰èšåˆé‡ï¼šå¯ä»¥è¢«æŒç»­åˆ†è§£çš„æ•°æ®ï¼Œå…¸å‹çš„å°±æ˜¯ Java ä¸­å¯¹è±¡ï¼Œå®ƒä»¬è¿˜å¯ä»¥è¢«åˆ†è§£æˆæˆå‘˜å˜é‡ç­‰ã€‚ æ ‡é‡æ›¿æ¢æŒ‡çš„æ˜¯å¦‚æœæŠŠä¸€ä¸ª Java å¯¹è±¡æ‹†æ•£åˆ†è§£ï¼Œæ ¹æ®ç¨‹åºè®¿é—®çš„æƒ…å†µï¼Œå°†å…¶ä½¿ç”¨åˆ°çš„æˆå‘˜å˜é‡æ¢å¤åˆ°åŸå§‹ç±»å‹æ¥è®¿é—®ã€‚ å¦‚æœèƒ½ç¡®å®šä¸€ä¸ªå¯¹è±¡ä¸ä¼šè¢«å¤–éƒ¨è®¿é—®ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡å¯ä»¥è¢«æ‹†æ•£çš„è¯ï¼Œé‚£ç¨‹åºçœŸæ­£æ‰§è¡Œçš„æ—¶å€™å°±å¯èƒ½ä¸åˆ›å»ºè¿™ä¸ªå¯¹è±¡ï¼Œè€Œæ”¹ä¸ºç›´æ¥åˆ›å»ºå®ƒçš„è‹¥å¹²ä¸ªè¢«è¿™ä¸ªæ–¹æ³•ä½¿ç”¨åˆ°çš„æˆå‘˜å˜é‡æ¥ä»£æ›¿ã€‚ tipsï¼š -XX:+DoEscapeAnalysis æ‰‹åŠ¨å¼€å¯/å…³é—­é€ƒé€¸åˆ†æï¼Œé»˜è®¤å¼€å¯ï¼ŒC2 ç¼–è¯‘å™¨æœ‰æ•ˆ -XX:+PrintEscapeAnalysis æŸ¥çœ‹é€ƒé€¸åˆ†æçš„ç»“æœï¼ˆdebug è™šæ‹Ÿæœºæ”¯æŒï¼‰ -XX:+EliminateAllocations æ‰‹åŠ¨å¼€å¯/å…³é—­æ ‡é‡æ›¿æ¢ï¼Œé»˜è®¤å¼€å¯ -XX:+PrintEliminateAllocations æŸ¥çœ‹æ ‡é‡æ›¿æ¢æƒ…å†µï¼ˆdebug è™šæ‹Ÿæœºæ”¯æŒï¼‰ -XX:+EliminateLocks æ‰‹åŠ¨å¼€å¯/å…³é—­åŒæ­¥æ¶ˆé™¤ï¼Œé»˜è®¤å¼€å¯ ç¬¬åäºŒç«  Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹1. ç¡¬ä»¶çš„æ•ˆç‡ä¸ä¸€è‡´æ€§è™šæ‹Ÿæœºä¸ç‰©ç†è®¡ç®—æœºçš„å¹¶å‘æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„ã€‚ 1.1 ç¼“å­˜ä¸€è‡´æ€§åè®®ä¸ºäº†è§£å†³å¤šä¸ªå¤„ç†å™¨çš„è¿ç®—ä»»åŠ¡å¯èƒ½æ¶‰åŠåˆ°åŒä¸€å—ä¸»å†…å­˜ï¼Œè€Œä»–ä»¬çš„ç¼“å­˜æ•°æ®åˆä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå¼•å…¥äº†ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œvolatile å°±æ˜¯ç”¨åˆ°äº† MESI è¿™ä¸ªç¼“å­˜ä¸€è‡´æ€§åè®®ã€‚ 1.2 æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ä¸ºäº†ä¿è¯å¤„ç†å™¨åˆ©ç”¨ç‡æœ€å¤§åŒ–ï¼Œå¤„ç†å™¨ä¼šå¯¹æŒ‡ä»¤é‡æ’åºï¼Œè€Œ jvm ä¸­çš„ JIT ç¼–è¯‘å™¨ ä¹ŸåŒæ ·å¦‚æ­¤ï¼Œæœ‰ç±»ä¼¼çš„æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œåœ¨ volatile ä¸­ä¸ºäº†ä¿è¯ happens-before æ˜¯æ’å…¥ å†…å­˜å±éšœ é˜²æ­¢ æŒ‡ä»¤é‡æ’åºçš„ã€‚ 2. Java å†…å­˜æ¨¡å‹java è™šæ‹Ÿæœºè§„èŒƒä¸­è¯•å›¾å®šä¹‰ä¸€ç§ Java å†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰æ¥å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®© Java ç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å¹¶å‘æ•ˆæœã€‚ 2.1 ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜Java å†…å­˜æ¨¡å‹è§„å®šæ‰€æœ‰çš„å…±äº«å˜é‡éƒ½åº”è¯¥å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯æ¡çº¿ç¨‹æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†çº¿ç¨‹ç‹¬æœ‰çš„å˜é‡ï¼Œçº¿ç¨‹ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œå€¼ä¼ é€’å¿…é¡»é€šè¿‡ä¸»å†…å­˜æ“ä½œã€‚ 2.2 å†…å­˜é—´çš„äº¤äº’æ“ä½œå…³äºä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜å¦‚ä½•äº¤äº’ï¼ŒJMM å®šä¹‰äº†8ç§åŸå­æ“ä½œï¼š lockï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå°†å˜é‡æ ‡è¯†ä¸ºçº¿ç¨‹ç‹¬å çš„çŠ¶æ€ã€‚ç±»ä¼¼ç‹¬å é”ã€‚ unlockï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå°†å˜é‡çš„é”é‡Šæ”¾ã€‚ readï¼šä½œç”¨äºä¸»å†…å­˜å˜é‡ï¼Œå°†å˜é‡ä»ä¸»å†…å­˜è¯»åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚ loadï¼šä½œç”¨äºå·¥ä½œå†…å­˜å˜é‡ï¼Œreadæ“ä½œå®Œåéœ€è¦loadæ¥å¤åˆ¶ä¸€ä»½å˜é‡å‰¯æœ¬æ”¾åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚ useï¼šä½œç”¨äºå·¥ä½œå†…å­˜å˜é‡ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨åˆ°å˜é‡å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°±ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ assignï¼šä½œç”¨äºå·¥ä½œå†…å­˜å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹å€¼ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤å°±æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ storeï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„ write ä½¿ç”¨ã€‚ writeï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠ store æ“ä½œå¾—åˆ°çš„å˜é‡å†™å…¥åˆ°ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ 2.3 å¯¹äº volatile å‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™Volatile åªå…·æœ‰å¯è§æ€§å’Œæœ‰åºæ€§ï¼Œå¹¶ä¸èƒ½ä¿è¯åŸå­æ€§ã€‚ åœ¨ä»¥ä¸‹ä¸¤æ¡è§„åˆ™çš„è¿ç®—åœºæ™¯ä¸‹ï¼Œvolatile æ‰å…·æœ‰åŸå­æ€§ï¼š è¿ç®—ç»“æœä¸ä¾èµ–äºå˜é‡çš„å½“å‰å€¼ï¼Œæˆ–è€…èƒ½å¤Ÿç¡®ä¿åªæœ‰å•ä¸€çš„çº¿ç¨‹ä¿®æ”¹å˜é‡çš„å€¼ï¼› å˜é‡ä¸éœ€è¦ä¸å…¶ä»–çš„çŠ¶æ€å˜é‡å…±åŒå‚ä¸ä¸å˜çº¦æŸã€‚ å¯è§æ€§ï¼Œæ˜¯æŒ‡ä¸€æ¡çº¿ç¨‹ä¿®æ”¹äº†å½“å‰å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½ç«‹å³æ„ŸçŸ¥åˆ°è¿™ä¸ªæ–°å€¼ã€‚è€Œæ™®é€šå˜é‡å¿…é¡»é€šè¿‡ä¸»å†…å­˜å˜é‡ä¼ é€’æ¥å®Œæˆã€‚ æœ‰åºæ€§ï¼Œæ˜¯æŒ‡ç¦æ­¢äº†æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œæ™®é€šå˜é‡ä»…ä»…ä¿è¯åœ¨è¯¥æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰ä¾èµ–èµ‹å€¼çš„ç»“æœéƒ½èƒ½å¤Ÿå¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œè€Œä¸èƒ½ä¿è¯å˜é‡èµ‹å€¼æ“ä½œçš„é¡ºåºä¸ç¨‹åºä»£ç ä¸­çš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚volatileé€šè¿‡æ’å…¥å†…å­˜å±éšœï¼Œä¿è¯äº†æœ‰åºæ€§ï¼Œä½†æ˜¯è¿™å°±å¸¦æ¥äº†volatileçš„å†™æ“ä½œä¼šæ¯”è¾ƒæ…¢ä¸€äº›ã€‚ æœ‰ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯å•ä¾‹æ¨¡å¼ä¸‹çš„åŒé‡æ£€éªŒé”ï¼š 1234567891011121314public class Singleton &#123; private volatile static Singleton instance; private Singleton () &#123;&#125; public static Singleton getSingleton() &#123; if (instance == null) &#123; synchronized (Singleton.class) &#123; if (instance == null) &#123; instance = new Singleton(); &#125; &#125; &#125; return instance; &#125; &#125; ç§°å…¶ä¸ºåŒé‡æ£€æŸ¥é”ï¼Œæ˜¯å› ä¸ºä¼šæœ‰ä¸¤æ¬¡æ£€æŸ¥ instance == nullï¼Œä¸€æ¬¡æ˜¯åœ¨åŒæ­¥å—å¤–ï¼Œä¸€æ¬¡æ˜¯åœ¨åŒæ­¥å—å†…ã€‚ä¸ºä»€ä¹ˆåœ¨åŒæ­¥å—å†…è¿˜è¦å†æ£€éªŒä¸€æ¬¡ï¼Ÿå› ä¸ºå¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹ä¸€èµ·è¿›å…¥åŒæ­¥å—å¤–çš„ ifï¼Œå¦‚æœåœ¨åŒæ­¥å—å†…ä¸è¿›è¡ŒäºŒæ¬¡æ£€éªŒçš„è¯å°±ä¼šç”Ÿæˆå¤šä¸ªå®ä¾‹äº† è€Œ instance = new Singleton() è¿™å¥ï¼Œå¹¶éæ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œäº‹å®ä¸Šåœ¨ JVM ä¸­è¿™å¥è¯åšäº†ä¸‹é¢ 3 ä»¶äº‹ï¼š ç»™ instance åˆ†é…å†…å­˜ è°ƒç”¨ Singleton çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–æˆå‘˜å˜é‡ å°† instance å¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜ç©ºé—´ï¼ˆæ‰§è¡Œå®Œè¿™æ­¥ instance å°±ä¸ºé null äº†ï¼‰ ä½†æ˜¯åœ¨ JVM çš„å³æ—¶ç¼–è¯‘å™¨ä¸­å­˜åœ¨æŒ‡ä»¤é‡æ’åºçš„ä¼˜åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸Šé¢çš„ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥çš„é¡ºåºæ˜¯ä¸èƒ½ä¿è¯çš„ï¼Œæœ€ç»ˆçš„æ‰§è¡Œé¡ºåºå¯èƒ½æ˜¯ 1-2-3 ä¹Ÿå¯èƒ½æ˜¯ 1-3-2ã€‚å¦‚æœæ˜¯åè€…ï¼Œåˆ™åœ¨ 3 æ‰§è¡Œå®Œæ¯•ã€2 æœªæ‰§è¡Œä¹‹å‰ï¼Œè¢«çº¿ç¨‹äºŒæŠ¢å äº†ï¼Œè¿™æ—¶ instance å·²ç»æ˜¯é null äº†ï¼ˆä½†å´æ²¡æœ‰åˆå§‹åŒ–ï¼‰ï¼Œæ‰€ä»¥çº¿ç¨‹äºŒä¼šç›´æ¥è¿”å› instanceï¼Œç„¶åä½¿ç”¨ï¼Œç„¶åé¡ºç†æˆç« åœ°æŠ¥é”™ æ‰€ä»¥éœ€è¦å°† instance å˜é‡å£°æ˜æˆ volatileã€‚ 2.4 å¯¹äº long å’Œ double å‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™JMM è¦æ±‚lockã€unlockã€readã€loadã€useã€assignã€storeã€write è¿™ 8 ä¸ªæ“ä½œå…·æœ‰åŸå­æ€§ï¼Œä½†æ˜¯å¯¹äº 64 ä½çš„æ•°æ®ç±»å‹ï¼ˆlong å’Œ doubleï¼‰ï¼Œæœ‰ä¸€æ¡å®½æ¾çš„è§„å®šï¼šå…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢« volatile ä¿®é¥°çš„ 64 ä½æ•°æ®çš„è¯»å†™æ“ä½œåˆ’åˆ†ä¸ºä¸¤æ¬¡ 32 ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œå³å…è®¸è™šæ‹Ÿæœºå®ç°é€‰æ‹©å¯ä»¥ä¸ä¿è¯ 64 ä½æ•°æ®ç±»å‹çš„ loadã€storeã€readã€write è¿™å››ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œè¿™ç‚¹å°±æ˜¯æ‰€è°“çš„ long å’Œ double çš„éåŸå­æ€§åå®šï¼Œæ‰€ä»¥å¯èƒ½å¤šä¸ªçº¿ç¨‹å…±äº«ä¸€ä¸ªæœªå£°æ˜ä¸º volatile çš„ long æˆ–è€… double å˜é‡æ—¶ï¼Œè¯»å–åˆ°çš„å€¼ä¼šå¾ˆå¥‡æ€ªï¼Œä¸è¿‡ç°åœ¨åŸºæœ¬æ‰€æœ‰å•†ç”¨çš„è™šæ‹Ÿæœºéƒ½å®ç°äº† 64 ä½æ•°æ®çš„è¯»å†™æ“ä½œä½œä¸ºåŸå­æ“ä½œæ¥å¯¹å¾…ã€‚ 2.5 åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§JMM çš„ä¸‰ä¸ªç‰¹å¾ï¼šåŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ã€‚ åŸå­æ€§ï¼šæœ‰ JMM ç›´æ¥ä¿è¯çš„åŸå­æ€§å˜é‡æ“ä½œåŒ…æ‹¬ readã€loadã€useã€assignã€storeã€writeï¼Œlong å’Œ double çš„éåŸå­æ€§åå®šä¾‹å¤–â€¦å¦‚æœæƒ³è¦æ›´å¤§èŒƒå›´çš„åŸå­æ€§ä¿è¯ï¼Œæœ‰ lock å’Œ lock ä¿è¯ï¼Œåº•å±‚æä¾›äº† monitorenterã€monitorexit ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ä¿è¯å…·æœ‰åŸå­æ€§ã€‚ å¯è§æ€§ï¼šæ˜¯æŒ‡ä¸€æ¡çº¿ç¨‹ä¿®æ”¹äº†å½“å‰å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½ç«‹å³æ„ŸçŸ¥åˆ°è¿™ä¸ªæ–°å€¼ã€‚è€Œæ™®é€šå˜é‡å¿…é¡»é€šè¿‡ä¸»å†…å­˜å˜é‡ä¼ é€’æ¥å®Œæˆã€‚é™¤äº† volatileï¼Œè¿˜å¯ä»¥å®ç°å¯è§æ€§çš„å…³é”®å­—æœ‰ synchronized å’Œ finalã€‚ volatile å®ç°å¯è§æ€§çš„åŸå› å°±æ˜¯éµå¾ªäº† MESI ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œå¯ä»¥ä¿è¯å˜é‡ä¿®æ”¹å®Œåç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œè€Œå…¶ä»–çš„çº¿ç¨‹ä¸­çš„å·¥ä½œå†…å­˜çš„å˜é‡å€¼ä½œåºŸï¼Œéœ€è¦ä»ä¸»å†…å­˜å†é‡æ–°è¯»å–ã€‚ Synchronized å®ç°å¯è§æ€§çš„åŸå› æ˜¯ â€œå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ unlock æ“ä½œä¹‹å‰ï¼Œä¼šç¡®ä¿å…ˆæŠŠè¯¥å˜é‡åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼ˆæ‰§è¡Œ store å’Œ write æŒ‡ä»¤ï¼‰â€ã€‚ final å®ç°å¯è§æ€§çš„åŸå› æ˜¯è¢« final ä¿®é¥°å¥½çš„å­—æ®µåœ¨æ„é€ å™¨ä¸­ä¸€æ—¦è¢«åˆå§‹åŒ–å®Œæˆï¼Œå…¶ä»–çº¿ç¨‹å°±èƒ½çœ‹è§ final å­—æ®µçš„å€¼ï¼Œå¹¶ä¸”æ— æ³•ä¿®æ”¹ï¼Œæ‰€ä»¥å°±èƒ½ä¿è¯å¯è§æ€§äº†ã€‚ æœ‰åºæ€§ï¼šå¦‚æœåœ¨æœ¬çº¿ç¨‹è§‚å¯Ÿï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼›å¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è§‚å¯Ÿå¦å¤–ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚å‰åŠå¥æ˜¯æŒ‡â€œçº¿ç¨‹å†…è¡¨ç°ä¸ºä¸²è¡Œçš„è¯­ä¹‰â€ï¼ŒååŠå¥æ˜¯æŒ‡â€œæŒ‡ä»¤é‡æ’åºâ€å’Œâ€œå·¥ä½œå†…å­˜ä¸ä¸»å†…å­˜åŒæ­¥å»¶è¿Ÿâ€ç°è±¡ï¼ŒJava æä¾›äº† volatile å’Œ synchronized ä¸¤ä¸ªå…³é”®å­—ä¿è¯çº¿ç¨‹çš„æœ‰åºæ€§ã€‚volatile å…³é”®å­—æœ¬èº«å°±åŒ…å«äº†ç¦æ­¢æŒ‡ä»¤é‡æ’åºçš„è¯­ä¹‰ï¼Œè€Œ synchronized åˆ™æ˜¯ç”±â€œä¸€ä¸ªå˜é‡åœ¨åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡ŒåŠ é”æ“ä½œâ€è¿™æ¡è§„åˆ™è·å¾—çš„ã€‚ 2.6 å…ˆè¡Œå‘ç”Ÿï¼ˆhappens-beforeï¼‰åŸåˆ™happens-before åŸåˆ™éå¸¸é‡è¦ï¼Œå®ƒæ˜¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç«äº‰ï¼Œçº¿ç¨‹æ˜¯å¦å®‰å…¨çš„ä¸»è¦ä¾æ®ã€‚æŒ‡ä»¤é‡æ’åºçš„å‰ææ˜¯è¦éµå®ˆ happens-before åŸåˆ™ã€‚ å…ˆè¡Œå‘ç”Ÿæ˜¯ JMM ä¸­å®šä¹‰çš„ä¸¤é¡¹æ“ä½œä¹‹é—´çš„ååºå…³ç³»ï¼Œå¦‚æœè¯´ A å…ˆè¡Œå‘ç”Ÿäº Bï¼Œå…¶å®å°±æ˜¯è¯´åœ¨æ“ä½œ B ä¹‹å‰ï¼Œæ“ä½œ A äº§ç”Ÿçš„å½±å“èƒ½å¤Ÿè¢«æ“ä½œ B è§‚å¯Ÿåˆ°ã€‚ã€ŒTipï¼šæ—¶é—´ä¸Šçš„å…ˆåé¡ºåºå’Œå…ˆè¡Œå‘ç”ŸåŸåˆ™æ²¡æœ‰å¤ªå¤§çš„å…³ç³»ï¼Œæ‰€ä»¥åœ¨è¡¡é‡å®‰å…¨é—®é¢˜çš„æ—¶å€™éœ€è¦ä»¥ happens-before åŸåˆ™ä¸ºå‡†ã€ å¤©ç„¶çš„ happens-beforeåŸåˆ™æœ‰ï¼š ç¨‹åºæ¬¡åºè§„åˆ™ï¼Œä¸€ä¸ªçº¿ç¨‹å†…çš„ä»£ç è‡ªä¸Šè€Œä¸‹è¿è¡Œï¼› ç®¡ç¨‹é”å®šè§„åˆ™ï¼Œunlockå¿…é¡»åœ¨lockä¹‹åï¼Œå½“ç„¶è‚¯å®šæ“ä½œçš„æ˜¯åŒä¸€ä¸ªåŒæ­¥å¯¹è±¡ï¼› volatileå˜é‡è§„åˆ™ï¼Œå¯¹ä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œæ€»æ˜¯å…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œï¼› çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼Œä»»ä½•çº¿ç¨‹çš„è¿ä½œéƒ½å¿…é¡»åœ¨ start ä¹‹åï¼› çº¿ç¨‹ç»ˆæ­¢è§„åˆ™ï¼Œä»»ä½•çº¿ç¨‹çš„ç»“æŸéƒ½å¿…é¡»åœ¨è¯¥çº¿ç¨‹ä»»ä½•æ“ä½œä¹‹åï¼› çº¿ç¨‹ä¸­æ–­è§„åˆ™ï¼Œinterrupt() è°ƒç”¨ä¹‹åæ‰ä¼šæœ‰ä¸­æ–­æ—¶é—´çš„å‘ç”Ÿï¼› å¯¹è±¡ç»ˆç»“è§„åˆ™ï¼Œæ„é€ å‡½æ•°å…ˆäº finalize() å‘ç”Ÿï¼› ä¼ é€’æ€§ï¼Œ A å…ˆäº Bï¼ŒB å…ˆäº Cï¼Œåˆ™ A å…ˆäº Cã€‚ 3. Java ä¸çº¿ç¨‹3.1 çº¿ç¨‹çš„å®ç°å®ç°çº¿ç¨‹ä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼š ä½¿ç”¨å†…æ ¸çº¿ç¨‹å®ç°ï¼› ä½¿ç”¨ç”¨æˆ·çº¿ç¨‹å®ç°ï¼› ä½¿ç”¨ç”¨æˆ·çº¿ç¨‹åŠ ä¸Šè½»é‡çº§è¿›ç¨‹æ··åˆå®ç°ã€‚ 3.1.1 ä½¿ç”¨å†…æ ¸çº¿ç¨‹å®ç°å†…æ ¸çº¿ç¨‹ï¼ˆKernel Threadï¼ŒKLTï¼‰å°±æ˜¯ç›´æ¥ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æ”¯æŒçš„çº¿ç¨‹ï¼Œè¿™ç§çº¿ç¨‹ç”±å†…æ ¸æ¥å®Œæˆçº¿ç¨‹åˆ‡æ¢ï¼Œå†…æ ¸é€šè¿‡æ“çºµè°ƒåº¦å™¨æ¥å¯¹çº¿ç¨‹è¿›è¡Œè°ƒåº¦ã€‚è€Œç¨‹åºä¸€èˆ¬ä¸ä¼šä½¿ç”¨å†…æ ¸çº¿ç¨‹ï¼Œä¼šé€šè¿‡ä¸€ä¸ªä¸­é—´ä»¶â€”- è½»é‡çº§è¿›ç¨‹ï¼Œæ¥å’Œå†…æ ¸çº¿ç¨‹1ï¼š1æ˜ å°„ã€‚ 3.1.2 ä½¿ç”¨ç”¨æˆ·çº¿ç¨‹å®ç°ç”¨æˆ·çº¿ç¨‹å°±æ˜¯ç³»ç»Ÿå†…æ ¸æ„Ÿå—ä¸åˆ°çš„çº¿ç¨‹ï¼Œæ‰€ä»¥ç”¨æˆ·çš„å»ºç«‹ã€åŒæ­¥ã€é”€æ¯å’Œè°ƒåº¦å®Œå…¨åœ¨ç”¨æˆ·æ€ä¸­å®Œæˆï¼Œä¸éœ€è¦å†…æ ¸çš„å¸®åŠ©ã€‚ä½†æ˜¯è¿™ä¸ªå®ç°èµ·æ¥å¾ˆå›°éš¾ï¼ŒåŸºæœ¬éƒ½æ”¾å¼ƒä½¿ç”¨äº†ã€‚è¿›ç¨‹å’Œå†…æ ¸çº¿ç¨‹ 1ï¼šNã€‚ 3.1.3 æ··åˆä½¿ç”¨å¤šå¯¹å¤šçš„çº¿ç¨‹æ¨¡å‹ï¼Œè½»é‡çº§è¿›ç¨‹å’Œç”¨æˆ·çº¿ç¨‹ M ï¼šNã€‚ 3.1.4 Java çº¿ç¨‹çš„å®ç°æˆ‘ä»¬ä½¿ç”¨çš„ jdk æ˜¯é‡‡ç”¨çš„å†…æ ¸çº¿ç¨‹å®ç°çš„ï¼Œè½»é‡çº§è¿›ç¨‹å’Œå†…æ ¸çº¿ç¨‹1ï¼š1ã€‚ 3.2 Java çº¿ç¨‹è°ƒåº¦çº¿ç¨‹è°ƒåº¦æ˜¯æŒ‡ç³»ç»Ÿä¸ºçº¿ç¨‹åˆ†é…å¤„ç†å™¨ä½¿ç”¨æƒçš„è¿‡ç¨‹ï¼Œä¸»è¦çš„è°ƒåº¦æ–¹å¼æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ ååŒå¼ï¼ˆCooperative Threads-Schedulingï¼‰çº¿ç¨‹è°ƒåº¦ å’Œ æŠ¢å å¼ï¼ˆPreemptive Threads-Schedulingï¼‰çº¿ç¨‹è°ƒåº¦ã€‚ Java ä½¿ç”¨çš„å½“ç„¶æ˜¯æŠ¢å å¼çº¿ç¨‹è°ƒåº¦ï¼Œå› ä¸ºååŒå¼çº¿ç¨‹è°ƒåº¦è™½ç„¶å®ç°ç®€å•ä½†æ˜¯çº¿ç¨‹æ‰§è¡Œæ—¶é—´ä¸å¯æ§ï¼Œå¦‚æœçº¿ç¨‹ç¼–å†™æœ‰é—®é¢˜ä¸é€šçŸ¥ç³»ç»Ÿè¿›è¡Œç³»ç»Ÿåˆ‡æ¢é‚£ä¹ˆç¨‹åºå°±ä¼šä¸€ç›´å µå¡ã€‚è™½ç„¶è¯´ Java çº¿ç¨‹è°ƒåº¦æ˜¯ç³»ç»Ÿè‡ªåŠ¨å®Œæˆçš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§è¶Šé«˜è¶Šå®¹æ˜“è¢«ç³»ç»Ÿé€‰æ‹©ï¼Œä¸è¿‡å…¶å®çº¿ç¨‹ä¼˜å…ˆçº§ä¹Ÿä¸é è°±ï¼Œå› ä¸º java çš„çº¿ç¨‹æ˜¯è¢«æ˜ å°„åˆ°ç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¸Šå®ç°ï¼Œæ‰€ä»¥æœ€ç»ˆçš„è°ƒåº¦è¿˜æ˜¯ os è¯´äº†ç®—ã€‚ 3.3 çŠ¶æ€è½¬æ¢Java çš„çº¿ç¨‹æœ‰ 5 ç§çŠ¶æ€ï¼š æ–°å»ºï¼ˆNewï¼‰:åˆ›å»ºåå°šæœªå¯åŠ¨çš„çº¿ç¨‹å¤„äºè¿™ç§çŠ¶æ€ ï¼› è¿è¡Œï¼ˆRunnableï¼‰ï¼šåŒ…æ‹¬äº†æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ä¸­çš„ Running å’Œ Readyï¼Œä¹Ÿå°±æ˜¯å¤„äºæ­¤çŠ¶æ€çš„çº¿ç¨‹æœ‰å¯èƒ½æ­£åœ¨æ‰§è¡Œï¼Œä¹Ÿæœ‰å¯èƒ½æ­£åœ¨ç­‰å¾… cpu åˆ†é…æ—¶é—´ç‰‡ï¼› ç­‰å¾…ï¼ˆWaitingï¼‰ï¼šå¤„äºè¿™ç§çŠ¶æ€çš„è¿›ç¨‹ä¸ä¼šè¢«åˆ†é… cpu æ‰§è¡Œæ—¶é—´ï¼Œå®ƒä»¬è¦è®©çº¿ç¨‹æ˜¾ç¤ºçš„å”¤é†’ã€‚ä»¥ä¸‹æ–¹æ³•ä¼šè®©çº¿ç¨‹è¿›å…¥åˆ°è¿™ä¸ªçŠ¶æ€ï¼š Object.wait() ã€Œå¯è®¾ç½®æ—¶é—´ã€ Thread.join() ã€Œå¯è®¾ç½®æ—¶é—´ã€ LockSupport.park()ã€LockSupport.parkNanos()ã€LockSupport.parkUntil() é˜»å¡ï¼ˆBlockedï¼‰ï¼šä¸ç­‰å¾…çŠ¶æ€çš„åŒºåˆ«æ˜¯ï¼Œâ€œé˜»å¡çŠ¶æ€â€åœ¨ç­‰å¾…è·å–åˆ°ä¸€ä¸ªæ’å®ƒé”ï¼Œè¿™ä¸ªæ—¶é—´å°†åœ¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ”¾å¼ƒè¿™ä¸ªé”çš„æ—¶å€™æ–¹å¼ï¼Œè€Œâ€œç­‰å¾…çŠ¶æ€â€åˆ™æ˜¯åœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œæˆ–è€…å”¤é†’åŠ¨ä½œçš„å‘ç”Ÿã€‚åœ¨ synchronized çš„æ—¶å€™ï¼Œçº¿ç¨‹è¿›å…¥åŒæ­¥åŒºåŸŸï¼Œå°±ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼› ç»“æŸï¼ˆTerminatedï¼‰ï¼šå·²ç»ˆæ­¢çº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€ï¼Œçº¿ç¨‹å·²ç»ç»“æŸæ‰§è¡Œã€‚ ç¬¬åä¸‰ç«  çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–1. çº¿ç¨‹å®‰å…¨çº¿ç¨‹å®‰å…¨çš„å®šä¹‰ï¼š å½“å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº›çº¿ç¨‹åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„è°ƒåº¦å’Œäº¤æ›¿æ‰§è¡Œï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥ï¼Œæˆ–è€…åœ¨è°ƒç”¨æ–¹è¿›è¡Œä»»ä½•å…¶ä»–çš„åè°ƒæ“ä½œï¼Œï¼ˆå•æ¬¡ï¼‰è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºå°±èƒ½å¤Ÿè·å–åˆ°æ­£ç¡®çš„ç»“æœï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ æŒ‰ç…§çº¿ç¨‹å®‰å…¨çš„â€œå®‰å…¨ç¨‹åº¦â€ï¼Œç”±å¼ºè‡³å¼±æ¥æ’åºï¼Œå¯ä»¥å°† Java è¯­è¨€ä¸­å„ç§æ“ä½œå…±äº«çš„æ•°æ®åˆ†ä¸ºä»¥ä¸‹äº”ç±»ï¼šä¸å¯å˜ã€ç»å¯¹çº¿ç¨‹å®‰å…¨ã€ç›¸å¯¹çº¿ç¨‹å®‰å…¨ã€çº¿ç¨‹å…¼å®¹å’Œçº¿ç¨‹ç‹¬ç«‹ã€‚ 1.1 ä¸å¯å˜å³å¯çœ‹ä¸å¯æ”¹çš„æ•°æ®ï¼Œfinal ä¿®é¥°ã€‚ 1.2 ç»å¯¹çº¿ç¨‹å®‰å…¨é›†åˆä¸­çš„ Vectorã€ConcurrentHashMapå¹¶éç»å¯¹çš„çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºå¦‚æœä¸ä½¿ç”¨è¿­ä»£å™¨å»åˆ é™¤å…ƒç´ çš„è¯ï¼Œéå†çš„æ—¶å€™ä¾ç„¶ä¼šå‡ºç°é—®é¢˜ã€‚ 1.3 ç›¸å¯¹çš„çº¿ç¨‹å®‰å…¨å•æ¬¡è°ƒç”¨ä¸éœ€è¦é¢å¤–çš„åŠ åŒæ­¥æªæ–½ï¼Œè¿™å°±æ˜¯ç›¸å¯¹çš„çº¿ç¨‹å®‰å…¨ï¼Œç±»ä¼¼äº HasTableã€Vectorã€Collections çš„ synchronizedCollection()ç­‰ç­‰ã€‚ 1.4 çº¿ç¨‹å…¼å®¹çº¿ç¨‹å…¼å®¹æ˜¯æŒ‡å¯¹è±¡æœ¬èº«ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è°ƒç”¨ç«¯æ­£ç¡®çš„ä½¿ç”¨åŒæ­¥æ‰‹æ®µæ¥ä¿è¯å¯¹è±¡åœ¨å¹¶å‘ç¯å¢ƒä¸­å®‰å…¨çš„ä½¿ç”¨ï¼Œå¦‚ ArrayListã€HashMapã€‚ 1.5 çº¿ç¨‹å¯¹ç«‹çº¿ç¨‹å¯¹ç«‹æ˜¯ä¸ç®¡è°ƒç”¨ç«¯æ˜¯å¦é‡‡å–äº†åŒæ­¥æªæ–½ï¼Œéƒ½æ— æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¹¶å‘ä½¿ç”¨çš„ä»£ç ã€‚è¿™ç§ä»£ç å°±ä¸è¦å†™äº†â€¦æ¯”å¦‚ System.setIn()ã€System.setOut()ã€‚ 2. å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹æ³•2.1 äº’æ–¥åŒæ­¥æœ€åŸºæœ¬çš„æ‰‹æ®µæœ‰ synchronizedã€ReentrantLockã€‚è¿™é‡Œä¹Ÿæåˆ°äº† ReentrantLockå‡ ä¸ªç‰¹æ€§ï¼š æœ‰ç­‰å¾…å¯ä¸­æ–­ï¼Œå½“æŒæœ‰é”é•¿æœŸä¸é‡Šæ”¾æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ï¼› æœ‰å…¬å¹³é”å’Œéå…¬å¹³é”çš„é€‰æ‹©ï¼› å¯ä»¥ç»‘å®šå¤šä¸ªConditionï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æœ‰å¤šä¸ªæ¡ä»¶é˜Ÿåˆ—ã€‚ 2.2 éé˜»å¡åŒæ­¥åŸºäºå†²çªæ£€æµ‹çš„ä¹è§‚å¹¶å‘ç­–ç•¥ï¼Œé€šä¿—çš„æ¥è¯´å°±æ˜¯å…ˆè¿›è¡Œæ“ä½œï¼Œå¦‚æœæ²¡é—®é¢˜å°±æˆåŠŸäº†ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹äº‰ç”¨æ•°æ®ï¼Œäº§ç”Ÿäº†å†²çªï¼Œå°±å†è¿›è¡Œå…¶ä»–æªæ–½ï¼Œè¿™ç§ä¹è§‚çš„å¹¶å‘ç­–ç•¥ä¸éœ€è¦å°†çº¿ç¨‹æŒ‚èµ·ï¼Œå› æ­¤è¿™ç§åŒæ­¥æ“ä½œç§°ä¸ºéé˜»å¡åŒæ­¥ã€‚ 2.3 æ— åŒæ­¥æ–¹æ¡ˆThreadLocal â€”- è§æˆ‘çš„ å¤šçº¿ç¨‹ï¼ˆå››ï¼‰â€”- ThreadLocal ä¸€æ–‡ 3. é”ä¼˜åŒ– è‡ªæ—‹é”å’Œè‡ªé€‚åº”è‡ªæ—‹é”ï¼› é”æ¶ˆé™¤ã€‚å¯ä»¥ä¸ç”¨ç”¨åˆ°é”çš„åœ°æ–¹ï¼Œå¯ä»¥ä¸åŠ é”ï¼› é”ç²—åŒ–ã€‚å¦‚æœæœ‰ä¸€ç³»åˆ—æ“ä½œåå¤çš„åŠ é”å’Œè§£é”ï¼Œå°±ä¼šé”åŒæ­¥èŒƒå›´æ‰©å¤§ï¼› è½»é‡çº§é”ã€‚æœ¬æ„æ˜¯åœ¨æ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰çš„å‰æä¸‹ï¼Œæ¯”å¦‚ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œä¸ä¼šå‘ç”Ÿç«äº‰ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨è½»é‡çº§é”ã€‚ åå‘é”ã€‚å¯ä»¥æé«˜å¸¦æœ‰åŒæ­¥ä½†æ— ç«äº‰çš„ç¨‹åºæ€§èƒ½ï¼Œé€‚åˆå•çº¿ç¨‹ã€‚å¦‚æœå˜é‡æ€»æ˜¯è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆåå‘æ¨¡å¼æ˜¯æ²¡æœ‰æ„ä¹‰çš„å¹¶ä¸”ä¼šæµªè´¹å¼€é”€å’Œæ—¶é—´ã€‚ è¦ç†è§£è½»é‡çº§é”å’Œåå‘é”ï¼Œå°±éœ€è¦è°ˆåˆ°è™šæ‹Ÿæœºä¸­å¯¹è±¡çš„å†…å­˜å¸ƒå±€ã€‚è™šæ‹Ÿæœºä¸­çš„å¯¹è±¡å¤´ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯ç”¨æ¥å­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œä¾‹å¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GC åˆ†ä»£å¹´é¾„ï¼ˆGC Ageï¼‰ç­‰ç­‰ï¼Œä¸€èˆ¬æ˜¯64ä½ï¼Œå®˜æ–¹ç§°ä¹‹ä¸º Mark Wordï¼Œå®ƒæ˜¯å®ç°è½»é‡çº§é”å’Œåå‘é”çš„å…³é”®ï¼Œå¯¹è±¡å¤´é™¤äº† Mark Wordï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†æ˜¯ç”¨æ¥å­˜å‚¨æŒ‡å‘æ–¹æ³•åŒºå¯¹è±¡ç±»å‹æ•°æ®çš„æŒ‡é’ˆï¼Œå¦‚æœæ˜¯æ•°ç»„å¯¹è±¡çš„è¯ï¼Œè¿˜æœ‰é¢å¤–çš„ä¸€éƒ¨åˆ†ç”¨æ¥å­˜å‚¨æ•°ç»„é•¿åº¦ã€‚ å¦‚å›¾æ‰€ç¤ºï¼Œæ˜¯ 32 ä½çš„è™šæ‹Ÿæœºçš„ Mark Wordã€‚ ç°åœ¨è®²ä¸€ä¸‹ synchronized çš„é”å‡çº§è¿‡ç¨‹ï¼š æœ€å¼€å§‹çš„å¯¹è±¡æ˜¯æ— é”æ¨¡å¼ï¼ŒMark Word çš„å‰ 25 ä½è®°å½•å¯¹è±¡çš„HashCodeï¼Œé”æ ‡å¿—ä½æ˜¯01ï¼Œæ˜¯å¦åå‘é”é‚£ä¸€ä½æ˜¯0ã€‚ å½“å¯¹è±¡è¢«å½“åšåŒæ­¥é”å¹¶æœ‰ä¸€ä¸ªçº¿ç¨‹AæŠ¢åˆ°äº†é”æ—¶ï¼Œé”æ ‡å¿—ä½è¿˜æ˜¯01ï¼Œä½†æ˜¯å¦åå‘é”é‚£ä¸€ä½æ”¹æˆ1ï¼Œå‰23bitè®°å½•æŠ¢åˆ°é”çš„çº¿ç¨‹idï¼Œå‰©ä¸‹çš„ 2 ä½ æ˜¯ epochï¼Œä»£è¡¨åå‘çš„æ—¶é—´æˆ³ï¼Œè¡¨ç¤ºè¿›å…¥åå‘é”çŠ¶æ€ã€‚ å½“çº¿ç¨‹Aå†æ¬¡è¯•å›¾æ¥è·å¾—é”æ—¶ï¼ŒJVMå‘ç°åŒæ­¥é”å¯¹è±¡çš„æ ‡å¿—ä½æ˜¯01ï¼Œæ˜¯å¦åå‘é”æ˜¯1ï¼Œä¹Ÿå°±æ˜¯åå‘çŠ¶æ€ï¼ŒMark Wordä¸­è®°å½•çš„çº¿ç¨‹idå°±æ˜¯çº¿ç¨‹Aè‡ªå·±çš„idï¼Œè¡¨ç¤ºçº¿ç¨‹Aå·²ç»è·å¾—äº†è¿™ä¸ªåå‘é”ï¼Œå¯ä»¥æ‰§è¡ŒåŒæ­¥é”çš„ä»£ç ã€‚ å½“çº¿ç¨‹Bè¯•å›¾è·å¾—è¿™ä¸ªé”æ—¶ï¼ŒJVMå‘ç°åŒæ­¥é”å¤„äºåå‘çŠ¶æ€ï¼Œä½†æ˜¯Mark Wordä¸­çš„çº¿ç¨‹idè®°å½•çš„ä¸æ˜¯Bï¼Œé‚£ä¹ˆçº¿ç¨‹Bä¼šå…ˆç”¨CASæ“ä½œè¯•å›¾è·å¾—é”ï¼Œè¿™é‡Œçš„è·å¾—é”æ“ä½œæ˜¯æœ‰å¯èƒ½æˆåŠŸçš„ï¼Œå› ä¸ºçº¿ç¨‹Aä¸€èˆ¬ä¸ä¼šè‡ªåŠ¨é‡Šæ”¾åå‘é”ã€‚å¦‚æœæŠ¢é”æˆåŠŸï¼Œå°±æŠŠMark Wordé‡Œçš„çº¿ç¨‹idæ”¹ä¸ºçº¿ç¨‹Bçš„idï¼Œä»£è¡¨çº¿ç¨‹Bè·å¾—äº†è¿™ä¸ªåå‘é”ï¼Œå¯ä»¥æ‰§è¡ŒåŒæ­¥é”ä»£ç ã€‚å¦‚æœæŠ¢é”å¤±è´¥ï¼Œåˆ™ç»§ç»­æ‰§è¡Œæ­¥éª¤5ã€‚ åå‘é”çŠ¶æ€æŠ¢é”å¤±è´¥ï¼Œä»£è¡¨å½“å‰é”æœ‰ä¸€å®šçš„ç«äº‰ï¼Œåå‘é”å°†å‡çº§ä¸ºè½»é‡çº§é”ã€‚JVMä¼šåœ¨å½“å‰çº¿ç¨‹çš„çº¿ç¨‹æ ˆä¸­å¼€è¾Ÿä¸€å—å•ç‹¬çš„ç©ºé—´ï¼Œç§°ä¹‹ä¸º Lock Recordï¼Œé‡Œé¢ä¿å­˜æŒ‡å‘å¯¹è±¡é”Mark Wordçš„å‰¯æœ¬ï¼ŒåŒæ—¶åœ¨å¯¹è±¡é”Mark Wordä¸­ä¿å­˜æŒ‡å‘è¿™ç‰‡ç©ºé—´çš„æŒ‡é’ˆã€‚ä¸Šè¿°ä¸¤ä¸ªä¿å­˜æ“ä½œéƒ½æ˜¯CASæ“ä½œï¼Œå¦‚æœä¿å­˜æˆåŠŸï¼Œä»£è¡¨çº¿ç¨‹æŠ¢åˆ°äº†åŒæ­¥é”ï¼Œå°±æŠŠMark Wordä¸­çš„é”æ ‡å¿—ä½æ”¹æˆ00ï¼Œå¯ä»¥æ‰§è¡ŒåŒæ­¥é”ä»£ç ã€‚å¦‚æœä¿å­˜å¤±è´¥ï¼Œè¡¨ç¤ºæŠ¢é”å¤±è´¥ï¼Œç«äº‰å¤ªæ¿€çƒˆï¼Œç»§ç»­æ‰§è¡Œæ­¥éª¤6ã€‚ è½»é‡çº§é”æŠ¢é”å¤±è´¥ï¼ŒJVMä¼šä½¿ç”¨è‡ªæ—‹é”ï¼Œè‡ªæ—‹é”ä¸æ˜¯ä¸€ä¸ªé”çŠ¶æ€ï¼Œåªæ˜¯ä»£è¡¨ä¸æ–­çš„é‡è¯•ï¼Œå°è¯•æŠ¢é”ã€‚ä»JDK1.7å¼€å§‹ï¼Œè‡ªæ—‹é”é»˜è®¤å¯ç”¨ï¼Œè‡ªæ—‹æ¬¡æ•°ç”±JVMå†³å®šã€‚å¦‚æœæŠ¢é”æˆåŠŸåˆ™æ‰§è¡ŒåŒæ­¥é”ä»£ç ï¼Œè§£è½»é‡çº§é”é”ä¹Ÿæ˜¯ç”¨ CASï¼Œå°†æ ˆå¸§ä¸Šçš„Lock Recordæ›¿æ¢å›å»ï¼Œæ›¿æ¢æˆåˆšå°±åŒæ­¥å®Œæˆäº†ã€‚å¦‚æœå¤±è´¥åˆ™ç»§ç»­æ‰§è¡Œæ­¥éª¤7ã€‚ è‡ªæ—‹é”é‡è¯•ä¹‹åå¦‚æœæŠ¢é”ä¾ç„¶å¤±è´¥ï¼ŒåŒæ­¥é”ä¼šå‡çº§è‡³é‡é‡çº§é”ï¼Œé”æ ‡å¿—ä½æ”¹ä¸º10ã€‚åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼ŒæœªæŠ¢åˆ°é”çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ã€‚ https://blog.csdn.net/lkforce/article/details/81128115 æ€»ç»“è‡³æ­¤ï¼Œå‘¨å¿—åå…ˆç”Ÿçš„è¿™æœ¬ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ç¬¬ä¸‰ç‰ˆ å°±å·²ç»å…¨éƒ¨å¤ä¹ å®Œä¸€éäº†ï¼Œæ”¶è·å¾ˆå¤šï¼Œå¤§æ¦‚æ»¡æ‰“æ»¡ç®—èŠ±äº† 3 å¤©ã€Œ2020.03.05 ~ 2020.03.08ã€çš„æ—¶é—´å•ƒå®Œï¼Œæ¥ä¸‹æ¥è¿˜å¾—å†å¥½å¥½çœ‹çœ‹ï¼Œæœ‰äº›åœ°æ–¹æœ‰ç‚¹å›«å›µåæ£ï¼Œæ¯”å¦‚è¯´ç¬¬å…­ç« çš„ Class æ–‡ä»¶ç»“æ„ï¼Œå¹¶æ²¡æœ‰è‡ªå·±å»åˆ©ç”¨ idea ä¸­çš„ Jclasslib è®¤çœŸå»åˆ†æï¼Œè¿˜æœ‰å¾ˆå¤šåœ°æ–¹è™½ç„¶éƒ½æ˜¯è‡ªå·±æ•²å­—æ•²å‡ºæ¥çš„ï¼Œä½†æ˜¯æ•²å‡ºæ¥äº†å°±ç»™å¿˜äº†â€¦æ—¶é—´è¿˜æ˜¯å¤ªä»“ä¿ƒäº†â€¦æ€»è€Œè¨€ä¹‹ï¼Œç»§ç»­åŠ æ²¹å§ï¼]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>jvm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åå¤§å†…éƒ¨æ’åº]]></title>
    <url>%2F2019%2F10%2F27%2F%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F.html</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘ä¸€ç›´æ¯”è¾ƒå¿™ï¼Œé©¬ä¸Šå°±è¦è€ƒè¯•äº†ï¼Œæ‰€ä»¥LeetCodeç¨å¾®æš‚æ—¶æ”¾äº†æ”¾ï¼Œé›†ä¸­ç²¾åŠ›å›é¡¾äº†ä¸‹å†…éƒ¨æ’åºç®—æ³•ï¼Œæœ¬ç¯‡æ–‡ç« ä¼šå¯¹å¸¸è§çš„åå¤§å†…éƒ¨æ’åºç®—æ³•è¿›è¡Œç³»ç»Ÿçš„å›é¡¾ã€‚ æ¦‚è¿°ç®—æ³•åˆ†ç±»å¸¸è§æ’åºç®—æ³•å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š æ¯”è¾ƒæ’åºï¼šé€šè¿‡æ¯”è¾ƒæ¥å†³å®šå…ƒç´ é—´çš„ç›¸å¯¹æ¬¡åºï¼Œç”±äºå…¶æ—¶é—´å¤æ‚åº¦ä¸èƒ½çªç ´O(nlogn)ï¼Œå› æ­¤ä¹Ÿç§°ä¸ºéçº¿æ€§æ—¶é—´æ¯”è¾ƒç±»æ’åºã€‚ éæ¯”è¾ƒç±»æ’åºï¼šä¸é€šè¿‡æ¯”è¾ƒæ¥å†³å®šå…ƒç´ é—´çš„ç›¸å¯¹æ¬¡åºï¼Œå®ƒå¯ä»¥çªç ´åŸºäºæ¯”è¾ƒæ’åºçš„æ—¶é—´ä¸‹ç•Œï¼Œä»¥çº¿æ€§æ—¶é—´è¿è¡Œï¼Œå› æ­¤ä¹Ÿç§°ä¸ºçº¿æ€§æ—¶é—´éæ¯”è¾ƒç±»æ’åºã€‚ ç®—æ³•å¤æ‚åº¦ åœ¨è¿™é‡Œè¦è¯´æ˜çš„æ˜¯ï¼Œè¿™ä¸ªå›¾é‡Œçš„å¿«æ’ç©ºé—´å¤æ‚åº¦é”™äº†ï¼Œå¿«æ’çš„å¹³å‡ç©ºé—´å¤æ‚åº¦åº”è¯¥æ˜¯ O(logn)ï¼Œå°±æ˜¯æ ˆçš„æ·±åº¦ï¼Œä½†æ˜¯æœ€å·®çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚å…¨æ˜¯å€’åºï¼Œåˆ™ç©ºé—´å¤æ‚åº¦ä¸ºæ ˆæ·±åº¦ O(n)ã€‚å½’å¹¶æ’åºæ¯æ¬¡é€’å½’éœ€è¦ç”¨åˆ°ä¸€ä¸ªè¾…åŠ©è¡¨ï¼Œé•¿åº¦ä¸å¾…æ’åºçš„è¡¨ç›¸ç­‰ï¼Œè™½ç„¶é€’å½’æ¬¡æ•°æ˜¯O(log2n)ï¼Œä½†æ¯æ¬¡é€’å½’éƒ½ä¼šé‡Šæ”¾æ‰æ‰€å çš„è¾…åŠ©ç©ºé—´ï¼Œæ‰€ä»¥ä¸‹æ¬¡é€’å½’çš„æ ˆç©ºé—´å’Œè¾…åŠ©ç©ºé—´ä¸è¿™éƒ¨åˆ†é‡Šæ”¾çš„ç©ºé—´å°±ä¸ç›¸å…³äº†ï¼Œå› è€Œç©ºé—´å¤æ‚åº¦è¿˜æ˜¯ O(n)ã€‚ éƒ¨åˆ†è¡¥å…… ç¨³å®šï¼šå¦‚æœaåŸæœ¬åœ¨bå‰é¢ï¼Œè€Œa=bï¼Œæ’åºä¹‹åaä»ç„¶åœ¨bçš„å‰é¢ã€‚ ä¸ç¨³å®šï¼šå¦‚æœaåŸæœ¬åœ¨bçš„å‰é¢ï¼Œè€Œa=bï¼Œæ’åºä¹‹å a å¯èƒ½ä¼šå‡ºç°åœ¨ b çš„åé¢ã€‚ ä¸ç¨³å®šæ’åºç®—æ³•ï¼šè°éŸ³è®°å¿†æ³•ï¼šå¿«ï¼ˆå¿«æ’ï¼‰ äº›ï¼ˆå¸Œå°”ï¼‰é€‰ï¼ˆé€‰æ‹©ï¼‰å¯¹ï¼ˆå †ï¼‰ã€‚ æ€»å…±4ä¸ªä¸ç¨³å®šï¼Œ6ä¸ªç¨³å®šã€‚ å†’æ³¡æ’åºåŸºæœ¬æ€æƒ³å†’æ³¡æ’åºæ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ã€‚å®ƒé‡å¤åœ°èµ°è®¿è¿‡è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœå®ƒä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠå®ƒä»¬äº¤æ¢è¿‡æ¥ã€‚èµ°è®¿æ•°åˆ—çš„å·¥ä½œæ˜¯é‡å¤åœ°è¿›è¡Œç›´åˆ°æ²¡æœ‰å†éœ€è¦äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ•°åˆ—å·²ç»æ’åºå®Œæˆã€‚è¿™ä¸ªç®—æ³•çš„åå­—ç”±æ¥æ˜¯å› ä¸ºè¶Šå°çš„å…ƒç´ ä¼šç»ç”±äº¤æ¢æ…¢æ…¢â€œæµ®â€åˆ°æ•°åˆ—çš„é¡¶ç«¯ã€‚ ç®—æ³•æè¿° ä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªæ•°å­—ï¼Œä¸¤ä¸¤æ¯”è¾ƒï¼Œå¦‚æœå‰è€…æ¯”åè€…å¤§ï¼Œåˆ™äº¤æ¢ï¼Œä»¥æ­¤ç±»æ¨ï¼Œä¸€è½®ä¸‹æ¥ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªæœ€å¤§çš„æ•°ï¼› å½“æŸä¸€è½®æ²¡æœ‰äº§ç”Ÿä»»ä½•ä¸€æ¬¡äº¤æ¢ï¼Œåˆ™è¯´æ˜å†’æ³¡å®Œæˆã€‚ åŠ¨å›¾æ¼”ç¤º ä»£ç å®ç°1234567891011121314151617181920212223242526272829303132333435363738394041424344package æ’åº;import JAVA_I_O.Buffer.BufferedInputStream;import java.util.ArrayList;import java.util.Arrays;import java.util.Scanner;//æµ‹è¯•ç±»public class SortTest &#123; public static void main(String[] args) throws Exception &#123; System.out.println("è¯·è¾“å…¥ä¸€ä¸ªæ•°ç»„ï¼Œç”¨é€—å·åˆ†éš”ï¼š"); Scanner sc = new Scanner(System.in); String next = sc.nextLine(); String[] net = next.split(",");// String[] arr = Arrays.copyOf(net,net.length);// int[] arr = new int[0]; ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;Integer&gt;(); for (int i = 0 ; i &lt; net.length ; i++) &#123; arrayList.add(Integer.parseInt(net[i]));// System.out.println(arr[i]); &#125; int size = arrayList.size(); Integer[] arrInt = arrayList.toArray(new Integer[size]); int[] arr = new int[size]; for(int i = 0 ; i &lt; arrInt.length;i++)&#123; arr[i] = arrInt[i]; &#125;// System.out.println(arr[i]);// int[] InsertSortArray = Sort.InsertSort(arr);// int[] SelectSortArray = Sort.SelectSort(arr); Sort.BubbleSort(arr);// int[] ShellSortArray = Sort.ShellSort2(arr);// Sort.quickSort(arr,0,arr.length-1);// Sort.heapSort(arr,arr.length-1);// Sort.courtSort(arr);// Sort.BucketSort(arr);// Sort.radixSort(arr);// for (int i = 0 ; i &lt; ShellSortArray.length ; i++) &#123;// System.out.print(ShellSortArray[i] + " ");// &#125; &#125;&#125; 1234567891011121314151617181920212223242526272829 /** * å†’æ³¡ * * @param sortArray åŸå§‹æ•°ç»„ * @return æ’åºæ•°ç»„ */public static void BubbleSort(int[] sortArray) &#123; //å¤åˆ¶ä¸€ä»½åŸå§‹æ•°ç»„ï¼Œç”¨äºæ’åºæ“ä½œ int[] arr = Arrays.copyOf(sortArray, sortArray.length); //å¾ªç¯n-1è½®ï¼Œå‰©æœ€åä¸€ä¸ªå°±ä¸éœ€è¦äº¤æ¢äº† for (int i = 1; i &lt; arr.length; i++) &#123; //æ ‡å¿—ä½ï¼Œå½“ä¸€è½®ä¸‹æ¥æ²¡æœ‰ä»»ä½•å˜åŒ–æ—¶ï¼Œè¯´æ˜å†’æ³¡ç»“æŸï¼Œéœ€è¦ç»“æŸå¾ªç¯ boolean flag = true; //æ¯ä¸€è½®éƒ½è¦ä¸¤ä¸¤æ¯”è¾ƒï¼Œæ³¨æ„æ¯ä¸€è½®ç»“æŸéƒ½ä¼šç¡®è®¤ä¸€ä¸ªå€¼åœ¨æ­£ç¡®çš„ä½ç½®ä¸Šï¼Œæ‰€ä»¥jçš„éå†æ¬¡æ•°å¾—ç¨åŠ æ³¨æ„ for (int j = 0; j &lt; arr.length - i; j++) &#123; //ä½ç½®å˜åŒ–çš„åŒæ—¶è¯´æ˜å†’æ³¡æ²¡æœ‰ç»“æŸ if (arr[j] &gt; arr[j + 1]) &#123; int temp = arr[j]; arr[j] = arr[j + 1]; arr[j + 1] = temp; flag = false; &#125; &#125; if (flag) &#123; break; &#125; &#125; System.out.println(Arrays.toString(arr));&#125; ç®—æ³•æ•ˆç‡ æ—¶é—´å¤æ‚åº¦ï¼šå¾ˆæ˜æ˜¾ï¼Œçœ‹ä»£ç å°±çŸ¥é“ï¼Œå†’æ³¡æœ‰ä¸¤ä¸ªforå¾ªç¯ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹å’Œæœ€åæƒ…å†µä¸‹çš„å¤æ‚åº¦éƒ½ä¸ºO(nÂ²)ï¼Œæœ€å¥½çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ä¸€æ¬¡å†’æ³¡å°±å®Œæˆäº†ï¼Œå³ä¸ºO(n); ç©ºé—´å¤æ‚åº¦ï¼šåœ¨å†’æ³¡ä¸­ï¼Œåªç”¨äº†tempæ¥å­˜å‚¨ä¸­é—´å˜é‡äº¤æ¢ï¼Œæ²¡æœ‰ç”¨åˆ°å…¶ä»–ç©ºé—´(æˆ‘çš„ä»£ç ä¸­çš„å¤åˆ¶åˆå§‹æ•°ç»„çš„å®¹é‡å…¶å®å¯ä»¥çœå»)ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯O(1); ç¨³å®šæ€§ï¼šäº¤æ¢è¿‡ç¨‹ä¸­ï¼Œå¦‚æœç›¸é‚»ä¸¤è€…çš„å€¼ä¸€æ ·ï¼Œåˆ™ä¸ä¼šäº¤æ¢ï¼Œæ‰€ä»¥æ˜æ˜¾å†’æ³¡æ’åºæ˜¯ç¨³å®šçš„ã€‚ tips å¤–å¾ªç¯ n-1æ¬¡ï¼› æ³¨æ„æ·»åŠ æ ‡å¿—ä½ï¼Œåˆ¤æ–­å†’æ³¡æ˜¯å¦ç»“æŸï¼› æ³¨æ„å†…éƒ¨å¾ªç¯çš„æ¬¡æ•°ï¼Œæ¯å¤–éƒ¨å¾ªç¯ç»“æŸä¸€æ¬¡ï¼Œå°±ç¡®å®šä¸€ä¸ªæ•°çš„æœ€ç»ˆä½ç½®ã€‚ å¿«é€Ÿæ’åºåŸºæœ¬æ€æƒ³å¿«é€Ÿæ’åºï¼ˆQuicksortï¼‰æ˜¯å¯¹å†’æ³¡æ’åºçš„ä¸€ç§æ”¹è¿›ï¼Œå€Ÿç”¨äº†åˆ†æ²»çš„æ€æƒ³ï¼Œç”±C. A. R. Hoareåœ¨1962å¹´æå‡ºã€‚å®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šé€šè¿‡ä¸€è¶Ÿæ’åºå°†è¦æ’åºçš„æ•°æ®åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½æ¯”å¦å¤–ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½è¦å°ï¼Œç„¶åå†æŒ‰æ­¤æ–¹æ³•å¯¹è¿™ä¸¤éƒ¨åˆ†æ•°æ®åˆ†åˆ«è¿›è¡Œå¿«é€Ÿæ’åºï¼Œæ•´ä¸ªæ’åºè¿‡ç¨‹å¯ä»¥é€’å½’è¿›è¡Œï¼Œä»¥æ­¤è¾¾åˆ°æ•´ä¸ªæ•°æ®å˜æˆæœ‰åºåºåˆ—ã€‚ ç®—æ³•æè¿° é¦–å…ˆé€‰å®šä¸€ä¸ªåŸºå‡†å€¼ï¼ˆpivotï¼‰ï¼Œæˆ‘ä¸€èˆ¬çš„åšæ³•æ˜¯é€‰å®šæœ€å·¦è¾¹çš„ä½œä¸ºåŸºå‡†ï¼› å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘æœ€å³è¾¹ï¼Œä¸€ä¸ªæŒ‡å‘æœ€å·¦è¾¹ï¼Œç„¶åæ³¨æ„è®©å³è¾¹çš„å…ˆåŠ¨ï¼Œç­‰å³è¾¹æŒ‡é’ˆæ‰€æŒ‡çš„æ•°å€¼å°äºpivotæ—¶ï¼Œå³è¾¹æŒ‡é’ˆä¸å†å¾€å·¦èµ°ï¼Œä¸å‡†åŠ¨äº†ï¼Œç„¶åç§»åŠ¨å·¦è¾¹æŒ‡é’ˆï¼Œç­‰å·¦è¾¹æŒ‡é’ˆæ‰€æŒ‡å‘çš„æ•°å€¼å¤§äºpivotæ—¶ï¼Œå·¦è¾¹æŒ‡é’ˆåœä¸‹ï¼Œä¸å†å‘å³ç§»åŠ¨ï¼Œç„¶åäºŒè€…äº¤æ¢ï¼› äº¤æ¢å®Œæ¯•åï¼Œé‡å¤ç¬¬äºŒæ­¥ï¼Œå³è¾¹æŒ‡é’ˆç»§ç»­å‘å·¦ï¼Œé‡å¤ï¼› ç›´åˆ°å·¦å³ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡ï¼Œä¸¤ä¸ªéƒ½åœä¸‹ï¼Œå°†æŒ‡å‘çš„æ•°å€¼å’Œpivotäº¤æ¢ï¼Œè‡³æ­¤æ•°ç»„å°±åˆ†æˆäº†ä¸¤ä¸ªå­æ•°ç»„ï¼Œpivotå·¦ä¾§æ¯”å…¶å°ï¼Œå³è¾¹æ¯”å…¶å¤§ï¼› ç„¶åé€’å½’å­æ•°ç»„ï¼Œç›´åˆ°å­æ•°ç»„ä¸º0ï¼ˆlow &gt; highï¼‰ã€‚ åŠ¨å›¾æ¼”ç¤º ä»£ç å®ç°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/** * å¿«é€Ÿæ’åº * åç»­æ‰€æœ‰æµ‹è¯•éƒ½è·Ÿå†’æ³¡é‚£ç« å†™çš„ä¸€æ · * @param sortArray åŸå§‹æ•°ç»„ * @param low æœ€å·¦ä¾§ * @param high æœ€å³ä¾§ */public static void quickSort(int[] sortArray, int low, int high) &#123; //å½“low = high æ—¶ï¼Œè¯´æ˜å­æ•°ç»„åªå‰©ä¸€ä¸ªæ•°äº†ï¼Œè¿˜æ’ä¸ªé”¤å­å•Š if (low &lt; high) &#123; //æ‹¿åˆ°åŸºå‡†å€¼ï¼Œè¿™æ ·å°±å¯ä»¥æ„‰å¿«çš„é€’å½’äº† int pivot = partition(sortArray, low, high); //æ³¨æ„å“¦ï¼Œé€’å½’æ—¶å¯æ²¡æœ‰æŠŠpivotæ”¾å…¥å…¶ä¸­ quickSort(sortArray, low, pivot - 1); quickSort(sortArray, pivot + 1, high); System.out.println(Arrays.toString(sortArray)); &#125;&#125;/** * å¿«æ’ä¸»æ€è·¯ * @param sortArray * @param low * @param high * @return */private static int partition(int[] sortArray, int low, int high) &#123; //æˆ‘ä¸ªäººä¹ æƒ¯æ˜¯æŠŠæœ€å·¦è¾¹å®šä¸ºåŸºå‡†å€¼ï¼Œå…·ä½“æ–¹æ³•æœ‰å¾ˆå¤šå•¦ï¼Œéšä¾¿ä½ ï¼Œçˆ±å’‹å’‹çš„ int pivot = low; //å®šä¹‰å·¦å³ä¸¤æŒ‡é’ˆ int p = low; int q = high; //ç›¸é‡å°±ç»“æŸäº†å“ˆï¼Œç„¶åç›´æ¥äº¤æ¢åŸºå‡†å’ŒæŒ‡å‘çš„æ•°å€¼å°±è¡Œå’¯ while (p &lt; q) &#123; //æ²¡ç›¸é‡å¹¶ä¸”å³æŒ‡é’ˆæŒ‡å‘çš„å€¼æ¯”åŸºå‡†å€¼å¤§ï¼Œå°±å‘å·¦ç§»åŠ¨ï¼Œè‹¥æ¯”åŸºå‡†å€¼å°ï¼Œé‚£å°±å¾—åœä¸‹ while (p &lt; q &amp;&amp; sortArray[pivot] &lt;= sortArray[q]) q--; while (p &lt; q &amp;&amp; sortArray[pivot] &gt;= sortArray[p]) p++; //éƒ½åœä¸‹äº†å°±äº¤æ¢å­ï¼ swap(sortArray, p, q); &#125; swap(sortArray, pivot, p); //ä¸è¦å¿˜è®°æœ€åè¦è¿”å›è¿™ä¸ªåŸºå‡†å€¼ return p;&#125;public static void swap(int[] sum, int i, int j) &#123; int temp = sum[i]; sum[i] = sum[j]; sum[j] = temp;&#125; ç®—æ³•æ•ˆç‡å¿«æ’å˜›ï¼Œç”¨äº†åˆ†æ²»çš„æ€æƒ³å’¯ï¼Œæ‰€ä»¥å¤æ‚åº¦è‚¯å®šæ˜¯æ¯”å†’æ³¡ä½çš„ï¼Œè‡³äºæ˜¯å¤šå°‘ï¼Œæˆ‘ä»¬ç¨åŠ åˆ†æä¸€ä¸‹ï¼š æ—¶é—´å¤æ‚åº¦ï¼šåˆ†æ²»æ€æƒ³ï¼Œä½†æ˜¯ç»å£ä¸æ˜¯çº¿æ€§çš„ï¼Œå› ä¸ºå®ƒä¸€è½®ä¸‹æ¥ææ¥æå»ï¼Œäº¤æ¢è¿™äº¤æ¢é‚£çš„ï¼Œæ‰€ä»¥ä¸€è½®æ˜¯O(n),ç»¼åˆå‰é¢çš„åˆ†æ²»å°±æ˜¯nlogNäº†ã€‚æˆ‘è¯´çš„æ˜¯æœ€å¥½æƒ…å†µå’Œå¹³å‡æƒ…å†µå“ˆï¼Œæœ€åé‚£è‚¯å®šè¿˜æ˜¯O(nÂ²)ï¼Œå› ä¸ºå¯èƒ½ä½ å¾ˆä¸å¹¸ï¼ŒåŸºå‡†å€¼å°±æ˜¯æœ€å¤§çš„ï¼Œç„¶åå°±å¾—ç–¯ç‹‚äº¤æ¢ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šä¸ççš„éƒ½çœ‹å¾—å‡ºæ¥ï¼Œå°±ç”¨äº†ä¸€ä¸ªtempä¸­é—´å˜é‡ç”¨æ¥å­˜å€¼ï¼Œæ‰€ä»¥æ˜¯O(1) ã€‚ ç¨³å®šæ€§ï¼šå“å‘€è‚¯å®šæ˜¯ä¸ç¨³å®šçš„å•Šï¼Œä¸¤ä¸ªæŒ‡é’ˆåœ¨é‚£æ¢æ¥æ¢å»ï¼Œèƒ½ç¨³å®šå˜›â€¦ tips æ³¨æ„é€’å½’æ—¶çš„å­ä¸²æ˜¯ä¸åŒ…æ‹¬pivotçš„ï¼Œä¸€ä¸ªæ˜¯(low,pivot-1)ï¼Œä¸€ä¸ªæ˜¯(pivot+1,high)ï¼› ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡ï¼Œä¸ç”¨åˆ¤æ–­å’Œpivotå€¼çš„å¤§å°ï¼Œç›´æ¥äº¤æ¢å³å¯ï¼Œå› ä¸ºä¸¤ä¸ªæŒ‡é’ˆåªä¼šæœ‰ä¸€ä¸ªåœ¨ç§»åŠ¨ï¼Œé‚£ä¹ˆæ­¤æ—¶æ­¤åˆ»å¦ä¸€ä¸ªæŒ‡é’ˆä¸€å®šæ˜¯é™æ­¢çš„ï¼Œå‡å¦‚æ­¤æ—¶æ˜¯å³è¾¹çš„æŒ‡é’ˆç§»åŠ¨ï¼Œé‚£ä¹ˆç›¸é‡çš„ä½ç½®å³å·¦æŒ‡é’ˆåœä¸‹çš„ä½ç½®ï¼Œè€Œå·¦æŒ‡é’ˆåœä¸‹è¯´æ˜ä¹‹å‰å³è¾¹æŒ‡é’ˆä¹Ÿåœä¸‹æ¥è¿‡å¹¶ä¸”å’Œå·¦è¾¹æŒ‡é’ˆæŒ‡å‘çš„æ•°è¿›è¡Œäº†äº¤æ¢(å› ä¸ºåªæœ‰å³è¾¹åœä¸‹ï¼Œå·¦è¾¹æ‰èƒ½ç§»åŠ¨)ï¼Œé‚£ä¹ˆæ­¤æ—¶å·¦è¾¹æŒ‡å‘çš„æ•°æ˜¯ä¸€å®šæ¯”pivotå°çš„ï¼Œæ‰€ä»¥å¿…ç„¶å¯ä»¥ç›´æ¥äº¤æ¢ï¼Œæ¢ä¸ªè§’åº¦è€ƒè™‘ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ è¿˜æœ‰ï¼Œæˆ‘ä¸€ç›´å¼ºè°ƒå¿…é¡»å³æŒ‡é’ˆå…ˆåŠ¨(å…¶å®åªè¦æ˜¯å’ŒåŸºå‡†ç›¸åæ–¹å‘çš„æŒ‡é’ˆå…ˆåŠ¨å°±è¡Œ)ï¼Œä¸ºä»€ä¹ˆæï¼Œå› ä¸ºå˜›ï¼Œç»™ä½ ä¸¾ä¸ªä¾‹å­å§ï¼Œå‡å¦‚æœ‰è¿™æ ·ä¸€ä¸ªæ•°ç»„ 9,3,4,5,6,7,10 ,å·¦è¾¹çš„å…ˆåŠ¨é‚£å°±å‡‰äº†å•Šï¼Œå› ä¸ºæœ€åä½ éƒ½å®šåœ¨10ï¼Œä¸€å«æ¢å°±å˜æˆäº†10,3,4,5,6,7,9ï¼Œè¿™è¿˜ç©ä¸ªé”¤å­å•Šâ€”â€”â€”â€“&gt; å¿«æ’ä»å³è¾¹å¼€å§‹çš„åŸå›  è‡³äºå¿«æ’çš„ä¼˜åŒ– é‡‡ç”¨ä¸‰æ•°å–ä¸­æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768package æ’åº.äºŒåˆ·æ’åº;import java.util.Arrays;import java.util.Scanner;public class quickSort &#123; public static void main(String[] args) &#123; Scanner scanner = new Scanner(System.in); System.out.print("è¯·è¾“å…¥æ•°ç»„çš„å¤§å°ï¼š "); int len = scanner.nextInt(); int[] nums = new int[len]; for (int i = 0;i &lt; len;i++)&#123; nums[i] = scanner.nextInt(); &#125; quick(nums,0,len-1); System.out.println(Arrays.toString(nums)); &#125; public static void quick(int[] nums,int left,int right)&#123; if(left &lt; right)&#123; int partition = partition(nums,left,right); quick(nums,left,partition-1); quick(nums,partition+1,right); &#125; &#125; private static int partition(int[] nums, int left, int right) &#123; // åŸºå‡†å€¼ // ä¼˜åŒ–ï¼Œå°±æ˜¯å°½é‡èƒ½åšåˆ°åˆ†æ²»ï¼Œä¹Ÿå°±æ˜¯é€‰å–çš„åŸºå‡†å€¼å°½é‡åœ¨ä¸­é—´æ˜¯æ€§èƒ½æœ€å¥½çš„ int mid = (left + right)/2; dealPivot(nums,left,mid,right); int pivot = left; // å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆ int p = left; int q = right; while(p &lt; q)&#123; while(p &lt; q &amp;&amp; nums[q] &gt;= nums[pivot])&#123; q--; &#125; while(p &lt; q &amp;&amp; nums[p] &lt;= nums[pivot])&#123; p++; &#125; swap(nums,p,q); &#125; swap(nums,p,pivot); return p; &#125; private static void dealPivot(int[] nums, int left, int mid, int right) &#123; if((left - mid) * (mid - right) &gt; 0)&#123; // left &lt; mid &lt; right swap(nums,left,mid); return; &#125; else if((mid - left) * (left - right) &gt; 0)&#123; // left æ˜¯ä¸­é—´å€¼ return; &#125; swap(nums,left,right); return; &#125; private static void swap(int[] nums, int p, int q) &#123; int temp = nums[p]; nums[p] = nums[q]; nums[q] = temp; &#125;&#125; ä¸‰è·¯å¿«æ’ï¼Œè¿™ä¸ªé€‚ç”¨äºæœ‰å¤§é‡ç›¸åŒæ•°å­—çš„æ•°ç»„ ã€ŒLeetCode ç¬¬ 75 é¢˜ã€ https://www.bilibili.com/video/av73100790?from=search&amp;seid=4070762078682607758 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354class quickSortByThree&#123; public static void main(String[] args) &#123; Scanner scanner = new Scanner(System.in); System.out.print("è¯·è¾“å…¥è¦è¾“å…¥çš„æ’åºæ•°ç»„çš„é•¿åº¦ï¼š" ); int len = scanner.nextInt(); int[] nums = new int[len]; for(int i = 0; i &lt; len;i++)&#123; nums[i] = scanner.nextInt(); &#125; quickSortByThreeWays(nums,0,len-1); System.out.println(Arrays.toString(nums)); &#125; private static void quickSortByThreeWays(int[] nums, int left, int right) &#123; if(left &lt; right)&#123; // æ­¤æ—¶éœ€è¦è¿”å›çš„å€¼æ˜¯ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯åŸºå‡†å€¼çš„æœ€ç»ˆä½ç½®ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯ä¸åŸºå‡†å€¼ç›¸åŒçš„æœ€åä¸€ä¸ªæ•°çš„ä½ç½® // é€‚ç”¨äºå¾ˆå¤šç›¸åŒæ•°å­—çš„æ•°ç»„æ’åºï¼Œå®˜æ–¹çš„ Arrays.sort() ä¹Ÿæ˜¯é‡‡ç”¨çš„ä¸‰è·¯å¿«æ’ int[] par = quickThreePartition(nums,left,right); int lt = par[0]; int gt = par[1]; quickSortByThreeWays(nums,left,lt-1); quickSortByThreeWays(nums,gt+1,right); &#125; &#125; private static int[] quickThreePartition(int[] nums, int left, int right) &#123; int pivot = left; // å®šä¹‰ä¸‰ä¸ªæŒ‡é’ˆ int cur = left + 1; int lt = left + 1; // nums[left...lt-1] éƒ½æ˜¯ å°äº pivot çš„ int gt = right; // nums[gt...right] éƒ½æ˜¯ å¤§äº pivot çš„ while(cur &lt;= gt)&#123; if(nums[cur] &lt; nums[pivot])&#123; swap(nums,cur,lt); cur++; lt++; &#125; else if(nums[cur] &gt; nums[pivot])&#123; swap(nums,gt,cur); gt--; &#125; else cur++; &#125; swap(nums,lt-1,pivot); return new int[]&#123;lt-1,gt&#125;; &#125; private static void swap(int[] nums, int p, int q) &#123; int temp = nums[p]; nums[p] = nums[q]; nums[q] = temp; &#125;&#125; ç®€å•æ’å…¥æ’åºåŸºæœ¬æ€æƒ³çœ‹åå­—å­ï¼Œæ’å…¥ï¼Œè¿˜å°¼ç›ç®€å•æ’å…¥ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŠŠè¿™ä¸ªå¾…æ’åºæ•°ç»„çœ‹æˆæ˜¯ä¸€æ­¥æ­¥æ’å¥½çš„æ•°ç»„ï¼Œç”¨çš„æ˜¯æœ€ç®€å•çš„æ–¹æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚ ç®—æ³•æè¿°ä¸€èˆ¬æ¥è¯´ï¼Œæ’å…¥æ’åºéƒ½é‡‡ç”¨ in-place åœ¨æ•°ç»„ä¸Šå®ç°ã€‚å…·ä½“ç®—æ³•æè¿°å¦‚ä¸‹ï¼š ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æ’åºï¼› å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼› å¦‚æœè¯¥å…ƒç´ ï¼ˆå·²æ’åºï¼‰å¤§äºæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ ç§»åˆ°ä¸‹ä¸€ä½ç½®ï¼› é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æ’åºçš„å…ƒç´ å°äºæˆ–è€…ç­‰äºæ–°å…ƒç´ çš„ä½ç½®ï¼› å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥ä½ç½®åï¼› é‡å¤æ­¥éª¤2~5ã€‚ æ³¨ï¼šå•¥æ˜¯in-placeçŸ¥é“ä¸ï¼šåŸåœ°ç®—æ³•) åŠ¨å›¾æ¼”ç¤º ä»£ç å®ç°1234567891011121314151617181920212223/** * ç›´æ¥æ’å…¥æ’åº * æˆ‘æ²¡æœ‰in-placeå“ˆï¼Œä½†æ˜¯æ˜¯å¯ä»¥çš„ * @param SortArray åŸå§‹æ•°ç»„ * @return æ’åºæ•°ç»„ */ public static void InsertSort(int[] SortArray) &#123; int[] arr = Arrays.copyOf(SortArray, SortArray.length); //ä»1å¼€å§‹å“¦ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ•°é»˜è®¤æ˜¯æ’å¥½åºçš„å•¦ for (int i = 1; i &lt; arr.length; i++) &#123; int temp = arr[i]; int j = i; for (; (j &gt; 0 &amp;&amp; arr[j - 1] &gt; temp); j--) &#123; //è¿™ä¸€æ­¥æœ€å…³é”®ï¼Œå› ä¸ºè¦æ³¨æ„æ¯å½“æ’å…¥ä¸€ä¸ªæ•°å­—ï¼Œå…¶åé¢éƒ½è¦å¾€åé¡ºç§»ä¸€ä½ï¼Œä¸ç„¶çš„è¯å°±ç©ºä¸å‡ºè¦æ’å…¥çš„ä½ç½®ï¼ï¼ï¼ arr[j] = arr[j - 1]; &#125; //å¦‚æœæ²¡æœ‰å˜åŒ–ï¼Œåˆ™tempä¾ç„¶ç­‰äºarr[i],å¦‚æœå˜åŒ–ï¼Œåˆ™å°†arr[i]ç§»åŠ¨è¿‡æ¥å°±è¡Œ //æ³¨æ„ä¸èƒ½ç›´æ¥arr[j] = arr[i]å“¦ï¼Œå› ä¸ºæ­¤æ—¶çš„iç´¢å¼•å€¼å·²ç»å¯èƒ½å˜åŒ–å•¦ï¼ï¼ï¼ï¼tempéå¸¸çš„å…³é”®ï¼ï¼ arr[j] = temp; &#125; System.out.println(Arrays.toString(arr)); &#125; ç®—æ³•æ•ˆç‡ æ—¶é—´å¤æ‚åº¦ï¼šè¿™ç§ç›´æ¥æ’å…¥éº»çƒ¦çš„ä¸€ç¬”ï¼Œå¦‚æœæ˜¯åŸæ•°ç»„æ˜¯å€’åºï¼Œé‚£æ¯ä¸€è½®éƒ½å¾—ç–¯ç‹‚æ’ï¼Œæ¯«æ— ç–‘é—®æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(nÂ²)ï¼Œæœ€å¥½çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ä¸€æ¬¡éƒ½ä¸ç”¨ç»™åæ¥è€…è®©ä½ï¼Œé‚£ä¹ˆå°±æ˜¯çº¿æ€§å¤æ‚åº¦äº†O(n)ï¼Œå¹³å‡ä¸‹æ¥ä¾æ—§æ˜¯O(Â²)ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šin-place,O(1) ã€‚ ç¨³å®šæ€§ï¼šå½“ç„¶æ˜¯ç¨³å®šçš„å•¦ï¼ tips æ³¨æ„æ’å…¥çš„æ—¶å€™æ˜¯å°†æ¯”æ’å…¥çš„æ•°å¤§çš„å·²ç»æ’åºå¥½çš„æ•°å…¨éƒ¨åç§»ä¸€ä½å“¦ï¼ï¼ï¼ç»™æœ•è®©ä½çš„èµ¶è„šâ€¦ ç”¨tempæ¥ä¿å­˜å½“å‰éœ€è¦æ’å…¥çš„æ•°æ®æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™ä¹Ÿæ˜¯æ’å…¥æ’åºå”¯äºŒéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œè¿˜è¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯å…¨éƒ¨åç§»ä¸€ä½ã€‚ å¸Œå°”æ’åºåŸºæœ¬æ€æƒ³å¸Œå°”æ’åºåˆå«ç¼©å°å¢é‡æ’åºï¼Œ1959å¹´Shellå‘æ˜ã€‚æ˜¯æ’å…¥æ’åºçš„ä¸€ç§é«˜é€Ÿè€Œç¨³å®šçš„æ”¹è¿›ç‰ˆæœ¬ã€‚ å¸Œå°”æ’åºæ˜¯å…ˆå°†æ•´ä¸ªå¾…æ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œå¾…æ•´ä¸ªåºåˆ—ä¸­çš„è®°å½•â€œåŸºæœ¬æœ‰åºâ€æ—¶ï¼Œå†å¯¹å…¨ä½“è®°å½•è¿›è¡Œä¾æ¬¡ç›´æ¥æ’å…¥æ’åºã€‚ ç®—æ³•æè¿°å¸Œå°”æ’åºæœ‰nç§æ­¥é•¿æ–¹å¼ï¼Œè¿™é‡Œä»‹ç»ä¸¤ç§ï¼Œä¸€ç§æ˜¯å¾ªç¯æŠ˜åŠï¼Œå¦ä¸€ç§æ˜¯ gap = gap * 3 + 1ã€‚ å…·ä½“ï¼šå¸Œå°”æ’åºå¢é‡åºåˆ—ä»‹ç» ã€‚ å…ˆå°†æ•´ä¸ªå¾…æ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œå…·ä½“ç®—æ³•æè¿°ï¼š é€‰æ‹©ä¸€ä¸ªå¢é‡åºåˆ—t1ï¼Œt2ï¼Œâ€¦ï¼Œtkï¼Œå…¶ä¸­ti&gt;tjï¼Œtk=1ï¼› æŒ‰å¢é‡åºåˆ—ä¸ªæ•°kï¼Œå¯¹åºåˆ—è¿›è¡Œk è¶Ÿæ’åºï¼› æ¯è¶Ÿæ’åºï¼Œæ ¹æ®å¯¹åº”çš„å¢é‡tiï¼Œå°†å¾…æ’åºåˆ—åˆ†å‰²æˆè‹¥å¹²é•¿åº¦ä¸ºm çš„å­åºåˆ—ï¼Œåˆ†åˆ«å¯¹å„å­è¡¨è¿›è¡Œç›´æ¥æ’å…¥æ’åºã€‚ä»…å¢é‡å› å­ä¸º1 æ—¶ï¼Œæ•´ä¸ªåºåˆ—ä½œä¸ºä¸€ä¸ªè¡¨æ¥å¤„ç†ï¼Œè¡¨é•¿åº¦å³ä¸ºæ•´ä¸ªåºåˆ—çš„é•¿åº¦ã€‚ åŠ¨å›¾æ¼”ç¤º ä»£ç å®ç°1234567891011121314151617181920212223/*** å…¶å®å°±æ˜¯å°†ç›´æ¥æ’å…¥æ’åºçš„é—´éš”1å˜ä¸ºæ›´å¤§ï¼Œä¹Ÿå°±æ˜¯å…¶å®å°±å¤šäº†ä¸€ä¸ªå¾ªç¯ï¼Œå°±æ˜¯å¤šæ¬¡ç¼©å°é—´éš”çš„å¾ªç¯ï¼Œå…¶ä»–è·Ÿç›´æ¥æ’å…¥æ˜¯ä¸€æ ·çš„** @param sortArray* @return*/ public static int[] ShellSort2(int[] sortArray) &#123; int[] arr = Arrays.copyOf(sortArray, sortArray.length); int size = sortArray.length; for (int increment = size / 2; increment &gt; 0; increment /= 2) &#123; for (int i = increment; i &lt; size; i++) &#123; int temp = arr[i]; int j = i; for (; (j &gt; 0 &amp;&amp; arr[j - increment] &gt; temp); j -= increment) &#123; //è¿™ä¸€æ­¥æœ€å…³é”®ï¼Œå› ä¸ºè¦æ³¨æ„æ¯å½“æ’å…¥ä¸€ä¸ªæ•°å­—ï¼Œå…¶åé¢éƒ½è¦å¾€åé¡ºç§»incrementä½ï¼Œä¸ç„¶çš„è¯å°±ç©ºä¸å‡ºè¦æ’å…¥çš„ä½ç½®ï¼ï¼ï¼ arr[j] = arr[j - increment]; &#125; //å¦‚æœæ²¡æœ‰å˜åŒ–ï¼Œåˆ™tempä¾ç„¶ç­‰äºarr[i],å¦‚æœå˜åŒ–ï¼Œåˆ™å°†arr[i]ç§»åŠ¨è¿‡æ¥å°±è¡Œ arr[j] = temp; &#125; &#125; return arr; &#125; 12345678910111213141516171819202122232425262728293031 /** * ä¸æ˜¯æˆ‘å†™çš„ * * @param sourceArray * @return * @throws Exception */public static int[] ShellSort1(int[] sourceArray) throws Exception &#123; // å¯¹ arr è¿›è¡Œæ‹·è´ï¼Œä¸æ”¹å˜å‚æ•°å†…å®¹ int[] arr = Arrays.copyOf(sourceArray, sourceArray.length); int gap = 1; while (gap &lt; arr.length) &#123; gap = gap * 3 + 1; &#125; while (gap &gt; 0) &#123; for (int i = gap; i &lt; arr.length; i++) &#123; int tmp = arr[i]; int j = i; for (; j &gt;= 0 &amp;&amp; arr[j - gap] &gt; tmp; j -= gap) &#123; arr[j] = arr[j - gap]; &#125; arr[j] = tmp; &#125; gap = (int) Math.floor(gap / 3); &#125; return arr;&#125; ç®—æ³•æ•ˆç‡ æ—¶é—´å¤æ‚åº¦ï¼šæœ€åå’Œæœ€å¥½æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè¿™ä¸ªå°±è·Ÿç›´æ¥æ’å…¥æ²¡åŒºåˆ«ï¼Œæœ€å¥½æœ€åéƒ½æ˜¯å–å†³äºåŸæ•°ç»„åºåˆ—ï¼Œæ‰€ä»¥æœ€å¥½çš„æ—¶é—´å¤æ‚åº¦ä¾æ—§æ˜¯O(n)ï¼Œæœ€åçš„æ—¶é—´å¤æ‚åº¦ä¾æ—§æ˜¯O(nÂ²)ï¼Œå¹³å‡å¤æ‚åº¦ï¼Ÿæˆ‘tmä¹Ÿä¸çŸ¥é“ä¸ºå•¥ï¼Œè®°ä½å°±æ˜¯å•¦ï¼ŒO(n^1.3)ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šè¿™ä¸ªç®€å•çš„ä¸€æ‰¹ï¼Œè¿˜ä¸å°±æ˜¯O(1)ã€‚ ç¨³å®šæ€§ï¼šè¿™ç§è·³è·ƒæ€§çš„å½“ç„¶æ˜¯ä¸ç¨³å®šäº†ã€‚ä¾‹å¦‚arr = {3,2,2}ã€‚ tipsç®€å•çš„ä¸€æ‰¹â€¦ä¸å°±æ˜¯æŠŠç›´æ¥æ’å…¥çš„1å˜æˆ increment å˜› â€¦â€¦ æ²¡å•¥éœ€è¦æ³¨æ„çš„ï¼ å•Šï¼ï¼ï¼ä¸å¯¹ï¼Œå…¶å®è¿˜æ˜¯æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ï¼ï¼ï¼ è¿™é‡Œæ˜¯ä¸‰é‡å¾ªç¯ï¼Œå› ä¸ºé‚£ä¸ªæ­¥é•¿è¦å˜åŒ–ï¼Œç„¶åä¸åŒæ­¥é•¿éƒ½è¦è¿›è¡Œæ’åºï¼Œä¸€æ¬¡æ’åºæ˜¯ä¸¤é‡å¾ªç¯ over ç®€å•é€‰æ‹©æ’åºåŸºæœ¬æ€æƒ³é€‰æ‹©æ’åºï¼Œæ„åœ¨çªå‡ºé€‰æ‹© äºŒå­—ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯æœ‰ä¸€ä¸ªé€‰æ‹©çš„è¿‡ç¨‹ï¼Œè‡³äºç®€å•é€‰æ‹©ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯éå¸¸éå¸¸ç®€å•çš„é€‰æ‹©æ’åºï¼Œé‚£ä¸å°±æ˜¯æ¯æ¬¡éƒ½æ‰¾ä¸ªæœ€å°å€¼å¾€å‰æ‰”å˜›â€¦ é€‰æ‹©æ’åº(Selection-sort)æ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†ï¼šé¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ï¼Œç„¶åï¼Œå†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚ ç®—æ³•æè¿°nä¸ªè®°å½•çš„ç›´æ¥é€‰æ‹©æ’åºå¯ç»è¿‡ n-1 è¶Ÿç›´æ¥é€‰æ‹©æ’åºå¾—åˆ°æœ‰åºç»“æœã€‚å…·ä½“ç®—æ³•æè¿°å¦‚ä¸‹ï¼š(è¿™ä¹ˆå®˜æ–¹è‚¯å®šæ˜¯å¤åˆ¶çš„å•¦å“ˆå“ˆå“ˆå“ˆå“ˆ) åˆå§‹çŠ¶æ€ï¼šæ— åºåŒºä¸ºR[1..n]ï¼Œæœ‰åºåŒºä¸ºç©ºï¼› ç¬¬iè¶Ÿæ’åº(i=1,2,3â€¦n-1)å¼€å§‹æ—¶ï¼Œå½“å‰æœ‰åºåŒºå’Œæ— åºåŒºåˆ†åˆ«ä¸ºR[1..i-1]å’ŒR(i..nï¼‰ã€‚è¯¥è¶Ÿæ’åºä»å½“å‰æ— åºåŒºä¸­-é€‰å‡ºå…³é”®å­—æœ€å°çš„è®°å½• R[k]ï¼Œå°†å®ƒä¸æ— åºåŒºçš„ç¬¬1ä¸ªè®°å½•Räº¤æ¢ï¼Œä½¿R[1..i]å’ŒR[i+1..n)åˆ†åˆ«å˜ä¸ºè®°å½•ä¸ªæ•°å¢åŠ 1ä¸ªçš„æ–°æœ‰åºåŒºå’Œè®°å½•ä¸ªæ•°å‡å°‘1ä¸ªçš„æ–°æ— åºåŒºï¼›(è¿™ç§å±è¯è¯»èµ·æ¥ç®€ç›´å°±æ˜¯æµªè´¹ç”Ÿå‘½) n-1è¶Ÿç»“æŸï¼Œæ•°ç»„æœ‰åºåŒ–äº†ã€‚ æ³¨ï¼šå°±æ˜¯è¯´ â€”â€”â€“ æ¯æ¬¡éå†æ•°ç»„éƒ½é€‰ä¸€ä¸ªæœ€å°çš„æ‰”åˆ°æœ€å‰é¢ï¼ˆè·Ÿè¦æ‰”çš„ä½ç½®çš„æ•°è¿›è¡Œäº¤æ¢ï¼‰ï¼Œç„¶åä»å‰©ä¸‹çš„è¿˜æ²¡æ’åºçš„ç»§ç»­éå†ï¼Œç»§ç»­æ‰”ï¼Œæ‰”äº†n-1æ¬¡å°±ç»“æŸäº†å­ã€‚ åŠ¨å›¾æ¼”ç¤º ä»£ç å®ç°1234567891011121314151617181920212223242526272829/** * ç®€å•é€‰æ‹©æ’åº * * @param SortArray åŸå§‹æ•°ç»„ * @return æ’åºæ•°ç»„ */public static int[] SelectSort(int[] SortArray) &#123; int[] arr = Arrays.copyOf(SortArray, SortArray.length); //æ³¨æ„æ˜¯n-1è½®ï¼Œä¸€è½®ä¸€ä¸ªæœ€å°å€¼ï¼Œæœ€åé‚£ä¸ªä¸ç”¨è½®äº† for (int i = 0; i &lt; arr.length - 1; i++) &#123; //æœ€å¼€å§‹é»˜è®¤ç¬¬ä¸€ä¸ªæ˜¯æœ€å°çš„ï¼Œç„¶åè¿›å…¥å†…å±‚å¾ªç¯ï¼Œåˆ†åˆ«è¿›è¡Œæ¯”è¾ƒï¼Œä¸€å®šè¦è®°å½•ä¸‹minçš„ä¸‹æ ‡ï¼Œè¿™æ˜¯æœ€åæ¯”è¾ƒå®Œäº¤æ¢çš„å…³é”® //æ¯ä¸€æ¬¡å¾ªç¯çš„ç›®çš„å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªæœ€å°å€¼ï¼Œç„¶åä¸å½“å‰å¤–éƒ¨å¾ªç¯çš„å€¼è¿›è¡Œä¸€ä¸ªäº¤æ¢ int min = i; for (int j = i + 1; j &lt; arr.length; j++) &#123; //min = Math.min(min,arr[j]); if (arr[min] &gt; arr[j]) &#123; min = j; &#125; &#125; //åˆ¤æ–­æ˜¯å¦éœ€è¦äº¤æ¢ if (i != min) &#123; int temp = arr[i]; arr[i] = arr[min]; arr[min] = temp; &#125; &#125; return arr;&#125; ç®—æ³•æ•ˆç‡å¿…é¡»è¦åæ§½çš„æ˜¯ï¼Œè¿™ä¸ªç›´æ¥é€‰æ‹©æ’åºæ˜¯åƒåœ¾ä¸­çš„æˆ˜æ–—æœºï¼Œå› ä¸ºå®ƒæ— è§†ä»»ä½•æ•°ç»„ï¼Œå¹²å•¥éƒ½æ˜¯åºŸç‰©çš„O(nÂ²)æ—¶é—´å¤æ‚åº¦ï¼ï¼ï¼ï¼ï¼ï¼ï¼ æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²) ï¼› ç©ºé—´å¤æ‚åº¦ï¼šO(1) ï¼› ç¨³å®šæ€§ï¼šå½“ç„¶æ˜¯ä¸ç¨³å®šçš„äº†ï¼Œæ¶‰åŠåˆ°çé¸¡å„¿äº¤æ¢ï¼ˆä¸ä¸´è¿‘ï¼‰çš„ï¼Œå°±è‚¯å®šä¸ç¨³å®šçš„å•¦ã€‚ tipsæ²¡å•¥æ³¨æ„ç‚¹ï¼Œå°±æ˜¯éå¸¸çš„åƒåœ¾ï¼Œä¸è¦ç”¨â€¦ å †æ’åºåŸºæœ¬æ€æƒ³è¿™ä¸ªç‰›é€¼å‹’ï¼Œæˆ‘ä¸ªäººæœ€æ¬£èµè¿™ä¸ªï¼Œå› ä¸ºjavaä¸­çš„PriorityQueueç”¨äº†å †æ’åºâ€¦åœ¨åškä¸ªæœ‰åºé“¾è¡¨åˆå¹¶ç­‰é—®é¢˜æ—¶ï¼Œç”¨PriorityQueueç®€ç›´å°±æ˜¯ç¥å™¨å•Šâ€¦ å †æ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå°†å¾…æ’åºåºåˆ—æ„é€ æˆä¸€ä¸ªå¤§é¡¶å †ï¼Œæ­¤æ—¶ï¼Œæ•´ä¸ªåºåˆ—çš„æœ€å¤§å€¼å°±æ˜¯å †é¡¶çš„æ ¹èŠ‚ç‚¹ã€‚å°†å…¶ä¸æœ«å°¾å…ƒç´ è¿›è¡Œäº¤æ¢ï¼Œæ­¤æ—¶æœ«å°¾å°±ä¸ºæœ€å¤§å€¼ã€‚ç„¶åå°†å‰©ä½™n-1ä¸ªå…ƒç´ é‡æ–°æ„é€ æˆä¸€ä¸ªå †ï¼Œè¿™æ ·ä¼šå¾—åˆ°nä¸ªå…ƒç´ çš„æ¬¡å°å€¼ã€‚å¦‚æ­¤åå¤æ‰§è¡Œï¼Œä¾¿èƒ½å¾—åˆ°ä¸€ä¸ªæœ‰åºåºåˆ—äº†ã€‚ ç®—æ³•æè¿° å°†æ— éœ€åºåˆ—æ„å»ºæˆä¸€ä¸ªå †ï¼Œæ ¹æ®å‡åºé™åºéœ€æ±‚é€‰æ‹©å¤§é¡¶å †æˆ–å°é¡¶å †; å°†å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´ äº¤æ¢ï¼Œå°†æœ€å¤§å…ƒç´ â€æ²‰â€åˆ°æ•°ç»„æœ«ç«¯; é‡æ–°è°ƒæ•´ç»“æ„ï¼Œä½¿å…¶æ»¡è¶³å †å®šä¹‰ï¼Œç„¶åç»§ç»­äº¤æ¢å †é¡¶å…ƒç´ ä¸å½“å‰æœ«å°¾å…ƒç´ ï¼Œåå¤æ‰§è¡Œè°ƒæ•´+äº¤æ¢æ­¥éª¤ï¼Œç›´åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚ åŠ¨å›¾æ¼”ç¤º ä»£ç å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475 /** * å †æ’åº * * @param sortArray * @param len æ³¨æ„è¿™é‡Œæ˜¯arr.lengthï¼Œè·Ÿä¹‹å‰ä¸ä¸€æ ·ï¼Œå †æ’åºæ˜¯ä»1å¼€å§‹çš„ */ public static void heapSort(int[] sortArray, int len) &#123; //å»ºç«‹å¤§æ ¹å † BuildMaxHeap(sortArray, len); //æ¯æ¬¡éƒ½å°†æ ¹å–å‡ºï¼Œç„¶åå°†æœ€åº•ä¸‹çš„æ”¾åˆ°æ ¹ï¼Œç„¶åè¿›è¡Œå †è°ƒæ•´ for (int i = len; i &gt; 0; i--) &#123; swap(sortArray, i, 0);// AdjustDown(sortArray,0,i-1); AdjustDown2(sortArray, 0, i - 1); &#125; System.out.println(Arrays.toString(sortArray)); &#125; /** * å…ˆå†™ä¸€ä¸ªé€’å½’çš„ï¼Œæ¯”è¾ƒå¥½ç†è§£ * * @param sortArray * @param i * @param len */ private static void AdjustDown(int[] sortArray, int i, int len) &#123; //æ³¨æ„è¿™é‡Œçš„lenæ˜¯length-1ï¼Œç„¶åæ ¹çš„åºå·æ˜¯1ï¼Œæ‰€ä»¥leftæ˜¯2i+1 int left = 2 * i + 1; int right = 2 * i + 2; int largest = i; if (left &lt;= len &amp;&amp; sortArray[left] &gt; sortArray[largest]) largest = left; if (right &lt;= len &amp;&amp; sortArray[right] &gt; sortArray[largest]) largest = right; if (largest != i) &#123; swap(sortArray, largest, i); AdjustDown(sortArray, largest, len); &#125; &#125; /** * å†™ä¸€ä¸ªéé€’å½’çš„å§ï¼Œæ³¨æ„å“ˆï¼Œè¿™é‡Œçš„lenæ˜¯length-1ï¼Œè·Ÿä¸Šé¢çš„ä¸€æ · * * @param sortArray * @param i * @param len */ private static void AdjustDown2(int[] sortArray, int i, int len) &#123; int t = i; for (int m = 2 * i + 1; m &lt;= len; m = t * 2 + 1) &#123; if (sortArray[m] &gt; sortArray[t]) t = m; if (m + 1 &lt;= len &amp;&amp; sortArray[m + 1] &gt; sortArray[t]) t = m + 1; if (t == i) break; else &#123; swap(sortArray, t, (m - 1) / 2); i = (m - 1) / 2; &#125; &#125; &#125; private static void BuildMaxHeap(int[] sortArray, int len) &#123; double lens = len; //æ³¨æ„æ˜¯ä»lens/2å¼€å§‹ for (int i = (int) Math.round((lens / 2)) - 1; i &gt;= 0; i--) &#123;// System.out.println(i);// AdjustDown(sortArray,i,len); AdjustDown2(sortArray, i, len); &#125; &#125; ç®—æ³•æ•ˆç‡ æ—¶é—´å¤æ‚åº¦ï¼šå¹³å‡æ—¶é—´ã€æœ€åå’Œæœ€å¥½æƒ…å†µä¸‹éƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯O(nlogn) ã€‚ å»ºç«‹å †çš„è¿‡ç¨‹, ä»length/2 ä¸€ç›´å¤„ç†åˆ°0, æ—¶é—´å¤æ‚åº¦ä¸ºO(n); è°ƒæ•´å †çš„è¿‡ç¨‹æ˜¯æ²¿ç€å †çš„çˆ¶å­èŠ‚ç‚¹è¿›è¡Œè°ƒæ•´, æ‰§è¡Œæ¬¡æ•°ä¸ºå †çš„æ·±åº¦, æ—¶é—´å¤æ‚åº¦ä¸ºO(lgn); å †æ’åºçš„è¿‡ç¨‹ç”±næ¬¡ç¬¬â‘¡æ­¥å®Œæˆ, æ—¶é—´å¤æ‚åº¦ä¸ºO(nlgn)ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šO(1)ã€‚ ç¨³å®šæ€§ï¼šç”±äºå †æ’åºä¸­åˆå§‹åŒ–å †çš„è¿‡ç¨‹æ¯”è¾ƒæ¬¡æ•°è¾ƒå¤š, å› æ­¤å®ƒä¸å¤ªé€‚ç”¨äºå°åºåˆ—ã€‚åŒæ—¶ç”±äºå¤šæ¬¡ä»»æ„ä¸‹æ ‡ç›¸äº’äº¤æ¢ä½ç½®, ç›¸åŒå…ƒç´ ä¹‹é—´åŸæœ¬ç›¸å¯¹çš„é¡ºåºè¢«ç ´åäº†, å› æ­¤, å®ƒæ˜¯ä¸ç¨³å®šçš„æ’åºã€‚ tips å †æ’åºï¼Œä¸»è¦å°±æ˜¯æŠŠæ ¹æ‹¿å‡ºæ¥ï¼Œç„¶åå‰©ä¸‹çš„è°ƒæ•´æˆæœ€å¤§å †ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªæ‹¿å‡ºæ¥çš„æœ€å¤§çš„å°±åº”è¯¥æ”¾åˆ°æœ€å¥½ä¸€ä¸ªä½ç½®ï¼Œä¸€å…±å¾ªç¯ n-1 æ¬¡å³å¯ï¼› æ³¨æ„ä»£ç ä¸­çš„ len æ˜¯ length-1ã€‚ è¿˜æœ‰ä¸€ä¸ªå®¹æ˜“å‡ºé”™çš„åœ°æ–¹åœ¨å»ºç«‹å¤§æ ¹å †çš„æ—¶å€™ï¼Œi åº”è¯¥æ˜¯ä»æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„çˆ¶äº²èŠ‚ç‚¹å¼€å§‹è°ƒæ•´ã€‚ å†™çš„éé€’å½’è¿˜æ˜¯ä¸å¤ªå¥½â€¦è™½ç„¶å¥½åƒèƒ½é€šè¿‡ï¼Œéé€’å½’ä¸­ä»£ç ä¸­çš„mæ˜¯æŒ‡èŠ‚ç‚¹çš„å·¦å­©å­ï¼Œå¦‚æœæœ‰äº¤æ¢ï¼Œåˆ‡å‹¿å¿˜è®°æ›´æ–°æ–°çš„çˆ¶äº²èŠ‚ç‚¹(i = (m-1)/2)ï¼Œç„¶åè¿›è¡Œä¸‹ä¸€æ­¥å’Œå­©å­èŠ‚ç‚¹çš„æ¯”è¾ƒã€‚ å½’å¹¶æ’åºåŸºæœ¬æ€æƒ³å½’å¹¶æ’åºæ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯é‡‡ç”¨ åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚å°†å·²æœ‰åºçš„å­åºåˆ—åˆå¹¶ï¼Œå¾—åˆ°å®Œå…¨æœ‰åºçš„åºåˆ—ï¼›å³å…ˆä½¿æ¯ä¸ªå­åºåˆ—æœ‰åºï¼Œå†ä½¿å­åºåˆ—æ®µé—´æœ‰åºã€‚è‹¥å°†ä¸¤ä¸ªæœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæœ‰åºè¡¨ï¼Œç§°ä¸º 2-è·¯å½’å¹¶ã€‚ ç®—æ³•æè¿° æŠŠé•¿åº¦ä¸ºnçš„è¾“å…¥åºåˆ—åˆ†æˆä¸¤ä¸ªé•¿åº¦ä¸ºn/2çš„å­åºåˆ—ï¼Œç„¶åå­åºåˆ—é¦–ç«¯å„ç»´æŠ¤ä¸€ä¸ªæŒ‡é’ˆï¼Œäº’ç›¸æ¯”è¾ƒï¼› å¯¹è¿™ä¸¤ä¸ªå­åºåˆ—åˆ†åˆ«é‡‡ç”¨å½’å¹¶æ’åºï¼› å°†ä¸¤ä¸ªæ’åºå¥½çš„å­åºåˆ—åˆå¹¶æˆä¸€ä¸ªæœ€ç»ˆçš„æ’åºåºåˆ—ã€‚ åŠ¨å›¾æ¼”ç¤º ä»£ç å®ç°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647 /** * è‡ªå·±å†™ä¸€ä¸ª åº•å±‚æ˜¯æ•°ç»„ */ public static void mergeSort(int[] sortArray, int low, int high) &#123; int mid = (low + high) / 2; if (low &lt; high) &#123; //æ³¨æ„å’Œå¿«æ’åŒºåˆ†ä¸€ä¸‹ï¼Œè¿™é‡Œçš„midæ˜¯è¦åœ¨é€’å½’é‡Œé¢çš„ mergeSort(sortArray, low, mid); mergeSort(sortArray, mid + 1, high); //æ€è·¯å°±æ˜¯å…ˆä¸€åˆ†ä¸ºäºŒå†åˆäºŒä¸ºä¸€ merge(sortArray, low, mid, high); System.out.println(Arrays.toString(sortArray)); &#125; &#125; private static void merge(int[] sortArray, int low, int mid, int high) &#123; //ç‰ºç‰²äº†ç©ºé—´ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç©ºé—´æ¥å­˜å‚¨æ’å¥½åºçš„æ•°ç»„ int[] temp = new int[high - low + 1]; int i = low; int j = mid + 1; int k = 0; while (i &lt;= mid &amp;&amp; j &lt;= high) &#123; if (sortArray[i] &lt; sortArray[j]) &#123; temp[k++] = sortArray[i++]; &#125; else &#123; temp[k++] = sortArray[j++]; &#125; &#125; //éå¸¸ä¸¥é‡çš„é”™è¯¯ï¼Œifä¸­çš„j++åä¼šå½±å“ä¸‹ä¸€ä¸ªifï¼Œæ‰€ä»¥ä¼šè¶…å‡ºç´¢å¼•å€¼ã€‚æ•°ç»„è¶Šç•Œ// while(i &gt; mid)&#123;// temp[k++] = sortArray[j++];// &#125;// while(j &gt; high)&#123;// temp[k++] = sortArray[i++];// &#125; while (i &lt;= mid) &#123; temp[k++] = sortArray[i++]; &#125; while (j &lt;= high) &#123; temp[k++] = sortArray[j++]; &#125; for (int t = 0; t &lt; temp.length; t++) &#123; //è¿™é‡Œä¹Ÿæ˜¯æ˜“é”™ç‚¹ï¼Œæ³¨æ„sortArrayçš„ä¸‹æ ‡æ˜¯ä»lowå¼€å§‹çš„ sortArray[low + t] = temp[t]; &#125; &#125; ç®—æ³•æ•ˆç‡ æ—¶é—´å¤æ‚åº¦ï¼šå½’å¹¶æ’åºå¯ç®—æ˜¯æ’åºç®—æ³•ä¸­çš„â€ä½¼ä½¼è€…â€ã€‚å‡è®¾æ•°ç»„é•¿åº¦ä¸ºnï¼Œé‚£ä¹ˆæ‹†åˆ†æ•°ç»„å…±éœ€logn, åˆæ¯æ­¥éƒ½æ˜¯ä¸€ä¸ªæ™®é€šçš„åˆå¹¶å­æ•°ç»„çš„è¿‡ç¨‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œ æ•…å…¶ç»¼åˆæ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn)ã€‚æ³¨æ„ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ã€æœ€å¥½æ—¶é—´å¤æ‚åº¦ã€æœ€åæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(nlogn)ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šéœ€è¦ä¸€ä¸ªé¢å¤–çš„æ•°ç»„æ¥å­˜å‚¨æ’åºå¥½çš„æ•°ç»„ï¼Œæ‰€ä»¥æ˜¯O(N)ã€‚ ç¨³å®šæ€§ï¼šç¨³å®šã€‚ tips é¦–å…ˆæ³¨æ„é€’å½’éƒ¨åˆ†ï¼Œè·Ÿå¿«æ’æœ‰æ‰€åŒºåˆ«ï¼Œå¿«æ’æ˜¯æ’åºä¸€è½®ç»“æŸåæ‰èƒ½è¿”å›ä¸­é—´èŠ‚ç‚¹ï¼Œè€Œå½’å¹¶æ˜¯ç›´æ¥ç®—å‡ºä¸­é—´èŠ‚ç‚¹ï¼Œå¹¶ä¸”å½’å¹¶çš„midæ˜¯è¦å‚ä¸é€’å½’çš„ï¼Œè€Œå¿«æ’ä¸­çš„åŸºå‡†å€¼ä¸éœ€è¦å‚åŠ é€’å½’ã€‚ åˆå¹¶è¿‡ç¨‹ã€‚é¦–å…ˆæ˜¯è¦newä¸€ä¸ªæ–°çš„æ•°ç»„æ¥å­˜å‚¨æ’åºå¥½çš„æ•°ç»„ï¼Œä¸¤ä¸ªæŒ‡é’ˆè½®æµæ¯”è¾ƒï¼Œå¦‚æœåº•å±‚æ˜¯é“¾è¡¨ï¼Œä¸¤ä¸ªå¤´ç»“ç‚¹äº’ç›¸æ¯”è¾ƒï¼Œæœ€ååˆå¹¶ä¹‹åè¿”å›ä¸€ä¸ªå¤´ç»“ç‚¹å³å¯ã€‚ æ³¨æ„æœ€åå°†åˆå¹¶æ’åºå¥½çš„æ•°ç»„æ”¾å›åˆ°åŸæ•°ç»„æ—¶ï¼Œä¸‹æ ‡æ˜¯ä» low å¼€å§‹çš„ã€‚ è®¡æ•°æ’åºè®¡æ•°æ’åºã€åŸºæ•°æ’åºã€æ¡¶æ’åºå±äºéæ¯”è¾ƒæ’åºã€‚éæ¯”è¾ƒæ’åºæ˜¯é€šè¿‡ç¡®å®šæ¯ä¸ªå…ƒç´ ä¹‹å‰ï¼Œåº”è¯¥æœ‰å¤šå°‘ä¸ªå…ƒç´ æ¥æ’åºã€‚é’ˆå¯¹æ•°ç»„arrï¼Œè®¡ç®—arr[i]ä¹‹å‰æœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Œåˆ™å”¯ä¸€ç¡®å®šäº†arr[i]åœ¨æ’åºåæ•°ç»„ä¸­çš„ä½ç½®ã€‚ éæ¯”è¾ƒæ’åºåªè¦ç¡®å®šæ¯ä¸ªå…ƒç´ ä¹‹å‰çš„å·²æœ‰çš„å…ƒç´ ä¸ªæ•°å³å¯ï¼Œæ‰€æœ‰ä¸€æ¬¡éå†å³å¯è§£å†³ã€‚ç®—æ³•æ—¶é—´å¤æ‚åº¦O(n)ã€‚éæ¯”è¾ƒæ’åºæ—¶é—´å¤æ‚åº¦ä½ï¼Œä½†ç”±äºéæ¯”è¾ƒæ’åºéœ€è¦å ç”¨ç©ºé—´æ¥ç¡®å®šå”¯ä¸€ä½ç½®ã€‚æ‰€ä»¥å¯¹æ•°æ®è§„æ¨¡å’Œæ•°æ®åˆ†å¸ƒæœ‰ä¸€å®šçš„è¦æ±‚ã€‚ åŸºæœ¬æ€æƒ³è®¡æ•°æ’åºéœ€è¦å ç”¨å¤§é‡ç©ºé—´ï¼Œå®ƒä»…é€‚ç”¨äºæ•°æ®æ¯”è¾ƒé›†ä¸­çš„æƒ…å†µã€‚æ¯”å¦‚ [0~100]ï¼Œ[10000~19999] è¿™æ ·çš„æ•°æ®ã€‚ è®¡æ•°æ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼š å¯¹æ¯ä¸€ä¸ªè¾“å…¥çš„å…ƒç´ arr[i]ï¼Œç¡®å®šå°äº arr[i] çš„å…ƒç´ ä¸ªæ•°ã€‚æ‰€ä»¥å¯ä»¥æŠŠ arr[i] æ”¾åˆ°å®ƒè¾“å‡ºæ•°ç»„ä¸­çš„ä½ç½®ä¸Šã€‚ å‡è®¾æœ‰5ä¸ªæ•°å°äº arr[i]ï¼Œæ‰€ä»¥ arr[i] åº”è¯¥æ”¾åœ¨æ•°ç»„çš„ç¬¬6ä¸ªä½ç½®ä¸Šã€‚ å…¶æ ¸å¿ƒåœ¨äºå°†è¾“å…¥çš„æ•°æ®å€¼è½¬åŒ–ä¸ºé”®å­˜å‚¨åœ¨é¢å¤–å¼€è¾Ÿçš„æ•°ç»„ç©ºé—´ä¸­ã€‚ ä½œä¸ºä¸€ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºï¼Œè®¡æ•°æ’åºè¦æ±‚è¾“å…¥çš„æ•°æ®å¿…é¡»æ˜¯æœ‰ç¡®å®šèŒƒå›´çš„æ•´æ•°ã€‚ ç®—æ³•æè¿° æ‰¾å‡ºå¾…æ’åºçš„æ•°ç»„ä¸­æœ€å¤§å’Œæœ€å°çš„å…ƒç´ ï¼› ç»Ÿè®¡æ•°ç»„ä¸­ arr[i] çš„å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå°† arr[i] - min ä½œä¸ºè¾…åŠ©æ•°ç»„helperçš„ç´¢å¼•å€¼ï¼› å¯¹æ‰€æœ‰çš„è®¡æ•°ç´¯åŠ ï¼Œhelper ç´¢å¼•å€¼å¯¹åº”çš„å€¼å³ä¸ºè¯¥ arr[i] å‡ºç°çš„æ¬¡æ•°ï¼› åå‘å¡«å……ç›®æ ‡æ•°ç»„ï¼šå°† helper ä¸­çš„å…ƒç´ æ ¹æ®ç´¢å¼•ä¾æ¬¡æ”¾å›åŸæ•°ç»„ï¼Œç´¢å¼•å¯¹åº”çš„æ•°å€¼å³ä¸ºè¯¥æ•°å‡ºç°çš„æ¬¡æ•°ï¼Œæ¯æ”¾ä¸€ä¸ªå…ƒç´ å°±å°† helper[arr[i]-min] å‡å»1ã€‚ åŠ¨å›¾æ¼”ç¤º ä»£ç å®ç°12345678910111213141516171819202122232425/** * è®¡æ•°æ’åº * è¦æœ‰ä¸¤ä¸ªæ•°ç»„ï¼Œåˆ†åˆ«æ˜¯åŸæ•°ç»„ï¼Œä¸­é—´æ•°ç»„ç”¨æ¥æ’åºçš„ * * @param sortArray */public static void courtSort(int[] sortArray) &#123; int max = Integer.MIN_VALUE; int min = Integer.MAX_VALUE; for (int i = 0; i &lt; sortArray.length; i++) &#123; max = Math.max(max, sortArray[i]); min = Math.min(min, sortArray[i]); &#125; int[] helparr = new int[max - min + 1]; for (int i = 0; i &lt; sortArray.length; i++) &#123; helparr[sortArray[i] - min]++; &#125; int index = 0; for (int i = 0; i &lt; helparr.length; i++) &#123; while (helparr[i]-- &gt; 0) &#123; sortArray[index++] = i + min; &#125; &#125; System.out.println(Arrays.toString(sortArray));&#125; ç®—æ³•æ•ˆç‡ æ—¶é—´å¤æ‚åº¦ï¼šå½“è¾“å…¥å…ƒç´ æ˜¯ n ä¸ª 0åˆ° k ä¹‹é—´çš„æ•´æ•°æ—¶ï¼Œå¹³å‡æ—¶é—´ã€æœ€åå’Œæœ€å¥½æƒ…å†µä¸‹éƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯O(n+k) ã€‚å…¶æ’åºé€Ÿåº¦å¿«äºä»»ä½•æ¯”è¾ƒæ’åºç®—æ³•ã€‚å½“kä¸æ˜¯å¾ˆå¤§å¹¶ä¸”åºåˆ—æ¯”è¾ƒé›†ä¸­æ—¶ï¼Œè®¡æ•°æ’åºæ˜¯ä¸€ä¸ªå¾ˆæœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šO(n+k) ã€‚ ç¨³å®šæ€§ï¼šç¨³å®šã€‚ tips æ³¨æ„ï¼šä¸ºäº†èŠ‚çœç©ºé—´ï¼Œhelper å¿…é¡»æ˜¯ arr[i]-minä½œä¸ºç´¢å¼•å€¼ã€‚ åœ¨å°†æ’åºå¥½çš„æ•°ç»„æ”¾å›åŸæ•°ç»„æ—¶ï¼Œåˆ«å¿˜äº†æŠŠä¸­é—´æ•°ç»„ç´¢å¼•å¯¹åº”çš„å€¼å‡å»1ï¼Œå½“ä¸º0æ—¶è¯´æ˜è¯¥ç´¢å¼•ä»£è¡¨çš„å€¼ä¸å­˜åœ¨ã€‚ æ¡¶æ’åºåŸºæœ¬æ€æƒ³ æ¡¶æ’åºæ˜¯è®¡æ•°æ’åºçš„å‡çº§ç‰ˆã€‚å®ƒåˆ©ç”¨äº†å‡½æ•°çš„æ˜ å°„å…³ç³»ï¼Œé«˜æ•ˆä¸å¦çš„å…³é”®å°±åœ¨äºè¿™ä¸ªæ˜ å°„å‡½æ•°çš„ç¡®å®šã€‚ æ¡¶æ’åº (Bucket sort) çš„å·¥ä½œçš„åŸç†ï¼šå‡è®¾è¾“å…¥æ•°æ®æœä»å‡åŒ€åˆ†å¸ƒï¼Œå°†æ•°æ®åˆ†åˆ°æœ‰é™æ•°é‡çš„æ¡¶é‡Œï¼Œæ¯ä¸ªæ¡¶å†åˆ†åˆ«æ’åºï¼ˆæœ‰å¯èƒ½å†ä½¿ç”¨åˆ«çš„æ’åºç®—æ³•æˆ–æ˜¯ä»¥é€’å½’æ–¹å¼ç»§ç»­ä½¿ç”¨æ¡¶æ’åºè¿›è¡Œæ’ï¼‰ã€‚ æ¡¶æ’åºå¯ç”¨äºæœ€å¤§æœ€å°å€¼ç›¸å·®è¾ƒå¤§çš„æ•°æ®æƒ…å†µï¼Œæ¯”å¦‚[9012,19702,39867,68957,83556,102456]ã€‚ä½†æ¡¶æ’åºè¦æ±‚æ•°æ®çš„åˆ†å¸ƒå¿…é¡»å‡åŒ€ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ•°æ®éƒ½é›†ä¸­åˆ°ä¸€ä¸ªæ¡¶ä¸­ã€‚æ¯”å¦‚[104,150,123,132,20000], è¿™ç§æ•°æ®ä¼šå¯¼è‡´å‰4ä¸ªæ•°éƒ½é›†ä¸­åˆ°åŒä¸€ä¸ªæ¡¶ä¸­ã€‚å¯¼è‡´æ¡¶æ’åºå¤±æ•ˆã€‚ æ¡¶æ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šæŠŠæ•°ç»„ arr åˆ’åˆ†ä¸ºnä¸ªå¤§å°ç›¸åŒå­åŒºé—´ï¼ˆæ¡¶ï¼‰ï¼Œæ¯ä¸ªå­åŒºé—´å„è‡ªæ’åºï¼Œæœ€ååˆå¹¶ã€‚è®¡æ•°æ’åºæ˜¯æ¡¶æ’åºçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå¯ä»¥æŠŠè®¡æ•°æ’åºå½“æˆæ¯ä¸ªæ¡¶é‡Œåªæœ‰ä¸€ä¸ªå…ƒç´ çš„æƒ…å†µã€‚ ç®—æ³•æè¿° æ‰¾å‡ºå¾…æ’åºæ•°ç»„ä¸­çš„æœ€å¤§å€¼ maxã€æœ€å°å€¼ minï¼› æˆ‘ä»¬ä½¿ç”¨ åŠ¨æ€æ•°ç»„ ArrayList ä½œä¸ºæ¡¶ï¼Œæ¡¶é‡Œæ”¾çš„å…ƒç´ ä¹Ÿç”¨ ArrayList å­˜å‚¨ã€‚æ¡¶çš„æ•°é‡ä¸º (max-min)/BucketSize+1ï¼› éå†æ•°ç»„ arrï¼Œè®¡ç®—æ¯ä¸ªå…ƒç´  arr[i] æ”¾çš„æ¡¶ï¼› æ¯ä¸ªæ¡¶å„è‡ªæ’åºï¼› éå†æ¡¶æ•°ç»„ï¼ŒæŠŠæ’åºå¥½çš„å…ƒç´ æ”¾è¿›è¾“å‡ºæ•°ç»„ã€‚ å›¾ç‰‡æ¼”ç¤º ä»£ç å®ç°1234567891011121314151617181920212223242526272829303132/** * æ¡¶æ’åº * * @param sortArray */public static void BucketSort(int[] sortArray) &#123; //1.è®¾ç½®å›ºå®šæ•°é‡çš„ç©ºæ¡¶ int max = Integer.MIN_VALUE; int BucketSize = 5; int min = Integer.MAX_VALUE; for (int i = 0; i &lt; sortArray.length; i++) &#123; max = Math.max(max, sortArray[i]); min = Math.min(min, sortArray[i]); &#125; int BucketCount = (max - min) / BucketSize + 1; //2.æŠŠæ•°æ®æ”¾åˆ°å¯¹åº”æ¡¶ä¸­ ArrayList&lt;ArrayList&lt;Integer&gt;&gt; buckets = new ArrayList&lt;&gt;(BucketCount); for (int i = 0; i &lt; BucketCount; i++) &#123; buckets.add(new ArrayList&lt;Integer&gt;()); &#125; for (int i = 0; i &lt; sortArray.length; i++) &#123; int num = (sortArray[i] - min) / BucketSize; buckets.get(num).add(sortArray[i]); &#125; //3.æ’åº for (int i = 0; i &lt; buckets.size(); i++) &#123; //ç›´æ¥ç”¨çš„æ˜¯é›†åˆè‡ªå¸¦çš„æ’åºï¼Œå¯ä»¥é€‰æ‹©æ’å…¥æˆ–è€…é€’å½’ä½¿ç”¨æ¡¶æ’åº Collections.sort(buckets.get(i)); &#125; System.out.println(buckets.toString()); &#125; ç®—æ³•æ•ˆç‡ æ—¶é—´å¤æ‚åº¦ï¼šæ¡¶æ’åºæœ€å¥½æƒ…å†µä¸‹ä½¿ç”¨çº¿æ€§æ—¶é—´ O(n)ï¼Œæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼Œå–å†³ä¸å¯¹å„ä¸ªæ¡¶ä¸­æ•°æ®è¿›è¡Œæ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼Œå› ä¸ºå…¶å®ƒéƒ¨åˆ†çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸º O(n)ã€‚å¾ˆæ˜¾ç„¶ï¼Œæ¡¶çš„èŒƒå›´åˆ’åˆ†çš„è¶Šå°ï¼Œæ¡¶è¶Šå¤šï¼Œå„ä¸ªæ¡¶ä¹‹é—´çš„æ•°æ®è¶Šå°‘ï¼Œæ’åºæ‰€ç”¨çš„æ—¶é—´ä¹Ÿä¼šè¶Šå°‘ã€‚æ‰€ä»¥æœ€å·®çš„æ—¶é—´å¤æ‚åº¦ä¸º O(nÂ²)ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(n+k)ï¼Œæœ€å¥½çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šO(n+k) ã€‚ ç¨³å®šæ€§ï¼šç¨³å®šã€‚ tips æ¡¶æœ€å¥½æ˜¯ç”¨ArrayListï¼Œé‡Œé¢çš„æ•°æ®æœ€å¥½ä¹Ÿæ˜¯ArrayListè£…è½½ï¼Œå› ä¸ºè¿™æ ·æ–¹ä¾¿åŠ¨æ€çš„æ·»åŠ æ•°æ®åˆ°æ¡¶ä¸­ã€‚ æ¡¶å†…æ’åºå¯ä»¥éšä¾¿é€‰æ‹©ä¸€ç§æ’åºç®—æ³•ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ˜¯javaé›†æˆå¥½çš„é›†åˆæ’åºçš„æ–¹æ³•ã€‚ åŸºæ•°æ’åºåŸºæœ¬æ€æƒ³åŸºæ•°æ’åºï¼ˆRadix Sortï¼‰æ˜¯æŒ‰ç…§ä½ä½å…ˆæ’åºï¼Œç„¶åæ”¶é›†ï¼›å†æŒ‰ç…§é«˜ä½æ’åºï¼Œç„¶åå†æ”¶é›†ï¼›ä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°æœ€é«˜ä½ã€‚æœ‰æ—¶å€™æœ‰äº›å±æ€§æ˜¯æœ‰ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œå…ˆæŒ‰ä½ä¼˜å…ˆçº§æ’åºï¼Œå†æŒ‰é«˜ä¼˜å…ˆçº§æ’åºã€‚æœ€åçš„æ¬¡åºå°±æ˜¯é«˜ä¼˜å…ˆçº§é«˜çš„åœ¨å‰ï¼Œé«˜ä¼˜å…ˆçº§ç›¸åŒçš„ä½ä¼˜å…ˆçº§é«˜çš„åœ¨å‰ã€‚ ç®—æ³•æè¿° å–å¾—æ•°ç»„ä¸­çš„æœ€å¤§æ•°ï¼Œå¹¶å–å¾—ä½æ•°ï¼› arr ä¸ºåŸå§‹æ•°ç»„ï¼Œä»æœ€ä½ä½å¼€å§‹å–æ¯ä¸ªä½ç»„æˆ radix æ•°ç»„ï¼› å¯¹ radix è¿›è¡Œè®¡æ•°æ’åºï¼ˆåˆ©ç”¨è®¡æ•°æ’åºé€‚ç”¨äºå°èŒƒå›´æ•°çš„ç‰¹ç‚¹ï¼‰ï¼› åŠ¨å›¾æ¼”ç¤º ä»£ç å®ç°123456789101112131415161718192021222324252627282930313233343536373839/** åŸºæ•°æ’åº * å¯ä»¥é‡‡ç”¨æ¡¶çš„æ€æƒ³ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨é˜Ÿåˆ—çš„æ€æƒ³ * * @param array */ public static void radixSort(int[] array) &#123; if (array == null || array.length &lt; 2) return; // 1.å…ˆç®—å‡ºæœ€å¤§æ•°çš„ä½æ•°ï¼› int max = array[0]; for (int i = 1; i &lt; array.length; i++) &#123; max = Math.max(max, array[i]); &#125; int maxDigit = 0; while (max != 0) &#123; max /= 10; maxDigit++; &#125; int mod = 10, div = 1; //æ¡¶å¯ä»¥ç”¨äºŒç»´æ•°ç»„å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨ArrayListå®ç°ï¼Œæ¨èåˆ—è¡¨ï¼Œå› ä¸ºæ˜¯åŠ¨æ€çš„ ArrayList&lt;ArrayList&lt;Integer&gt;&gt; bucketList = new ArrayList&lt;ArrayList&lt;Integer&gt;&gt;(); for (int i = 0; i &lt; 10; i++) &#123; bucketList.add(new ArrayList&lt;Integer&gt;()); &#125; for (int i = 0; i &lt; maxDigit; i++, mod *= 10, div *= 10) &#123; for (int j = 0; j &lt; array.length; j++) &#123; int num = (array[j] % mod) / div; bucketList.get(num).add(array[j]); &#125; int index = 0; for (int j = 0; j &lt; bucketList.size(); j++) &#123; for (int k = 0; k &lt; bucketList.get(j).size(); k++) &#123; array[index++] = bucketList.get(j).get(k); &#125; bucketList.get(j).clear(); &#125; &#125; System.out.println(Arrays.toString(array)); &#125; ç®—æ³•æ•ˆç‡ æ—¶é—´å¤æ‚åº¦ï¼šåŸºæ•°æ’åºåŸºäºåˆ†åˆ«æ’åºï¼Œåˆ†åˆ«æ”¶é›†ï¼Œæ‰€ä»¥æ˜¯ç¨³å®šçš„ã€‚ä½†åŸºæ•°æ’åºçš„æ€§èƒ½æ¯”æ¡¶æ’åºè¦ç•¥å·®ï¼Œæ¯ä¸€æ¬¡å…³é”®å­—çš„æ¡¶åˆ†é…éƒ½éœ€è¦ O(n)çš„æ—¶é—´å¤æ‚åº¦ï¼Œè€Œä¸”åˆ†é…ä¹‹åå¾—åˆ°æ–°çš„å…³é”®å­—åºåˆ—åˆéœ€è¦ O(n)çš„æ—¶é—´å¤æ‚åº¦ã€‚å‡å¦‚å¾…æ’æ•°æ®å¯ä»¥åˆ†ä¸º dä¸ªå…³é”®å­—ï¼Œåˆ™åŸºæ•°æ’åºçš„æ—¶é—´å¤æ‚åº¦å°†æ˜¯ O(d*2n) ï¼Œå½“ç„¶ d è¦è¿œè¿œå°äº nï¼Œå› æ­¤åŸºæœ¬ä¸Šè¿˜æ˜¯çº¿æ€§çº§åˆ«çš„ã€‚æœ€å¥½ã€æœ€å·®ã€å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n*k)çº§åˆ«çš„ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šO(n+k)ï¼Œå…¶ä¸­kä¸ºæ¡¶çš„æ•°é‡ã€‚ä¸€èˆ¬æ¥è¯´ n&gt;&gt;kï¼Œå› æ­¤é¢å¤–ç©ºé—´éœ€è¦å¤§æ¦‚ n ä¸ªå·¦å³ã€‚ ç¨³å®šæ€§ï¼šç¨³å®šã€‚ tips æ³¨æ„æ¯ä¸ªæ¡¶å†…æ•°æ®æ’åºå¥½ç„¶åè¿”å›ç»™åŸæ•°ç»„åï¼Œè®°å¾—clearï¼› ç‚¹ç›ä¹‹ç¬”æ˜¯ å°†åŸºæ•°æ’åºè½¬æ¢ä¸ºè®¡æ•°æ’åºï¼Œåˆ†åˆ«å¯¹å…¶ä¸ªä½ã€åä½â€¦è¿›è¡Œè®¡æ•°æ’åºã€‚ å‚è€ƒæ–‡çŒ® åå¤§ç»å…¸æ’åºç®—æ³• åå¤§ç»å…¸æ’åºç®—æ³•ä¹‹JAVAå®ç° è®¡æ•°æ’åºå’Œæ¡¶æ’åºä¹‹JAVAå®ç° åå¤§ç»å…¸æ’åºç®—æ³•åŠ¨ç”»ä¸è§£æï¼Œçœ‹æˆ‘å°±å¤Ÿäº†ï¼ï¼ˆé…ä»£ç å®Œå…¨ç‰ˆï¼‰ é¢è¯•å¿…å¤‡ï¼šå…«ç§æ’åºç®—æ³•åŸç†åŠJavaå®ç°]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>æ’åº</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[darkmode for mac]]></title>
    <url>%2F2019%2F10%2F24%2Fdarkmode%E6%95%99%E7%A8%8B.html</url>
    <content type="text"><![CDATA[Macç«¯darkmodeè®¾ç½®Macç«¯å¤–è§‚å…·ä½“æ“ä½œæ–¹å¼ æ‰“å¼€ ç³»ç»Ÿåå¥½è®¾ç½® ç‚¹å‡» é€šç”¨ ä¿®æ”¹ å¤–è§‚ ä¿®æ”¹å®Œä¹‹åï¼Œéƒ¨åˆ†è½¯ä»¶ä¼šè‡ªåŠ¨é€‚é…ç³»ç»Ÿçš„ç¯å¢ƒè‰²ï¼Œä¾‹å¦‚chromeï¼Œç½‘æ˜“äº‘ç­‰ç­‰ã€‚ ä¿®æ”¹chromeç½‘é¡µé¢œè‰²åœ¨è°·æ­Œæ’ä»¶å•†åº—ä¸­æŸ¥æ‰¾ä¸€æ¬¾Dark Readerçš„æ’ä»¶ï¼Œå¯ä»¥å®Œç¾é…åˆæš—é»‘æ¨¡å¼çš„ä½¿ç”¨ è‡ªåŠ¨åˆ‡æ¢ç™½å¤©é»‘å¤œçš„æ¨¡å¼ä¸‹è½½ä¸€æ¬¾å«åšDarkNightçš„è½¯ä»¶ï¼Œå¯ä»¥æ ¹æ®å½“åœ°çš„æ—¥è½æ—¥å‡ºæ—¶é—´è‡ªåŠ¨åˆ‡æ¢å±ä¿ï¼Œé…åˆæš—é»‘æ¨¡å¼çš„ä½¿ç”¨ã€‚]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>mac</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaå®ç°å•é“¾è¡¨]]></title>
    <url>%2F2019%2F10%2F16%2Fjava%E5%AE%9E%E7%8E%B0%E5%8D%95%E9%93%BE%E8%A1%A8.html</url>
    <content type="text"><![CDATA[Javaå®ç°å•å‘é“¾è¡¨åŸºæœ¬åŠŸèƒ½å…ˆè¯´ä¸€ä¸‹ï¼Œå‚è€ƒå€Ÿé‰´çš„åšå®¢æœ‰ï¼š Javaå®ç°å•å‘é“¾è¡¨åŸºæœ¬åŠŸèƒ½ Javaå•é“¾è¡¨åè½¬ è¯¦ç»†è¿‡ç¨‹ ä»é“¾è¡¨ä¸­åˆ é™¤é‡å¤æ•°æ®ï¼ˆä¸‰ç§æ–¹æ³•) è¡¥å……å†™çš„æ²¡äººå®¶å¥½ï¼Œè¿™éƒ¨åˆ†ä¸»è¦æ˜¯å¯¹ç¬¬ä¸€ä¸ªåšå®¢çš„è¡¥å……ï¼Œå…¶å•å‘é“¾è¡¨ä¸­çš„é“¾è¡¨åè½¬å’Œä»é“¾è¡¨ä¸­åˆ é™¤é‡å¤æ•°æ®è§£é‡Šçš„ä¸å¤Ÿæ¸…æ™°ï¼Œåé¢ä¸¤ä¸ªåšå®¢æ˜¯æ‰©å±•è¿™ä¸¤ä¸ªçŸ¥è¯†ç‚¹çš„ï¼Œåœ¨çœ‹è¿™ä¸ªçŸ¥è¯†ç‚¹çš„åŒæ—¶ï¼Œå‘ç°ç”¨åˆ°äº†éƒ¨åˆ†HashTableçš„çŸ¥è¯†ï¼Œè¿‡æ®µæ—¶é—´éœ€è¦æŠŠè¿™ä¸ªçŸ¥è¯†ç‚¹ä¹Ÿå®Œå–„ä¸€ä¸‹ã€‚]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>é“¾è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[transientå…³é”®å­—]]></title>
    <url>%2F2019%2F10%2F12%2Ftransient%E5%85%B3%E9%94%AE%E5%AD%97.html</url>
    <content type="text"><![CDATA[transientå…³é”®å­—ä½œç”¨(è½¬è½½)ä½œç”¨åŠä½¿ç”¨æ–¹æ³•â€‹ æˆ‘ä»¬éƒ½çŸ¥é“ä¸€ä¸ªå¯¹è±¡åªè¦å®ç°äº†Serilizableæ¥å£ï¼Œè¿™ä¸ªå¯¹è±¡å°±å¯ä»¥è¢«åºåˆ—åŒ–ï¼Œjavaçš„è¿™ç§åºåˆ—åŒ–æ¨¡å¼ä¸ºå¼€å‘è€…æä¾›äº†å¾ˆå¤šä¾¿åˆ©ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å¿…å…³ç³»å…·ä½“åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œåªè¦è¿™ä¸ªç±»å®ç°äº†Serilizableæ¥å£ï¼Œè¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•éƒ½ä¼šè‡ªåŠ¨åºåˆ—åŒ–ã€‚ â€‹ ç„¶è€Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šé‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œè¿™ä¸ªç±»çš„æœ‰äº›å±æ€§éœ€è¦åºåˆ—åŒ–ï¼Œè€Œå…¶ä»–å±æ€§ä¸éœ€è¦è¢«åºåˆ—åŒ–ï¼Œæ‰“ä¸ªæ¯”æ–¹ï¼Œå¦‚æœä¸€ä¸ªç”¨æˆ·æœ‰ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼Œé“¶è¡Œå¡å·ç­‰ï¼‰ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¸å¸Œæœ›åœ¨ç½‘ç»œæ“ä½œï¼ˆä¸»è¦æ¶‰åŠåˆ°åºåˆ—åŒ–æ“ä½œï¼Œæœ¬åœ°åºåˆ—åŒ–ç¼“å­˜ä¹Ÿé€‚ç”¨ï¼‰ä¸­è¢«ä¼ è¾“ï¼Œè¿™äº›ä¿¡æ¯å¯¹åº”çš„å˜é‡å°±å¯ä»¥åŠ ä¸Štransientå…³é”®å­—ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªå­—æ®µçš„ç”Ÿå‘½å‘¨æœŸä»…å­˜äºè°ƒç”¨è€…çš„å†…å­˜ä¸­è€Œä¸ä¼šå†™åˆ°ç£ç›˜é‡ŒæŒä¹…åŒ–ã€‚ â€‹ æ€»ä¹‹ï¼Œjava çš„transientå…³é”®å­—ä¸ºæˆ‘ä»¬æä¾›äº†ä¾¿åˆ©ï¼Œä½ åªéœ€è¦å®ç°Serilizableæ¥å£ï¼Œå°†ä¸éœ€è¦åºåˆ—åŒ–çš„å±æ€§å‰æ·»åŠ å…³é”®å­—transientï¼Œåºåˆ—åŒ–å¯¹è±¡çš„æ—¶å€™ï¼Œè¿™ä¸ªå±æ€§å°±ä¸ä¼šåºåˆ—åŒ–åˆ°æŒ‡å®šçš„ç›®çš„åœ°ä¸­ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081import java.io.FileInputStream;import java.io.FileNotFoundException;import java.io.FileOutputStream;import java.io.IOException;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.io.Serializable;/** * @description ä½¿ç”¨transientå…³é”®å­—ä¸åºåˆ—åŒ–æŸä¸ªå˜é‡ * æ³¨æ„è¯»å–çš„æ—¶å€™ï¼Œè¯»å–æ•°æ®çš„é¡ºåºä¸€å®šè¦å’Œå­˜æ”¾æ•°æ®çš„é¡ºåºä¿æŒä¸€è‡´ * * @author Alexia * @date 2013-10-15 */public class TransientTest &#123; public static void main(String[] args) &#123; User user = new User(); user.setUsername("Alexia"); user.setPasswd("123456"); System.out.println("read before Serializable: "); System.out.println("username: " + user.getUsername()); System.err.println("password: " + user.getPasswd()); try &#123; ObjectOutputStream os = new ObjectOutputStream( new FileOutputStream("C:/user.txt")); os.writeObject(user); // å°†Userå¯¹è±¡å†™è¿›æ–‡ä»¶ os.flush(); os.close(); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; try &#123; ObjectInputStream is = new ObjectInputStream(new FileInputStream( "C:/user.txt")); user = (User) is.readObject(); // ä»æµä¸­è¯»å–Userçš„æ•°æ® is.close(); System.out.println("\nread after Serializable: "); System.out.println("username: " + user.getUsername()); System.err.println("password: " + user.getPasswd()); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; &#125;&#125;class User implements Serializable &#123; private static final long serialVersionUID = 8294180014912103005L; private String username; private transient String passwd; public String getUsername() &#123; return username; &#125; public void setUsername(String username) &#123; this.username = username; &#125; public String getPasswd() &#123; return passwd; &#125; public void setPasswd(String passwd) &#123; this.passwd = passwd; &#125;&#125; 1234567read before Serializable: username: Alexiapassword: 123456read after Serializable: username: Alexiapassword: null å¯†ç å­—æ®µä¸ºnullï¼Œè¯´æ˜ååºåˆ—åŒ–æ—¶æ ¹æœ¬æ²¡æœ‰ä»æ–‡ä»¶ä¸­è·å–åˆ°ä¿¡æ¯ã€‚ transientä½¿ç”¨å°ç»“ ä¸€æ—¦å˜é‡è¢«transientä¿®é¥°ï¼Œå˜é‡å°†ä¸å†æ˜¯å¯¹è±¡æŒä¹…åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥å˜é‡å†…å®¹åœ¨åºåˆ—åŒ–åæ— æ³•è·å¾—è®¿é—®ã€‚ transientå…³é”®å­—åªèƒ½ä¿®é¥°å˜é‡ï¼Œè€Œä¸èƒ½ä¿®é¥°æ–¹æ³•å’Œç±»ã€‚æ³¨æ„ï¼Œæœ¬åœ°å˜é‡æ˜¯ä¸èƒ½è¢«transientå…³é”®å­—ä¿®é¥°çš„ã€‚å˜é‡å¦‚æœæ˜¯ç”¨æˆ·è‡ªå®šä¹‰ç±»å˜é‡ï¼Œåˆ™è¯¥ç±»éœ€è¦å®ç°Serializableæ¥å£ã€‚ è¢«transientå…³é”®å­—ä¿®é¥°çš„å˜é‡ä¸å†èƒ½è¢«åºåˆ—åŒ–ï¼Œä¸€ä¸ªé™æ€å˜é‡ä¸ç®¡æ˜¯å¦è¢«transientä¿®é¥°ï¼Œå‡ä¸èƒ½è¢«åºåˆ—åŒ–ã€‚ ç¬¬ä¸‰ç‚¹å¯èƒ½æœ‰äº›äººå¾ˆè¿·æƒ‘ï¼Œå› ä¸ºå‘ç°åœ¨Userç±»ä¸­çš„usernameå­—æ®µå‰åŠ ä¸Šstaticå…³é”®å­—åï¼Œç¨‹åºè¿è¡Œç»“æœä¾ç„¶ä¸å˜ï¼Œå³staticç±»å‹çš„usernameä¹Ÿè¯»å‡ºæ¥ä¸ºâ€œAlexiaâ€äº†ï¼Œè¿™ä¸ä¸ç¬¬ä¸‰ç‚¹è¯´çš„çŸ›ç›¾å—ï¼Ÿå®é™…ä¸Šæ˜¯è¿™æ ·çš„ï¼šç¬¬ä¸‰ç‚¹ç¡®å®æ²¡é”™ï¼ˆä¸€ä¸ªé™æ€å˜é‡ä¸ç®¡æ˜¯å¦è¢«transientä¿®é¥°ï¼Œå‡ä¸èƒ½è¢«åºåˆ—åŒ–ï¼‰ï¼Œååºåˆ—åŒ–åç±»ä¸­staticå‹å˜é‡usernameçš„å€¼ä¸ºå½“å‰JVMä¸­å¯¹åº”staticå˜é‡çš„å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯JVMä¸­çš„ä¸æ˜¯ååºåˆ—åŒ–å¾—å‡ºçš„ï¼Œä¸ç›¸ä¿¡ï¼Ÿå¥½å§ï¼Œä¸‹é¢æˆ‘æ¥è¯æ˜ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384import java.io.FileInputStream;import java.io.FileNotFoundException;import java.io.FileOutputStream;import java.io.IOException;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.io.Serializable;/** * @description ä½¿ç”¨transientå…³é”®å­—ä¸åºåˆ—åŒ–æŸä¸ªå˜é‡ * æ³¨æ„è¯»å–çš„æ—¶å€™ï¼Œè¯»å–æ•°æ®çš„é¡ºåºä¸€å®šè¦å’Œå­˜æ”¾æ•°æ®çš„é¡ºåºä¿æŒä¸€è‡´ * * @author Alexia * @date 2013-10-15 */public class TransientTest &#123; public static void main(String[] args) &#123; User user = new User(); user.setUsername("Alexia"); user.setPasswd("123456"); System.out.println("read before Serializable: "); System.out.println("username: " + user.getUsername()); System.err.println("password: " + user.getPasswd()); try &#123; ObjectOutputStream os = new ObjectOutputStream( new FileOutputStream("C:/user.txt")); os.writeObject(user); // å°†Userå¯¹è±¡å†™è¿›æ–‡ä»¶ os.flush(); os.close(); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; try &#123; // åœ¨ååºåˆ—åŒ–ä¹‹å‰æ”¹å˜usernameçš„å€¼ User.username = "jmwang"; ObjectInputStream is = new ObjectInputStream(new FileInputStream( "C:/user.txt")); user = (User) is.readObject(); // ä»æµä¸­è¯»å–Userçš„æ•°æ® is.close(); System.out.println("\nread after Serializable: "); System.out.println("username: " + user.getUsername()); System.err.println("password: " + user.getPasswd()); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; &#125;&#125;class User implements Serializable &#123; private static final long serialVersionUID = 8294180014912103005L; public static String username; private transient String passwd; public String getUsername() &#123; return username; &#125; public void setUsername(String username) &#123; this.username = username; &#125; public String getPasswd() &#123; return passwd; &#125; public void setPasswd(String passwd) &#123; this.passwd = passwd; &#125;&#125; 1234567read before Serializable: username: Alexiapassword: 123456read after Serializable: username: jmwangpassword: null è¿™è¯´æ˜ååºåˆ—åŒ–åç±»ä¸­staticå‹å˜é‡usernameçš„å€¼ä¸ºå½“å‰JVMä¸­å¯¹åº”staticå˜é‡çš„å€¼ï¼Œä¸ºä¿®æ”¹åjmwangï¼Œè€Œä¸æ˜¯åºåˆ—åŒ–æ—¶çš„å€¼Alexiaã€‚ 3. transientä½¿ç”¨ç»†èŠ‚â€”â€”è¢«transientå…³é”®å­—ä¿®é¥°çš„å˜é‡çœŸçš„ä¸èƒ½è¢«åºåˆ—åŒ–å—ï¼Ÿ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748import java.io.Externalizable;import java.io.File;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.IOException;import java.io.ObjectInput;import java.io.ObjectInputStream;import java.io.ObjectOutput;import java.io.ObjectOutputStream;/** * @descripiton Externalizableæ¥å£çš„ä½¿ç”¨ * * @author Alexia * @date 2013-10-15 * */public class ExternalizableTest implements Externalizable &#123; private transient String content = "æ˜¯çš„ï¼Œæˆ‘å°†ä¼šè¢«åºåˆ—åŒ–ï¼Œä¸ç®¡æˆ‘æ˜¯å¦è¢«transientå…³é”®å­—ä¿®é¥°"; @Override public void writeExternal(ObjectOutput out) throws IOException &#123; out.writeObject(content); &#125; @Override public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException &#123; content = (String) in.readObject(); &#125; public static void main(String[] args) throws Exception &#123; ExternalizableTest et = new ExternalizableTest(); ObjectOutput out = new ObjectOutputStream(new FileOutputStream( new File("test"))); out.writeObject(et); ObjectInput in = new ObjectInputStream(new FileInputStream(new File( "test"))); et = (ExternalizableTest) in.readObject(); System.out.println(et.content); out.close(); in.close(); &#125;&#125; contentå˜é‡ä¼šè¢«åºåˆ—åŒ–å—ï¼Ÿ å¥½å§ï¼Œæˆ‘æŠŠç­”æ¡ˆéƒ½è¾“å‡ºæ¥äº†ï¼Œæ˜¯çš„ï¼Œè¿è¡Œç»“æœå°±æ˜¯ï¼šæ˜¯çš„ï¼Œæˆ‘å°†ä¼šè¢«åºåˆ—åŒ–ï¼Œä¸ç®¡æˆ‘æ˜¯å¦è¢«transientå…³é”®å­—ä¿®é¥° è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Œä¸æ˜¯è¯´ç±»çš„å˜é‡è¢«transientå…³é”®å­—ä¿®é¥°ä»¥åå°†ä¸èƒ½åºåˆ—åŒ–äº†å—ï¼Ÿ â€‹ æˆ‘ä»¬çŸ¥é“åœ¨Javaä¸­ï¼Œå¯¹è±¡çš„åºåˆ—åŒ–å¯ä»¥é€šè¿‡å®ç°ä¸¤ç§æ¥å£æ¥å®ç°ï¼Œè‹¥å®ç°çš„æ˜¯Serializableæ¥å£ï¼Œåˆ™æ‰€æœ‰çš„åºåˆ—åŒ–å°†ä¼šè‡ªåŠ¨è¿›è¡Œï¼Œè‹¥å®ç°çš„æ˜¯Externalizableæ¥å£ï¼Œåˆ™æ²¡æœ‰ä»»ä½•ä¸œè¥¿å¯ä»¥è‡ªåŠ¨åºåˆ—åŒ–ï¼Œéœ€è¦åœ¨writeExternalæ–¹æ³•ä¸­è¿›è¡Œæ‰‹å·¥æŒ‡å®šæ‰€è¦åºåˆ—åŒ–çš„å˜é‡ï¼Œè¿™ä¸æ˜¯å¦è¢«transientä¿®é¥°æ— å…³ã€‚å› æ­¤ç¬¬äºŒä¸ªä¾‹å­è¾“å‡ºçš„æ˜¯å˜é‡contentåˆå§‹åŒ–çš„å†…å®¹ï¼Œè€Œä¸æ˜¯nullã€‚ è½¬è½½äºï¼šJava transientå…³é”®å­—ä½¿ç”¨å°è®°]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>transient</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Leetcodeå­¦ä¹ ]]></title>
    <url>%2F2019%2F10%2F12%2Fleetcode%E7%83%AD%E9%A2%98100.html</url>
    <content type="text"><![CDATA[ç¬¬1é¢˜ï¼šä¸¤æ•°ä¹‹å’Œé¢˜ç›®ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸ºç›®æ ‡å€¼çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›ä»–ä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œä½ ä¸èƒ½é‡å¤åˆ©ç”¨è¿™ä¸ªæ•°ç»„ä¸­åŒæ ·çš„å…ƒç´ ã€‚ ç¤ºä¾‹ç»™å®š nums = [2, 7, 11, 15], target = 9 å› ä¸º nums[0] + nums[1] = 2 + 7 = 9æ‰€ä»¥è¿”å› [0, 1] æˆ‘çš„æ€è·¯ å…ˆæ’åº æ’é™¤æ¯”targetå¤§çš„æ•° ä»æœ€é è¿‘targetçš„æ•°å¼€å§‹éå† è®°å½•æ‰¾åˆ°çš„æ•°çš„ä¸‹æ ‡è¾“å‡ºå³å¯ æˆ‘çš„ä»£ç ï¼ˆæœªACï¼‰123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566import java.util.Arrays;public class twoNumbersSum &#123; public int[] twoSum(int[] nums, int target) &#123; //å…ˆæ’åº int[] nums_copy = Arrays.copyOf(nums,nums.length); Arrays.sort(nums_copy); int i; //æ’é™¤æ¯”targetå¤§çš„æ•° //ä»æœ€é è¿‘targetçš„æ•°å¼€å§‹éå† //è®°å½•æ‰¾åˆ°çš„æ•°çš„ä¸‹æ ‡ï¼Œè¾“å‡ºå³å¯ int t; int k; for(i = nums_copy.length-1; i &gt; 0 ;i--)&#123; if(nums_copy[i] &lt;= target)&#123; if(Arrays.binarySearch(nums_copy,0,i,target-nums_copy[i]) &gt;= 0)&#123; if(nums_copy[i] * 2 == target) &#123; int[] twobro = new int[2]; int d=0; for(int h=0;h&lt;nums.length;h++)&#123; if(nums[h] == nums_copy[i])&#123; twobro[d] = h; d++; &#125; &#125; return twobro; &#125; else&#123; for(int m=0;m &lt; nums.length;m++)&#123; if(nums[m] == nums_copy[i])&#123; t = m; &#125; if(nums[m] == (target-nums_copy[i]))&#123; k = m; &#125; &#125; k = Arrays.binarySearch(nums,target-nums_copy[i]); t = Arrays.binarySearch(nums,nums_copy[i]); &#125; return new int[]&#123;k,t&#125;; &#125; &#125; &#125; return null; &#125; public static void main(String[] args) &#123; twoNumbersSum tws = new twoNumbersSum(); int[] receive = new int[20]; receive = tws.twoSum(new int[]&#123;0,4,3,0&#125;,0); if(receive == null) &#123; System.out.println("ä¸å­˜åœ¨"); &#125; else&#123; System.out.println(receive[0] + "\n" + receive[1]); &#125; &#125;&#125; æ­£ç¡®æ€è·¯åˆ©ç”¨ HashMap è®°å½•æ•°ç»„å…ƒç´ å€¼å’Œå¯¹åº”çš„ä¸‹æ ‡ï¼Œå¯¹äºä¸€ä¸ªæ•° nums[i]ï¼Œåˆ¤æ–­ target - nums[i] æ˜¯å¦å­˜åœ¨ HashMap ä¸­ï¼Œå­˜åœ¨çš„è¯ï¼Œè¿”å›ä¸¤ä¸ªä¸‹æ ‡ç»„æˆçš„æ•°ç»„ã€‚æ³¨æ„ï¼Œå·²å­˜åœ¨çš„å…ƒç´ ä¸‹æ ‡åœ¨å‰ï¼Œå½“å‰å…ƒç´ ä¸‹æ ‡åœ¨åã€‚ æ­£ç¡®ä»£ç 123456789101112class Solution &#123; public int[] twoSum(int[] nums, int target) &#123; Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); for (int i = 0; i &lt; nums.length; ++i) &#123; if (map.containsKey(target - nums[i])) &#123; return new int[] &#123;map.get(target - nums[i]), i&#125;; &#125; map.put(nums[i], i); &#125; return null; &#125;&#125; æ¶‰åŠçš„çŸ¥è¯†ç‚¹æ•°ç»„å†…å®¹ ä¸€ç»´å’ŒäºŒç»´æ•°ç»„ä¸€ç»´æ•°ç»„ï¼šint[] a = new int[4];äºŒç»´æ•°ç»„ï¼š 1234//ç¬¬ä¸€è¡Œ4ä¸ªå…ƒç´ ï¼Œç¬¬äºŒè¡Œ5ä¸ªå…ƒç´ int[][] a = new int[2][];a[0] = new int[4];a[1] = new int[5]; Arraysç±»java.util.Arraysç±»èƒ½å¤Ÿæ–¹ä¾¿çš„æ“ä½œæ•°ç»„ï¼Œæä¾›çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼š 12345678910import java.util.Arrays;public int[] twoSum(int[] nums, int target) &#123; int[] nums_copy = Arrays.copyOf(nums,nums.length); Arrays.fill(nums,2); Integer index = Arrays.binarySearch(nums,target); Arrays.equals(nums,nums_copy); Arrays.sort(nums); return new int[]&#123;0,0,0&#125;;&#125; æ€»å…±5ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯copyOf,fill,binarySearch,equals,sortã€‚ç¬¬ä¸€ä¸ªç”¨æ¥å¤åˆ¶åŸå§‹æ•°ç»„ï¼Œæ–¹ä¾¿åç»­æ’åºçš„æ“ä½œï¼Œfillæ˜¯ç”¨æ¥åˆå§‹åŒ–æ•°ç»„æ¯”è¾ƒæ–¹ä¾¿ï¼Œå¯ä»¥å°†æ‰€æœ‰æ•°ç»„ä¸­çš„å€¼å…¨éƒ¨åˆå§‹åŒ–ä¸ºåŒä¸€ä¸ªå€¼ï¼ŒbinarySearchæ˜¯äºŒåˆ†æŸ¥æ‰¾ï¼Œè¿”å›çš„æ˜¯è¯¥æ•°çš„ç´¢å¼•å€¼ï¼Œsortæ˜¯ç”¨æ¥æ’åºçš„ã€‚ binarySearch()è‡ªå·±å†™ä»£ç çš„æ—¶å€™ç”¨åˆ°äº†è¿™ä¸ªæ–¹æ³•ï¼Œé¦–å…ˆè¯¥æ–¹æ³•éœ€è¦æ•°ç»„æ’å¥½åºæ‰èƒ½è°ƒç”¨ï¼Œå…¶æ¬¡å¾ˆç‰¹åˆ«çš„æ˜¯ï¼Œå¦‚æœè¦æ‰¾çš„å€¼åœ¨æ•°ç»„ä¸­ï¼Œåˆ™ä¼šè¿”å›æœç´¢é”®çš„ç´¢å¼•ï¼Œä½†æ˜¯ï¼Œæ³¨æ„ï¼šå€¼ä¸å­˜åœ¨äºæ•°ç»„çš„è¯ä¼šè¿”å›-1æˆ–è€…æ˜¯ç›®æ ‡å€¼éœ€è¦æ’å…¥çš„ä½ç½®ï¼Œä»1å¼€å§‹æ•°èµ·ï¼Œä¸æ˜¯0å“¦ï¼ï¼ï¼è¿™ä¸ªå†™çš„è´¼å¥½å“ˆå“ˆå“ˆå“ˆï¼šæ•°ç»„æŸ¥è¯¢Arraysç±»çš„binarySearch()æ–¹æ³•è¯¦è§£ map.containsKeyå’Œmap.get()åŒºåˆ«hashmapåˆ¤æ–­æ˜¯å¦å­˜åœ¨keyæ—¶ï¼Œä½¿ç”¨get(key)==nullåˆ¤æ–­è¿˜æ˜¯containsKeyï¼Ÿkeyå€¼å¯èƒ½ä¸ºnullï¼Œè‹¥æ­¤æ—¶Mapé›†åˆå€¼å¯¹è±¡ä¸ºnullï¼Œå¹¶ä¸”æ²¡æœ‰ä¸ªæ•°é™åˆ¶ï¼Œæ‰€ä»¥å½“get()æ–¹æ³•çš„è¿”å›å€¼ä¸ºnullæ—¶ï¼Œå¯èƒ½æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯åœ¨é›†åˆä¸­æ²¡æœ‰è¯¥é”®å¯¹è±¡ï¼Œå¦ä¸€ç§æ˜¯è¯¥é”®å¯¹è±¡æ²¡æœ‰æ˜ å°„ä»»ä½•å€¼å¯¹è±¡ï¼Œå³å€¼å¯¹è±¡ä¸ºnullã€‚å› æ­¤ï¼Œåœ¨Mapé›†åˆä¸­ä¸åº”è¯¥åˆ©ç”¨get(Object key)æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŸä¸ªé”®ï¼Œè€Œåº”è¯¥åˆ©ç”¨containsKey()æ–¹æ³•æ¥åˆ¤æ–­,containsKeyæ–¹æ³•ç”¨æ¥åˆ¤æ–­Mapé›†åˆå¯¹è±¡ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šçš„é”®åã€‚ä¸€å¥è¯æ¦‚æ‹¬:get()å¦‚æœå¾—åˆ°nullï¼Œå¯èƒ½è¿™æ˜¯é”®å¯¹åº”çš„å€¼å¯¹è±¡ä¸ºnullä¹Ÿå¯èƒ½æ˜¯ä¸å­˜åœ¨è¯¥é”®ï¼Œè€ŒcontainsKeyåˆ™æ˜¯falseæˆ–trueï¼Œä¸å­˜åœ¨è¿™ç§ç–‘é—®ã€‚ æ‰©å……:map.containsKey()ã€map.containsValue()ã€map.get() getçš„è¿‡ç¨‹æ˜¯å…ˆè®¡ç®—hashï¼Œç„¶åé€šè¿‡hashä¸table.lengthå–æ‘¸è®¡ç®—indexå€¼ï¼Œç„¶åéå†table[index]ä¸Šçš„é“¾è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°keyï¼Œç„¶åè¿”å›ï¼› 1234567891011121314public V get(Object key) &#123; if (key == null) return getForNullKey();//å¤„ç†nullå€¼ int hash = hash(key.hashCode());//è®¡ç®—hash //åœ¨table[index]éå†æŸ¥æ‰¾keyï¼Œè‹¥æ‰¾åˆ°åˆ™è¿”å›valueï¼Œæ‰¾ä¸åˆ°è¿”å›null for (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) return e.value; &#125; return null; &#125; containsKeyæ–¹æ³•ä¹Ÿæ˜¯å…ˆè®¡ç®—hashï¼Œç„¶åä½¿ç”¨hashå’Œtable.lengthå–æ‘¸å¾—åˆ°indexå€¼ï¼Œéå†table[index]å…ƒç´ æŸ¥æ‰¾æ˜¯å¦åŒ…å«keyç›¸åŒçš„å€¼ï¼› 123456789101112131415public boolean containsKey(Object key) &#123; return getEntry(key) != null; &#125;final Entry&lt;K,V&gt; getEntry(Object key) &#123; int hash = (key == null) ? 0 : hash(key.hashCode()); for (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; return null; &#125; çœ‹ä»£ç èƒ½çœ‹åˆ°åŒºåˆ«ï¼Œä¸€ä¸ªæ˜¯è¿”å›keyå¯¹åº”çš„valueå€¼ï¼Œä¸€ä¸ªæ˜¯è¿”å›æ˜¯å¦æœ‰è¯¥keyçš„booleanå˜é‡ã€‚ containsValueæ–¹æ³•å°±æ¯”è¾ƒç²—æš´äº†ï¼Œå°±æ˜¯ç›´æ¥éå†æ‰€æœ‰å…ƒç´ ç›´åˆ°æ‰¾åˆ°valueï¼Œç”±æ­¤å¯è§HashMapçš„containsValueæ–¹æ³•æœ¬è´¨ä¸Šå’Œæ™®é€šæ•°ç»„å’Œlistçš„containsæ–¹æ³•æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä½ åˆ«æŒ‡æœ›å®ƒä¼šåƒcontainsKeyé‚£ä¹ˆé«˜æ•ˆã€‚ 1234567891011public boolean containsValue(Object value) &#123; if (value == null) return containsNullValue(); Entry[] tab = table; for (int i = 0; i &lt; tab.length ; i++) for (Entry e = tab[i] ; e != null ; e = e.next) if (value.equals(e.value)) return true; return false; &#125; çŸ¥è¯†ç¼ºé™· å‹æ ¹æ²¡æƒ³åˆ°ç”¨Mapå»åš è‡ªå·±åªè€ƒè™‘åˆ°äº†å…¨æ˜¯æ­£æ•°çš„æƒ…å†µï¼Œæ‰€ä»¥ç”¨äº†æ’åºå’Œè·Ÿ0åˆ¤æ–­ï¼Œå¦‚æœå«æœ‰è´Ÿæ•°çš„è¯å°±åšä¸äº†äº†â€¦â€¦ æ”¶è·åœ¨é‡åˆ°æ•°ç»„é—®é¢˜æ—¶ï¼Œå¯ä»¥è€ƒè™‘ç”¨mapï¼Œå› ä¸ºç´¢å¼•å’Œæ•°å€¼å°±æ˜¯ä¸€ä¸ªå¤©ç”Ÿçš„mapé›†åˆï¼Œå¦‚æœæˆ‘çŸ¥é“æ•°å€¼ï¼Œæˆ‘å°±å¯ä»¥é€šè¿‡mapæ‰¾åˆ°å…¶ç´¢å¼•ï¼Œæœ¬é¢˜æ€è·¯å°±æ˜¯è¿™æ ·ï¼Œå½“å·²çŸ¥ä¸€ä¸ªå€¼æ˜¯æˆ‘æ‰€éœ€è¦çš„ï¼Œç›´æ¥ä»mapä¸­æ‹¿å‡ºå°±è¡Œã€‚ æ’å…¥çŸ¥è¯†ç‚¹æ—¢ç„¶å¤ä¹ åˆ°äº†mapï¼Œé‚£å°±ç»™listã€setå’Œmapæ¥ä¸€ä¸ªå…¨éƒ¨çš„å¤ä¹ å§ï¼ï¼ï¼å˜¿å˜¿å¼€å§‹å§ï¼ï¼ï¼å…ˆæ¥ä¸Šä¸ªé“¾æ¥ï¼Œä¸»è¦æ˜¯çœ‹çš„è¿™ä¸ªå†™çš„ï¼šJavaé›†åˆä¸­List,Setä»¥åŠMapç­‰é›†åˆä½“ç³»è¯¦è§£(å²ä¸Šæœ€å…¨) collectionå…ˆä¸Šä¸ªå›¾ï¼šè¿™ä¸ªå›¾ç”»çš„å¥½å•Šå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆä¸ççš„éƒ½çœ‹å¾—åˆ°ï¼ŒCollectionè¿™ä¸ªæ¥å£ä¸‹æœ‰ä¸‰ä¸ªæ¥å£ç»§æ‰¿ï¼Œåˆ†åˆ«æ˜¯Setã€Listã€Queue(æˆ‘ä»–å¦ˆå¥½åƒæ²¡æ€ä¹ˆç”¨è¿‡Queueå•Šï¼Œä»¥åè¦å¤šç”¨ç‚¹äº†)ï¼ŒSetæœ‰ä¸‰ä¸ªå®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯HashSetã€LinkedHashSetã€TreeSetï¼ŒListæœ‰ä¸‰ä¸ªå®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯ArrayListã€Vector(æ„Ÿè§‰ç°åœ¨æ˜¯ä¸æ˜¯ç”¨çš„æ¯”è¾ƒå°‘å•Šâ€¦)ã€LinkedListï¼Œå’¦è¿™ä¸ªLinkedListç‰›é€¼å•Šï¼Œç«Ÿç„¶è¿˜æ˜¯Queueçš„å®ç°ç±»ï¼Œä¸è¿‡çœ‹åˆ«äººåšå®¢å¥½åƒæ˜¯è¯´ç»§æ‰¿Queueéƒ¨åˆ†çš„LinkedListæ˜¯è¢«é˜‰å‰²äº†çš„å®ç°ç±»ï¼Œä¹Ÿå°±æ˜¯Queueä¸èƒ½è®¿é—®åˆ°LinkedListçš„æ‰€æœ‰æ–¹æ³•(ç®¡å®ƒå‘¢æˆ‘éƒ½æ²¡ç”¨è¿‡â€¦)ï¼Œè¿˜æœ‰ä¸€ä¸ªPriorityQueue,çœ‹åå­—å°±çŸ¥é“æ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—å•¦ï¼(å¦ˆå‘€çœ‹çš„èµ„æ–™å¤ªå¤šï¼Œæƒ³å•ç‹¬å¼€ä¸€ç¯‡æ¥æ€»ç»“é›†åˆæºç å’ŒMapæºç äº†â€¦ç®—äº†å…ˆè¿™æ ·å†™ç€å§) ####å…ˆåˆ—ä¸ªæçº²ï¼š 1.å…ˆç»¼è¿°ä¸€ä¸‹collectionä¸­ä¸‰ä¸ªå„¿å­æ¥å£å¾—å„ä¸ªå®ç°ç±»çš„ç‰¹ç‚¹ï¼Œæ¯”å¦‚åº•å±‚å®ç°ï¼Œä¼˜ç¼ºç‚¹ç­‰ç­‰ï¼› è¿˜æœ‰è¦è€ƒè™‘çš„å°±æ˜¯base caseï¼Œç”±äºæ˜¯æœ€çŸ­é€’å½’å­åºåˆ—è‡³å°‘ä¸º1ï¼Œæ‰€ä»¥base caseä¸º1ï¼Œæ‰€ä»¥dpæ•°ç»„å…¨éƒ¨åˆå§‹åŒ–ä¸º1å³å¯ã€‚ 3.é¢è¯•å¸¸é—®åˆ°çš„ç‚¹ ç»¼è¿°â€” List æœ‰åº,å¯é‡å¤ ArrayListä¼˜ç‚¹: åº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼ŒæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢ã€‚ç¼ºç‚¹: çº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•ˆç‡é«˜ç‰¹ç‚¹: å…è®¸nullï¼Œä¸åŒæ­¥Vectorä¼˜ç‚¹: åº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼ŒæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢ã€‚ç¼ºç‚¹: çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ä½tips:æ‰€è°“çš„çº¿ç¨‹å®‰å…¨ï¼Œæ˜¯ç›¸å¯¹çš„ï¼Œåœ¨vectorå†…éƒ¨å†…éƒ¨å†…éƒ¨ï¼Œå…¶æ‰€æœ‰æ–¹æ³•ä¸ä¼šè¢«å¤šçº¿ç¨‹æ‰€è®¿é—®ï¼Œå•ä¸ªæ–¹æ³•çš„åŸå­æ€§ï¼ˆæ³¨ï¼šåŸå­æ€§ï¼Œç¨‹åºçš„åŸå­æ€§å³ä¸ä¼šè¢«çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ‰“æ–­ï¼‰ï¼Œå¹¶ä¸èƒ½ä¿è¯å¤åˆæ“ä½œä¹Ÿå…·æœ‰åŸå­æ€§ï¼Œæ‰€ä»¥å¦‚æœæ˜¯å¤åˆæ“ä½œï¼ŒåŒæ ·çº¿ç¨‹ä¸å®‰å…¨ï¼ï¼å¦‚æœè¦ä¿è¯çœŸæ­£çš„çº¿ç¨‹å®‰å…¨ï¼Œè¿˜éœ€è¦ä»¥vectorå¯¹è±¡ä¸ºé”ï¼Œæ¥è¿›è¡Œæ“ä½œï¼Œä½†è¿™æ ·å°±è·ŸArrayListæ²¡å•¥åŒºåˆ«äº†â€¦â€”â€”â€”â€“&gt; Vectoræ˜¯çº¿ç¨‹å®‰å…¨å—ç‰¹ç‚¹ï¼šå…è®¸nullï¼Œä¸åŒæ­¥LinkedListä¼˜ç‚¹: åº•å±‚æ•°æ®ç»“æ„æ˜¯åŒå‘é“¾è¡¨ï¼ŒæŸ¥è¯¢æ…¢ï¼Œå¢åˆ å¿«ã€‚æ•…æ—¢å¯ä»¥åšQueueï¼Œåˆå¯ä»¥åšStackã€‚ç¼ºç‚¹: çº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•ˆç‡é«˜ç‰¹ç‚¹ï¼šå…è®¸nullï¼Œä¸åŒæ­¥ â€”Set æ— åº,å”¯ä¸€ HashSetï¼ˆä¸åŒæ­¥ï¼Œå…è®¸nullï¼‰åº•å±‚æ•°æ®ç»“æ„æ˜¯å“ˆå¸Œè¡¨(æ— åº,å”¯ä¸€)ï¼Œå…¶å®å°±æ˜¯HashMapçš„å®ä¾‹ï¼Œåªä¸è¿‡å€¼æ˜¯keyï¼Œvalueæ˜¯ä¸€ä¸ªå›ºå®šçš„å¯¹è±¡ã€‚å¦‚ä½•æ¥ä¿è¯å…ƒç´ å”¯ä¸€æ€§?1.ä¾èµ–ä¸¤ä¸ªæ–¹æ³•ï¼šhashCode()å’Œequals() LinkedHashSetï¼ˆä¸åŒæ­¥ï¼Œå…è®¸nullï¼‰åº•å±‚æ•°æ®ç»“æ„æ˜¯åŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨ã€‚(FIFOæ’å…¥æœ‰åº,å”¯ä¸€)ï¼Œå®é™…ä¸Šä¾æ—§æ˜¯LinkedHashMapçš„å®ä¾‹ï¼Œå¾…ä¼šæºç åˆ†æçœ‹çœ‹1.ç”±é“¾è¡¨ä¿è¯å…ƒç´ æœ‰åº2.ç”±å“ˆå¸Œè¡¨ä¿è¯å…ƒç´ å”¯ä¸€ TreeSetï¼ˆå…è®¸nullï¼Œä¸åŒæ­¥ï¼‰åº•å±‚æ•°æ®ç»“æ„æ˜¯çº¢é»‘æ ‘ã€‚(å”¯ä¸€ï¼Œæœ‰åºï¼Œè¿™é‡Œçš„æœ‰åºæŒ‡çš„æ˜¯æ’åºå¥½çš„ï¼Œä¸æ˜¯è¯´FIFOä¹‹ç±»çš„)ï¼Œå®é™…ä¸Šä¾æ—§æ˜¯TreeMapçš„å®ä¾‹ å¦‚ä½•ä¿è¯å…ƒç´ æ’åºçš„å‘¢?è‡ªç„¶æ’åº(é‡å†™):1.Studentç±»ä¸­å®ç° Comparableæ¥å£ 2.é‡å†™Comparableæ¥å£ä¸­çš„Comparetoræ–¹æ³•æ¯”è¾ƒå™¨æ’åº:1.å•ç‹¬åˆ›å»ºä¸€ä¸ªæ¯”è¾ƒç±»ï¼Œè¿™é‡Œä»¥MyComparatorä¸ºä¾‹ï¼Œå¹¶ä¸”è¦è®©å…¶ç»§æ‰¿Comparatoræ¥å£ 2.é‡å†™Comparatoræ¥å£ä¸­çš„Compareæ–¹æ³•2.å¦‚ä½•ä¿è¯å…ƒç´ å”¯ä¸€æ€§çš„å‘¢?æ ¹æ®æ¯”è¾ƒçš„è¿”å›å€¼æ˜¯å¦æ˜¯0æ¥å†³å®š -Queue PriorityQueueï¼šä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ŒæŒ‰ç…§å¤§å°æ’åºå¥½äº†çš„é˜Ÿåˆ—ï¼Œå¹¶ä¸éµå¾ªå…ˆè¿›å…ˆå‡ºï¼Œä¸å…è®¸nullå…ƒç´ ï¼Œå¤´éƒ¨æ˜¯æœ€å°å…ƒç´ ï¼Œåº•å±‚é‡‡ç”¨çš„æ•°ç»„å’Œå †ã€‚ PriorityQueueä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹ä¸­çš„ä»»æ„çº¿ç¨‹ä»ç»“æ„ä¸Šä¿®æ”¹äº†åˆ—è¡¨ï¼Œ åˆ™è¿™äº›çº¿ç¨‹ä¸åº”åŒæ—¶è®¿é—®PriorityQueue å®ä¾‹ï¼Œè¿™æ—¶è¯·ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„PriorityBlockingQueue ç±»ã€‚ ä¸å…è®¸æ’å…¥ null å…ƒç´ ã€‚ PriorityQueueå®ç°æ’å…¥æ–¹æ³•ï¼ˆofferã€pollã€remove() å’Œ add æ–¹æ³•ï¼‰ çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(log(n)) ï¼›å®ç° remove(Object) å’Œ contains(Object) æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n) ï¼›å®ç°æ£€ç´¢æ–¹æ³•ï¼ˆpeekã€element å’Œ sizeï¼‰çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ã€‚æ‰€ä»¥åœ¨éå†æ—¶ï¼Œè‹¥ä¸éœ€è¦åˆ é™¤å…ƒç´ ï¼Œåˆ™ä»¥peekçš„æ–¹å¼éå†æ¯ä¸ªå…ƒç´ ã€‚ æ–¹æ³•iterator()ä¸­æä¾›çš„è¿­ä»£å™¨å¹¶ä¸ä¿è¯ä»¥æœ‰åºçš„æ–¹å¼éå†PriorityQueueä¸­çš„å…ƒç´ ã€‚å‰©ä½™æœ‰å…³Queueé˜Ÿåˆ—çœ‹â€”â€“&gt; Javaé›†åˆï¼ˆä¸ƒï¼‰ Queueè¯¦è§£ åˆ†åˆ«é˜è¿°è¿™ä¸ªè¿˜æ˜¯å¦å¼€ä¸€ç¯‡å§â€¦å†…å®¹å¤ªå¤šäº†â€¦å¤Ÿå†™ä¸¤æ˜ŸæœŸäº†ï¼ï¼è¿˜æ˜¯ä¸æ”¾åœ¨è¿™å–§å®¾å¤ºä¸»äº†!! map å…·ä½“å±•å¼€è§å¦ä¸€ç¯‡åšå®¢ï¼šMapæºç åˆ†æ ç¬¬2é¢˜ï¼šä¸¤æ•°ç›¸åŠ é¢˜ç›®ç»™å‡ºä¸¤ä¸ª éç©º çš„é“¾è¡¨ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å…¶ä¸­ï¼Œå®ƒä»¬å„è‡ªçš„ä½æ•°æ˜¯æŒ‰ç…§ é€†åº çš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”å®ƒä»¬çš„æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ ä¸€ä½ æ•°å­—ã€‚ å¦‚æœï¼Œæˆ‘ä»¬å°†è¿™ä¸¤ä¸ªæ•°ç›¸åŠ èµ·æ¥ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªæ–°çš„é“¾è¡¨æ¥è¡¨ç¤ºå®ƒä»¬çš„å’Œã€‚ æ‚¨å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚ ç¤ºä¾‹123è¾“å…¥ï¼š(2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)è¾“å‡ºï¼š7 -&gt; 0 -&gt; 8åŸå› ï¼š342 + 465 = 807 æˆ‘çš„æ€è·¯ å…ˆè®²è¾“å…¥è¾“å‡ºã€‚è¦è¾“å…¥ä¸¤ä¸ªé“¾è¡¨ï¼Œé¦–å…ˆå°±è¦æ„é€ Nodeå®ä½“ç±»ï¼Œæ³¨æ„æ„é€ å‡½æ•°æœ‰å¤šä¸ªï¼Œæ ¹æ®å‚æ•°çš„ä¸åŒè¿›è¡Œé€‰æ‹©ï¼Œè¾“å‡ºåŒè¾“å…¥ï¼Œå°†ç»„åˆå¥½çš„é“¾è¡¨çš„å¤´ç»“ç‚¹(æœ‰æ•°æ®çš„)è¿”å›åï¼Œå°±å¯ä»¥å¾ªç¯å°†æ•´ä¸ªé“¾è¡¨æ‰“å°å‡ºæ¥äº†ï¼› å†è®²å®ç°ã€‚è§ä»£ç æ³¨é‡Šã€‚ æˆ‘çš„ä»£ç ï¼ˆACï¼‰123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100package é“¾è¡¨å®ç°_java.leecodeç¬¬äºŒé¢˜;public class leecode_second_Link &#123; public static void main(String[] args) &#123; Node head = new Node(2); Node node1 = new Node(5); Node node2 = new Node(8); Node node3 = new Node(7); head.setNext(node1); node1.setNext(node2); node2.setNext(node3); // æ‰“å°é“¾è¡¨1 Node temp = head; while (temp != null) &#123; if(temp.next == null) &#123; System.out.println(temp.getData()); &#125; else &#123; System.out.print(temp.getData() + "--&gt;"); &#125; temp = temp.getNext(); &#125; System.out.println("+"); Node head_sec = new Node(2); Node node1_sec = new Node(4); Node node2_sec = new Node(6); Node node3_sec = new Node(7); head_sec.setNext(node1_sec); node1_sec.setNext(node2_sec); node2_sec.setNext(node3_sec); // æ‰“å°é“¾è¡¨2 Node temp1 = head_sec; while (temp1 != null) &#123; if(temp1.next == null) &#123; System.out.println(temp1.getData()); &#125; else &#123; System.out.print(temp1.getData() + "--&gt;"); &#125; temp1 = temp1.getNext(); &#125; System.out.println("="); Node head3 = new leecode_second_Link().addTwoNums(head,head_sec); //æ‰“å°æ€»å’Œé“¾è¡¨ Node temp3 = head3; while(temp3 != null)&#123; if(temp3.next == null) &#123; System.out.println(temp3.getData()); &#125; else &#123; System.out.print(temp3.getData() + "--&gt;"); &#125; temp3 = temp3.getNext(); &#125; &#125; public Node addTwoNums(Node head1,Node head2)&#123; //æ²¡å•¥ç”¨ï¼Œåˆå§‹åŒ–å¤´ç»“ç‚¹(å¯ä»¥ä¸å¸¦æ•°æ®) Node res = new Node(0); //tempæ˜¯åé¢ç”¨æ¥éå†é“¾è¡¨çš„ Node temp = res; //è¿™ä¸ªæ˜¯å•†ï¼Œç”¨æ¥è¿›ä½ç»™ä¸‹ä¸€ä½çš„ int quo = 0; //å¾ªç¯ï¼Œåªæœ‰å½“ç¬¬ä¸€ä¸ªé“¾è¡¨ä¸­çš„å€¼ä¸ºç©ºä¸”ç¬¬äºŒä¸ªé“¾è¡¨ä¸­çš„å€¼ä¸ºç©ºä¸”æ²¡æœ‰äº†è¿›ä½ï¼Œè®¡ç®—æ‰ç®—ç»“æŸ while(head1 != null || head2 != null || quo != 0)&#123; //tä¸ºä¸¤é“¾è¡¨ç›¸åŒä½ç½®çš„å’ŒåŠ ä¸Šå‰é¢ä¸€ä½çš„è¿›ä½ int t = (head1 == null ? 0 : head1.data ) + (head2 == null ? 0 : head2.data) + quo; //å•† quo = t/10; //æ–°é“¾è¡¨åœ¨è¯¥ä½çš„å€¼ Node head3 = new Node(t % 10); //æ–°é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå€¼ temp.next = head3; //åªæœ‰è¿™æ ·ï¼Œæ‰èƒ½è®©é“¾è¡¨nextä¸‹å»ï¼Œè¿™ä¸¤æ­¥è¦å­¦ä¼šï¼Œä»¥åé“¾è¡¨ç»å¸¸è¦ç”¨ temp = head3; //åˆ†åˆ«çœ‹ä¸¤ä¸ªé“¾è¡¨æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºè¯´æ˜è¯¥ä½å·²ç»æ²¡äº†ï¼Œå¦åˆ™å°±nextä¸‹å» head1 = (head1 == null ? head1 : head1.next); head2 = (head2 == null ? head2 : head2.next); &#125; //è¿”å›é“¾è¡¨ç¬¬ä¸€ä¸ªæœ‰å€¼çš„èŠ‚ç‚¹ï¼Œç›¸å½“äºæœ‰å€¼çš„å¤´ç»“ç‚¹ return res.next; &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940package é“¾è¡¨å®ç°_java.leecodeç¬¬äºŒé¢˜;public class Node &#123; //æ•°æ®åŸŸ public Integer data; //æŒ‡é’ˆåŸŸï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ public Node next; public Node() &#123; &#125; public Node(int data) &#123; this.data = data; &#125; public Node(int data, Node next) &#123; this.data = data; this.next = next; &#125; public int getData() &#123; return data; &#125; public void setData(int Data) &#123; this.data = Data; &#125; public Node getNext() &#123; return next; &#125; public void setNext(Node Next) &#123; this.next = Next; &#125;&#125; æ­£ç¡®æ€è·¯åŒæ—¶éå†ä¸¤ä¸ªé“¾è¡¨ï¼Œå¯¹åº”å€¼ç›¸åŠ (è¿˜æœ‰ quotient)æ±‚ä½™æ•°å¾—åˆ°å€¼å¹¶èµ‹ç»™æ–°åˆ›å»ºçš„ç»“ç‚¹ã€‚è€Œå•†åˆ™ç”¨quotientå­˜å‚¨ï¼Œä¾›ä¸‹æ¬¡ç›¸åŠ ã€‚ æ­£ç¡®ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152//å¤æ‚ç‰ˆ/** * Definition for singly-linked list. * public class ListNode &#123; * int val; * ListNode next; * ListNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public ListNode addTwoNumbers(ListNode l1, ListNode l2) &#123; ListNode res = new ListNode(-1); ListNode cur = res; int quotient = 0; int t = 0; while (l1 != null &amp;&amp; l2 != null) &#123; t = l1.val + l2.val + quotient; quotient = t / 10; ListNode node = new ListNode(t % 10); cur.next = node; l1 = l1.next; l2 = l2.next; cur = node; &#125; while (l1 != null) &#123; t = l1.val + quotient; quotient = t / 10; ListNode node = new ListNode(t % 10); cur.next = node; l1 = l1.next; cur = node; &#125; while (l2 != null) &#123; t = l2.val + quotient; quotient = t / 10; ListNode node = new ListNode(t % 10); cur.next = node; l2 = l2.next; cur = node; &#125; if (quotient != 0) &#123; cur.next = new ListNode(quotient); cur = cur.next; &#125; return res.next; &#125;&#125; 1234567891011121314151617181920212223242526//ç®€åŒ–ç‰ˆ/** * Definition for singly-linked list. * public class ListNode &#123; * int val; * ListNode next; * ListNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public ListNode addTwoNumbers(ListNode l1, ListNode l2) &#123; ListNode res = new ListNode(-1); ListNode cur = res; int quotient = 0; while (l1 != null || l2 != null || quotient != 0) &#123; int t = (l1 == null ? 0 : l1.val) + (l2 == null ? 0 : l2.val) + quotient; quotient = t / 10; ListNode node = new ListNode(t % 10); cur.next = node; cur = node; l1 = (l1 == null) ? l1 : l1.next; l2 = (l2 == null) ? l2 : l2.next; &#125; return res.next; &#125;&#125; æ¶‰åŠçš„çŸ¥è¯†ç‚¹javaä¸­çš„å•é“¾è¡¨è§æˆ‘å†™çš„å¦å¤–ä¸€ç¯‡åšæ–‡ â€”â€”&gt; Javaå®ç°å•å‘é“¾è¡¨ ç¬¬3é¢˜ï¼šæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²é¢˜ç›®ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦ã€‚ ç¤ºä¾‹ç¤ºä¾‹ 1: 123è¾“å…¥: "abcabcbb"è¾“å‡º: 3 è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ "abc"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚ ç¤ºä¾‹ 2: 123è¾“å…¥: "bbbbb"è¾“å‡º: 1è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ "b"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 1ã€‚ ç¤ºä¾‹ 3: 1234è¾“å…¥: "pwwkew"è¾“å‡º: 3è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ "wke"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œ"pwke" æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚ æˆ‘çš„æ€è·¯è¦æ‰¾åˆ°ä¸€ä¸ªæœ€é•¿å­ä¸²ï¼Œå°±å¿…é¡»æœ‰ä¸€å¤´ä¸€å°¾ï¼Œæ‰€ä»¥å°±å¿…é¡»æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œç„¶ååˆæ˜¯å­—ç¬¦ä¸²å¯¹åº”ç´¢å¼•å€¼ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯éœ€è¦ç”¨mapæ¥æ“ä½œçš„ï¼Œkeyä¸ºç´¢å¼•å€¼ï¼Œvalueä¸ºç´¢å¼•æ‰€åœ¨ä½ç½®çš„å€¼ã€‚äºæ˜¯è®¾å®šä¸¤ä¸ªæŒ‡é’ˆpã€qï¼Œæœ€å¼€å§‹åŒæ—¶æŒ‡å®šåœ¨æœ€å¼€å§‹çš„ä½ç½®ï¼Œç„¶åqå‘åç§»åŠ¨ï¼Œæ¯ç§»åŠ¨ä¸€æ¬¡ï¼Œåªè¦qå¯¹åº”çš„å€¼æ²¡æœ‰åœ¨mapä¸­ï¼Œå°±å°†å…¶å€¼æ”¾å…¥mapï¼Œå¹¶ä¸”è®°å½•ä¸‹ä¸²çš„å¤§å°ï¼Œå½“ç¢°åˆ°äº†mapä¸­ç›¸åŒçš„å€¼æ—¶ï¼Œå°±å°†på‘åç§»åˆ°mapä¸­å‡ºç°è¯¥å€¼çš„ç´¢å¼•åä¸€ä½ï¼ŒåŒæ—¶æ³¨æ„ï¼ï¼ï¼æ­¤æ—¶på¯èƒ½ä¼šå›æº¯ï¼Œæ‰€ä»¥æ­¤æ—¶è¦ç”¨maxå‡½æ•°åˆ¤æ–­ä¸€ä¸‹ï¼Œç„¶åç»§ç»­åˆ¤æ–­ä¸²çš„å¤§å°å’Œç»§ç»­éå†çš„æœ€é•¿å­ä¸²çš„é•¿åº¦ï¼Œæœ€åè¿”å›æœ€é•¿å­ä¸²é•¿åº¦å³å¯ã€‚ æˆ‘çš„ä»£ç ï¼ˆACï¼‰1234567891011121314151617181920212223242526272829303132package ç¬¬ä¸‰é¢˜;import java.util.HashMap;import java.util.Scanner;public class lengthOfLongestSubstring &#123; public static void main(String[] args) &#123; Scanner a = new Scanner(System.in); System.out.println("è¯·è¾“å…¥ä¸²: "); String string = a.nextLine(); int num = new lengthOfLongestSubstring().lengthofSubstring(string); System.out.println("æœ€é•¿å­ä¸²çš„é•¿åº¦ä¸ºï¼š" + num); &#125; private int lengthofSubstring(String string) &#123; int max = 0; char[] chars = string.toCharArray(); int p=0,q=0; int len = chars.length; HashMap&lt;Character, Integer&gt; map = new HashMap&lt;&gt;(); while(q &lt; len)&#123; if(map.containsKey(chars[q]))&#123; p = Math.max(p,map.get(chars[q])+1); &#125; map.put(chars[q],q); max = Math.max(max,q-p+1); q++; &#125; return max; &#125;&#125; æ­£ç¡®æ€è·¯åˆ©ç”¨æŒ‡é’ˆ p, qï¼Œåˆå§‹æŒ‡å‘å­—ç¬¦ä¸²å¼€å¤´ã€‚éå†å­—ç¬¦ä¸²ï¼Œq å‘å³ç§»åŠ¨ï¼Œè‹¥æŒ‡å‘çš„å­—ç¬¦åœ¨ map ä¸­ï¼Œè¯´æ˜å‡ºç°äº†é‡å¤å­—ç¬¦ï¼Œæ­¤æ—¶ï¼Œp è¦åœ¨å‡ºç°é‡å¤å­—ç¬¦çš„ä¸‹ä¸€ä¸ªä½ç½® map.get(chars[q]) + 1 å’Œå½“å‰ä½ç½® p ä¹‹é—´å–è¾ƒå¤§å€¼ï¼Œé˜²æ­¢ p æŒ‡é’ˆå›æº¯ã€‚å¾ªç¯çš„è¿‡ç¨‹ä¸­ï¼Œè¦å°† chars[q] åŠå¯¹åº”ä½ç½®æ”¾å…¥ map ä¸­ï¼Œä¹Ÿéœ€è¦ä¸æ–­è®¡ç®—å‡ºmax ä¸ q - p + 1 çš„è¾ƒå¤§å€¼ï¼Œèµ‹ç»™ maxã€‚æœ€åè¾“å‡º max å³å¯ã€‚ æ­£ç¡®ä»£ç 123456789101112131415161718192021222324class Solution &#123; public int lengthOfLongestSubstring(String s) &#123; if (s == null || s.length() == 0) &#123; return 0; &#125; char[] chars = s.toCharArray(); int len = chars.length; int p = 0, q = 0; int max = 0; Map&lt;Character, Integer&gt; map = new HashMap&lt;&gt;(); while (q &lt; len) &#123; if (map.containsKey(chars[q])) &#123; // é˜²æ­¢pæŒ‡é’ˆå›æº¯ï¼Œå¯¼è‡´è®¡ç®—åˆ°é‡å¤å­—ç¬¦çš„é•¿åº¦ // eg. abba,å½“qæŒ‡å‘æœ€å³çš„aæ—¶ï¼Œè‹¥ç®€å•æŠŠpèµ‹ä¸ºmap.get(chars[q] + 1)ï¼Œåˆ™å‡ºç°æŒ‡é’ˆå›æº¯ p = Math.max(p, map.get(chars[q]) + 1); &#125; map.put(chars[q], q); max = Math.max(max, q - p + 1); ++q; &#125; return max; &#125;&#125; æ¶‰åŠçš„çŸ¥è¯†ç‚¹å¥½åƒå¹¶æ²¡æœ‰å•¥æ–°çŸ¥è¯†ç‚¹ï¼Œå…¶å®å°±æ˜¯ç”¨mapä»£æ›¿æŒ‡é’ˆçš„ä½œç”¨ã€‚ ç¬¬237é¢˜ï¼š åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹é¢˜ç›®è¯·ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œä½¿å…¶å¯ä»¥åˆ é™¤æŸä¸ªé“¾è¡¨ä¸­ç»™å®šçš„ï¼ˆéæœ«å°¾ï¼‰èŠ‚ç‚¹ï¼Œä½ å°†åªè¢«ç»™å®šè¦æ±‚è¢«åˆ é™¤çš„èŠ‚ç‚¹ã€‚ ç¤ºä¾‹ç¤ºä¾‹ 1 123è¾“å…¥: head = [4,5,1,9], node = 5è¾“å‡º: [4,1,9]è§£é‡Š: ç»™å®šä½ é“¾è¡¨ä¸­å€¼ä¸º 5 çš„ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨äº†ä½ çš„å‡½æ•°ä¹‹åï¼Œè¯¥é“¾è¡¨åº”å˜ä¸º 4 -&gt; 1 -&gt; 9 ç¤ºä¾‹ 2: 123è¾“å…¥: head = [4,5,1,9], node = 1è¾“å‡º: [4,5,9]è§£é‡Š: ç»™å®šä½ é“¾è¡¨ä¸­å€¼ä¸º 1 çš„ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨äº†ä½ çš„å‡½æ•°ä¹‹åï¼Œè¯¥é“¾è¡¨åº”å˜ä¸º 4 -&gt; 5 -&gt; 9 è¯´æ˜: é“¾è¡¨è‡³å°‘åŒ…å«ä¸¤ä¸ªèŠ‚ç‚¹ã€‚ é“¾è¡¨ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚ ç»™å®šçš„èŠ‚ç‚¹ä¸ºéæœ«å°¾èŠ‚ç‚¹å¹¶ä¸”ä¸€å®šæ˜¯é“¾è¡¨ä¸­çš„ä¸€ä¸ªæœ‰æ•ˆèŠ‚ç‚¹ã€‚ ä¸è¦ä»ä½ çš„å‡½æ•°ä¸­è¿”å›ä»»ä½•ç»“æœã€‚ æˆ‘çš„æ€è·¯æœ¬é¢˜é¢˜å¹²ä¸ªäººè§‰å¾—æ²¡æœ‰äº¤ä»£çš„å¾ˆæ¸…æ¥šï¼Œè®©äººæ„Ÿè§‰æœ‰ç‚¹æ‘¸ä¸ç€å¤´è„‘ï¼Œæ­£å¸¸æ¥è¯´åº”è¯¥æ˜¯ç»™å®šä¸¤ä¸ªå‚æ•°ï¼Œä½†æ˜¯è¦å†™çš„å‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æœ€å¼€å§‹ä¼šè®©äººæ„Ÿè§‰å¾ˆçªå…€ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™é“é¢˜è®¾è®¡çš„å¾ˆå·§å¦™ï¼Œä¸éœ€è¦ç»™å®šå¤´ç»“ç‚¹ï¼Œå¯ä»¥é‡‡ç”¨æ›¿èº«æ”»å‡»ï¼Œç»™å®šçš„nodeå…¶å®å°±å¯ä»¥å½“åšå¤´ç»“ç‚¹æ¥å¤„ç†ï¼Œå› ä¸ºä¸å¯èƒ½æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥åé¢ä¸€å®šæœ‰èŠ‚ç‚¹ï¼Œæ•…å¯ä»¥å°†nodeåèŠ‚ç‚¹ç‰ºç‰²æ‰ï¼Œè¿™æ ·å°±ç›¸å½“äºå°†nodeæœ¬èº«å¹²æ‰äº†ã€‚ ä¸ªäººé‡åˆ°çš„å›°éš¾ä¸»è¦æ˜¯åœ¨è¾“å…¥è¾“å‡ºï¼Œå°¤å…¶æ˜¯æ„é€ å•é“¾è¡¨çš„è¿‡ç¨‹èŠ±è´¹äº†æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ€»è€Œè¨€ä¹‹è¿˜æ˜¯å¯¹å•é“¾è¡¨çš„æ“ä½œä¸å¤Ÿç†Ÿç»ƒï¼Œæ¥ä¸‹æ¥ä¼šé‡ç‚¹æ”»å…‹å•é“¾è¡¨è¿™ä¸€å—çš„çŸ¥è¯†ç‚¹ï¼ ##æˆ‘çš„ä»£ç ï¼ˆACï¼‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455package ç¬¬237é¢˜_åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹;import java.util.ArrayList;import java.util.Scanner;public class deleteNode &#123; public static void main(String[] args) &#123; System.out.println("è¯·è¾“å…¥ä¸€ä¸²æ•°å­—ä»£è¡¨é“¾è¡¨ï¼š"); Scanner sc = new Scanner(System.in); String head = sc.nextLine(); char[] chars = head.toCharArray();// System.out.println(chars); ArrayList list = new ArrayList(); Node head_first = new Node(-1); Node temp = head_first; for(int i = 0 ; i &lt; chars.length ; i++)&#123; temp.next = new Node(Integer.parseInt(String.valueOf(chars[i]))); temp = temp.next; list.add(chars[i]); &#125; System.out.println("æ‚¨è¾“å…¥çš„é“¾è¡¨ä¸ºï¼š "+ list); System.out.println("è¯·æ‚¨è¾“å…¥è¦åˆ é™¤çš„æ•°å­—ï¼š"); String data = sc.nextLine(); int data_int = Integer.parseInt(data); Node temp1 = head_first; for(int i = 0 ; i &lt; chars.length ; i++)&#123; temp1 = temp1.next; if(data_int == temp1.data)&#123; deleteNode(temp1); break; &#125; &#125; System.out.println("åˆ é™¤åçš„é“¾è¡¨ä¸ºï¼š"); Node temp3 = head_first.next; for(int i = 0 ; i &lt; chars.length-1 ; i++) &#123; System.out.print(temp3.data + " "); temp3 = temp3.next; &#125; System.out.println("\n"); &#125; public static void deleteNode(Node node) &#123; Node tmp = node.next; node.data = node.next.data; node.next = node.next.next; tmp = null; &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940package ç¬¬237é¢˜_åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹;public class Node &#123; //æ•°æ®åŸŸ public Integer data; //æŒ‡é’ˆåŸŸï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ public Node next; public Node() &#123; &#125; public Node(int data) &#123; this.data = data; &#125; public Node(int data, Node next) &#123; this.data = data; this.next = next; &#125; public int getData() &#123; return data; &#125; public void setData(int Data) &#123; this.data = Data; &#125; public Node getNext() &#123; return next; &#125; public void setNext(Node Next) &#123; this.next = Next; &#125;&#125; æ­£ç¡®æ€è·¯åªæä¾› node ä¾ç„¶å¯ä»¥è§£å†³æ­¤é¢˜ã€‚åªè¦æŠŠä¸‹ä¸ªç»“ç‚¹çš„ å€¼ &amp; next èµ‹ç»™å½“å‰ nodeï¼Œç„¶ååˆ é™¤ä¸‹ä¸ªç»“ç‚¹ï¼Œå°±å¯ä»¥æå®šã€‚ æ­£ç¡®ä»£ç 12345678910111213141516171819202122/** * Definition for singly-linked list. * public class ListNode &#123; * int val; * ListNode next; * ListNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public void deleteNode(ListNode node) &#123; // ä¿å­˜ä¸‹ä¸€ä¸ªç»“ç‚¹ ListNode tmp = node.next; // å°†ä¸‹ä¸ªç»“ç‚¹çš„å€¼èµ‹ç»™å½“å‰è¦åˆ é™¤çš„ç»“ç‚¹ node.val = node.next.val; node.next = node.next.next; // tmp ç½®ä¸ºç©ºï¼Œè®© jvm è¿›è¡Œåƒåœ¾å›æ”¶ tmp = null; &#125;&#125; æ¶‰åŠçš„çŸ¥è¯†ç‚¹ é“¾è¡¨çš„æ„å»º é“¾è¡¨åˆ é™¤ ä¸è¶³å¯¹é“¾è¡¨æ“ä½œè¿˜ä¸æ˜¯å¾ˆé©¾è½»å°±ç†Ÿï¼Œæ¥ä¸‹æ¥ä¼šé‡ç‚¹è®­ç»ƒé“¾è¡¨æ“ä½œã€‚ ç¬¬19é¢˜ï¼šåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹é¢˜ç›®ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿”å›é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚ ç¤ºä¾‹123ç»™å®šä¸€ä¸ªé“¾è¡¨: 1-&gt;2-&gt;3-&gt;4-&gt;5, å’Œ n = 2.å½“åˆ é™¤äº†å€’æ•°ç¬¬äºŒä¸ªèŠ‚ç‚¹åï¼Œé“¾è¡¨å˜ä¸º 1-&gt;2-&gt;3-&gt;5. è¯´æ˜ï¼š ç»™å®šçš„ n ä¿è¯æ˜¯æœ‰æ•ˆçš„ã€‚ æˆ‘çš„æ€è·¯åˆ é™¤å€’æ•°ç¬¬nä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªæ€è·¯æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯è¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆ fast å’Œ slow ï¼Œä¸€ä¸ªæŒ‡é’ˆæ¯”å¦å¤–ä¸€ä¸ªå¤šn-1æ­¥ï¼Œè¿™æ ·çš„è¯å½“fastæŒ‡é’ˆåˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼ŒslowæŒ‡é’ˆåˆšå¥½åˆ°è¾¾è¦åˆ é™¤çš„èŠ‚ç‚¹çš„ä½ç½®ï¼Œæ­¤æ—¶å°±å¯ä»¥ç”¨ä¸Šé¢˜ç”¨è¿‡çš„æ›¿èº«ç‰ºç‰²æ³•ï¼Œç‰ºç‰²æ‰è¦åˆ é™¤èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåªéœ€è¦å°†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼èµ‹å€¼ç»™å½“å‰èŠ‚ç‚¹å¹¶ä¸”å°†slow.next = slow.next.nextå³å¯ã€‚ä½†æ˜¯ï¼Œæœ‰ç‰¹æ®Šæƒ…å†µ ï¼š å½“è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯æœ€åä¸€ä¸ªæ—¶ï¼Œæ— æ³•åšåˆ°ç”¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ›¿æ¢ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦æå‰é¢„åˆ¤ï¼Œä¸èƒ½ç­‰åˆ°slowåˆ°äº†æœ€åä¸€ä¸ªèŠ‚ç‚¹æ‰è€ƒè™‘åˆ é™¤ï¼Œè¦åœ¨slow.next.next == nullæ—¶å°±è€ƒè™‘ï¼ï¼ï¼ æˆ‘çš„ä»£ç ï¼ˆACï¼‰12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667package ç¬¬19é¢˜;//import ç¬¬237é¢˜_åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹.Node;import java.util.ArrayList;import java.util.Scanner;public class removeNthFromEnd &#123; public static void main(String[] args) &#123; System.out.println("è¯·è¾“å…¥ä¸€ä¸²æ•°å­—ä»£è¡¨é“¾è¡¨ï¼š"); Scanner sc = new Scanner(System.in); String head = sc.nextLine(); char[] chars = head.toCharArray();// System.out.println(chars); ArrayList list = new ArrayList(); ListNode head_first = new ListNode(-1); ListNode temp = head_first; for(int i = 0 ; i &lt; chars.length ; i++)&#123; temp.next = new ListNode(Integer.parseInt(String.valueOf(chars[i]))); temp = temp.next; list.add(chars[i]); &#125; System.out.println("æ‚¨è¾“å…¥çš„é“¾è¡¨ä¸ºï¼š "+ list); System.out.print("è¯·æ‚¨è¾“å…¥è¦åˆ é™¤çš„å€’æ•°ç¬¬nä¸ªæ•°çš„èŠ‚ç‚¹ï¼Œn = "); String number = sc.nextLine(); int num = Integer.parseInt(number); ListNode result_node = removeNthFromEnd(head_first.next,num); ListNode temp1 = result_node; while(temp1 != null)&#123;// int data = Integer.parseInt(String.valueOf(temp1.val)); System.out.print(temp1.val); temp1 = temp1.next; &#125; &#125; public static ListNode removeNthFromEnd(ListNode head, int n) &#123; ListNode pre = new ListNode(-1); pre.next = head; ListNode fast = pre; ListNode slow = pre; // å¿«æŒ‡é’ˆå…ˆèµ° n-1 æ­¥ for (int i = 0; i &lt; n-1; ++i) &#123; fast = fast.next; &#125; while (fast.next != null &amp;&amp; slow.next.next != null) &#123; fast = fast.next; slow = slow.next; &#125;// ListNode tmp = slow.next; if(slow.next.next == null &amp;&amp; (n == 1)) &#123; slow.next = null; &#125; else &#123; slow.val = slow.next.val; slow.next = slow.next.next;// tmp = null; &#125; return pre.next; &#125;&#125; 12345678910package ç¬¬19é¢˜;public class ListNode &#123; int val; ListNode next; ListNode(int x) &#123; val = x; &#125; &#125; æ­£ç¡®æ€è·¯å¿«æŒ‡é’ˆ fast å…ˆèµ° n æ­¥ï¼Œæ¥ç€å¿«æŒ‡é’ˆ fast ä¸æ…¢æŒ‡é’ˆ slow åŒæ—¶å‰è¿›ï¼Œç­‰åˆ°å¿«æŒ‡é’ˆæŒ‡å‘é“¾è¡¨æœ€åä¸€ä¸ªç»“ç‚¹æ—¶ï¼Œåœæ­¢å‰è¿›ã€‚ç„¶åå°† slow çš„ next æŒ‡å‘ slow.next.nextï¼Œå³åˆ é™¤äº†ç¬¬ n ä¸ªç»“ç‚¹ã€‚æœ€åè¿”å›å¤´æŒ‡é’ˆã€‚ è¿™é‡Œè®¾ç½®äº† pre è™šæ‹Ÿç»“ç‚¹(æŒ‡å‘ head )æ˜¯ä¸ºäº†æ–¹ä¾¿å¤„ç†åªæœ‰ä¸€ä¸ªç»“ç‚¹çš„æƒ…å†µã€‚ æ­£ç¡®ä»£ç 12345678910111213141516171819202122232425262728/** * Definition for singly-linked list. * public class ListNode &#123; * int val; * ListNode next; * ListNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public ListNode removeNthFromEnd(ListNode head, int n) &#123; ListNode pre = new ListNode(-1); pre.next = head; ListNode fast = pre; ListNode slow = pre; // å¿«æŒ‡é’ˆå…ˆèµ° n æ­¥ for (int i = 0; i &lt; n; ++i) &#123; fast = fast.next; &#125; while (fast.next != null) &#123; fast = fast.next; slow = slow.next; &#125; slow.next = slow.next.next; return pre.next; &#125;&#125; æ¶‰åŠçš„çŸ¥è¯†ç‚¹å•é“¾è¡¨çš„åˆ é™¤â€¦æ¯”è¾ƒç®€å•å•¦ ä¸è¶³ä¸ªäººæ„Ÿè§‰å…¶å®ç­”æ¡ˆçš„è§£æ³•è¿˜æ˜¯è¦æ¯”æˆ‘çš„å¥½ä¸€äº›ï¼Œå®ƒæ˜¯é€šè¿‡ç›´æ¥æ‰¾åˆ°åˆ é™¤èŠ‚ç‚¹çš„å‰ä¸€ä¸ªï¼Œè¿™æ ·å°±éå¸¸å¥½å¤„ç†äº†ï¼Œè€Œä¸”è¿˜æ²¡æœ‰ç‰¹æ®Šæƒ…å†µâ€¦æˆ‘å°±å¾ˆç¬¨äº†ï¼Œè¿˜è‡ªä»¥ä¸ºæ˜¯çš„ç”¨äº†ä¸€ä¸ªæ›¿èº«æ”»å‡»çš„æ–¹æ³•â€¦å­¦åˆ°äº†ï¼ï¼ï¼è¦è®°å¾—ç”¨åˆ°åˆ é™¤èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ‰æ˜¯å•é“¾è¡¨çš„å…³é”®ã€‚ ç¬¬21é¢˜ï¼šåˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨é¢˜ç›®å°†ä¸¤ä¸ªæœ‰åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„æœ‰åºé“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚ ç¤ºä¾‹12è¾“å…¥ï¼š1-&gt;2-&gt;4, 1-&gt;3-&gt;4è¾“å‡ºï¼š1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4 æˆ‘çš„æ€è·¯åˆ›å»ºä¸€ä¸ªæ–°é“¾è¡¨ï¼Œç„¶åæ¯”è¾ƒä¸¤ä¸ªé“¾è¡¨ï¼Œå“ªä¸ªå°å°±è®©æ–°é“¾è¡¨çš„nextæŒ‡å‘ä»–ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæå‰ç»“æŸäº†ï¼Œå‰©ä¸‹çš„é“¾è¡¨æ¥ä¸Šæ–°é“¾è¡¨çš„ååŠéƒ¨åˆ†ã€‚ æˆ‘çš„ä»£ç ï¼ˆACï¼‰123456789101112131415161718192021public static ListNode merge(ListNode l1, ListNode l2)&#123; ListNode prehead = new ListNode(-1); ListNode prev = prehead; while (l1 != null &amp;&amp; l2 != null) &#123; if (l1.val &lt;= l2.val) &#123; prev.next = l1; l1 = l1.next; &#125; else &#123; prev.next = l2; l2 = l2.next; &#125; prev = prev.next; &#125; // exactly one of l1 and l2 can be non-null at this point, so connect // the non-null list to the end of the merged list. prev.next = l1 == null ? l2 : l1; return prehead.next; &#125; 1234567package ç¬¬21é¢˜;public class ListNode &#123; int val; ListNode next; ListNode(int x) &#123; val = x; &#125;&#125; æ­£ç¡®æ€è·¯åˆ©ç”¨é“¾è¡¨å¤©ç„¶çš„é€’å½’æ€§ã€‚å¦‚æœ l1 ä¸ºç©ºï¼Œè¿”å› l2ï¼›å¦‚æœ l2 ä¸ºç©ºï¼Œè¿”å› l1ã€‚å¦‚æœ l1.val &lt; l2.valï¼Œè¿”å› l1-&gt;mergeTwoLists(l1.next, l2)ï¼›å¦åˆ™è¿”å› l2-&gt;mergeTwoLists(l1, l2.next)ã€‚ æ­£ç¡®ä»£ç 123456789101112131415161718192021222324/** * Definition for singly-linked list. * public class ListNode &#123; * int val; * ListNode next; * ListNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public ListNode mergeTwoLists(ListNode l1, ListNode l2) &#123; if (l1 == null) &#123; return l2; &#125; if (l2 == null) &#123; return l1; &#125; if (l1.val &lt; l2.val) &#123; l1.next = mergeTwoLists(l1.next, l2); return l1; &#125; l2.next = mergeTwoLists(l1, l2.next); return l2; &#125;&#125; æ¶‰åŠçš„çŸ¥è¯†ç‚¹é“¾è¡¨ç®—æ³•é¢˜é¢è¯•å¿…çœ‹å¿…çœ‹å¿…çœ‹ï¼ï¼ï¼ï¼ï¼ï¼ï¼ ç¬¬23é¢˜ï¼šåˆå¹¶Kä¸ªæ’åºé“¾è¡¨é¢˜ç›®åˆå¹¶ k ä¸ªæ’åºé“¾è¡¨ï¼Œè¿”å›åˆå¹¶åçš„æ’åºé“¾è¡¨ã€‚è¯·åˆ†æå’Œæè¿°ç®—æ³•çš„å¤æ‚åº¦ã€‚ ç¤ºä¾‹1234567è¾“å…¥:[ 1-&gt;4-&gt;5, 1-&gt;3-&gt;4, 2-&gt;6]è¾“å‡º: 1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4-&gt;5-&gt;6 æˆ‘çš„æ€è·¯æˆ‘æ²¡åšå‡ºæ¥ï¼Œç„¶åçœ‹äº†ä¸‹è®¨è®ºåŒºï¼Œå¤§æ¦‚æ€»ç»“å‡ºä¸‰ç§æ€è·¯ï¼š è¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå°†æ•´ä¸ªé“¾è¡¨æ‰”åˆ°ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ï¼Œç„¶åä¸€ä¸ªä¸ªå–å‡ºæ¥å°±å¯ä»¥äº†ï¼Œè¿™ç§æ€è·¯ä»£ç å®ç°æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯ç”¨äº†äººå®¶å°è£…å¥½çš„ä¸œè¥¿ï¼Œæ€»æ„Ÿè§‰æœ‰ç‚¹æŠ•æœºå–å·§çš„æ„Ÿè§‰â€¦ è¿ç”¨åˆ†æ²»å½’å¹¶çš„æ€æƒ³ï¼ŒKä¸ªé“¾è¡¨ä¸¤ä¸¤è¿›è¡Œå½’å¹¶ã€‚ å¼ºè¡Œå½’å¹¶ï¼Œä¸¤ä¸ªå½’å¹¶å®Œç›´æ¥æ”¾åˆ°åè€…ï¼Œç„¶ååè€…å†è·Ÿåé¢çš„æ’åºï¼Œè¿™æ ·å¤æ‚åº¦å¾ˆé«˜ã€‚ æˆ‘çš„ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * Definition for singly-linked list. * public class ListNode &#123; * int val; * ListNode next; * ListNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public ListNode mergeKLists(ListNode[] lists) &#123; if (lists == null || lists.length == 0) &#123; return null; &#125; int len = lists.length; if (len == 1) &#123; return lists[0]; &#125; // åˆå¹¶å‰åä¸¤ä¸ªé“¾è¡¨ï¼Œç»“æœæ”¾åœ¨åä¸€ä¸ªé“¾è¡¨ä½ç½®ä¸Šï¼Œä¾æ¬¡å¾ªç¯ä¸‹å» for (int i = 0; i &lt; len - 1; ++i) &#123; lists[i + 1] = mergeTwoLists(lists[i], lists[i + 1]); &#125; return lists[len - 1]; &#125; /** * åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ * @param l1 * @param l2 * @return listNode */ private ListNode mergeTwoLists(ListNode l1, ListNode l2) &#123; if (l1 == null) &#123; return l2; &#125; if (l2 == null) &#123; return l1; &#125; if (l1.val &lt; l2.val) &#123; l1.next = mergeTwoLists(l1.next, l2); return l1; &#125; l2.next = mergeTwoLists(l1, l2.next); return l2; &#125;&#125; æ­£ç¡®æ€è·¯ ç¬¬ä¸€ç§ï¼Œä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œ20ms, å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼š O(Nlogk) ï¼Œå…¶ä¸­ k æ˜¯é“¾è¡¨çš„æ•°ç›®ã€‚å¼¹å‡ºæ“ä½œæ—¶ï¼Œæ¯”è¾ƒæ“ä½œçš„ä»£ä»·ä¼šè¢«ä¼˜åŒ–åˆ° O(logk) ã€‚åŒæ—¶ï¼Œæ‰¾åˆ°æœ€å°å€¼èŠ‚ç‚¹çš„æ—¶é—´å¼€é”€ä»…ä»…ä¸º O(1)ã€‚æœ€åçš„é“¾è¡¨ä¸­æ€»å…±æœ‰ N ä¸ªèŠ‚ç‚¹ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šO(n) ã€‚åˆ›é€ ä¸€ä¸ªæ–°çš„é“¾è¡¨éœ€è¦ O(n) çš„å¼€é”€ã€‚O(k) ã€‚ä»¥ä¸Šä»£ç é‡‡ç”¨äº†é‡å¤åˆ©ç”¨åŸæœ‰èŠ‚ç‚¹ï¼Œæ‰€ä»¥åªè¦ O(1) çš„ç©ºé—´ã€‚åŒæ—¶ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆé€šå¸¸ç”¨å †å®ç°ï¼‰éœ€è¦ O(k) çš„ç©ºé—´ï¼ˆè¿œæ¯”å¤§å¤šæ•°æƒ…å†µçš„ Nè¦å°ï¼‰ã€‚ è¿‡ç¨‹ï¼š 1.å› ä¸ºé“¾è¡¨æœ‰åºï¼Œæ‰€ä»¥ç”¨æ¯ä¸ªé“¾è¡¨çš„é¦–å…ƒç´ æ„å»ºåˆè¯•å †(å°é¡¶å †) â€“ çš„é˜Ÿåˆ— 2.é¦–å…ƒç´ å‡ºé˜Ÿï¼Œè¯¥å…ƒç´ nextæŒ‡å‘å…ƒç´ å…¥é˜Ÿ ç¬¬äºŒç§ï¼Œå½’å¹¶åˆ†æ²»ï¼Œå…¸å‹çš„å½’å¹¶åˆ†æ²»æ€æƒ³ï¼Œè‡ªåº•å‘ä¸Šï¼Œä¾æ¬¡åˆå¹¶(å¯ç»“åˆå½’å¹¶æ’åºç†è§£ï¼Œå°†æ¯ä¸ªé“¾è¡¨ç†è§£æˆæ’åºçš„å€¼)ã€‚ å¤æ‚åº¦åˆ†æ æ—¶é—´å¤æ‚åº¦ï¼š O(Nlogk) ï¼Œå…¶ä¸­ k æ˜¯é“¾è¡¨çš„æ•°ç›®ã€‚ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ O(1) çš„ç©ºé—´å®ç°ä¸¤ä¸ªæœ‰åºé“¾è¡¨çš„åˆå¹¶ã€‚ ç¬¬ä¸‰ç§ï¼Œå¼ºè¡Œåšã€‚è§æˆ‘çš„ä»£ç ï¼Œ170ms ç”¨ç¬¬ä¸€ä¸ªé“¾ä¾æ¬¡å’Œåé¢çš„æ‰€æœ‰é“¾è¿›è¡ŒåŒé“¾åˆå¹¶ï¼Œåˆ©ç”¨021çš„åŒé¡ºåºé“¾åˆå¹¶ï¼Œç§’æ€ï¼ä½†æ˜¯æ•ˆç‡æä½ï¼Œ æ—¶é—´å¤æ‚åº¦æ˜¯O(x(a+b) + (x-1)(a+b+c) + â€¦ + 1 * (a+b+â€¦+z);[a-z]æ˜¯å„é“¾è¡¨é•¿åº¦ï¼Œxè¡¨ç¤ºé“¾è¡¨ä¸ªæ•°-1ï¼Œå¯è§æ—¶é—´å¤æ‚åº¦æ˜¯æå¤§çš„ã€‚ æ­£ç¡®ä»£ç  ä¼˜å…ˆçº§é˜Ÿåˆ— 12345678910111213141516171819202122public ListNode mergeKLists(ListNode[] lists) &#123; int len = 0; if((len=lists.length)==0 || lists == null) return null; ListNode preHead = new ListNode(-1); ListNode preNode = preHead; PriorityQueue&lt;ListNode&gt; queue = new PriorityQueue&lt;&gt;(len, new Comparator&lt;ListNode&gt;() &#123; @Override public int compare(ListNode o1, ListNode o2) &#123; return o1.val - o2.val; &#125; &#125;); for (ListNode node : lists) &#123; if(node!=null) queue.add(node); &#125; while(!queue.isEmpty())&#123; ListNode small = queue.poll(); preNode.next = small; if(small.next!=null) queue.add(small.next); //å°†æœ€å°å€¼èŠ‚ç‚¹åé¢çš„èŠ‚ç‚¹æ·»åŠ åˆ°é˜Ÿé‡Œä¸­ preNode = preNode.next; &#125; return preHead.next; &#125; å½’å¹¶åˆ†æ²» 1234567891011121314151617181920212223242526272829303132333435363738394041/* * @lc app=leetcode.cn id=23 lang=java * * [23] åˆå¹¶Kä¸ªæ’åºé“¾è¡¨ */// @lc code=start/** * Definition for singly-linked list. * public class ListNode &#123; * int val; * ListNode next; * ListNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public ListNode mergeKLists(ListNode[] lists) &#123; if (lists == null || lists.length == 0) return null; return merge(lists, 0, lists.length - 1); &#125; private ListNode merge(ListNode[] lists, int left, int right) &#123; if (left == right) return lists[left]; int mid = left + (right - left) / 2; ListNode l1 = merge(lists, left, mid); ListNode l2 = merge(lists, mid + 1, right); return mergeTwoLists(l1, l2); &#125; private ListNode mergeTwoLists(ListNode l1, ListNode l2) &#123; if (l1 == null) return l2; if (l2 == null) return l1; if (l1.val &lt; l2.val) &#123; l1.next = mergeTwoLists(l1.next, l2); return l1; &#125; else &#123; l2.next = mergeTwoLists(l1,l2.next); return l2; &#125; &#125; &#125; æ¶‰åŠçš„çŸ¥è¯†ç‚¹åŒ…æ‹¬äº†ä¼˜å…ˆçº§é˜Ÿåˆ—ã€æœ€å°å †ã€å½’å¹¶ä»¥åŠ åˆ†æ²»çš„æ€æƒ³ ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚javaä¸­çš„ä¼˜å…ˆçº§é˜Ÿåˆ—æ˜¯PriorityQueueï¼Œæ˜¯é€šè¿‡æœ€å°å †å®ç°çš„ æœ€å°å † å½’å¹¶ åˆ†æ²» ç¬¬5é¢˜ æœ€é•¿å›æ–‡å­ä¸²é¢˜ç›®ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ° s ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚ä½ å¯ä»¥å‡è®¾ s çš„æœ€å¤§é•¿åº¦ä¸º 1000ã€‚ ç¤ºä¾‹ç¤ºä¾‹ 1ï¼š 123è¾“å…¥: "babad"è¾“å‡º: "bab"æ³¨æ„: "aba" ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆç­”æ¡ˆã€‚ ç¤ºä¾‹ 2ï¼š 12è¾“å…¥: "cbbd"è¾“å‡º: "bb" æˆ‘çš„æ€è·¯ æœ€å¼€å§‹çš„æƒ³æ³•æ˜¯å°†æºå­—ç¬¦ä¸²ç¿»è½¬ï¼Œç„¶ååˆ¤æ–­ç¿»è½¬åçš„å­—ç¬¦ä¸²å’Œæºå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—ï¼Œä½†æ˜¯è²Œä¼¼æœ‰ç‚¹é—®é¢˜ï¼Œä¾‹å¦‚accbbdccaç¿»è½¬åå˜ä¸ºaccdbbcca,æœ€é•¿å…¬å…±å­åºåˆ—ä¸ºaccï¼Œä½†æ˜¯æœ€é•¿å›æ–‡å­ä¸²ä¸ºbbã€‚ ä½†æ˜¯ä¸Šé¢çš„æ€è·¯æœ‰å¯å–ä¹‹å¤„ï¼Œå…¶å®é‡åˆ°å›æ–‡å­ä¸²æœ€æ ¸å¿ƒçš„é—®é¢˜æ˜¯ä»ä¸­é—´å¼€å§‹ä¾æ¬¡æ¯”è¾ƒå·¦å³æ˜¯å¦ç›¸ç­‰ï¼Œç›´åˆ°ä¸ç›¸ç­‰ï¼Œè¿”å›å·¦å³ç›¸ç­‰çš„å­ä¸²ï¼Œå½“ç„¶è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¯¥å›æ–‡å­ä¸²å¯èƒ½æ˜¯å•æ•°ï¼Œä¹Ÿå¯èƒ½æ˜¯åŒæ•°ï¼Œå•æ•°çš„è¯ï¼Œç›´æ¥æ¯”è¾ƒè¯¥æ•°çš„å·¦å³å³å¯ï¼ŒåŒæ•°åˆ™éœ€è¦å…ˆåˆ¤æ–­æœ€å¼€å§‹ä¸¤æ•°æ˜¯å¦ç›¸ç­‰ã€‚ æ—¶é—´å¤æ‚åº¦æ˜¯O(nÂ²)ï¼Œç©ºé—´å¤æ‚åº¦O(1) æˆ‘çš„ä»£ç ï¼ˆACï¼‰ç¾å…¶åæ›° ä¸­å¿ƒæ‰©å±•ç®—æ³• 12345678910111213141516171819202122232425262728package Dynamic_Programming.æœ€é•¿å›æ–‡å­ä¸²;public class Solution &#123; public static String longestPalindrome(String s) &#123; String res = ""; for(int i = 0;i &lt; s.length(); i++)&#123; String single = palindrome(s,i,i); String dou = palindrome(s,i,i+1); res = res.length() &gt; single.length() ? res : single; res = res.length() &gt; dou.length() ? res : dou; &#125; return res; &#125; private static String palindrome(String s, int left, int right) &#123; char[] s1 = s.toCharArray(); while(left &gt;= 0 &amp;&amp; right &lt; s.length() &amp;&amp; s1[left] == s1[right])&#123; left--; right++; &#125; return s.substring(left + 1,right); &#125; public static void main(String[] args) &#123; String res = longestPalindrome("aaabaacc"); System.out.println(res); &#125;&#125; æ­£ç¡®æ€è·¯å’Œä»£ç dp12345678910111213141516171819202122232425 private static String dp(String s)&#123; //æ¯æ¬¡éƒ½å¿˜è®°äº†è¾¹ç•Œå¤„ç† if(s == null || s.length() &lt; 1)&#123; return ""; &#125; char[] s1 = s.toCharArray(); int len = s1.length; int max = 1;// int over = 1; int start = 0; boolean res[][] = new boolean[len][len]; //æ­¤æ—¶çš„jæ˜¯æœ€å³è¾¹çš„æ•° //æ­¤æ—¶çš„iæ˜¯æœ€å·¦è¾¹çš„æ•° for(int j = 0; j &lt; s1.length; j++)&#123; for(int i = 0; i &lt;= j ;i++ )&#123; res[i][j] = (j &lt;= i + 2) ? s1[i] == s1[j] : res[i+1][j-1] &amp;&amp; s1[i] == s1[j]; if(res[i][j] &amp;&amp; max &lt; j - i + 1)&#123; max = j - i + 1; start = i; &#125; &#125; &#125; return s.substring(start,start + max); &#125; å…³é”®å°±æ˜¯æš´åŠ›æ³•ï¼š res[i][j] = (j &lt;= i + 2) ? s1[i] == s1[j] : res[i+1][j-1] &amp;&amp; s1[i] == s1[j]; ä¸Šé¢å°±æ˜¯dpæœ€ä¸ºå…³é”®çš„çŠ¶æ€è½¬ç§»é€’æ¨å¼ï¼Œä¸ºä»€ä¹ˆåœ¨dpä¸­ä¸ç”¨è€ƒè™‘å›æ–‡ä¸²é•¿åº¦çš„å¥‡å¶å‘¢ï¼Œå› ä¸ºæˆ‘çš„æ–¹æ³•ä¸­æ˜¯ä»ä¸­é—´æ‰©æ•£ï¼Œé‚£ä¹ˆå°±å¿…ç„¶éœ€è¦åˆ†ç±»ï¼Œè€Œdpæ˜¯ä»ä¸¤è¾¹å‘ä¸­é—´é ï¼Œè¦æ˜¯å›æ–‡ä¸²é¦–å°¾å¿…é¡»ç›¸åŒï¼Œè€Œå½“å›æ–‡ä¸²å°äºç­‰äº3æ—¶ï¼Œåªè¦æ¯”è¾ƒçš„é¦–å°¾ç›¸ç­‰ï¼Œåˆ™æ— éœ€å†æ¯”è¾ƒï¼Œè¿™æ ·å›æ–‡ä¸²çš„å¥‡å¶å°±ä¸éœ€è¦å†è€ƒè™‘äº†ã€‚ ç»†ç»†æƒ³æ¥ï¼Œå…¶å®dpå°±æ˜¯ä¸­å¿ƒæ‰©å±•æ–¹æ³•çš„é€†ï¼Œä¸€ä¸ªæ˜¯ä»ä¸­é—´å‘ä¸¤è¾¹å‘æ•£ï¼Œä¸€ä¸ªæ˜¯ä¸¤è¾¹å‘ä¸­é—´é æ‹¢ï¼ï¼ Tipsï¼š æ³¨æ„è¾¹ç•Œå¤„ç†ï¼Œå› ä¸º str.substring è¿™ä¸ªæ˜¯ä¸å…è®¸å­—ç¬¦ä¸²ä¸º null çš„ æ—¶é—´å¤æ‚åº¦ä¸ºO(nÂ²)ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(nÂ²) æ³¨æ„äºŒç»´æ•°ç»„çš„ç»´åº¦åˆ†åˆ«æ˜¯ä»£è¡¨é¦–å’Œå°¾ï¼Œå­ä¸²æ˜¯å¦ä¸ºå›æ–‡ä¸²å–å†³äºå­å­ä¸²å’Œé¦–å°¾æ˜¯å¦ç›¸ç­‰ï¼Œè¦æ³¨æ„base caseæ˜¯å­ä¸²ä¸º1ä¸ªå­—ç¬¦æ—¶ï¼Œå®ƒå¿…ä¸ºå›æ–‡å­ä¸² æœ€æ ¸å¿ƒçš„å°±æ˜¯çŠ¶æ€è½¬ç§»çš„æ¡ä»¶ï¼Œæ˜¯åˆ†ä¸ºä¸¤ç§å°æƒ…å†µï¼Œä¸€ç§æ˜¯å½“æºå­—ç¬¦ä¸²é•¿åº¦&lt;=3æ—¶ å½“æºå­—ç¬¦ä¸²å…ƒç´ ä¸ªæ•°ä¸º3ä¸ªï¼Œè‹¥å·¦å³è¾¹ç•Œç›¸ç­‰ï¼Œåˆ™å»æ‰ä»–ä»¬ï¼Œåªå‰©ä¸€ä¸ªå­—ç¬¦ï¼Œå¿…ä¸ºå›æ–‡ä¸² å½“æºå­—ç¬¦ä¸²å…ƒç´ ä¸ªæ•°ä¸º2ä¸ªï¼Œè‹¥å·¦å³è¾¹ç•Œç›¸ç­‰ï¼Œåˆ™å¿…ä¸ºå›æ–‡ä¸² æ­¤æ—¶è¯¥ä¸²æ˜¯å¦ä¸ºå›æ–‡ä¸²å°±å–å†³äºé¦–å°¾ï¼Œå¦ä¸€ç§æƒ…å†µæ˜¯å½“æºå­—ç¬¦ä¸²é•¿åº¦&gt;3æ—¶ï¼Œåˆ™éœ€è¦åˆ¤æ–­é¦–å°¾æ˜¯å¦ç›¸ç­‰å¹¶ä¸”å»é™¤é¦–å°¾åçš„å­ä¸²æ˜¯å¦ä¸ºå›æ–‡ä¸² å½“å‘ç°æœ‰å›æ–‡ä¸²æ—¶ï¼Œåˆ™åˆ¤æ–­ä¸€ä¸‹é•¿åº¦æ˜¯å¦æ¯”ä¹‹å‰å‘ç°çš„é•¿ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è®°å½•é•¿åº¦ï¼Œå¹¶ä¸”å°†æœ€é•¿å›æ–‡ä¸²çš„èµ·å§‹ä½ç½®æ‹¿åˆ°ï¼Œæœ€åå…¨éƒ¨å¾ªç¯å®Œä¸€éåæˆªå–æœ€é•¿å›æ–‡ä¸²å³å¯ éƒ¨åˆ†çŸ¥è¯†ç‚¹è¡¥å……æš‚æ—  ç¼–è¾‘è·ç¦»(72)é¢˜ç›®æè¿°ç»™ä½ ä¸¤ä¸ªå•è¯ word1 å’Œ word2ï¼Œè¯·ä½ è®¡ç®—å‡ºå°† word1 è½¬æ¢æˆ word2 æ‰€ä½¿ç”¨çš„æœ€å°‘æ“ä½œæ•° ã€‚ ä½ å¯ä»¥å¯¹ä¸€ä¸ªå•è¯è¿›è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š æ’å…¥ä¸€ä¸ªå­—ç¬¦ åˆ é™¤ä¸€ä¸ªå­—ç¬¦ æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ ç¤ºä¾‹ 1ï¼š 123456è¾“å…¥ï¼šword1 = "horse", word2 = "ros"è¾“å‡ºï¼š3è§£é‡Šï¼šhorse -&gt; rorse (å°† 'h' æ›¿æ¢ä¸º 'r')rorse -&gt; rose (åˆ é™¤ 'r')rose -&gt; ros (åˆ é™¤ 'e') ç¤ºä¾‹ 2ï¼š 12345678è¾“å…¥ï¼šword1 = &quot;intention&quot;, word2 = &quot;execution&quot;è¾“å‡ºï¼š5è§£é‡Šï¼šintention -&gt; inention (åˆ é™¤ &apos;t&apos;)inention -&gt; enention (å°† &apos;i&apos; æ›¿æ¢ä¸º &apos;e&apos;)enention -&gt; exention (å°† &apos;n&apos; æ›¿æ¢ä¸º &apos;x&apos;)exention -&gt; exection (å°† &apos;n&apos; æ›¿æ¢ä¸º &apos;c&apos;)exection -&gt; execution (æ’å…¥ &apos;u&apos;) ä»£ç 12345678910111213141516171819202122232425class Solution &#123; public int minDistance(String s1, String s2) &#123; int[][] dp = new int[s1.length()+1][s2.length()+1]; for(int i = 0;i&lt;= s1.length();i++)&#123; dp[i][0] = i; &#125; for(int j = 0;j&lt;=s2.length();j++)&#123; dp[0][j] = j; &#125; for(int i = 1;i&lt;= s1.length();i++)&#123; for(int j = 1;j &lt;= s2.length();j++)&#123; if(s1.charAt(i-1) == s2.charAt(j-1))&#123; dp[i][j] = dp[i-1][j-1]; &#125; else&#123; dp[i][j] = Math.min(dp[i-1][j-1] + 1,dp[i-1][j] + 1); dp[i][j] = Math.min(dp[i][j],dp[i][j-1] + 1); &#125; &#125; &#125; return dp[s1.length()][s2.length()]; &#125;&#125; ä¼šè®®å®¤ II(253)é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªä¼šè®®æ—¶é—´å®‰æ’çš„æ•°ç»„ï¼Œæ¯ä¸ªä¼šè®®æ—¶é—´éƒ½ä¼šåŒ…æ‹¬å¼€å§‹å’Œç»“æŸçš„æ—¶é—´ [[s1,e1],[s2,e2],â€¦] (si &lt; ei)ï¼Œä¸ºé¿å…ä¼šè®®å†²çªï¼ŒåŒæ—¶è¦è€ƒè™‘å……åˆ†åˆ©ç”¨ä¼šè®®å®¤èµ„æºï¼Œè¯·ä½ è®¡ç®—è‡³å°‘éœ€è¦å¤šå°‘é—´ä¼šè®®å®¤ï¼Œæ‰èƒ½æ»¡è¶³è¿™äº›ä¼šè®®å®‰æ’ã€‚ ç¤ºä¾‹ 1: 12è¾“å…¥: [[0, 30],[5, 10],[15, 20]]è¾“å‡º: 2 ç¤ºä¾‹ 2: 12è¾“å…¥: [[7,10],[2,4]]è¾“å‡º: 1 ä»£ç 12345678910111213141516171819class Solution &#123; public int minMeetingRooms(int[][] inter) &#123; if(inter == null || inter.length == 0) return 0; PriorityQueue&lt;Integer&gt; queue = new PriorityQueue&lt;&gt;(); Arrays.sort(inter, Comparator.comparingInt(a -&gt; a[0])); queue.add(inter[0][1]); for(int i = 1;i != inter.length;i++)&#123; int last = queue.peek(); if(last &lt;= inter[i][0])&#123; queue.poll(); queue.add(inter[i][1]); &#125; else &#123; queue.add(inter[i][1]); &#125; &#125; return queue.size(); &#125;&#125; ç¬¬96é¢˜ ä¸åŒçš„äºŒå‰æœç´¢æ ‘é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œæ±‚ä»¥ 1 ... n ä¸ºèŠ‚ç‚¹ç»„æˆçš„äºŒå‰æœç´¢æ ‘æœ‰å¤šå°‘ç§ï¼Ÿ ç¤ºä¾‹: 12345678910è¾“å…¥: 3è¾“å‡º: 5è§£é‡Š:ç»™å®š n = 3, ä¸€å…±æœ‰ 5 ç§ä¸åŒç»“æ„çš„äºŒå‰æœç´¢æ ‘: 1 3 3 2 1 \ / / / \ \ 3 2 1 1 3 2 / / \ \ 2 1 2 3 è§£æ³•åŸé—®é¢˜å¯æ‹†è§£ä¸ºå­é—®é¢˜çš„æ±‚è§£ã€‚ äºŒå‰æœç´¢æ ‘ï¼Œå¯ä»¥åˆ†åˆ«ä»¥ 1/2/3..n åšä¸ºæ ¹èŠ‚ç‚¹ã€‚æ‰€æœ‰æƒ…å†µç´¯åŠ èµ·æ¥ï¼Œä¹Ÿå°±å¾—åˆ°äº†æœ€ç»ˆç»“æœã€‚ res[n] è¡¨ç¤ºæ•´æ•°nç»„æˆçš„äºŒå‰æœç´¢æ ‘ä¸ªæ•°ã€‚å®ƒçš„å·¦å­æ ‘å¯ä»¥æœ‰0/1/2...n-1 ä¸ªèŠ‚ç‚¹ï¼Œå³å­æ ‘å¯ä»¥æœ‰n-1/n-2...0 ä¸ªèŠ‚ç‚¹ã€‚res[n] æ˜¯æ‰€æœ‰è¿™äº›æƒ…å†µçš„åŠ å’Œã€‚ æ—¶é—´å¤æ‚åº¦åˆ†æï¼šçŠ¶æ€æ€»å…±æœ‰ n ä¸ªï¼ŒçŠ¶æ€è½¬ç§»çš„å¤æ‚åº¦æ˜¯ O(n)ï¼Œæ‰€ä»¥æ€»æ—¶é—´å¤æ‚åº¦æ˜¯ O(nÂ²)ã€‚ æ™®é€šçš„dp 123456789101112class Solution &#123; public int numTrees(int n) &#123; int[] dp = new int[n+1]; dp[0] = 1; for(int i=1;i&lt;=n;i++)&#123; for(int j =1;j&lt;=i;j++)&#123; dp[i] += dp[j-1] * dp[i-j]; &#125; &#125; return dp[n]; &#125;&#125; ä¸Šé¢çš„è§£æ³•æ˜æ˜¾è¿˜å¯ä»¥å¾—åˆ°æ”¹è¿›ï¼Œå› ä¸ºå·¦-å³å­æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ä¸º0,n-1,å’Œå·¦å³å­æ ‘èŠ‚ç‚¹ä¸ªæ•°ä¸ºn-1,0ã€‚è¿™ä¸¤è€…çš„äºŒå‰æœç´¢æ ‘çš„ç»“æœè‚¯å®šæ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ²¡æœ‰å¿…è¦ç®—ä¸¤éã€‚ä½†æ˜¯åŒæ—¶è¦è€ƒè™‘åˆ°å¥‡å¶çš„é—®é¢˜ã€‚ å¦‚æœn=4ï¼Œé‚£ä¹ˆG(4) = G(0) G(3) + G(1) G(2) + G(2) G(1) + G(3) G(0) = 2[G(0) G(3) + G(1) G(2)] å¦‚æœn=5ï¼Œé‚£ä¹ˆG(5) = G(0) G(4) + G(1) G(3) + G(2) G(2) + G(3) G(1) + G(4) G(0) = 2[G(0) G(4) + G(1) G(3) ] + G(2) G(2) 12345678910111213141516171819202122232425262728class Solution &#123; public int numsTrees2(int n)&#123; if (n == 0) &#123; return 0; &#125; int[] dp = new int[n + 1]; dp[0] = 1; dp[1] = 1; // é•¿åº¦ä¸º 1 åˆ° n for (int i = 2; i &lt;= n; i++) &#123; // å°†ä¸åŒçš„æ•°å­—ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œåªéœ€è¦è€ƒè™‘åˆ° len for (int root = 1; root &lt;= i / 2; root++) &#123; int left = root - 1; // å·¦å­æ ‘çš„é•¿åº¦ int right = i - root; // å³å­æ ‘çš„é•¿åº¦ dp[i] += dp[left] * dp[right]; &#125; dp[i] *= 2;// åˆ©ç”¨å¯¹ç§°æ€§ä¹˜ 2 // è€ƒè™‘å¥‡æ•°çš„æƒ…å†µ if ((i &amp; 1) == 1) &#123; int root = (i &gt;&gt; 1) + 1; int left = root - 1; // å·¦å­æ ‘çš„é•¿åº¦ int right = i - root; // å³å­æ ‘çš„é•¿åº¦ dp[i] += dp[left] * dp[right]; &#125; &#125; return dp[n]; &#125;&#125; çŸ¥è¯†ç‚¹è¡¥å…… LeetCodeäºŒå‰æ ‘ä¸“é¢˜â€”â€”&gt;DFSå’ŒBFS ç¬¬95é¢˜ ä¸åŒçš„äºŒå‰æœç´¢æ ‘IIé¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œç”Ÿæˆæ‰€æœ‰ç”± 1 â€¦ n ä¸ºèŠ‚ç‚¹æ‰€ç»„æˆçš„äºŒå‰æœç´¢æ ‘ã€‚ ç¤ºä¾‹123456789è¾“å…¥: 3è¾“å‡º:[ [1,null,3,2], [3,2,null,1], [3,1,null,null,2], [2,1,3], [1,null,2,null,3]] è§£é‡Š1234567ä»¥ä¸Šçš„è¾“å‡ºå¯¹åº”ä»¥ä¸‹ 5 ç§ä¸åŒç»“æ„çš„äºŒå‰æœç´¢æ ‘ï¼š 1 3 3 2 1 \ / / / \ \ 3 2 1 1 3 2 / / \ \ 2 1 2 3 è§£æ³•è¿™é¢˜å°±æ˜¯å…¸å‹çš„è¿ç”¨é€’å½’å»åšï¼Œæ˜ç¡®ä¸‰ä¸ªç‚¹ï¼š é€’å½’å‡ºå£ é€’å½’è¿”å›å€¼ ä¸€çº§é€’å½’éœ€è¦åšä»€ä¹ˆ é€’å½’å‡ºå£å½“æ ‘æ²¡æœ‰èŠ‚ç‚¹äº†ï¼Œé€’å½’ç»“æŸï¼Œæ€ä¹ˆè¡¨ç¤ºæ ‘æ²¡æœ‰èŠ‚ç‚¹å‘¢ï¼Œæ‰€ä»¥å°±éœ€æ–°å»ºä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°åŒ…æ‹¬èŠ‚ç‚¹çš„èµ·å§‹å’Œç»ˆæ­¢ã€‚ é€’å½’è¿”å›å€¼è¿”å›å€¼å¾ˆæ˜æ˜¾å°±æ˜¯ç¬¦åˆæ¡ä»¶çš„å„ç§äºŒå‰æ ‘,æ˜¯ä¸€ä¸ªå«æ ¹èŠ‚ç‚¹çš„åˆ—è¡¨(æ ¹æ®é¢˜ç›®æœ€ç»ˆéœ€è¦å¾—åˆ°çš„)ã€‚ ä¸€çº§é€’å½’éœ€è¦åšä»€ä¹ˆè¿™ä¸ªæ˜¯æ¯”è¾ƒéš¾çš„åœ°æ–¹ï¼Œæˆ‘ä»¬æ¥ç¼•ç¼•ç°åœ¨æœ‰ä»€ä¹ˆï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹ï¼Œå·¦å­æ ‘æ ¹èŠ‚ç‚¹ï¼Œå³å­æ ‘æ ¹èŠ‚ç‚¹ï¼Œè¿™ä¸‰ä¸ªèŠ‚ç‚¹æˆ‘ä»¬å¯ä»¥éšæ„å°†ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å½“åšæ ¹èŠ‚ç‚¹ï¼Œç„¶åå»ç»„åˆå¾—åˆ°æ–°çš„æœç´¢äºŒå‰æ ‘ã€‚æ³¨æ„ï¼ï¼ï¼æˆ‘ä»¬åªéœ€è¦å…³æ³¨ä¸€çº§é€’å½’å°±å¯ä»¥äº†ï¼Œæ— éœ€å…³æ³¨å¤ªå¤šï¼Œæˆ‘ä»¬ç°åœ¨æ‰‹ä¸Šå‡è®¾å°±ä¸‰ä¸ªèŠ‚ç‚¹åˆ†åˆ«æ˜¯1,2,3ï¼Œé¦–å…ˆè¦åšçš„å°±æ˜¯éå†1ï¼Œ2ï¼Œ3ï¼Œåˆ†åˆ«å°†å…¶ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œå‡è®¾ä»¥2ä¸ºæ ¹èŠ‚ç‚¹ï¼Œ1ä»£è¡¨å°±æ˜¯å·¦å­æ ‘è¿”å›çš„æ ¹èŠ‚ç‚¹åˆ—è¡¨ï¼Œ3ä»£è¡¨çš„æ˜¯å³å­æ ‘è¿”å›çš„æ ¹èŠ‚ç‚¹åˆ—è¡¨ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯éå†å·¦å³å­æ ‘çš„æ ¹èŠ‚ç‚¹åˆ—è¡¨ï¼Œåˆ†åˆ«å°†å…¶æ·»åŠ åˆ°æ ¹èŠ‚ç‚¹çš„å·¦å³å­æ ‘ï¼Œç„¶åå°†è¯¥æ ¹èŠ‚ç‚¹æ·»åŠ è‡³åˆ—è¡¨ï¼Œè¿”å›åˆ—è¡¨å³å¯ã€‚ ä»£ç 1234567891011121314151617181920212223242526272829303132333435/** * Definition for a binary tree node. * public class TreeNode &#123; * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public List&lt;TreeNode&gt; generateTrees(int n) &#123; if (n &lt;= 0) return new ArrayList&lt;&gt;(); return generateTrees(1, n); &#125; private List&lt;TreeNode&gt; generateTrees(int left, int right) &#123; List&lt;TreeNode&gt; list = new ArrayList&lt;&gt;(); if (left &gt; right) &#123; list.add(null); &#125; else &#123; for (int i = left; i &lt;= right; i++) &#123; List&lt;TreeNode&gt; leftTrees = generateTrees(left, i - 1); List&lt;TreeNode&gt; rightTrees = generateTrees(i + 1, right); for (TreeNode l : leftTrees) &#123; for (TreeNode r : rightTrees) &#123; TreeNode root = new TreeNode(i); root.left = l; root.right = r; list.add(root); &#125; &#125; &#125; &#125; return list; &#125;&#125; éƒ¨åˆ†çŸ¥è¯†ç‚¹è¡¥å……æ˜å¤©ç»§ç»­è¿›å†›äºŒå‰æ ‘éƒ¨åˆ† åŒæ—¶å¤ä¹ å¹¶ä¸”æ¡å›æ¥åŸå…ˆè¦å®Œæˆçš„é›†åˆé‚£éƒ¨åˆ†çš„æºç åˆ†æï¼ï¼ˆ2020.1.1ï¼‰ æ¨è¾‰ä¸‰è§’(118)Tip:ä»Šå¤©ç¬¬ä¸€æ¬¡å†™é¢˜è§£ï¼Œè¿˜æ˜¯éå¸¸å¼€å¿ƒçš„ï¼ï¼ï¼ï¼ï¼ ä»Šå¤©é‡ç‚¹å°±æ˜¯æŒæ¡äº†ä¸€ä¸‹é€’å½’çš„æ€æƒ³ï¼Œæœ€é‡è¦çš„ä¸‰ç‚¹ï¼ï¼ï¼ï¼ï¼ é€’å½’æ€æƒ³ æ‰¾æ•´ä¸ªé€’å½’çš„ç»ˆæ­¢æ¡ä»¶ æ‰¾è¿”å›å€¼ æœ¬åœ°é€’å½’éœ€è¦å¦‚ä½•æ“ä½œ ä¸»è¦å‚è€ƒï¼šé€’å½’ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•° numRowsï¼Œç”Ÿæˆæ¨è¾‰ä¸‰è§’çš„å‰ numRows è¡Œã€‚ åœ¨æ¨è¾‰ä¸‰è§’ä¸­ï¼Œæ¯ä¸ªæ•°æ˜¯å®ƒå·¦ä¸Šæ–¹å’Œå³ä¸Šæ–¹çš„æ•°çš„å’Œã€‚ ç¤ºä¾‹: 123456789è¾“å…¥: 5è¾“å‡º:[ [1], [1,1], [1,2,1], [1,3,3,1], [1,4,6,4,1]] æ€è·¯æ–¹æ³•ä¸€ï¼šé€’å½’é€’å½’æ–¹æ³•æ€»è€Œè¨€ä¹‹å°±æ˜¯æŠ“ä½ä¸‰ç‚¹ï¼š æ‰¾æ•´ä¸ªé€’å½’çš„ç»ˆæ­¢æ¡ä»¶ æ‰¾è¿”å›å€¼ ä¸€æ¬¡é€’å½’éœ€è¦å¦‚ä½•æ“ä½œ æ‰¾æ•´ä¸ªé€’å½’çš„ç»ˆæ­¢æ¡ä»¶å’±æ¥åˆ†æä¸€ä¸‹é¢˜ç›®ï¼Œé€’å½’åˆ°numRows = 0 æ—¶æˆ–è€…numRows = 1æ—¶éƒ½å¯ä»¥ç»ˆæ­¢ï¼Œå› ä¸ºç¬¬ä¸€è¡Œæ¯”è¾ƒç‰¹æ®Šï¼Œåªæœ‰ä¸€ä¸ª1,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å…¶å½“æˆæ•´ä¸ªé€’å½’çš„ç»ˆæ­¢æ¡ä»¶ï¼Œå½“numRows = 1æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»ˆæ­¢é€’å½’å‘ä¸‹è¿”å›å€¼äº†ã€‚ æ‰¾è¿”å›å€¼æ‰¾è¿”å›å€¼ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åˆ†æä¸‹ï¼Œé¢˜ç›®è¦æˆ‘ä»¬æ±‚çš„æ˜¯æ•´ä¸ªæ¨è¾‰ä¸‰è§’çš„æ‰€æœ‰æ•°ï¼Œé‚£æœ€åé€’å½’å¾—åˆ°çš„åº”è¯¥å°±æ˜¯ List&lt;List&lt;Integer&gt;&gt; (é¢˜ç›®ç»™å®š)ï¼Œä¹Ÿå°±æ˜¯æ¯é€’å½’å®Œä¸€å±‚ï¼Œæˆ‘ä»¬å°±æ›´æ–°å®ŒListå¹¶è¿”å›å³å¯ï¼Œæœ€åé€’å½’å®Œæˆå°±æ˜¯æˆ‘ä»¬è¦çš„ç­”æ¡ˆã€‚ ä¸€æ¬¡é€’å½’éœ€è¦å¦‚ä½•æ“ä½œé€’å½’çš„éš¾ç‚¹å°±åœ¨è¿™é‡Œï¼Œå¾ˆå¤šç«¥é´åˆšå­¦é€’å½’æ—¶ï¼Œæ€»æ˜¯åœ¨è¿™é‡Œææ™•ï¼Œå…¶å®æˆ‘ä»¬åªéœ€è¦å…³æ³¨ä¸€æ¬¡é€’å½’å³å¯ï¼Œå› ä¸ºæ¯ä¸€å±‚é€’å½’çš„è¿‡ç¨‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°æœ€ä¸Šå±‚çš„é€’å½’çš„è§„å¾‹ï¼Œå°±å¯ä»¥äº†ã€‚ å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åªéœ€è¦åˆ†æç¬¬äºŒè¡Œåˆ°ç¬¬ä¸‰è¡Œè¿™çº§é€’å½’å³å¯ï¼å…ˆä¸Šä»£ç ï¼ é€’å½’ ä»£ç 12345678910111213141516171819202122232425262728293031class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; generate(int numRows) &#123; //å­˜å‚¨è¦è¿”å›çš„æ¨è¾‰ä¸‰è§’ List&lt;List&lt;Integer&gt;&gt; dg = new ArrayList&lt;&gt;(); //è‹¥0è¡Œï¼Œåˆ™è¿”å›ç©º if(numRows == 0)&#123; return dg; &#125; //é€’å½’å‡ºå£ï¼Œè¿™æ˜¯ç¬¬ä¸€æ­¥ï¼æ‰¾åˆ°å‡ºå£ if(numRows == 1)&#123; dg.add(new ArrayList&lt;&gt;()); dg.get(0).add(1); return dg; &#125; //é€’å½’ï¼Œæ³¨æ„è¿”å›å€¼ï¼ï¼ï¼è¿™æ˜¯ç¬¬äºŒæ­¥ dg = generate(numRows-1); //ä¸€çº§é€’å½’è¦åšå•¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ç¬¬äºŒè¡Œåˆ°ç¬¬ä¸‰è¡Œéœ€è¦åšå•¥ //é¦–å…ˆæ˜¯è¦ç”³è¯·ä¸€ä¸ªlistæ¥å­˜å‚¨ç¬¬ä¸‰è¡Œï¼Œç„¶åé€šè¿‡ç¬¬äºŒè¡Œå¾—åˆ°ç¬¬ä¸‰è¡Œ //ç¬¬ä¸‰è¡Œçš„é¦–å°¾ä¸º1æ˜¯ç¡®å®šäº†çš„ï¼Œç„¶åå°±æ˜¯ä¸­é—´çš„æ•°å¦‚ä½•å¾—åˆ° //é€šè¿‡è§‚å¯Ÿå¾ˆå®¹æ˜“æ‹¿åˆ°forå¾ªç¯é‡Œé¢çš„å¼å­ //æœ€ååˆ«å¿˜äº†è¿”å›å€¼ï¼ï¼ï¼ List&lt;Integer&gt; row = new ArrayList&lt;&gt;(); row.add(1); for(int j = 1;j &lt; numRows - 1;j++)&#123; row.add(dg.get(numRows-2).get(j-1) + dg.get(numRows-2).get(j)); &#125; row.add(1); dg.add(row); return dg; &#125;&#125; æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’æ€è·¯å…¶å®å·®ä¸å¤šï¼Œåªæ˜¯ä¸€ä¸ªé€’å½’ï¼Œä¸€ä¸ªå˜æˆäº†è¿­ä»£è€Œï¼Œä»…æ­¤è€Œå·²ï¼ 1234567891011121314151617181920212223class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; generate(int numRows) &#123; List&lt;List&lt;Integer&gt;&gt; dp = new ArrayList&lt;&gt;(); if(numRows == 0)&#123; return dp; &#125; dp.add(new ArrayList&lt;&gt;()); dp.get(0).add(1); //æ³¨æ„è¿™é‡Œçš„ i æ˜¯æŒ‡è¡Œæ•°ï¼Œä½†æ˜¯dpæ˜¯ä»0å¼€å§‹çš„ //æ‰€ä»¥preRowæ˜¯i-2 for(int i = 2;i &lt;= numRows;i++)&#123; List&lt;Integer&gt; row = new ArrayList&lt;&gt;(); List&lt;Integer&gt; preRow = dp.get(i-2); row.add(1); for(int j = 1;j &lt; i-1;j++)&#123; row.add(preRow.get(j) + preRow.get(j-1)); &#125; row.add(1); dp.add(row); &#125; return dp; &#125;&#125; å•è¯æ‹†åˆ†(139)é¢˜ç›®ç»™å®šä¸€ä¸ªéç©ºå­—ç¬¦ä¸² s å’Œä¸€ä¸ªåŒ…å«éç©ºå•è¯åˆ—è¡¨çš„å­—å…¸ wordDictï¼Œåˆ¤å®š s æ˜¯å¦å¯ä»¥è¢«ç©ºæ ¼æ‹†åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªåœ¨å­—å…¸ä¸­å‡ºç°çš„å•è¯ã€‚ è¯´æ˜ï¼š æ‹†åˆ†æ—¶å¯ä»¥é‡å¤ä½¿ç”¨å­—å…¸ä¸­çš„å•è¯ã€‚ ä½ å¯ä»¥å‡è®¾å­—å…¸ä¸­æ²¡æœ‰é‡å¤çš„å•è¯ã€‚ ç¤ºä¾‹ç¤ºä¾‹ 1ï¼š 123è¾“å…¥: s = "leetcode", wordDict = ["leet", "code"]è¾“å‡º: trueè§£é‡Š: è¿”å› true å› ä¸º "leetcode" å¯ä»¥è¢«æ‹†åˆ†æˆ "leet code"ã€‚ ç¤ºä¾‹ 2ï¼š 1234è¾“å…¥: s = "applepenapple", wordDict = ["apple", "pen"]è¾“å‡º: trueè§£é‡Š: è¿”å› true å› ä¸º "applepenapple" å¯ä»¥è¢«æ‹†åˆ†æˆ "apple pen apple"ã€‚æ³¨æ„ä½ å¯ä»¥é‡å¤ä½¿ç”¨å­—å…¸ä¸­çš„å•è¯ã€‚ 1234ç¤ºä¾‹ 3ï¼šè¾“å…¥: s = "catsandog", wordDict = ["cats", "dog", "sand", "and", "cat"]è¾“å‡º: false ä»£ç 123456789101112131415class Solution &#123; public boolean wordBreak(String s, List&lt;String&gt; wordDict) &#123; boolean[] dp = new boolean[s.length()+1]; dp[0] = true; for(int i = 1;i &lt;= s.length();i++)&#123; for(int j = 0;j &lt; i;j++)&#123; if(dp[j] == true &amp;&amp; wordDict.contains(s.substring(j,i)))&#123; dp[i] = true; break; &#125; &#125; &#125; return dp[s.length()]; &#125;&#125; è§£ç æ–¹æ³•(91)é¢˜ç›®æè¿°1234567ä¸€æ¡åŒ…å«å­—æ¯ A-Z çš„æ¶ˆæ¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œäº†ç¼–ç ï¼š'A' -&gt; 1'B' -&gt; 2...'Z' -&gt; 26ç»™å®šä¸€ä¸ªåªåŒ…å«æ•°å­—çš„éç©ºå­—ç¬¦ä¸²ï¼Œè¯·è®¡ç®—è§£ç æ–¹æ³•çš„æ€»æ•°ã€‚ ç¤ºä¾‹1234567891011ç¤ºä¾‹ 1:è¾“å…¥: "12"è¾“å‡º: 2è§£é‡Š: å®ƒå¯ä»¥è§£ç ä¸º "AB"ï¼ˆ1 2ï¼‰æˆ–è€… "L"ï¼ˆ12ï¼‰ã€‚ç¤ºä¾‹ 2:è¾“å…¥: "226"è¾“å‡º: 3è§£é‡Š: å®ƒå¯ä»¥è§£ç ä¸º "BZ" (2 26), "VF" (22 6), æˆ–è€… "BBF" (2 2 6) ã€‚ æ€è·¯æ‰€æœ‰å¯ä»¥ç”¨dpçš„ï¼ŒåŸºæœ¬éƒ½æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š é€’å½’ â€”â€”-&gt; å¸¦å¤‡å¿˜å½•çš„è‡ªé¡¶å‘ä¸‹ â€”â€”-&gt; dp é€’å½’1234567891011121314151617181920212223242526272829class Solution &#123; public int numDecodings(String s) &#123; if(s.length() == 0 || s == null)&#123; return 0; &#125; return numDecodingsByRecrusion(s,0,s.length()-1); &#125; private int numDecodingsByRecrusion(String s,int start,int end)&#123; //1.é€’å½’å‡ºå£ï¼šæ•°å­—ä¸ºæœ€åä¸€ä¸ªæ•°å­—æ—¶å³ç»“æŸé€’å½’ //2.è¿”å›å€¼ï¼šè¿”å›è§£ç æ–¹æ³•æ•° //3.ä¸€æ¬¡é€’å½’çš„è¿‡ç¨‹ if(start &gt; end)&#123; return 1; &#125; if(s.charAt(start) == '0')&#123; return 0; &#125; if(start == end)&#123; return 1; &#125; int num1 = numDecodingsByRecrusion(s,start+1,end); int num2 = 0; if((s.charAt(start) - '0') * 10 + (s.charAt(start+1)-'0') &lt;= 26)&#123; num2 = numDecodingsByRecrusion(s,start+2,end); &#125; return num1+num2; &#125;&#125; å¸¦å¤‡å¿˜å½•çš„è‡ªé¡¶å‘ä¸‹123456789101112131415161718192021222324252627282930313233343536class Solution &#123; public int numDecodings(String s) &#123; if(s.length() == 0 || s == null)&#123; return 0; &#125; // int res = numDecodingsByRecrusion(s,0,s.length()-1); // int res = numDecodingsByDp(s); HashMap&lt;Integer,Integer&gt; memo = new HashMap&lt;&gt;(); return numDecodingsByMemo(s,0,s.length()-1,memo); &#125; private int numDecodingsByMemo(String s, int start, int end, HashMap&lt;Integer, Integer&gt; memo)&#123; //1.é€’å½’å‡ºå£ï¼šæ•°å­—ä¸ºæœ€åä¸€ä¸ªæ•°å­—æ—¶å³ç»“æŸé€’å½’ //2.è¿”å›å€¼ï¼šè¿”å›è§£ç æ–¹æ³•æ•° //3.ä¸€æ¬¡é€’å½’çš„è¿‡ç¨‹ if(start &gt; end)&#123; return 1; &#125; if(s.charAt(start) == '0')&#123; return 0; &#125; if(start == end)&#123; return 1; &#125; if(memo.containsKey(start))&#123; return memo.get(start); &#125; int num1 = numDecodingsByMemo(s,start+1,end,memo); int num2 = 0; if((s.charAt(start) - '0') * 10 + (s.charAt(start+1)-'0') &lt;= 26)&#123; num2 = numDecodingsByMemo(s,start+2,end,memo); &#125; memo.put(start,num1+num2); return num1+num2; &#125;&#125; dpæ³¨æ„ï¼šéš¾ç‚¹åœ¨å¤„ç†&#39;0&#39;,&#39;00&#39;ç­‰è¾¹ç•Œé—®é¢˜ï¼å°¤å…¶æ˜¯åœ¨dp[n]ã€dp[n-1]çš„èµ‹å€¼é—®é¢˜ä¸Šæœ‰ä¸€ç‚¹éš¾åº¦ï¼Œè€Œä¸”ï¼Œè¿™ä¸ªç”±äºæ˜¯å€’åºçš„ï¼Œè·Ÿå¹³æ—¶å¤„ç†çš„dpé—®é¢˜ç•¥å¾®æœ‰äº›è®¸ä¸åŒï¼Œä»¥å‰æ˜¯dp[1]å¯¹åº”ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œè¿™é‡Œæ˜¯dp[0]å¯¹åº”ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚ 123456789101112131415161718192021222324252627class Solution &#123; public int numDecodings(String s) &#123; int len = s.length(); int[] dp = new int[len + 1]; dp[len] = 1; //å°†é€’å½’æ³•çš„ç»“æŸæ¡ä»¶åˆå§‹åŒ–ä¸º 1 //æœ€åä¸€ä¸ªæ•°å­—ä¸ç­‰äº 0 å°±åˆå§‹åŒ–ä¸º 1 if (s.charAt(len - 1) != '0') &#123; dp[len - 1] = 1; &#125; for (int i = len - 2; i &gt;= 0; i--) &#123; //å½“å‰æ•°å­—æ—¶ 0 ï¼Œç›´æ¥è·³è¿‡ï¼Œ0 ä¸ä»£è¡¨ä»»ä½•å­—æ¯ if (s.charAt(i) == '0') &#123; continue; &#125; int ans1 = dp[i + 1]; //åˆ¤æ–­ä¸¤ä¸ªå­—æ¯ç»„æˆçš„æ•°å­—æ˜¯å¦å°äºç­‰äº 26 int ans2 = 0; int ten = (s.charAt(i) - '0') * 10; int one = s.charAt(i + 1) - '0'; if (ten + one &lt;= 26) &#123; ans2 = dp[i + 2]; &#125; dp[i] = ans1 + ans2; &#125; return dp[0]; &#125;&#125; é›¶é’±å…‘æ¢(322)ä¸€ç»´dpæ•°ç»„ï¼Œç®€å•çš„ä¸€æ‰¹â€¦ 12345678910111213141516class Solution &#123; public int coinChange(int[] coins, int amount) &#123; //éå¸¸æ˜æ˜¾çš„ä½¿ç”¨dp int[] dp = new int[amount+1]; //ä»£è¡¨çš„æ˜¯å¯¹åº”é’±æ•°æ‰€éœ€çš„æœ€å°‘çš„ç¡¬å¸ä¸ªæ•° Arrays.fill(dp,amount+1); dp[0] = 0; for(int i = 0;i &lt;= amount;i++)&#123; for(int j = 0;j &lt; coins.length;j++)&#123; if(coins[j] &lt;= i)&#123; dp[i] = Math.min(dp[(i-coins[j])]+1,dp[i]); &#125; &#125; &#125; return dp[amount] == amount+1 ? -1:dp[amount]; &#125;&#125; å›æ–‡å­ä¸²(647)æ€è·¯åŒç¬¬5é¢˜ï¼ï¼ï¼ï¼ 12345678910111213141516class Solution &#123; public int countSubstrings(String s) &#123; int res = 0; boolean dp[][] = new boolean[s.length()][s.length()]; for (int i = 0; i &lt; s.length(); i++) &#123; for (int j = 0; j &lt;= i; j++) &#123; //dpçš„å‡ºå£å°±æ˜¯é•¿åº¦åœ¨3ä»¥å†…(åŒ…æ‹¬3),æ³¨æ„jä¸ºå¼€å§‹ï¼Œiä¸ºç»“æŸ if (s.charAt(j) == s.charAt(i) &amp;&amp; ((i - j &lt;= 2) || dp[j + 1][i - 1])) &#123; dp[j][i] = true; res++; &#125; &#125; &#125; return res; &#125;&#125; ç¯å½¢é“¾è¡¨I(141)é¢˜ç›®ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚ æ€è·¯ æ–¹æ³•ä¸€ï¼šä½¿ç”¨Seté›†åˆå­˜å‚¨å·²ç»å‡ºç°è¿‡çš„èŠ‚ç‚¹ï¼Œå¦‚æœå†æ¬¡å‡ºç°ï¼Œåˆ™ç›´æ¥è¿”å›trueï¼Œå¦‚æœæ²¡æœ‰å†å‡ºç°ï¼Œåˆ™ä¸€å®šä¼šæœ‰nullèŠ‚ç‚¹çš„å‡ºç°ã€‚ æ–¹æ³•äºŒï¼šè¿ç”¨å¿«æ…¢æŒ‡é’ˆçš„æ–¹æ³•ï¼Œå¿«æŒ‡é’ˆèµ°å¾—å¿«ï¼Œå¦‚æœéå†åˆ°nullèŠ‚ç‚¹ï¼Œåˆ™è¯´æ˜ä¸å­˜åœ¨ç¯ï¼Œå¦‚æœå¿«æŒ‡é’ˆå’Œæ…¢æŒ‡é’ˆä¼šç›¸é‡ï¼Œåˆ™è¯´æ˜å­˜åœ¨ç¯ã€‚ ä»£ç  æ–¹æ³•ä¸€ 123456789101112131415public class Solution &#123; public boolean hasCycle(ListNode head) &#123; HashSet&lt;ListNode&gt; set = new HashSet&lt;&gt;(); while(head != null)&#123; if(!set.contains(head))&#123; set.add(head); &#125; else&#123; return true; &#125; head = head.next; &#125; return false; &#125;&#125; æ–¹æ³•äºŒ 1234567891011121314151617public class Solution &#123; public boolean hasCycle(ListNode head) &#123; if(head == null || head.next == null)&#123; return false; &#125; ListNode slow = head.next; ListNode fast = head.next.next; while(slow != fast)&#123; if(fast == null || fast.next == null)&#123; return false; &#125; slow = slow.next; fast = fast.next.next; &#125; return true; &#125;&#125; ç¯å½¢é“¾è¡¨ II(142)è¿™ä¸ªé¢˜ç¿»è¯‘çš„ä¸€å¨å±â€¦é¢˜ç›®æ•´æ¥æ•´å»ä¸çŸ¥é“åœ¨è¯´ä»€ä¹ˆï¼ŒçœŸçš„æ˜¯æœäº†è€¶ï¼ å…¶å®é¢˜ç›®å°±ä¸€ä¸ªæ„æ€ï¼Œç»™å®šä¸€ä¸ªæœ‰ç¯é“¾è¡¨ï¼Œè¦ä½ è¿”å›ç¯çš„å…¥å£ï¼ æ€è·¯è¿™ç§æ€è·¯éƒ½è¦è®²çƒ‚äº†å§..å°±æ˜¯ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œç¬¬ä¸€æ¬¡ç›¸é‡åï¼Œå¿«æŒ‡é’ˆç»§ç»­èµ°ï¼Œæ…¢æŒ‡é’ˆå›åˆ°èµ·ç‚¹ï¼Œç¬¬äºŒæ¬¡ç›¸é‡çš„åœ°æ–¹å°±æ˜¯ç¯çš„èµ·ç‚¹ã€‚ ä»£ç 12345678910111213141516171819202122232425262728/** * Definition for singly-linked list. * class ListNode &#123; * int val; * ListNode next; * ListNode(int x) &#123; * val = x; * next = null; * &#125; * &#125; */public class Solution &#123; public ListNode detectCycle(ListNode head) &#123; ListNode fast = head, slow = head; while (true) &#123; if (fast == null || fast.next == null) return null; fast = fast.next.next; slow = slow.next; if (fast == slow) break; &#125; fast = head; while (slow != fast) &#123; slow = slow.next; fast = fast.next; &#125; return fast; &#125;&#125; 4. å¯»æ‰¾ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°é¢˜ç›®ç»™å®šä¸¤ä¸ªå¤§å°ä¸º m å’Œ n çš„æœ‰åºæ•°ç»„ nums1 å’Œ nums2ã€‚ è¯·ä½ æ‰¾å‡ºè¿™ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°ï¼Œå¹¶ä¸”è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log(m + n))ã€‚ ä½ å¯ä»¥å‡è®¾ nums1 å’Œ nums2 ä¸ä¼šåŒæ—¶ä¸ºç©ºã€‚ ç¤ºä¾‹ 1: 1234nums1 = [1, 3]nums2 = [2]åˆ™ä¸­ä½æ•°æ˜¯ 2.0 ç¤ºä¾‹ 2: 1234nums1 = [1, 2]nums2 = [3, 4]åˆ™ä¸­ä½æ•°æ˜¯ (2 + 3)/2 = 2.5 æ€è·¯ å¦‚æœæ²¡æœ‰æ—¶é—´å¤æ‚åº¦çš„è¯ï¼Œé‚£è¿™é“é¢˜æœ‰éå¸¸å¤šçš„æ€è·¯å¯ä»¥åšï¼Œå¯ä»¥å…ˆæ’åºå†å–ä¸­ä½æ•°ï¼Œå¯ä»¥é‡‡ç”¨ä¸¤ä¸ªæœ‰åºæ•°ç»„è¿›è¡Œå½’å¹¶æ’åºï¼Œè¿™æ ·çš„æ—¶é—´å¤æ‚åº¦ä¸º O(m+n) ,è¾¾ä¸åˆ° O(log(m+n)) çœ‹åˆ°log(m+n)ï¼Œå°±åº”è¯¥æƒ³åˆ°äºŒåˆ†æŸ¥æ‰¾ï¼Œè¿™é“é¢˜ä¹Ÿçš„ç¡®å¯ä»¥ç”¨äºŒåˆ†å»åšã€‚é¦–å…ˆæˆ‘ä»¬æ˜ç¡®ä¸€ä¸‹è¿™é‡Œçš„ä¸­ä½æ•°æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè¿™é‡Œè¯´çš„æ˜¯æ±‚ä¸¤ä¸ªæœ‰åºæ•°ç»„(m + n)çš„ä¸­ä½æ•°ï¼Œå¦‚æœ m + n ä¸ºå¥‡æ•°ï¼Œåˆ™ä¸­ä½æ•°çš„ä¸‹æ ‡ä¸º (m + n + 1)/2 [ä¸‹æ ‡ä»1å¼€å§‹ï¼]ï¼Œå¦‚æœ m + n ä¸ºå¶æ•°ï¼Œåˆ™ä¸­ä½æ•°çš„å€¼ä¸ºä¸‹æ ‡ä¸º (m + n + 1)/2 ã€(m + n + 2)/2çš„æ•°çš„å¹³å‡å€¼ï¼Œæ‰€ä»¥å…¶å®å¯ä»¥ç»Ÿä¸€ä¸€ä¸‹ï¼Œä¹Ÿå°±æ˜¯ä¸è®ºå¥‡æ•°è¿˜æ˜¯å¶æ•°ï¼Œä¸­ä½æ•°çš„å€¼ = ä¸‹æ ‡ä¸º (m + n + 1)/2 ã€(m + n + 2)/2çš„æ•°çš„å¹³å‡å€¼ï¼ï¼ï¼æ‰€ä»¥é—®é¢˜å°±è½¬æ¢ä¸ºæ±‚ç¬¬ (m + n + 1)/2ã€ (m + n + 2)/2å¤§çš„æ•°äº†ï¼Œè‡³äºæ±‚ç¬¬Kå¤§çš„æ•°é—®é¢˜ï¼Œè¿™ä¸ªæ–¹æ³•å°±å¾ˆå¤šäº†ï¼Œä»è¿œå¤çš„å¿«æ’åˆ°å †æ’åºï¼Œå¾…ä¼šä¼šæ‹“å±•ä¸€ä¸‹ï¼å›åˆ°æ­£é¢˜ï¼Œå¦‚ä½•åœ¨ä¸¤ä¸ªæœ‰åºæ•°ç»„ä¸­é—´å–åˆ°ç¬¬Kå¤§çš„æ•°è¿˜å¿…é¡»æ˜¯logçº§åˆ«çš„æ—¶é—´å¤æ‚åº¦ï¼Œé‚£åªèƒ½é€‰æ‹©äºŒåˆ†äº†ï¼Œè¿™é‡Œçš„äºŒåˆ†æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯å¯¹ä¸¤ä¸ªæ•°ç»„å–ç¬¬K/2å¤§çš„æ•°ï¼Œæœ‰äººä¼šé—®äº†ï¼Œä¸ºä½•æ˜¯è¿™æ ·å–å‘¢ï¼Ÿå› ä¸ºåœ¨æ¯æ¬¡åˆ’åˆ†çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½è¦ç¡®ä¿ç¬¬Kå¤§çš„æ•°æœªè¢«å»é™¤ï¼Œæ‰€ä»¥ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«å–K/2ï¼Œè¿™æ ·èƒ½ç¡®ä¿æœ‰ m + n - kä¸ªæ•°æ˜¯ä¸€å®šå¤§äºæˆ‘ä»¬è¦å–çš„æ•°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„äºŒåˆ†ï¼Œå°±æ˜¯ä¸€æ­¥æ­¥å»é™¤æ¯”ä¸­ä½æ•°å°çš„æ•°ï¼Œç›´åˆ°éå†åˆ°ä¸­ä½æ•°ä¸ºæ­¢ï¼Œè€Œä»€ä¹ˆæ—¶å€™èƒ½éå†åˆ°ä¸­ä½æ•°å‘¢ï¼Ÿéš¾ç‚¹å°±åœ¨äºè¾¹ç•Œæ¯”è¾ƒå¤æ‚ï¼Œæ¯”å¦‚ï¼šæ•°ç»„é•¿åº¦è¿‡çŸ­å¯¼è‡´å–ä¸åˆ°K/2ã€Kå¦‚æœä¸º1çš„è¯æ˜¯ä¸èƒ½å–K/2çš„(ä¸‹æ ‡ä»1å¼€å§‹ï¼Œè¿™æ ·ä¼šè¶Šç•Œ)ã€å•ä¸ªæ•°ç»„å¯èƒ½å·²ç»éå†å®Œå¦å¤–ä¸€ä¸ªè¿˜æ²¡éå†å®Œç­‰ç­‰ã€‚ ä»£ç å®ç°æ–¹æ³•ä¸€è§å½’å¹¶æ’åºçš„åšæ³•(æ—¶é—´å¤æ‚åº¦å…¶å®æ˜¯ä¸ç¬¦åˆè¦æ±‚çš„) æ–¹æ³•äºŒ123456789101112131415161718192021222324252627282930313233343536/** * æ–¹æ³•äºŒ * @param nums1 * @param nums2 * @return */public static double findMedianSortedArrays(int[] nums1, int[] nums2) &#123; return (findMedianSortedArraysByRecursion(nums1,0,nums2,0,(nums1.length + nums2.length + 1)/2) + findMedianSortedArraysByRecursion(nums1,0,nums2,0,(nums1.length + nums2.length + 2)/2))/2.0;&#125;/** * é€’å½’ä¸‰éƒ¨æ›² * 1ã€æ‰¾åˆ°é€’å½’å‡ºå£ï¼Œå½“éå†çš„æ•°çš„ä¸‹æ ‡å¤§äºç­‰äºæ•°ç»„æœ¬èº«é•¿åº¦ï¼Œè¯´æ˜å¯ä»¥ç»“æŸäº†ï¼Œæ³¨æ„è¿™é‡Œæ˜¯å¤§äºç­‰äºå“¦ï¼Œå› ä¸ºä¸‹æ ‡æ˜¯ä»0å¼€å§‹çš„ï¼ * è¿˜è¦ä¸€ä¸ªé€’å½’å‡ºå£å°±æ˜¯ï¼Œå½“kä¸º1æ—¶ï¼Œå³æ‰¾æœ€å°çš„é‚£ä¸ªæ•°ï¼Œåˆ™ç›´æ¥æ¯”è¾ƒæ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ å³å¯ * 2ã€æ‰¾åˆ°è¿”å›å€¼ï¼Œè¿”å›ç¬¬Kå¤§çš„æ•°çš„å€¼å³å¯ * 3ã€æ¯ä¸€è½®é€’å½’éœ€è¦åšçš„äº‹æƒ…ï¼Œæˆ‘ä»¬éœ€è¦ä»èµ·å§‹ç‚¹å¼€å§‹ï¼Œå¯»æ‰¾ç¬¬Kå¤§çš„æ•°ï¼Œå³åˆ†åˆ«åœ¨ä¸¤ä¸ªæ•°ç»„ä¸­æ‰¾åˆ°ç¬¬K/2å¤§çš„æ•° * è‹¥ä¸€ä¸ªæ•°ç»„ä¸­æ‰¾ä¸åˆ°ç¬¬K/2ä¸ªæ•°ï¼Œåˆ™è¯´æ˜å¦å¤–ä¸€ä¸ªæ•°ç»„çš„å‰K/2çš„æ•°å¯¹æˆ‘ä»¬æ²¡æœ‰æ„ä¹‰ * @param nums1 * @param nums1_start * @param nums2 * @param nums2_start * @param k * @return */private static double findMedianSortedArraysByRecursion(int[] nums1, int nums1_start, int[] nums2, int nums2_start, int k) &#123; if(nums1_start &gt;= nums1.length) return nums2[nums2_start+k-1]; if(nums2_start &gt;= nums2.length) return nums1[nums1_start+k-1]; if(k == 1)&#123; return Math.min(nums1[nums1_start],nums2[nums2_start]); &#125; int mid_num1 = (nums1_start + k/2 - 1) &lt; nums1.length ? nums1[nums1_start + k/2 -1] : Integer.MAX_VALUE; int mid_num2 = (nums2_start + k/2 - 1) &lt; nums2.length ? nums2[nums2_start + k/2 -1] : Integer.MAX_VALUE; return mid_num1 &gt; mid_num2 ? findMedianSortedArraysByRecursion(nums1,nums1_start,nums2,nums2_start+k/2,k-k/2) : findMedianSortedArraysByRecursion(nums1,nums1_start+k/2,nums2,nums2_start,k-k/2);&#125; 17. ç”µè¯å·ç çš„å­—æ¯ç»„åˆé¢˜ç›®ç»™å®šä¸€ä¸ªä»…åŒ…å«æ•°å­— 2-9 çš„å­—ç¬¦ä¸²ï¼Œè¿”å›æ‰€æœ‰å®ƒèƒ½è¡¨ç¤ºçš„å­—æ¯ç»„åˆã€‚ ç»™å‡ºæ•°å­—åˆ°å­—æ¯çš„æ˜ å°„å¦‚ä¸‹ï¼ˆä¸ç”µè¯æŒ‰é”®ç›¸åŒï¼‰ã€‚æ³¨æ„ 1 ä¸å¯¹åº”ä»»ä½•å­—æ¯ã€‚ ç¤ºä¾‹: 12è¾“å…¥ï¼š"23"è¾“å‡ºï¼š["ad", "ae", "af", "bd", "be", "bf", "cd", "ce", "cf"]. æ€è·¯é˜Ÿåˆ—å…ˆå®šä¹‰ä¸€ä¸ªStringå­—ç¬¦ä¸²æ•°ç»„ï¼Œç„¶åéå†è¾“å…¥çš„æ•°å­—ï¼Œæ‹¿åˆ°æ¯ä¸€ä¸ªæ•°å­—ï¼Œç„¶ååˆ©ç”¨é˜Ÿåˆ—ï¼Œå…ˆå°†å‰ä¸€æ¬¡å¾ªç¯çš„å­—ç¬¦ä¸²éå†(è¿™é‡Œéå¸¸å·§å¦™ï¼Œå› ä¸º i ä» 0 å¼€å§‹ï¼Œé‚£ä¹ˆç¬¬ n æ¬¡å¾ªç¯çš„ i ä¸º n-1 ,å³æ˜¯å‰ä¸€æ¬¡å¾ªç¯çš„å­—ç¬¦ä¸²çš„é•¿åº¦)ï¼Œæ¯æ¬¡éå†å‰ä¸€æ¬¡å¾ªç¯çš„å­—ç¬¦ä¸²ï¼Œå°±å°†å…¶å‡ºé˜Ÿåˆ—ï¼Œç„¶åå°†æ–°çš„å­—ç¬¦ä¸²æ‹¼æ¥å¥½ç›´æ¥æ”¾å…¥é˜Ÿåˆ—ï¼Œç±»ä¼¼äºæ ‘çš„å±‚åºéå†ï¼Œåªæ˜¯è¿™é‡Œéå¸¸å·§å¦™åœ°è¿ç”¨äº†é˜Ÿå¤´å…ƒç´ çš„é•¿åº¦å’Œ i çš„å…³ç³»ã€‚ å›æº¯å›æº¯æ˜¯ä¸€ç§é€šè¿‡ç©·ä¸¾æ‰€æœ‰å¯èƒ½æƒ…å†µæ¥æ‰¾åˆ°æ‰€æœ‰è§£çš„ç®—æ³•ã€‚å¦‚æœä¸€ä¸ªå€™é€‰è§£æœ€åè¢«å‘ç°å¹¶ä¸æ˜¯å¯è¡Œè§£ï¼Œå›æº¯ç®—æ³•ä¼šèˆå¼ƒå®ƒï¼Œå¹¶åœ¨å‰é¢çš„ä¸€äº›æ­¥éª¤åšå‡ºä¸€äº›ä¿®æ”¹ï¼Œå¹¶é‡æ–°å°è¯•æ‰¾åˆ°å¯è¡Œè§£ã€‚ ç»™å‡ºå¦‚ä¸‹å›æº¯å‡½æ•° backtrack(combination, next_digits) ï¼Œå®ƒå°†ä¸€ä¸ªç›®å‰å·²ç»äº§ç”Ÿçš„ç»„åˆ combination å’Œæ¥ä¸‹æ¥å‡†å¤‡è¦è¾“å…¥çš„æ•°å­— next_digits ä½œä¸ºå‚æ•°ã€‚ å¦‚æœæ²¡æœ‰æ›´å¤šçš„æ•°å­—éœ€è¦è¢«è¾“å…¥ï¼Œé‚£æ„å‘³ç€å½“å‰çš„ç»„åˆå·²ç»äº§ç”Ÿå¥½äº†ã€‚å¦‚æœè¿˜æœ‰æ•°å­—éœ€è¦è¢«è¾“å…¥ï¼šéå†ä¸‹ä¸€ä¸ªæ•°å­—æ‰€å¯¹åº”çš„æ‰€æœ‰æ˜ å°„çš„å­—æ¯ã€‚å°†å½“å‰çš„å­—æ¯æ·»åŠ åˆ°ç»„åˆæœ€åï¼Œä¹Ÿå°±æ˜¯ combination = combination + letterã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œè¾“å…¥å‰©ä¸‹çš„æ•°å­—ï¼š backtrack(combination + letter, next_digits[1:])ã€‚ ä»£ç å®ç°é˜Ÿåˆ—å®ç°1234567891011121314151617class Solution &#123; public List&lt;String&gt; letterCombinations(String digits) &#123; LinkedList&lt;String&gt; ans = new LinkedList&lt;String&gt;(); if(digits.isEmpty()) return ans; String[] mapping = new String[] &#123;"0", "1", "abc", "def", "ghi", "jkl", "mno", "pqrs", "tuv", "wxyz"&#125;; ans.add(""); for(int i =0; i&lt;digits.length();i++)&#123; int x = Character.getNumericValue(digits.charAt(i)); while(ans.peek().length()==i)&#123; String t = ans.remove(); for(char s : mapping[x].toCharArray()) ans.add(t+s); &#125; &#125; return ans; &#125;&#125; å›æº¯å®ç°1234567891011121314151617181920212223242526272829303132333435363738394041class Solution &#123; Map&lt;String, String&gt; phone = new HashMap&lt;String, String&gt;() &#123;&#123; put("2", "abc"); put("3", "def"); put("4", "ghi"); put("5", "jkl"); put("6", "mno"); put("7", "pqrs"); put("8", "tuv"); put("9", "wxyz"); &#125;&#125;; List&lt;String&gt; output = new ArrayList&lt;String&gt;(); public void backtrack(String combination, String next_digits) &#123; // if there is no more digits to check if (next_digits.length() == 0) &#123; // the combination is done output.add(combination); &#125; // if there are still digits to check else &#123; // iterate over all letters which map // the next available digit String digit = next_digits.substring(0, 1); String letters = phone.get(digit); for (int i = 0; i &lt; letters.length(); i++) &#123; String letter = phone.get(digit).substring(i, i + 1); // append the current letter to the combination // and proceed to the next digits backtrack(combination + letter, next_digits.substring(1)); &#125; &#125; &#125; public List&lt;String&gt; letterCombinations(String digits) &#123; if (digits.length() != 0) backtrack("", digits); return output; &#125;&#125; 22. æ‹¬å·ç”Ÿæˆ##é¢˜ç›® ç»™å‡º n ä»£è¡¨ç”Ÿæˆæ‹¬å·çš„å¯¹æ•°ï¼Œè¯·ä½ å†™å‡ºä¸€ä¸ªå‡½æ•°ï¼Œä½¿å…¶èƒ½å¤Ÿç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¹¶ä¸”æœ‰æ•ˆçš„æ‹¬å·ç»„åˆã€‚ ä¾‹å¦‚ï¼Œç»™å‡º n = 3ï¼Œç”Ÿæˆç»“æœä¸ºï¼š 1234567[ "((()))", "(()())", "(())()", "()(())", "()()()"] æ€è·¯dpç®€å•æ¥è¯´ï¼Œåœ¨æ±‚Nä¸ªæ‹¬å·çš„æ’åˆ—ç»„åˆæ—¶ï¼ŒæŠŠç¬¬Nç§æƒ…å†µï¼ˆä¹Ÿå°±æ˜¯Nä¸ªæ‹¬å·æ’åˆ—ç»„åˆï¼‰è§†ä¸ºå•ç‹¬æ‹¿ä¸€ä¸ªæ‹¬å·Eå‡ºæ¥ï¼Œå‰©ä¸‹çš„N-1ä¸ªæ‹¬å·åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼ŒPä¸ªæ‹¬å·å’ŒQä¸ªæ‹¬å·ï¼ŒP+Q=N-1ï¼Œç„¶åè¿™ä¸¤éƒ¨åˆ†åˆ†åˆ«å¤„äºæ‹¬å·Eå†…å’Œæ‹¬å·Eçš„å³è¾¹ï¼Œå„è‡ªè¿›è¡Œæ‹¬å·çš„æ’åˆ—ç»„åˆã€‚ç”±äºæˆ‘ä»¬æ˜¯ä¸€æ­¥æ­¥è®¡ç®—å¾—åˆ°Nä¸ªæ‹¬å·çš„æƒ…å†µçš„ï¼Œæ‰€ä»¥å°äºç­‰äºN-1ä¸ªæ‹¬å·çš„æ’åˆ—ç»„åˆæ–¹å¼æˆ‘ä»¬æ˜¯å·²çŸ¥çš„ï¼ˆç”¨åˆé€‚çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ–¹ä¾¿åç»­è°ƒç”¨ï¼Œä¸”åœ¨å­˜å‚¨æ—¶å¯åˆ©ç”¨ç‰¹å®šæ•°æ®ç»“æ„å®ç°é¢˜ç›®æŸäº›è¦æ±‚ï¼Œå¦‚æ’åºï¼Œå»é‡ç­‰ï¼‰ï¼Œä¸”P+Q=N-1ï¼ŒPå’ŒQæ˜¯å°äºç­‰äºN-1çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½ç›´æ¥å¾—åˆ°Pä¸ªå’ŒQä¸ªæ‹¬å·çš„æƒ…å†µï¼Œè¿›è€Œå¾—åˆ°Nä¸ªæ‹¬å·çš„ç»“æœï¼ è¿™ä¸ªç®—æ³•ä¸»è¦çš„åŸºç‚¹å°±æ˜¯å°†æ’åˆ—ç»„åˆçš„æƒ…å†µåˆ†ä¸ºäº†æ‹¬å·å†…å’Œæ‹¬å·å¤–è¿™ä¸¤ç§æƒ…å†µï¼Œä¸”ä»…å­˜åœ¨ä¸¤ç§æƒ…å†µï¼è‡³äºä¸ºä»€ä¹ˆï¼ŒåŸå› åœ¨äºæ¥¼ä¸»çš„ç®—æ³•çš„å‰ææ˜¯å•ç‹¬æ‹¿å‡ºæ¥çš„æ‹¬å·Eçš„å·¦è¾¹åœ¨Nä¸ªæ‹¬å·æ‰€æœ‰æ’åˆ—ç»„åˆæƒ…å†µä¸­éƒ½æ˜¯å¤„äºæœ€å·¦è¾¹ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æ‹¬å·ä½äºæ‹¬å·Eçš„å·¦è¾¹çš„æƒ…å†µã€‚å› æ­¤ï¼ŒN-1ä¸ªæ‹¬å·ï¼ˆæ‹¿å‡ºäº†æ‹¬å·Eï¼‰ä»…å¯èƒ½åˆ†å¸ƒäºæ‹¬å·Eå†…å’Œæ‹¬å·Eå¤–ï¼Œåˆ†ä¸ºä¸¤ç§å­æƒ…å†µè®¨è®ºï¼ è¿™ç§æ€æƒ³è¿˜å¯ä»¥åº”ç”¨äºå…¶ä»–ç±»ä¼¼çš„é¢˜çš„æ±‚è§£ä¸­ï¼Œå³æ€æ ·åˆç†é«˜æ•ˆçš„åˆ©ç”¨å‰é¢æ­¥éª¤çš„è®¡ç®—ç»“æœå¾—å‡ºå½“å‰æ­¥éª¤ç»“æœï¼Œä»è€Œå¾—å‡ºæœ€ç»ˆç»“æœã€‚ é€’å½’åªæœ‰åœ¨æˆ‘ä»¬çŸ¥é“åºåˆ—ä»ç„¶ä¿æŒæœ‰æ•ˆæ—¶æ‰æ·»åŠ  â€˜(â€˜ or â€˜)â€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è·Ÿè¸ªåˆ°ç›®å‰ä¸ºæ­¢æ”¾ç½®çš„å·¦æ‹¬å·å’Œå³æ‹¬å·çš„æ•°ç›®æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬è¿˜å‰©ä¸€ä¸ªä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹æ”¾ä¸€ä¸ªå·¦æ‹¬å·ã€‚ å¦‚æœå®ƒä¸è¶…è¿‡å·¦æ‹¬å·çš„æ•°é‡ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾ä¸€ä¸ªå³æ‹¬å·ã€‚ ä»£ç å®ç°dp123456789101112131415161718192021222324252627class Solution &#123; public List&lt;String&gt; generateParenthesis(int n) &#123; // dp.get(i)è¡¨ç¤ºæˆ‘ä»¬è¦æ±‚çš„Listï¼Œdp.get(0)å³è¡¨ç¤ºç”±0ä¸ªæ‹¬å·ç»„æˆçš„å­—ç¬¦ä¸²çš„åˆ—è¡¨ List&lt;LinkedList&lt;String&gt;&gt; dp = new LinkedList&lt;&gt;(); if( n == 0) return dp.get(0); LinkedList&lt;String&gt; zero = new LinkedList&lt;&gt;(); zero.add(""); dp.add(zero); //è®¡ç®—dpæ•°ç»„çš„å€¼ for(int i = 1;i &lt;= n;i++)&#123; LinkedList&lt;String&gt; single = new LinkedList&lt;&gt;(); //æ¯ä¸ªdpçš„å€¼éƒ½æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„ for(int j = 0;j &lt; i;j++)&#123; LinkedList&lt;String&gt; str1 = dp.get(j); LinkedList&lt;String&gt; str2 = dp.get(i-j-1); for(String s1:str1)&#123; for(String s2:str2)&#123; String str = "(" + s1 + ")" + s2; single.add(str); &#125; &#125; &#125; dp.add(single); &#125; return dp.get(n); &#125;&#125; é€’å½’1234567891011121314151617181920212223/** * å‰ªæ + å›æº¯ * é€’å½’ä¸‰éƒ¨æ›² * 1ã€æ‰¾åˆ°é€’å½’å‡ºå£ï¼Œå½“å½“å‰å­—ç¬¦ä¸²çš„é•¿åº¦ä¸º2næ—¶ï¼Œå³è¯¥å­—ç¬¦ä¸²æ·»åŠ å®Œæˆ * 2ã€è¿”å›å€¼ï¼Œæ— éœ€è¿”å›ä»»ä½•ä¸œè¥¿ï¼Œåªéœ€è¦åœ¨æ¯æ¬¡é€’å½’å®Œæˆæ—¶å°†æ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²åŠ åˆ°è¦è¿”å›çš„åˆ—è¡¨å³å¯ * 3ã€ä¸€æ¬¡é€’å½’éœ€è¦åšçš„äº‹ï¼šå¦‚æœå·¦æ‹¬å·ï¼Œå°äºnï¼Œåˆ™éœ€è¦open+1ï¼Œå¦‚æœå³æ‹¬å·å°äºå·¦æ‹¬å·ï¼Œåˆ™éœ€è¦æ·»åŠ å³æ‹¬å· * @param n * @return */public static List&lt;String&gt; generateParenthesis(int n) &#123; List&lt;String&gt; res = new LinkedList&lt;&gt;(); backtrack(res,"",0,0, n); return res;&#125;public static void backtrack(List&lt;String&gt; ans, String cur, int open, int close, int max)&#123; if (cur.length() == max * 2) &#123; ans.add(cur); return; &#125; if (open &lt; max) backtrack(ans, cur+"(", open+1, close, max); if (close &lt; open) backtrack(ans, cur+")", open, close+1, max);&#125; 31. ä¸‹ä¸€ä¸ªæ’åˆ—é¢˜ç›®å®ç°è·å–ä¸‹ä¸€ä¸ªæ’åˆ—çš„å‡½æ•°ï¼Œç®—æ³•éœ€è¦å°†ç»™å®šæ•°å­—åºåˆ—é‡æ–°æ’åˆ—æˆå­—å…¸åºä¸­ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ’åˆ—ã€‚ å¦‚æœä¸å­˜åœ¨ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ’åˆ—ï¼Œåˆ™å°†æ•°å­—é‡æ–°æ’åˆ—æˆæœ€å°çš„æ’åˆ—ï¼ˆå³å‡åºæ’åˆ—ï¼‰ã€‚ å¿…é¡» åŸåœ° ä¿®æ”¹ï¼Œåªå…è®¸ä½¿ç”¨é¢å¤–å¸¸æ•°ç©ºé—´ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›ä¾‹å­ï¼Œè¾“å…¥ä½äºå·¦ä¾§åˆ—ï¼Œå…¶ç›¸åº”è¾“å‡ºä½äºå³ä¾§åˆ—ã€‚ 12341,2,3 â†’ 1,3,23,2,1 â†’ 1,2,31,1,5 â†’ 1,5,1158476531 -&gt; 158513467 æ€è·¯ ä»å³å‘å·¦ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªéå€’åºçš„æ•°å­—ï¼Œä¾‹å¦‚ä¸Šé¢çš„158476531ï¼Œä»å³å‘å·¦çš„ç¬¬ä¸€ä¸ªéå€’åºçš„æ•°å­—æ˜¯4 ç„¶åå†ä»å³å‘å·¦éå†ä¸€æ¬¡ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”4å¤§çš„æ•°ï¼Œè¿™é‡Œæ˜¯å³è¾¹æ•°ç¬¬ä¸‰ä¸ª 5ï¼Œäº¤æ¢ 4 å’Œ 5,æ•°å­—å˜ä¸º 158576431,è¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬è¦çš„ç­”æ¡ˆ ç„¶åå°† 5 åé¢çš„æ•°å­—ç¿»è½¬ï¼Œä¹Ÿå°±æ˜¯å°† 76431 ç¿»è½¬,äºæ˜¯æ•°å­—å˜ä¸º 158513467 ä»£ç å®ç°12345678910111213141516171819202122232425262728293031323334353637class Solution &#123; public void nextPermutation(int[] nums) &#123; int i = nums.length - 2; for(; i &gt;= 0; i--)&#123; if(nums[i] &lt; nums[i+1])&#123; break; &#125; &#125; if(i &gt;= 0)&#123; int j = nums.length -1; for(; j &gt; i; j--)&#123; if(nums[j] &gt; nums[i])&#123; break; &#125; &#125; swap(nums,i,j); &#125; reverse(nums,i+1); System.out.println(Arrays.toString(nums)); &#125; private void reverse(int[] nums, int start) &#123; int i = start, j = nums.length - 1; while (i &lt; j) &#123; swap(nums, i, j); i++; j--; &#125; &#125; private void swap(int[] nums, int i, int j) &#123; int temp = nums[i]; nums[i] = nums[j]; nums[j] = temp; &#125;&#125; 32. æœ€é•¿æœ‰æ•ˆæ‹¬å·é¢˜ç›®ç»™å®šä¸€ä¸ªåªåŒ…å« â€˜(â€˜ å’Œ â€˜)â€™ çš„å­—ç¬¦ä¸²ï¼Œæ‰¾å‡ºæœ€é•¿çš„åŒ…å«æœ‰æ•ˆæ‹¬å·çš„å­ä¸²çš„é•¿åº¦ã€‚ ç¤ºä¾‹ 1: 123è¾“å…¥: "(()"è¾“å‡º: 2è§£é‡Š: æœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²ä¸º "()" ç¤ºä¾‹ 2: 123è¾“å…¥: ")()())"è¾“å‡º: 4è§£é‡Š: æœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²ä¸º "()()" æ€è·¯ æ€è·¯ä¸€ï¼šæ ˆ + dp å‰æ–‡ç¬¬20é¢˜ æœ‰æ•ˆçš„æ‹¬å· ï¼Œå°±æ˜¯é‡‡ç”¨ æ ˆ å»åšçš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå¾ˆè‡ªç„¶çš„ä¹ŸåŒæ ·æ˜¯é‡‡ç”¨æ ˆå»åšï¼Œå‡¡æ˜¯ç¢°åˆ°äº†æ‹¬å·ï¼ŒåŸºæœ¬éƒ½æ˜¯ç”¨æ ˆå»åšå¤„ç†ï¼Œå› ä¸ºç¬¦åˆåè¿›å…ˆå‡ºçš„åŸåˆ™ã€‚ ç„¶ååˆæ˜¯å¯»æ‰¾å­ä¸²é•¿åº¦ï¼Œé‚£è‡ªç„¶æ˜¯è¦ç”¨åˆ°dpï¼Œæ•…é‡‡ç”¨çš„æ–¹æ³•å¾ˆæ˜æ˜¾å°±æ˜¯æ ˆ + dpã€‚ æ€è·¯äºŒï¼šæ ˆ ä¸æ‰¾åˆ°æ¯ä¸ªå¯èƒ½çš„å­å­—ç¬¦ä¸²åå†åˆ¤æ–­å®ƒçš„æœ‰æ•ˆæ€§ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ ˆåœ¨éå†ç»™å®šå­—ç¬¦ä¸²çš„è¿‡ç¨‹ä¸­å»åˆ¤æ–­åˆ°ç›®å‰ä¸ºæ­¢æ‰«æçš„å­å­—ç¬¦ä¸²çš„æœ‰æ•ˆæ€§ï¼ŒåŒæ—¶éƒ½æ˜¯æœ€é•¿æœ‰æ•ˆå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚æˆ‘ä»¬é¦–å…ˆå°† âˆ’1 æ”¾å…¥æ ˆé¡¶ã€‚å¯¹äºé‡åˆ°çš„æ¯ä¸ª â€˜(â€™ ï¼Œæˆ‘ä»¬å°†å®ƒçš„ä¸‹æ ‡æ”¾å…¥æ ˆä¸­ã€‚å¯¹äºé‡åˆ°çš„æ¯ä¸ª â€˜)â€™ ï¼Œæˆ‘ä»¬å¼¹å‡ºæ ˆé¡¶çš„å…ƒç´ å¹¶å°†å½“å‰å…ƒç´ çš„ä¸‹æ ‡ä¸å¼¹å‡ºå…ƒç´ ä¸‹æ ‡ä½œå·®ï¼Œå¾—å‡ºå½“å‰æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ç»§ç»­è®¡ç®—æœ‰æ•ˆå­å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¹¶æœ€ç»ˆè¿”å›æœ€é•¿æœ‰æ•ˆå­å­—ç¬¦ä¸²çš„é•¿åº¦ æˆ‘è®¤ä¸ºè¿™ç§æ€è·¯æœ€ç²¾å¦™çš„åœ°æ–¹åœ¨äºä»–æå‰å‹æ ˆäº†-1ï¼Œè¿™æ˜¯è¿™ä¸ªæ–¹æ³•æœ€å¦™çš„åœ°æ–¹ï¼Œè€Œåœ¨éå†å…ƒç´ æ—¶ï¼Œæ¯æ¬¡éƒ½ä¼šæœ‰å‹æ ˆæˆ–è€…å¼¹æ ˆçš„æ“ä½œï¼Œè¿™æ ·å°±èƒ½çŸ¥é“æœ€é•¿æœ‰æ•ˆå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå› ä¸ºä¸€æ—¦ä¸æ˜¯æœ‰æ•ˆå­—ç¬¦ä¸²äº†ï¼Œæ ˆå°±ä¼šå˜ç©ºï¼Œä¸‹ä¸€ä¸ªå¡«å…¥çš„ä¸€å®šæ˜¯æœ‰æ•ˆå­—ç¬¦ä¸²çš„å‰ä¸€ä½â€¦ä¸è¿‡æˆ‘è¿˜æ˜¯è§‰å¾—æˆ‘çš„æ–¹æ³•æ›´å®¹æ˜“è®©äººç†è§£ï¼Œè¿™ä¸ªæ–¹æ³•åªèƒ½æ¬£èµäº†ã€‚ ä½œè€…ï¼šLeetCodeé“¾æ¥ï¼šhttps://leetcode-cn.com/problems/longest-valid-parentheses/solution/zui-chang-you-xiao-gua-hao-by-leetcode/æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ ä»£ç  æ€è·¯ä¸€ 1234567891011121314151617181920212223242526272829class Solution &#123; public int longestValidParentheses(String s) &#123; Stack&lt;Integer&gt; stack=new Stack&lt;Integer&gt;(); int max = 0; // ä¿å­˜ä¸Šä¸€ä¸ªæœ‰æ•ˆæ‹¬å·çš„é•¿åº¦ int last_num; int[] num = new int[s.length()+1]; boolean[] dp = new boolean[s.length()+1]; for(int i = 0;i &lt; s.length();i++)&#123; if(s.charAt(i) == '(')&#123; stack.push(i); &#125; else if(!stack.isEmpty() &amp;&amp; s.charAt(i) == ')')&#123; //è¿™é‡Œçš„æ˜¯iæ˜¯ä»0å¼€å§‹çš„ï¼Œæ‰€ä»¥è¿™å…¶å®æ˜¯ç¬¬ i+1 ä¸ªæ•° dp[i+1] = true; //å¦‚æœå–å‡ºæ¥çš„æ•°å¯¹åº”çš„ç´¢å¼•çš„å‰ä¸€ä½ä¹Ÿæ˜¯æœ‰æ•ˆæ‹¬å·ï¼Œæ³¨æ„å“¦ï¼Œè¿™é‡Œçš„dpæ˜¯ä»1å¼€å§‹çš„ï¼ // æ‰€ä»¥ä¸ç”¨å‡1äº†ï¼Œç›´æ¥å°±æ˜¯dp[stack.peek()],numæ•°ç»„åŒç† // dpæ•°ç»„å’Œnumæ•°ç»„ï¼Œç´¢å¼•å€¼ä¸º i+1 if(dp[stack.peek()] == true)&#123; last_num = num[stack.peek()]; &#125; else last_num = 0; num[i+1] = i - stack.pop() + 1 + last_num; max = Math.max(max,num[i+1]); &#125; &#125; return max; &#125;&#125; æ€è·¯äºŒ ã€ç²¾å¦™æ— æ¯”ï¼Œé€‚å½“è®°å¿†ã€‘ 123456789101112131415161718192021public class Solution &#123; public int longestValidParentheses(String s) &#123; int maxans = 0; Stack&lt;Integer&gt; stack = new Stack&lt;&gt;(); stack.push(-1); for (int i = 0; i &lt; s.length(); i++) &#123; if (s.charAt(i) == '(') &#123; stack.push(i); &#125; else &#123; stack.pop(); if (stack.empty()) &#123; stack.push(i); &#125; else &#123; maxans = Math.max(maxans, i - stack.peek()); &#125; &#125; &#125; return maxans; &#125;&#125; 5152. å°†çŸ©é˜µæŒ‰å¯¹è§’çº¿æ’åºé¢˜ç›®ç»™ä½ ä¸€ä¸ª m * n çš„æ•´æ•°çŸ©é˜µ mat ï¼Œè¯·ä½ å°†åŒä¸€æ¡å¯¹è§’çº¿ä¸Šçš„å…ƒç´ ï¼ˆä»å·¦ä¸Šåˆ°å³ä¸‹ï¼‰æŒ‰å‡åºæ’åºåï¼Œè¿”å›æ’å¥½åºçš„çŸ©é˜µã€‚ ç¤ºä¾‹ 1ï¼š 12è¾“å…¥ï¼šmat = [[3,3,1,1],[2,2,1,2],[1,1,1,2]]è¾“å‡ºï¼š[[1,1,1,1],[1,2,2,2],[1,2,3,3]] æ€è·¯ ä½¿ç”¨çš„æ˜¯ Nçš‡å é—®é¢˜çš„ç¼–ç æŠ€å·§ï¼šä¸»å¯¹è§’çº¿ä¸Šå…ƒç´ çš„ç‰¹ç‚¹æ˜¯ï¼šçºµåæ ‡ - æ¨ªåæ ‡ = å®šå€¼ ã€éš¾ç‚¹ã€‘ ä¸ºäº†èƒ½å¤Ÿæ”¾è¿›æ•°ç»„ä¸­ï¼ŒåŠ ä¸Šåç§» m - 1 ã€‚ã€éš¾ç‚¹ã€‘ ä¸¤æ¬¡éå†ï¼šç¬¬ä¸€æ¬¡éå†æŠŠæ•°æ®æ‹·è´åˆ°å¯¹è§’çº¿æ•°ç»„ä¸­ï¼Œç„¶åæ’åºï¼›ç¬¬äºŒæ¬¡éå†æŠŠå¯¹è§’çº¿æ•°ç»„å†™å›åŸå§‹æ•°ç»„ï¼ˆæˆ–è€…æ–°å¼€ä¸€ä¸ªæ•°ç»„ï¼‰å‡å¯ã€‚ ä½œè€…ï¼šliweiwei1419é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/sort-the-matrix-diagonally/solution/bao-li-jie-fa-by-liweiwei1419/æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰ ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051import java.util.ArrayList;import java.util.Arrays;import java.util.Collections;public class Solution &#123; public int[][] diagonalSort(int[][] mat) &#123; // è¡Œæ•° int m = mat.length; // åˆ—æ•° int n = mat[0].length; // ä¸»å¯¹è§’çº¿çš„æ¡æ•° int dLen = m + n - 1; // æ¯ä¸€æ¡å¯¹è§’çº¿éƒ½åˆ›å»ºä¸€ä¸ªåŠ¨æ€æ•°ç»„ ArrayList&lt;Integer&gt;[] diagonal = new ArrayList[dLen]; for (int i = 0; i &lt; dLen; i++) &#123; diagonal[i] = new ArrayList&lt;&gt;(m); &#125; // éå†åŸå§‹çŸ©é˜µï¼ŒæŠŠåŸå§‹çŸ©é˜µä¸­çš„å…ƒç´ æ”¾è¿›å¯¹åº”çš„åŠ¨æ€æ•°ç»„ä¸­ // ä¸»å¯¹è§’çº¿ä¸Šå…ƒç´ çš„ç‰¹ç‚¹æ˜¯ï¼šçºµåæ ‡ - æ¨ªåæ ‡ = å®šå€¼ // åŠ ä¸Šåç§» m - 1 æ˜¯ä¸ºäº†èƒ½å¤Ÿæ”¾è¿›æ•°ç»„ä¸­ for (int i = 0; i &lt; m; i++) &#123; for (int j = 0; j &lt; n; j++) &#123; diagonal[j - i + (m - 1)].add(mat[i][j]); &#125; &#125; // å¯¹æ¯ä¸€ä¸ªå¯¹è§’çº¿ä¸Šçš„åŠ¨æ€æ•°ç»„åˆ†åˆ«è¿›è¡Œå‡åºæ’åº for (int i = 0; i &lt; dLen; i++) &#123; Collections.sort(diagonal[i]); &#125; int[][] res = new int[m][n]; // å¯¹è§’çº¿æ•°ç»„ä¸Šè¿˜æœªå–å‡ºçš„å…ƒç´ çš„ä¸‹æ ‡ï¼Œåˆå§‹åŒ–çš„æ—¶å€™å‡ä¸º 0 int[] next = new int[dLen]; for (int i = 0; i &lt; m; i++) &#123; for (int j = 0; j &lt; n; j++) &#123; // å¯¹è§’çº¿çš„åæ ‡ int index = j - i + (m - 1); // è®°å½•ç»“æœ res[i][j] = diagonal[index].get(next[index]); // ç»´æŠ¤ next æ•°ç»„çš„å€¼ next[index]++; &#125; &#125; return res; &#125;&#125; ä½œè€…ï¼šliweiwei1419é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/sort-the-matrix-diagonally/solution/bao-li-jie-fa-by-liweiwei1419/æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ 51. Nçš‡åå›æº¯ç®—æ³•è¿™ç¯‡æ–‡ç« æ˜¯å¾ˆä¹…ä¹‹å‰çš„ä¸€ç¯‡ã€Šå›æº¯ç®—æ³•è¯¦è§£ã€‹çš„è¿›é˜¶ç‰ˆï¼Œä¹‹å‰é‚£ç¯‡ä¸å¤Ÿæ¸…æ¥šï¼Œå°±ä¸å¿…çœ‹äº†ï¼Œçœ‹è¿™ç¯‡å°±è¡Œã€‚æŠŠæ¡†æ¶ç»™ä½ è®²æ¸…æ¥šï¼Œä½ ä¼šå‘ç°å›æº¯ç®—æ³•é—®é¢˜éƒ½æ˜¯ä¸€ä¸ªå¥—è·¯ã€‚ åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šå›æº¯ç®—æ³•æ¡†æ¶ã€‚è§£å†³ä¸€ä¸ªå›æº¯é—®é¢˜ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå†³ç­–æ ‘çš„éå†è¿‡ç¨‹ã€‚ä½ åªéœ€è¦æ€è€ƒ 3 ä¸ªé—®é¢˜ï¼š 1ã€è·¯å¾„ï¼šä¹Ÿå°±æ˜¯å·²ç»åšå‡ºçš„é€‰æ‹©ã€‚ 2ã€é€‰æ‹©åˆ—è¡¨ï¼šä¹Ÿå°±æ˜¯ä½ å½“å‰å¯ä»¥åšçš„é€‰æ‹©ã€‚ 3ã€ç»“æŸæ¡ä»¶ï¼šä¹Ÿå°±æ˜¯åˆ°è¾¾å†³ç­–æ ‘åº•å±‚ï¼Œæ— æ³•å†åšé€‰æ‹©çš„æ¡ä»¶ã€‚ å¦‚æœä½ ä¸ç†è§£è¿™ä¸‰ä¸ªè¯è¯­çš„è§£é‡Šï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬åé¢ä¼šç”¨ã€Œå…¨æ’åˆ—ã€å’Œã€ŒN çš‡åé—®é¢˜ã€è¿™ä¸¤ä¸ªç»å…¸çš„å›æº¯ç®—æ³•é—®é¢˜æ¥å¸®ä½ ç†è§£è¿™äº›è¯è¯­æ˜¯ä»€ä¹ˆæ„æ€ï¼Œç°åœ¨ä½ å…ˆç•™ç€å°è±¡ã€‚ ä»£ç æ–¹é¢ï¼Œå›æº¯ç®—æ³•çš„æ¡†æ¶ï¼š 12345678910result = []def backtrack(è·¯å¾„, é€‰æ‹©åˆ—è¡¨): if æ»¡è¶³ç»“æŸæ¡ä»¶: result.add(è·¯å¾„) returnfor é€‰æ‹© in é€‰æ‹©åˆ—è¡¨: åšé€‰æ‹© backtrack(è·¯å¾„, é€‰æ‹©åˆ—è¡¨) æ’¤é”€é€‰æ‹© å…¶æ ¸å¿ƒå°±æ˜¯ for å¾ªç¯é‡Œé¢çš„é€’å½’ï¼Œåœ¨é€’å½’è°ƒç”¨ä¹‹å‰ã€Œåšé€‰æ‹©ã€ï¼Œåœ¨é€’å½’è°ƒç”¨ä¹‹åã€Œæ’¤é”€é€‰æ‹©ã€ï¼Œç‰¹åˆ«ç®€å•ã€‚ ä»€ä¹ˆå«åšé€‰æ‹©å’Œæ’¤é”€é€‰æ‹©å‘¢ï¼Œè¿™ä¸ªæ¡†æ¶çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬å°±é€šè¿‡ã€Œå…¨æ’åˆ—ã€è¿™ä¸ªé—®é¢˜æ¥è§£å¼€ä¹‹å‰çš„ç–‘æƒ‘ï¼Œè¯¦ç»†æ¢ç©¶ä¸€ä¸‹å…¶ä¸­çš„å¥¥å¦™ï¼ ä¸€ã€å…¨æ’åˆ—é—®é¢˜æˆ‘ä»¬åœ¨é«˜ä¸­çš„æ—¶å€™å°±åšè¿‡æ’åˆ—ç»„åˆçš„æ•°å­¦é¢˜ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“ n ä¸ªä¸é‡å¤çš„æ•°ï¼Œå…¨æ’åˆ—å…±æœ‰ n! ä¸ªã€‚ PSï¼šä¸ºäº†ç®€å•æ¸…æ™°èµ·è§ï¼Œæˆ‘ä»¬è¿™æ¬¡è®¨è®ºçš„å…¨æ’åˆ—é—®é¢˜ä¸åŒ…å«é‡å¤çš„æ•°å­—ã€‚ é‚£ä¹ˆæˆ‘ä»¬å½“æ—¶æ˜¯æ€ä¹ˆç©·ä¸¾å…¨æ’åˆ—çš„å‘¢ï¼Ÿæ¯”æ–¹è¯´ç»™ä¸‰ä¸ªæ•° [1,2,3]ï¼Œä½ è‚¯å®šä¸ä¼šæ— è§„å¾‹åœ°ä¹±ç©·ä¸¾ï¼Œä¸€èˆ¬æ˜¯è¿™æ ·ï¼š å…ˆå›ºå®šç¬¬ä¸€ä½ä¸º 1ï¼Œç„¶åç¬¬äºŒä½å¯ä»¥æ˜¯ 2ï¼Œé‚£ä¹ˆç¬¬ä¸‰ä½åªèƒ½æ˜¯ 3ï¼›ç„¶åå¯ä»¥æŠŠç¬¬äºŒä½å˜æˆ 3ï¼Œç¬¬ä¸‰ä½å°±åªèƒ½æ˜¯ 2 äº†ï¼›ç„¶åå°±åªèƒ½å˜åŒ–ç¬¬ä¸€ä½ï¼Œå˜æˆ 2ï¼Œç„¶åå†ç©·ä¸¾åä¸¤ä½â€¦â€¦ å…¶å®è¿™å°±æ˜¯å›æº¯ç®—æ³•ï¼Œæˆ‘ä»¬é«˜ä¸­æ— å¸ˆè‡ªé€šå°±ä¼šç”¨ï¼Œæˆ–è€…æœ‰çš„åŒå­¦ç›´æ¥ç”»å‡ºå¦‚ä¸‹è¿™æ£µå›æº¯æ ‘ï¼š åªè¦ä»æ ¹éå†è¿™æ£µæ ‘ï¼Œè®°å½•è·¯å¾„ä¸Šçš„æ•°å­—ï¼Œå…¶å®å°±æ˜¯æ‰€æœ‰çš„å…¨æ’åˆ—ã€‚æˆ‘ä»¬ä¸å¦¨æŠŠè¿™æ£µæ ‘ç§°ä¸ºå›æº¯ç®—æ³•çš„ã€Œå†³ç­–æ ‘ã€ã€‚ ä¸ºå•¥è¯´è¿™æ˜¯å†³ç­–æ ‘å‘¢ï¼Œå› ä¸ºä½ åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå…¶å®éƒ½åœ¨åšå†³ç­–ã€‚æ¯”å¦‚è¯´ä½ ç«™åœ¨ä¸‹å›¾çš„çº¢è‰²èŠ‚ç‚¹ä¸Šï¼š ä½ ç°åœ¨å°±åœ¨åšå†³ç­–ï¼Œå¯ä»¥é€‰æ‹© 1 é‚£æ¡æ ‘æï¼Œä¹Ÿå¯ä»¥é€‰æ‹© 3 é‚£æ¡æ ‘æã€‚ä¸ºå•¥åªèƒ½åœ¨ 1 å’Œ 3 ä¹‹ä¸­é€‰æ‹©å‘¢ï¼Ÿå› ä¸º 2 è¿™ä¸ªæ ‘æåœ¨ä½ èº«åï¼Œè¿™ä¸ªé€‰æ‹©ä½ ä¹‹å‰åšè¿‡äº†ï¼Œè€Œå…¨æ’åˆ—æ˜¯ä¸å…è®¸é‡å¤ä½¿ç”¨æ•°å­—çš„ã€‚ ç°åœ¨å¯ä»¥è§£ç­”å¼€å¤´çš„å‡ ä¸ªåè¯ï¼š[2] å°±æ˜¯ã€Œè·¯å¾„ã€ï¼Œè®°å½•ä½ å·²ç»åšè¿‡çš„é€‰æ‹©ï¼›[1,3] å°±æ˜¯ã€Œé€‰æ‹©åˆ—è¡¨ã€ï¼Œè¡¨ç¤ºä½ å½“å‰å¯ä»¥åšå‡ºçš„é€‰æ‹©ï¼›ã€Œç»“æŸæ¡ä»¶ã€å°±æ˜¯éå†åˆ°æ ‘çš„åº•å±‚ï¼Œåœ¨è¿™é‡Œå°±æ˜¯é€‰æ‹©åˆ—è¡¨ä¸ºç©ºçš„æ—¶å€™ã€‚ å¦‚æœæ˜ç™½äº†è¿™å‡ ä¸ªåè¯ï¼Œå¯ä»¥æŠŠã€Œè·¯å¾„ã€å’Œã€Œé€‰æ‹©ã€åˆ—è¡¨ä½œä¸ºå†³ç­–æ ‘ä¸Šæ¯ä¸ªèŠ‚ç‚¹çš„å±æ€§ï¼Œæ¯”å¦‚ä¸‹å›¾åˆ—å‡ºäº†å‡ ä¸ªèŠ‚ç‚¹çš„å±æ€§ï¼š æˆ‘ä»¬å®šä¹‰çš„ backtrack å‡½æ•°å…¶å®å°±åƒä¸€ä¸ªæŒ‡é’ˆï¼Œåœ¨è¿™æ£µæ ‘ä¸Šæ¸¸èµ°ï¼ŒåŒæ—¶è¦æ­£ç¡®ç»´æŠ¤æ¯ä¸ªèŠ‚ç‚¹çš„å±æ€§ï¼Œæ¯å½“èµ°åˆ°æ ‘çš„åº•å±‚ï¼Œå…¶ã€Œè·¯å¾„ã€å°±æ˜¯ä¸€ä¸ªå…¨æ’åˆ—ã€‚ å†è¿›ä¸€æ­¥ï¼Œå¦‚ä½•éå†ä¸€æ£µæ ‘ï¼Ÿè¿™ä¸ªåº”è¯¥ä¸éš¾å§ã€‚å›å¿†ä¸€ä¸‹ä¹‹å‰ã€Œå­¦ä¹ æ•°æ®ç»“æ„çš„æ¡†æ¶æ€ç»´ã€å†™è¿‡ï¼Œå„ç§æœç´¢é—®é¢˜å…¶å®éƒ½æ˜¯æ ‘çš„éå†é—®é¢˜ï¼Œè€Œå¤šå‰æ ‘çš„éå†æ¡†æ¶å°±æ˜¯è¿™æ ·ï¼š 123456void traverse(TreeNode root) &#123; for (TreeNode child : root.childern) // å‰åºéå†éœ€è¦çš„æ“ä½œ traverse(child); // ååºéå†éœ€è¦çš„æ“ä½œ&#125; è€Œæ‰€è°“çš„å‰åºéå†å’Œååºéå†ï¼Œä»–ä»¬åªæ˜¯ä¸¤ä¸ªå¾ˆæœ‰ç”¨çš„æ—¶é—´ç‚¹ï¼Œæˆ‘ç»™ä½ ç”»å¼ å›¾ä½ å°±æ˜ç™½äº†ï¼š å‰åºéå†çš„ä»£ç åœ¨è¿›å…¥æŸä¸€ä¸ªèŠ‚ç‚¹ä¹‹å‰çš„é‚£ä¸ªæ—¶é—´ç‚¹æ‰§è¡Œï¼Œååºéå†ä»£ç åœ¨ç¦»å¼€æŸä¸ªèŠ‚ç‚¹ä¹‹åçš„é‚£ä¸ªæ—¶é—´ç‚¹æ‰§è¡Œã€‚ å›æƒ³æˆ‘ä»¬åˆšæ‰è¯´çš„ï¼Œã€Œè·¯å¾„ã€å’Œã€Œé€‰æ‹©ã€æ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„å±æ€§ï¼Œå‡½æ•°åœ¨æ ‘ä¸Šæ¸¸èµ°è¦æ­£ç¡®ç»´æŠ¤èŠ‚ç‚¹çš„å±æ€§ï¼Œé‚£ä¹ˆå°±è¦åœ¨è¿™ä¸¤ä¸ªç‰¹æ®Šæ—¶é—´ç‚¹æç‚¹åŠ¨ä½œï¼š ç°åœ¨ï¼Œä½ æ˜¯å¦ç†è§£äº†å›æº¯ç®—æ³•çš„è¿™æ®µæ ¸å¿ƒæ¡†æ¶ï¼Ÿ 12345678for é€‰æ‹© in é€‰æ‹©åˆ—è¡¨: # åšé€‰æ‹© å°†è¯¥é€‰æ‹©ä»é€‰æ‹©åˆ—è¡¨ç§»é™¤ è·¯å¾„.add(é€‰æ‹©) backtrack(è·¯å¾„, é€‰æ‹©åˆ—è¡¨) # æ’¤é”€é€‰æ‹© è·¯å¾„.remove(é€‰æ‹©) å°†è¯¥é€‰æ‹©å†åŠ å…¥é€‰æ‹©åˆ—è¡¨ æˆ‘ä»¬åªè¦åœ¨é€’å½’ä¹‹å‰åšå‡ºé€‰æ‹©ï¼Œåœ¨é€’å½’ä¹‹åæ’¤é”€åˆšæ‰çš„é€‰æ‹©ï¼Œå°±èƒ½æ­£ç¡®å¾—åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„é€‰æ‹©åˆ—è¡¨å’Œè·¯å¾„ã€‚ ä¸‹é¢ï¼Œç›´æ¥çœ‹å…¨æ’åˆ—ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132List&lt;List&lt;Integer&gt;&gt; res = new LinkedList&lt;&gt;();/* ä¸»å‡½æ•°ï¼Œè¾“å…¥ä¸€ç»„ä¸é‡å¤çš„æ•°å­—ï¼Œè¿”å›å®ƒä»¬çš„å…¨æ’åˆ— */List&lt;List&lt;Integer&gt;&gt; permute(int[] nums) &#123; // è®°å½•ã€Œè·¯å¾„ã€ LinkedList&lt;Integer&gt; track = new LinkedList&lt;&gt;(); backtrack(nums, track); return res;&#125;// è·¯å¾„ï¼šè®°å½•åœ¨ track ä¸­// é€‰æ‹©åˆ—è¡¨ï¼šnums ä¸­ä¸å­˜åœ¨äº track çš„é‚£äº›å…ƒç´ // ç»“æŸæ¡ä»¶ï¼šnums ä¸­çš„å…ƒç´ å…¨éƒ½åœ¨ track ä¸­å‡ºç°void backtrack(int[] nums, LinkedList&lt;Integer&gt; track) &#123; // è§¦å‘ç»“æŸæ¡ä»¶ if (track.size() == nums.length) &#123; res.add(new LinkedList(track)); return; &#125; for (int i = 0; i &lt; nums.length; i++) &#123; // æ’é™¤ä¸åˆæ³•çš„é€‰æ‹© if (track.contains(nums[i])) continue; // åšé€‰æ‹© track.add(nums[i]); // è¿›å…¥ä¸‹ä¸€å±‚å†³ç­–æ ‘ backtrack(nums, track); // å–æ¶ˆé€‰æ‹© track.removeLast(); &#125;&#125; æˆ‘ä»¬è¿™é‡Œç¨å¾®åšäº†äº›å˜é€šï¼Œæ²¡æœ‰æ˜¾å¼è®°å½•ã€Œé€‰æ‹©åˆ—è¡¨ã€ï¼Œè€Œæ˜¯é€šè¿‡ nums å’Œ track æ¨å¯¼å‡ºå½“å‰çš„é€‰æ‹©åˆ—è¡¨ï¼š è‡³æ­¤ï¼Œæˆ‘ä»¬å°±é€šè¿‡å…¨æ’åˆ—é—®é¢˜è¯¦è§£äº†å›æº¯ç®—æ³•çš„åº•å±‚åŸç†ã€‚å½“ç„¶ï¼Œè¿™ä¸ªç®—æ³•è§£å†³å…¨æ’åˆ—ä¸æ˜¯å¾ˆé«˜æ•ˆï¼Œåº”ä¸ºå¯¹é“¾è¡¨ä½¿ç”¨ contains æ–¹æ³•éœ€è¦ O(N) çš„æ—¶é—´å¤æ‚åº¦ã€‚æœ‰æ›´å¥½çš„æ–¹æ³•é€šè¿‡äº¤æ¢å…ƒç´ è¾¾åˆ°ç›®çš„ï¼Œä½†æ˜¯éš¾ç†è§£ä¸€äº›ï¼Œè¿™é‡Œå°±ä¸å†™äº†ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªè¡Œæœç´¢ä¸€ä¸‹ã€‚ ä½†æ˜¯å¿…é¡»è¯´æ˜çš„æ˜¯ï¼Œä¸ç®¡æ€ä¹ˆä¼˜åŒ–ï¼Œéƒ½ç¬¦åˆå›æº¯æ¡†æ¶ï¼Œè€Œä¸”æ—¶é—´å¤æ‚åº¦éƒ½ä¸å¯èƒ½ä½äº O(N!)ï¼Œå› ä¸ºç©·ä¸¾æ•´æ£µå†³ç­–æ ‘æ˜¯æ— æ³•é¿å…çš„ã€‚è¿™ä¹Ÿæ˜¯å›æº¯ç®—æ³•çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œä¸åƒåŠ¨æ€è§„åˆ’å­˜åœ¨é‡å å­é—®é¢˜å¯ä»¥ä¼˜åŒ–ï¼Œå›æº¯ç®—æ³•å°±æ˜¯çº¯æš´åŠ›ç©·ä¸¾ï¼Œå¤æ‚åº¦ä¸€èˆ¬éƒ½å¾ˆé«˜ã€‚ æ˜ç™½äº†å…¨æ’åˆ—é—®é¢˜ï¼Œå°±å¯ä»¥ç›´æ¥å¥—å›æº¯ç®—æ³•æ¡†æ¶äº†ï¼Œä¸‹é¢ç®€å•çœ‹çœ‹ N çš‡åé—®é¢˜ã€‚ äºŒã€N çš‡åé—®é¢˜è¿™ä¸ªé—®é¢˜å¾ˆç»å…¸äº†ï¼Œç®€å•è§£é‡Šä¸€ä¸‹ï¼šç»™ä½ ä¸€ä¸ª NÃ—N çš„æ£‹ç›˜ï¼Œè®©ä½ æ”¾ç½® N ä¸ªçš‡åï¼Œä½¿å¾—å®ƒä»¬ä¸èƒ½äº’ç›¸æ”»å‡»ã€‚ PSï¼šçš‡åå¯ä»¥æ”»å‡»åŒä¸€è¡Œã€åŒä¸€åˆ—ã€å·¦ä¸Šå·¦ä¸‹å³ä¸Šå³ä¸‹å››ä¸ªæ–¹å‘çš„ä»»æ„å•ä½ã€‚ è¿™ä¸ªé—®é¢˜æœ¬è´¨ä¸Šè·Ÿå…¨æ’åˆ—é—®é¢˜å·®ä¸å¤šï¼Œå†³ç­–æ ‘çš„æ¯ä¸€å±‚è¡¨ç¤ºæ£‹ç›˜ä¸Šçš„æ¯ä¸€è¡Œï¼›æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥åšå‡ºçš„é€‰æ‹©æ˜¯ï¼Œåœ¨è¯¥è¡Œçš„ä»»æ„ä¸€åˆ—æ”¾ç½®ä¸€ä¸ªçš‡åã€‚ ç›´æ¥å¥—ç”¨æ¡†æ¶: 123456789101112131415161718192021222324252627282930313233vector&lt;vector&lt;string&gt;&gt; res;/* è¾“å…¥æ£‹ç›˜è¾¹é•¿ nï¼Œè¿”å›æ‰€æœ‰åˆæ³•çš„æ”¾ç½® */vector&lt;vector&lt;string&gt;&gt; solveNQueens(int n) &#123; // '.' è¡¨ç¤ºç©ºï¼Œ'Q' è¡¨ç¤ºçš‡åï¼Œåˆå§‹åŒ–ç©ºæ£‹ç›˜ã€‚ vector&lt;string&gt; board(n, string(n, '.')); backtrack(board, 0); return res;&#125;// è·¯å¾„ï¼šboard ä¸­å°äº row çš„é‚£äº›è¡Œéƒ½å·²ç»æˆåŠŸæ”¾ç½®äº†çš‡å// é€‰æ‹©åˆ—è¡¨ï¼šç¬¬ row è¡Œçš„æ‰€æœ‰åˆ—éƒ½æ˜¯æ”¾ç½®çš‡åçš„é€‰æ‹©// ç»“æŸæ¡ä»¶ï¼šrow è¶…è¿‡ board çš„æœ€åä¸€è¡Œvoid backtrack(vector&lt;string&gt;&amp; board, int row) &#123; // è§¦å‘ç»“æŸæ¡ä»¶ if (row == board.size()) &#123; res.push_back(board); return; &#125; int n = board[row].size(); for (int col = 0; col &lt; n; col++) &#123; // æ’é™¤ä¸åˆæ³•é€‰æ‹© if (!isValid(board, row, col)) continue; // åšé€‰æ‹© board[row][col] = 'Q'; // è¿›å…¥ä¸‹ä¸€è¡Œå†³ç­– backtrack(board, row + 1); // æ’¤é”€é€‰æ‹© board[row][col] = '.'; &#125;&#125; è¿™éƒ¨åˆ†ä¸»è¦ä»£ç ï¼Œå…¶å®è·Ÿå…¨æ’åˆ—é—®é¢˜å·®ä¸å¤šï¼ŒisValid å‡½æ•°çš„å®ç°ä¹Ÿå¾ˆç®€å•ï¼š 12345678910111213141516171819202122/* æ˜¯å¦å¯ä»¥åœ¨ board[row][col] æ”¾ç½®çš‡åï¼Ÿ */bool isValid(vector&lt;string&gt;&amp; board, int row, int col) &#123; int n = board.size(); // æ£€æŸ¥åˆ—æ˜¯å¦æœ‰çš‡åäº’ç›¸å†²çª for (int i = 0; i &lt; n; i++) &#123; if (board[i][col] == 'Q') return false; &#125; // æ£€æŸ¥å³ä¸Šæ–¹æ˜¯å¦æœ‰çš‡åäº’ç›¸å†²çª for (int i = row - 1, j = col + 1; i &gt;= 0 &amp;&amp; j &lt; n; i--, j++) &#123; if (board[i][j] == 'Q') return false; &#125; // æ£€æŸ¥å·¦ä¸Šæ–¹æ˜¯å¦æœ‰çš‡åäº’ç›¸å†²çª for (int i = row - 1, j = col - 1; i &gt;= 0 &amp;&amp; j &gt;= 0; i--, j--) &#123; if (board[i][j] == 'Q') return false; &#125; return true;&#125; å‡½æ•° backtrack ä¾ç„¶åƒä¸ªåœ¨å†³ç­–æ ‘ä¸Šæ¸¸èµ°çš„æŒ‡é’ˆï¼Œé€šè¿‡ row å’Œ col å°±å¯ä»¥è¡¨ç¤ºå‡½æ•°éå†åˆ°çš„ä½ç½®ï¼Œé€šè¿‡ isValid å‡½æ•°å¯ä»¥å°†ä¸ç¬¦åˆæ¡ä»¶çš„æƒ…å†µå‰ªæï¼š å¦‚æœç›´æ¥ç»™ä½ è¿™ä¹ˆä¸€å¤§æ®µè§£æ³•ä»£ç ï¼Œå¯èƒ½æ˜¯æ‡µé€¼çš„ã€‚ä½†æ˜¯ç°åœ¨æ˜ç™½äº†å›æº¯ç®—æ³•çš„æ¡†æ¶å¥—è·¯ï¼Œè¿˜æœ‰å•¥éš¾ç†è§£çš„å‘¢ï¼Ÿæ— éæ˜¯æ”¹æ”¹åšé€‰æ‹©çš„æ–¹å¼ï¼Œæ’é™¤ä¸åˆæ³•é€‰æ‹©çš„æ–¹å¼è€Œå·²ï¼Œåªè¦æ¡†æ¶å­˜äºå¿ƒï¼Œä½ é¢å¯¹çš„åªå‰©ä¸‹å°é—®é¢˜äº†ã€‚ å½“ N = 8 æ—¶ï¼Œå°±æ˜¯å…«çš‡åé—®é¢˜ï¼Œæ•°å­¦å¤§ä½¬é«˜æ–¯ç©·å°½ä¸€ç”Ÿéƒ½æ²¡æœ‰æ•°æ¸…æ¥šå…«çš‡åé—®é¢˜åˆ°åº•æœ‰å‡ ç§å¯èƒ½çš„æ”¾ç½®æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ç®—æ³•åªéœ€è¦ä¸€ç§’å°±å¯ä»¥ç®—å‡ºæ¥æ‰€æœ‰å¯èƒ½çš„ç»“æœã€‚ ä¸è¿‡çœŸçš„ä¸æ€ªé«˜æ–¯ã€‚è¿™ä¸ªé—®é¢˜çš„å¤æ‚åº¦ç¡®å®éå¸¸é«˜ï¼Œçœ‹çœ‹æˆ‘ä»¬çš„å†³ç­–æ ‘ï¼Œè™½ç„¶æœ‰ isValid å‡½æ•°å‰ªæï¼Œä½†æ˜¯æœ€åæ—¶é—´å¤æ‚åº¦ä»ç„¶æ˜¯ O(N^(N+1))ï¼Œè€Œä¸”æ— æ³•ä¼˜åŒ–ã€‚å¦‚æœ N = 10 çš„æ—¶å€™ï¼Œè®¡ç®—å°±å·²ç»å¾ˆè€—æ—¶äº†ã€‚ æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³å¾—åˆ°æ‰€æœ‰åˆæ³•çš„ç­”æ¡ˆï¼Œåªæƒ³è¦ä¸€ä¸ªç­”æ¡ˆï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿæ¯”å¦‚è§£æ•°ç‹¬çš„ç®—æ³•ï¼Œæ‰¾æ‰€æœ‰è§£æ³•å¤æ‚åº¦å¤ªé«˜ï¼Œåªè¦æ‰¾åˆ°ä¸€ç§è§£æ³•å°±å¯ä»¥ã€‚ å…¶å®ç‰¹åˆ«ç®€å•ï¼Œåªè¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å›æº¯ç®—æ³•çš„ä»£ç å³å¯ï¼š 1234567891011121314151617181920// å‡½æ•°æ‰¾åˆ°ä¸€ä¸ªç­”æ¡ˆåå°±è¿”å› truebool backtrack(vector&lt;string&gt;&amp; board, int row) &#123; // è§¦å‘ç»“æŸæ¡ä»¶ if (row == board.size()) &#123; res.push_back(board); return true; &#125; ... for (int col = 0; col &lt; n; col++) &#123; ... board[row][col] = 'Q'; if (backtrack(board, row + 1)) return true; board[row][col] = '.'; &#125; return false;&#125; è¿™æ ·ä¿®æ”¹åï¼Œåªè¦æ‰¾åˆ°ä¸€ä¸ªç­”æ¡ˆï¼Œfor å¾ªç¯çš„åç»­é€’å½’ç©·ä¸¾éƒ½ä¼šè¢«é˜»æ–­ã€‚ä¹Ÿè®¸ä½ å¯ä»¥åœ¨ N çš‡åé—®é¢˜çš„ä»£ç æ¡†æ¶ä¸Šï¼Œç¨åŠ ä¿®æ”¹ï¼Œå†™ä¸€ä¸ªè§£æ•°ç‹¬çš„ç®—æ³•ï¼Ÿ ä¸‰ã€æœ€åæ€»ç»“å›æº¯ç®—æ³•å°±æ˜¯ä¸ªå¤šå‰æ ‘çš„éå†é—®é¢˜ï¼Œå…³é”®å°±æ˜¯åœ¨å‰åºéå†å’Œååºéå†çš„ä½ç½®åšä¸€äº›æ“ä½œï¼Œç®—æ³•æ¡†æ¶å¦‚ä¸‹ï¼š 12345def backtrack(...): for é€‰æ‹© in é€‰æ‹©åˆ—è¡¨: åšé€‰æ‹© backtrack(...) æ’¤é”€é€‰æ‹© å†™ backtrack å‡½æ•°æ—¶ï¼Œéœ€è¦ç»´æŠ¤èµ°è¿‡çš„ã€Œè·¯å¾„ã€å’Œå½“å‰å¯ä»¥åšçš„ã€Œé€‰æ‹©åˆ—è¡¨ã€ï¼Œå½“è§¦å‘ã€Œç»“æŸæ¡ä»¶ã€æ—¶ï¼Œå°†ã€Œè·¯å¾„ã€è®°å…¥ç»“æœé›†ã€‚ å…¶å®æƒ³æƒ³çœ‹ï¼Œå›æº¯ç®—æ³•å’ŒåŠ¨æ€è§„åˆ’æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒå‘¢ï¼Ÿæˆ‘ä»¬åœ¨åŠ¨æ€è§„åˆ’ç³»åˆ—æ–‡ç« ä¸­å¤šæ¬¡å¼ºè°ƒï¼ŒåŠ¨æ€è§„åˆ’çš„ä¸‰ä¸ªéœ€è¦æ˜ç¡®çš„ç‚¹å°±æ˜¯ã€ŒçŠ¶æ€ã€ã€Œé€‰æ‹©ã€å’Œã€Œbase caseã€ï¼Œæ˜¯ä¸æ˜¯å°±å¯¹åº”ç€èµ°è¿‡çš„ã€Œè·¯å¾„ã€ï¼Œå½“å‰çš„ã€Œé€‰æ‹©åˆ—è¡¨ã€å’Œã€Œç»“æŸæ¡ä»¶ã€ï¼Ÿ æŸç§ç¨‹åº¦ä¸Šè¯´ï¼ŒåŠ¨æ€è§„åˆ’çš„æš´åŠ›æ±‚è§£é˜¶æ®µå°±æ˜¯å›æº¯ç®—æ³•ã€‚åªæ˜¯æœ‰çš„é—®é¢˜å…·æœ‰é‡å å­é—®é¢˜æ€§è´¨ï¼Œå¯ä»¥ç”¨ dp table æˆ–è€…å¤‡å¿˜å½•ä¼˜åŒ–ï¼Œå°†é€’å½’æ ‘å¤§å¹…å‰ªæï¼Œè¿™å°±å˜æˆäº†åŠ¨æ€è§„åˆ’ã€‚è€Œä»Šå¤©çš„ä¸¤ä¸ªé—®é¢˜ï¼Œéƒ½æ²¡æœ‰é‡å å­é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯å›æº¯ç®—æ³•é—®é¢˜äº†ï¼Œå¤æ‚åº¦éå¸¸é«˜æ˜¯ä¸å¯é¿å…çš„ã€‚ ä½œè€…ï¼šlabuladongé“¾æ¥ï¼šhttps://leetcode-cn.com/problems/n-queens/solution/hui-su-suan-fa-xiang-jie-by-labuladong/æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ Tip: Javaå†™æ³• ã€Nçš‡åã€‘ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455class Solution &#123; public List&lt;List&lt;String&gt;&gt; res; public List&lt;List&lt;String&gt;&gt; solveNQueens(int n) &#123; if (n &lt;= 0) return null; res = new LinkedList&lt;&gt;(); char[][] board = new char[n][n]; for (char[] chars : board) Arrays.fill(chars, '.'); backtrack(board, 0); return res; &#125; private static List&lt;String&gt; charToString(char[][] array) &#123; List&lt;String&gt; result = new LinkedList&lt;&gt;(); for (char[] chars : array) &#123; result.add(String.valueOf(chars)); &#125; return result; &#125; /** * è·¯å¾„ï¼šboardä¸­å°äºrowçš„é‚£äº›è¡Œéƒ½å·²ç»æˆåŠŸæ”¾ç½®äº†çš‡å * å¯é€‰æ‹©åˆ—è¡¨: ç¬¬rowè¡Œçš„æ‰€æœ‰åˆ—éƒ½æ˜¯æ”¾ç½®Qçš„é€‰æ‹© * ç»“æŸæ¡ä»¶: rowè¶…è¿‡boardçš„æœ€åä¸€è¡Œ * * @param board * @param row */ private void backtrack(char[][] board, int row) &#123; if (row == board.length) &#123; res.add(charToString(board)); return; &#125; int n = board[row].length; for (int col = 0; col &lt; n; col++) &#123; if (!isValid(board, row, col)) continue; board[row][col] = 'Q'; backtrack(board, row + 1); board[row][col] = '.'; &#125; &#125; private boolean isValid(char[][] board, int row, int col) &#123; int rows = board.length; // check is valid in col for (char[] chars : board) if (chars[col] == 'Q') return false; // check is valide upright for (int i = row - 1, j = col + 1; i &gt;= 0 &amp;&amp; j &lt; rows; i--, j++) &#123; if (board[i][j] == 'Q') return false; &#125; // check is valide upleft for (int i = row - 1, j = col - 1; i &gt;= 0 &amp;&amp; j &gt;= 0; i--, j--) &#123; if (board[i][j] == 'Q') return false; &#125; return true; &#125;&#125; ä»£ç æ¥è‡ªï¼š https://leetcode-cn.com/u/kpcoding/ 42. æ¥é›¨æ°´é¢˜ç›®ç»™å®š n ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º 1 çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚ ç¤ºä¾‹: 12è¾“å…¥: [0,1,0,2,1,0,1,3,2,1,2,1]è¾“å‡º: 6 æ€è·¯è§ä»£ç  ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109/** * æš´åŠ›æ³• * å°±æ˜¯æ‰¾å·¦å³æŸ±å­çš„æœ€å¤§å€¼çš„æœ€å°å€¼ï¼Œå³Math.min(L_max,R_max),ç„¶åå‡å»è‡ªèº«é«˜åº¦å°±æ˜¯èƒ½æ¥çš„é›¨æ°´ * å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ±‚å·¦å³æŸ±å­æœ€å¤§å€¼æ—¶éœ€è¦æŠŠè‡ªå·±è®¡ç®—åœ¨å†…ï¼ï¼ï¼ * @param height * @return */ public int trapByViolence(int[] height)&#123; int res = 0; for(int i = 0;i &lt; height.length;i++)&#123; int L_max = 0; int R_max = 0; for(int j = i;j &gt;= 0;j--)&#123; L_max = Math.max(L_max,height[j]); &#125; for(int j = i;j &lt; height.length;j++)&#123; R_max = Math.max(R_max,height[j]); &#125; res = res + Math.min(L_max,R_max) - height[i]; &#125; return res; &#125; /** * dpå¤§æ³• * ç”¨ç©ºé—´æ¢æ—¶é—´ï¼ŒæŠŠ L_maxã€R_max è®°å½•ä¸‹æ¥ï¼Œå°±ä¸ç”¨é‡å¤è®¡ç®—äº† * @param height * @return */ public int trapByDp(int[] height)&#123; int res = 0; int len = height.length; if(len == 0) return 0; int[] L_max = new int[len]; int[] R_max = new int[len]; L_max[0] = height[0]; R_max[len-1] = height[len-1]; for(int i = 1;i &lt; len;i++)&#123; L_max[i] = Math.max(L_max[i-1],height[i]); &#125; for(int i = len - 2;i &gt;= 0;i--)&#123; R_max[i] = Math.max(R_max[i+1],height[i]); &#125; for(int i = 0;i &lt; height.length;i++)&#123; res = res + Math.min(L_max[i],R_max[i]) - height[i]; &#125; return res; &#125; /** * åŒæŒ‡é’ˆä¹‹å›ºå®šæœ€é«˜ç‚¹ * å…ˆæ‰¾åˆ°æœ€é«˜ç‚¹ï¼Œç„¶åå·¦è¾¹å‘æœ€é«˜ç‚¹é è¿‘ï¼Œå³è¾¹ä¹Ÿå‘æœ€é«˜ç‚¹é è¿‘ï¼Œå·¦è¾¹åªéœ€è¦è€ƒè™‘å·¦è¾¹ï¼Œå³è¾¹åªéœ€è¦è€ƒè™‘å³è¾¹ * @param height * @return */ public int trapByDouble(int[] height)&#123; int res = 0; int len = height.length; if(len == 0) return 0; int max = 0; int max_index = -1; for(int i = 0;i &lt; len;i++)&#123; if(height[i] &gt; max)&#123; max = height[i]; max_index = i; &#125; &#125; int L_max = height[0]; for(int i = 0;i &lt; max_index;i++)&#123; if(height[i] &gt; L_max) L_max = height[i]; else res = res + L_max - height[i]; &#125; int R_max = height[len-1]; for(int i = len - 1;i &gt; max_index;i--)&#123; if(height[i] &gt; R_max) R_max = height[i]; else res = res + R_max - height[i]; &#125; return res; &#125; /** * åŒæŒ‡é’ˆæ³•äºŒ * æ•´ä½“æ€è·¯å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯è¿™ä¸ªæ›´ç®€ä¾¿ä¸€ç‚¹è€Œå·²ï¼Œæ— éœ€æ‰¾æœ€é«˜ç‚¹ï¼Œåªè¦ç¡®ä¿éå†çš„æ•°åªéœ€è¦è€ƒè™‘ä¸€è¾¹å³å¯ * @param height * @return */ public int trapByDouble2(int[] height)&#123; int res = 0; int len = height.length; int left = 0; int right = len - 1; if(len == 0) return 0; int L_max = height[0]; int R_max = height[len-1]; //ä¸€å®šåœ¨æœ€é«˜ç‚¹ç›¸é‡ï¼Œæ‰€ä»¥æ— éœ€ left &lt;= right while(left &lt; right)&#123; L_max = Math.max(L_max, height[left]); R_max = Math.max(R_max, height[right]); if (L_max &lt; R_max) &#123; res = res + L_max - height[left]; left++; &#125; else &#123; res = res + R_max - height[right]; right--; &#125; &#125; return res; &#125; 33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„é¢˜ç›®å‡è®¾æŒ‰ç…§å‡åºæ’åºçš„æ•°ç»„åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªç‚¹ä¸Šè¿›è¡Œäº†æ—‹è½¬ã€‚ ( ä¾‹å¦‚ï¼Œæ•°ç»„ [0,1,2,4,5,6,7] å¯èƒ½å˜ä¸º [4,5,6,7,0,1,2] )ã€‚ æœç´¢ä¸€ä¸ªç»™å®šçš„ç›®æ ‡å€¼ï¼Œå¦‚æœæ•°ç»„ä¸­å­˜åœ¨è¿™ä¸ªç›®æ ‡å€¼ï¼Œåˆ™è¿”å›å®ƒçš„ç´¢å¼•ï¼Œå¦åˆ™è¿”å› -1 ã€‚ ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­ä¸å­˜åœ¨é‡å¤çš„å…ƒç´ ã€‚ ä½ çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦å¿…é¡»æ˜¯ O(log n) çº§åˆ«ã€‚ 123456789ç¤ºä¾‹ 1:è¾“å…¥: nums = [4,5,6,7,0,1,2], target = 0è¾“å‡º: 4ç¤ºä¾‹ 2:è¾“å…¥: nums = [4,5,6,7,0,1,2], target = 3è¾“å‡º: -1 æ€è·¯é¢˜ç›®è¦æ±‚ O(logN) çš„æ—¶é—´å¤æ‚åº¦ï¼ŒåŸºæœ¬å¯ä»¥æ–­å®šæœ¬é¢˜æ˜¯éœ€è¦ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ€ä¹ˆåˆ†æ˜¯å…³é”®ã€‚ç”±äºé¢˜ç›®è¯´æ•°å­—äº†æ— é‡å¤ï¼Œä¸¾ä¸ªä¾‹å­ï¼š1 2 3 4 5 6 7 å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ç±»ï¼Œç¬¬ä¸€ç±» 2 3 4 5 6 7 1 è¿™ç§ï¼Œä¹Ÿå°±æ˜¯ nums[start] &lt;= nums[mid]ã€‚æ­¤ä¾‹å­ä¸­å°±æ˜¯ 2 &lt;= 5ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå‰åŠéƒ¨åˆ†æœ‰åºã€‚å› æ­¤å¦‚æœ nums[start] &lt;=target&lt;nums[mid]ï¼Œåˆ™åœ¨å‰åŠéƒ¨åˆ†æ‰¾ï¼Œå¦åˆ™å»ååŠéƒ¨åˆ†æ‰¾ã€‚ç¬¬äºŒç±» 6 7 1 2 3 4 5 è¿™ç§ï¼Œä¹Ÿå°±æ˜¯ nums[start] &gt; nums[mid]ã€‚æ­¤ä¾‹å­ä¸­å°±æ˜¯ 6 &gt; 2ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒååŠéƒ¨åˆ†æœ‰åºã€‚å› æ­¤å¦‚æœ nums[mid] &lt;target&lt;=nums[end]ï¼Œåˆ™åœ¨ååŠéƒ¨åˆ†æ‰¾ï¼Œå¦åˆ™å»å‰åŠéƒ¨åˆ†æ‰¾ã€‚ æ­¤é¢˜æœ‰ä¸ªå­˜åœ¨é‡å¤æ•°å­—çš„å˜å½¢é¢˜ï¼Œå¯å‚è€ƒ æ­¤é¢˜è§£ ã€‚ ä½œè€…ï¼šreedfané“¾æ¥ï¼šhttps://leetcode-cn.com/problems/search-in-rotated-sorted-array/solution/ji-bai-liao-9983de-javayong-hu-by-reedfan/æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ ä»£ç å®ç°123456789101112131415161718192021222324252627282930class Solution &#123; public int search(int[] nums, int target) &#123; int start = 0; int end = nums.length - 1; while(start &lt;= end)&#123; int mid = start + (end - start)/2; if(nums[mid] == target) return mid; //æœ€å®¹æ˜“é”™çš„ç‚¹ï¼Œå°±æ˜¯åˆ—è¡¨åªæœ‰ä¸¤ä¸ªæ•°å­—æ—¶ï¼Œmidå’Œstartæ˜¯åŒä¸€ä¸ªæ•°ï¼Œæ­¤æ—¶å¿…é¡»æ˜¯å‰åŠéƒ¨åˆ†æœ‰åº if(nums[mid] &gt;= nums[start])&#123; // è¯´æ˜å‰åŠéƒ¨åˆ†æœ‰åº if(nums[start] &lt;= target &amp;&amp; target &lt; nums[mid])&#123; end = mid - 1; &#125; else &#123; start = mid + 1; &#125; &#125; else &#123; // è¯´æ˜ååŠéƒ¨åˆ†æœ‰åº if(nums[mid] &lt; target &amp;&amp; target &lt;= nums[end])&#123; start = mid + 1; &#125; else &#123; end = mid - 1; &#125; &#125; &#125; return -1; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536class Solution &#123; public int search(int[] nums, int target) &#123; int start = 0; int end = nums.length - 1; while(start &lt;= end)&#123; int mid = start + (end - start)/2; if(nums[mid] == target) return mid; if (nums[start] == nums[mid]) &#123; start++; continue; &#125; //æœ€å®¹æ˜“é”™çš„ç‚¹ï¼Œå°±æ˜¯åˆ—è¡¨åªæœ‰ä¸¤ä¸ªæ•°å­—æ—¶ï¼Œmidå’Œstartæ˜¯åŒä¸€ä¸ªæ•°ï¼Œæ­¤æ—¶å¿…é¡»æ˜¯å‰åŠéƒ¨åˆ†æœ‰åº // num[mid] == nums[start] åªä¼šåœ¨åˆ—è¡¨åªæœ‰ä¸¤ä¸ªæ•°æ—¶æ‰ç›¸ç­‰ï¼Œæ‰€ä»¥æ‰å¯ä»¥ä¸Šé¢é‚£æ ·å¤„ç† // æ­£å¸¸å…¶å®æ˜¯ä¸åº”è¯¥é‚£æ ·å¤„ç†ï¼Œè€Œåº”è¯¥æ˜¯å½“num[mid] == nums[start]ï¼Œç›´æ¥start++ï¼Œç„¶åè¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ if(nums[mid] &gt; nums[start])&#123; // è¯´æ˜å‰åŠéƒ¨åˆ†æœ‰åº if(nums[start] &lt;= target &amp;&amp; target &lt; nums[mid])&#123; end = mid - 1; &#125; else &#123; start = mid + 1; &#125; &#125; else &#123; // è¯´æ˜ååŠéƒ¨åˆ†æœ‰åº if(nums[mid] &lt; target &amp;&amp; target &lt;= nums[end])&#123; start = mid + 1; &#125; else &#123; end = mid - 1; &#125; &#125; &#125; return -1; &#125;&#125; Tip: 81é¢˜æ€è·¯ä¸€æ · 123456789101112131415161718192021222324252627282930313233343536373839404142class Solution &#123; public boolean search(int[] nums, int target) &#123; if (nums == null || nums.length == 0) &#123; return false; &#125; int start = 0; int end = nums.length - 1; int mid; while (start &lt;= end) &#123; mid = start + (end - start) / 2; if (nums[mid] == target) &#123; return true; &#125; if (nums[start] == nums[mid]) &#123; start++; continue; &#125; // å‰åŠéƒ¨åˆ†æœ‰åº // [1,3,1,1,1] if (nums[start] &lt; nums[mid]) &#123; // targetåœ¨å‰åŠéƒ¨åˆ† if (nums[mid] &gt; target &amp;&amp; nums[start] &lt;= target) &#123; end = mid - 1; &#125; else &#123; // å¦åˆ™ï¼Œå»ååŠéƒ¨åˆ†æ‰¾ start = mid + 1; &#125; &#125; else &#123; // ååŠéƒ¨åˆ†æœ‰åº // targetåœ¨ååŠéƒ¨åˆ† if (nums[mid] &lt; target &amp;&amp; nums[end] &gt;= target) &#123; start = mid + 1; &#125; else &#123; // å¦åˆ™ï¼Œå»ååŠéƒ¨åˆ†æ‰¾ end = mid - 1; &#125; &#125; &#125; // ä¸€ç›´æ²¡æ‰¾åˆ°ï¼Œè¿”å›false return false; &#125;&#125; 34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®é¢˜ç›®ç»™å®šä¸€ä¸ªæŒ‰ç…§å‡åºæ’åˆ—çš„æ•´æ•°æ•°ç»„ numsï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ targetã€‚æ‰¾å‡ºç»™å®šç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚ ä½ çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦å¿…é¡»æ˜¯ O(log n) çº§åˆ«ã€‚ å¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨ç›®æ ‡å€¼ï¼Œè¿”å› [-1, -1]ã€‚ 12345678ç¤ºä¾‹ 1:è¾“å…¥: nums = [5,7,7,8,8,10], target = 8è¾“å‡º: [3,4]ç¤ºä¾‹ 2:è¾“å…¥: nums = [5,7,7,8,8,10], target = 6è¾“å‡º: [-1,-1] æ€è·¯è§ labuladong å…¬ä¼—å·ç¬”è®° å®ç°ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647class Solution &#123; public int[] searchRange(int[] nums, int target) &#123; if(nums.length == 0) return new int[]&#123;-1,-1&#125;; return new int[]&#123;searchLeft(nums,target),searchRight(nums,target)&#125;; &#125; public int searchLeft(int[] nums,int target)&#123; int left = 0; int right = nums.length - 1; while(left &lt;= right)&#123; // é˜²æ­¢æº¢å‡º int mid = left + (right - left)/2; if(nums[mid] &gt;= target) right = mid - 1; else left = mid + 1; &#125; // ä¸Šé¢çš„whileå¾ªç¯åï¼Œæœ€åä¸€æ¬¡å¾ªç¯ left == mid, right = left - 1 = mid - 1 // è‹¥æœ‰ç¬¦åˆè¦æ±‚çš„targetï¼Œåˆ™ä¼šæœ‰ä¸¤ç§æƒ…å†µï¼š // 1. left å’Œ right åœ¨ target å€¼çš„æœ€å·¦ç´¢å¼•å¤„çš„å‰ä¸€ä½ç›¸é‡ï¼Œæ­¤æ—¶ left ä¼šå‘å³ä¸€ä½ï¼Œåˆ°è¾¾æœ€å·¦ target å¤„,è€Œ right ä¼šåœåœ¨åŸåœ°ï¼Œå¼¹å‡º while // 2. left å’Œ right åœ¨ target å€¼çš„æœ€å·¦ç´¢å¼•å¤„ç›¸é‡ï¼Œæ­¤æ—¶ left ä¸åŠ¨ï¼Œåˆ°è¾¾æœ€å·¦ target å¤„,è€Œ right ä¼šå‘å·¦ä¸€ä½ï¼Œå¼¹å‡º while // æ³¨æ„ï¼šæ­¤æ—¶çš„ left éƒ½æ˜¯å¤„åœ¨ target æœ€å·¦ç´¢å¼•å¤„ // å¦‚æœæ²¡æœ‰ç¬¦åˆè¦æ±‚çš„targetï¼Œåˆ™æœ‰ä¸‰ç§æƒ…å†µï¼š // 1.æ‰€æœ‰å€¼å‡å°äºtargetï¼Œæ­¤æ—¶ï¼Œleftä¼šåœ¨ nums[nums.length-1]å¤„ä¸rightç›¸é‡ï¼Œç„¶åleft åŠ  1ï¼Œè·³å‡ºå¾ªç¯ï¼Œæ­¤æ—¶left == nums.length // 2.æ‰€æœ‰å€¼å‡å¤§äºtargetï¼Œæ­¤æ—¶rightä¼šä¸æ–­å‘å·¦ï¼Œç›´è‡³ left = right = 0 ç›¸é‡ï¼Œæ­¤æ—¶ right å‡ 1ï¼Œè·³å‡ºå¾ªç¯ï¼Œæ­¤æ—¶ left == 0 // 3.targetä½äºå€¼çš„ä¸­é—´ï¼Œä½†æ˜¯æ²¡æœ‰å€¼å–åˆ°ï¼Œæ­¤æ—¶è·Ÿæœ‰targetæƒ…å†µæ˜¯ç±»ä¼¼çš„ï¼Œæœ€ç»ˆ left ä¼šåœç•™åœ¨æ¯” target å¤§çš„ç¬¬ä¸€ä¸ªæ•°ä¸Š // æ€»ç»“ä¸Šé¢ 5 ç§æƒ…å†µï¼Œleft ä¸º nums.length æ—¶ï¼Œå¦å…¶ä¸º nums.length - 1,æ­¤æ—¶ç›´æ¥åˆ¤æ–­ nums[left] å³å¯ï¼Œè‹¥ä¸ºtargetåˆ™ç›´æ¥è¿”å› left // å¦åˆ™è¿”å› -1 int pos = (left == nums.length) ? nums.length - 1 : left; if(nums[pos] != target) return -1; return left; &#125; public int searchRight(int[] nums,int target)&#123; int left = 0; int right = nums.length - 1; while(left &lt;= right)&#123; // é˜²æ­¢æº¢å‡º int mid = left + (right - left)/2; if(nums[mid] &lt;= target) left = mid + 1; else right = mid - 1; &#125; // åŒä¸Šåˆ†æ // æœ€å·¦å’Œæœ€å³åªæœ‰ä¸€ä¸ªåŒºåˆ«ï¼Œå°±æ˜¯ left æ¢æˆäº† right ï¼Œnums.length æ¢æˆäº† -1 int pos = (right == -1)? 0 : right; if(nums[pos] != target) return -1; return right; &#125;&#125; 39. ç»„åˆæ€»å’Œé¢˜ç›®ç»™å®šä¸€ä¸ªæ— é‡å¤å…ƒç´ çš„æ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•° target ï¼Œæ‰¾å‡º candidates ä¸­æ‰€æœ‰å¯ä»¥ä½¿æ•°å­—å’Œä¸º target çš„ç»„åˆã€‚ candidates ä¸­çš„æ•°å­—å¯ä»¥æ— é™åˆ¶é‡å¤è¢«é€‰å–ã€‚ è¯´æ˜ï¼š æ‰€æœ‰æ•°å­—ï¼ˆåŒ…æ‹¬ targetï¼‰éƒ½æ˜¯æ­£æ•´æ•°ã€‚ è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„ç»„åˆã€‚ ç¤ºä¾‹ 1: 123456è¾“å…¥: candidates = [2,3,6,7], target = 7,æ‰€æ±‚è§£é›†ä¸º:[ [7], [2,2,3]] ç¤ºä¾‹ 2: 1234567è¾“å…¥: candidates = [2,3,5], target = 8,æ‰€æ±‚è§£é›†ä¸º:[ [2,2,2,2], [2,3,3], [3,5]] æ€è·¯ç›´æ¥ä¸Šå›æº¯ç®—æ³•æ¡†æ¶ã€‚è§£å†³ä¸€ä¸ªå›æº¯é—®é¢˜ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå†³ç­–æ ‘çš„éå†è¿‡ç¨‹ã€‚ä½ åªéœ€è¦æ€è€ƒ 3 ä¸ªé—®é¢˜ï¼š 1ã€è·¯å¾„ï¼šä¹Ÿå°±æ˜¯å·²ç»åšå‡ºçš„é€‰æ‹©ã€‚ 2ã€é€‰æ‹©åˆ—è¡¨ï¼šä¹Ÿå°±æ˜¯ä½ å½“å‰å¯ä»¥åšçš„é€‰æ‹©ã€‚ 3ã€ç»“æŸæ¡ä»¶ï¼šä¹Ÿå°±æ˜¯åˆ°è¾¾å†³ç­–æ ‘åº•å±‚ï¼Œæ— æ³•å†åšé€‰æ‹©çš„æ¡ä»¶ã€‚ ä»£ç æ–¹é¢ï¼Œå›æº¯ç®—æ³•çš„æ¡†æ¶ï¼š 12345678910result = []def backtrack(è·¯å¾„, é€‰æ‹©åˆ—è¡¨): if æ»¡è¶³ç»“æŸæ¡ä»¶: result.add(è·¯å¾„) returnfor é€‰æ‹© in é€‰æ‹©åˆ—è¡¨: åšé€‰æ‹© backtrack(è·¯å¾„, é€‰æ‹©åˆ—è¡¨) æ’¤é”€é€‰æ‹© å…¶æ ¸å¿ƒå°±æ˜¯ for å¾ªç¯é‡Œé¢çš„é€’å½’ï¼Œåœ¨é€’å½’è°ƒç”¨ä¹‹å‰ã€Œåšé€‰æ‹©ã€ï¼Œåœ¨é€’å½’è°ƒç”¨ä¹‹åã€Œæ’¤é”€é€‰æ‹©ã€ï¼Œç‰¹åˆ«ç®€å•ã€‚ labuladong å›æº¯æ¡†æ¶ï¼ï¼ï¼è€å“¥å†™çš„æ–‡ç« çœŸæ˜¯å¹²å‡€åˆ©è½ï¼ demo(å…¨æ’åˆ—)123456789101112131415161718192021222324252627282930313233List&lt;List&lt;Integer&gt;&gt; res = new LinkedList&lt;&gt;();/* ä¸»å‡½æ•°ï¼Œè¾“å…¥ä¸€ç»„ä¸é‡å¤çš„æ•°å­—ï¼Œè¿”å›å®ƒä»¬çš„å…¨æ’åˆ— */List&lt;List&lt;Integer&gt;&gt; permute(int[] nums) &#123; // è®°å½•ã€Œè·¯å¾„ã€ // è¿™é‡Œçš„ é€‰æ‹©åˆ—è¡¨ å³åŒ…å«åœ¨numsä¸­ LinkedList&lt;Integer&gt; track = new LinkedList&lt;&gt;(); backtrack(nums, track); return res;&#125;// è·¯å¾„ï¼šè®°å½•åœ¨ track ä¸­// é€‰æ‹©åˆ—è¡¨ï¼šnums ä¸­çš„å…ƒç´ // ç»“æŸæ¡ä»¶ï¼šnums ä¸­çš„å…ƒç´ å…¨éƒ½åœ¨ track ä¸­å‡ºç°void backtrack(int[] nums, LinkedList&lt;Integer&gt; track) &#123; // è§¦å‘ç»“æŸæ¡ä»¶ if (track.size() == nums.length) &#123; res.add(new LinkedList(track)); return; &#125; for (int i = 0; i &lt; nums.length; i++) &#123; // æ’é™¤ä¸åˆæ³•çš„é€‰æ‹© if (track.contains(nums[i])) continue; // åšé€‰æ‹© track.add(nums[i]); // è¿›å…¥ä¸‹ä¸€å±‚å†³ç­–æ ‘ backtrack(nums, track); // å–æ¶ˆé€‰æ‹©ï¼Œè¿”å›ä¸Šä¸€å±‚å†³ç­–æ ‘ track.removeLast(); &#125;&#125; ä»£ç å®ç°å…ˆæŒ‰ç…§demoå†™ä¸€ä¸ªå·®ä¸å¤šçš„ï¼Œè¿™ä¸ªæš‚æ—¶æ— æ³•åšåˆ°å»é‡ï¼ 1234567891011121314151617181920212223242526272829303132333435363738public class combinationSum_39 &#123; public static void main(String[] args) &#123; combinationSum(new int[]&#123;2,3,6,7&#125;,7); System.out.println(res); &#125; public static List&lt;List&lt;Integer&gt;&gt; res = new LinkedList&lt;&gt;(); public static List&lt;List&lt;Integer&gt;&gt; combinationSum(int[] candidates, int target) &#123; LinkedList&lt;Integer&gt; track = new LinkedList&lt;&gt;(); // æ’åºçš„åŸå› æ˜¯åœ¨å›æº¯çš„æ—¶å€™æ¯”è¾ƒå®¹æ˜“å‰ªæ Arrays.sort(candidates); // å¥—ç”¨ä¸Šé¢çš„å…¬å¼ï¼Œcandidatesæ˜¯æŒ‡é€‰æ‹©åˆ—è¡¨ï¼Œtargetç”¨æ¥åˆ¤æ–­æ˜¯å¦ç»“æŸä»¥åŠç”¨äºå‰ªæ // trackåˆ™æ˜¯è·¯å¾„ï¼Œå³å·²ç»åšå‡ºçš„é€‰æ‹© backtrack(candidates, target, track); return res; &#125; private static void backtrack(int[] candidates, int target, LinkedList&lt;Integer&gt; track) &#123; //å…ˆåˆ¤æ–­ç»“æŸæ¡ä»¶ if (target &lt; 0) return; if (target == 0)&#123; // å½“targetç­‰äº0çš„æ—¶å€™ï¼Œå°†è·¯å¾„åŠ å…¥åˆ°ç»“æœåˆ—è¡¨ä¸­ res.add(new LinkedList&lt;&gt;(track)); return; &#125; // éå†é€‰æ‹©åˆ—è¡¨ï¼Œè¿™é‡Œæ²¡æœ‰å»é‡ //ä¸‹é¢ä¼šè®¾ç½®startï¼Œæ¯æ¬¡é€’å½’çš„æ—¶å€™åªåœ¨candidatesä¸­å½“å‰åŠä¹‹åçš„æ•°å­—ä¸­é€‰æ‹©ã€‚ for(int i = 0;i &lt; candidates.length;i++)&#123; // è¿™å°±æ˜¯æ’åºçš„å¥½å¤„ï¼Œå¯ä»¥ç›´æ¥è¿™æ ·å‰ªæï¼Œå¦åˆ™è¿˜å¾—éå† if(target &lt; candidates[i]) break; track.add(candidates[i]); backtrack(candidates,target-candidates[i],track); track.removeLast(); &#125; &#125;&#125; 1è¾“å‡ºï¼š[[2, 2, 3], [2, 3, 2], [3, 2, 2], [7]] å»é‡ä¹‹åçš„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930public class combinationSum_39 &#123; public static void main(String[] args) &#123; combinationSum(new int[]&#123;2,3,6,7&#125;,7); System.out.println(res); &#125; public static List&lt;List&lt;Integer&gt;&gt; res = new LinkedList&lt;&gt;(); public static List&lt;List&lt;Integer&gt;&gt; combinationSum(int[] candidates, int target) &#123; LinkedList&lt;Integer&gt; track = new LinkedList&lt;&gt;(); Arrays.sort(candidates); backtrack(candidates, 0, target, track); return res; &#125; private static void backtrack(int[] candidates, int start, int target, LinkedList&lt;Integer&gt; track) &#123; if (target &lt; 0) return; if (target == 0)&#123; res.add(new LinkedList&lt;&gt;(track)); return; &#125; for(int i = start;i &lt; candidates.length;i++)&#123; if(target &lt; candidates[i]) break; track.add(candidates[i]); backtrack(candidates,i,target-candidates[i],track); track.removeLast(); &#125; &#125;&#125; 1è¾“å‡ºï¼š[[2, 2, 3], [7]] 146. LRUç¼“å­˜æœºåˆ¶é¢˜ç›®è¿ç”¨ä½ æ‰€æŒæ¡çš„æ•°æ®ç»“æ„ï¼Œè®¾è®¡å’Œå®ç°ä¸€ä¸ª LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜æœºåˆ¶ã€‚å®ƒåº”è¯¥æ”¯æŒä»¥ä¸‹æ“ä½œï¼š è·å–æ•°æ® get å’Œ å†™å…¥æ•°æ® put ã€‚ è·å–æ•°æ® get(key) - å¦‚æœå¯†é’¥ (key) å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è·å–å¯†é’¥çš„å€¼ï¼ˆæ€»æ˜¯æ­£æ•°ï¼‰ï¼Œå¦åˆ™è¿”å› -1ã€‚å†™å…¥æ•°æ® put(key, value) - å¦‚æœå¯†é’¥ä¸å­˜åœ¨ï¼Œåˆ™å†™å…¥å…¶æ•°æ®å€¼ã€‚å½“ç¼“å­˜å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®å€¼ï¼Œä»è€Œä¸ºæ–°çš„æ•°æ®å€¼ç•™å‡ºç©ºé—´ã€‚ ç›¸ä¿¡å¦‚æœæœ‰è®¤çœŸçœ‹è¿‡ LinkedHashMap æºç çš„å°ä¼™ä¼´ï¼Œä¸€å®šä¼šå¾ˆå¿«çš„è·Ÿå®˜æ–¹é¢˜è§£å†™çš„ä¸€æ¨¡ä¸€æ ·ï¼ ç®€å•ä»‹ç»LinkedHashMapï¼ˆè·Ÿé¢˜ç›®æœ‰å…³çš„çŸ¥è¯†ç‚¹ï¼‰HashMap å¤§å®¶éƒ½æ¸…æ¥šï¼Œåº•å±‚æ˜¯ æ•°ç»„ + çº¢é»‘æ ‘ + é“¾è¡¨ ï¼ˆä¸æ¸…æ¥šä¹Ÿæ²¡æœ‰å…³ç³»ï¼‰ï¼ŒåŒæ—¶å…¶æ˜¯æ— åºçš„ï¼Œè€Œ LinkedHashMap åˆšå¥½å°±æ¯” HashMap å¤šè¿™ä¸€ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯å…¶æä¾› æœ‰åºï¼Œå¹¶ä¸”ï¼ŒLinkedHashMapçš„æœ‰åºå¯ä»¥æŒ‰ä¸¤ç§é¡ºåºæ’åˆ—ï¼Œä¸€ç§æ˜¯æŒ‰ç…§æ’å…¥çš„é¡ºåºï¼Œä¸€ç§æ˜¯æŒ‰ç…§è¯»å–çš„é¡ºåºï¼ˆè¿™ä¸ªé¢˜ç›®çš„ç¤ºä¾‹å°±æ˜¯å‘Šè¯‰æˆ‘ä»¬è¦æŒ‰ç…§è¯»å–çš„é¡ºåºè¿›è¡Œæ’åºï¼‰ï¼Œè€Œå…¶å†…éƒ¨æ˜¯é  å»ºç«‹ä¸€ä¸ªåŒå‘é“¾è¡¨ æ¥ç»´æŠ¤è¿™ä¸ªé¡ºåºçš„ï¼Œåœ¨æ¯æ¬¡æ’å…¥ã€åˆ é™¤åï¼Œéƒ½ä¼šè°ƒç”¨ä¸€ä¸ªå‡½æ•°æ¥è¿›è¡Œ åŒå‘é“¾è¡¨çš„ç»´æŠ¤ ï¼Œå‡†å¤‡çš„æ¥è¯´ï¼Œæ˜¯æœ‰ä¸‰ä¸ªå‡½æ•°æ¥åšè¿™ä»¶äº‹ï¼Œè¿™ä¸‰ä¸ªå‡½æ•°éƒ½ç»Ÿç§°ä¸º å›è°ƒå‡½æ•° ï¼Œè¿™ä¸‰ä¸ªå‡½æ•°åˆ†åˆ«æ˜¯ï¼š void afterNodeAccess(Node p) { } å…¶ä½œç”¨å°±æ˜¯åœ¨è®¿é—®å…ƒç´ ä¹‹åï¼Œå°†è¯¥å…ƒç´ æ”¾åˆ°åŒå‘é“¾è¡¨çš„å°¾å·´å¤„(æ‰€ä»¥è¿™ä¸ªå‡½æ•°åªæœ‰åœ¨æŒ‰ç…§è¯»å–çš„é¡ºåºçš„æ—¶å€™æ‰ä¼šæ‰§è¡Œ)ï¼Œä¹‹æ‰€ä»¥æè¿™ä¸ªï¼Œæ˜¯å»ºè®®å¤§å®¶å»çœ‹çœ‹ï¼Œå¦‚ä½•ä¼˜ç¾çš„å®ç°åœ¨åŒå‘é“¾è¡¨ä¸­å°†æŒ‡å®šå…ƒç´ æ”¾å…¥é“¾å°¾ï¼ void afterNodeRemoval(Node p) { } å…¶ä½œç”¨å°±æ˜¯åœ¨åˆ é™¤å…ƒç´ ä¹‹åï¼Œå°†å…ƒç´ ä»åŒå‘é“¾è¡¨ä¸­åˆ é™¤ï¼Œè¿˜æ˜¯éå¸¸å»ºè®®å¤§å®¶å»çœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„ï¼Œå¾ˆä¼˜ç¾çš„æ–¹å¼åœ¨åŒå‘é“¾è¡¨ä¸­åˆ é™¤èŠ‚ç‚¹ï¼ void afterNodeInsertion(boolean evict) { } è¿™ä¸ªæ‰æ˜¯æˆ‘ä»¬é¢˜ç›®ä¸­ä¼šç”¨åˆ°çš„ï¼Œåœ¨æ’å…¥æ–°å…ƒç´ ä¹‹åï¼Œéœ€è¦å›è°ƒå‡½æ•°åˆ¤æ–­æ˜¯å¦éœ€è¦ç§»é™¤ä¸€ç›´ä¸ç”¨çš„æŸäº›å…ƒç´ ï¼ å…¶æ¬¡ï¼Œæˆ‘å†ä»‹ç»ä¸€ä¸‹ LinkedHashMap çš„æ„é€ å‡½æ•°ï¼ å…¶ä¸»è¦æ˜¯ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ç»§æ‰¿ HashMap ï¼Œä¸€ä¸ªæ˜¯å¯ä»¥é€‰æ‹© accessOrder çš„å€¼(é»˜è®¤ falseï¼Œä»£è¡¨æŒ‰ç…§æ’å…¥é¡ºåºæ’åº)æ¥ç¡®å®šæ˜¯æŒ‰æ’å…¥é¡ºåºè¿˜æ˜¯è¯»å–é¡ºåºæ’åºã€‚ 1234567891011121314151617181920212223/** //è°ƒç”¨çˆ¶ç±»HashMapçš„æ„é€ æ–¹æ³•ã€‚ */public LinkedHashMap() &#123; super(); accessOrder = false;&#125;// è¿™é‡Œçš„ accessOrder é»˜è®¤æ˜¯ä¸ºfalseï¼Œå¦‚æœè¦æŒ‰è¯»å–é¡ºåºæ’åºéœ€è¦å°†å…¶è®¾ä¸º true// initialCapacity ä»£è¡¨ map çš„ å®¹é‡ï¼ŒloadFactor ä»£è¡¨åŠ è½½å› å­ (é»˜è®¤å³å¯)public LinkedHashMap(int initialCapacity, float loadFactor, boolean accessOrder) &#123; super(initialCapacity, loadFactor); this.accessOrder = accessOrder;&#125; æ€è·¯ &amp; ä»£ç ä¸‹é¢æ˜¯æˆ‘è‡ªå·±åœ¨åˆ†æ LinkedHashMap æºç æ—¶åšçš„ä¸€äº›ç¬”è®°ï¼Œåº”è¯¥æ˜¯æ¯”è¾ƒæ¸…æ¥šçš„ï¼Œä¸»ä½“æ„æ€å°±æ˜¯æˆ‘ä»¬è¦ç»§æ‰¿ LinkedHashMapï¼Œç„¶åå¤å†™ removeEldestEntry()å‡½æ•°ï¼Œå°±èƒ½æ‹¥æœ‰æˆ‘ä»¬è‡ªå·±çš„ç¼“å­˜ç­–ç•¥ï¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647// åœ¨æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ ä¹‹åï¼Œå¦‚æœæ˜¯æŒ‰æ’å…¥é¡ºåºæ’åºï¼Œå³è°ƒç”¨newNode()ä¸­çš„linkNodeLast()å®Œæˆ// å¦‚æœæ˜¯æŒ‰ç…§è¯»å–é¡ºåºæ’åºï¼Œå³è°ƒç”¨afterNodeAccess()å®Œæˆ// é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•æ˜¯å¹²å˜›çš„å‘¢ï¼Œè¿™ä¸ªå°±æ˜¯è‘—åçš„ LRU ç®—æ³•å•¦// åœ¨æ’å…¥å®Œæˆä¹‹åï¼Œéœ€è¦å›è°ƒå‡½æ•°åˆ¤æ–­æ˜¯å¦éœ€è¦ç§»é™¤æŸäº›å…ƒç´ ï¼// LinkedHashMap å‡½æ•°éƒ¨åˆ†æºç /** \* æ’å…¥æ–°èŠ‚ç‚¹æ‰ä¼šè§¦å‘è¯¥æ–¹æ³•ï¼Œå› ä¸ºåªæœ‰æ’å…¥æ–°èŠ‚ç‚¹æ‰éœ€è¦å†…å­˜ \* æ ¹æ® HashMap çš„ putVal æ–¹æ³•, evict ä¸€ç›´æ˜¯ true \* removeEldestEntry æ–¹æ³•è¡¨ç¤ºç§»é™¤è§„åˆ™, åœ¨ LinkedHashMap é‡Œä¸€ç›´è¿”å› false \* æ‰€ä»¥åœ¨ LinkedHashMap é‡Œè¿™ä¸ªæ–¹æ³•ç›¸å½“äºä»€ä¹ˆéƒ½ä¸åš */void afterNodeInsertion(boolean evict) &#123; // possibly remove eldest LinkedHashMap.Entry&lt;K,V&gt; first; // æ ¹æ®æ¡ä»¶åˆ¤æ–­æ˜¯å¦ç§»é™¤æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„èŠ‚ç‚¹ if (evict &amp;&amp; (first = head) != null &amp;&amp; removeEldestEntry(first)) &#123; K key = first.key; removeNode(hash(key), key, null, false, true); &#125;&#125;// ç§»é™¤æœ€è¿‘æœ€å°‘è¢«è®¿é—®æ¡ä»¶ä¹‹ä¸€ï¼Œé€šè¿‡è¦†ç›–æ­¤æ–¹æ³•å¯å®ç°ä¸åŒç­–ç•¥çš„ç¼“å­˜// LinkedHashMapæ˜¯é»˜è®¤è¿”å›falseçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç»§æ‰¿LinkedHashMapç„¶åå¤å†™è¯¥æ–¹æ³•å³å¯// ä¾‹å¦‚ LeetCode ç¬¬ 146 é¢˜å°±æ˜¯é‡‡ç”¨è¯¥ç§æ–¹æ³•ï¼Œç›´æ¥ return size() &gt; capacity;protected boolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest) &#123; return false; é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å°±å·²ç»çŸ¥é“äº†åªè¦å¤å†™ removeEldestEntry() å³å¯ï¼Œè€Œæ¡ä»¶å°±æ˜¯ map çš„å¤§å°ä¸è¶…è¿‡ ç»™å®šçš„å®¹é‡ï¼Œè¶…è¿‡äº†å°±å¾—ä½¿ç”¨ LRU äº†ï¼ç„¶åæ ¹æ®é¢˜ç›®ç»™å®šçš„è¯­å¥æ„é€ å’Œè°ƒç”¨ï¼š 123456789101112/** \* LRUCache å¯¹è±¡ä¼šä»¥å¦‚ä¸‹è¯­å¥æ„é€ å’Œè°ƒç”¨: \* LRUCache obj = new LRUCache(capacity); \* int param_1 = obj.get(key); \* obj.put(key,value); */ å¾ˆæ˜æ˜¾æˆ‘ä»¬åªéœ€è¦ç›´æ¥ç»§æ‰¿çˆ¶ç±»çš„putå‡½æ•°å³å¯ï¼Œå› ä¸ºé¢˜ç›®æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œæ•…å¯ä»¥ä¸å†™ï¼è‡³äº get() å‡½æ•°ï¼Œé¢˜ç›®æ˜¯æœ‰è¦æ±‚çš„ï¼ è·å–æ•°æ® get(key) - å¦‚æœå¯†é’¥ (key) å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è·å–å¯†é’¥çš„å€¼ï¼ˆæ€»æ˜¯æ­£æ•°ï¼‰ï¼Œå¦åˆ™è¿”å› -1ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è°ƒç”¨ LinkedHashMap ä¸­çš„ getOrDefault()ï¼Œå®Œç¾ç¬¦åˆè¿™ä¸ªè¦æ±‚ï¼Œå³å½“keyä¸å­˜åœ¨æ—¶ä¼šè¿”å›é»˜è®¤å€¼ -1ã€‚ è‡³æ­¤ï¼Œæˆ‘ä»¬å°±åŸºæœ¬å®Œæˆäº†æœ¬é¢˜çš„è¦æ±‚ï¼Œåªè¦å†™ä¸€ä¸ªæ„é€ å‡½æ•°å³å¯ï¼Œç­”æ¡ˆçš„ super(capacity, 0.75F, true);ï¼Œæ²¡çœ‹è¿‡æºç çš„å°ä¼™ä¼´å¯èƒ½ä¸å¤ªæ¸…æ¥šè¿™ä¸ªæ„é€ å‡½æ•°ï¼Œè¿™å°±æ˜¯æˆ‘ä¸Šæ–‡è®²çš„ LinkedHashMap ä¸­çš„å¸¸ç”¨çš„ç¬¬äºŒä¸ªæ„é€ æ–¹æ³•ï¼Œå…·ä½“å¤§å®¶å¯ä»¥çœ‹æˆ‘ä¸Šé¢ä»£ç çš„æ³¨é‡Šï¼ è‡³æ­¤ï¼Œå¤§åŠŸå‘Šæˆï¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344class LRUCache extends LinkedHashMap&lt;Integer, Integer&gt;&#123; private int capacity; public LRUCache(int capacity) &#123; super(capacity, 0.75F, true); this.capacity = capacity; &#125; public int get(int key) &#123; return super.getOrDefault(key, -1); &#125; // è¿™ä¸ªå¯ä¸å†™ public void put(int key, int value) &#123; super.put(key, value); &#125; @Override protected boolean removeEldestEntry(Map.Entry&lt;Integer, Integer&gt; eldest) &#123; return size() &gt; capacity; &#125;&#125; 148. æ’åºé“¾è¡¨é¢˜ç›®åœ¨ O(n log n) æ—¶é—´å¤æ‚åº¦å’Œå¸¸æ•°çº§ç©ºé—´å¤æ‚åº¦ä¸‹ï¼Œå¯¹é“¾è¡¨è¿›è¡Œæ’åºã€‚ ç¤ºä¾‹ 1: 12è¾“å…¥: 4-&gt;2-&gt;1-&gt;3è¾“å‡º: 1-&gt;2-&gt;3-&gt;4 ç¤ºä¾‹ 2: 12è¾“å…¥: -1-&gt;5-&gt;3-&gt;4-&gt;0è¾“å‡º: -1-&gt;0-&gt;3-&gt;4-&gt;5 æ€è·¯ é¢˜ç›®è¦æ±‚æ—¶é—´ç©ºé—´å¤æ‚åº¦åˆ†åˆ«ä¸º O(nlogn) å’Œ O(1)ï¼Œæ ¹æ®æ—¶é—´å¤æ‚åº¦æˆ‘ä»¬è‡ªç„¶æƒ³åˆ°äºŒåˆ†æ³•ï¼Œä»è€Œè”æƒ³åˆ°å½’å¹¶æ’åºï¼› å¯¹æ•°ç»„åšå½’å¹¶æ’åºçš„ç©ºé—´å¤æ‚åº¦ä¸º O(n) ï¼Œåˆ†åˆ«ç”±æ–°å¼€è¾Ÿæ•°ç»„ O(n) å’Œé€’å½’å‡½æ•°è°ƒç”¨ O(logn) ç»„æˆï¼Œè€Œæ ¹æ®é“¾è¡¨ç‰¹æ€§ï¼š æ•°ç»„é¢å¤–ç©ºé—´ï¼šé“¾è¡¨å¯ä»¥é€šè¿‡ä¿®æ”¹å¼•ç”¨æ¥æ›´æ”¹èŠ‚ç‚¹é¡ºåºï¼Œæ— éœ€åƒæ•°ç»„ä¸€æ ·å¼€è¾Ÿé¢å¤–ç©ºé—´ï¼› é€’å½’é¢å¤–ç©ºé—´ï¼šé€’å½’è°ƒç”¨å‡½æ•°å°†å¸¦æ¥ O(logn) çš„ç©ºé—´å¤æ‚åº¦ï¼Œå› æ­¤è‹¥å¸Œæœ›è¾¾åˆ° O(1) ç©ºé—´å¤æ‚åº¦ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨é€’å½’ã€‚ ã€è¿™é‡Œå’±è¿˜æ˜¯ç”¨ä¸‹é€’å½’ï¼Œé™ä½éš¾åº¦ï¼ã€‘ é€šè¿‡é€’å½’å®ç°é“¾è¡¨å½’å¹¶æ’åºï¼Œæœ‰ä»¥ä¸‹ä¸¤ä¸ªç¯èŠ‚ï¼š åˆ†å‰² cut ç¯èŠ‚ï¼š æ‰¾åˆ°å½“å‰é“¾è¡¨ä¸­ç‚¹ï¼Œå¹¶ä»ä¸­ç‚¹å°†é“¾è¡¨æ–­å¼€ï¼ˆä»¥ä¾¿åœ¨ä¸‹æ¬¡é€’å½’ cut æ—¶ï¼Œé“¾è¡¨ç‰‡æ®µæ‹¥æœ‰æ­£ç¡®è¾¹ç•Œï¼‰ï¼› æˆ‘ä»¬ä½¿ç”¨ fast,slow å¿«æ…¢åŒæŒ‡é’ˆæ³•ï¼Œå¥‡æ•°ä¸ªèŠ‚ç‚¹æ‰¾åˆ°ä¸­ç‚¹ï¼Œå¶æ•°ä¸ªèŠ‚ç‚¹æ‰¾åˆ°ä¸­å¿ƒå·¦è¾¹çš„èŠ‚ç‚¹ã€‚ æ‰¾åˆ°ä¸­ç‚¹ slow åï¼Œæ‰§è¡Œ slow.next = None å°†é“¾è¡¨åˆ‡æ–­ã€‚ é€’å½’åˆ†å‰²æ—¶ï¼Œè¾“å…¥å½“å‰é“¾è¡¨å·¦ç«¯ç‚¹ head å’Œä¸­å¿ƒèŠ‚ç‚¹ slow çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ tmp(å› ä¸ºé“¾è¡¨æ˜¯ä» slow åˆ‡æ–­çš„)ã€‚ cut é€’å½’ç»ˆæ­¢æ¡ä»¶ï¼š å½“head.next == Noneæ—¶ï¼Œè¯´æ˜åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹äº†ï¼Œç›´æ¥è¿”å›æ­¤èŠ‚ç‚¹ã€‚ åˆå¹¶ merge ç¯èŠ‚ï¼š å°†ä¸¤ä¸ªæ’åºé“¾è¡¨åˆå¹¶ï¼Œè½¬åŒ–ä¸ºä¸€ä¸ªæ’åºé“¾è¡¨ã€‚ åŒæŒ‡é’ˆæ³•åˆå¹¶ï¼Œå»ºç«‹è¾…åŠ©ListNode h ä½œä¸ºå¤´éƒ¨ã€‚ è®¾ç½®ä¸¤æŒ‡é’ˆ left, right åˆ†åˆ«æŒ‡å‘ä¸¤é“¾è¡¨å¤´éƒ¨ï¼Œæ¯”è¾ƒä¸¤æŒ‡é’ˆå¤„èŠ‚ç‚¹å€¼å¤§å°ï¼Œç”±å°åˆ°å¤§åŠ å…¥åˆå¹¶é“¾è¡¨å¤´éƒ¨ï¼ŒæŒ‡é’ˆäº¤æ›¿å‰è¿›ï¼Œç›´è‡³æ·»åŠ å®Œä¸¤ä¸ªé“¾è¡¨ã€‚ è¿”å›è¾…åŠ©ListNode h ä½œä¸ºå¤´éƒ¨çš„ä¸‹ä¸ªèŠ‚ç‚¹ h.nextã€‚ æ—¶é—´å¤æ‚åº¦ O(l + r)ï¼Œl, r åˆ†åˆ«ä»£è¡¨ä¸¤ä¸ªé“¾è¡¨é•¿åº¦ã€‚ å½“é¢˜ç›®è¾“å…¥çš„ head == None æ—¶ï¼Œç›´æ¥è¿”å›Noneã€‚ ä»£ç 1234567891011121314151617181920212223242526272829class Solution &#123; public ListNode sortList(ListNode head) &#123; if (head == null || head.next == null) return head; ListNode fast = head.next, slow = head; while (fast != null &amp;&amp; fast.next != null) &#123; slow = slow.next; fast = fast.next.next; &#125; ListNode tmp = slow.next; slow.next = null; ListNode left = sortList(head); ListNode right = sortList(tmp); ListNode h = new ListNode(0); ListNode res = h; while (left != null &amp;&amp; right != null) &#123; if (left.val &lt; right.val) &#123; h.next = left; left = left.next; &#125; else &#123; h.next = right; right = right.next; &#125; h = h.next; &#125; h.next = left != null ? left : right; return res.next; &#125;&#125; ä½œè€…ï¼šjydé“¾æ¥ï¼šhttps://leetcode-cn.com/problems/sort-list/solution/sort-list-gui-bing-pai-xu-lian-biao-by-jyd/æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ ä¸ç¬¦åˆæ—¶é—´å¤æ‚åº¦çš„è·¯è¿‡ä¸€ä¸‹ï¼š 123456789101112131415161718public ListNode sortList(ListNode head) &#123; List&lt;Integer&gt; list = new ArrayList&lt;&gt;(); while (head !=null) &#123; list.add(head.val); head = head.next; &#125; Collections.sort(list); return createLinkedList(list); &#125; // listé€’å½’è½¬é“¾è¡¨ private ListNode createLinkedList(List&lt;Integer&gt; data) &#123; if(data.isEmpty()) &#123; //å¦‚æœä¸ºç©ºè¿”å›null return null; &#125; ListNode firstNode = new ListNode(data.get(0)); //æ¯æ¬¡å–ç¬¬ä¸€ä¸ªå…ƒç´  firstNode.next = createLinkedList(data.subList(1, data.size()));//ç¬¬äºŒä¸ªå…ƒç´ ä»ä¸‹æ ‡ä¸º1å¼€å§‹å–ä½™ä¸‹list return firstNode; &#125; 437. è·¯å¾„æ€»å’Œ IIIé¢˜ç›®ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œå®ƒçš„æ¯ä¸ªç»“ç‚¹éƒ½å­˜æ”¾ç€ä¸€ä¸ªæ•´æ•°å€¼ã€‚ æ‰¾å‡ºè·¯å¾„å’Œç­‰äºç»™å®šæ•°å€¼çš„è·¯å¾„æ€»æ•°ã€‚ è·¯å¾„ä¸éœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¹Ÿä¸éœ€è¦åœ¨å¶å­èŠ‚ç‚¹ç»“æŸï¼Œä½†æ˜¯è·¯å¾„æ–¹å‘å¿…é¡»æ˜¯å‘ä¸‹çš„ï¼ˆåªèƒ½ä»çˆ¶èŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹ï¼‰ã€‚ äºŒå‰æ ‘ä¸è¶…è¿‡1000ä¸ªèŠ‚ç‚¹ï¼Œä¸”èŠ‚ç‚¹æ•°å€¼èŒƒå›´æ˜¯ [-1000000,1000000] çš„æ•´æ•°ã€‚ ç¤ºä¾‹ï¼š 123456789101112131415root = [10,5,-3,3,2,null,11,3,-2,null,1], sum = 8 10 / \ 5 -3 / \ \ 3 2 11 / \ \3 -2 1è¿”å› 3ã€‚å’Œç­‰äº 8 çš„è·¯å¾„æœ‰:1. 5 -&gt; 32. 5 -&gt; 2 -&gt; 13. -3 -&gt; 11 æ€è·¯å›æº¯ï¼Œåªä¸è¿‡è¿™é‡Œçš„é€‰æ‹©æ¡ä»¶ï¼Œæ¯”è¾ƒç‰¹æ®Šï¼Œå¹¶ä¸” åšé€‰æ‹© å’Œ æ’¤é”€é€‰æ‹© å¾—ç¨å¾®æ³¨æ„ä¸€ä¸‹ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥ç”¨ if elseã€‚ ä»£ç 12345678910111213141516171819202122232425262728293031323334353637/** * Definition for a binary tree node. * public class TreeNode &#123; * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public int res = 0; public int pathSum(TreeNode root, int sum) &#123; if (root == null) return res; if (root != null) &#123; res = path(root,sum,0) + res; &#125; if(root.left != null) pathSum(root.left,sum); if(root.right != null) pathSum(root.right,sum); return res; &#125; public int path(TreeNode root, int sum,int count) &#123; if (root == null) return count; sum = sum - root.val; if (sum == 0) &#123; count++; &#125; if (root.left != null) &#123; count = path(root.left, sum, count); &#125; if (root.right != null) &#123; count = path(root.right, sum, count); &#125; return count; &#125;&#125; 124. äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œé¢˜ç›®ç»™å®šä¸€ä¸ªéç©ºäºŒå‰æ ‘ï¼Œè¿”å›å…¶æœ€å¤§è·¯å¾„å’Œã€‚ æœ¬é¢˜ä¸­ï¼Œè·¯å¾„è¢«å®šä¹‰ä¸ºä¸€æ¡ä»æ ‘ä¸­ä»»æ„èŠ‚ç‚¹å‡ºå‘ï¼Œè¾¾åˆ°ä»»æ„èŠ‚ç‚¹çš„åºåˆ—ã€‚è¯¥è·¯å¾„è‡³å°‘åŒ…å«ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸”ä¸ä¸€å®šç»è¿‡æ ¹èŠ‚ç‚¹ã€‚ ç¤ºä¾‹ 1: 1234567è¾“å…¥: [1,2,3] 1 / \ 2 3è¾“å‡º: 6 ç¤ºä¾‹ 2: 123456789è¾“å…¥: [-10,9,20,null,null,15,7] -10 / \ 9 20 / \ 15 7è¾“å‡º: 42 æ€è·¯è¿™é¢˜è¿˜æ˜¯æŒºéš¾çš„ï¼Œè¦æ±‚æœ€å¤§è·¯å¾„å’Œï¼Œå¯ä»¥é‡‡ç”¨é€’å½’ï¼Œé€’å½’å°±æ˜¯ä¸‰éƒ¨æ›²ï¼š 1ã€ç¡®å®šé€’å½’å‡ºå£ï¼Œè¿™ä¸ªç®€å•ï¼Œroot == null å³é€€å‡º 2ã€ç¡®å®šè¿”å›å€¼ï¼Œè¿™ä¸ªæ˜¯æœ¬é¢˜æœ€éš¾çš„ï¼Œè¿”å›çš„æ˜¯ä»¥è¯¥èŠ‚ç‚¹ç»“å°¾çš„æœ€å¤§è·¯å¾„å’Œï¼ï¼ï¼ 3ã€ä¸€çº§é€’å½’éœ€è¦åšçš„äº‹ï¼Œå…¶å®å°±æ˜¯å»ç®—æœ€å¤§çš„è·¯å¾„å’Œï¼Œè¿™ä¸ªå¾ˆç®€å•ï¼Œåœ¨äºŒå‰æ ‘ä¸­ï¼Œä¸€çº§é€’å½’å…¶å®ä¹Ÿå°±æ˜¯ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯æ ¹èŠ‚ç‚¹ï¼Œå·¦å­æ ‘èŠ‚ç‚¹ï¼Œå³å­æ ‘èŠ‚ç‚¹ï¼Œæ—¢ç„¶æ¯ä¸ªèŠ‚ç‚¹è¿”å›çš„æ˜¯ ä»¥è¯¥èŠ‚ç‚¹ç»“å°¾çš„æœ€å¤§è·¯å¾„å’Œï¼Œåˆ™æˆ‘ä»¬å¯ä»¥åœ¨æ¯çº§é€’å½’æ—¶å»æ›´æ–°ä¸€ä¸‹æœ€å¤§çš„è·¯å¾„å’Œï¼Œå³ å·¦å­æ ‘èŠ‚ç‚¹è¿”å›æ¥çš„ä»¥å…¶èŠ‚ç‚¹ç»“å°¾çš„æœ€å¤§è·¯å¾„å’Œ + æ ¹èŠ‚ç‚¹çš„å€¼ + å³å­æ ‘èŠ‚ç‚¹è¿”å›çš„ä»¥è¯¥èŠ‚ç‚¹ç»“å°¾çš„æœ€å¤§è·¯å¾„å’Œã€‚ ä»£ç 1234567891011121314151617181920212223242526class Solution &#123; int max_sum = Integer.MIN_VALUE; public int max_gain(TreeNode node) &#123; if (node == null) return 0; // max sum on the left and right sub-trees of node int left_gain = Math.max(max_gain(node.left), 0); int right_gain = Math.max(max_gain(node.right), 0); // the price to start a new path where `node` is a highest node int price_newpath = node.val + left_gain + right_gain; // update max_sum if it's better to start a new path max_sum = Math.max(max_sum, price_newpath); // for recursion : // return the max gain if continue the same path return node.val + Math.max(left_gain, right_gain); &#125; public int maxPathSum(TreeNode root) &#123; max_gain(root); return max_sum; &#125;&#125; 48. æ—‹è½¬å›¾åƒé¢˜ç›®ç»™å®šä¸€ä¸ª n Ã— n çš„äºŒç»´çŸ©é˜µè¡¨ç¤ºä¸€ä¸ªå›¾åƒã€‚ å°†å›¾åƒé¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦ã€‚ è¯´æ˜ï¼š ä½ å¿…é¡»åœ¨åŸåœ°æ—‹è½¬å›¾åƒï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦ç›´æ¥ä¿®æ”¹è¾“å…¥çš„äºŒç»´çŸ©é˜µã€‚è¯·ä¸è¦ä½¿ç”¨å¦ä¸€ä¸ªçŸ©é˜µæ¥æ—‹è½¬å›¾åƒã€‚ ç¤ºä¾‹ 1: 12345678910111213ç»™å®š matrix = [ [1,2,3], [4,5,6], [7,8,9]],åŸåœ°æ—‹è½¬è¾“å…¥çŸ©é˜µï¼Œä½¿å…¶å˜ä¸º:[ [7,4,1], [8,5,2], [9,6,3]] ç¤ºä¾‹ 2: 123456789101112131415ç»™å®š matrix =[ [ 5, 1, 9,11], [ 2, 4, 8,10], [13, 3, 6, 7], [15,14,12,16]], åŸåœ°æ—‹è½¬è¾“å…¥çŸ©é˜µï¼Œä½¿å…¶å˜ä¸º:[ [15,13, 2, 5], [14, 3, 4, 1], [12, 6, 8, 9], [16, 7,10,11]] æ€è·¯ç¿»è½¬ + è½¬ç½® ä»£ç 12345678910111213141516171819202122232425//1.å…ˆè½¬ç½®å†ç¿»è½¬ï¼Œæ³¨æ„è¿™é‡Œç¿»è½¬æ˜¯ è¡Œ ç¿»è½¬ï¼Œæ¯”å¦‚ ç¬¬ä¸€è¡Œ 1 2 3ï¼Œè¡Œç¿»è½¬å˜ä¸º 3 2 1//2.å…ˆç¿»è½¬å†è½¬ç½®ï¼Œè¿™é‡Œçš„ç¿»è½¬æ˜¯ åˆ— ç¿»è½¬ï¼Œæ¯”å¦‚ç¬¬ä¸€åˆ— 1 4 7ï¼Œç¿»è½¬ä¸º 7 4 1//3.å¦‚æœæ˜¯é€†æ—¶é’ˆï¼Œåˆ™æ˜¯æŒ‰ç…§å‰¯å¯¹è§’çº¿è¿›è¡Œè½¬ç½®class Solution &#123; public void rotate(int[][] matrix) &#123; int n = matrix.length; // è¿™é‡Œæ˜¯å…ˆè½¬ç½®å†ç¿»è½¬ for (int i = 0; i &lt; n; i++) &#123; for (int j = i; j &lt; n; j++) &#123; int tmp = matrix[j][i]; matrix[j][i] = matrix[i][j]; matrix[i][j] = tmp; &#125; &#125; // è¡Œç¿»è½¬ 1 2 3å˜ä¸º 3 2 1 for (int i = 0; i &lt; n; i++) &#123; for (int j = 0; j &lt; n / 2; j++) &#123; int tmp = matrix[i][j]; matrix[i][j] = matrix[i][n - j - 1]; matrix[i][n - j - 1] = tmp; &#125; &#125; &#125;&#125; 49. å­—æ¯å¼‚ä½è¯åˆ†ç»„é¢˜ç›®ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå°†å­—æ¯å¼‚ä½è¯ç»„åˆåœ¨ä¸€èµ·ã€‚å­—æ¯å¼‚ä½è¯æŒ‡å­—æ¯ç›¸åŒï¼Œä½†æ’åˆ—ä¸åŒçš„å­—ç¬¦ä¸²ã€‚ ç¤ºä¾‹: 123456è¾“å…¥: ["eat", "tea", "tan", "ate", "nat", "bat"],è¾“å‡º:[ ["ate","eat","tea"], ["nat","tan"], ["bat"] è¯´æ˜ï¼š æ‰€æœ‰è¾“å…¥å‡ä¸ºå°å†™å­—æ¯ã€‚ ä¸è€ƒè™‘ç­”æ¡ˆè¾“å‡ºçš„é¡ºåºã€‚ æ€è·¯ æ¯ä¸ªå•è¯è¿›è¡Œå­—æ¯æ’åºï¼Œæ’å®Œåºåå­˜å…¥mapä¸­ï¼Œkeyç›¸åŒçš„å­˜å…¥åŒä¸€ä¸ªlistä¸­å³å¯ã€‚ æ¯ä¸ªå•è¯éƒ½æ˜¯ç”± 26 ä¸ªå­—æ¯ç»„æˆçš„ï¼Œè¿™ä¸ªæ–¹æ³•æ— éœ€å¯¹æ¯ä¸ªå•è¯çš„å­—æ¯è¿›è¡Œæ’åºï¼Œç±»ä¼¼äºæ¡¶çš„æ¦‚å¿µï¼Œæ¯ä¸ªå•è¯ä¸åŒçš„å­—ç¬¦æ”¾å…¥ 26 ä¸ªæ¡¶ä¸­ï¼Œå­—æ¯å¼‚ä½è¯å¯¹åº”çš„æ¡¶ä¸­çš„æ•°å€¼åº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œå°†æ¡¶ä¸­æ•°æ®ç›¸åŒçš„å­—æ¯å½“æˆä¸€ä¸ªkeyï¼Œå­˜å…¥mapä¸­ï¼Œç„¶åkeyç›¸åŒçš„å­˜å…¥åŒä¸€ä¸ªlistä¸­ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºè¿™ç§æ–¹æ³•å¯¹å­—æ¯å¾ˆå¤šå¾ˆå¤šçš„å•è¯æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸Šæ›´å°ã€‚ ä»£ç æ€è·¯ä¸€ 1234567891011121314class Solution &#123; public List&lt;List&lt;String&gt;&gt; groupAnagrams(String[] strs) &#123; if (strs.length == 0) return new ArrayList(); Map&lt;String, List&gt; ans = new HashMap&lt;String, List&gt;(); for (String s : strs) &#123; char[] ca = s.toCharArray(); Arrays.sort(ca); String key = String.valueOf(ca); if (!ans.containsKey(key)) ans.put(key, new ArrayList()); ans.get(key).add(s); &#125; return new ArrayList(ans.values()); &#125;&#125; æ€è·¯äºŒ 123456789101112131415161718192021class Solution &#123; public List&lt;List&lt;String&gt;&gt; groupAnagrams(String[] strs) &#123; if (strs.length == 0) return new ArrayList(); Map&lt;String, List&gt; ans = new HashMap&lt;String, List&gt;(); int[] count = new int[26]; for (String s : strs) &#123; Arrays.fill(count, 0); for (char c : s.toCharArray()) count[c - 'a']++; StringBuilder sb = new StringBuilder(""); for (int i = 0; i &lt; 26; i++) &#123; sb.append('#'); sb.append(count[i]); &#125; String key = sb.toString(); if (!ans.containsKey(key)) ans.put(key, new ArrayList()); ans.get(key).add(s); &#125; return new ArrayList(ans.values()); &#125;&#125; 136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—é¢˜ç›®ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚ è¯´æ˜ï¼š ä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ ç¤ºä¾‹ 1: 12è¾“å…¥: [2,2,1]è¾“å‡º: 1 ç¤ºä¾‹ 2: 12è¾“å…¥: [4,1,2,1,2]è¾“å‡º: 4 æ€è·¯ æ‹¿åˆ°æ‰‹ï¼Œè¦æ±‚æ—¶é—´å¤æ‚åº¦åœ¨ O( n )ï¼Œç¬¬ä¸€ååº”æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨ HashMap æ¥å®Œæˆï¼Œéå†ä¸€éæ•°ç»„ï¼Œç„¶åæ‰¾åˆ° value == 1çš„å³å¯ï¼Œæ—¶é—´å¤æ‚åº¦ O(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(n)ã€‚ ä½†æ˜¯é¢˜ç›®è¦æ±‚ä¸ä½¿ç”¨é¢å¤–ç©ºé—´ï¼Œå³ç©ºé—´å¤æ‚åº¦ O(1)ï¼Œè¿™ä¸ªå°±å¾ˆéš¾äº†ï¼Œåªèƒ½æš´åŠ›æ³•ï¼Œå°±æ˜¯æ¯æŸ¥ä¸€ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬å°±å»å‰©ä¸‹çš„æ•°å­—ä¸­å»æ‰¾ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå³ä½¿æˆ‘ä»¬éœ€è¦çš„ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯O(nÂ²)ã€‚ æœ€åä¸€ä¸ªæ˜¯æœ€éªšçš„ï¼Œç›´æ¥å¼‚æˆ–å°±è¡Œäº†â€¦ ä»£ç 123456789class Solution &#123; public int singleNumber(int[] nums) &#123; int a = nums[0]; for(int i = 1;i &lt; nums.length;i++)&#123; a = a ^ nums[i]; &#125; return a; &#125;&#125; 55. è·³è·ƒæ¸¸æˆé¢˜ç›®ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚ åˆ¤æ–­ä½ æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚ ç¤ºä¾‹ 1: 123è¾“å…¥: [2,3,1,1,4]è¾“å‡º: trueè§£é‡Š: æˆ‘ä»¬å¯ä»¥å…ˆè·³ 1 æ­¥ï¼Œä»ä½ç½® 0 åˆ°è¾¾ ä½ç½® 1, ç„¶åå†ä»ä½ç½® 1 è·³ 3 æ­¥åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚ ç¤ºä¾‹ 2: 123è¾“å…¥: [3,2,1,0,4]è¾“å‡º: falseè§£é‡Š: æ— è®ºæ€æ ·ï¼Œä½ æ€»ä¼šåˆ°è¾¾ç´¢å¼•ä¸º 3 çš„ä½ç½®ã€‚ä½†è¯¥ä½ç½®çš„æœ€å¤§è·³è·ƒé•¿åº¦æ˜¯ 0 ï¼Œ æ‰€ä»¥ä½ æ°¸è¿œä¸å¯èƒ½åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚ æ€è·¯ å›æº¯ è´ªå¿ƒç®—æ³•ï¼Œæ¯æ¬¡éƒ½æ‰¾åˆ°èƒ½è·³åˆ°çš„æœ€è¿œè·ç¦»ï¼Œç„¶ååœ¨åŸåœ°åˆ°æœ€è¿œè·ç¦»ä¹‹é—´éå†ï¼Œçœ‹èƒ½å¦ç»§ç»­è·³åˆ°æ›´è¿œï¼Œå¦‚æœå¯ä»¥ï¼Œå°±æ›´æ–°æœ€è¿œè·ç¦»å€¼ï¼Œå¦‚æœæœ€è¿œè·ç¦»å€¼èƒ½å¤Ÿä¸å°äºæœ€åä¸€ä¸ªä½ç½®ï¼Œè¯´æ˜å¯ä»¥è·³åˆ°ï¼Œå¦åˆ™ä¸è¡Œã€‚ è¯„è®ºåŒºçœ‹åˆ°çš„ï¼Œå…¶å®è·Ÿè´ªå¿ƒç®—æ³•æ€æƒ³ç±»ä¼¼ï¼Œä½†æ˜¯åˆæœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå°±æ˜¯è®°å½•æ¯ä¸ªèŠ‚ç‚¹èƒ½è·³åˆ°çš„æœ€è¿œè·ç¦»ï¼Œä¸æ–­æ›´æ–°æœ€è¿œè·ç¦»ï¼Œå¦‚æœæœ‰æŸä¸ªèŠ‚ç‚¹çš„ä¸‹æ ‡æ¯”kå€¼å¤§ï¼Œè¯´æ˜åˆ°ä¸äº†è¯¥èŠ‚ç‚¹ï¼Œå³æœ‰ä¸ªæŒ¡æ¿æŒ¡åœ¨äº†è¿™ä¸ªèŠ‚ç‚¹ä¹‹å‰ï¼Œè¿‡ä¸æ¥ï¼Œæ­¤æ—¶å°±æ˜¯æ— æ³•åˆ°è¾¾æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœå…¨ç¨‹éƒ½æ²¡æœ‰è¢«æŒ¡æ¿æŒ¡ä½ï¼Œä¸”æŒ¡æ¿çš„å€¼è¿‡äº†æœ€åä¸€ä¸ªä½ç½®ï¼Œå³å¯ä»¥åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚ ä»£ç  å›æº¯ã€è¶…å‡ºæ—¶é—´é™åˆ¶ã€‘ 123456789101112131415161718192021class Solution &#123; public boolean canJump(int[] nums) &#123; if(nums.length == 0) return true; return canJumpByRecursion_In(0, nums); &#125; private boolean canJumpByRecursion_In(int position,int[] nums) &#123; if (position == nums.length - 1) &#123; return true; &#125; int furthestJump = Math.min(position + nums[position], nums.length - 1); for (int nextPosition = position + 1; nextPosition &lt;= furthestJump; nextPosition++) &#123; if (canJumpByRecursion_In(nextPosition, nums)) &#123; return true; &#125; &#125; return false; &#125;&#125; è´ªå¿ƒ 12345678910class Solution &#123; public boolean canJump(int[] nums) &#123; int furthest = 0; for(int i = 0;i &lt;= furthest;i++)&#123; if(furthest &gt;= nums.length-1) return true; if(i + nums[i] &gt; furthest) furthest = i + nums[i]; &#125; return false; &#125;&#125; è¯„è®ºåŒºç¥ä»™ 1234567891011class Solution &#123; public boolean canJump(int[] nums) &#123; int furthest = 0; for(int i = 0;i &lt;= nums.length-1;i++)&#123; if(furthest &gt;= nums.length-1) break; if(i &gt; furthest) return false; if(i + nums[i] &gt; furthest) furthest = i + nums[i]; &#125; return true; &#125;&#125; 56. åˆå¹¶åŒºé—´é¢˜ç›®ç»™å‡ºä¸€ä¸ªåŒºé—´çš„é›†åˆï¼Œè¯·åˆå¹¶æ‰€æœ‰é‡å çš„åŒºé—´ã€‚ ç¤ºä¾‹ 1: 123è¾“å…¥: [[1,3],[2,6],[8,10],[15,18]]è¾“å‡º: [[1,6],[8,10],[15,18]]è§£é‡Š: åŒºé—´ [1,3] å’Œ [2,6] é‡å , å°†å®ƒä»¬åˆå¹¶ä¸º [1,6]. ç¤ºä¾‹ 2: 123è¾“å…¥: [[1,4],[4,5]]è¾“å‡º: [[1,5]]è§£é‡Š: åŒºé—´ [1,4] å’Œ [4,5] å¯è¢«è§†ä¸ºé‡å åŒºé—´ã€‚ æ€è·¯å…ˆæŒ‰é¦–ä½ç½®è¿›è¡Œæ’åº; æ¥ä¸‹æ¥,å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªåŒºé—´æ˜¯å¦é‡å å‘¢?æ¯”å¦‚ a = [1,4],b = [2,3] å½“ a[1] &gt;= b[0] è¯´æ˜ä¸¤ä¸ªåŒºé—´æœ‰é‡å  ä½†æ˜¯å¦‚ä½•æŠŠè¿™ä¸ªåŒºé—´æ‰¾å‡ºæ¥å‘¢? å·¦è¾¹ä½ç½®ä¸€å®šæ˜¯ç¡®å®šï¼Œå°±æ˜¯ a[0]ï¼Œè€Œå³è¾¹ä½ç½®æ˜¯ max(a[1], b[1]) æ‰€ä»¥,æˆ‘ä»¬å°±èƒ½æ‰¾å‡ºæ•´ä¸ªåŒºé—´ä¸º:[1,4] ä»£ç 12345678910111213141516171819202122232425262728class Solution &#123; public int[][] merge(int[][] intervals) &#123; LinkedList&lt;int[]&gt; res = new LinkedList&lt;&gt;(); if (intervals == null || intervals.length == 0) &#123; return res.toArray(new int[0][]); &#125; // æŒ‰æ•°ç»„é¦–å…ƒç´ æ’åº Arrays.sort(intervals, new Comparator&lt;int[]&gt;() &#123; @Override public int compare(int[] o1, int[] o2) &#123; return o1[0] - o2[0]; &#125; &#125;); // å¦‚æœéå†åˆ°çš„æ•°ç»„çš„åˆå§‹å€¼ æ¯” res çš„æœ€æ–°æ·»åŠ çš„æ•°ç»„çš„æœ«å°¾å€¼è¿˜å¤§ï¼Œè¯´æ˜æ²¡æœ‰é‡å ï¼Œå¯ä»¥ç›´æ¥æ·»åŠ  // å¦åˆ™ï¼Œç›´æ¥æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„çš„æœ«å°¾å€¼å°±è¡Œï¼Œå› ä¸ºæ˜¯æŒ‰æ•°ç»„é¦–å…ƒç´ æ’å¥½åºçš„ï¼Œæ‰€ä»¥åªéœ€è¦è€ƒè™‘æœ«å°¾å€¼æ›¿æ¢å°±è¡Œ for (int i = 0; i &lt; intervals.length; i++) &#123; if (res.isEmpty() || res.getLast()[1] &lt; intervals[i][0]) &#123; res.add(intervals[i]); &#125; else &#123; res.getLast()[1] = Math.max(res.getLast()[1], intervals[i][1]); &#125; &#125; // list.toArray(new int[0][])ï¼Œè¿™æ˜¯æ•°ç»„é›†ä½“å¼ºè½¬ç±»å‹çš„æ–¹æ³• // new int[0][]æ˜¯å‘Šè¯‰ç¨‹åºéœ€è¦è½¬æˆè¿™æ ·çš„ç±»å‹ // é•¿åº¦å¤šå¤§æ˜¯æ— æ‰€è°“çš„ï¼Œå› ä¸ºè½¬æ¢åçš„é•¿åº¦æ˜¯æŒ‰ç…§ä½ çš„listé•¿åº¦æ¥å®šçš„ return res.toArray(new int[0][0]); &#125;&#125; 75. é¢œè‰²åˆ†ç±»é¢˜ç›®ç»™å®šä¸€ä¸ªåŒ…å«çº¢è‰²ã€ç™½è‰²å’Œè“è‰²ï¼Œä¸€å…± n ä¸ªå…ƒç´ çš„æ•°ç»„ï¼ŒåŸåœ°å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œä½¿å¾—ç›¸åŒé¢œè‰²çš„å…ƒç´ ç›¸é‚»ï¼Œå¹¶æŒ‰ç…§çº¢è‰²ã€ç™½è‰²ã€è“è‰²é¡ºåºæ’åˆ—ã€‚ æ­¤é¢˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° 0ã€ 1 å’Œ 2 åˆ†åˆ«è¡¨ç¤ºçº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€‚ æ³¨æ„:ä¸èƒ½ä½¿ç”¨ä»£ç åº“ä¸­çš„æ’åºå‡½æ•°æ¥è§£å†³è¿™é“é¢˜ã€‚ ç¤ºä¾‹: 12è¾“å…¥: [2,0,2,1,1,0]è¾“å‡º: [0,0,1,1,2,2] è¿›é˜¶ï¼š ä¸€ä¸ªç›´è§‚çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨è®¡æ•°æ’åºçš„ä¸¤è¶Ÿæ‰«æç®—æ³•ã€‚é¦–å…ˆï¼Œè¿­ä»£è®¡ç®—å‡º0ã€1 å’Œ 2 å…ƒç´ çš„ä¸ªæ•°ï¼Œç„¶åæŒ‰ç…§0ã€1ã€2çš„æ’åºï¼Œé‡å†™å½“å‰æ•°ç»„ã€‚ ä½ èƒ½æƒ³å‡ºä¸€ä¸ªä»…ä½¿ç”¨å¸¸æ•°ç©ºé—´çš„ä¸€è¶Ÿæ‰«æç®—æ³•å—ï¼Ÿ æ€è·¯ä¸‰è·¯å½’å¹¶ï¼Œå…¶å®ä¹Ÿæ˜¯ Arrays.sort() è¿™é‡Œé‡‡ç”¨çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯ä¸‰è‰²æ——çš„è§£å†³æ–¹æ¡ˆã€‚ ä¸‰ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æ˜¯ leftã€curã€rightã€‚leftæŒ‡å‘æ•°ç»„æœ€å·¦ä¾§ï¼ŒrightæŒ‡å‘æ•°ç»„æœ€å³ä¾§ï¼Œcurä»£è¡¨å½“å‰æ­£åœ¨éå†çš„æ•°ç»„å…ƒç´ ï¼Œå½“ cur éå†çš„å…ƒç´ æ˜¯ 0 æ—¶ï¼Œå°† cur æŒ‡å‘çš„å…ƒç´  ä¸ p0 æŒ‡å‘çš„å…ƒç´ äº¤æ¢ï¼Œç„¶å cur++ï¼Œp0++ã€‚å½“ cur éå†çš„å…ƒç´ æ˜¯ 1 æ—¶ï¼Œcur++ã€‚å½“ cur éå†çš„å…ƒç´ æ˜¯ 2 æ—¶ï¼Œå°† cur æŒ‡å‘çš„å…ƒç´ ä¸ p2 æŒ‡å‘çš„å…ƒç´ äº¤æ¢ï¼Œç„¶å p2â€“ï¼Œcurä¸åŠ¨ï¼ï¼ï¼ç›´åˆ° cur &gt; p2 ,å¾ªç¯ç»“æŸï¼ˆå³å…¨éƒ¨æ‰«æå®Œæ¯•ï¼‰ã€‚ å¯¹äºä»¥ä¸Šï¼Œæœ‰ä¸€ä¸ªéš¾ç‚¹ï¼ ä¸ºä½• cur åœ¨ä¸ p0 äº¤æ¢æ—¶éœ€è¦ p0++ï¼Œcur++ï¼›è€Œåœ¨ cur ä¸ p2 äº¤æ¢æ—¶ï¼Œå´åªéœ€è¦ p2â€“ï¼Ÿ å¯¹äºä¸Šé¢è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ç§è§£é‡Šæ€è·¯ï¼š1.cur ä¸ p0 äº¤æ¢éœ€è¦è‡ªåŠ ï¼Œæ˜¯å› ä¸ºå…¶å·¦è¾¹å·²ç»æ‰«æè¿‡äº†ï¼Œäº¤æ¢è¿‡æ¥çš„å€¼ä¹Ÿæ˜¯ä¹‹å‰å°±æ‰«æè¿‡äº†çš„ï¼Œè€Œå³è¾¹ä¸æ˜¯ï¼Œ p2 däº¤æ¢è¿‡æ¥çš„å€¼ cur å¹¶æ²¡æœ‰æ‰«æè¿‡ï¼›2.å½“ cur ä¸ p0 ä¸æ˜¯ä¸€ä¸ªæŒ‡å‘åŒä¸€ä¸ªç´¢å¼•å€¼æ—¶ï¼Œé‚£ cur æŒ‡å‘çš„ç´¢å¼•å€¼å¦‚æœå‘ç”Ÿäº¤æ¢ï¼Œé‚£äº¤æ¢è¿‡æ¥çš„ä¸€å®šæ˜¯ 1ï¼ˆåŸå› æ˜¯åªæœ‰å½“éå†è¿‡çš„èŠ‚ç‚¹æœ‰1ï¼Œp0 å’Œ cur æ‰ä¸ä¼šåŒæ­¥ï¼‰ï¼Œè€Œ å¦‚æœç´¢å¼•æ˜¯ 1 åˆšå¥½ä¹Ÿå°±ä¸ç”¨æœ‰ä»»ä½•æ“ä½œï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç»§ç»­å‘å³æ‰«æï¼Œå½“ cur å’Œ p0 æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªç´¢å¼•ï¼Œé‚£äº¤æ¢å°±ç­‰äºæ²¡äº¤æ¢ï¼Œæ•…ä¹Ÿæ˜¯ç›´æ¥å¯ä»¥å‘å³æ‰«æï¼Œå³è¾¹çš„å°±ä¸è¡Œã€‚ ä»£ç 12345678910111213141516171819202122class Solution &#123; public void sortColors(int[] nums) &#123; int left = 0, cur = 0; int right = nums.length - 1; while (cur &lt;= right) &#123; if (nums[cur] == 0) &#123; swap(nums, left, cur); left++; cur++; &#125; else if (nums[cur] == 2) &#123; swap(nums, right, cur); right--; &#125; else cur++; &#125; &#125; public void swap(int[] nums, int a, int b) &#123; int temp = nums[a]; nums[a] = nums[b]; nums[b] = temp; &#125;&#125; 78. å­é›†é¢˜ç›®ç»™å®šä¸€ç»„ä¸å«é‡å¤å…ƒç´ çš„æ•´æ•°æ•°ç»„ numsï¼Œè¿”å›è¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚ è¯´æ˜ï¼šè§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„å­é›†ã€‚ ç¤ºä¾‹: 123456789101112è¾“å…¥: nums = [1,2,3]è¾“å‡º:[ [3], [1], [2], [1,2,3], [1,3], [2,3], [1,2], []] æ€è·¯å¾ˆæ˜æ˜¾ï¼Œä¸€çœ‹å°±æ˜¯å›æº¯ï¼Œæ€è·¯è·Ÿ å…¨æ’åˆ—ã€N çš‡åé—®é¢˜ä¸€æ · ä»£ç 1234567891011121314151617181920class Solution &#123; List&lt;List&lt;Integer&gt;&gt; res = new ArrayList(); public List&lt;List&lt;Integer&gt;&gt; subsets(int[] nums)&#123; LinkedList track = new LinkedList(); return subsets_in(nums,0, track); &#125; public List&lt;List&lt;Integer&gt;&gt; subsets_in(int[] nums,int start,LinkedList track) &#123; // æ³¨æ„ï¼Œè¿™é‡Œå¿…é¡»newä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¦åˆ™çš„è¯æ¯æ¬¡æ·»åŠ éƒ½æ˜¯æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ // æœ€åtrackä¼šå˜ç©ºï¼Œæ‰€æœ‰çš„æ·»åŠ çš„åˆ—è¡¨éƒ½ä¼šå˜ç©º res.add(new LinkedList(track)); for(int i = start;i &lt; nums.length;i++)&#123; track.add(nums[i]); subsets_in(nums,i+1,track); track.removeLast(); &#125; return res; &#125;&#125; 79. å•è¯æœç´¢é¢˜ç›®ç»™å®šä¸€ä¸ªäºŒç»´ç½‘æ ¼å’Œä¸€ä¸ªå•è¯ï¼Œæ‰¾å‡ºè¯¥å•è¯æ˜¯å¦å­˜åœ¨äºç½‘æ ¼ä¸­ã€‚ å•è¯å¿…é¡»æŒ‰ç…§å­—æ¯é¡ºåºï¼Œé€šè¿‡ç›¸é‚»çš„å•å…ƒæ ¼å†…çš„å­—æ¯æ„æˆï¼Œå…¶ä¸­â€œç›¸é‚»â€å•å…ƒæ ¼æ˜¯é‚£äº›æ°´å¹³ç›¸é‚»æˆ–å‚ç›´ç›¸é‚»çš„å•å…ƒæ ¼ã€‚åŒä¸€ä¸ªå•å…ƒæ ¼å†…çš„å­—æ¯ä¸å…è®¸è¢«é‡å¤ä½¿ç”¨ã€‚ ç¤ºä¾‹: 12345678910board =[ ['A','B','C','E'], ['S','F','C','S'], ['A','D','E','E']]ç»™å®š word = "ABCCED", è¿”å› true.ç»™å®š word = "SEE", è¿”å› true.ç»™å®š word = "ABCB", è¿”å› false. æ€è·¯ä¾æ—§æ˜¯â€¦ å›æº¯ ä»£ç 1234567891011121314151617181920212223242526272829303132class Solution &#123; public boolean exist(char[][] board, String word) &#123; boolean[][] visited = new boolean[board.length][board[0].length]; for (int i = 0; i &lt; board.length; i++) &#123; for (int j = 0; j &lt; board[0].length; j++) &#123; if (word.charAt(0) == board[i][j] &amp;&amp; backtrack(i, j, 0, word, visited, board)) return true; &#125; &#125; return false; &#125; private boolean backtrack(int i, int j, int index, String word, boolean[][] visited, char[][] board) &#123; // è§¦å‘ç»“æŸæ¡ä»¶ if (index == word.length()) return true; if (i &gt;= board.length || i &lt; 0 || j &gt;= board[0].length || j &lt; 0 || board[i][j] != word.charAt(index) || visited[i][j]) return false; // åšé€‰æ‹© visited[i][j] = true; // è¿›å…¥ä¸‹ä¸€å±‚å†³ç­– if (backtrack(i + 1, j, index + 1, word, visited, board) || backtrack(i - 1, j, index + 1, word, visited, board) || backtrack(i, j + 1, index + 1, word, visited, board) || backtrack(i, j - 1, index + 1, word, visited, board)) return true; // æ’¤é”€é€‰æ‹© visited[i][j] = false; // å›æº¯ return false; &#125;&#125; 84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢é¢˜ç›®ç»™å®š n ä¸ªéè´Ÿæ•´æ•°ï¼Œç”¨æ¥è¡¨ç¤ºæŸ±çŠ¶å›¾ä¸­å„ä¸ªæŸ±å­çš„é«˜åº¦ã€‚æ¯ä¸ªæŸ±å­å½¼æ­¤ç›¸é‚»ï¼Œä¸”å®½åº¦ä¸º 1 ã€‚ æ±‚åœ¨è¯¥æŸ±çŠ¶å›¾ä¸­ï¼Œèƒ½å¤Ÿå‹¾å‹’å‡ºæ¥çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯ã€‚ ä»¥ä¸Šæ˜¯æŸ±çŠ¶å›¾çš„ç¤ºä¾‹ï¼Œå…¶ä¸­æ¯ä¸ªæŸ±å­çš„å®½åº¦ä¸º 1ï¼Œç»™å®šçš„é«˜åº¦ä¸º [2,1,5,6,2,3]ã€‚ æ€è·¯ æš´åŠ›æ³•ï¼Œæ¯ä¸ªé«˜åº¦éƒ½è®¡ç®—ä¸€éæœ€é•¿çš„è¿ç»­çš„åº•ï¼Œç„¶åå–æœ€å¤§å€¼ã€‚ å…¶å®è¿™é“é¢˜çš„æœ¬è´¨å°±æ˜¯è½¬åŒ–ä¸ºæ±‚æ¯ä¸ªé«˜åº¦å¯¹åº”çš„æœ€é•¿çš„è¿ç»­çš„åº•ï¼Œå³å¯¹ä¸¤è¾¹åˆ†åˆ«æ‰¾ç¬¬ä¸€ä¸ªå°äºéå†çš„æ•°çš„é«˜åº¦çš„ç´¢å¼•å€¼ï¼ˆå³æ±‚çŸ©å½¢çš„æœ€é•¿çš„åº•ï¼‰ï¼Œè¿™ç‚¹å’Œæ¥é›¨æ°´ æœ‰ç‚¹ç›¸ä¼¼ï¼ŒåŒæ—¶ï¼Œé‡‡ç”¨å•è°ƒé€’å¢æ ˆçš„æ–¹æ³• è·Ÿ æ±‚æœ€å¤§æœ‰æ•ˆæ‹¬å· è¿™é“é¢˜æœ‰å¼‚æ›²åŒå·¥ä¹‹å¤„ï¼Œéƒ½æ˜¯é‡‡ç”¨äº†æ ˆå­˜å–æ•°ç»„ç´¢å¼•å€¼çš„æ–¹æ³•ï¼ ä¸ºä½•è¯´å•è°ƒé€’å¢æ ˆï¼ˆä¸¥æ ¼é€’å¢ï¼‰èƒ½éå¸¸è½»æ¾çš„æ‰¾åˆ° height[i] çš„ ä¸¤è¾¹åˆšå¥½æ¯”å®ƒçš„é«˜åº¦å°çš„ç¬¬ä¸€ä¸ªæ•° å‘¢ï¼Ÿ è¿™é‡Œæˆ‘ä»¬å…ˆå‡è®¾æ‰€æœ‰çš„é«˜åº¦éƒ½æ˜¯ä¸ä¼šç›¸åŒçš„ã€‚ é¦–å…ˆç”±äºæ ˆæ˜¯é€’å¢çš„ï¼Œå½“ height[i] æ¯”æ ˆé¡¶çš„ç´¢å¼•å€¼å¯¹åº”çš„é«˜åº¦ å¤§æ—¶ï¼Œç›´æ¥å‹å…¥æ ˆå³å¯ï¼Œå¦åˆ™è¯´æ˜ height[i] æ¯”æ ˆé¡¶çš„ç´¢å¼•å€¼å¯¹åº”çš„é«˜åº¦å°ï¼Œåˆ™æ ˆé¡¶å¯¹åº”çš„å³è¾¹ç¬¬ä¸€ä¸ªå°äºå®ƒçš„é«˜åº¦çš„æ•°æ‰¾åˆ°äº†ï¼Œå°±æ˜¯ height[i]ï¼Œç„¶åæŠŠæ ˆé¡¶å…ƒç´ å¼¹å‡ºï¼Œæ–°æ ˆé¡¶çš„å…ƒç´ å³æ˜¯åˆšæ‰å¼¹æ ˆå…ƒç´ å·¦è¾¹ç¬¬ä¸€ä¸ªå°äºå®ƒçš„é«˜åº¦çš„æ•°ï¼Œè¿™æ ·å°±å¾ˆè½»æ¾çš„æ‰¾åˆ°äº†ä¸¤è¾¹åˆ†åˆ«å°äº æ ˆé¡¶å…ƒç´ çš„æ•°ï¼Œè¿™æ ·å–æ›´æ–°æœ€å¤§å€¼å°±è¡Œäº†ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬ç°åœ¨æ¥è€ƒè™‘ä¸€ä¸‹å–æ¶ˆå¼€å§‹é‚£ä¸ªå‰ææ¡ä»¶ï¼Œç°åœ¨æœ‰çš„é«˜åº¦æ˜¯ä¼šç›¸åŒçš„ï¼Œè¿™ä¸ªæ¡ä»¶æˆ‘ä»¬æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿå½“é¢ä¸´æ ˆé¡¶å…ƒç´ å’Œéå†çš„å…ƒç´ å¯¹åº”çš„é«˜åº¦ç›¸åŒæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–°æ ˆé¡¶å…ƒç´ çš„å€¼ï¼ˆå³å°†å…¶å­˜å…¥çš„ç´¢å¼•å˜ä¸ºæ–°çš„æˆ‘ä»¬æ­£åœ¨éå†çš„å…ƒç´ çš„ç´¢å¼•å€¼ï¼‰ï¼Œæˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è¯´ 2 5 6 7 5 6 3ï¼Œå½“éå†åˆ°æœ€åä¸€ä¸ªæ•° 5 æ—¶ï¼Œæ­¤æ—¶æ ˆé¡¶å€¼ä¸º 1ï¼ˆç´¢å¼• 1 å¯¹åº”çš„é«˜åº¦æ˜¯ 5 ï¼‰ï¼Œæˆ‘ä»¬åªè¦æŠŠæ ˆé¡¶å€¼å˜ä¸º 4 å³å¯ã€‚ å½“ç„¶è¿™æ ·è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å‡å¦‚æ˜¯ 2 5 6 7ï¼Œé«˜åº¦ä¸€ç›´é€’å¢ï¼Œå››ä¸ªå€¼å…¨éƒ¨å…¥æ ˆäº†ï¼Œæ­¤æ—¶æœ€åä¸€ä¸ªå…ƒç´  7 çš„ å³è¾¹ç¬¬ä¸€ä¸ªå°äºå®ƒçš„é«˜åº¦å…¶å®æ²¡æœ‰ï¼Œæˆ‘ä»¬å¯ä»¥ä»¤å…¶ä¸º height.lengthã€‚ ä»£ç  æš´åŠ›æ³• 1234567891011121314151617181920212223242526272829class Solution &#123; public int largestRectangleArea(int[] heights) &#123; HashSet&lt;Integer&gt; heightsSet = new HashSet&lt;Integer&gt;(); //å¾—åˆ°æ‰€æœ‰çš„é«˜åº¦ï¼Œä¹Ÿå°±æ˜¯å»é‡ã€‚ for (int i = 0; i &lt; heights.length; i++) &#123; heightsSet.add(heights[i]); &#125; int maxArea = 0; //éå†æ¯ä¸€ä¸ªé«˜åº¦ for (int h : heightsSet) &#123; int width = 0; int maxWidth = 1; //æ‰¾å‡ºè¿ç»­çš„å¤§äºç­‰äºå½“å‰é«˜åº¦çš„æŸ±å½¢ä¸ªæ•°çš„æœ€å¤§å€¼ for (int i = 0; i &lt; heights.length; i++) &#123; if (heights[i] &gt;= h) &#123; width++; //å‡ºç°å°äºå½“å‰é«˜åº¦çš„å°±å½’é›¶ï¼Œå¹¶ä¸”æ›´æ–°æœ€å¤§å®½åº¦ &#125; else &#123; maxWidth = Math.max(width, maxWidth); width = 0; &#125; &#125; maxWidth = Math.max(width, maxWidth); //æ›´æ–°æœ€å¤§åŒºåŸŸçš„é¢ç§¯ maxArea = Math.max(maxArea, h * maxWidth); &#125; return maxArea; &#125;&#125; ä½œè€…ï¼šwindliangé“¾æ¥ï¼šhttps://leetcode-cn.com/problems/largest-rectangle-in-histogram/solution/xiang-xi-tong-su-de-si-lu-fen-xi-duo-jie-fa-by-1-7/æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ å•è°ƒé€’å¢æ ˆæ³• 123456789101112131415161718192021222324class Solution &#123; public int largestRectangleArea(int[] heights)&#123; Stack&lt;Integer&gt; stack = new Stack&lt;&gt;(); int max = 0; stack.push(-1); for(int i = 0; i &lt; heights.length; i++)&#123; // 1. æ ˆä¸­å€¼ä¸ç­‰äº -1 ä¸” æ ˆé¡¶å…ƒç´ å¯¹åº”çš„é«˜åº¦ å¤§äº æ­£åœ¨éå†çš„å…ƒç´ çš„é«˜åº¦ while(stack.peek() != -1 &amp;&amp; heights[stack.peek()] &gt; heights[i])&#123; max = Math.max(max,heights[stack.pop()] * (i - stack.peek() - 1)); &#125; // 2. æ ˆä¸­å€¼ä¸ç­‰äº -1 ä¸” æ ˆé¡¶å…ƒç´ å¯¹åº”çš„é«˜åº¦ == æ­£åœ¨éå†çš„å…ƒç´ çš„é«˜åº¦ // ç›´æ¥æŠŠå½“å‰æ ˆé¡¶å¼¹æ ˆå³å¯ if(stack.peek() != -1 &amp;&amp; heights[stack.peek()] == heights[i])&#123; stack.pop(); &#125; stack.push(i); &#125; // éå†å®Œäº†ï¼Œä½†æ˜¯æ²¡è®¡ç®—å®Œ while(stack.peek() != -1)&#123; max = Math.max(max,heights[stack.pop()] * (heights.length - stack.peek() - 1)); &#125; return max; &#125;&#125; 85. æœ€å¤§çŸ©å½¢é¢˜ç›®ç»™å®šä¸€ä¸ªä»…åŒ…å« 0 å’Œ 1 çš„äºŒç»´äºŒè¿›åˆ¶çŸ©é˜µï¼Œæ‰¾å‡ºåªåŒ…å« 1 çš„æœ€å¤§çŸ©å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚ ç¤ºä¾‹: 12345678è¾“å…¥:[ ["1","0","1","0","0"], ["1","0","1","1","1"], ["1","1","1","1","1"], ["1","0","0","1","0"]]è¾“å‡º: 6 æ€è·¯æ€è·¯åŒ84é¢˜ï¼Œæ¯ä¸€è¡Œéƒ½è°ƒç”¨84é¢˜çš„ç®—æ³•å³å¯ã€‚ ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738class Solution &#123; public int maximalRectangle(char[][] matrix) &#123; if (matrix.length == 0) return 0; int maxarea = 0; int[] dp = new int[matrix[0].length]; for(int i = 0; i &lt; matrix.length; i++) &#123; for(int j = 0; j &lt; matrix[0].length; j++) &#123; // update the state of this row's histogram using the last row's histogram // by keeping track of the number of consecutive ones dp[j] = matrix[i][j] == '1' ? dp[j] + 1 : 0; &#125; // update maxarea with the maximum area from this row's histogram maxarea = Math.max(maxarea, largestRectangleArea(dp)); &#125; return maxarea; &#125; public int largestRectangleArea(int[] heights)&#123; Stack&lt;Integer&gt; stack = new Stack&lt;&gt;(); int max = 0; stack.push(-1); for(int i = 0; i &lt; heights.length; i++)&#123; while(stack.peek() != -1 &amp;&amp; heights[stack.peek()] &gt; heights[i])&#123; max = Math.max(max,heights[stack.pop()] * (i - stack.peek() - 1)); &#125; if(stack.peek() != -1 &amp;&amp; heights[stack.peek()] == heights[i])&#123; stack.pop(); &#125; stack.push(i); &#125; while(stack.peek() != -1)&#123; max = Math.max(max,heights[stack.pop()] * (heights.length - stack.peek() - 1)); &#125; return max; &#125;&#125; 121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºé¢˜ç›®ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚ å¦‚æœä½ æœ€å¤šåªå…è®¸å®Œæˆä¸€ç¬”äº¤æ˜“ï¼ˆå³ä¹°å…¥å’Œå–å‡ºä¸€æ”¯è‚¡ç¥¨ï¼‰ï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ æ³¨æ„ä½ ä¸èƒ½åœ¨ä¹°å…¥è‚¡ç¥¨å‰å–å‡ºè‚¡ç¥¨ã€‚ ç¤ºä¾‹ 1: 1234è¾“å…¥: [7,1,5,3,6,4]è¾“å‡º: 5è§£é‡Š: åœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡ºï¼Œæœ€å¤§åˆ©æ¶¦ = 6-1 = 5 ã€‚ æ³¨æ„åˆ©æ¶¦ä¸èƒ½æ˜¯ 7-1 = 6, å› ä¸ºå–å‡ºä»·æ ¼éœ€è¦å¤§äºä¹°å…¥ä»·æ ¼ã€‚ ç¤ºä¾‹ 2: 123è¾“å…¥: [7,6,4,3,1]è¾“å‡º: 0è§£é‡Š: åœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚ æ€è·¯å‡è®¾å½“å‰åœ¨ç¬¬ i å¤©ï¼Œä»¤ minPrice è¡¨ç¤ºå‰ i-1 å¤©çš„æœ€ä½ä»·æ ¼ï¼›ä»¤ maxProfit è¡¨ç¤ºå‰ i-1 å¤©çš„æœ€å¤§æ”¶ç›Šã€‚é‚£ä¹ˆè€ƒè™‘ç¬¬ i å¤©çš„æ”¶ç›Šæ—¶ï¼Œå­˜åœ¨ä¸¤ç§æƒ…å†µï¼š åœ¨ç¬¬ i å¤©å–å‡ºã€‚å¾ˆæ˜¾ç„¶ï¼Œæƒ³è¦è·å¾—æœ€å¤§æ”¶ç›Šï¼Œåº”è¯¥åœ¨å‰ i-1 å¤©ä¸­ä»·æ ¼æœ€ä½çš„æ—¶å€™ä¹°å…¥ï¼Œå³æ­¤æ—¶çš„æ”¶ç›Šä¸ºï¼šprices[i] - minPriceã€‚ï¼ˆå¯èƒ½ä¼šå‡ºç°è´Ÿæ•°ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼‰ ä¸åœ¨ç¬¬ i å¤©å–å‡ºã€‚é‚£ä¹ˆç¬¬ i å¤©çš„æœ€å¤§æ”¶ç›Šå°±ç­‰äºå‰ i -1 å¤©ä¸­çš„æœ€å¤§æ”¶ç›Š çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼šç¬¬ i å¤©æœ€å¤§æ”¶ç›Š = max( åœ¨ç¬¬ i å¤©å–å‡ºçš„æ‰€å¾—æ”¶ç›Š , å‰ i-1 å¤©çš„æœ€å¤§æ”¶ç›Š) ä»£ç 1234567891011class Solution &#123; public int maxProfit(int[] prices) &#123; int minPrice = Integer.MAX_VALUE; int maxProfit = 0; for (int i = 0; i &lt; prices.length; i++) &#123; minPrice = Math.min(minPrice, prices[i]); maxProfit = Math.max(maxProfit, prices[i] - minPrice); &#125; return maxProfit; &#125;&#125; 128. æœ€é•¿è¿ç»­åºåˆ—é¢˜ç›®ç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾å‡ºæœ€é•¿è¿ç»­åºåˆ—çš„é•¿åº¦ã€‚ è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚ ç¤ºä¾‹: 123è¾“å…¥: [100, 4, 200, 1, 3, 2]è¾“å‡º: 4è§£é‡Š: æœ€é•¿è¿ç»­åºåˆ—æ˜¯ [1, 2, 3, 4]ã€‚å®ƒçš„é•¿åº¦ä¸º 4ã€‚ æ€è·¯ æš´åŠ›æ³•ã€‚ä»å¤´åˆ°å°¾éå†æ¯ä¸ªæ•°ï¼Œç„¶åå¯¹æ¯ä¸ªæ•°å»æ‰¾æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ä¸‹ä¸€ä¸ªæ•°ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±æ‰¾æ˜¯å¦å­˜åœ¨ä¸‹ä¸€ä¸ªå†ä¸‹ä¸€ä¸ªçš„æ•°ï¼Œä»¥æ­¤ç±»æ¨ã€‚ æ’åºä¹‹åå†è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¸ªå¾ˆç®€å•â€¦ä¸è®²äº†ã€‚ ç”¨ Set å­˜å‚¨æ•°ç»„ï¼Œè¿™æ ·æŸ¥è¯¢æ˜¯å¦æœ‰è¯¥æ•°çš„æ—¶å€™ï¼Œç›´æ¥å°±æ˜¯ O(1) çš„å¤æ‚åº¦ï¼ŒåŒæ—¶ä¸éœ€è¦æ•°ç»„ä»å¤´åˆ°å°¾éå†ï¼Œåªæœ‰åœ¨ï¼ˆéå†çš„å…ƒç´ å€¼ - 1ï¼‰ ä¸åœ¨ Set ä¸­ï¼Œæ‰å¼€å§‹åˆ¤æ–­å…¶ä¸‹ä¸€ä¸ªæ˜¯å¦åœ¨ Set ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘éå†çš„æ¬¡æ•°ã€‚ ä»£ç  æš´åŠ› 12345678910111213141516171819202122232425262728class Solution &#123; private boolean arrayContains(int[] arr, int num) &#123; for (int i = 0; i &lt; arr.length; i++) &#123; if (arr[i] == num) &#123; return true; &#125; &#125; return false; &#125; public int longestConsecutive(int[] nums) &#123; int longestStreak = 0; for (int num : nums) &#123; int currentNum = num; int currentStreak = 1; while (arrayContains(nums, currentNum + 1)) &#123; currentNum += 1; currentStreak += 1; &#125; longestStreak = Math.max(longestStreak, currentStreak); &#125; return longestStreak; &#125;&#125; æ’åº 1234567891011121314151617181920212223242526class Solution &#123; public int longestConsecutive(int[] nums) &#123; if (nums.length == 0) &#123; return 0; &#125; Arrays.sort(nums); int longestStreak = 1; int currentStreak = 1; for (int i = 1; i &lt; nums.length; i++) &#123; if (nums[i] != nums[i-1]) &#123; if (nums[i] == nums[i-1]+1) &#123; currentStreak += 1; &#125; else &#123; longestStreak = Math.max(longestStreak, currentStreak); currentStreak = 1; &#125; &#125; &#125; return Math.max(longestStreak, currentStreak); &#125;&#125; Set 1234567891011121314151617181920212223242526class Solution &#123; public int longestConsecutive(int[] nums) &#123; Set&lt;Integer&gt; num_set = new HashSet&lt;Integer&gt;(); for (int num : nums) &#123; num_set.add(num); &#125; int longestStreak = 0; for (int num : num_set) &#123; if (!num_set.contains(num-1)) &#123; int currentNum = num; int currentStreak = 1; while (num_set.contains(currentNum+1)) &#123; currentNum += 1; currentStreak += 1; &#125; longestStreak = Math.max(longestStreak, currentStreak); &#125; &#125; return longestStreak; &#125;&#125; å…·ä½“è§ å®˜æ–¹é¢˜è§£ï¼šhttps://leetcode-cn.com/problems/longest-consecutive-sequence/solution/zui-chang-lian-xu-xu-lie-by-leetcode/ 152. ä¹˜ç§¯æœ€å¤§å­åºåˆ—é¢˜ç›®ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾å‡ºä¸€ä¸ªåºåˆ—ä¸­ä¹˜ç§¯æœ€å¤§çš„è¿ç»­å­åºåˆ—ï¼ˆè¯¥åºåˆ—è‡³å°‘åŒ…å«ä¸€ä¸ªæ•°ï¼‰ã€‚ ç¤ºä¾‹ 1: 123è¾“å…¥: [2,3,-2,4]è¾“å‡º: 6è§£é‡Š: å­æ•°ç»„ [2,3] æœ‰æœ€å¤§ä¹˜ç§¯ 6ã€‚ ç¤ºä¾‹ 2: 123è¾“å…¥: [-2,0,-1]è¾“å‡º: 0è§£é‡Š: ç»“æœä¸èƒ½ä¸º 2, å› ä¸º [-2,-1] ä¸æ˜¯å­æ•°ç»„ã€‚ æ€è·¯è¿™å…¶å®è¯´ç™½äº†å°±æ˜¯å­ä¸²çš„é¢˜ç›®ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨åŠ¨æ€è§„åˆ’å»åšã€‚åš dp çš„é¢˜ç›®ï¼Œæˆ‘è§‰å¾—é¦–å…ˆæœ€é‡è¦çš„ä¸æ˜¯çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œè€Œæ˜¯dpæ•°ç»„çš„å«ä¹‰æ˜¯ä»€ä¹ˆï¼Œåªæœ‰è¿™ä¸ªç¡®å®šå¯¹äº†ï¼ŒçŠ¶æ€æ–¹ç¨‹æ‰èƒ½å¾ˆå¥½çš„åˆ—å‡ºæ¥ï¼ï¼ï¼ è¿™é‡Œçš„ dp æ•°ç»„æŒ‡çš„æ˜¯ä»¥ç¬¬ i ä¸ªæ•° ç»“å°¾çš„ è¿ç»­å­åºåˆ—ï¼Œç”±äºå­˜åœ¨è´Ÿæ•°ï¼Œæ‰€ä»¥å¿…é¡»ç»´æŠ¤ä¸¤ä¸ª dp æ•°ç»„ï¼Œå…¶å®è¿™é‡Œæ ¹æœ¬ç”¨ä¸åˆ°æ•°ç»„ï¼Œä½†æ˜¯ä¸ºäº†æ›´åŠ æ¸…æ™°çš„çœ‹åˆ° dp çš„æ€æƒ³ï¼Œæˆ‘è¿˜æ˜¯ç”¨æ•°ç»„æ¥è¡¨è¾¾å§ã€‚ æˆ‘ä»¬å…ˆè€ƒè™‘éƒ½æ˜¯æ­£æ•°çš„æƒ…å†µã€‚dp_max[i] çš„å«ä¹‰æˆ‘ä»¬å·²ç»è®²è¿‡äº†ï¼Œdp_max[i] = Math.max(nums[i-1],dp_max[i-1]*nums[i-1])ï¼Œå³ dp_max[i] è¿™ä¸ªå€¼åªä¼šåœ¨è¿™ä¸¤è€…äº§ç”Ÿï¼Œè¦ä¹ˆ ä¹˜ä¸Šä¹‹å‰çš„ä¼šæ›´å¤§ï¼Œè¦ä¹ˆ èˆå¼ƒå‰é¢çš„ã€‚ æ¥ä¸‹æ¥è€ƒè™‘è´Ÿæ•°çš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰å¿…è¦ç»´æŠ¤ä¸€ä¸ª dp_minï¼Œæ€è·¯æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œå½“éå†çš„å…ƒç´ ä¸ºè´Ÿæ•°æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠ dp_max[i-1]ï¼Œdp_min[i-1]äº¤æ¢å³å¯ã€‚ æœ€åï¼Œåªè¦æ‰¾åˆ°æ‰€æœ‰dp_maxä¸­çš„æ•°å€¼æœ€å¤§çš„é‚£ä¸ªï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„å€¼äº†ã€‚ ä»£ç 1234567891011121314151617181920212223242526class Solution &#123; public int maxProduct(int[] nums) &#123; int[] dp_max = new int[nums.length+1]; int[] dp_min = new int[nums.length+1]; if(nums.length == 0) return 0; int max = Integer.MIN_VALUE; // ç”±äºå­˜åœ¨è´Ÿæ•°ï¼Œæ‰€ä»¥éœ€è¦ç»´æŠ¤ä¸¤ä¸ªæ•°ç»„ // dp_max[i] æŒ‡çš„æ˜¯ä»¥ç¬¬ i ä¸ªæ•°ç»“å°¾çš„ ä¹˜ç§¯æœ€å¤§ çš„è¿ç»­å­åºåˆ— // dp_min[i] æŒ‡çš„æ˜¯ä»¥ç¬¬ i ä¸ªæ•°ç»“å°¾çš„ ä¹˜ç§¯æœ€å° çš„è¿ç»­å­åºåˆ— dp_max[0] = 1; dp_min[0] = 1; for (int i = 1;i &lt;= nums.length;i++)&#123; // å¦‚æœæ•°ç»„çš„æ•°æ˜¯è´Ÿæ•°ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ max å˜æˆ minï¼Œmin å˜æˆ max // æ•…éœ€è¦äº¤æ¢dp if(nums[i-1] &lt; 0)&#123; int temp = dp_min[i-1]; dp_min[i-1] = dp_max[i-1]; dp_max[i-1] = temp; &#125; dp_min[i] = Math.min(nums[i-1],dp_min[i-1]*nums[i-1]); dp_max[i] = Math.max(nums[i-1],dp_max[i-1]*nums[i-1]); max = Math.max(max,dp_max[i]); &#125; return max; &#125;&#125; 155. æœ€å°æ ˆé¢˜ç›®è®¾è®¡ä¸€ä¸ªæ”¯æŒ pushï¼Œpopï¼Œtop æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚ push(x) â€“ å°†å…ƒç´  x æ¨å…¥æ ˆä¸­ã€‚ pop() â€“ åˆ é™¤æ ˆé¡¶çš„å…ƒç´ ã€‚ top() â€“ è·å–æ ˆé¡¶å…ƒç´ ã€‚ getMin() â€“ æ£€ç´¢æ ˆä¸­çš„æœ€å°å…ƒç´ ã€‚ ç¤ºä¾‹: 12345678MinStack minStack = new MinStack();minStack.push(-2);minStack.push(0);minStack.push(-3);minStack.getMin(); --&gt; è¿”å› -3.minStack.pop();minStack.top(); --&gt; è¿”å› 0.minStack.getMin(); --&gt; è¿”å› -2. æ€è·¯https://leetcode-cn.com/problems/min-stack/solution/xiang-xi-tong-su-de-si-lu-fen-xi-duo-jie-fa-by-38/ ç”¨ä¸¤ä¸ªæ ˆï¼Œä¸€ä¸ªæ ˆä¸“é—¨å­˜æœ€å°å€¼ï¼Œä¸»è¦å°±æ˜¯å…¥æ ˆå’Œå‡ºæ ˆåšåˆ°åŒæ­¥å°±è¡Œã€‚å­˜æœ€å°å€¼çš„æ ˆçš„å…·ä½“æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š å°†ç¬¬ä¸€ä¸ªå…ƒç´ å…¥æ ˆã€‚ æ–°åŠ å…¥çš„å…ƒç´ å¦‚æœå¤§äºæ ˆé¡¶å…ƒç´ ï¼Œé‚£ä¹ˆæ–°åŠ å…¥çš„å…ƒç´ å°±ä¸å¤„ç†ã€‚ æ–°åŠ å…¥çš„å…ƒç´ å¦‚æœå°äºç­‰äºæ ˆé¡¶å…ƒç´ ï¼Œé‚£ä¹ˆå°±å°†æ–°å…ƒç´ å…¥æ ˆã€‚ å‡ºæ ˆå…ƒç´ ä¸ç­‰äºæ ˆé¡¶å…ƒç´ ï¼Œä¸æ“ä½œã€‚ å‡ºæ ˆå…ƒç´ ç­‰äºæ ˆé¡¶å…ƒç´ ï¼Œé‚£ä¹ˆå°±å°†æ ˆé¡¶å…ƒç´ å‡ºæ ˆã€‚ ç”¨ä¸€ä¸ªæ ˆï¼Œå½“æœ‰æ›´å°çš„å€¼æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠä¹‹å‰çš„æœ€å°å€¼å…¥æ ˆï¼Œå½“å‰æ›´å°çš„å€¼å†å…¥æ ˆå³å¯ã€‚å½“è¿™ä¸ªæœ€å°å€¼è¦å‡ºæ ˆçš„æ—¶å€™ï¼Œä¸‹ä¸€ä¸ªå€¼ä¾¿æ˜¯ä¹‹å‰çš„æœ€å°å€¼äº†ã€‚ æ ˆä¸­å­˜å‚¨é“¾è¡¨ï¼Œå…¶ä¸­è®¾å®šä¸€ä¸ªèŠ‚ç‚¹åŒ…æ‹¬å…¶ valï¼Œå’Œå½“å‰æœ€å°å€¼ã€‚ ä»£ç  ä¸¤ä¸ªæ ˆ 123456789101112131415161718192021222324252627282930313233343536373839404142class MinStack &#123; /** initialize your data structure here. */ private Stack&lt;Integer&gt; stack; private Stack&lt;Integer&gt; minStack; public MinStack() &#123; stack = new Stack&lt;&gt;(); minStack = new Stack&lt;&gt;(); &#125; public void push(int x) &#123; stack.push(x); if (!minStack.isEmpty()) &#123; int top = minStack.peek(); //å°äºçš„æ—¶å€™æ‰å…¥æ ˆ if (x &lt;= top) &#123; minStack.push(x); &#125; &#125;else&#123; minStack.push(x); &#125; &#125; public void pop() &#123; int pop = stack.pop(); int top = minStack.peek(); //ç­‰äºçš„æ—¶å€™å†å‡ºæ ˆ if (pop == top) &#123; minStack.pop(); &#125; &#125; public int top() &#123; return stack.peek(); &#125; public int getMin() &#123; return minStack.peek(); &#125;&#125; å•ä¸ªæ ˆ 1234567891011121314151617181920212223242526272829class MinStack &#123; int min = Integer.MAX_VALUE; Stack&lt;Integer&gt; stack = new Stack&lt;Integer&gt;(); public void push(int x) &#123; //å½“å‰å€¼æ›´å° if(x &lt;= min)&#123; //å°†ä¹‹å‰çš„æœ€å°å€¼ä¿å­˜ stack.push(min); //æ›´æ–°æœ€å°å€¼ min=x; &#125; stack.push(x); &#125; public void pop() &#123; //å¦‚æœå¼¹å‡ºçš„å€¼æ˜¯æœ€å°å€¼ï¼Œé‚£ä¹ˆå°†ä¸‹ä¸€ä¸ªå…ƒç´ æ›´æ–°ä¸ºæœ€å°å€¼ if(stack.pop() == min) &#123; min=stack.pop(); &#125; &#125; public int top() &#123; return stack.peek(); &#125; public int getMin() &#123; return min; &#125;&#125; å­˜å‚¨é“¾è¡¨ 123456789101112131415161718192021222324252627282930313233343536373839404142class MinStack &#123; class Node&#123; int value; int min; Node next; Node(int x, int min)&#123; this.value=x; this.min=min; next = null; &#125; &#125; Node head; //æ¯æ¬¡åŠ å…¥çš„èŠ‚ç‚¹æ”¾åˆ°å¤´éƒ¨ public void push(int x) &#123; if(null==head)&#123; head = new Node(x,x); &#125;else&#123; //å½“å‰å€¼å’Œä¹‹å‰å¤´ç»“ç‚¹çš„æœ€å°å€¼è¾ƒå°çš„åšä¸ºå½“å‰çš„ min Node n = new Node(x, Math.min(x,head.min)); n.next=head; head=n; &#125; &#125; public void pop() &#123; if(head!=null) head =head.next; &#125; public int top() &#123; if(head!=null) return head.value; return -1; &#125; public int getMin() &#123; if(null!=head) return head.min; return -1; &#125;&#125; 5330. åˆ†è£‚äºŒå‰æ ‘çš„æœ€å¤§ä¹˜ç§¯é¢˜ç›®ç»™ä½ ä¸€æ£µäºŒå‰æ ‘ï¼Œå®ƒçš„æ ¹ä¸º root ã€‚è¯·ä½ åˆ é™¤ 1 æ¡è¾¹ï¼Œä½¿äºŒå‰æ ‘åˆ†è£‚æˆä¸¤æ£µå­æ ‘ï¼Œä¸”å®ƒä»¬å­æ ‘å’Œçš„ä¹˜ç§¯å°½å¯èƒ½å¤§ã€‚ ç”±äºç­”æ¡ˆå¯èƒ½ä¼šå¾ˆå¤§ï¼Œè¯·ä½ å°†ç»“æœå¯¹ 10^9 + 7 å–æ¨¡åå†è¿”å›ã€‚ ç¤ºä¾‹ 1ï¼š 123è¾“å…¥ï¼šroot = [1,2,3,4,5,6]è¾“å‡ºï¼š110è§£é‡Šï¼šåˆ é™¤çº¢è‰²çš„è¾¹ï¼Œå¾—åˆ° 2 æ£µå­æ ‘ï¼Œå’Œåˆ†åˆ«ä¸º 11 å’Œ 10 ã€‚å®ƒä»¬çš„ä¹˜ç§¯æ˜¯ 110 ï¼ˆ11*10 ç¤ºä¾‹ 2ï¼š 123è¾“å…¥ï¼šroot = [1,null,2,3,4,null,null,5,6]è¾“å‡ºï¼š90è§£é‡Šï¼šç§»é™¤çº¢è‰²çš„è¾¹ï¼Œå¾—åˆ° 2 æ£µå­æ ‘ï¼Œå’Œåˆ†åˆ«æ˜¯ 15 å’Œ 6 ã€‚å®ƒä»¬çš„ä¹˜ç§¯ä¸º 90 ï¼ˆ15*6ï¼‰ ä»£ç 123456789101112131415161718192021222324252627282930313233/** * Definition for a binary tree node. * public class TreeNode &#123; * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; private static final long MOD = (long) (1e9 + 7); public int maxProduct(TreeNode root) &#123; Set&lt;Long&gt; ss = new HashSet&lt;&gt;(); long sum = dfs(root, ss); long ans = 0; for (Long s : ss) &#123; ans = Math.max(ans, s * (sum - s)); &#125; return (int) (ans % MOD); &#125; private long dfs(TreeNode root, Set&lt;Long&gt; ss) &#123; if (root == null) &#123; return 0; &#125; long l = dfs(root.left, ss); long r = dfs(root.right, ss); ss.add(l); ss.add(r); return l + r + root.val; &#125;&#125; 206. åè½¬é“¾è¡¨é¢˜ç›®åè½¬ä¸€ä¸ªå•é“¾è¡¨ã€‚ ç¤ºä¾‹: 12è¾“å…¥: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULLè¾“å‡º: 5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULL æ€è·¯è¿­ä»£è®¾ç½®ä¸‰ä¸ªèŠ‚ç‚¹preã€curã€next ï¼ˆ1ï¼‰æ¯æ¬¡æŸ¥çœ‹curèŠ‚ç‚¹æ˜¯å¦ä¸ºNULLï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç»“æŸå¾ªç¯ï¼Œè·å¾—ç»“æœ ï¼ˆ2ï¼‰å¦‚æœcurèŠ‚ç‚¹ä¸æ˜¯ä¸ºNULLï¼Œåˆ™å…ˆè®¾ç½®ä¸´æ—¶å˜é‡nextä¸ºcurçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ ï¼ˆ3ï¼‰è®©curçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å˜æˆæŒ‡å‘preï¼Œè€Œåpreç§»åŠ¨curï¼Œcurç§»åŠ¨åˆ°next ï¼ˆ4ï¼‰é‡å¤ï¼ˆ1ï¼‰ï¼ˆ2ï¼‰ï¼ˆ3ï¼‰ é€’å½’æ‹¿åˆ°æ‰‹ä¹‹åï¼Œæ˜¯ç›´æ¥ä½¿ç”¨çš„é€’å½’çš„åšæ³•ï¼Œçœ‹è¯„è®ºåŒºå¤§å®¶å¥½åƒå¯¹é€’å½’çš„è¿‡ç¨‹éƒ½è§‰å¾—å¾ˆç»•ï¼Œå…¶å®æˆ‘ä¸ªäººè§‰å¾—å¤§å®¶æŠŠè¿™ä¸ªæƒ³å¤æ‚äº†ï¼Œä¸‹é¢æˆ‘æ¥è¯•ç€å¸®å¤§å®¶ä¸€èµ·ç†è§£ä¸€ä¸‹ï¼é€’å½’ï¼Œå°±æ˜¯ä¸‰éƒ¨æ›²ï¼š 1ã€æ‰¾åˆ°é€’å½’å‡ºå£ 2ã€ç¡®å®šè¿”å›å€¼ 3ã€åˆ†æå•æ¬¡é€’å½’éœ€è¦åšçš„äº‹æƒ… ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å…·ä½“åˆ†æä¸€ä¸‹ï¼š é¦–å…ˆï¼Œæ‰¾åˆ°é€’å½’å‡ºå£ï¼Œè¿™ä¸ªè¿˜æ˜¯éå¸¸ç®€å•çš„ï¼Œå°±æ˜¯å½“å‰å³å°†åè½¬çš„èŠ‚ç‚¹ä¸º null æˆ–è€…æ˜¯ åè½¬é“¾è¡¨ ä¸º null æ—¶ï¼ˆä¸€è½®é€’å½’å…¶å®å°±åªæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œåé¢ä¼šè®²ï¼‰ï¼Œè¯´æ˜å·²ç»å…¨éƒ¨åè½¬å®Œæ¯•äº†ï¼Œå³é€’å½’å‡ºå£ï¼› å…¶æ¬¡ï¼Œç¡®å®šè¿”å›å€¼ï¼Œæˆ‘ä»¬åªéœ€è¦è¿”å›åè½¬é“¾è¡¨çš„å¤´ç»“ç‚¹å³å¯ï¼› æœ€åï¼Œåˆ†æå•æ¬¡é€’å½’éœ€è¦åšçš„äº‹æƒ…ï¼Œæˆ‘è§‰å¾—å¤§å®¶è§‰å¾—é€’å½’æ¯”è¾ƒéš¾ç†è§£çš„åœ°æ–¹å°±æ˜¯åœ¨è¿™ï¼Œå…¶å®æ˜¯å¤§å®¶æŠŠé€’å½’å¤æ‚åŒ–äº†ï¼Œé€’å½’å…¶å®æ¯ä¸€è½®åšçš„äº‹æƒ…éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å»é‡å¤è€ƒè™‘ï¼Œè¿™æ ·åè€Œä¼šå¾ˆä¹±ï¼Œåªéœ€è¦è€ƒè™‘å•è½®é€’å½’éœ€è¦åšä»€ä¹ˆå°±å¯ä»¥äº†ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±åªæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªæ˜¯å³å°†åè½¬çš„èŠ‚ç‚¹å…ƒç´ ï¼Œä¸€ä¸ªæ˜¯å·²ç»åè½¬å®Œæ¯•çš„é“¾è¡¨å¤´ç»“ç‚¹ã€‚ æˆ‘ä»¬è¦åšçš„ä¸€è½®é€’å½’åªæ˜¯ å°†å½“å‰èŠ‚ç‚¹åŠ å…¥åˆ°åè½¬é“¾è¡¨ä¸­ï¼Œä»…æ­¤è€Œå·²ã€‚ ä»£ç  è¿­ä»£ 123456789101112131415161718192021/** * Definition for singly-linked list. * public class ListNode &#123; * int val; * ListNode next; * ListNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public ListNode reverseList(ListNode head) &#123; ListNode prev = null; ListNode curr = head; while (curr != null) &#123; ListNode nextTemp = curr.next; curr.next = prev; prev = curr; curr = nextTemp; &#125; return prev; &#125;&#125; é€’å½’ 123456789101112131415161718192021222324/** * Definition for singly-linked list. * public class ListNode &#123; * int val; * ListNode next; * ListNode(int x) &#123; val = x; &#125; * &#125; */class Solution &#123; public ListNode reverseList(ListNode head) &#123; // å¦‚æœå½“å‰è¦åè½¬çš„èŠ‚ç‚¹ä¸º null æˆ–è€…åè½¬é“¾è¡¨ä¸º null // head.next ä¸º nullï¼Œå³åè½¬é“¾è¡¨çš„å°¾ç»“ç‚¹ä¸å­˜åœ¨ï¼Œå³åè½¬é“¾è¡¨ä¸å­˜åœ¨ if (head == null || head.next == null) return head; // èŠ‚ç‚¹ p å…¶å®å°±æ˜¯åè½¬é“¾è¡¨çš„å¤´èŠ‚ç‚¹ ListNode p = reverseList(head.next); // æˆ‘ä»¬å°†åè½¬é“¾è¡¨çš„å°¾ç»“ç‚¹ï¼ˆhead.nextï¼‰çš„ lianext æŒ‡å‘å½“å‰å³å°†åè½¬çš„èŠ‚ç‚¹ head.next.next = head; // ç„¶åè®©å½“å‰èŠ‚ç‚¹å˜æˆåè½¬é“¾è¡¨çš„å°¾ç»“ç‚¹ head.next = null; // è¿”å›åè½¬é“¾è¡¨çš„å¤´ç»“ç‚¹ return p; &#125;&#125; 160. ç›¸äº¤é“¾è¡¨é¢˜ç›®ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œæ‰¾åˆ°ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚ ã€æ³¨æ„ï¼šè¿™é‡Œç›¸äº¤èŠ‚ç‚¹å¹¶ä¸æ˜¯çœ‹é“¾è¡¨çš„å€¼ç›¸ç­‰å°±ä»£è¡¨ç›¸äº¤ï¼Œå¾—æ˜¯ä¸¤ä¸ªèŠ‚ç‚¹ç›´æ¥ç›¸ç­‰æ‰ä»£è¡¨ç›¸äº¤ï¼ŒæŒ‡å‘åŒä¸€å—å†…å­˜ã€‚ã€‘ å¦‚ä¸‹é¢çš„ä¸¤ä¸ªé“¾è¡¨ï¼š åœ¨èŠ‚ç‚¹ c1 å¼€å§‹ç›¸äº¤ã€‚ ç¤ºä¾‹ 1ï¼š 123è¾“å…¥ï¼šintersectVal = 8, listA = [4,1,8,4,5], listB = [5,0,1,8,4,5], skipA = 2, skipB = 3è¾“å‡ºï¼šReference of the node with value = 8è¾“å…¥è§£é‡Šï¼šç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 8 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [4,1,8,4,5]ï¼Œé“¾è¡¨ B ä¸º [5,0,1,8,4,5]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹ 2ï¼š 123è¾“å…¥ï¼šintersectVal = 2, listA = [0,9,1,2,4], listB = [3,2,4], skipA = 3, skipB = 1è¾“å‡ºï¼šReference of the node with value = 2è¾“å…¥è§£é‡Šï¼šç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 2 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [0,9,1,2,4]ï¼Œé“¾è¡¨ B ä¸º [3,2,4]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 1 ä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹ 3ï¼š 1234è¾“å…¥ï¼šintersectVal = 0, listA = [2,6,4], listB = [1,5], skipA = 3, skipB = 2è¾“å‡ºï¼šnullè¾“å…¥è§£é‡Šï¼šä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [2,6,4]ï¼Œé“¾è¡¨ B ä¸º [1,5]ã€‚ç”±äºè¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œæ‰€ä»¥ intersectVal å¿…é¡»ä¸º 0ï¼Œè€Œ skipA å’Œ skipB å¯ä»¥æ˜¯ä»»æ„å€¼ã€‚è§£é‡Šï¼šè¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œå› æ­¤è¿”å› nullã€‚ æ³¨æ„ï¼š å¦‚æœä¸¤ä¸ªé“¾è¡¨æ²¡æœ‰äº¤ç‚¹ï¼Œè¿”å› nullã€‚ åœ¨è¿”å›ç»“æœåï¼Œä¸¤ä¸ªé“¾è¡¨ä»é¡»ä¿æŒåŸæœ‰çš„ç»“æ„ã€‚ å¯å‡å®šæ•´ä¸ªé“¾è¡¨ç»“æ„ä¸­æ²¡æœ‰å¾ªç¯ã€‚ ç¨‹åºå°½é‡æ»¡è¶³ O(n) æ—¶é—´å¤æ‚åº¦ï¼Œä¸”ä»…ç”¨ O(1) å†…å­˜ã€‚ æ€è·¯ æœ€å¼€å§‹çš„æ€è·¯å°±æ˜¯ï¼Œæ‰¾åˆ° é•¿é“¾è¡¨å’ŒçŸ­é“¾è¡¨çš„é•¿åº¦å·® c ï¼Œè¿™æ ·ç¬¬äºŒæ¬¡éå†çš„æ—¶å€™ï¼Œé•¿é“¾è¡¨ä»ç¬¬ c+1 ä¸ªèŠ‚ç‚¹å‡ºå‘ï¼ŒçŸ­é“¾è¡¨ä»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å‡ºå‘ï¼Œè¿™æ ·æœ€åäºŒè€…å¿…æ˜¯åŒæ—¶åˆ°è¾¾ç»ˆç‚¹çš„ï¼Œè€ŒäºŒè€…å¦‚æœæœ‰ç›¸äº¤ï¼Œåˆ™åœ¨éå†çš„æ—¶å€™èŠ‚ç‚¹å¿…ç›¸ç­‰ï¼Œç¬¬ä¸€ä¸ªç›¸ç­‰çš„èŠ‚ç‚¹å°±æ˜¯ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚ è¿˜æœ‰ä¸€ä¸ªæ€è·¯å¯ä»¥æ‰¾åˆ°ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ï¼Œæˆ‘ä»¬æ— éœ€å»è®¡ç®—é•¿é“¾è¡¨å’ŒçŸ­é“¾è¡¨çš„é•¿åº¦å·® cï¼Œåªéœ€è¦è®©ä¸¤ä¸ªæŒ‡é’ˆ p1ã€p2 åŒæ—¶ä»é“¾è¡¨å¤´ç»“ç‚¹å¤„å‡ºå‘ï¼Œå‡è®¾ é•¿é“¾è¡¨é•¿åº¦ä¸º aï¼ŒçŸ­é“¾è¡¨çš„é•¿åº¦ä¸º bï¼Œå½“çŸ­é“¾è¡¨æŒ‡é’ˆp2éå†åˆ° nullï¼Œå³éå†å®Œäº†çŸ­é“¾è¡¨ï¼Œå°†å…¶ç§»åˆ°é•¿é“¾è¡¨å¤´ç»“ç‚¹ç»§ç»­éå†ï¼ŒåŒæ—¶p1ä¹Ÿç»§ç»­å‘å‰éå†ï¼Œå½“p1éå†åˆ° null æ—¶ï¼Œå°†å…¶ç§»åˆ°çŸ­é“¾è¡¨å¤´èŠ‚ç‚¹ç»§ç»­éå†ï¼Œè¿™æ · å¦‚æœé•¿é“¾è¡¨å’ŒçŸ­é“¾è¡¨ç›¸äº¤ï¼Œåˆ™ p1 å’Œ p2 å¿…ä¼šåœ¨ç›¸äº¤èµ·å§‹å¤„ç›¸é‡ï¼Œå¦‚æœä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œp1 å’Œ p2 ä¼šåœ¨ null å¤„ç›¸é‡ã€‚ ä»£ç  Code I 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859/** * Definition for singly-linked list. * public class ListNode &#123; * int val; * ListNode next; * ListNode(int x) &#123; * val = x; * next = null; * &#125; * &#125; */public class Solution &#123; public ListNode getIntersectionNode(ListNode headA, ListNode headB) &#123; if (headA == null || headB == null) return null; ListNode p1 = headA; ListNode p2 = headB; while(p1 != null &amp;&amp; p2 != null)&#123; p1 = p1.next; p2 = p2.next; &#125; // è¯´æ˜ headA æ˜¯çŸ­é“¾è¡¨ if(p1 == null)&#123; // è®¡ç®—å·®å€¼ int difference = 0; while(p2 != null)&#123; p2 = p2.next; difference++; &#125; p1 = headA; p2 = headB; for(int i = 0;i &lt; difference;i++)&#123; p2 = p2.next; &#125; while (p1 != p2)&#123; p1 = p1.next; p2 = p2.next; &#125; return p1; &#125; // è¯´æ˜ headB æ˜¯çŸ­é“¾è¡¨ else&#123; int difference = 0; while(p1 != null)&#123; p1 = p1.next; difference++; &#125; p1 = headA; p2 = headB; for(int i = 0;i &lt; difference;i++)&#123; p1 = p1.next; &#125; while (p1 != p2)&#123; p1 = p1.next; p2 = p2.next; &#125; return p1; &#125; &#125;&#125; Code II 123456789public ListNode getIntersectionNode(ListNode headA, ListNode headB) &#123; if (headA == null || headB == null) return null; ListNode pA = headA, pB = headB; while (pA != pB) &#123; pA = pA == null ? headB : pA.next; pB = pB == null ? headA : pB.next; &#125; return pA;&#125; 234. å›æ–‡é“¾è¡¨é¢˜ç›®è¯·åˆ¤æ–­ä¸€ä¸ªé“¾è¡¨æ˜¯å¦ä¸ºå›æ–‡é“¾è¡¨ã€‚ ç¤ºä¾‹ 1: 12è¾“å…¥: 1-&gt;2è¾“å‡º: false ç¤ºä¾‹ 2: 12è¾“å…¥: 1-&gt;2-&gt;2-&gt;1è¾“å‡º: true æ€è·¯ é“¾è¡¨è½¬åˆ—è¡¨ 1.å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°é“¾è¡¨çš„ä¸­ç‚¹2.ç¿»è½¬é“¾è¡¨å‰åŠéƒ¨åˆ†3.å›æ–‡æ ¡éªŒ ä¸€è¾¹ç¿»è½¬ä¸€è¾¹å¿«æ…¢æŒ‡é’ˆéå† ä»£ç  Case I 1234567891011121314151617181920212223242526class Solution &#123; public boolean isPalindrome(ListNode head) &#123; List&lt;Integer&gt; vals = new ArrayList&lt;&gt;(); // Convert LinkedList into ArrayList. ListNode currentNode = head; while (currentNode != null) &#123; vals.add(currentNode.val); currentNode = currentNode.next; &#125; // Use two-pointer technique to check for palindrome. int front = 0; int back = vals.size() - 1; while (front &lt; back) &#123; // Note that we must use ! .equals instead of != // because we are comparing Integer, not int. if (!vals.get(front).equals(vals.get(back))) &#123; return false; &#125; front++; back--; &#125; return true; &#125;&#125; Case II 123456789101112131415161718192021222324252627282930313233343536public boolean isPalindrome(ListNode head) &#123; if (head == null || head.next == null) &#123; return true; &#125; //å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°é“¾è¡¨çš„ä¸­ç‚¹ ListNode fast = head.next.next; ListNode slow = head.next; while (fast != null &amp;&amp; fast.next != null) &#123; fast = fast.next.next; slow = slow.next; &#125; //ç¿»è½¬é“¾è¡¨å‰åŠéƒ¨åˆ† ListNode pre = null; ListNode next = null; while (head != slow) &#123; next = head.next; head.next = pre; pre = head; head = next; &#125; //å¦‚æœæ˜¯å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼Œå»æ‰ååŠéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ if (fast != null) &#123; slow = slow.next; &#125; //å›æ–‡æ ¡éªŒ while (pre != null) &#123; if (pre.val != slow.val) &#123; return false; &#125; pre = pre.next; slow = slow.next; &#125; return true; &#125; Case III 12345678910111213141516171819202122232425public boolean isPalindrome(ListNode head) &#123; if(head == null || head.next == null) &#123; return true; &#125; ListNode slow = head, fast = head; ListNode pre = head, prepre = null; while(fast != null &amp;&amp; fast.next != null) &#123; pre = slow; slow = slow.next; fast = fast.next.next; pre.next = prepre; prepre = pre; &#125; if(fast != null) &#123; slow = slow.next; &#125; while(pre != null &amp;&amp; slow != null) &#123; if(pre.val != slow.val) &#123; return false; &#125; pre = pre.next; slow = slow.next; &#125; return true;&#125; 169. å¤šæ•°å…ƒç´ é¢˜ç›®ç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­çš„å¤šæ•°å…ƒç´ ã€‚å¤šæ•°å…ƒç´ æ˜¯æŒ‡åœ¨æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°å¤§äº âŒŠ n/2 âŒ‹ çš„å…ƒç´ ã€‚ ä½ å¯ä»¥å‡è®¾æ•°ç»„æ˜¯éç©ºçš„ï¼Œå¹¶ä¸”ç»™å®šçš„æ•°ç»„æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ã€‚ ç¤ºä¾‹ 1: 12è¾“å…¥: [3,2,3]è¾“å‡º: 3 ç¤ºä¾‹ 2: 12è¾“å…¥: [2,2,1,1,1,2,2]è¾“å‡º: 2 æ€è·¯ å“ˆå¸Œè¡¨å­˜å‚¨ã€‚ æŠ•ç¥¨ç®—æ³•ï¼Œå¦‚æœæˆ‘ä»¬æŠŠä¼—æ•°è®°ä¸º +1 ï¼ŒæŠŠå…¶ä»–æ•°è®°ä¸º âˆ’1 ï¼Œå°†å®ƒä»¬å…¨éƒ¨åŠ èµ·æ¥ï¼Œæ˜¾ç„¶å’Œå¤§äº 0 ï¼Œä»ç»“æœæœ¬èº«æˆ‘ä»¬å¯ä»¥çœ‹å‡ºä¼—æ•°æ¯”å…¶ä»–æ•°å¤šã€‚æœ¬è´¨ä¸Šï¼Œ Boyer-Moore ç®—æ³•å°±æ˜¯æ‰¾ nums çš„ä¸€ä¸ªåç¼€ suf ï¼Œå…¶ä¸­ suf[0] å°±æ˜¯åç¼€ä¸­çš„ä¼—æ•°ã€‚æˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¦‚æœé‡åˆ°ä¸€ä¸ªæˆ‘ä»¬ç›®å‰çš„å€™é€‰ä¼—æ•°ï¼Œå°±å°†è®¡æ•°å™¨åŠ ä¸€ï¼Œå¦åˆ™å‡ä¸€ã€‚åªè¦è®¡æ•°å™¨ç­‰äº 0 ï¼Œæˆ‘ä»¬å°±å°† nums ä¸­ä¹‹å‰è®¿é—®çš„æ•°å­—å…¨éƒ¨ å¿˜è®° ï¼Œå¹¶æŠŠä¸‹ä¸€ä¸ªæ•°å­—å½“åšå€™é€‰çš„ä¼—æ•°ã€‚ ä»£ç  Case I 123456789101112class Solution &#123; public int majorityElement(int[] nums) &#123; int majority = nums.length / 2; Map&lt;Integer, Integer&gt; numCount = new HashMap&lt;&gt;(); for (int num : nums) &#123; int count = numCount.getOrDefault(num, 0) + 1; if (count &gt; majority) return num; numCount.put(num, count); &#125; return -1; &#125;&#125; Case II 123456789101112131415class Solution &#123; public int majorityElement(int[] nums) &#123; int count = 0; Integer candidate = null; for (int num : nums) &#123; if (count == 0) &#123; candidate = num; &#125; count += (num == candidate) ? 1 : -1; &#125; return candidate; &#125;&#125; 200. å²›å±¿æ•°é‡é¢˜ç›®ç»™å®šä¸€ä¸ªç”± â€˜1â€™ï¼ˆé™†åœ°ï¼‰å’Œ â€˜0â€™ï¼ˆæ°´ï¼‰ç»„æˆçš„çš„äºŒç»´ç½‘æ ¼ï¼Œè®¡ç®—å²›å±¿çš„æ•°é‡ã€‚ä¸€ä¸ªå²›è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”å®ƒæ˜¯é€šè¿‡æ°´å¹³æ–¹å‘æˆ–å‚ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥è€Œæˆçš„ã€‚ä½ å¯ä»¥å‡è®¾ç½‘æ ¼çš„å››ä¸ªè¾¹å‡è¢«æ°´åŒ…å›´ã€‚ ç¤ºä¾‹ 1: 1234567è¾“å…¥:11110110101100000000è¾“å‡º: 1 ç¤ºä¾‹ 2: 1234567è¾“å…¥:11000110000010000011è¾“å‡º: 3 æ€è·¯æ€è·¯ä¸€ï¼šæ·±åº¦ä¼˜å…ˆéå†DFS ç›®æ ‡æ˜¯æ‰¾åˆ°çŸ©é˜µä¸­ â€œå²›å±¿çš„æ•°é‡â€ ï¼Œä¸Šä¸‹å·¦å³ç›¸è¿çš„ 1 éƒ½è¢«è®¤ä¸ºæ˜¯è¿ç»­å²›å±¿ã€‚ dfsæ–¹æ³•ï¼š è®¾ç›®å‰æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå²›å±¿ä¸­çš„æŸä¸€ç‚¹ (i, j)ï¼Œå¯»æ‰¾åŒ…æ‹¬æ­¤ç‚¹çš„å²›å±¿è¾¹ç•Œã€‚ ä» (i, j) å‘æ­¤ç‚¹çš„ä¸Šä¸‹å·¦å³ (i+1,j),(i-1,j),(i,j+1),(i,j-1) åšæ·±åº¦æœç´¢ã€‚ ç»ˆæ­¢æ¡ä»¶ï¼š (i, j) è¶Šè¿‡çŸ©é˜µè¾¹ç•Œ; grid[i][j]== 0ï¼Œä»£è¡¨æ­¤åˆ†æ”¯å·²è¶Šè¿‡å²›å±¿è¾¹ç•Œã€‚ æœç´¢å²›å±¿çš„åŒæ—¶ï¼Œæ‰§è¡Œ grid[i][j] = â€˜0â€™ï¼Œå³å°†å²›å±¿æ‰€æœ‰èŠ‚ç‚¹åˆ é™¤ï¼Œä»¥å…ä¹‹åé‡å¤æœç´¢ç›¸åŒå²›å±¿ã€‚ ä¸»å¾ªç¯ï¼š éå†æ•´ä¸ªçŸ©é˜µï¼Œå½“é‡åˆ° grid[i][j] == â€˜1â€™ æ—¶ï¼Œä»æ­¤ç‚¹å¼€å§‹åšæ·±åº¦ä¼˜å…ˆæœç´¢ dfsï¼Œå²›å±¿æ•° count + 1 ä¸”åœ¨æ·±åº¦ä¼˜å…ˆæœç´¢ä¸­åˆ é™¤æ­¤å²›å±¿ã€‚ æœ€ç»ˆè¿”å›å²›å±¿æ•° count å³å¯ã€‚ æ€è·¯äºŒï¼šå¹¿åº¦ä¼˜å…ˆéå†BFS ä¸»å¾ªç¯å’Œæ€è·¯ä¸€ç±»ä¼¼ï¼Œä¸åŒç‚¹æ˜¯åœ¨äºæœç´¢æŸå²›å±¿è¾¹ç•Œçš„æ–¹æ³•ä¸åŒã€‚ bfs æ–¹æ³•ï¼š å€Ÿç”¨ä¸€ä¸ªé˜Ÿåˆ— queueï¼Œåˆ¤æ–­é˜Ÿåˆ—é¦–éƒ¨èŠ‚ç‚¹ (i, j) æ˜¯å¦æœªè¶Šç•Œä¸”ä¸º 1ï¼š è‹¥æ˜¯åˆ™ç½®é›¶ï¼ˆåˆ é™¤å²›å±¿èŠ‚ç‚¹ï¼‰ï¼Œå¹¶å°†æ­¤èŠ‚ç‚¹ä¸Šä¸‹å·¦å³èŠ‚ç‚¹ (i+1,j),(i-1,j),(i,j+1),(i,j-1) åŠ å…¥é˜Ÿåˆ—ï¼› è‹¥ä¸æ˜¯åˆ™è·³è¿‡æ­¤èŠ‚ç‚¹ï¼› å¾ªç¯ pop é˜Ÿåˆ—é¦–èŠ‚ç‚¹ï¼Œç›´åˆ°æ•´ä¸ªé˜Ÿåˆ—ä¸ºç©ºï¼Œæ­¤æ—¶å·²ç»éå†å®Œæ­¤å²›å±¿ã€‚ ä»£ç  Case I 12345678910111213141516171819202122class Solution &#123; public int numIslands(char[][] grid) &#123; int count = 0; for(int i = 0; i &lt; grid.length; i++) &#123; for(int j = 0; j &lt; grid[0].length; j++) &#123; if(grid[i][j] == '1')&#123; dfs(grid, i, j); count++; &#125; &#125; &#125; return count; &#125; private void dfs(char[][] grid, int i, int j)&#123; if(i &lt; 0 || j &lt; 0 || i &gt;= grid.length || j &gt;= grid[0].length || grid[i][j] == '0') return; grid[i][j] = '0'; dfs(grid, i + 1, j); dfs(grid, i, j + 1); dfs(grid, i - 1, j); dfs(grid, i, j - 1); &#125;&#125; Case II 1234567891011121314151617181920212223242526272829class Solution &#123; public int numIslands(char[][] grid) &#123; int count = 0; for(int i = 0; i &lt; grid.length; i++) &#123; for(int j = 0; j &lt; grid[0].length; j++) &#123; if(grid[i][j] == '1')&#123; bfs(grid, i, j); count++; &#125; &#125; &#125; return count; &#125; private void bfs(char[][] grid, int i, int j)&#123; Queue&lt;int[]&gt; list = new LinkedList&lt;&gt;(); list.add(new int[] &#123; i, j &#125;); while(!list.isEmpty())&#123; int[] cur = list.remove(); i = cur[0]; j = cur[1]; if(0 &lt;= i &amp;&amp; i &lt; grid.length &amp;&amp; 0 &lt;= j &amp;&amp; j &lt; grid[0].length &amp;&amp; grid[i][j] == '1') &#123; grid[i][j] = '0'; list.add(new int[] &#123; i + 1, j &#125;); list.add(new int[] &#123; i - 1, j &#125;); list.add(new int[] &#123; i, j + 1 &#125;); list.add(new int[] &#123; i, j - 1 &#125;); &#125; &#125; &#125;&#125; ä½œè€…ï¼šjydé“¾æ¥ï¼šhttps://leetcode-cn.com/problems/number-of-islands/solution/number-of-islands-shen-du-you-xian-bian-li-dfs-or-/æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ å¹¶æŸ¥é›† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980class Solution &#123; class UnionFind &#123; int count; // # of connected components int[] parent; int[] rank; public UnionFind(char[][] grid) &#123; // for problem 200 count = 0; int m = grid.length; int n = grid[0].length; parent = new int[m * n]; rank = new int[m * n]; for (int i = 0; i &lt; m; ++i) &#123; for (int j = 0; j &lt; n; ++j) &#123; if (grid[i][j] == '1') &#123; parent[i * n + j] = i * n + j; ++count; &#125; rank[i * n + j] = 0; &#125; &#125; &#125; public int find(int i) &#123; // path compression if (parent[i] != i) parent[i] = find(parent[i]); return parent[i]; &#125; public void union(int x, int y) &#123; // union with rank int rootx = find(x); int rooty = find(y); if (rootx != rooty) &#123; if (rank[rootx] &gt; rank[rooty]) &#123; parent[rooty] = rootx; &#125; else if (rank[rootx] &lt; rank[rooty]) &#123; parent[rootx] = rooty; &#125; else &#123; parent[rooty] = rootx; rank[rootx] += 1; &#125; --count; &#125; &#125; public int getCount() &#123; return count; &#125; &#125; public int numIslands(char[][] grid) &#123; if (grid == null || grid.length == 0) &#123; return 0; &#125; int nr = grid.length; int nc = grid[0].length; int num_islands = 0; UnionFind uf = new UnionFind(grid); for (int r = 0; r &lt; nr; ++r) &#123; for (int c = 0; c &lt; nc; ++c) &#123; if (grid[r][c] == '1') &#123; grid[r][c] = '0'; if (r - 1 &gt;= 0 &amp;&amp; grid[r-1][c] == '1') &#123; uf.union(r * nc + c, (r-1) * nc + c); &#125; if (r + 1 &lt; nr &amp;&amp; grid[r+1][c] == '1') &#123; uf.union(r * nc + c, (r+1) * nc + c); &#125; if (c - 1 &gt;= 0 &amp;&amp; grid[r][c-1] == '1') &#123; uf.union(r * nc + c, r * nc + c - 1); &#125; if (c + 1 &lt; nc &amp;&amp; grid[r][c+1] == '1') &#123; uf.union(r * nc + c, r * nc + c + 1); &#125; &#125; &#125; &#125; return uf.getCount(); &#125;&#125; 221. æœ€å¤§æ­£æ–¹å½¢é¢˜ç›®åœ¨ä¸€ä¸ªç”± 0 å’Œ 1 ç»„æˆçš„äºŒç»´çŸ©é˜µå†…ï¼Œæ‰¾åˆ°åªåŒ…å« 1 çš„æœ€å¤§æ­£æ–¹å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚ ç¤ºä¾‹: 12345678è¾“å…¥: 1 0 1 0 01 0 1 1 11 1 1 1 11 0 0 1 0è¾“å‡º: 4 æ€è·¯å‰é¢åšäº†ä¸€é¢˜æ±‚ æœ€å¤§é•¿æ–¹å½¢çš„é¢˜ç›®ï¼Œå½“æ—¶çš„æ€è·¯æ˜¯ç”¨çš„ç¬¬ 84 é¢˜ æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ ï¼Œåˆ†åˆ«æ±‚æ¯ä¸€è¡Œçš„æœ€å¤§çŸ©å½¢ï¼Œæœ€åå¾—åˆ° æ•´ä¸ªçš„æœ€å¤§é•¿æ–¹å½¢ã€‚è¿™é‡Œæ±‚æ­£æ–¹å½¢ï¼Œå°±ä¸èƒ½ç”¨é‚£ç§æ–¹æ³•äº†ï¼Œå¿…é¡»å¾—å¦è¾Ÿè¹Šå¾„ã€‚ è¿™é‡Œé‡‡ç”¨çš„æ˜¯ dpï¼Œæ—¢ç„¶æ˜¯æ‰¾æœ€å¤§æ­£æ–¹å½¢ï¼Œå…¶å®æ‰¾å¯¹ dpæ•°ç»„ä»£è¡¨ä»€ä¹ˆ å’Œ çŠ¶æ€è½¬ç§»æ–¹ç¨‹ å¦‚ä½•å†™ï¼Œå°±å®Œæˆäº†ï¼Œè¿™é‡Œçš„ dp æ•°ç»„ä»£è¡¨ä»¥ è¯¥å…ƒç´ ä¸ºå³ä¸‹è§’çš„æ­£æ–¹å½¢è¾¹é•¿ï¼Œæ•… dp(i, j)=min(dp(iâˆ’1, j), dp(iâˆ’1, jâˆ’1), dp(i, jâˆ’1))+1 ä»£ç 12345678910111213141516public class Solution &#123; public int maximalSquare(char[][] matrix) &#123; int rows = matrix.length, cols = rows &gt; 0 ? matrix[0].length : 0; int[][] dp = new int[rows + 1][cols + 1]; int maxsqlen = 0; for (int i = 1; i &lt;= rows; i++) &#123; for (int j = 1; j &lt;= cols; j++) &#123; if (matrix[i-1][j-1] == '1')&#123; dp[i][j] = Math.min(Math.min(dp[i][j - 1], dp[i - 1][j]), dp[i - 1][j - 1]) + 1; maxsqlen = Math.max(maxsqlen, dp[i][j]); &#125; &#125; &#125; return maxsqlen * maxsqlen; &#125;&#125; ç”±äºå½“å‰ dp[i][j] åªç”¨åˆ°äº†å·¦ä¸Šã€å·¦è¾¹ã€ä¸Šè¾¹ä¸‰ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥ä¸éœ€è¦å»ºç«‹ä¸€ä¸ªäºŒç»´æ•°ç»„å»æ“ä½œï¼Œåªéœ€è¦ç”¨ä¸€ä¸ªä¸€ç»´çš„æ•°ç»„å»å­˜æ¯ä¸€è¡Œå¯¹åº”çš„åˆ—çš„æ•°å°±è¡Œäº†ï¼Œå¯ä»¥å¤ç”¨ï¼Œè‡³äº å·¦ä¸Šè§’ çš„æ•°ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªå˜é‡å•ç‹¬è®°å½•ä¸€ä¸‹ï¼ˆè¿™ä¸ªæ˜¯çœŸçš„ç‰›çš®ï¼‰ 1234567891011121314151617181920public class Solution &#123; public int maximalSquare(char[][] matrix) &#123; int rows = matrix.length, cols = rows &gt; 0 ? matrix[0].length : 0; int[] dp = new int[cols + 1]; int maxsqlen = 0, prev = 0; for (int i = 1; i &lt;= rows; i++) &#123; for (int j = 1; j &lt;= cols; j++) &#123; int temp = dp[j]; if (matrix[i - 1][j - 1] == '1') &#123; dp[j] = Math.min(Math.min(dp[j - 1], prev), dp[j]) + 1; maxsqlen = Math.max(maxsqlen, dp[j]); &#125; else &#123; dp[j] = 0; &#125; prev = temp; &#125; &#125; return maxsqlen * maxsqlen; &#125;&#125; 207. è¯¾ç¨‹è¡¨é¢˜ç›®ç°åœ¨ä½ æ€»å…±æœ‰ n é—¨è¯¾éœ€è¦é€‰ï¼Œè®°ä¸º 0 åˆ° n-1ã€‚ åœ¨é€‰ä¿®æŸäº›è¯¾ç¨‹ä¹‹å‰éœ€è¦ä¸€äº›å…ˆä¿®è¯¾ç¨‹ã€‚ ä¾‹å¦‚ï¼Œæƒ³è¦å­¦ä¹ è¯¾ç¨‹ 0 ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 1 ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªåŒ¹é…æ¥è¡¨ç¤ºä»–ä»¬: [0,1] ç»™å®šè¯¾ç¨‹æ€»é‡ä»¥åŠå®ƒä»¬çš„å…ˆå†³æ¡ä»¶ï¼Œåˆ¤æ–­æ˜¯å¦å¯èƒ½å®Œæˆæ‰€æœ‰è¯¾ç¨‹çš„å­¦ä¹ ï¼Ÿ ç¤ºä¾‹ 1: 123è¾“å…¥: 2, [[1,0]] è¾“å‡º: trueè§£é‡Š: æ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚å­¦ä¹ è¯¾ç¨‹ 1 ä¹‹å‰ï¼Œä½ éœ€è¦å®Œæˆè¯¾ç¨‹ 0ã€‚æ‰€ä»¥è¿™æ˜¯å¯èƒ½çš„ã€‚ ç¤ºä¾‹ 2: 123è¾“å…¥: 2, [[1,0],[0,1]]è¾“å‡º: falseè§£é‡Š: æ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚å­¦ä¹ è¯¾ç¨‹ 1 ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 0ï¼›å¹¶ä¸”å­¦ä¹ è¯¾ç¨‹ 0 ä¹‹å‰ï¼Œä½ è¿˜åº”å…ˆå®Œæˆè¯¾ç¨‹ 1ã€‚è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚ æ€è·¯è¿™é¢˜æœ¬è´¨å°±æ˜¯æ‹“æ‰‘æ’åºï¼Œè§£å†³æ‹“æ‰‘æ’åºï¼Œä¸€èˆ¬å°±æ˜¯ä¸¤ä¸ªæ–¹æ³•ï¼šBFS å’Œ DFSã€‚å…¶æ ¸å¿ƒéƒ½æ˜¯èƒ½æ‹“æ‰‘æ’åºçš„éƒ½æ˜¯æœ‰å‘æ— ç¯å›¾ã€‚BFS ä¸»è¦æ˜¯ä» å…¥åº¦å‡ºåº¦è€ƒè™‘ï¼Œè€Œ DFS ä¸»è¦ä»æœ‰æ— ç¯è€ƒè™‘ã€‚ è¯¦ç»†æ€è·¯è§ï¼š https://leetcode-cn.com/problems/course-schedule/solution/course-schedule-tuo-bu-pai-xu-bfsdfsliang-chong-fa/ ä»£ç  BFS 12345678910111213141516171819202122232425262728293031class Solution &#123; // BFS public boolean canFinish(int numCourses, int[][] prerequisites) &#123; // è®°å½•æ¯ä¸ªç»“ç‚¹çš„å…¥åº¦ï¼Œç±»ä¼¼äºé‚»æ¥è¡¨ int[] indegrees = new int[numCourses]; // ç»Ÿè®¡æ¯ä¸ªç»“ç‚¹çš„å…¥åº¦æ•° // è¿™ä¸ªé¢˜ç›®çš„å¥½å¤„æ˜¯è¯¾ç¨‹æ˜¯ä»0å¼€å§‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”³è¯·ç©ºé—´å¾ˆæ–¹ä¾¿ for(int[] cp : prerequisites) indegrees[cp[0]]++; // é˜Ÿåˆ—ç”¨æ¥å­˜å‚¨å…¥åº¦ä¸º0çš„ç»“ç‚¹ LinkedList&lt;Integer&gt; queue = new LinkedList&lt;&gt;(); // å¦‚æœæ‰¾åˆ°å…¥åº¦ä¸º0çš„ï¼Œæ”¾å…¥é˜Ÿå°¾ for(int i = 0; i &lt; numCourses; i++)&#123; if(indegrees[i] == 0) queue.addLast(i); &#125; // åªè¦é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œå°±ä¸€ç›´å¾ªç¯ while(!queue.isEmpty()) &#123; // å–å‡ºé˜Ÿé¦–å…ƒç´  Integer pre = queue.removeFirst(); // ç›¸å½“äºåˆ é™¤æ“ä½œï¼Œè¯´æ˜æ­¤é—¨è¯¾ç¨‹å·²ç»å­¦å®Œ numCourses--; // ç„¶åæŠŠè¿™é—¨è¯¾ç¨‹çš„å‡ºåº¦åˆ é™¤ // å¹¶æŠŠæ–°çš„å…¥åº¦ä¸º0çš„è¯¾ç¨‹åŠ å…¥é˜Ÿåˆ— for(int[] req : prerequisites) &#123; if(req[1] != pre) continue; if(--indegrees[req[0]] == 0) queue.add(req[0]); &#125; &#125; // é˜Ÿåˆ—ä¸ºç©ºï¼Œå¦‚æœèƒ½å…¨éƒ¨å­¦ä¹ å®Œï¼ŒnumCourses == 0ï¼Œå¦åˆ™ä¸èƒ½å…¨éƒ¨å­¦ä¹ å®Œ return numCourses == 0; &#125;&#125; DFS 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849class Solution &#123; /** * DFS æ–¹æ³• * @param numCourses * @param prerequisites * @return */ public boolean canFinish(int numCourses, int[][] prerequisites) &#123; // ç”¨æ¥è¡¨ç¤ºèŠ‚ç‚¹ä¹‹é—´æ˜¯å¦æœ‰è¾¹,ç±»ä¼¼äº é‚»æ¥çŸ©é˜µ int[][] arc = new int[numCourses][numCourses]; for(int[] cp:prerequisites)&#123; arc[cp[1]][cp[0]] = 1; &#125; // å¯¹æ¯ä¸ªèŠ‚ç‚¹åˆ†åˆ«è¿›è¡Œdfs // dfs ä¸»è¦æ˜¯åˆ¤æ–­æ˜¯å¦æœ‰ç¯çš„å­˜åœ¨ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¼•å…¥ flag // flag == 1ï¼Œä»£è¡¨è¯¥èŠ‚ç‚¹æœ¬è½®dfså·²ç»è®¿é—®è¿‡äº†,å³æ­£åœ¨è®¿é—®çš„èŠ‚ç‚¹ // flag == -1ï¼Œä»£è¡¨ä»¥å‰çš„dfsè®¿é—®è¿‡äº† // flag == 0ï¼Œä»£è¡¨è¯¥èŠ‚ç‚¹ä»æœªè®¿é—®è¿‡ // åªæœ‰å½“æˆ‘ä»¬è®¿é—®åˆ°äº† flag == 1çš„èŠ‚ç‚¹ï¼Œè¯´æ˜å­˜åœ¨ç¯ int[] flag = new int[numCourses]; for(int i = 0;i &lt; numCourses;i++)&#123; if(dfs(arc,i,flag) == false) return false; &#125; return true; &#125; /** * dfs å…·ä½“æµç¨‹ * @param arc * @param i * @param flag * @return */ private boolean dfs(int[][] arc, int i, int[] flag) &#123; // å‘ç°æ˜¯æœ¬è½® dfs æ­£åœ¨è®¿é—®çš„èŠ‚ç‚¹ï¼Œæ•…å­˜åœ¨ç¯ if(flag[i] == 1) return false; // æ˜¯å…¶ä»–ç»“ç‚¹å‘èµ·çš„ dfsï¼Œæ²¡æœ‰å…³ç³»ï¼Œä¸èƒ½åˆ¤æ–­æ˜¯å¦æœ‰ç¯ if(flag[i] == -1) return true; // æ ‡è®°ä¸€ä¸‹æœ¬è½®dfsæ­£åœ¨è®¿é—®è¯¥èŠ‚ç‚¹ flag[i] = 1; // è¿›è¡Œ dfsï¼Œå‘ç°æœ‰ç¯ï¼Œè¿”å› false for(int j = 0;j &lt; arc.length;j++)&#123; if(arc[i][j] == 1 &amp;&amp; dfs(arc,j,flag) == false) return false; &#125; // è¯¥èŠ‚ç‚¹çš„ dfs ç»“æŸï¼Œæ ‡å¿—ä½å˜ä¸º -1 flag[i] = -1; return true; &#125;&#125; 208. å®ç° Trie (å‰ç¼€æ ‘)é¢˜ç›®å®ç°ä¸€ä¸ª Trie (å‰ç¼€æ ‘)ï¼ŒåŒ…å« insert, search, å’Œ startsWith è¿™ä¸‰ä¸ªæ“ä½œã€‚ ç¤ºä¾‹: 12345678Trie trie = new Trie();trie.insert("apple");trie.search("apple"); // è¿”å› truetrie.search("app"); // è¿”å› falsetrie.startsWith("app"); // è¿”å› truetrie.insert("app"); trie.search("app"); // è¿”å› true è¯´æ˜: ä½ å¯ä»¥å‡è®¾æ‰€æœ‰çš„è¾“å…¥éƒ½æ˜¯ç”±å°å†™å­—æ¯ a-z æ„æˆçš„ã€‚ ä¿è¯æ‰€æœ‰è¾“å…¥å‡ä¸ºéç©ºå­—ç¬¦ä¸²ã€‚ æ€è·¯ https://blog.csdn.net/qq_43152052/article/details/101109415 å¤§ä½¬å¯¹ leetcode å‰ç¼€æ ‘çš„ä¹ é¢˜æ€»ç»“ ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899package LeetCode_100_hotest;class Trie_208 &#123; public static void main(String[] args) &#123; Trie obj = new Trie(); String word = "apple"; String prefix = "app"; obj.insert(word); boolean param_2 = obj.search(word); boolean param_3 = obj.startsWith(prefix); System.out.println("param_2:" + param_2); System.out.println("param_3:" + param_3); &#125;&#125;class Trie &#123; private TrieNode root; public Trie() &#123; root = new TrieNode(); &#125; // Inserts a word into the trie. public void insert(String word) &#123; TrieNode node = root; for (int i = 0; i &lt; word.length(); i++) &#123; char currentChar = word.charAt(i); if (!node.containsKey(currentChar)) &#123; node.put(currentChar, new TrieNode()); &#125; node = node.get(currentChar); &#125; node.setEnd(); &#125; private TrieNode searchPrefix(String word) &#123; TrieNode node = root; for (int i = 0; i &lt; word.length(); i++) &#123; char curLetter = word.charAt(i); if (node.containsKey(curLetter)) &#123; node = node.get(curLetter); &#125; else &#123; return null; &#125; &#125; return node; &#125; // Returns if the word is in the trie. public boolean search(String word) &#123; TrieNode node = searchPrefix(word); return node != null &amp;&amp; node.isEnd(); &#125; public boolean startsWith(String prefix) &#123; TrieNode node = searchPrefix(prefix); return node != null; &#125;&#125;class TrieNode &#123; // R links to node children // è¿™é‡Œä¸æ­¢æ˜¯ leftã€rightï¼Œæ‰€ä»¥å¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„ç»„æˆ private TrieNode[] links; private final int R = 26; private boolean isEnd; public TrieNode() &#123; links = new TrieNode[R]; &#125; public boolean containsKey(char ch) &#123; return links[ch -'a'] != null; &#125; public TrieNode get(char ch) &#123; return links[ch -'a']; &#125; public void put(char ch, TrieNode node) &#123; links[ch -'a'] = node; &#125; public void setEnd() &#123; isEnd = true; &#125; public boolean isEnd() &#123; return isEnd; &#125;&#125;/** * Your Trie object will be instantiated and called as such: * Trie obj = new Trie(); * obj.insert(word); * boolean param_2 = obj.search(word); * boolean param_3 = obj.startsWith(prefix); */ 739. æ¯æ—¥æ¸©åº¦é¢˜ç›®æ ¹æ®æ¯æ—¥ æ°”æ¸© åˆ—è¡¨ï¼Œè¯·é‡æ–°ç”Ÿæˆä¸€ä¸ªåˆ—è¡¨ï¼Œå¯¹åº”ä½ç½®çš„è¾“å…¥æ˜¯ä½ éœ€è¦å†ç­‰å¾…å¤šä¹…æ¸©åº¦æ‰ä¼šå‡é«˜è¶…è¿‡è¯¥æ—¥çš„å¤©æ•°ã€‚å¦‚æœä¹‹åéƒ½ä¸ä¼šå‡é«˜ï¼Œè¯·åœ¨è¯¥ä½ç½®ç”¨ 0 æ¥ä»£æ›¿ã€‚ ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªåˆ—è¡¨ temperatures = [73, 74, 75, 71, 69, 72, 76, 73]ï¼Œä½ çš„è¾“å‡ºåº”è¯¥æ˜¯ [1, 1, 4, 2, 1, 1, 0, 0]ã€‚ æç¤ºï¼šæ°”æ¸© åˆ—è¡¨é•¿åº¦çš„èŒƒå›´æ˜¯ [1, 30000]ã€‚æ¯ä¸ªæ°”æ¸©çš„å€¼çš„å‡ä¸ºåæ°åº¦ï¼Œéƒ½æ˜¯åœ¨ [30, 100] èŒƒå›´å†…çš„æ•´æ•°ã€‚ æ€è·¯å¾ˆæ˜æ˜¾æ˜¯é‡‡ç”¨å•è°ƒæ ˆçš„æ–¹æ³•ï¼Œå…·ä½“è§ https://labuladong.gitbook.io/algo/shu-ju-jie-gou-xi-lie/dan-tiao-zhan ä»£ç 1234567891011121314class Solution &#123; public int[] dailyTemperatures(int[] T) &#123; Stack&lt;Integer&gt; stack = new Stack&lt;&gt;(); int[] ans = new int[T.length]; for(int i = T.length - 1; i &gt;= 0;i--)&#123; while(!stack.isEmpty() &amp;&amp; T[i] &gt;= T[stack.peek()])&#123; stack.pop(); &#125; ans[i] = stack.isEmpty() == true ? 0 : (stack.peek() - i); stack.push(i); &#125; return ans; &#125;&#125; 621. ä»»åŠ¡è°ƒåº¦å™¨é¢˜ç›®ç»™å®šä¸€ä¸ªç”¨å­—ç¬¦æ•°ç»„è¡¨ç¤ºçš„ CPU éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚å…¶ä¸­åŒ…å«ä½¿ç”¨å¤§å†™çš„ A - Z å­—æ¯è¡¨ç¤ºçš„26 ç§ä¸åŒç§ç±»çš„ä»»åŠ¡ã€‚ä»»åŠ¡å¯ä»¥ä»¥ä»»æ„é¡ºåºæ‰§è¡Œï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥åœ¨ 1 ä¸ªå•ä½æ—¶é—´å†…æ‰§è¡Œå®Œã€‚CPU åœ¨ä»»ä½•ä¸€ä¸ªå•ä½æ—¶é—´å†…éƒ½å¯ä»¥æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œæˆ–è€…åœ¨å¾…å‘½çŠ¶æ€ã€‚ ç„¶è€Œï¼Œä¸¤ä¸ªç›¸åŒç§ç±»çš„ä»»åŠ¡ä¹‹é—´å¿…é¡»æœ‰é•¿åº¦ä¸º n çš„å†·å´æ—¶é—´ï¼Œå› æ­¤è‡³å°‘æœ‰è¿ç»­ n ä¸ªå•ä½æ—¶é—´å†… CPU åœ¨æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œæˆ–è€…åœ¨å¾…å‘½çŠ¶æ€ã€‚ ä½ éœ€è¦è®¡ç®—å®Œæˆæ‰€æœ‰ä»»åŠ¡æ‰€éœ€è¦çš„æœ€çŸ­æ—¶é—´ã€‚ ç¤ºä¾‹ 1 123è¾“å…¥: tasks = ["A","A","A","B","B","B"], n = 2è¾“å‡º: 8æ‰§è¡Œé¡ºåº: A -&gt; B -&gt; (å¾…å‘½) -&gt; A -&gt; B -&gt; (å¾…å‘½) -&gt; A -&gt; B. æ€è·¯ æ¡¶æ€æƒ³ï¼Œæ¯ä¸ªæ¡¶å›ºå®šå¤§å°ä¸º n+1ï¼ˆé™¤æœ€åä¸€ä¸ªæ¡¶ä¹‹å¤–ï¼‰ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ç›¸åŒçš„ä»»åŠ¡å¯ä»¥åˆ†åœ¨ä¸åŒçš„æ¡¶ä¸­ å½“ç„¶ï¼Œæ¯ä¸ªä»»åŠ¡åœ¨æ¡¶ä¸­çš„æ¬¡åºæ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚è¯´ A åœ¨æ¡¶åº•ï¼Œé‚£ä¹ˆåœ¨æ¯ä¸ªæ¡¶ä¸­ A éƒ½åœ¨åº•éƒ¨ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ç›¸åŒä»»åŠ¡çš„é—´éš”æ—¶é—´éƒ½ä¸å°äº n æ¡¶çš„æ•°é‡ç”± æ‹¥æœ‰æœ€å¤šä»»åŠ¡æ•°çš„é‚£ä¸ªä»»åŠ¡å†³å®šï¼Œåªè¦ä»–ä¿è¯äº†å†·å´æ—¶é—´ï¼Œå…¶ä»–çš„ä¸€å®šå¯ä»¥ ç»“æœå°±æ˜¯ (n+1) \ (count - 1) + æœ€åä¸€ä¸ªæ¡¶çš„å¤§å°*ï¼Œcount ä¸ºæ¡¶çš„æ•°é‡ï¼Œå› ä¸ºæœ€åä¸€ä¸ªæ¡¶æ— éœ€å›ºå®šå¤§å° count å¾ˆå¥½æ±‚ï¼Œé‚£æœ€åä¸€ä¸ªæ¡¶å¤§å°å¦‚ä½•æ±‚å‘¢ï¼Œå¾ˆæ˜æ˜¾å°±æ˜¯ æ‹¥æœ‰æœ€å¤šæ•°ä»»åŠ¡çš„ä¸ªæ•°ï¼Œæ¯”å¦‚AAABBBCCCDDEEï¼Œé‚£æœ€åä¸€ä¸ªæ¡¶çš„å¤§å°å°±æ˜¯ 3ï¼Œå› ä¸º A B C éƒ½æ˜¯æ‹¥æœ‰ 3 ä¸ªä»»åŠ¡æ•° å¦‚æœå†·å´æ—¶é—´è¿‡çŸ­ï¼Œä»»åŠ¡æ•°è¿‡å¤šï¼Œä¹Ÿå°±æ˜¯è¯´æ¡¶ä¸å¤Ÿç”¨äº†ï¼Œæ¯”å¦‚è¯´ AAABBBCCCDDEE ä¸” n = 2 è¿™ç§æƒ…å†µï¼Œæ­¤æ—¶ æ¡¶çš„å¤§å°ä¸º 3ï¼Œæ¡¶çš„æ•°é‡ä¸º 3ã€‚ç¬¬ä¸€ä¸ªæ¡¶ ABC ï¼Œç¬¬äºŒä¸ª ABCï¼Œç¬¬ä¸‰ä¸ª ABCï¼Œæ­¤æ—¶çš„ D å’Œ E æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæŒ‰ç…§ä¸€å®šæ¬¡åºæ”¾åœ¨æ¡¶ä¹‹ä¸Šå°±è¡Œ ï¼Œä¹Ÿå°±æ˜¯ä¸ç”¨æ”¾åˆ°æ¡¶ä¸­ï¼Œè¿™æ ·ä¸ä¼šå½±å“æ¡¶å†…å…ƒç´  ç”±äº D å’Œ E çš„å‡ºç°æ¬¡æ•°æ˜¯ä¸€å®šå°äºæ¡¶çš„æ•°é‡çš„ï¼Œæ‰€ä»¥æœ€å¤šæ¯ä¸ªæ¡¶ä¸Šæ”¾ä¸€ä¸ªç›¸åŒä»»åŠ¡ï¼Œè¿™æ · D å’Œ E æŒ‰æ¬¡åºæ’å¸ƒæ˜¯ä¸€å®šç¬¦åˆè¦æ±‚çš„ æ­¤æ—¶çš„ç­”æ¡ˆå°±æ˜¯ ä»»åŠ¡æ€»æ•° äº†ï¼Œå› ä¸ºæ‰€æœ‰çš„æ¡¶éƒ½æ»¡äº†ï¼Œå¹¶ä¸”å¤šå‡ºæ¥çš„ä¹Ÿæ˜¯ä»»åŠ¡ï¼Œæ²¡æœ‰å¾…å‘½æ—¶é—´ æ•…ç­”æ¡ˆå°±æ˜¯ ä¸¤ä¸ªæ—¶é—´ çš„æœ€å¤§å€¼ ä»£ç 1234567891011121314151617181920class Solution &#123; public int leastInterval(char[] tasks, int n) &#123; HashMap&lt;Character, Integer&gt; task_map = new HashMap&lt;&gt;(); // è®°å½• å•ä¸ªä»»åŠ¡å‡ºç°çš„æœ€å¤šçš„æ¬¡æ•° int max_count = 0; // è®°å½• æœ‰æœ€å¤šä»»åŠ¡æ•°çš„ ä»»åŠ¡ä¸ªæ•° int difference = 0; for (Character task : tasks) &#123; int count = task_map.getOrDefault(task, 0) + 1; task_map.put(task, count); max_count = Math.max(max_count,count); &#125; for(Map.Entry&lt;Character, Integer&gt; entry:task_map.entrySet())&#123; if(entry.getValue() == max_count) difference++; &#125; int number1 = (n + 1) * (max_count - 1) + difference; int number2 = tasks.length; return Math.max(number1,number2); &#125;&#125; 581. æœ€çŸ­æ— åºè¿ç»­å­æ•°ç»„é¢˜ç›®ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œä½ éœ€è¦å¯»æ‰¾ä¸€ä¸ªè¿ç»­çš„å­æ•°ç»„ï¼Œå¦‚æœå¯¹è¿™ä¸ªå­æ•°ç»„è¿›è¡Œå‡åºæ’åºï¼Œé‚£ä¹ˆæ•´ä¸ªæ•°ç»„éƒ½ä¼šå˜ä¸ºå‡åºæ’åºã€‚ ä½ æ‰¾åˆ°çš„å­æ•°ç»„åº”æ˜¯æœ€çŸ­çš„ï¼Œè¯·è¾“å‡ºå®ƒçš„é•¿åº¦ã€‚ ç¤ºä¾‹ 1: 123è¾“å…¥: [2, 6, 4, 8, 10, 9, 15]è¾“å‡º: 5è§£é‡Š: ä½ åªéœ€è¦å¯¹ [6, 4, 8, 10, 9] è¿›è¡Œå‡åºæ’åºï¼Œé‚£ä¹ˆæ•´ä¸ªè¡¨éƒ½ä¼šå˜ä¸ºå‡åºæ’åºã€‚ æ€è·¯æˆ‘é‡‡ç”¨çš„æ˜¯æ’åº ä»£ç 12345678910111213141516171819202122232425class Solution &#123; public int findUnsortedSubarray(int[] nums) &#123; int[] copy = Arrays.copyOf(nums,nums.length); Arrays.sort(copy); int start = 0; int end = 0; for(int i = 0;i &lt; nums.length;i++)&#123; if(nums[i] != copy[i])&#123; start = i; break; &#125; &#125; for(int j = nums.length-1;j &gt;= 0;j--)&#123; if(nums[j] != copy[j])&#123; end = j; // å…¶å®è¿™æ­¥åº”è¯¥æ”¾åˆ°æœ€å end - start + 1 // ä½†æ˜¯ä¸ºäº†é˜²æ­¢num.length == 0 ä»¥åŠ æ­£åºçš„æ•°ç»„ ç»“æœæ­£ç¡® // å°±æ”¾åˆ°äº†è¿™é‡Œ end++; break; &#125; &#125; return end - start; &#125;&#125; 560. å’Œä¸ºKçš„å­æ•°ç»„é¢˜ç›®ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„å’Œä¸€ä¸ªæ•´æ•° kï¼Œä½ éœ€è¦æ‰¾åˆ°è¯¥æ•°ç»„ä¸­å’Œä¸º k çš„è¿ç»­çš„å­æ•°ç»„çš„ä¸ªæ•°ã€‚ ç¤ºä¾‹ 1 : 12è¾“å…¥:nums = [1,1,1], k = 2è¾“å‡º: 2 , [1,1] ä¸ [1,1] ä¸ºä¸¤ç§ä¸åŒçš„æƒ…å†µã€‚ æ€è·¯ æš´åŠ›æ³•ï¼Œä¸¤æ¬¡ for å¾ªç¯ï¼Œé¦–å…ˆæ˜¯ startï¼Œç„¶å end ä»ç¬¬ä¸€ä¸ªæ•°å¼€å§‹ï¼Œå½“ç¢°åˆ° sum = k æ—¶ count å°± + 1 dpã€‚dp[i] è¡¨ç¤ºä»0åˆ°ç¬¬ i ä¸ªæ•°çš„æ€»å’Œï¼Œåˆ™ dp[j] - dp[i] = kï¼Œè¿™ä¸ª dp[i] çš„ä¸ªæ•°å°±æ˜¯ è¿ç»­å­æ•°ç»„çš„ä¸ªæ•°ï¼Œè¿™é‡Œå¯ä»¥ç”¨ HashMap ç›´æ¥å­˜å‚¨ å’Œ ä»¥åŠ å’Œ å‡ºç°çš„æ¬¡æ•°ï¼Œè¿™æ ·å°±å¯ä»¥éå¸¸æ–¹ä¾¿çš„æ±‚å¾— dp[i] çš„ä¸ªæ•°ã€‚ ä»£ç  æš´åŠ›æ³• 12345678910111213141516class Solution &#123; public int subarraySum(int[] nums, int k) &#123; if (nums.length == 0) return 0; int res = 0; for (int i = 0; i &lt; nums.length; i++) &#123; int sum = 0; for (int j = i; j &lt; nums.length; j++) &#123; sum += nums[j]; if (sum == k) &#123; res++; &#125; &#125; &#125; return res; &#125;&#125; dp 123456789101112131415161718192021222324import java.util.HashMap;class Solution &#123; public static void main(String[] args) &#123; new Solution().subarraySum(new int[]&#123;0, 0, 0, 0, 0, 0, 0, 0, 0, 0&#125;, 0); &#125; public int subarraySum(int[] nums, int k) &#123; if (nums == null || nums.length == 0) return 0; //dp[i]è¡¨ç¤ºå‰iä¸ªæ•°çš„å’Œ int[] dp = new int[nums.length + 1]; for (int i = 1; i &lt;= nums.length; i++) &#123; dp[i] = dp[i - 1] + nums[i - 1]; &#125; int ret = 0; HashMap&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); for (int i = 0; i &lt; dp.length; i++) &#123; if (map.containsKey(dp[i] - k)) ret += map.get(dp[i] - k); map.put(dp[i], map.getOrDefault(dp[i], 0) + 1); &#125; return ret; &#125;&#125; dp ä¼˜åŒ– 123456789101112131415public class Solution &#123; public int subarraySum(int[] nums, int k) &#123; int count = 0, sum = 0; HashMap&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); // å’Œä¸º0çš„æ€»å’Œï¼Œå‡ºç°äº†ä¸€æ¬¡ map.put(0, 1); for (int i = 0; i &lt; nums.length; i++) &#123; sum += nums[i]; if (map.containsKey(sum - k)) count += map.get(sum - k); map.put(sum, map.getOrDefault(sum, 0) + 1); &#125; return count; &#125;&#125; 238. é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯é¢˜ç›®ç»™å®šé•¿åº¦ä¸º n çš„æ•´æ•°æ•°ç»„ numsï¼Œå…¶ä¸­ n &gt; 1ï¼Œè¿”å›è¾“å‡ºæ•°ç»„ output ï¼Œå…¶ä¸­ output[i] ç­‰äº nums ä¸­é™¤ nums[i] ä¹‹å¤–å…¶ä½™å„å…ƒç´ çš„ä¹˜ç§¯ã€‚ ç¤ºä¾‹: 12è¾“å…¥: [1,2,3,4]è¾“å‡º: [24,12,8,6] è¯´æ˜: è¯·ä¸è¦ä½¿ç”¨é™¤æ³•ï¼Œä¸”åœ¨ O(n) æ—¶é—´å¤æ‚åº¦å†…å®Œæˆæ­¤é¢˜ã€‚ è¿›é˜¶ï¼šä½ å¯ä»¥åœ¨å¸¸æ•°ç©ºé—´å¤æ‚åº¦å†…å®Œæˆè¿™ä¸ªé¢˜ç›®å—ï¼Ÿï¼ˆ å‡ºäºå¯¹ç©ºé—´å¤æ‚åº¦åˆ†æçš„ç›®çš„ï¼Œè¾“å‡ºæ•°ç»„ä¸è¢«è§†ä¸ºé¢å¤–ç©ºé—´ã€‚ï¼‰ æ€è·¯ å·¦è¾¹ä¹˜ç§¯ \ å³è¾¹ä¹˜ç§¯*ï¼Œé¢˜ç›®ä¸­è¦æ±‚ä½¿ç”¨ O(1) çš„ç©ºé—´å¤æ‚åº¦ï¼Œä½†æ˜¯ è¾“å‡ºæ•°ç»„ ä¸è¢«è§†ä¸ºé¢å¤–ç©ºé—´ï¼Œäºæ˜¯å¯ä»¥ç”¨å·¦è¾¹ä¹˜ç§¯ * å³è¾¹ä¹˜ç§¯ï¼Œå…·ä½“è§ä»£ç ï¼ ä»£ç 123456789101112131415161718class Solution &#123; public int[] productExceptSelf(int[] nums) &#123; int[] res = new int[nums.length]; res[0] = 1; for(int i = 1;i &lt; nums.length;i++)&#123; // æ­¤æ—¶æ˜¯è®¡ç®—æ¯ä¸ªå€¼çš„å·¦è¾¹ä¹˜ç§¯ res[i] = res[i-1] * nums[i-1]; &#125; // æ­¤æ—¶éœ€è¦ä¸€ä¸ªå˜é‡æ¥è¡¨ç¤ºå³è¾¹ä¹˜ç§¯ // ä½†æ˜¯ä¸éœ€è¦æ•°ç»„ï¼Œå› ä¸ºä»å³è¾¹å¼€å§‹ç®—ï¼Œç®—å®Œä¸€ä¸ªå°±å¯ä»¥æ¸…é™¤å®ƒ int right = 1; for(int j = nums.length - 1;j &gt;= 0;j--)&#123; res[j] = res[j] * right; right = right * nums[j]; &#125; return res; &#125;&#125; 239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼é¢˜ç›®ç»™å®šä¸€ä¸ªæ•°ç»„ numsï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º k çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ k ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚ è¿”å›æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ã€‚ ç¤ºä¾‹: 123456789101112è¾“å…¥: nums = [1,3,-1,-3,5,3,6,7], å’Œ k = 3è¾“å‡º: [3,3,5,5,6,7] è§£é‡Š: æ»‘åŠ¨çª—å£çš„ä½ç½® æœ€å¤§å€¼--------------- -----[1 3 -1] -3 5 3 6 7 3 1 [3 -1 -3] 5 3 6 7 3 1 3 [-1 -3 5] 3 6 7 5 1 3 -1 [-3 5 3] 6 7 5 1 3 -1 -3 [5 3 6] 7 6 1 3 -1 -3 5 [3 6 7] 7 æç¤ºï¼š 1ä½ å¯ä»¥å‡è®¾ k æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œåœ¨è¾“å…¥æ•°ç»„ä¸ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œ1 â‰¤ k â‰¤ è¾“å…¥æ•°ç»„çš„å¤§å°ã€‚ è¿›é˜¶ï¼š 1ä½ èƒ½åœ¨çº¿æ€§æ—¶é—´å¤æ‚åº¦å†…è§£å†³æ­¤é¢˜å—ï¼Ÿ æ€è·¯ æš´åŠ›æ³• åŒç«¯é˜Ÿåˆ—æ³•ã€‚éå†æ•°ç»„ï¼Œå°†æ•°å­˜æ”¾åœ¨åŒå‘é˜Ÿåˆ—ä¸­ï¼Œå¹¶ç”¨L,Ræ¥æ ‡è®°çª—å£çš„å·¦è¾¹ç•Œå’Œå³è¾¹ç•Œã€‚é˜Ÿåˆ—ä¸­ä¿å­˜çš„å¹¶ä¸æ˜¯çœŸçš„æ•°ï¼Œè€Œæ˜¯è¯¥æ•°å€¼å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ä½ç½®ï¼Œå¹¶ä¸”æ•°ç»„ä¸­çš„æ•°è¦ä»å¤§åˆ°å°æ’åºã€‚å¦‚æœå½“å‰éå†çš„æ•°æ¯”é˜Ÿå°¾çš„å€¼å¤§ï¼Œåˆ™éœ€è¦å¼¹å‡ºé˜Ÿå°¾å€¼ï¼Œç›´åˆ°é˜Ÿåˆ—é‡æ–°æ»¡è¶³ä»å¤§åˆ°å°çš„è¦æ±‚ã€‚åˆšå¼€å§‹éå†æ—¶ï¼ŒLå’ŒRéƒ½ä¸º0ï¼Œæœ‰ä¸€ä¸ªå½¢æˆçª—å£çš„è¿‡ç¨‹ï¼Œæ­¤è¿‡ç¨‹æ²¡æœ‰æœ€å¤§å€¼ï¼ŒLä¸åŠ¨ï¼ŒRå‘å³ç§»ã€‚å½“çª—å£å¤§å°å½¢æˆæ—¶ï¼ŒLå’ŒRä¸€èµ·å‘å³ç§»ï¼Œæ¯æ¬¡ç§»åŠ¨æ—¶ï¼Œåˆ¤æ–­é˜Ÿé¦–çš„å€¼çš„æ•°ç»„ä¸‹æ ‡æ˜¯å¦åœ¨[L,R]ä¸­ï¼Œå¦‚æœä¸åœ¨åˆ™éœ€è¦å¼¹å‡ºé˜Ÿé¦–çš„å€¼ï¼Œå½“å‰çª—å£çš„æœ€å¤§å€¼å³ä¸ºé˜Ÿé¦–çš„æ•°ã€‚ ã€æœ‰ç‚¹éš¾ï¼Œé€‚å½“è®°å¿†æ­¥éª¤ã€‘ ä½œè€…ï¼šhanyuhuangé“¾æ¥ï¼šhttps://leetcode-cn.com/problems/sliding-window-maximum/solution/shuang-xiang-dui-lie-jie-jue-hua-dong-chuang-kou-2/æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ dpã€‚è¿™ä¸ªå°±æ›´éªšäº†â€¦è§å®˜æ–¹é¢˜è§£æ–¹æ³•ä¸‰ ä»£ç  æš´åŠ›æ³• 1234567891011121314class Solution &#123; public int[] maxSlidingWindow(int[] nums, int k) &#123; if(nums.length == 0) return new int[]&#123;&#125;; int[] res = new int[nums.length+1-k]; for(int i = 0;i &lt;= nums.length-k;i++)&#123; int max = Integer.MIN_VALUE; for(int j = 0;j &lt; k;j++)&#123; max = Math.max(max,nums[i+j]); &#125; res[i] = max; &#125; return res; &#125;&#125; åŒç«¯é˜Ÿåˆ—æ³• 123456789101112131415161718192021222324252627class Solution &#123; public int[] maxSlidingWindow(int[] nums, int k) &#123; if(nums == null || nums.length &lt; 2) return nums; // åŒå‘é˜Ÿåˆ— ä¿å­˜å½“å‰çª—å£æœ€å¤§å€¼çš„æ•°ç»„ä½ç½® ä¿è¯é˜Ÿåˆ—ä¸­æ•°ç»„ä½ç½®çš„æ•°å€¼æŒ‰ä»å¤§åˆ°å°æ’åº LinkedList&lt;Integer&gt; queue = new LinkedList(); // ç»“æœæ•°ç»„ int[] result = new int[nums.length-k+1]; // éå†numsæ•°ç»„ for(int i = 0;i &lt; nums.length;i++)&#123; // ä¿è¯ä»å¤§åˆ°å° å¦‚æœå‰é¢æ•°å°åˆ™éœ€è¦ä¾æ¬¡å¼¹å‡ºï¼Œç›´è‡³æ»¡è¶³è¦æ±‚ while(!queue.isEmpty() &amp;&amp; nums[queue.peekLast()] &lt;= nums[i])&#123; queue.pollLast(); &#125; // æ·»åŠ å½“å‰å€¼å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ queue.addLast(i); // åˆ¤æ–­å½“å‰é˜Ÿåˆ—ä¸­é˜Ÿé¦–çš„å€¼æ˜¯å¦æœ‰æ•ˆ if(queue.peek() &lt;= i-k)&#123; queue.poll(); &#125; // å½“çª—å£é•¿åº¦ä¸ºkæ—¶ ä¿å­˜å½“å‰çª—å£ä¸­æœ€å¤§å€¼ if(i+1 &gt;= k)&#123; result[i+1-k] = nums[queue.peek()]; &#125; &#125; return result; &#125;&#125; dp 12345678910111213141516171819202122232425262728class Solution &#123; public int[] maxSlidingWindow(int[] nums, int k) &#123; int n = nums.length; if (n * k == 0) return new int[0]; if (k == 1) return nums; int [] left = new int[n]; left[0] = nums[0]; int [] right = new int[n]; right[n - 1] = nums[n - 1]; for (int i = 1; i &lt; n; i++) &#123; // from left to right if (i % k == 0) left[i] = nums[i]; // block_start else left[i] = Math.max(left[i - 1], nums[i]); // from right to left int j = n - i - 1; if ((j + 1) % k == 0) right[j] = nums[j]; // block_end else right[j] = Math.max(right[j + 1], nums[j]); &#125; int [] output = new int[n - k + 1]; for (int i = 0; i &lt; n - k + 1; i++) output[i] = Math.max(left[i + k - 1], right[i]); return output; &#125;&#125; 240. æœç´¢äºŒç»´çŸ©é˜µ IIé¢˜ç›®ç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥æœç´¢ m x n çŸ©é˜µ matrix ä¸­çš„ä¸€ä¸ªç›®æ ‡å€¼ targetã€‚è¯¥çŸ©é˜µå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š æ¯è¡Œçš„å…ƒç´ ä»å·¦åˆ°å³å‡åºæ’åˆ—ã€‚ æ¯åˆ—çš„å…ƒç´ ä»ä¸Šåˆ°ä¸‹å‡åºæ’åˆ—ã€‚ ç¤ºä¾‹: ç°æœ‰çŸ©é˜µ matrix å¦‚ä¸‹ï¼š 1234567[ [1, 4, 7, 11, 15], [2, 5, 8, 12, 19], [3, 6, 9, 16, 22], [10, 13, 14, 17, 24], [18, 21, 23, 26, 30]] ç»™å®š target = 5ï¼Œè¿”å› trueã€‚ ç»™å®š target = 20ï¼Œè¿”å› falseã€‚ æ€è·¯æš´åŠ›æ³•ç›´æ¥å…ˆè¡Œååˆ—éå†ï¼Œéå†åˆ°äº† target é€€å‡ºã€‚ äºŒåˆ†æŸ¥æ‰¾æ³•ä»¥å¯¹è§’çº¿ä¸ºç•Œé™ï¼Œå¯¹è§’çº¿ä¹‹ä¸Šçš„è¿›è¡Œ è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¯¹è§’çº¿ä¹‹ä¸‹çš„è¿›è¡Œ åˆ—äºŒåˆ†æŸ¥æ‰¾ã€‚ å‡æ²»æ³•å…¶å®å°±æ˜¯é€‰å®šä¸€ä¸ªç‰¹æ®Šçš„å‡ºå‘ç‚¹ã€‚ é€‰å·¦ä¸Šè§’ï¼Œå¾€å³èµ°å’Œå¾€ä¸‹èµ°éƒ½å¢å¤§ï¼Œä¸èƒ½é€‰ é€‰å³ä¸‹è§’ï¼Œå¾€ä¸Šèµ°å’Œå¾€å·¦èµ°éƒ½å‡å°ï¼Œä¸èƒ½é€‰ é€‰å·¦ä¸‹è§’ï¼Œå¾€å³èµ°å¢å¤§ï¼Œå¾€ä¸Šèµ°å‡å°ï¼Œå¯é€‰ é€‰å³ä¸Šè§’ï¼Œå¾€ä¸‹èµ°å¢å¤§ï¼Œå¾€å·¦èµ°å‡å°ï¼Œå¯é€‰ è¿™é‡Œæˆ‘ä»¬é€‰å®šå·¦ä¸‹è§’å…ƒç´ ï¼ï¼å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š * è®¾çŸ©é˜µå·¦ä¸‹è§’å…ƒç´  matrix\[i][j] ï¼Œå®ƒæ˜¯ç¬¬ i è¡Œæœ€å°å€¼ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ç¬¬ j åˆ—æœ€å¤§å€¼ è‹¥ target &lt; matrix[i][j] (å°äºç¬¬ i è¡Œæœ€å°å€¼)ï¼Œåˆ™æ’é™¤ç¬¬ i è¡Œï¼Œä»¤ iâ€“ è‹¥ target &gt; matrix[i][j] (å¤§äºç¬¬ j åˆ—æœ€å¤§å€¼)ï¼Œåˆ™æ’é™¤ç¬¬ j åˆ—ï¼Œä»¤ j++ å¾ªç¯ 2~3 ç›´åˆ°æ‰¾åˆ° targetï¼Œæˆ–æ‰€æœ‰è¡Œåˆ—å‡è¢«æ’é™¤ ä»£ç  æš´åŠ›æ³• 123456789101112class Solution &#123; public boolean searchMatrix(int[][] matrix, int target) &#123; for (int i = 0; i &lt; matrix.length; i++) &#123; for (int j = 0; j &lt; matrix[0].length; j++) &#123; if (matrix[i][j] == target) &#123; return true; &#125; &#125; &#125; return false; &#125;&#125; äºŒåˆ† 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748class Solution &#123; private boolean binarySearch(int[][] matrix, int target, int start, boolean vertical) &#123; int lo = start; int hi = vertical ? matrix[0].length-1 : matrix.length-1; while (hi &gt;= lo) &#123; int mid = (lo + hi)/2; if (vertical) &#123; // searching a column if (matrix[start][mid] &lt; target) &#123; lo = mid + 1; &#125; else if (matrix[start][mid] &gt; target) &#123; hi = mid - 1; &#125; else &#123; return true; &#125; &#125; else &#123; // searching a row if (matrix[mid][start] &lt; target) &#123; lo = mid + 1; &#125; else if (matrix[mid][start] &gt; target) &#123; hi = mid - 1; &#125; else &#123; return true; &#125; &#125; &#125; return false; &#125; public boolean searchMatrix(int[][] matrix, int target) &#123; // an empty matrix obviously does not contain `target` if (matrix == null || matrix.length == 0) &#123; return false; &#125; // iterate over matrix diagonals int shorterDim = Math.min(matrix.length, matrix[0].length); for (int i = 0; i &lt; shorterDim; i++) &#123; boolean verticalFound = binarySearch(matrix, target, i, true); boolean horizontalFound = binarySearch(matrix, target, i, false); if (verticalFound || horizontalFound) &#123; return true; &#125; &#125; return false; &#125;&#125; å‡æ²»æ³• 12345678910111213141516171819class Solution &#123; public boolean searchMatrix(int[][] matrix, int target) &#123; // start our "pointer" in the bottom-left int row = matrix.length-1; int col = 0; while (row &gt;= 0 &amp;&amp; col &lt; matrix[0].length) &#123; if (matrix[row][col] &gt; target) &#123; row--; &#125; else if (matrix[row][col] &lt; target) &#123; col++; &#125; else &#123; // found it return true; &#125; &#125; return false; &#125;&#125; 279. å®Œå…¨å¹³æ–¹æ•°é¢˜ç›®ç»™å®šæ­£æ•´æ•° nï¼Œæ‰¾åˆ°è‹¥å¹²ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼ˆæ¯”å¦‚ 1, 4, 9, 16, ...ï¼‰ä½¿å¾—å®ƒä»¬çš„å’Œç­‰äº nã€‚ä½ éœ€è¦è®©ç»„æˆå’Œçš„å®Œå…¨å¹³æ–¹æ•°çš„ä¸ªæ•°æœ€å°‘ã€‚ ç¤ºä¾‹ 1: 123è¾“å…¥: n = 12è¾“å‡º: 3 è§£é‡Š: 12 = 4 + 4 + 4. ç¤ºä¾‹ 2: 123è¾“å…¥: n = 13è¾“å‡º: 2è§£é‡Š: 13 = 4 + 9. æ€è·¯dp ä»£ç 123456789101112class Solution &#123; public int numSquares(int n) &#123; int[] dp = new int[n + 1]; // é»˜è®¤åˆå§‹åŒ–å€¼éƒ½ä¸º0 for (int i = 1; i &lt;= n; i++) &#123; dp[i] = i; // æœ€åçš„æƒ…å†µå°±æ˜¯æ¯æ¬¡+1 for (int j = 1; i - j * j &gt;= 0; j++) &#123; dp[i] = Math.min(dp[i], dp[i - j * j] + 1); // åŠ¨æ€è½¬ç§»æ–¹ç¨‹ &#125; &#125; return dp[n]; &#125;&#125; 283. ç§»åŠ¨é›¶é¢˜ç›®ç»™å®šä¸€ä¸ªæ•°ç»„ numsï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ 0 ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚ ç¤ºä¾‹: 12è¾“å…¥: [0,1,0,3,12]è¾“å‡º: [1,3,12,0,0] è¯´æ˜: å¿…é¡»åœ¨åŸæ•°ç»„ä¸Šæ“ä½œï¼Œä¸èƒ½æ‹·è´é¢å¤–çš„æ•°ç»„ã€‚ å°½é‡å‡å°‘æ“ä½œæ¬¡æ•°ã€‚ æ€è·¯å…ˆå¤åˆ¶åè¡¥0 ä»£ç 1234567891011121314151617class Solution &#123; public void moveZeroes(int[] nums) &#123; int index = 0; for(int i = 0;i &lt; nums.length;i++)&#123; if(nums[i] != 0)&#123; // å…ˆå¤åˆ¶ nums[index] = nums[i]; index++; &#125; &#125; // è¡¥0 while(index &lt; nums.length)&#123; nums[index] = 0; index++; &#125; &#125;&#125; 287. å¯»æ‰¾é‡å¤æ•°é¢˜ç›®ç»™å®šä¸€ä¸ªåŒ…å« n + 1 ä¸ªæ•´æ•°çš„æ•°ç»„ numsï¼Œå…¶æ•°å­—éƒ½åœ¨ 1 åˆ° n ä¹‹é—´ï¼ˆåŒ…æ‹¬ 1 å’Œ nï¼‰ï¼Œå¯çŸ¥è‡³å°‘å­˜åœ¨ä¸€ä¸ªé‡å¤çš„æ•´æ•°ã€‚å‡è®¾åªæœ‰ä¸€ä¸ªé‡å¤çš„æ•´æ•°ï¼Œæ‰¾å‡ºè¿™ä¸ªé‡å¤çš„æ•°ã€‚ ç¤ºä¾‹ 1: 12è¾“å…¥: [1,3,4,2,2]è¾“å‡º: 2 ç¤ºä¾‹ 2: 12è¾“å…¥: [3,1,3,4,2]è¾“å‡º: 3 è¯´æ˜ï¼š ä¸èƒ½æ›´æ”¹åŸæ•°ç»„ï¼ˆå‡è®¾æ•°ç»„æ˜¯åªè¯»çš„ï¼‰ã€‚ åªèƒ½ä½¿ç”¨é¢å¤–çš„ O(1) çš„ç©ºé—´ã€‚ æ—¶é—´å¤æ‚åº¦å°äº O(n2) ã€‚ æ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªé‡å¤çš„æ•°å­—ï¼Œä½†å®ƒå¯èƒ½ä¸æ­¢é‡å¤å‡ºç°ä¸€æ¬¡ã€‚ æ€è·¯ æ’åºåï¼Œç›¸é‚»å…ƒç´ å¦‚æœç›¸ç­‰ï¼Œåˆ™ return ç”¨ set å­˜å‚¨ï¼Œä¸€æ—¦å‘ç° key å·²ç»å­˜åœ¨ï¼Œç›´æ¥è¿”å›ï¼Œå¦åˆ™å­˜å…¥ map ä¸­ å…¶å®è¿™æ˜¯ä¸€ä¸ªé“¾è¡¨ä¸­éå¸¸å¸¸è§çš„é—®é¢˜ï¼Œå°±æ˜¯å¯»æ‰¾ç¯çš„å…¥å£é—®é¢˜ï¼Œn ä¸ªä¸åŒçš„æ•°ï¼Œç›¸åŒçš„é‚£ä¸ªæ•°å…¶å®å°±æ˜¯å½¢æˆä¸€ä¸ªç¯ã€‚å³å…ƒç´ ç´¢å¼•ä¸‹æ ‡ä¸ºèŠ‚ç‚¹ nodeï¼Œè€Œ node çš„ next æŒ‡é’ˆåˆ™æ˜¯ å…ƒç´ å€¼ æ‰€å¯¹åº”çš„ç´¢å¼•ä¸‹æ ‡å€¼ã€‚ Tip: ä¾‹å¦‚[2,1,2,3,4]ï¼Œè¿™ä¸ªæ˜¯ç¬¦åˆé¢˜ç›®è¦æ±‚ä¸”ç¬¦åˆè‡ªå¾ªç¯çš„æƒ…å†µï¼Œåœ¨nums[2]å¤„ï¼Œç´¢å¼•å€¼å’Œå…ƒç´ å€¼ç›¸ç­‰ï¼Œåœ¨è¿™é‡Œçš„ç¡®ï¼Œå¿«æ…¢æŒ‡é’ˆä¼šåœ¨2çš„ä½ç½®ä¸åœæŒ‡å‘è‡ªå·±ï¼Œä½†æ˜¯åªè¦å‘ç”Ÿè¿™ç§è‡ªå¾ªç¯çš„æƒ…å†µï¼Œé‚£ä¹ˆé‡å¤çš„æ•°å­—å°±æ˜¯è¿™ä¸ªï¼Œæˆ‘ä»¬ä¾æ—§å¯ä»¥ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆçš„æ–¹æ³•å»åšï¼Œå› ä¸ºæˆ‘ä»¬çš„åšæ³•å°±æ˜¯å…ˆæ±‚ä¸€æ¬¡ç›¸é‡ï¼Œç„¶åæ…¢æŒ‡é’ˆå›åˆ°åŸç‚¹ï¼Œç¬¬äºŒæ¬¡ç›¸é‡å°±æ˜¯ç¯çš„èµ·ç‚¹ï¼Œåœ¨è¿™é‡Œï¼Œæ—¢ç„¶æ˜¯è‡ªå¾ªç¯çš„ï¼Œé‚£ä¹ˆå½“ç„¶æœ€åç¬¬äºŒæ¬¡ç›¸é‡è¿˜æ˜¯åœ¨è¿™é‡Œï¼Œç­”æ¡ˆæ˜¯ä¸€æ ·çš„ã€‚ äºŒåˆ†æ³• ä»£ç  æ’åº 1234567891011class Solution &#123; public int findDuplicate(int[] nums) &#123; Arrays.sort(nums); for (int i = 1; i &lt; nums.length; i++) &#123; if (nums[i] == nums[i-1]) &#123; return nums[i]; &#125; &#125; return -1; &#125;&#125; Set å­˜å‚¨ 123456789101112class Solution &#123; public int findDuplicate(int[] nums) &#123; Set&lt;Integer&gt; seen = new HashSet&lt;Integer&gt;(); for (int num : nums) &#123; if (seen.contains(num)) &#123; return num; &#125; seen.add(num); &#125; return -1; &#125;&#125; å¿«æ…¢æŒ‡é’ˆ 12345678910111213141516171819class Solution &#123; public int findDuplicate(int[] nums) &#123; // Find the intersection point of the two runners. int slow = nums[0]; int fast = nums[0]; do &#123; slow = nums[slow]; fast = nums[nums[fast]]; &#125; while (slow != fast); // Find the "entrance" to the cycle. slow = nums[0]; while (fast != slow) &#123; fast = nums[fast]; slow = nums[slow]; &#125; return fast; &#125;&#125; äºŒåˆ† 1234567891011121314151617181920212223class Solution &#123; public int findDuplicate(int[] nums) &#123; int left = 0; int right = nums.length - 1; while(left &lt;= right)&#123; int mid = left + (right - left)/2; int count = 0; int mid_count = 0; for(int i = 0;i &lt; nums.length;i++)&#123; if(nums[i] &lt;= mid) count++; if(nums[i] == mid) mid_count++; &#125; // å¦‚æœ [left,mid] æ²¡æœ‰å‡ºç°é‡å¤æ•°å­—ï¼Œcount &lt;= mid // å¦åˆ™è¯´æ˜åœ¨è¿™ä¸ªåŒºé—´å‡ºç°äº†é‡å¤çš„ // è¿™é‡Œè·Ÿå¸¸è§çš„ äºŒåˆ†æœ‰ä¸€ç‚¹ç‚¹ä¸åŒï¼Œè¿™é‡Œ right = midï¼Œä¸æ˜¯ right = mid - 1 // å› ä¸ºæˆ‘åœ¨ä¸Šé¢è®¡ç®— count çš„æ—¶å€™ æ˜¯æœ‰è®¡ç®— mid çš„ if(mid_count &gt; 1) return mid; if(count &gt; mid) right = mid - 1; else left = mid + 1; &#125; return -1; &#125;&#125; 301. åˆ é™¤æ— æ•ˆçš„æ‹¬å·ï¼ˆæš‚æ—¶æœªåšå“ˆ~ å…ˆæŠŠä»£ç è´´ä¸€ä¸‹ ç¬¬äºŒéå†™ï¼‰ é¢˜ç›®åˆ é™¤æœ€å°æ•°é‡çš„æ— æ•ˆæ‹¬å·ï¼Œä½¿å¾—è¾“å…¥çš„å­—ç¬¦ä¸²æœ‰æ•ˆï¼Œè¿”å›æ‰€æœ‰å¯èƒ½çš„ç»“æœã€‚ è¯´æ˜: è¾“å…¥å¯èƒ½åŒ…å«äº†é™¤ ( å’Œ ) ä»¥å¤–çš„å­—ç¬¦ã€‚ ç¤ºä¾‹ 1: 12è¾“å…¥: "()())()"è¾“å‡º: ["()()()", "(())()"] ç¤ºä¾‹ 2: 12è¾“å…¥: "(a)())()"è¾“å‡º: ["(a)()()", "(a())()"] ç¤ºä¾‹ 3: 12è¾“å…¥: ")("è¾“å‡º: [""] æ€è·¯ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788class Solution &#123; public List&lt;String&gt; removeInvalidParentheses(String s) &#123; // ç»Ÿè®¡éœ€è¦åˆ é™¤çš„å·¦æ‹¬å·å’Œå³æ‹¬å·æ•°é‡ int left = 0, right = 0; for (int i = 0; i &lt; s.length(); i++) &#123; char c = s.charAt(i); if (c == '(') &#123; left++; &#125; else if (c == ')') &#123; if (left &gt; 0) left--; else right++; &#125; &#125; // å¼€å§‹åˆ é™¤ List&lt;String&gt; res = new ArrayList&lt;&gt;(); List&lt;String&gt; array = new ArrayList&lt;&gt;(); Set&lt;String&gt; set = new HashSet&lt;&gt;(); array.add(s); // å…ˆåˆ å·¦æ‹¬å· while (left-- &gt; 0) &#123; List&lt;String&gt; tempArray = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; array.size(); i++) &#123; String ss = array.get(i); for (int j = 0; j &lt; ss.length(); j++) &#123; if (ss.charAt(j) == '(') &#123; String sss = ss.substring(0, j) + ss.substring(j + 1); if (!set.contains(sss)) &#123; set.add(sss); tempArray.add(sss); &#125; &#125; &#125; &#125; array = tempArray; &#125; // åˆ å³æ‹¬å· while (right-- &gt; 0) &#123; List&lt;String&gt; tempArray = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; array.size(); i++) &#123; String ss = array.get(i); for (int j = 0; j &lt; ss.length(); j++) &#123; if (ss.charAt(j) == ')') &#123; String sss = ss.substring(0, j) + ss.substring(j + 1); if (!set.contains(sss)) &#123; set.add(sss); tempArray.add(sss); &#125; &#125; &#125; &#125; array = tempArray; &#125; // å¯¹åˆ é™¤åå­—ç¬¦ä¸²è¿›è¡ŒéªŒè¯ for (int i = 0; i &lt; array.size(); i++) &#123; String str = array.get(i); if (this.checkVaild(str)) &#123; res.add(str); &#125; &#125; return res; &#125; private boolean checkVaild(String s) &#123; Stack&lt;Character&gt; stack = new Stack&lt;&gt;(); for (int i = 0; i &lt; s.length(); i++) &#123; char c = s.charAt(i); if (c == '(' ) &#123; stack.push(c); &#125; else if (c == ')') &#123; if (stack.empty() || stack.peek() == ')') &#123; stack.push(c); &#125; else &#123; stack.pop(); &#125; &#125; &#125; if (stack.empty()) return true; return false; &#125;&#125; 312. æˆ³æ°”çƒã€è·Ÿä¸Šé¢ä¸€æ ·ï¼Œè¿™ä¸¤é¢˜æ²¡åšå‘¢ï¼ã€‘ é¢˜ç›®æœ‰ n ä¸ªæ°”çƒï¼Œç¼–å·ä¸º0 åˆ° n-1ï¼Œæ¯ä¸ªæ°”çƒä¸Šéƒ½æ ‡æœ‰ä¸€ä¸ªæ•°å­—ï¼Œè¿™äº›æ•°å­—å­˜åœ¨æ•°ç»„ nums ä¸­ã€‚ ç°åœ¨è¦æ±‚ä½ æˆ³ç ´æ‰€æœ‰çš„æ°”çƒã€‚æ¯å½“ä½ æˆ³ç ´ä¸€ä¸ªæ°”çƒ i æ—¶ï¼Œä½ å¯ä»¥è·å¾— nums[left] * nums[i] * nums[right] ä¸ªç¡¬å¸ã€‚ è¿™é‡Œçš„ left å’Œ right ä»£è¡¨å’Œ i ç›¸é‚»çš„ä¸¤ä¸ªæ°”çƒçš„åºå·ã€‚æ³¨æ„å½“ä½ æˆ³ç ´äº†æ°”çƒ i åï¼Œæ°”çƒ left å’Œæ°”çƒ right å°±å˜æˆäº†ç›¸é‚»çš„æ°”çƒ æ€è·¯è¶…è¯¦ç»†å›æº¯åˆ°dp ä»£ç 123456789101112131415161718192021222324252627282930313233343536class Solution &#123; public static int maxCoins(int[] nums) &#123; //é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ if (nums == null) &#123; return 0; &#125; //åˆ›å»ºè™šæ‹Ÿè¾¹ç•Œ int length = nums.length; int[] nums2 = new int[length + 2]; System.arraycopy(nums, 0, nums2, 1, length); nums2[0] = 1; nums2[length + 1] = 1; length = nums2.length; //åˆ›å»ºdpè¡¨ length = nums2.length; int[][] dp = new int[length][length]; //å¼€å§‹dpï¼šiä¸ºbeginï¼Œjä¸ºendï¼Œkä¸ºåœ¨iã€jåŒºé—´åˆ’åˆ†å­é—®é¢˜æ—¶çš„è¾¹ç•Œ for (int i = length - 2; i &gt; -1; i--) &#123; for (int j = i + 2; j &lt; length; j++) &#123; //ç»´æŠ¤ä¸€ä¸ªæœ€å¤§å€¼ï¼›å¦‚æœiã€jç›¸é‚»ï¼Œå€¼ä¸º0 int max = 0; for (int k = i + 1; k &lt; j; k++) &#123; int temp = dp[i][k] + dp[k][j] + nums2[i] * nums2[k] * nums2[j]; if (temp &gt; max) &#123; max = temp; &#125; &#125; dp[i][j] = max; &#125; &#125; return dp[0][length-1]; &#125;&#125; 338. æ¯”ç‰¹ä½è®¡æ•°é¢˜ç›®ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•° numã€‚å¯¹äº 0 â‰¤ i â‰¤ num èŒƒå›´ä¸­çš„æ¯ä¸ªæ•°å­— i ï¼Œè®¡ç®—å…¶äºŒè¿›åˆ¶æ•°ä¸­çš„ 1 çš„æ•°ç›®å¹¶å°†å®ƒä»¬ä½œä¸ºæ•°ç»„è¿”å›ã€‚ ç¤ºä¾‹ 1: 12è¾“å…¥: 2è¾“å‡º: [0,1,1] ç¤ºä¾‹ 2: 12è¾“å…¥: 5è¾“å‡º: [0,1,1,2,1,2] è¿›é˜¶: ç»™å‡ºæ—¶é—´å¤æ‚åº¦ä¸ºO(n*sizeof(integer))çš„è§£ç­”éå¸¸å®¹æ˜“ã€‚ä½†ä½ å¯ä»¥åœ¨çº¿æ€§æ—¶é—´O(n)å†…ç”¨ä¸€è¶Ÿæ‰«æåšåˆ°å—ï¼Ÿ è¦æ±‚ç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ä¸ºO(n)ã€‚ ä½ èƒ½è¿›ä¸€æ­¥å®Œå–„è§£æ³•å—ï¼Ÿè¦æ±‚åœ¨C++æˆ–ä»»ä½•å…¶ä»–è¯­è¨€ä¸­ä¸ä½¿ç”¨ä»»ä½•å†…ç½®å‡½æ•°æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚ æ€è·¯ ä» 191. ä½1çš„ä¸ªæ•° ä¸­å¯å‘è€Œæ¥ï¼Œn &amp;ï¼ˆn-1ï¼‰è¿™ç§ç§€çš„ä¸€æ‰¹çš„æ“ä½œ å¯¹ä¸Šè¿°æ–¹æ³•æœ‰ä¸€ä¸ªæ”¹è¿›ç‰ˆï¼ŒåŠ¨æ€è§„åˆ’ç‰ˆæœ¬çš„ ä»£ç  Case I 123456789101112131415161718class Solution &#123; public int[] countBits(int num) &#123; int[] res = new int[num+1]; for(int i = 0;i &lt;= num;i++)&#123; res[i] = hammingWeight(i); &#125; return res; &#125; public int hammingWeight(int n) &#123; int sum = 0; while(n != 0)&#123; sum++; n = n &amp; (n-1); &#125; return sum; &#125;&#125; Case II 123456789class Solution &#123; public int[] countBits(int num) &#123; int[] dp = new int[num+1]; for(int i = 1;i &lt;= num;i++)&#123; dp[i] = dp[i&amp;(i-1)] + 1; &#125; return dp; &#125;&#125; 347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ é¢˜ç›®ç»™å®šä¸€ä¸ªéç©ºçš„æ•´æ•°æ•°ç»„ï¼Œè¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰ k é«˜çš„å…ƒç´ ã€‚ ç¤ºä¾‹ 1: 12è¾“å…¥: nums = [1,1,1,2,2,3], k = 2è¾“å‡º: [1,2] ç¤ºä¾‹ 2: 12è¾“å…¥: nums = [1], k = 1è¾“å‡º: [1] è¯´æ˜ï¼š ä½ å¯ä»¥å‡è®¾ç»™å®šçš„ k æ€»æ˜¯åˆç†çš„ï¼Œä¸” 1 â‰¤ k â‰¤ æ•°ç»„ä¸­ä¸ç›¸åŒçš„å…ƒç´ çš„ä¸ªæ•°ã€‚ ä½ çš„ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å¿…é¡»ä¼˜äº O(n log n) , n æ˜¯æ•°ç»„çš„å¤§å°ã€‚ æ€è·¯ å€ŸåŠ© 2020-02-02 å‘¨èµ›çš„ä¸€é“é¢˜çš„æ€è·¯ï¼Œå°†å…¶å­˜å…¥ mapï¼Œç„¶åç”¨ list å­˜å‚¨ mapï¼Œç„¶ååˆ©ç”¨é›†åˆçš„æ’åºæ–¹æ³•ï¼Œå¯¹å…¶è¿›è¡Œæ’åºï¼Œå†è½¬æˆ mapï¼Œç„¶åç”¨ iterator éå†å³å¯ã€‚ æ€è·¯åŸºæœ¬ä¸€è‡´ï¼Œä½†æ˜¯å…¶å®è¿™é‡Œæ’åºä¹‹åæ ¹æœ¬ç”¨ä¸åˆ° value äº†ï¼Œæ‰€ä»¥æ ¹æœ¬æ²¡å¿…è¦å†è½¬æˆ mapï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨ list å»å­˜å‚¨ entry å¯¹è±¡ï¼Œç›´æ¥ç”¨ PriorityQueue å»å¯¹ value æ’åºï¼Œç„¶åå­˜å‚¨ key å€¼å°±å¯ä»¥äº†ï¼Œå› ä¸º PriorityQueue æ˜¯æœ€å°å †å®ç°çš„ï¼Œæ—¶é—´å¤æ‚åº¦åªæœ‰ O(nlogn) è¿™ä¸ªæ–¹æ³•ä¸ç”¨æ’åºï¼Œç”¨ map å­˜å‚¨å®Œä¹‹åï¼Œç›´æ¥æ”¾åˆ°æ¡¶ä¸­ï¼ˆvalueå€¼ä½œä¸ºæ¡¶çš„åºå·ï¼‰ï¼Œå­˜å…¥ keyã€‚ ä»£ç  Case I 12345678910111213141516171819202122232425262728293031323334class Solution &#123; public List&lt;Integer&gt; topKFrequent(int[] nums, int k) &#123; Map&lt;Integer, Integer&gt; map = new HashMap&lt;Integer, Integer&gt;(); for (int i = 0; i &lt; nums.length; i++) &#123; if (map.get(nums[i]) != null) &#123; map.put(nums[i], map.get(nums[i]) + 1); &#125; else &#123; map.put(nums[i], 1); &#125; &#125; List&lt;Map.Entry&lt;Integer, Integer&gt;&gt; list = new ArrayList(map.entrySet()); // æŒ‰ value æ’åºï¼Œé™åºæ’åº Collections.sort(list, (o1, o2) -&gt; &#123; int compare = (o1.getValue()).compareTo(o2.getValue()); return -compare; &#125;); Map&lt;Integer, Integer&gt; returnMap = new LinkedHashMap&lt;Integer, Integer&gt;(); for (Map.Entry&lt;Integer, Integer&gt; entry : list) &#123; returnMap.put(entry.getKey(), entry.getValue()); &#125; int i = 0; List&lt;Integer&gt; res = new ArrayList(); for(Map.Entry&lt;Integer, Integer&gt; entry:returnMap.entrySet())&#123; if(i == k)&#123; break; &#125; else &#123; res.add(entry.getKey()); i++; &#125; &#125; return res; &#125;&#125; Case II 12345678910111213141516171819202122232425262728class Solution &#123; public List&lt;Integer&gt; topKFrequent(int[] nums, int k) &#123; // build hash map : character and how often it appears HashMap&lt;Integer, Integer&gt; count = new HashMap(); for (int n: nums) &#123; count.put(n, count.getOrDefault(n, 0) + 1); &#125; // init heap 'the less frequent element first' PriorityQueue&lt;Integer&gt; heap = new PriorityQueue&lt;Integer&gt;((n1, n2) -&gt; count.get(n1) - count.get(n2)); // keep k top frequent elements in the heap for (int n: count.keySet()) &#123; heap.add(n); if (heap.size() &gt; k) // æ˜¯ å † å®ç°çš„ï¼Œç„¶åä¸Šè¿°æ„é€ çš„æ˜¯å‡åºæ’åˆ—ï¼Œæœ€å°çš„åœ¨ç¬¬ä¸€ä¸ªï¼Œæœ€å¤§çš„åœ¨æœ€å heap.poll(); &#125; // build output list List&lt;Integer&gt; top_k = new LinkedList(); while (!heap.isEmpty()) top_k.add(heap.poll()); Collections.reverse(top_k); return top_k; &#125;&#125; Case III 12345678910111213141516171819202122232425262728293031323334//åŸºäºæ¡¶æ’åºæ±‚è§£ã€Œå‰ K ä¸ªé«˜é¢‘å…ƒç´ ã€class Solution &#123; public List&lt;Integer&gt; topKFrequent(int[] nums, int k) &#123; List&lt;Integer&gt; res = new ArrayList(); // ä½¿ç”¨å­—å…¸ï¼Œç»Ÿè®¡æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå…ƒç´ ä¸ºé”®ï¼Œå…ƒç´ å‡ºç°çš„æ¬¡æ•°ä¸ºå€¼ HashMap&lt;Integer,Integer&gt; map = new HashMap(); for(int num : nums)&#123; if (map.containsKey(num)) &#123; map.put(num, map.get(num) + 1); &#125; else &#123; map.put(num, 1); &#125; &#125; //æ¡¶æ’åº //å°†é¢‘ç‡ä½œä¸ºæ•°ç»„ä¸‹æ ‡ï¼Œå¯¹äºå‡ºç°é¢‘ç‡ä¸åŒçš„æ•°å­—é›†åˆï¼Œå­˜å…¥å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ List&lt;Integer&gt;[] list = new List[nums.length+1]; for(int key : map.keySet())&#123; // è·å–å‡ºç°çš„æ¬¡æ•°ä½œä¸ºä¸‹æ ‡ int i = map.get(key); if(list[i] == null)&#123; list[i] = new ArrayList(); &#125; list[i].add(key); &#125; // å€’åºéå†æ•°ç»„è·å–å‡ºç°é¡ºåºä»å¤§åˆ°å°çš„æ’åˆ— for(int i = list.length - 1;i &gt;= 0 &amp;&amp; res.size() &lt; k;i--)&#123; if(list[i] == null) continue; res.addAll(list[i]); &#125; return res; &#125;&#125; 394. å­—ç¬¦ä¸²è§£ç é¢˜ç›®ç»™å®šä¸€ä¸ªç»è¿‡ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè¿”å›å®ƒè§£ç åçš„å­—ç¬¦ä¸²ã€‚ ç¼–ç è§„åˆ™ä¸º: k[encoded_string]ï¼Œè¡¨ç¤ºå…¶ä¸­æ–¹æ‹¬å·å†…éƒ¨çš„ encoded_string æ­£å¥½é‡å¤ k æ¬¡ã€‚æ³¨æ„ k ä¿è¯ä¸ºæ­£æ•´æ•°ã€‚ ä½ å¯ä»¥è®¤ä¸ºè¾“å…¥å­—ç¬¦ä¸²æ€»æ˜¯æœ‰æ•ˆçš„ï¼›è¾“å…¥å­—ç¬¦ä¸²ä¸­æ²¡æœ‰é¢å¤–çš„ç©ºæ ¼ï¼Œä¸”è¾“å…¥çš„æ–¹æ‹¬å·æ€»æ˜¯ç¬¦åˆæ ¼å¼è¦æ±‚çš„ã€‚ æ­¤å¤–ï¼Œä½ å¯ä»¥è®¤ä¸ºåŸå§‹æ•°æ®ä¸åŒ…å«æ•°å­—ï¼Œæ‰€æœ‰çš„æ•°å­—åªè¡¨ç¤ºé‡å¤çš„æ¬¡æ•° k ï¼Œä¾‹å¦‚ä¸ä¼šå‡ºç°åƒ 3a æˆ– 2[4] çš„è¾“å…¥ã€‚ ç¤ºä¾‹: 123s = "3[a]2[bc]", è¿”å› "aaabcbc".s = "3[a2[c]]", è¿”å› "accaccacc".s = "2[abc]3[cd]ef", è¿”å› "abcabccdcdcdef". æ€è·¯ æ ˆ é€’å½’ ä»£ç  æ ˆ 12345678910111213141516171819202122232425262728293031public String decodeString(String s) &#123; StringBuilder res = new StringBuilder(); int multi = 0; // å­˜å‚¨æ•°å­— Stack&lt;Integer&gt; stack_multi = new Stack&lt;&gt;(); // å­˜å‚¨å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯åœ¨'[' ä¹‹å‰çš„ï¼Œè¿™ä¸ªéœ€è¦å‹æ ˆï¼Œç„¶åæ‹¼æ¥çš„ // ä¸€ç±»æ˜¯åœ¨']'ä¹‹å‰çš„ï¼Œè¿™ç±»æ˜¯ç”¨æ¥åœ¨æ‹¬å·å†…éƒ¨ä¹˜ä»¥å€æ•°çš„ Stack&lt;String&gt; stack_res = new Stack&lt;&gt;(); for(Character c : s.toCharArray()) &#123; if(c == '[') &#123; // å°†å€æ•°å‹æ ˆ stack_multi.push(multi); // å°†å·¦æ‹¬å·ä¹‹å‰çš„å­—ç¬¦ä¸²å‹æ ˆï¼Œæ–¹ä¾¿åç»­æ‹¼æ¥ stack_res.push(res.toString()); multi = 0; // æ¸…ç©ºçš„åŸå› æ˜¯å› ä¸ºè¦ä¾¿äºä¸‹ä¸€æ¬¡å·¦æ‹¬å·ä¹‹å‰çš„å­—æ¯çš„ä¿å­˜ res = new StringBuilder(); &#125; else if(c == ']') &#123; // ç”¨æ¥ æ‹¼æ¥å­—ç¬¦ä¸² StringBuilder tmp = new StringBuilder(); int cur_multi = stack_multi.pop(); for(int i = 0; i &lt; cur_multi; i++) tmp.append(res); res = new StringBuilder(stack_res.pop() + tmp); &#125; // è®°å¾—å¤„ç† multi å¯èƒ½æ˜¯å¤šä½æ•°çš„æƒ…å†µï¼ï¼ï¼ else if(c &gt;= '0' &amp;&amp; c &lt;= '9') multi = multi * 10 + Integer.parseInt(c + ""); else res.append(c); &#125; return res.toString();&#125; é€’å½’ 12345678910111213141516171819202122232425262728293031323334class Solution &#123; public String decodeString(String s) &#123; return dfs(s, 0)[0]; &#125; /** * é€’å½’ä¸‰éƒ¨æ›² * 1ã€é€’å½’å‡ºå£ï¼Œå½“éå†å®Œäº†æœ€åä¸€ä¸ªå­—ç¬¦ï¼Œé€’å½’ç»“æŸ * 2ã€é€’å½’è¿”å›å€¼ï¼Œè¿”å›æ‹¬å·å†…çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ä¸ºäº†æ–¹ä¾¿åœ¨ä¸€è½®é€’å½’ä¸­è¿›è¡Œæ‹¼æ¥ï¼Œä¹Ÿå°†å³æ‹¬å·çš„ç´¢å¼•è¿”å› * 3ã€ä¸€è½®é€’å½’åšçš„äº‹æƒ…ï¼Œå°±æ˜¯å°†è¿”å›çš„å­—ç¬¦ä¸²è¿›è¡Œæ‰©å±•ï¼Œç„¶åæ‹¼æ¥å‰è€…å’Œåè€…çš„å­—ç¬¦ä¸² * @param s * @param i * @return */ private String[] dfs(String s, int i) &#123; StringBuilder res = new StringBuilder(); int multi = 0; while (i &lt; s.length()) &#123; if (s.charAt(i) &gt;= '0' &amp;&amp; s.charAt(i) &lt;= '9') multi = multi * 10 + Integer.parseInt(String.valueOf(s.charAt(i))); else if (s.charAt(i) == '[') &#123; String[] tmp = dfs(s, i + 1); i = Integer.parseInt(tmp[0]); while (multi &gt; 0) &#123; res.append(tmp[1]); multi--; &#125; &#125; else if (s.charAt(i) == ']') return new String[]&#123;String.valueOf(i), res.toString()&#125;; else res.append(s.charAt(i)); i++; &#125; return new String[]&#123;res.toString()&#125;; &#125;&#125; 448. æ‰¾åˆ°æ‰€æœ‰æ•°ç»„ä¸­æ¶ˆå¤±çš„æ•°å­—é¢˜ç›®ç»™å®šä¸€ä¸ªèŒƒå›´åœ¨ 1 â‰¤ a[i] â‰¤ n ( n = æ•°ç»„å¤§å° ) çš„ æ•´å‹æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ ä¸€äº›å‡ºç°äº†ä¸¤æ¬¡ï¼Œå¦ä¸€äº›åªå‡ºç°ä¸€æ¬¡ã€‚ æ‰¾åˆ°æ‰€æœ‰åœ¨ [1, n] èŒƒå›´ä¹‹é—´æ²¡æœ‰å‡ºç°åœ¨æ•°ç»„ä¸­çš„æ•°å­—ã€‚ æ‚¨èƒ½åœ¨ä¸ä½¿ç”¨é¢å¤–ç©ºé—´ä¸”æ—¶é—´å¤æ‚åº¦ä¸ºO(n)çš„æƒ…å†µä¸‹å®Œæˆè¿™ä¸ªä»»åŠ¡å—? ä½ å¯ä»¥å‡å®šè¿”å›çš„æ•°ç»„ä¸ç®—åœ¨é¢å¤–ç©ºé—´å†…ã€‚ ç¤ºä¾‹: 12345è¾“å…¥:[4,3,2,7,8,2,3,1]è¾“å‡º:[5,6] æ€è·¯ https://leetcode-cn.com/problems/find-all-numbers-disappeared-in-an-array/solution/ti-jie-bu-shi-yong-e-wai-kong-jian-by-gehui1007/ å°±æ˜¯ç”¨æ­£è´Ÿå·å»ç»´æŠ¤ä¸€ä¸ªç®€æ˜“çš„ mapï¼Œæ ‡è®°æ˜¯å¦å‡ºç°è¯¥æ•°ã€‚é¢˜ç›®é™åˆ¶æ˜¯æ•°æ˜¯åœ¨ 1 ~ n ä¹‹é—´çš„ï¼Œè€Œä¸€å…±æœ‰ n ä¸ªæ•°ï¼Œæˆ‘ä»¬è¿™ä¹ˆæƒ³ï¼Œç”¨æ•°ç»„å…ƒç´ çš„å€¼ä»£è¡¨ æ•°ç»„ä¸­å‡ºç°çš„æ•°çš„ç´¢å¼•ï¼Œæ¯”å¦‚è¯´[4,3,2,7,8,2,3,1]ï¼Œç¬¬ä¸€ä¸ªæ•°æ˜¯ 4ï¼Œå°±ä»£è¡¨äº†ç¬¬ 4ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯ 7ï¼Œå°†å…¶æ ‡å¿—ä½ -1ï¼Œä»¥æ­¤ç±»æ¨ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ•°ç»„å˜ä¸º [-4,-3,-2,-7,8,2,-3,-1]ï¼Œæ•…å†éå†ä¸€éï¼Œä¸ºæ­£æ•°çš„å³æœªå‡ºç°çš„æ•°å­—ã€‚ ç”¨è¿™ç§æ€è·¯è¿˜å¯ä»¥è§£å†³ 442. æ•°ç»„ä¸­é‡å¤çš„æ•°æ® ï¼Œæ€è·¯ä¸€æ¨¡ä¸€æ ·ï¼Œå½“éå†æ—¶å‘ç°å…ƒç´ ï¼ˆä»£è¡¨æ•°ç»„ä¸‹æ ‡ï¼‰æ‰€æŒ‡å‘çš„æ•°æ˜¯è´Ÿæ•°ï¼Œè¯´æ˜é‚£ä¸ªæ•°å·²ç»å‡ºç°äº†ä¸€æ¬¡ï¼Œæ­¤æ—¶æ­¤æ•°å°±å‡ºç°äº†ä¸¤æ¬¡ï¼Œè®°å½•ä¸‹æ¥å³å¯ã€‚ ä»£ç 1234567891011121314class Solution &#123; public List&lt;Integer&gt; findDisappearedNumbers(int[] nums) &#123; List&lt;Integer&gt; res = new ArrayList(); for(int num:nums)&#123; num = Math.abs(num); if(nums[num-1] &lt; 0) continue; else nums[num-1] = -nums[num-1]; &#125; for(int i =0;i &lt; nums.length;i++)&#123; if(nums[i] &gt; 0) res.add(i+1); &#125; return res; &#125;&#125; 442é¢˜ä»£ç  123456789public List&lt;Integer&gt; findDuplicates(int[] nums) &#123; List&lt;Integer&gt; res = new ArrayList(); for(int num:nums)&#123; num = Math.abs(num); if(nums[num-1] &lt; 0) res.add(num); else nums[num-1] = -nums[num-1]; &#125; return res;&#125; 399. é™¤æ³•æ±‚å€¼ã€å›¾è®ºçŸ¥è¯†ï¼Œæš‚æ—¶ä¸å¤ªä¼šï¼Œä» leetcodeè‹±æ–‡ç‰ˆçš„ é«˜åˆ†åŒº æºœäº†å‡ ä¸ªé«˜èµç­”æ¡ˆè¿‡æ¥ï¼Œä»¥åæ¬£èµä¸€ä¸‹ã€‘ é¢˜ç›®ç»™å‡ºæ–¹ç¨‹å¼ A / B = k, å…¶ä¸­ A å’Œ B å‡ä¸ºä»£è¡¨å­—ç¬¦ä¸²çš„å˜é‡ï¼Œ k æ˜¯ä¸€ä¸ªæµ®ç‚¹å‹æ•°å­—ã€‚æ ¹æ®å·²çŸ¥æ–¹ç¨‹å¼æ±‚è§£é—®é¢˜ï¼Œå¹¶è¿”å›è®¡ç®—ç»“æœã€‚å¦‚æœç»“æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› -1.0ã€‚ ç¤ºä¾‹ : 123ç»™å®š a / b = 2.0, b / c = 3.0é—®é¢˜: a / c = ?, b / a = ?, a / e = ?, a / a = ?, x / x = ? è¿”å› [6.0, 0.5, -1.0, 1.0, -1.0 ] 123ç»™å®š a / b = 2.0, b / c = 3.0é—®é¢˜: a / c = ?, b / a = ?, a / e = ?, a / a = ?, x / x = ? è¿”å› [6.0, 0.5, -1.0, 1.0, -1.0 ] æ€è·¯ dfs å¹¶æŸ¥é›† ä»£ç  dfs ç¬¬ä¸€ä¸ªç‰ˆæœ¬ 1234567891011121314151617181920212223242526272829303132333435363738394041424344class Solution &#123; public double[] calcEquation(List&lt;List&lt;String&gt;&gt; equations, double[] values, List&lt;List&lt;String&gt;&gt; queries) &#123; List&lt;String[]&gt; arr = new ArrayList&lt;&gt;(); for(List&lt;String&gt; a:equations)&#123; List&lt;String&gt; tmp; tmp = a; arr.add(tmp.toArray(new String[0])); &#125; String[][] eq = arr.toArray(new String[0][0]); List&lt;String[]&gt; arr1 = new ArrayList&lt;&gt;(); for(List&lt;String&gt; a:queries)&#123; List&lt;String&gt; tmp; tmp = a; arr1.add(tmp.toArray(new String[0])); &#125; String[][] q = arr1.toArray(new String[0][0]); return calcEquation_dfs(eq,values,q); &#125; public double[] calcEquation_dfs(String[][] eq, double[] vals, String[][] q) &#123; Map&lt;String, Map&lt;String, Double&gt;&gt; m = new HashMap&lt;&gt;(); for (int i = 0; i &lt; vals.length; i++) &#123; m.putIfAbsent(eq[i][0], new HashMap&lt;&gt;()); m.putIfAbsent(eq[i][1], new HashMap&lt;&gt;()); m.get(eq[i][0]).put(eq[i][1], vals[i]); m.get(eq[i][1]).put(eq[i][0], 1 / vals[i]); &#125; double[] r = new double[q.length]; for (int i = 0; i &lt; q.length; i++) r[i] = dfs(q[i][0], q[i][1], 1, m, new HashSet&lt;&gt;()); return r; &#125; double dfs(String s, String t, double r, Map&lt;String, Map&lt;String, Double&gt;&gt; m, Set&lt;String&gt; seen) &#123; if (!m.containsKey(s) || !seen.add(s)) return -1; if (s.equals(t)) return r; Map&lt;String, Double&gt; next = m.get(s); for (String c : next.keySet()) &#123; double result = dfs(c, t, r * next.get(c), m, seen); if (result != -1) return result; &#125; return -1; &#125;&#125; dfs ç¬¬äºŒä¸ªç‰ˆæœ¬ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859class Solution &#123; public double[] calcEquation(List&lt;List&lt;String&gt;&gt; equations, double[] values, List&lt;List&lt;String&gt;&gt; queries) &#123; List&lt;String[]&gt; arr = new ArrayList&lt;&gt;(); for(List&lt;String&gt; a:equations)&#123; List&lt;String&gt; tmp; tmp = a; arr.add(tmp.toArray(new String[0])); &#125; String[][] eq = arr.toArray(new String[0][0]); List&lt;String[]&gt; arr1 = new ArrayList&lt;&gt;(); for(List&lt;String&gt; a:queries)&#123; List&lt;String&gt; tmp; tmp = a; arr1.add(tmp.toArray(new String[0])); &#125; String[][] q = arr1.toArray(new String[0][0]); return calcEquation_dfs(eq,values,q); &#125; HashSet&lt;String&gt; seen = new HashSet&lt;&gt;(); HashMap&lt;String, String&gt; root = new HashMap&lt;&gt;(); HashMap&lt;String, Double&gt; vals = new HashMap&lt;&gt;(); HashMap&lt;String, HashMap&lt;String, Double&gt;&gt; edges = new HashMap&lt;&gt;(); public double[] calcEquation_dfs(String[][] equations, double[] values, String[][] queries) &#123; int n = equations.length, m = queries.length; for (int i = 0; i &lt; n; ++i) &#123; String x = equations[i][0], y = equations[i][1]; if (!edges.containsKey(x)) edges.put(x, new HashMap&lt;String, Double&gt;()); if (!edges.containsKey(y) ) edges.put(y, new HashMap&lt;String, Double&gt;()); edges.get(x).put(y, values[i]); edges.get(y).put(x, 1 / values[i]); &#125; for (String x : edges.keySet()) &#123; if (!seen.contains(x)) dfs(x, x, 1); &#125; double[] res = new double[m]; for (int i = 0; i &lt; m; ++i) &#123; String x = queries[i][0], y = queries[i][1]; String px = root.getOrDefault(x, x), py = root.getOrDefault(y, y); if (px != py) res[i] = -1.0; else res[i] = vals.get(x) / vals.get(y); &#125; return res; &#125; public void dfs(String x, String p, double v) &#123; vals.put(x, v); root.put(x, p); seen.add(x); for (String y : edges.get(x).keySet()) &#123; if (!seen.contains(y)) dfs(y, p, v * edges.get(y).get(x)); &#125; &#125;&#125; Dfs ç¬¬ä¸‰ä¸ªç‰ˆæœ¬ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970class Solution &#123; public double[] calcEquation(List&lt;List&lt;String&gt;&gt; equations, double[] values, List&lt;List&lt;String&gt;&gt; queries) &#123; List&lt;String[]&gt; arr = new ArrayList&lt;&gt;(); for(List&lt;String&gt; a:equations)&#123; List&lt;String&gt; tmp; tmp = a; arr.add(tmp.toArray(new String[0])); &#125; String[][] eq = arr.toArray(new String[0][0]); List&lt;String[]&gt; arr1 = new ArrayList&lt;&gt;(); for(List&lt;String&gt; a:queries)&#123; List&lt;String&gt; tmp; tmp = a; arr1.add(tmp.toArray(new String[0])); &#125; String[][] q = arr1.toArray(new String[0][0]); return calcEquation_dfs(eq,values,q); &#125; public double[] calcEquation_dfs(String[][] equations, double[] values, String[][] queries) &#123; /* Build graph. */ Map&lt;String, Map&lt;String, Double&gt;&gt; graph = buildGraph(equations, values); double[] result = new double[queries.length]; for (int i = 0; i &lt; queries.length; i++) &#123; result[i] = getPathWeight(queries[i][0], queries[i][1], new HashSet&lt;&gt;(), graph); &#125; return result; &#125; private double getPathWeight(String start, String end, Set&lt;String&gt; visited, Map&lt;String, Map&lt;String, Double&gt;&gt; graph) &#123; /* Rejection case. */ if (!graph.containsKey(start)) return -1.0; /* Accepting case. */ if (graph.get(start).containsKey(end)) return graph.get(start).get(end); visited.add(start); for (Map.Entry&lt;String, Double&gt; neighbour : graph.get(start).entrySet()) &#123; if (!visited.contains(neighbour.getKey())) &#123; double productWeight = getPathWeight(neighbour.getKey(), end, visited, graph); if (productWeight != -1.0) return neighbour.getValue() * productWeight; &#125; &#125; return -1.0; &#125; private Map&lt;String, Map&lt;String, Double&gt;&gt; buildGraph(String[][] equations, double[] values) &#123; Map&lt;String, Map&lt;String, Double&gt;&gt; graph = new HashMap&lt;&gt;(); String u, v; for (int i = 0; i &lt; equations.length; i++) &#123; u = equations[i][0]; v = equations[i][1]; graph.putIfAbsent(u, new HashMap&lt;&gt;()); graph.get(u).put(v, values[i]); graph.putIfAbsent(v, new HashMap&lt;&gt;()); graph.get(v).put(u, 1 / values[i]); &#125; return graph; &#125;&#125; å¹¶æŸ¥é›† I 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677class Solution &#123; public double[] calcEquation(List&lt;List&lt;String&gt;&gt; equations, double[] values, List&lt;List&lt;String&gt;&gt; queries) &#123; List&lt;String[]&gt; arr = new ArrayList&lt;&gt;(); for(List&lt;String&gt; a:equations)&#123; List&lt;String&gt; tmp; tmp = a; arr.add(tmp.toArray(new String[0])); &#125; String[][] eq = arr.toArray(new String[0][0]); List&lt;String[]&gt; arr1 = new ArrayList&lt;&gt;(); for(List&lt;String&gt; a:queries)&#123; List&lt;String&gt; tmp; tmp = a; arr1.add(tmp.toArray(new String[0])); &#125; String[][] q = arr1.toArray(new String[0][0]); return calcEquation_union(eq,values,q); &#125; /** 1. Thoughts - check if we have enough info to get the result - if yes, calculate; if not, return -1.0 - Method: union find - a/b = 2.0 --&gt; b is the root of a; the distance from a to b is 1/2.0 - if two nums have the same root, we can get the result; a/b=2.0, b/c=3.0 index a b c root b c c dist 2 3 1 - if we want to know a/c = ?: a = 2 * b = 2 * 3 * c =&gt; a/c = 6.0 2. Corner case - if any input is null, return null - no enough info, return -1.0 3. Steps - go through equations to union elements with the same root and update root map and distance map - go through each query: check if has the same root; find relative dist*/ public double[] calcEquation_union(String[][] e, double[] values, String[][] q) &#123; double[] res = new double[q.length]; Map&lt;String, String&gt; root = new HashMap&lt;&gt;(); Map&lt;String, Double&gt; dist = new HashMap&lt;&gt;(); for (int i = 0; i &lt; e.length; i++) &#123; String r1 = find(root, dist, e[i][0]); String r2 = find(root, dist, e[i][1]); root.put(r1, r2); dist.put(r1, dist.get(e[i][1]) * values[i] / dist.get(e[i][0])); &#125; for (int i = 0; i &lt; q.length; i++) &#123; if (!root.containsKey(q[i][0]) || !root.containsKey(q[i][1])) &#123; res[i] = -1.0; continue; &#125; String r1 = find(root, dist, q[i][0]); String r2 = find(root, dist, q[i][1]); if (!r1.equals(r2)) &#123; res[i] = -1.0; continue; &#125; res[i] = (double) dist.get(q[i][0]) / dist.get(q[i][1]); &#125; return res; &#125; private String find(Map&lt;String, String&gt; root, Map&lt;String, Double&gt; dist, String s) &#123; if (!root.containsKey(s)) &#123; root.put(s, s); dist.put(s, 1.0); return s; &#125; if (root.get(s).equals(s)) return s; String lastP = root.get(s); String p = find(root, dist, lastP); root.put(s, p); dist.put(s, dist.get(s) * dist.get(lastP)); return p; &#125;&#125; å¹¶æŸ¥é›† â€”â€”&gt; å¤§ä½¬çš„å¹¶æŸ¥é›†å’ŒDFS 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556class Solution &#123; public double[] calcEquation(List&lt;List&lt;String&gt;&gt; equations, double[] values, List&lt;List&lt;String&gt;&gt; queries) &#123; List&lt;String[]&gt; arr = new ArrayList&lt;&gt;(); for(List&lt;String&gt; a:equations)&#123; List&lt;String&gt; tmp; tmp = a; arr.add(tmp.toArray(new String[0])); &#125; String[][] eq = arr.toArray(new String[0][0]); List&lt;String[]&gt; arr1 = new ArrayList&lt;&gt;(); for(List&lt;String&gt; a:queries)&#123; List&lt;String&gt; tmp; tmp = a; arr1.add(tmp.toArray(new String[0])); &#125; String[][] q = arr1.toArray(new String[0][0]); return calcEquation_union(eq,values,q); &#125; Map&lt;String, String&gt;parents = new HashMap&lt;&gt;(); Map&lt;String, Double&gt;vals = new HashMap&lt;&gt;(); public double[] calcEquation_union(String[][] equs, double[] values, String[][] queries) &#123; double[] res = new double[queries.length]; for (int i = 0; i &lt; values.length ; ++i ) union(equs[i][0], equs[i][1], values[i]); for (int i = 0; i &lt; queries.length; ++i) &#123; String x = queries[i][0], y = queries[i][1]; res[i] = (parents.containsKey(x) &amp;&amp; parents.containsKey(y) &amp;&amp; find(x) == find(y)) ? vals.get(x) / vals.get(y) : -1.0; &#125; return res; &#125; public void add(String x) &#123; if (parents.containsKey(x)) return; parents.put(x, x); vals.put(x, 1.0); &#125; public String find(String x) &#123; String p = parents.getOrDefault(x, x); if (x != p) &#123; String pp = find(p); vals.put(x, vals.get(x) * vals.get(p)); parents.put(x, pp); &#125; return parents.getOrDefault(x, x); &#125; public void union(String x, String y, double v) &#123; add(x); add(y); String px = find(x), py = find(y); parents.put(px, py); vals.put(px, v * vals.get(y) / vals.get(x)); &#125;&#125; 406. æ ¹æ®èº«é«˜é‡å»ºé˜Ÿåˆ—é¢˜ç›®å‡è®¾æœ‰æ‰“ä¹±é¡ºåºçš„ä¸€ç¾¤äººç«™æˆä¸€ä¸ªé˜Ÿåˆ—ã€‚ æ¯ä¸ªäººç”±ä¸€ä¸ªæ•´æ•°å¯¹(h, k)è¡¨ç¤ºï¼Œå…¶ä¸­hæ˜¯è¿™ä¸ªäººçš„èº«é«˜ï¼Œkæ˜¯æ’åœ¨è¿™ä¸ªäººå‰é¢ä¸”èº«é«˜å¤§äºæˆ–ç­‰äºhçš„äººæ•°ã€‚ ç¼–å†™ä¸€ä¸ªç®—æ³•æ¥é‡å»ºè¿™ä¸ªé˜Ÿåˆ—ã€‚ ç¤ºä¾‹ 12345è¾“å…¥:[[7,0], [4,4], [7,1], [5,0], [6,1], [5,2]]è¾“å‡º:[[5,0], [7,0], [5,2], [6,1], [4,4], [7,1]] æ€è·¯å®˜æ–¹é¢˜è§£è®²çš„ä¸é”™ï¼Œé«˜ä¸ªå­çš„çœ¼ä¸­ï¼ŒçŸ®ä¸ªå­ç›¸å½“äºä¸å­˜åœ¨ï¼Œæ‰€ä»¥é«˜ä¸ªå­å…ˆæŒ‰è§„çŸ©ç«™å¥½ï¼Œåé¢çŸ®ä¸ªå­çš„æ’å…¥ä¸ä¼šå½±å“å…¶é¡ºåºï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæŠŠé«˜ä¸ªå­å®‰æ’å®Œï¼ŒçŸ®ä¸ªå­å¯ä»¥ç›´æ¥æŒ‰ k å€¼ä»å°åˆ°å¤§æ’å…¥ï¼Œk å€¼å³ä»–ä»¬å½“æ—¶æ’å…¥çš„ä¸‹æ ‡å€¼ã€‚ ä»£ç 12345678910111213class Solution &#123; public int[][] reconstructQueue(int[][] people) &#123; // å‰é¢èº«é«˜åº”è¯¥é™åºï¼Œåé¢çš„kåº”è¯¥å‡åºæ’åˆ— Arrays.sort(people, (o1, o2) -&gt; o1[0] == o2[0] ? o1[1] - o2[1] : o2[0] - o1[0]); ArrayList&lt;int[]&gt; res = new ArrayList(); for(int[] p:people)&#123; // é«˜ä¸ªå­æ— è§†çŸ®ä¸ªå­ï¼Œæ‰€ä»¥çŸ®ä¸ªå­çš„æ’å…¥å¯¹ä¹‹å‰æ’å…¥çš„é«˜ä¸ªå­æ²¡æœ‰å½±å“ // æ•…çŸ®ä¸ªå­å¯ä»¥ç›´æ¥æŒ‰ k å½“æˆåºå·æ’å…¥ res.add(p[1],p); &#125; return res.toArray(new int[0][0]); &#125;&#125; 416. åˆ†å‰²ç­‰å’Œå­é›†é¢˜ç›®ç»™å®šä¸€ä¸ªåªåŒ…å«æ­£æ•´æ•°çš„éç©ºæ•°ç»„ã€‚æ˜¯å¦å¯ä»¥å°†è¿™ä¸ªæ•°ç»„åˆ†å‰²æˆä¸¤ä¸ªå­é›†ï¼Œä½¿å¾—ä¸¤ä¸ªå­é›†çš„å…ƒç´ å’Œç›¸ç­‰ã€‚ æ³¨æ„: æ¯ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ä¸ä¼šè¶…è¿‡ 100 æ•°ç»„çš„å¤§å°ä¸ä¼šè¶…è¿‡ 200 ç¤ºä¾‹ 1: 12345è¾“å…¥: [1, 5, 11, 5]è¾“å‡º: trueè§£é‡Š: æ•°ç»„å¯ä»¥åˆ†å‰²æˆ [1, 5, 5] å’Œ [11]. ç¤ºä¾‹ 2: 12345è¾“å…¥: [1, 2, 3, 5]è¾“å‡º: falseè§£é‡Š: æ•°ç»„ä¸èƒ½åˆ†å‰²æˆä¸¤ä¸ªå…ƒç´ å’Œç›¸ç­‰çš„å­é›†. æ€è·¯è§ liweiå¤§ä½¬æ€è·¯ï¼Œè¿™ä¸ªä¼˜åŒ–çš„å¥—è·¯ï¼Œå€¼å¾—å­¦ä¹ ã€‚ https://leetcode-cn.com/problems/partition-equal-subset-sum/solution/0-1-bei-bao-wen-ti-xiang-jie-zhen-dui-ben-ti-de-yo/ ä»£ç 1234567891011121314151617181920212223242526272829public class Solution &#123; public boolean canPartition(int[] nums) &#123; int len = nums.length; int sum = 0; for (int num : nums) &#123; sum += num; &#125; if ((sum &amp; 1) == 1) &#123; return false; &#125; int target = sum / 2; boolean[] dp = new boolean[target + 1]; dp[0] = true; if (nums[0] &lt;= target) &#123; dp[nums[0]] = true; &#125; for (int i = 1; i &lt;= len; i++) &#123; for (int j = target; j &gt;= nums[i]; j--) &#123; if (dp[target]) &#123; return true; &#125; dp[j] = dp[j] || dp[j - nums[i]]; &#125; &#125; return dp[target]; &#125;&#125; 438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯é¢˜ç›®ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªéç©ºå­—ç¬¦ä¸² pï¼Œæ‰¾åˆ° s ä¸­æ‰€æœ‰æ˜¯ p çš„å­—æ¯å¼‚ä½è¯çš„å­ä¸²ï¼Œè¿”å›è¿™äº›å­ä¸²çš„èµ·å§‹ç´¢å¼•ã€‚ å­—ç¬¦ä¸²åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ï¼Œå¹¶ä¸”å­—ç¬¦ä¸² s å’Œ p çš„é•¿åº¦éƒ½ä¸è¶…è¿‡ 20100 ç¤ºä¾‹ 1: 123456789è¾“å…¥:s: "cbaebabacd" p: "abc"è¾“å‡º:[0, 6]è§£é‡Š:èµ·å§‹ç´¢å¼•ç­‰äº 0 çš„å­ä¸²æ˜¯ "cba", å®ƒæ˜¯ "abc" çš„å­—æ¯å¼‚ä½è¯ã€‚èµ·å§‹ç´¢å¼•ç­‰äº 6 çš„å­ä¸²æ˜¯ "bac", å®ƒæ˜¯ "abc" çš„å­—æ¯å¼‚ä½è¯ã€‚ ç¤ºä¾‹ 2: 12345678910è¾“å…¥:s: "abab" p: "ab"è¾“å‡º:[0, 1, 2]è§£é‡Š:èµ·å§‹ç´¢å¼•ç­‰äº 0 çš„å­ä¸²æ˜¯ "ab", å®ƒæ˜¯ "ab" çš„å­—æ¯å¼‚ä½è¯ã€‚èµ·å§‹ç´¢å¼•ç­‰äº 1 çš„å­ä¸²æ˜¯ "ba", å®ƒæ˜¯ "ab" çš„å­—æ¯å¼‚ä½è¯ã€‚èµ·å§‹ç´¢å¼•ç­‰äº 2 çš„å­ä¸²æ˜¯ "ab", å®ƒæ˜¯ "ab" çš„å­—æ¯å¼‚ä½è¯ã€‚ æ€è·¯æ»‘åŠ¨çª—å£ç®—æ³•ï¼Œè§ å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼šæ»‘åŠ¨çª—å£æŠ€å·§æ€»ç»“ï¼ˆå‡è£…æœ‰é“¾æ¥ï¼‰ ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940class Solution &#123; public List&lt;Integer&gt; findAnagrams(String s, String p) &#123; // ç”¨äºè¿”å›å­—æ¯å¼‚ä½è¯çš„èµ·å§‹ç´¢å¼• List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); // ç”¨ map å­˜å‚¨ç›®æ ‡å€¼ä¸­å„ä¸ªå•è¯å‡ºç°çš„æ¬¡æ•° HashMap&lt;Character, Integer&gt; map = new HashMap&lt;&gt;(); for (Character c : p.toCharArray()) map.put(c, map.getOrDefault(c, 0)+1); // ç”¨å¦å¤–ä¸€ä¸ª map å­˜å‚¨æ»‘åŠ¨çª—å£ä¸­æœ‰æ•ˆå­—ç¬¦å‡ºç°çš„æ¬¡æ•° HashMap&lt;Character, Integer&gt; window = new HashMap&lt;&gt;(); int left = 0; // å·¦æŒ‡é’ˆ int right = 0; // å³æŒ‡é’ˆ int valid = p.length(); // åªæœ‰å½“ valid == 0 æ—¶ï¼Œæ‰è¯´æ˜ window ä¸­åŒ…å«äº†ç›®æ ‡å­ä¸² while (right &lt; s.length()) &#123; // å¦‚æœç›®æ ‡å­ä¸²ä¸­åŒ…å«äº†è¯¥å­—ç¬¦ï¼Œæ‰å­˜å…¥ window ä¸­ if (map.containsKey(s.charAt(right))) &#123; window.put(s.charAt(right), window.getOrDefault(s.charAt(right), 0)+1); // åªæœ‰å½“ window ä¸­è¯¥æœ‰æ•ˆå­—ç¬¦æ•°é‡ä¸å¤§äºmapä¸­è¯¥å­—ç¬¦æ•°é‡ï¼Œæ‰èƒ½ç®—ä¸€æ¬¡æœ‰æ•ˆåŒ…å« if (window.get(s.charAt(right)) &lt;= map.get(s.charAt(right))) &#123; valid--; &#125; &#125; // å¦‚æœ window ç¬¦åˆè¦æ±‚ï¼Œå³ä¸¤ä¸ª map å­˜å‚¨çš„æœ‰æ•ˆå­—ç¬¦ç›¸åŒï¼Œå°±å¯ä»¥ç§»åŠ¨å·¦æŒ‡é’ˆäº† // ä½†æ˜¯åªæœ‰äºŒä¸ªmapå­˜å‚¨çš„æ•°æ®å®Œå…¨ç›¸åŒï¼Œæ‰å¯ä»¥è®°å½•å½“å‰çš„èµ·å§‹ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯leftæŒ‡é’ˆæ‰€åœ¨ä½ç½® while (valid == 0) &#123; if (right - left + 1 == p.length()) res.add(left); // å¦‚æœå·¦æŒ‡é’ˆæŒ‡çš„æ˜¯æœ‰æ•ˆå­—ç¬¦,éœ€è¦æ›´æ”¹ window ä¸­çš„ key å¯¹åº”çš„ value // å¦‚æœ æœ‰æ•ˆå­—ç¬¦å¯¹åº”çš„æ•°é‡æ¯”ç›®æ ‡å­ä¸²å°‘ï¼Œè¯´æ˜æ— æ³•åŒ¹é…äº† if (map.containsKey(s.charAt(left))) &#123; window.put(s.charAt(left), window.get(s.charAt(left))-1); if (window.get(s.charAt(left)) &lt; map.get(s.charAt(left))) &#123; valid++; &#125; &#125; left++; &#125; right++; &#125; return res; &#125;&#125; ç”¨æ•°ç»„ä»£æ›¿ map 123456789101112131415161718192021222324252627282930313233343536class Solution &#123; public List&lt;Integer&gt; findAnagrams(String s, String p) &#123; if(s == null || s.length() == 0) return new ArrayList&lt;&gt;(); List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); int[] needs = new int[26]; //ç”±äºéƒ½æ˜¯å°å†™å­—æ¯ï¼Œå› æ­¤ç›´æ¥ç”¨26ä¸ªé•¿åº¦çš„æ•°ç»„ä»£æ›¿åŸæ¥çš„HashMap int[] window = new int[26]; int left = 0, right = 0, total = p.length(); //ç”¨totalæ£€æµ‹çª—å£ä¸­æ˜¯å¦å·²ç»æ¶µç›–äº†pä¸­çš„å­—ç¬¦ for(char ch : p.toCharArray())&#123; needs[ch - 'a'] ++; &#125; while(right &lt; s.length())&#123; char chr = s.charAt(right); if(needs[chr - 'a'] &gt; 0)&#123; window[chr - 'a'] ++; if(window[chr - 'a'] &lt;= needs[chr - 'a'])&#123; total --; &#125; &#125; while(total == 0)&#123; if(right-left+1 == p.length())&#123; res.add(left); &#125; char chl = s.charAt(left); if(needs[chl - 'a'] &gt; 0)&#123; window[chl - 'a'] --; if(window[chl - 'a'] &lt; needs[chl - 'a'])&#123; total ++; &#125; &#125; left ++; &#125; right ++; &#125; return res; &#125;&#125; 494. ç›®æ ‡å’Œé¢˜ç›®ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œa1, a2, â€¦, an, å’Œä¸€ä¸ªç›®æ ‡æ•°ï¼ŒSã€‚ç°åœ¨ä½ æœ‰ä¸¤ä¸ªç¬¦å· + å’Œ -ã€‚å¯¹äºæ•°ç»„ä¸­çš„ä»»æ„ä¸€ä¸ªæ•´æ•°ï¼Œä½ éƒ½å¯ä»¥ä» + æˆ– -ä¸­é€‰æ‹©ä¸€ä¸ªç¬¦å·æ·»åŠ åœ¨å‰é¢ã€‚ è¿”å›å¯ä»¥ä½¿æœ€ç»ˆæ•°ç»„å’Œä¸ºç›®æ ‡æ•° S çš„æ‰€æœ‰æ·»åŠ ç¬¦å·çš„æ–¹æ³•æ•°ã€‚ ç¤ºä¾‹ 1: 1234567891011è¾“å…¥: nums: [1, 1, 1, 1, 1], S: 3è¾“å‡º: 5è§£é‡Š: -1+1+1+1+1 = 3+1-1+1+1+1 = 3+1+1-1+1+1 = 3+1+1+1-1+1 = 3+1+1+1+1-1 = 3ä¸€å…±æœ‰5ç§æ–¹æ³•è®©æœ€ç»ˆç›®æ ‡å’Œä¸º3ã€‚ æ³¨æ„: æ•°ç»„éç©ºï¼Œä¸”é•¿åº¦ä¸ä¼šè¶…è¿‡20ã€‚ åˆå§‹çš„æ•°ç»„çš„å’Œä¸ä¼šè¶…è¿‡1000ã€‚ ä¿è¯è¿”å›çš„æœ€ç»ˆç»“æœèƒ½è¢«32ä½æ•´æ•°å­˜ä¸‹ã€‚ æ€è·¯ æš´åŠ›æ³• ï¼Œè§å®˜æ–¹é¢˜è§£ https://leetcode-cn.com/problems/target-sum/solution/mu-biao-he-by-leetcode/ Dpï¼Œæˆ‘åšçš„æ—¶å€™ç¬¬ä¸€ååº”æ˜¯ç”¨çš„ dpï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸ªå›°éš¾ï¼Œdpä¸èƒ½ç”¨äºŒç»´æ•°ç»„è¡¨ç¤ºï¼Œå› ä¸ºå¯èƒ½è¶Šç•Œï¼Œä¸‹æ ‡ä¸ºè´Ÿæ•°ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ hashmapï¼Œdp[i][j] è½¬åŒ–ä¸º i å½“ keyï¼Œj å½“ valueã€‚ è½¬åŒ–ä¸º 0-1 èƒŒåŒ…é—®é¢˜ã€‚ https://leetcode-cn.com/problems/target-sum/solution/python-dfs-xiang-jie-by-jimmy00745/ https://leetcode-cn.com/problems/target-sum/solution/dong-tai-gui-hua-ji-bai-liao-98de-javayong-hu-by-r/ ä»£ç 123456789101112131415161718public class Solution &#123; public int findTargetSumWays(int[] nums, int S) &#123; int[] dp = new int[2001]; dp[nums[0] + 1000] = 1; dp[-nums[0] + 1000] += 1; for (int i = 1; i &lt; nums.length; i++) &#123; int[] next = new int[2001]; for (int sum = -1000; sum &lt;= 1000; sum++) &#123; if (dp[sum + 1000] &gt; 0) &#123; next[sum + nums[i] + 1000] += dp[sum + 1000]; next[sum - nums[i] + 1000] += dp[sum + 1000]; &#125; &#125; dp = next; &#125; return S &gt; 1000 ? 0 : dp[S + 1000]; &#125;&#125;]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>ç®—æ³•</tag>
        <tag>Leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hexoæäº¤æ–‡ç« å‡ºç°é—®é¢˜]]></title>
    <url>%2F2019%2F10%2F09%2F%E8%A7%A3%E5%86%B3hexo%E6%97%A0%E6%B3%95git%E4%B8%8A%E7%9A%84%E9%97%AE%E9%A2%98.html</url>
    <content type="text"><![CDATA[é—®é¢˜è®°å½•hexoå‘å¸ƒæ–‡ç« æŠ¥é”™è®°å½•ï¼šUnhandled rejection TypeError: Cannot set property â€˜lastIndexâ€™ of undefinedå‘å¸ƒæ–‡ç« æ—¶å‡ºç°é—®é¢˜ï¼ŒåŒæ—¶æŠ¥çš„é”™è¿˜æœ‰ï¼šxcrun: error: invalid active developer path (/Library/Developer/CommandLineTools), missing xcrun at: /Library/Developer/CommandLineTools/usr/bin/xcrun è§£å†³æªæ–½å‘ç°æ˜¯gitå‡ºç°é—®é¢˜ï¼ï¼ï¼ æ§åˆ¶ç«¯è¾“å…¥ï¼š 1brew install git 1xcode-select --install åœ¨xcode-selectæŒ‡ä»¤å®‰è£…å¥½ä¹‹åï¼Œå†å‘½ä»¤æ£€æŸ¥ä¸€ä¸‹gitæŒ‡ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼š 1git -h å¯ä»¥æ­£ç¡®è¾“å‡ºç›¸åº”çš„å¸®åŠ©ä¿¡æ¯ï¼Œæ„å‘³ç€gitå·²ç»è¢«ä¿®å¤å¥½äº†ã€‚ åŸå› æ›´æ–°äº†Catalinaå¯¼è‡´çš„ï¼Œæ–°ç³»ç»Ÿè¾£é¸¡å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å–œå¤§æ™®å¥”]]></title>
    <url>%2F2019%2F10%2F09%2F%E5%96%9C%E5%A4%A7%E6%99%AE%E5%A5%94.html</url>
    <content type="text"><![CDATA[å¼€å¿ƒå“‡ï¼ï¼ï¼ç»ˆäºå†™åˆ°10wå­—äº†ï¼ï¼ï¼ç»§ç»­åŠ æ²¹ï¼ï¼]]></content>
      <categories>
        <category>åæ§½</category>
      </categories>
      <tags>
        <tag>happy </tag>
        <tag>happy day</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Listæºç åˆ†æ]]></title>
    <url>%2F2019%2F10%2F07%2FList%20%26%20Queue%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html</url>
    <content type="text"><![CDATA[ArrayList æºç åˆ†æï¼ˆè½¬è½½ï¼‰ä¸çŸ¥é“å„ä½æœ‹å‹ï¼Œè¿˜è®°å¾—å¼€å·¥å‰åˆ¶å®šçš„å­¦ä¹ ç›®æ ‡ä¹ˆï¼Ÿ æœ‰æ²¡æœ‰ä¸€ç›´ä¸ºäº†é‚£ä¸ªç›®æ ‡åºŸå¯å¿˜é£Ÿå‘¢ï¼Ÿç»§ ææ‡‚ Java å†…éƒ¨ç±» åå¼€å§‹æ¢ç´¢æ€»ç»“ Java é›†åˆæ¡†æ¶æºç çš„çŸ¥è¯†ï¼Œå¸Œæœ›èƒ½ç»™è‡ªå·±å¤¯å®åŸºç¡€ï¼Œä¹Ÿå¸Œæœ›èƒ½ä¸ºè‡ªå·±å®ç°ç›®æ ‡æ›´è¿‘ä¸€æ­¥ã€‚ ArrayList æºç åˆ†ææ€è·¯ArrayList æ˜¯æˆ‘ä»¬ App å¼€å‘ä¸­å¸¸ç”¨çš„ Java é›†åˆç±»ï¼Œä»å­¦ä¹  Java å¼€å§‹æˆ‘ä»¬åŸºæœ¬ä¸Šå°±å¯¹å®ƒå¤©å¤©ç›¸è§äº†ï¼Œä½†æ˜¯é€šè¿‡æ¢ç´¢ArrayList æºç ï¼Œæˆ‘ä»¬å°†ä¼šæŠŠå®ƒä»æ™®é€šæœ‹å‹å˜æˆçŸ¥æ ¹çŸ¥åº•çš„è€æœ‹å‹,æœ¬æ–‡å°†ä»ä»¥ä¸‹å‡ éƒ¨åˆ†å¼€å§‹åˆ†æ ArrayListï¼š ArrayList æ¦‚è¿° ArrayList çš„æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª ArrayList çš„æ–¹æ³• ArrayList çš„æ·»åŠ å…ƒç´ çš„æ–¹æ³•ï¼Œ ä»¥åŠ ArrayList çš„æ‰©å®¹æœºåˆ¶ ArrayList çš„åˆ é™¤å…ƒç´ çš„å¸¸ç”¨æ–¹æ³• ArrayList çš„ æ”¹æŸ¥å¸¸ç”¨æ–¹æ³• ArrayList çš„ toArray æ–¹æ³• ArrayList çš„éå†æ–¹æ³•ï¼Œä»¥åŠå¸¸è§çš„é”™è¯¯æ“ä½œå³äº§ç”Ÿé”™è¯¯æ“ä½œçš„åŸå›  ArrayList æ¦‚è¿°ArrayListçš„åŸºæœ¬ç‰¹ç‚¹ ArrayList åº•å±‚æ˜¯ä¸€ä¸ªåŠ¨æ€æ‰©å®¹çš„æ•°ç»„ç»“æ„ å…è®¸å­˜æ”¾ï¼ˆä¸æ­¢ä¸€ä¸ªï¼‰ null å…ƒç´  å…è®¸å­˜æ”¾é‡å¤æ•°æ®ï¼Œå­˜å‚¨é¡ºåºæŒ‰ç…§å…ƒç´ çš„æ·»åŠ é¡ºåº ArrayList å¹¶ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é›†åˆã€‚å¦‚æœé›†åˆçš„å¢åˆ æ“ä½œéœ€è¦ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ CopyOnWriteArrayList ã€ä½¿ç”¨çš„æ˜¯ ReentrantLock ä¿è¯åŒæ­¥ï¼Œä½†æ˜¯æœ‰å¼±ä¸€è‡´æ€§ï¼Œå› ä¸ºå†™æ•°æ®æ—¶æ˜¯å…ˆæ‹·è´å†å¤åˆ¶å›å»ã€‚ã€æˆ–è€…ä½¿ç”¨ collections.synchronizedList(List l) å‡½æ•°è¿”å›ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ArrayListç±»ã€‚å½“ç„¶äº†ï¼Œæ²¡æœ‰ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ï¼Œè¿™é‡Œçš„çº¿ç¨‹å®‰å…¨åªèƒ½ä¿è¯å•ä¸ªæ–¹æ³•çš„çº¿ç¨‹å®‰å…¨ï¼Œå¦‚æœå¤åˆæ“ä½œï¼Œæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹ä¸æ–­è¯»å–ä¸€ä¸ªæ•°ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸æ–­åˆ é™¤ä¸€ä¸ªæ•°ï¼Œä¸¤ä¸ªæ–¹æ³•çš„å¤åˆæ“ä½œï¼Œä¹Ÿä¼šå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ï¼Œè¿™å—æˆ‘åœ¨ jvm çš„æœ€åä¸€èŠ‚ä¹Ÿæœ‰è®²ã€‚ ArrayList çš„ç»§æ‰¿å…³ç³»12public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable ä» ArrayList çš„ç»§æ‰¿å…³ç³»æ¥çœ‹ï¼Œ ArrayList ç»§æ‰¿è‡ª AbstractList ï¼Œå®ç°äº†List\, RandomAccess, Cloneable, java.io.Serializable æ¥å£ã€‚ å…¶ä¸­ AbstractListå’Œ List\ æ˜¯è§„å®šäº† ArrayList ä½œä¸ºä¸€ä¸ªé›†åˆæ¡†æ¶å¿…é¡»å…·å¤‡çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•ï¼ŒArrayList æœ¬èº«è¦†å†™äº†åŸºç±»å’Œæ¥å£çš„å¤§éƒ¨åˆ†æ–¹æ³•ï¼Œè¿™å°±åŒ…å«æˆ‘ä»¬è¦åˆ†æçš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚ ArrayList å®ç° RandomAccess æ¥å£æ ‡è¯†ç€å…¶æ”¯æŒéšæœºå¿«é€Ÿè®¿é—®ï¼ŒæŸ¥çœ‹æºç å¯ä»¥çŸ¥é“ RandomAccess å…¶å®åªæ˜¯ä¸€ä¸ªæ ‡è¯†ï¼Œæ ‡è¯†æŸä¸ªç±»æ‹¥æœ‰éšæœºå¿«é€Ÿè®¿é—®çš„èƒ½åŠ›ï¼Œé’ˆå¯¹ ArrayList è€Œè¨€é€šè¿‡ get(index) å»è®¿é—®å…ƒç´ å¯ä»¥è¾¾åˆ° O(1) çš„æ—¶é—´å¤æ‚åº¦ã€‚æœ‰äº›é›†åˆç±»ä¸æ‹¥æœ‰è¿™ç§éšæœºå¿«é€Ÿè®¿é—®çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ LinkedList å°±æ²¡æœ‰å®ç°è¿™ä¸ªæ¥å£ã€‚ ArrayList å®ç° Cloneable æ¥å£æ ‡è¯†ç€ä»–å¯ä»¥è¢«å…‹éš†/å¤åˆ¶ï¼Œå…¶å†…éƒ¨å®ç°äº† clone æ–¹æ³•ä¾›ä½¿ç”¨è€…è°ƒç”¨æ¥å¯¹ ArrayList è¿›è¡Œå…‹éš†ï¼Œä½†å…¶å®ç°åªé€šè¿‡ Arrays.copyOf å®Œæˆäº†å¯¹ ArrayList è¿›è¡Œã€Œæµ…æ‹·è´ã€ï¼Œä¹Ÿå°±æ˜¯ä½ æ”¹å˜ ArrayList cloneåçš„é›†åˆä¸­çš„å…ƒç´ ï¼Œæºé›†åˆä¸­çš„å…ƒç´ ä¹Ÿä¼šæ”¹å˜ï¼Œå¯¹äºæ·±æµ…æ‹·è´æˆ‘å·²ç»å•ç‹¬æ•´ç†ä¸€ç¯‡æ–‡ç« æ¥è®²è¿°è¿™é‡Œä¸å†è¿‡å¤šçš„è¯´ã€‚ å¯¹äº java.io.Serializable æ ‡è¯†ç€é›†åˆå¯è¢«è¢«åºåˆ—åŒ–ã€‚ æˆ‘ä»¬å‘ç°äº†ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼Œé™¤äº† List\ ä»¥å¤–ï¼ŒArrayList å®ç°çš„æ¥å£éƒ½æ˜¯æ ‡è¯†æ¥å£ï¼Œæ ‡è¯†ç€è¿™ä¸ªç±»å…·æœ‰æ€æ ·çš„ç‰¹ç‚¹ï¼Œçœ‹èµ·æ¥æ›´åƒæ˜¯ä¸€ä¸ªå±æ€§ã€‚ ArrayList çš„æ„é€ æ–¹æ³•åœ¨è¯´æ„é€ æ–¹æ³•ä¹‹å‰æˆ‘ä»¬è¦å…ˆçœ‹ä¸‹ä¸æ„é€ å‚æ•°æœ‰å…³çš„å‡ ä¸ªå…¨å±€å˜é‡ï¼š 1234567891011121314151617181920212223/*** ArrayList é»˜è®¤çš„æ•°ç»„å®¹é‡*/ private static final int DEFAULT_CAPACITY = 10;/*** è¿™æ˜¯ä¸€ä¸ªå…±äº«çš„ç©ºçš„æ•°ç»„å®ä¾‹ï¼Œå½“ä½¿ç”¨ ArrayList(0) æˆ–è€… ArrayList(Collection&lt;? extends E&gt; c) * å¹¶ä¸” c.size() = 0 çš„æ—¶å€™è®² elementData æ•°ç»„è®²æŒ‡å‘è¿™ä¸ªå®ä¾‹å¯¹è±¡ã€‚*/ private static final Object[] EMPTY_ELEMENTDATA = &#123;&#125;;/*** å¦ä¸€ä¸ªå…±äº«ç©ºæ•°ç»„å®ä¾‹ï¼Œç¬¬ä¸€æ¬¡ add å…ƒç´ çš„æ—¶å€™å°†ä½¿ç”¨å®ƒæ¥åˆ¤æ–­æ•°ç»„å¤§å°æ˜¯å¦è®¾ç½®ä¸º DEFAULT_CAPACITY*/ private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;/*** çœŸæ­£è£…è½½é›†åˆå…ƒç´ çš„åº•å±‚æ•°ç»„ * è‡³äº transient å…³é”®å­—è¿™é‡Œç®€å•è¯´ä¸€å¥ï¼Œè¢«å®ƒä¿®é¥°çš„æˆå‘˜å˜é‡æ— æ³•è¢« Serializable åºåˆ—åŒ– * æœ‰å…´è¶£çš„å¯ä»¥å»ç½‘ä¸ŠæŸ¥ç›¸å…³èµ„æ–™* https://www.jianshu.com/p/14876ef38721 è¿™ä¸ªå†™å¾—å¥½*/ transient Object[] elementData; // non-private to simplify nested class access å…¶ä¸­æœ€éœ€è¦å…³æ³¨çš„å°±æ˜¯ transient ä¿®é¥°äº† elementDataï¼Œæˆ‘ä»¬çŸ¥é“ transient ä¿®é¥°çš„å˜é‡æ˜¯é˜²æ­¢å˜é‡è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œé‚£ä¸ºä½• ArrayList ç»§æ‰¿äº† Serializableï¼Œå´å°†å…¶å†…éƒ¨å…ƒç´ å˜ä¸º transient å‘¢ï¼Ÿå› ä¸º elementData æ˜¯ä¸€ä¸ªç¼“å­˜æ•°ç»„ï¼Œä¼šé¢„ç•™ä¸€äº›å®¹é‡ï¼Œç­‰å®¹é‡ä¸è¶³æ—¶å†æ‰©å……å®¹é‡ï¼Œé‚£ä¹ˆæœ‰äº›ç©ºé—´å¯èƒ½å°±æ²¡æœ‰å®é™…å­˜å‚¨å…ƒç´ ï¼Œé‡‡ç”¨ä¸Šé¢çš„æ–¹å¼æ¥å®ç°åºåˆ—åŒ–æ—¶ï¼Œå°±å¯ä»¥ä¿è¯åªåºåˆ—åŒ–å®é™…å­˜å‚¨çš„é‚£äº›å…ƒç´ ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ•°ç»„ï¼Œä»è€ŒèŠ‚çœç©ºé—´å’Œæ—¶é—´ã€‚ è¿˜æœ‰å°±æ˜¯ï¼Œé‚£ ArrayList æ˜¯å¦‚ä½•å®ç°åºåˆ—åŒ–çš„å‘¢ï¼Ÿæ˜¯å› ä¸ºå…¶å†™äº† writeObject() å’Œ readObject() ï¼Œè™½ç„¶è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯ä½¿ç”¨çš„ç§æœ‰æ–¹æ³•ï¼Œä½†å¦‚ä½•è°ƒç”¨çš„å‘¢ï¼Ÿå°±æ˜¯é€šè¿‡åå°„æœºåˆ¶å¾—ä»¥è°ƒç”¨çš„ã€‚åå°„é‡Œé¢æ˜¯æœ‰ setAccessible() å¯ä»¥å¿½ç•¥æ–¹æ³•å‰çš„ privateã€‚ å…·ä½“è§ï¼š ä½œè€…ï¼šæ±ªå’Œå‘†å–µé“¾æ¥ï¼šhttps://www.jianshu.com/p/14876ef38721æ¥æºï¼šç®€ä¹¦è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ å¯¹äºä¸Šè¿°å‡ ä¸ªæˆå‘˜å˜é‡ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨æ³¨é‡Šä¸­ç®€å•çš„è¯´æ˜ï¼Œå¯¹äºä»–ä»¬å…·ä½“æœ‰ä»€ä¹ˆä½œç”¨ï¼Œåœ¨ä¸‹è¾¹åˆ†ææ„é€ æ–¹æ³•å’Œæ‰©å®¹æœºåˆ¶çš„æ—¶å€™å°†ä¼šæ›´è¯¦ç»†çš„è®²è§£ã€‚ ArrayList ä¸€å…±ä¸‰ç§æ„é€ æ–¹å¼ï¼Œæˆ‘ä»¬å…ˆä»æ— å‚çš„æ„é€ æ–¹æ³•æ¥å¼€å§‹ï¼š æ— å‚æ„é€ æ–¹æ³•123456/*** æ„é€ ä¸€ä¸ªåˆå§‹å®¹é‡ä¸º10çš„ç©ºåˆ—è¡¨ã€‚*/public ArrayList() &#123; this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;&#125; è¿™æ˜¯æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå…¶å†…éƒ¨å®ç°åªæ˜¯å°† elementData æŒ‡å‘äº†æˆ‘ä»¬åˆšæ‰è®²å¾— DEFAULTCAPACITY_EMPTY_ELEMENTDATA è¿™ä¸ªç©ºæ•°ç»„ï¼Œè¿™ä¸ªç©ºæ•°ç»„çš„å®¹é‡æ˜¯ 0ï¼Œ ä½†æ˜¯æºç æ³¨é‡Šå´è¯´è¿™æ˜¯æ„é€ ä¸€ä¸ªåˆå§‹å®¹é‡ä¸º10çš„ç©ºåˆ—è¡¨ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿå…¶å®åœ¨é›†åˆè°ƒç”¨ add æ–¹æ³•æ·»åŠ å…ƒç´ çš„æ—¶å€™å°†ä¼šè°ƒç”¨ ensureCapacityInternal æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•å†…éƒ¨åˆ¤æ–­äº†ï¼š 123if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123; minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);&#125; å¯è§ï¼Œå¦‚æœé‡‡ç”¨æ— å‚æ•°æ„é€ æ–¹æ³•çš„æ—¶å€™ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ è‚¯å®šèµ°è¿› if åˆ¤æ–­ä¸­ minCapacity å°†è¢«èµ‹å€¼ä¸º 10ï¼Œæ‰€ä»¥æ„é€ ä¸€ä¸ªåˆå§‹å®¹é‡ä¸º10çš„ç©ºåˆ—è¡¨ ä¹Ÿå°±æ˜¯è¿™ä¸ªæ„æ€ã€‚ æŒ‡å®šåˆå§‹å®¹é‡çš„æ„é€ æ–¹æ³•12345678910111213141516/*** æ„é€ ä¸€ä¸ªå…·æœ‰æŒ‡å®šåˆå§‹å®¹é‡çš„ç©ºåˆ—è¡¨ã€‚* @param åˆå§‹å®¹é‡ * @throws å¦‚æœå‚æ•°å°äº 0 å°†ä¼šæŠ›å‡º IllegalArgumentException å‚æ•°ä¸åˆæ³•å¼‚å¸¸ */ public ArrayList(int initialCapacity) &#123; if (initialCapacity &gt; 0) &#123; this.elementData = new Object[initialCapacity]; &#125; else if (initialCapacity == 0) &#123; this.elementData = EMPTY_ELEMENTDATA; &#125; else &#123; throw new IllegalArgumentException("Illegal Capacity: "+ initialCapacity); &#125;&#125; å¦‚æœæˆ‘ä»¬é¢„å…ˆçŸ¥é“ä¸€ä¸ªé›†åˆå…ƒç´ çš„å®¹çº³çš„ä¸ªæ•°çš„æ—¶å€™æ¨èä½¿ç”¨è¿™ä¸ªæ„é€ æ–¹æ³•ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸ªFragmentPagerAdapter ä¸€å…±éœ€è¦è£… 15 ä¸ª Fragment ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨æ„é€ é›†åˆçš„æ—¶å€™ç”Ÿæˆä¸€ä¸ªåˆå§‹å®¹é‡ä¸º 15 çš„ä¸€ä¸ªé›†åˆã€‚æœ‰äººä¼šè®¤ä¸º ArrayList è‡ªèº«å…·æœ‰åŠ¨æ€æ‰©å®¹çš„æœºåˆ¶ï¼Œæ— éœ€è¿™ä¹ˆéº»çƒ¦ï¼Œä¸‹é¢æˆ‘ä»¬è®²è§£æ‰©å®¹æœºåˆ¶çš„æ—¶å€™æˆ‘ä»¬å°±ä¼šå‘ç°ï¼Œæ¯æ¬¡æ‰©å®¹æ˜¯éœ€è¦æœ‰ä¸€å®šçš„å†…å­˜å¼€é”€çš„ï¼Œè€Œè¿™ä¸ªå¼€é”€åœ¨é¢„å…ˆçŸ¥é“å®¹é‡çš„æ—¶å€™æ˜¯å¯ä»¥é¿å…çš„ã€‚ æºä»£ç ä¸­æŒ‡å®šåˆå§‹å®¹é‡çš„æ„é€ æ–¹æ³•å®ç°ï¼Œåˆ¤æ–­äº†å¦‚æœ æˆ‘ä»¬æŒ‡å®šå®¹é‡å¤§äº 0 ï¼Œå°†ä¼šç›´æ¥ new ä¸€ä¸ªæ•°ç»„ï¼Œèµ‹å€¼ç»™ elementData å¼•ç”¨ä½œä¸ºé›†åˆçœŸæ­£çš„å­˜å‚¨æ•°ç»„ï¼Œè€ŒæŒ‡å®šå®¹é‡ç­‰äº 0 çš„æ—¶å€™ä½¿ç”¨æˆå‘˜å˜é‡ EMPTY_ELEMENTDATA ä½œä¸ºæš‚æ—¶çš„å­˜å‚¨æ•°ç»„ï¼Œè¿™æ˜¯ EMPTY_ELEMENTDATA è¿™ä¸ªç©ºæ•°ç»„çš„ä¸€ä¸ªç”¨å¤„ï¼ˆä¸å¿…å¤ªè¿‡äºçº EMPTY_ELEMENTDATA çš„ä½œç”¨ï¼Œå…¶å®å®ƒçš„åœ¨æºç ä¸­å‡ºç°çš„é¢‘ç‡å¹¶ä¸é«˜ï¼‰ã€‚ ä½¿ç”¨å¦ä¸ªä¸€ä¸ªé›†åˆ Collection çš„æ„é€ æ–¹æ³•12345678910111213141516/*** æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆå…ƒç´ çš„åˆ—è¡¨ï¼Œå…ƒç´ çš„é¡ºåºç”±é›†åˆçš„è¿­ä»£å™¨è¿”å›ã€‚* @param æºé›†åˆï¼Œå…¶å…ƒç´ å°†è¢«æ”¾ç½®åˆ°è¿™ä¸ªé›†åˆä¸­ã€‚ * @å¦‚æœå‚æ•°ä¸º nullï¼Œå°†ä¼šæŠ›å‡º NullPointerException ç©ºæŒ‡é’ˆå¼‚å¸¸*/public ArrayList(Collection&lt;? extends E&gt; c) &#123; elementData = c.toArray(); if ((size = elementData.length) != 0) &#123; // c.toArray å¯èƒ½(é”™è¯¯åœ°)ä¸è¿”å› Object[]ç±»å‹çš„æ•°ç»„ å‚è§ jdk çš„ bug åˆ—è¡¨(6260652) if (elementData.getClass() != Object[].class) elementData = Arrays.copyOf(elementData, size, Object[].class); &#125; else &#123; // å¦‚æœé›†åˆå¤§å°ä¸ºç©ºå°†èµ‹å€¼ä¸º EMPTY_ELEMENTDATA ç­‰åŒäº new ArrayList(0); this.elementData = EMPTY_ELEMENTDATA; &#125; &#125; çœ‹å®Œè¿™ä¸ªä»£ç æˆ‘æœ€ç–‘æƒ‘çš„åœ°æ–¹æ˜¯ Collection.toArray() å’Œ Arrays.copyOf() è¿™ä¸¤ä¸ªæ–¹æ³•çš„ä½¿ç”¨ï¼Œçœ‹æ¥æƒ³æ˜ç™½è¿™ä¸ªæ„é€ å‚æ•°å…·ä½“åšäº†ä»€ä¹ˆå¿…é¡»ç†è§£è¿™ä¸¤ä¸ªæ–¹æ³•äº†ã€‚ Object[] Collection.toArray() æ–¹æ³•æˆ‘ä»¬éƒ½çŸ¥é“ Collection æ˜¯é›†åˆæ¡†æ¶çš„è¶…ç±»ï¼Œå…¶å® Collection.toArray æ˜¯äº¤ç»™å…·ä½“çš„é›†åˆå­ç±»å»å®ç°çš„ï¼Œè¿™å°±è¯´æ˜ä¸åŒçš„é›†åˆå¯èƒ½æœ‰ä¸åŒçš„å®ç°ã€‚ä»–ç”¨æ¥å°†ä¸€ä¸ªé›†åˆè½¬åŒ–ä¸ºä¸€ä¸ª Object[] æ•°ç»„ï¼Œäº‹å®ä¸Šçš„çœŸçš„æ˜¯è¿™æ ·çš„ä¹ˆï¼Ÿå‚è§ jdk çš„ bug åˆ—è¡¨(6260652)åˆæ˜¯ä»€ä¹ˆæ„æ€å‘¢ ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸‹è¾¹çš„è¿™ä¸ªä¾‹å­ï¼š 12345678910111213List&lt;String&gt; subClasses = Arrays.asList("abc","def");// class java.util.Arrays$ArrayList System.out.println(list.getClass()); Object[] objects = subClasses.toArray();// class java.lang.String; Object[] objArray = list.toArray(); //è¿™é‡Œè¿”å›çš„æ˜¯ String[]System.out.println(objects.getClass().getSimpleName()); objArray[0] = new Object(); // cause ArrayStoreException å’¦ï¼Ÿä¸ºå•¥è¿™é‡Œå¹¶ä¸æ˜¯ä¸€ä¸ª Object æ•°ç»„å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œlist.getClass å¾—åˆ°çš„å¹¶ä¸æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„ ArrayList è€Œæ˜¯ Arrays çš„å†…éƒ¨ç±» Arrays$ArrayListã€‚ 123456789ArrayList(E[] array) &#123; //è¿™é‡Œåªæ˜¯æ£€æŸ¥äº†æ•°ç»„æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºç›´æ¥å°†åŸæ•°ç»„èµ‹å€¼ç»™è¿™ä¸ª ArrayList çš„å­˜å‚¨æ•°ç»„ã€‚ a = Objects.requireNonNull(array);&#125;@Overridepublic Object[] toArray()&#123; return a.clone();&#125; è€Œæˆ‘ä»¬è°ƒç”¨çš„ toArray æ–¹æ³•å°±æ˜¯è¿™ä¸ªå†…éƒ¨å¯¹äº Collection.toArray çš„å®ç°ï¼Œ a.clone() ,è¿™é‡Œ clone å¹¶ä¸ä¼šæ”¹å˜ä¸€ä¸ªæ•°ç»„çš„ç±»å‹ï¼Œæ‰€ä»¥å½“åŸå§‹æ•°ç»„ä¸­æ”¾çš„ String ç±»å‹çš„æ—¶å€™å°±ä¼šå‡ºç°ä¸Šè¾¹çš„è¿™ç§æƒ…å†µäº†ã€‚ å…¶å®æˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™æ˜¯ jdk çš„ä¸€ä¸ª bugï¼Œæ—©åœ¨ 05å¹´çš„æ—¶å€™è¢«äººæå‡ºæ¥äº†ï¼Œä½†æ˜¯ä¸€ç›´æ²¡ä¿®å¤ï¼Œä½†æ˜¯åœ¨æ–°çš„ ã€Œjdk 1.9ã€ ç§è¿™ä¸ª bug è¢«ä¿®å¤äº†ã€‚ æœ‰å…´è¶£çš„å¯ä»¥è¿½è¸ª bug 6260652 çœ‹ä¸‹ã€‚ Arrays.copyOf æ–¹æ³•è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨é›†åˆæºç ä¸­å¸¸è§çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä»–æœ‰å¾ˆå¤šé‡è½½æ–¹å¼,æˆ‘ä»¬æ¥çœ‹ä¸‹æœ€æ ¹æœ¬çš„æ–¹æ³•ï¼š 1234567891011public static &lt;T,U&gt; T[] copyOf(U[] original, int newLength, Class&lt;? extends T[]&gt; newType) &#123; @SuppressWarnings("unchecked") //æ ¹æ®classçš„ç±»å‹æ˜¯å¦æ˜¯ Object[] æ¥å†³å®šæ˜¯ new è¿˜æ˜¯åå°„å»æ„é€ ä¸€ä¸ªæ³›å‹æ•°ç»„ T[] copy = ((Object)newType == (Object)Object[].class) ? (T[]) new Object[newLength] : (T[]) Array.newInstance(newType.getComponentType(), newLength); //ä½¿ç”¨ native æ–¹æ³•æ‰¹é‡èµ‹å€¼å…ƒç´ è‡³æ–°æ•°ç»„ä¸­ã€‚ System.arraycopy(original, 0, copy, 0, Math.min(original.length, newLength)); return copy;&#125; ä¸Šè¾¹çš„æ³¨é‡Šä¹Ÿçœ‹å‡ºæ¥äº†ï¼ŒArrays.copyOf æ–¹æ³•å¤åˆ¶æ•°ç»„çš„æ—¶å€™å…ˆåˆ¤æ–­äº†æŒ‡å®šçš„æ•°ç»„ç±»å‹æ˜¯å¦ä¸º Object[] ç±»å‹ï¼Œå¦åˆ™ä½¿ç”¨åå°„å»æ„é€ ä¸€ä¸ªæŒ‡å®šç±»å‹çš„æ•°ç»„ã€‚æœ€åä½¿ç”¨ System.arraycopy è¿™ä¸ª native æ–¹æ³•ï¼Œå»å®ç°æœ€ç»ˆçš„æ•°ç»„èµ‹å€¼ï¼ŒnewLength å¦‚æœæ¯” original.length å¤§çš„æ—¶å€™ä¼šå°†å¤šä½™çš„ç©ºé—´èµ‹å€¼ä¸º null ç”±ä¸‹è¾¹çš„ä¾‹å­å¯è§: 12345String[] arrString = &#123;"abc","def"&#125;;Object[] copyOf = Arrays.copyOf(arrString, 5, Object[].class);//[abc, def, null, null, null]System.out.println(Arrays.toString(copyOf)); å½“ç„¶ ArrayList(Collection&lt;? extends E&gt; c) å¤åˆ¶çš„æ—¶å€™ä¼ é€’çš„æ˜¯ c.size() æ‰€ä»¥ä¸ä¼šå‡ºç° nullã€‚ ex: å¯¹äº System.arraycopy è¯¥æ–¹æ³•ï¼Œæœ¬æ–‡ä¸å†å±•å¼€è®¨è®ºï¼Œæœ‰ä¸€ç¯‡å¯¹äºå…¶åˆ†æå¾ˆå¥½çš„æ–‡ç« å¤§å®¶å¯ä»¥å»å‚è€ƒSystemï¼šSystem.arraycopyæ–¹æ³•è¯¦è§£ okï¼Œç»•äº†è¿™ä¹ˆå¤§çš„åœˆå­ç»ˆäºæ˜ç™½äº†ï¼ŒArrayList(Collection&lt;? extends E&gt; c)å¹²äº†å•¥äº†ï¼Œå…¶å®å°±æ˜¯å°†ä¸€ä¸ªé›†åˆä¸­çš„å…ƒç´ å¡åˆ° ArrayList åº•å±‚çš„æ•°ç»„ä¸­ã€‚è‡³æ­¤æˆ‘ä»¬ä¹Ÿå°† ArrayList çš„æ„é€ ç ”ç©¶å®Œäº†ã€‚ ArrayListçš„æ·»åŠ å…ƒç´  &amp; æ‰©å®¹æœºåˆ¶æ•²é»‘æ¿äº†ï¼è¿™å—æ˜¯é¢è¯•çš„å¸¸å®¢äº†ï¼Œæ‰€ä»¥å¿…é¡»ä»”ç»†ç ”ç©¶ä¸‹äº†ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸‹å¦‚ä½•ç»™ä¸€ä¸ª ArrayList æ·»åŠ ä¸€ä¸ªå…ƒç´ : åœ¨é›†åˆæœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ–¹æ³•123456789101112131415//æˆå‘˜å˜é‡ size æ ‡è¯†é›†åˆå½“å‰å…ƒç´ ä¸ªæ•°åˆå§‹ä¸º 0int sizeï¼›/*** å°†æŒ‡å®šå…ƒç´ æ·»åŠ åˆ°é›†åˆï¼ˆåº•å±‚æ•°ç»„ï¼‰æœ«å°¾* @param å°†è¦æ·»åŠ çš„å…ƒç´ * @return è¿”å› true è¡¨ç¤ºæ·»åŠ æˆåŠŸ*/public boolean add(E e) &#123; //æ£€æŸ¥å½“å‰åº•å±‚æ•°ç»„å®¹é‡ï¼Œå¦‚æœå®¹é‡ä¸å¤Ÿåˆ™è¿›è¡Œæ‰©å®¹ ensureCapacityInternal(size + 1); // Increments modCount!! //å°†æ•°ç»„æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œsize åŠ  1 elementData[size++] = e; return true;&#125; è°ƒç”¨ add æ–¹æ³•çš„æ—¶å€™æ€»ä¼šè°ƒç”¨ ensureCapacityInternal æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œ ensureCapacityInternal å‚æ•°ä¸ºå½“å‰é›†åˆé•¿åº¦ size + 1ï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œæ˜¯å¦éœ€è¦æ‰©å……é•¿åº¦ï¼Œéœ€è¦çœ‹å½“å‰åº•å±‚æ•°ç»„æ˜¯å¦å¤Ÿæ”¾ size + 1ä¸ªå…ƒç´ çš„ã€‚ æ‰©å®¹æœºåˆ¶1234567891011121314151617//æ‰©å®¹æ£€æŸ¥private void ensureCapacityInternal(int minCapacity) &#123; //å¦‚æœæ˜¯æ— å‚æ„é€ æ–¹æ³•æ„é€ çš„çš„é›†åˆï¼Œç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ çš„æ—¶å€™ä¼šæ»¡è¶³è¿™ä¸ªæ¡ä»¶ minCapacity å°†ä¼šè¢«èµ‹å€¼ä¸º 10 if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123; minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity); &#125; // å°† size + 1 æˆ– 10 ä¼ å…¥ ensureExplicitCapacity è¿›è¡Œæ‰©å®¹åˆ¤æ–­ ensureExplicitCapacity(minCapacity);&#125;private void ensureExplicitCapacity(int minCapacity) &#123; //æ“ä½œæ•°åŠ  1 ç”¨äºä¿è¯å¹¶å‘è®¿é—® modCount++; // å¦‚æœ å½“å‰æ•°ç»„çš„é•¿åº¦æ¯”æ·»åŠ å…ƒç´ åçš„é•¿åº¦è¦å°åˆ™è¿›è¡Œæ‰©å®¹ if (minCapacity - elementData.length &gt; 0) grow(minCapacity);&#125; ä¸Šè¾¹çš„æºç ä¸»è¦åšäº†æ‰©å®¹å‰çš„åˆ¤æ–­æ“ä½œï¼Œæ³¨æ„å‚æ•°ä¸ºå½“å‰é›†åˆå…ƒç´ ä¸ªæ•°+1ï¼Œç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ çš„æ—¶å€™ size + 1 = 1 ,è€Œ elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA, é•¿åº¦ä¸º 0 ï¼Œ1 - 0 &gt; 0, æ‰€ä»¥éœ€è¦è¿›è¡Œ grow æ“ä½œä¹Ÿå°±æ˜¯æ‰©å®¹ã€‚ 1234567891011121314151617181920212223242526272829303132333435/*** é›†åˆçš„æœ€å¤§é•¿åº¦ Integer.MAX_VALUE - 8 æ˜¯ä¸ºäº†å‡å°‘å‡ºé”™çš„å‡ ç‡ Integer æœ€å¤§å€¼å·²ç»å¾ˆå¤§äº†*/private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;/*** å¢åŠ å®¹é‡ï¼Œä»¥ç¡®ä¿å®ƒè‡³å°‘èƒ½å®¹çº³æœ€å°å®¹é‡å‚æ•°æŒ‡å®šçš„å…ƒç´ ä¸ªæ•°ã€‚* @param æ»¡è¶³æ¡ä»¶çš„æœ€å°å®¹é‡*/private void grow(int minCapacity) &#123; //è·å–å½“å‰ elementData çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯ List ä¸­å½“å‰çš„å®¹é‡ int oldCapacity = elementData.length; //oldCapacity &gt;&gt; 1 ç­‰ä»·äº oldCapacity / 2 æ‰€ä»¥æ–°å®¹é‡ä¸ºå½“å‰å®¹é‡çš„ 1.5 å€ int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); //å¦‚æœæ‰©å¤§1.5å€åä»æ—§æ¯” minCapacity å°é‚£ä¹ˆç›´æ¥ç­‰äº minCapacity if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; //å¦‚æœæ–°æ•°ç»„å¤§å°æ¯” MAX_ARRAY_SIZE å°±éœ€è¦è¿›ä¸€æ­¥æ¯”è¾ƒ minCapacity å’Œ MAX_ARRAY_SIZE çš„å¤§å° if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); // minCapacityé€šå¸¸æ¥è¿‘ size å¤§å° //ä½¿ç”¨ Arrays.copyOf æ„å»ºä¸€ä¸ªé•¿åº¦ä¸º newCapacity æ–°æ•°ç»„ å¹¶å°† elementData æŒ‡å‘æ–°æ•°ç»„ elementData = Arrays.copyOf(elementData, newCapacity);&#125;/*** æ¯”è¾ƒ minCapacity ä¸ Integer.MAX_VALUE - 8 çš„å¤§å°å¦‚æœå¤§åˆ™æ”¾å¼ƒ-8çš„è®¾å®šï¼Œè®¾ç½®ä¸º Integer.MAX_VALUE */private static int hugeCapacity(int minCapacity) &#123; if (minCapacity &lt; 0) // overflow throw new OutOfMemoryError(); return (minCapacity &gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE;&#125; ç”±æ­¤çœ‹æ¥ ArrayList çš„æ‰©å®¹æœºåˆ¶çš„çŸ¥è¯†ç‚¹ä¸€å…±åˆä¸¤ä¸ª æ¯æ¬¡æ‰©å®¹çš„å¤§å°ä¸ºåŸæ¥å¤§å°çš„ 1.5 å€ ï¼ˆå½“ç„¶è¿™é‡Œæ²¡æœ‰åŒ…å« 1.5å€åå¤§äº MAX_ARRAY_SIZE çš„æƒ…å†µï¼‰æ‰©å®¹çš„è¿‡ç¨‹å…¶å®æ˜¯ä¸€ä¸ªå°†åŸæ¥å…ƒç´ æ‹·è´åˆ°ä¸€ä¸ªæ‰©å®¹åæ•°ç»„å¤§å°çš„é•¿åº¦æ–°æ•°ç»„ä¸­ã€‚æ‰€ä»¥ ArrayList çš„æ‰©å®¹å…¶å®æ˜¯ç›¸å¯¹æ¥è¯´æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½çš„ã€‚ åœ¨æŒ‡å®šè§’æ ‡ä½ç½®æ·»åŠ å…ƒç´ çš„æ–¹æ³•123456789101112131415161718/*** å°†æŒ‡å®šçš„å…ƒç´ æ’å…¥è¯¥åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®ã€‚å°†å½“å‰ä½ç½®çš„å…ƒç´ (å¦‚æœæœ‰)å’Œä»»ä½•åç»­å…ƒç´ ç§»åˆ°å³è¾¹(å°†ä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°å®ƒä»¬çš„ç´¢å¼•ä¸­)ã€‚* @param è¦æ’å…¥çš„ç´¢å¼•ä½ç½®* @param è¦æ·»åŠ çš„å…ƒç´ * @throws å¦‚æœ index å¤§äºé›†åˆé•¿åº¦ å°äº 0 åˆ™æŠ›å‡ºè§’æ ‡è¶Šç•Œ IndexOutOfBoundsException å¼‚å¸¸*/public void add(int index, E element) &#123; // æ£€æŸ¥è§’æ ‡æ˜¯å¦è¶Šç•Œ rangeCheckForAdd(index); // æ‰©å®¹æ£€æŸ¥ ensureCapacityInternal(size + 1); //è°ƒç”¨ native æ–¹æ³•æ–°å‹æ•°ç»„æ‹·è´ System.arraycopy(elementData, index, elementData, index + 1,size - index); // æ·»åŠ æ–°å…ƒç´  elementData[index] = element; size++;&#125; æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªæ•°ç»„æ˜¯ä¸èƒ½åœ¨è§’æ ‡ä½ç½®ç›´æ¥æ’å…¥å…ƒç´ çš„ï¼ŒArrayList é€šè¿‡æ•°ç»„æ‹·è´çš„æ–¹æ³•å°†æŒ‡å®šè§’æ ‡ä½ç½®ä»¥åŠå…¶åç»­å…ƒç´ æ•´ä½“å‘åç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œç©ºå‡º index è§’æ ‡çš„ä½ç½®ï¼Œæ¥èµ‹å€¼æ–°çš„å…ƒç´ ã€‚ å°†ä¸€ä¸ªæ•°ç»„ src èµ·å§‹ srcPos è§’æ ‡ä¹‹å length é•¿åº¦é—´çš„å…ƒç´ ï¼Œèµ‹å€¼åˆ° dest æ•°ç»„ä¸­ destPos åˆ° destPos + length -1é•¿åº¦è§’æ ‡ä½ç½®ä¸Šã€‚åªæ˜¯åœ¨ add æ–¹æ³•ä¸­ src å’Œ dest ä¸ºåŒä¸€ä¸ªæ•°ç»„è€Œå·²ã€‚ 123public static native void arraycopy(Object src, int srcPos, Object dest, int destPos, int length); æ‰¹é‡æ·»åŠ å…ƒç´ ç”±äºæ‰¹é‡æ·»åŠ å’Œæ·»åŠ ä¸€ä¸ªå…ƒç´ é€»è¾‘å¤§æ¦‚ç›¸åŒåˆ™è¿™é‡Œä¸è¯¦ç»†è¯´äº†ï¼Œä»£ç æ³¨é‡Šå¯ä»¥äº†è§£æ•´ä¸ªæ·»åŠ æµç¨‹ã€‚ åœ¨æ•°ç»„æœ«å°¾æ·»åŠ  12345678910111213public boolean addAll(Collection&lt;? extends E&gt; c) &#123; // è°ƒç”¨ c.toArray å°†é›†åˆè½¬åŒ–æ•°ç»„ Object[] a = c.toArray(); // è¦æ·»åŠ çš„å…ƒç´ çš„ä¸ªæ•° int numNew = a.length; //æ‰©å®¹æ£€æŸ¥ä»¥åŠæ‰©å®¹ ensureCapacityInternal(size + numNew); // Increments modCount //å°†å‚æ•°é›†åˆä¸­çš„å…ƒç´ æ·»åŠ åˆ°åŸæ¥æ•°ç»„ [sizeï¼Œsize + numNew -1] çš„è§’æ ‡ä½ç½®ä¸Šã€‚ System.arraycopy(a, 0, elementData, size, numNew); size += numNew; //ä¸å•ä¸€æ·»åŠ çš„ add æ–¹æ³•ä¸åŒçš„æ˜¯æ‰¹é‡æ·»åŠ æœ‰è¿”å›å€¼ï¼Œå¦‚æœ numNew == 0 è¡¨ç¤ºæ²¡æœ‰è¦æ·»åŠ çš„å…ƒç´ åˆ™éœ€è¦è¿”å› false return numNew != 0;&#125; åœ¨æ•°ç»„æŒ‡å®šè§’æ ‡ä½ç½®æ·»åŠ 1234567891011121314151617181920public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123; //åŒæ ·æ£€æŸ¥è¦æ’å…¥çš„ä½ç½®æ˜¯å¦ä¼šå¯¼è‡´è§’æ ‡è¶Šç•Œ rangeCheckForAdd(index); Object[] a = c.toArray(); int numNew = a.length; ensureCapacityInternal(size + numNew); //è¿™é‡Œåšäº†åˆ¤æ–­ï¼Œå¦‚æœè¦numMoved &gt; 0 ä»£è¡¨æ’å…¥çš„ä½ç½®åœ¨é›†åˆä¸­é—´ä½ç½®ï¼Œå’Œåœ¨ numMoved == 0æœ€åä½ç½® åˆ™è¡¨ç¤ºè¦åœ¨æ•°ç»„æœ«å°¾æ·»åŠ  å¦‚æœ &lt; 0 rangeCheckForAdd å°±è·‘å‡ºäº†è§’æ ‡è¶Šç•Œ int numMoved = size - index; if (numMoved &gt; 0) System.arraycopy(elementData, index, elementData, index + numNew, numMoved); System.arraycopy(a, 0, elementData, index, numNew); size += numNew; return numNew != 0;&#125;private void rangeCheckForAdd(int index) &#123; if (index &gt; size || index &lt; 0) throw new IndexOutOfBoundsException(outOfBoundsMsg(index));&#125; ä¸¤ä¸ªæ–¹æ³•ä¸åŒçš„åœ°æ–¹åœ¨äºå¦‚æœç§»åŠ¨è§’æ ‡å³ä¹‹åçš„å…ƒç´ ï¼ŒaddAll(int index, Collection&lt;? extends E&gt; c)é‡Œåšäº†åˆ¤æ–­ï¼Œå¦‚æœè¦ numMoved &gt; 0 ä»£è¡¨æ’å…¥çš„ä½ç½®åœ¨é›†åˆä¸­é—´ä½ç½®ï¼Œå’Œåœ¨ numMoved == 0 æœ€åä½ç½® åˆ™è¡¨ç¤ºè¦åœ¨æ•°ç»„æœ«å°¾æ·»åŠ  å¦‚æœ numMoved &lt; 0 ï¼ŒrangeCheckForAdd å°±æŠ›å‡ºäº†è§’æ ‡è¶Šç•Œå¼‚å¸¸äº†ã€‚ ä¸å•ä¸€æ·»åŠ çš„ add æ–¹æ³•ä¸åŒçš„æ˜¯æ‰¹é‡æ·»åŠ æœ‰è¿”å›å€¼ï¼Œå¦‚æœ numNew == 0 è¡¨ç¤ºæ²¡æœ‰è¦æ·»åŠ çš„å…ƒç´ åˆ™éœ€è¦è¿”å› falseã€‚ ArrayList åˆ é™¤å…ƒç´ æ ¹æ®è§’æ ‡ç§»é™¤å…ƒç´ 1234567891011121314151617181920212223242526/*** å°†ä»»ä½•åç»­å…ƒç´ ç§»åˆ°å·¦è¾¹(ä»å®ƒä»¬çš„ç´¢å¼•ä¸­å‡å»ä¸€ä¸ª)ã€‚*/public E remove(int index) &#123; //æ£€æŸ¥ index æ˜¯å¦ &gt;= size rangeCheck(index); modCount++; //index ä½ç½®çš„å…ƒç´  E oldValue = elementData(index); // éœ€è¦ç§»åŠ¨çš„å…ƒç´ ä¸ªæ•° int numMoved = size - index - 1; if (numMoved &gt; 0) //é‡‡ç”¨æ‹·è´èµ‹å€¼çš„æ–¹æ³•å°† index ä¹‹åæ‰€æœ‰çš„å…ƒç´  å‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½® System.arraycopy(elementData, index+1, elementData, index, numMoved); // å°† element æœ«å°¾çš„å…ƒç´ ä½ç½®è®¾ä¸º null elementData[--size] = null; // clear to let GC do its work // è¿”å› index ä½ç½®çš„å…ƒç´  return oldValue;&#125;// æ¯”è¾ƒè¦ç§»é™¤çš„è§’æ ‡ä½ç½®å’Œå½“å‰ elementData ä¸­å…ƒç´ çš„ä¸ªæ•°private void rangeCheck(int index) &#123; if (index &gt;= size) throw new IndexOutOfBoundsException(outOfBoundsMsg(index));&#125; æ ¹æ®è§’æ ‡ç§»é™¤å…ƒç´ çš„æ–¹æ³•æºç å¦‚ä¸Šæ‰€ç¤ºï¼Œå€¼å¾—æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼š rangeCheck å’Œ rangeCheckForAdd æ–¹æ³•ä¸åŒ ï¼ŒrangeCheck åªæ£€æŸ¥äº† indexæ˜¯å¦å¤§äºç­‰äº sizeï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“ size ä¸º elementData å·²å­˜å‚¨æ•°æ®çš„ä¸ªæ•°ï¼Œæˆ‘ä»¬åªèƒ½ç§»é™¤ elementData æ•°ç»„ä¸­ [0 , size -1] çš„å…ƒç´ ï¼Œå¦åˆ™åº”è¯¥æŠ›å‡ºè§’æ ‡è¶Šç•Œã€‚ ä½†æ˜¯ä¸ºä»€ä¹ˆæ²¡æœ‰å’Œ rangeCheckForAdd ä¸€æ ·æ£€æŸ¥å°äº0çš„è§’æ ‡å‘¢ï¼Œæ˜¯ä¸æ˜¯remove(-1) ä¸ä¼šæŠ›å¼‚å¸¸å‘¢ï¼Ÿ å…¶å®ä¸æ˜¯çš„ï¼Œå› ä¸º rangeCheck(index); åæˆ‘ä»¬å»è°ƒç”¨ elementData(index) çš„æ—¶å€™ä¹Ÿä¼šæŠ›å‡º IndexOutOfBoundsException çš„å¼‚å¸¸ï¼Œè¿™æ˜¯æ•°ç»„æœ¬èº«æŠ›å‡ºçš„ï¼Œä¸æ˜¯ ArrayList æŠ›å‡ºçš„ã€‚é‚£ä¸ºä»€ä¹ˆè¦æ£€æŸ¥&gt;= size å‘¢ï¼Ÿ æ•°ç»„æœ¬èº«ä¸ä¹Ÿä¼šæ£€æŸ¥ä¹ˆï¼Ÿ å“ˆå“ˆ.. ç»†å¿ƒçš„åŒå­¦è‚¯å®šçŸ¥é“ elementData.length å¹¶ä¸ä¸€å®šç­‰äº sizeï¼Œæ¯”å¦‚ï¼š 123456ArrayList&lt;String&gt; testRemove = new ArrayList&lt;&gt;(10); testRemove.add("1"); testRemove.add("2"); // java.lang.IndexOutOfBoundsException: Index: 2, Size: 2 String remove = testRemove.remove(2); System.out.println("remove = " + remove + ""); new ArrayList&lt;&gt;(10) è¡¨ç¤º elementData åˆå§‹å®¹é‡ä¸º10ï¼Œæ‰€ä»¥ elementData.length = 10 è€Œæˆ‘ä»¬åªç»™é›†åˆæ·»åŠ äº†ä¸¤ä¸ªå…ƒç´ æ‰€ä»¥ size = 2 è¿™ä¹Ÿå°±æ˜¯ä¸ºå•¥è¦ rangeCheck çš„åŸå› äº†ã€‚ ç§»é™¤æŒ‡å®šå…ƒç´ 1234567891011121314151617181920212223242526272829303132333435/*** åˆ é™¤æŒ‡å®šå…ƒç´ ï¼Œå¦‚æœå®ƒå­˜åœ¨åˆ™åä¼š trueï¼Œå¦‚æœä¸å­˜åœ¨è¿”å› falseã€‚* æ›´å‡†ç¡®åœ°è¯´æ˜¯åˆ é™¤é›†åˆä¸­ç¬¬ä¸€å‡ºç° o å…ƒç´ ä½ç½®çš„å…ƒç´  ï¼Œ* ä¹Ÿå°±æ˜¯è¯´åªä¼šåˆ é™¤ä¸€ä¸ªï¼Œå¹¶ä¸”å¦‚æœæœ‰é‡å¤çš„è¯ï¼Œåªä¼šåˆ é™¤ç¬¬ä¸€ä¸ªæ¬¡å‡ºç°çš„ä½ç½®ã€‚*/public boolean remove(Object o) &#123; // å¦‚æœå…ƒç´ ä¸ºç©ºåˆ™åªéœ€åˆ¤æ–­ == ä¹Ÿå°±æ˜¯å†…å­˜åœ°å€ if (o == null) &#123; for (int index = 0; index &lt; size; index++) if (elementData[index] == null) &#123; //å¾—åˆ°ç¬¬ä¸€ä¸ªç­‰äº null çš„å…ƒç´ è§’æ ‡å¹¶ç§»é™¤è¯¥å…ƒç´  è¿”å› ture fastRemove(index); return true; &#125; &#125; else &#123; // å¦‚æœå…ƒç´ ä¸ä¸ºç©ºåˆ™éœ€è¦ç”¨ equals åˆ¤æ–­ã€‚ for (int index = 0; index &lt; size; index++) if (o.equals(elementData[index])) &#123; //å¾—åˆ°ç¬¬ä¸€ä¸ªç­‰äº o çš„å…ƒç´ è§’æ ‡å¹¶ç§»é™¤è¯¥å…ƒç´  è¿”å› ture fastRemove(index); return true; &#125; &#125; return false;&#125;//ç§»é™¤å…ƒç´ çš„é€»è¾‘å’Œ remve(Index)ä¸€æ · private void fastRemove(int index) &#123; modCount++; int numMoved = size - index - 1; if (numMoved &gt; 0) System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; // clear to let GC do its work&#125; ç”±ä¸Šè¾¹ä»£ç å¯ä»¥çœ‹å‡ºæ¥ï¼Œç§»é™¤å…ƒç´ å’Œç§»é™¤æŒ‡å®šè§’æ ‡å…ƒç´ ä¸€æ ·æœ€ç»ˆéƒ½æ˜¯é€šè¿‡ System.arraycopy å°† index ä¹‹åçš„å…ƒç´ å‰ç§»ä¸€ä½ï¼Œå¹¶é‡Šæ”¾åŸæ¥ä½äº size ä½ç½®çš„å…ƒç´ ã€‚ è¿˜å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæ•°ç»„ä¸­æœ‰æŒ‡å®šå¤šä¸ªä¸ o ç›¸åŒçš„å…ƒç´ åªä¼šç§»é™¤è§’æ ‡æœ€å°çš„é‚£ä¸ªï¼Œå¹¶ä¸” null å’Œ énull çš„æ—¶å€™åˆ¤æ–­æ–¹æ³•ä¸ä¸€æ ·ã€‚è‡³äº equals å’Œ == çš„åŒºåˆ«ï¼Œè¿˜æœ‰ hashCode æ–¹æ³•ï¼Œæˆ‘ä¼šä¹‹ååœ¨æ€»ç»“ä¸€ç¯‡å•ç‹¬çš„æ–‡ç« ã€‚ç­‰ä¸æ€¥çš„å¯ä»¥å…ˆå»ç½‘ä¸Šæ‰¾æ‰¾å–½ã€‚ æ³¨æ„ï¼Œä»¥ä¸‹å‡ ç‚¹ï¼š Integer é‡å†™çš„ equals æ–¹æ³•æœ‰è‡ªåŠ¨æ‹†ç®±ï¼› equalså¦‚æœä¸é‡å†™ï¼Œé‚£è·Ÿ == æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœè¦é‡å†™ï¼Œå¿…é¡» equal å’Œ hashcode éƒ½é‡å†™ï¼› æœ€å¥½çš„ä¾‹å­å°±æ˜¯ HashSetï¼Œå¦‚æœkeyä¸é‡å†™ hashcode()ï¼Œé‚£å¯èƒ½equalsç›¸ç­‰ä½†æ˜¯ä¼šå¯¼è‡´å­˜å…¥ä¸¤ä¸ªä¸€æ ·çš„ã€‚ æ‰¹é‡ç§»é™¤/ä¿ç•™ removeAll/retainAllArrayList æä¾›äº† removeAll/retainAll æ“ä½œï¼Œè¿™ä¸¤ä¸ªæ“ä½œåˆ†åˆ«æ˜¯ æ‰¹é‡åˆ é™¤ä¸å‚æ•°é›†åˆä¸­å…±åŒäº«æœ‰çš„å…ƒç´  å’Œ æ‰¹é‡åˆ é™¤ä¸å‚æ•°é›†åˆä¸­ä¸å…±åŒäº«æœ‰çš„å…ƒç´ ï¼Œä¿ç•™å…±åŒäº«æœ‰çš„å…ƒç´ ï¼Œä¸¤ä¸ªæ–¹æ³•åªæœ‰ä¸€ä¸ªå‚æ•°ä¸åŒ!!! 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** æ‰¹é‡åˆ é™¤ä¸å‚æ•°é›†åˆä¸­å…±åŒäº«æœ‰çš„å…ƒç´ */public boolean removeAll(Collection&lt;?&gt; c) &#123; //åˆ¤ç©º å¦‚æœä¸ºç©ºåˆ™æŠ›å‡º NullPointerException å¼‚å¸¸ Objects çš„æ–¹æ³• Objects.requireNonNull(c); return batchRemove(c, false);&#125; /** åªä¿ç•™ä¸ c ä¸­å…ƒç´ ç›¸åŒçš„å…ƒç´ ç›¸åŒçš„å…ƒç´ */public boolean retainAll(Collection&lt;?&gt; c) &#123; Objects.requireNonNull(c); return batchRemove(c, true);&#125; /** æ‰¹é‡åˆ é™¤çš„æŒ‡å®šæ–¹æ³• */private boolean batchRemove(Collection&lt;?&gt; c, boolean complement) &#123; final Object[] elementData = this.elementData; // r w ä¸¤ä¸ªè§’æ ‡ r ä¸º elementData ä¸­å…ƒç´ çš„ç´¢å¼• // w ä¸ºåˆ é™¤å…ƒç´ åé›†åˆçš„é•¿åº¦ int r = 0, w = 0; boolean modified = false; try &#123; for (; r &lt; size; r++) // å¦‚æœ c å½“å‰é›†åˆä¸­ä¸åŒ…å«å½“å‰å…ƒç´ ï¼Œé‚£ä¹ˆåˆ™ä¿ç•™ if (c.contains(elementData[r]) == complement) elementData[w++] = elementData[r]; &#125; finally &#123; // å¦‚æœc.containsï¼ˆoï¼‰å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæŠ›å‡ºå¼‚å¸¸å r!=size åˆ™å°† r ä¹‹åçš„å…ƒç´ ä¸åœ¨æ¯”è¾ƒç›´æ¥æ”¾å…¥æ•°ç»„ if (r != size) &#123; System.arraycopy(elementData, r, elementData, w, size - r); // w åŠ ä¸Šå‰©ä½™å…ƒç´ çš„é•¿åº¦ w += size - r; &#125; // å¦‚æœé›†åˆç§»é™¤è¿‡å…ƒç´ ï¼Œåˆ™éœ€è¦å°† w ä¹‹åçš„å…ƒç´ è®¾ç½®ä¸º null é‡Šæ”¾å†…å­˜ if (w != size) &#123; // clear to let GC do its work for (int i = w; i &lt; size; i++) elementData[i] = null; modCount += size - w; size = w; modified = true; &#125; &#125; //è¿”å›æ˜¯å¦æˆåŠŸç§»é™¤è¿‡å…ƒç´ ï¼Œå“ªæ€•ä¸€ä¸ª return modified;&#125; å¯ä»¥çœ‹åˆ°ç§»é™¤æŒ‡å®šé›†åˆä¸­åŒ…å«çš„å…ƒç´ çš„æ–¹æ³•ä»£ç é‡æ˜¯ç›®å‰åˆ†æä»£ç ä¸­æœ€é•¿çš„äº†ï¼Œä½†æ˜¯é€»è¾‘ä¹Ÿå¾ˆæ¸…æ™°ï¼š ä» 0 å¼€å§‹éå† elementData å¦‚æœ r ä½ç½®çš„å…ƒç´ ä¸å­˜åœ¨äºæŒ‡å®šé›†åˆ c ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°†ä»–å¤åˆ¶ç»™æ•°ç»„ w ä½ç½®ï¼Œ æ•´ä¸ªéå†è¿‡ç¨‹ä¸­ w &lt;= rã€‚ ç”±äº c.contains(o)å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ClassCastException/NullPointerExceptionï¼Œå¦‚æœå› ä¸ºå¼‚å¸¸è€Œç»ˆæ­¢ï¼ˆè¿™ä¸¤ä¸ªå¼‚å¸¸æ˜¯å¯é€‰æ“ä½œï¼Œé›†åˆæºç ä¸­å¹¶æ²¡æœ‰æ˜¾ç¤ºç”Ÿå‘½è¯¥æ–¹æ³•ä¸€å®šä¼šæŠ›å¼‚å¸¸ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä¼šäº§ç”Ÿä¸€æ¬¡é”™è¯¯æ“ä½œï¼Œæ‰€ä»¥ finally ä¸­æ‰§è¡Œäº†åˆ¤æ–­æ“ä½œï¼Œå¦‚æœ r!= size é‚£ä¹ˆè‚¯å®šæ˜¯å‘ç”Ÿäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆåˆ™å°† r ä¹‹åçš„å…ƒç´ ä¸åœ¨æ¯”è¾ƒç›´æ¥æ”¾å…¥æ•°ç»„ã€‚æœ€ç»ˆå¾—åˆ°çš„ç»“æœå¹¶ä¸ä¸€å®šæ­£ç¡®æ˜¯åˆ é™¤äº†æ‰€æœ‰ä¸ c ä¸­çš„å…ƒç´ ã€‚ æ‰¹é‡åˆ é™¤å’Œä¿å­˜ä¸­ï¼Œæ¶‰åŠé«˜æ•ˆçš„ä¿å­˜/åˆ é™¤ä¸¤ä¸ªé›†åˆå…¬æœ‰å…ƒç´ çš„ç®—æ³•ï¼Œæ˜¯å€¼å¾—æˆ‘ä»¬å­¦ä¹ çš„åœ°æ–¹,å†™çš„çœŸå¥½å“ˆå“ˆå“ˆå“ˆå“ˆï¼ï¼ï¼ ArrayList çš„æ”¹æŸ¥å¯¹äºä¸€ä¸ªArrayList çš„æ”¹æŸ¥æ–¹æ³•å°±å¾ˆç®€å•äº†ï¼Œset å’Œ get æ–¹æ³•ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹æºç å§ï¼š ä¿®æ”¹æŒ‡å®šè§’æ ‡ä½ç½®çš„å…ƒç´ 1234567891011121314public E set(int index, E element) &#123; //è§’æ ‡è¶Šç•Œæ£€æŸ¥ rangeCheck(index); //ä¸‹æ ‡å–æ•°æ®æ³¨æ„è¿™é‡Œä¸æ˜¯elementData[index] è€Œæ˜¯ elementData(index) æ–¹æ³• E oldValue = elementData(index); //å°† index ä½ç½®è®¾ç½®ä¸ºæ–°çš„å…ƒç´  elementData[index] = element; // è¿”å›ä¹‹å‰åœ¨ index ä½ç½®çš„å…ƒç´  return oldValue;&#125;E elementData(int index) &#123; return (E) elementData[index];&#125; æŸ¥è¯¢æŒ‡å®šè§’æ ‡çš„å…ƒç´ 123456public E get(int index) &#123; //è¶Šç•Œæ£€æŸ¥ rangeCheck(index); //ä¸‹æ ‡å–æ•°æ®æ³¨æ„è¿™é‡Œä¸æ˜¯elementData[index] è€Œæ˜¯ elementData(index) æ–¹æ³• return elementData(index); &#125; æŸ¥è¯¢æŒ‡å®šå…ƒç´ çš„è§’æ ‡æˆ–è€…é›†åˆæ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ 12345678910111213141516171819202122232425262728293031323334353637//é›†åˆä¸­æ˜¯å¦åŒ…å«å…ƒç´  indexOf è¿”å› -1 è¡¨ç¤ºä¸åŒ…å« return false å¦åˆ™è¿”å› truepublic boolean contains(Object o) &#123; return indexOf(o) &gt;= 0;&#125;/*** è¿”å›é›†åˆä¸­ç¬¬ä¸€ä¸ªä¸ o å…ƒç´ ç›¸ç­‰çš„å…ƒç´ è§’æ ‡ï¼Œè¿”å› -1 è¡¨ç¤ºé›†åˆä¸­ä¸å­˜åœ¨è¿™ä¸ªå…ƒç´ * è¿™é‡Œè¿˜åšäº†ç©ºå…ƒç´ ç›´æ¥åˆ¤æ–­ == çš„æ“ä½œ*/public int indexOf(Object o) &#123; if (o == null) &#123; for (int i = 0; i &lt; size; i++) if (elementData[i]==null) return i; &#125; else &#123; for (int i = 0; i &lt; size; i++) if (o.equals(elementData[i])) return i; &#125; return -1;&#125;/** * ä» elementData æœ«å°¾å¼€å§‹éå†éå†æ•°ç»„ï¼Œæ‰€ä»¥è¿”å›çš„æ˜¯é›†åˆä¸­æœ€åä¸€ä¸ªä¸ o ç›¸ç­‰çš„å…ƒç´ çš„è§’æ ‡*/public int lastIndexOf(Object o) &#123; if (o == null) &#123; for (int i = size-1; i &gt;= 0; i--) if (elementData[i]==null) return i; &#125; else &#123; for (int i = size-1; i &gt;= 0; i--) if (o.equals(elementData[i])) return i; &#125; return -1;&#125; ArrayList é›†åˆçš„ toArry æ–¹æ³•å…¶å® Object[] toArray(); æ–¹æ³•ï¼Œä»¥åŠå…¶é‡è½½å‡½æ•° \ T[] toArray(T[] a); æ˜¯æ¥å£ Collection çš„æ–¹æ³•ï¼ŒArrayList å®ç°äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå¾ˆå°‘è§ArrayList æºç åˆ†æçš„æ–‡ç« åˆ†æè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰è¿™ä¸¤ä¸ªæ–¹æ³•çš„æ˜¯ç”¨æ¥ï¼Œå°†ä¸€ä¸ªé›†åˆè½¬ä¸ºæ•°ç»„çš„æ–¹æ³•ï¼Œé‚£ä¹ˆä¸¤è€…çš„ä¸åŒä¹‹å¤„æ˜¯ï¼Œåè€…å¯ä»¥æŒ‡å®šæ•°ç»„çš„ç±»å‹ï¼Œå‰è€…è¿”å›ä¸ºä¸€ä¸ª Object[] è¶…ç±»æ•°ç»„ã€‚é‚£ä¹ˆæˆ‘ä»¬å…·ä½“ä¸‹æºç å®ç°ï¼š 1234567891011121314public Object[] toArray() &#123; return Arrays.copyOf(elementData, size);&#125;@SuppressWarnings("unchecked")public &lt;T&gt; T[] toArray(T[] a) &#123; if (a.length &lt; size) // Make a new array of a's runtime type, but my contents: return (T[]) Arrays.copyOf(elementData, size, a.getClass()); System.arraycopy(elementData, 0, a, 0, size); if (a.length &gt; size) a[size] = null; return a;&#125; å¯ä»¥çœ‹åˆ° Object[] toArray() åªæ˜¯è°ƒç”¨äº†ä¸€æ¬¡ Arrays.copyOf() å°†é›†åˆä¸­å…ƒç´ æ‹·è´åˆ°ä¸€ä¸ªæ–°çš„ Object[] æ•°ç»„å¹¶è¿”å›ã€‚è¿™ä¸ª Arrays.copyOf() æ–¹æ³•å‰è¾¹å·²ç»è®²äº†ã€‚æ‰€ä»¥ toArray() æ–¹æ³•å¹¶æ²¡æœ‰ä»€ä¹ˆç–‘é—®ï¼Œæœ‰ç–‘é—®çš„åœ°æ–¹åœ¨äºtoArray(T[] a) ã€‚ æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªæŒ‡å®šç±»å‹çš„æ ‡å¿—æ•°ç»„ä½œä¸ºå‚æ•°ï¼ŒtoArray(T[] a) æ–¹æ³•æœ€ç»ˆä¼šè¿”å›è¿™ä¸ªç±»å‹çš„åŒ…å«é›†åˆå…ƒç´ çš„æ–°æ•°ç»„ã€‚ä½†æ˜¯æºç åˆ¤æ–­äº† ï¼š å¦‚æœ a.length &lt; size å³å½“å‰é›†åˆå…ƒç´ çš„ä¸ªæ•°ä¸å‚æ•° a æ•°ç»„å…ƒç´ çš„å¤§å°çš„æ—¶å€™å°†å’Œ toArray() ä¸€æ ·è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚ å¦‚æœ a.length == size å°†ä¸ä¼šäº§ç”Ÿæ–°çš„æ•°ç»„ç›´æ¥å°†é›†åˆä¸­çš„å…ƒç´ è°ƒç”¨ System.arraycopy() æ–¹æ³•å°†å…ƒç´ å¤åˆ¶åˆ°å‚æ•°æ•°ç»„ä¸­ï¼Œè¿”å› aã€‚ a.length &gt; size ä¹Ÿä¸ä¼šäº§ç”Ÿæ–°çš„æ•°ç»„,ä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯ a[size] = null; è¿™ä¸€å¥æ”¹å˜äº†åŸæ•°ç»„ä¸­ index = size ä½ç½®çš„å…ƒç´ ï¼Œè¢«é‡æ–°è®¾ç½®ä¸º null äº†ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹ç¬¬ä¸‰ç§æƒ…å†µçš„ä¾‹å­ï¼š 12345678910111213141516171819202122232425SubClass[] sourceMore = new SubClass[4]; for (int i = 0; i &lt; sourceMore.length; i++) &#123; sourceMore[i] = new SubClass(i);&#125; //å½“ List.toArray(T[] a) ä¸­ a.length == list.size çš„æ—¶å€™ä½¿ç”¨ Array.copyOf ä¼šå°† list ä¸­çš„å†…å®¹èµ‹å€¼ç»™ sourceMore å¹¶å°†å…¶è¿”å›//sourceMore[0,size-1] = list&#123;0, size-1&#125; è€Œ sourceMore[size] = nullSubClass[] sourceMore = new SubClass[4];for (int i = 0; i &lt; sourceMore.length; i++) &#123; sourceMore[i] = new SubClass(i);&#125;//list to Array ä¹‹å‰ sourceMore [SubClass&#123;test=0&#125;, SubClass&#123;test=1&#125;, SubClass&#123;test=2&#125;, SubClass&#123;test=3&#125;] sourceEqual.length:: 4System.out.println("list to Array ä¹‹å‰ sourceMore " + Arrays.toString(sourceMore) + " sourceEqual.length:: " + sourceMore.length);SubClass[] desSourceMore = tLists.toArray(sourceMore);//list to Array ä¹‹å desSourceMore [SubClass&#123;test=1&#125;, SubClass&#123;test=2&#125;, null, SubClass&#123;test=3&#125;]desSourceMore.length:: 4System.out.println("list to Array ä¹‹å desSourceMore " + Arrays.toString(desSourceMore) + "desSourceMore.length:: " + desSourceMore.length);//list to Array ä¹‹å source [SubClass&#123;test=1&#125;, SubClass&#123;test=2&#125;, null, SubClass&#123;test=3&#125;]sourceEqual.length:: 4System.out.println("list to Array ä¹‹å source " + Arrays.toString(sourceMore) + "sourceEqual.length:: " + sourceMore.length);//source == desSource trueSystem.out.println("source == desSource " + (sourceMore == desSourceMore)); ArrayList çš„éå†ArrayList çš„éå†æ–¹å¼ jdk 1.8 ä¹‹å‰æœ‰ä¸‰ç§ ï¼šfor å¾ªç¯éå†ï¼Œ foreach éå†ï¼Œè¿­ä»£å™¨éå†,jdk 1.8 ä¹‹ååˆå¼•å…¥äº†forEach æ“ä½œï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿­ä»£å™¨çš„æºç å®ç°ï¼š è¿­ä»£å™¨è¿­ä»£å™¨ Iterator æ¨¡å¼æ˜¯ç”¨äºéå†å„ç§é›†åˆç±»çš„æ ‡å‡†è®¿é—®æ–¹æ³•ã€‚å®ƒå¯ä»¥æŠŠè®¿é—®é€»è¾‘ä»ä¸åŒç±»å‹çš„é›†åˆç±»ä¸­æŠ½è±¡å‡ºæ¥ï¼Œä»è€Œé¿å…å‘å®¢æˆ·ç«¯æš´éœ²é›†åˆçš„å†…éƒ¨ç»“æ„ã€‚ ArrayList ä½œä¸ºé›†åˆç±»ä¹Ÿä¸ä¾‹å¤–ï¼Œè¿­ä»£å™¨æœ¬èº«åªæä¾›ä¸‰ä¸ªæ¥å£æ–¹æ³•ï¼š 12345public interface Iterator &#123; boolean hasNext();//æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´  Object next();// è¿”å›å½“å‰å…ƒç´  å¯ä»¥ç†è§£ä¸ºä»–ç›¸å½“äº fori ä¸­ i ç´¢å¼• void remove();// ç§»é™¤ä¸€ä¸ªå½“å‰çš„å…ƒç´  ä¹Ÿå°±æ˜¯ next å…ƒç´ ã€‚ &#125; ArrayList ä¸­è°ƒç”¨ iterator() å°†ä¼šè¿”å›ä¸€ä¸ªå†…éƒ¨ç±»å¯¹è±¡ Itr å…¶å®ç°äº† Iterator æ¥å£ã€‚ 123public Iterator&lt;E&gt; iterator() &#123; return new Itr();&#125; ä¸‹é¢è®©æˆ‘ä»¬çœ‹ä¸‹å…¶å®ç°çš„æºç ï¼š æ­£å¦‚æˆ‘ä»¬çš„ for å¾ªç¯éå†ä¸€æ ·ï¼Œæ•°ç»„è§’æ ‡æ€»æ˜¯ä» 0 å¼€å§‹çš„ï¼Œæ‰€ä»¥ cursor åˆå§‹å€¼ä¸º 0 ï¼Œ hasNext è¡¨ç¤ºæ˜¯å¦éå†åˆ°æ•°ç»„æœ«å°¾ï¼Œå³ i &lt; size ã€‚å¯¹äº modCount å˜é‡ä¹‹æ‰€ä»¥ä¸€ç›´æ²¡æœ‰ä»‹ç»æ˜¯å› ä¸ºä»–é›†åˆå¹¶å‘è®¿é—®æœ‰å…³ç³»ï¼Œç”¨äºæ ‡è®°å½“å‰é›†åˆè¢«ä¿®æ”¹ï¼ˆå¢åˆ ï¼‰çš„æ¬¡æ•°ï¼Œå¦‚æœå¹¶å‘è®¿é—®äº†é›†åˆé‚£ä¹ˆå°†ä¼šå¯¼è‡´è¿™ä¸ª modCount çš„å˜åŒ–ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­ä¸æ­£ç¡®çš„æ“ä½œé›†åˆå°†ä¼šæŠ›å‡º ConcurrentModificationException ï¼Œè¿™æ˜¯ Java ã€Œfail-fast çš„æœºåˆ¶ã€ï¼Œå¯¹äºå¦‚ä½•æ­£ç¡®çš„åœ¨éå†è¿‡ç¨‹ä¸­æ“ä½œé›†åˆç¨åä¼šæœ‰è¯´æ˜ã€‚ 12345678private class Itr implements Iterator&lt;E&gt; &#123; int cursor; // å¯¹ç…§ hasNext æ–¹æ³• cursor åº”ç†è§£ä¸ºä¸‹ä¸ªè°ƒç”¨ next è¿”å›çš„å…ƒç´  åˆå§‹ä¸º 0 int lastRet = -1; // ä¸Šä¸€ä¸ªè¿”å›çš„è§’æ ‡ int expectedModCount = modCount;//åˆå§‹åŒ–çš„æ—¶å€™å°†å…¶èµ‹å€¼ä¸ºå½“å‰é›†åˆä¸­çš„æ“ä½œæ•°ï¼Œ // æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´  cursor == size è¡¨ç¤ºå½“å‰é›†åˆå·²ç»éå†å®Œäº† æ‰€ä»¥åªæœ‰å½“ cursor ä¸ç­‰äº size çš„æ—¶å€™ æ‰ä¼šæœ‰ä¸‹ä¸€ä¸ªå…ƒç´  public boolean hasNext() &#123; return cursor != size; &#125; next æ–¹æ³•æ˜¯æˆ‘ä»¬è·å–é›†åˆä¸­å…ƒç´ çš„æ–¹æ³•ï¼Œnext è¿”å›å½“å‰éå†ä½ç½®çš„å…ƒç´ ï¼Œå¦‚æœåœ¨è°ƒç”¨ next ä¹‹å‰é›†åˆè¢«ä¿®æ”¹ï¼Œå¹¶ä¸”è¿­ä»£å™¨ä¸­çš„æœŸæœ›æ“ä½œæ•°å¹¶æ²¡æœ‰æ”¹å˜ï¼Œå°†ä¼šå¼•å‘ConcurrentModificationExceptionã€‚next æ–¹æ³•å¤šæ¬¡è°ƒç”¨ checkForComodification æ¥æ£€éªŒè¿™ä¸ªæ¡ä»¶æ˜¯å¦æˆç«‹ã€‚ 1234567891011121314151617@SuppressWarnings("unchecked") public E next() &#123; // éªŒè¯æœŸæœ›çš„æ“ä½œæ•°ä¸å½“å‰é›†åˆä¸­çš„æ“ä½œæ•°æ˜¯å¦ç›¸åŒ å¦‚æœä¸åŒå°†ä¼šæŠ›å‡ºå¼‚å¸¸ checkForComodification(); // å¦‚æœè¿­ä»£å™¨çš„ç´¢å¼•å·²ç»å¤§äºé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™é‡Œä¸æŠ›å‡ºè§’æ ‡è¶Šç•Œ int i = cursor; if (i &gt;= size) throw new NoSuchElementException(); Object[] elementData = ArrayList.this.elementData; // ç”±äºå¤šçº¿ç¨‹çš„é—®é¢˜è¿™é‡Œå†æ¬¡åˆ¤æ–­æ˜¯å¦è¶Šç•Œï¼Œå¦‚æœæœ‰å¼‚æ­¥çº¿ç¨‹ä¿®æ”¹äº†Listï¼ˆå¢åˆ ï¼‰è¿™é‡Œå°±å¯èƒ½äº§ç”Ÿå¼‚å¸¸ if (i &gt;= elementData.length) throw new ConcurrentModificationException(); // cursor ç§»åŠ¨ cursor = i + 1; //æœ€ç»ˆè¿”å› é›†åˆä¸­å¯¹åº”ä½ç½®çš„å…ƒç´ ï¼Œå¹¶å°† lastRet èµ‹å€¼ä¸ºå·²ç»è®¿é—®çš„å…ƒç´ çš„ä¸‹æ ‡ return (E) elementData[lastRet = i]; &#125; åªæœ‰ Iterator çš„ remove æ–¹æ³•ä¼šåœ¨è°ƒç”¨é›†åˆçš„ remove ä¹‹åè®© æœŸæœ› æ“ä½œæ•°æ”¹å˜ä½¿expectedModCountä¸ modCount å†ç›¸ç­‰ï¼Œæ‰€ä»¥æ˜¯å®‰å…¨çš„ã€‚ 12345678910111213141516171819202122// å®è´¨è°ƒç”¨äº†é›†åˆçš„ remove æ–¹æ³•ç§»é™¤å…ƒç´ public void remove() &#123; // æ¯”å¦‚æ“ä½œè€…æ²¡æœ‰è°ƒç”¨ next æ–¹æ³•å°±è°ƒç”¨äº† remove æ“ä½œï¼ŒlastRet ç­‰äº -1çš„æ—¶å€™æŠ›å¼‚å¸¸ if (lastRet &lt; 0) throw new IllegalStateException(); //æ£€æŸ¥æ“ä½œæ•° checkForComodification(); try &#123; //ç§»é™¤ä¸Šæ¬¡è°ƒç”¨ next è®¿é—®çš„å…ƒç´  ArrayList.this.remove(lastRet); // é›†åˆä¸­å°‘äº†ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥ cursor å‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼ˆè°ƒç”¨ next æ—¶å€™ cursor = lastRet + 1ï¼‰ cursor = lastRet; //åˆ é™¤å…ƒç´ åèµ‹å€¼-1ï¼Œç¡®ä¿å…ˆå‰ remove æ—¶å€™çš„åˆ¤æ–­ lastRet = -1; //ä¿®æ”¹æ“ä½œæ•°æœŸæœ›å€¼ï¼Œ modCount åœ¨è°ƒç”¨é›†åˆçš„ remove çš„æ—¶å€™è¢«ä¿®æ”¹è¿‡äº†ã€‚ expectedModCount = modCount; &#125; catch (IndexOutOfBoundsException ex) &#123; // é›†åˆçš„ remove ä¼šæœ‰å¯èƒ½æŠ›å‡º rangeCheck å¼‚å¸¸ï¼Œcatch æ‰ç»Ÿä¸€æŠ›å‡º ConcurrentModificationException throw new ConcurrentModificationException(); &#125; &#125; æ£€æŸ¥æœŸæœ›çš„æ“ä½œæ•°ä¸å½“å‰é›†åˆçš„æ“ä½œæ•°æ˜¯å¦ç›¸åŒã€‚Java8 å‘å¸ƒäº†å¾ˆå¤šå‡½æ•°å¼ç¼–ç¨‹çš„ç‰¹æ€§åŒ…æ‹¬ lamada å’ŒStream æ“ä½œã€‚è¿­ä»£å™¨ä¹Ÿå› æ­¤æ·»åŠ äº† forEachRemaining æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥å°†å½“å‰è¿­ä»£å™¨è®¿é—®çš„å…ƒç´ ï¼ˆnext æ–¹æ³•ï¼‰åçš„å…ƒç´ ä¼ é€’å‡ºå»è¿˜æ²¡ç”¨åˆ°è¿‡ï¼Œæºç å°±ä¸æ”¾å‡ºæ¥äº†,å¤§å®¶æœ‰å…´è¶£è‡ªå·±äº†è§£ä¸‹ã€‚ 1234567891011 @Override @SuppressWarnings("unchecked")public void forEachRemaining(Consumer&lt;? super E&gt; consumer) &#123; //... Java8 çš„æ–°ç‰¹æ€§ï¼Œå¯ä»¥å°†å½“å‰è¿­ä»£å™¨è®¿é—®çš„å…ƒç´ ï¼ˆnext æ–¹æ³•ï¼‰åçš„å…ƒç´ ä¼ é€’å‡ºå»è¿˜æ²¡ç”¨åˆ°è¿‡ï¼Œæºç å°±ä¸æ”¾å‡ºæ¥äº†,å¤§å®¶æœ‰å…´è¶£è‡ªå·±äº†è§£ä¸‹ã€‚ &#125; // æ£€æŸ¥æœŸæœ›çš„æ“ä½œæ•°ä¸å½“å‰é›†åˆçš„æ“ä½œæ•°æ˜¯å¦ç›¸åŒ final void checkForComodification() &#123; if (modCount != expectedModCount) throw new ConcurrentModificationException(); &#125;&#125; ListIterator è¿­ä»£å™¨ArrayList å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è·å– ListIterator è¿­ä»£å™¨ï¼ŒåŒºåˆ«åœ¨äºåˆå§‹è§’æ ‡çš„ä½ç½®ã€‚ä¸å¸¦å‚æ•°çš„è¿­ä»£å™¨é»˜è®¤çš„cursor = 0 123456789public ListIterator&lt;E&gt; listIterator(int index) &#123; if (index &lt; 0 || index &gt; size) throw new IndexOutOfBoundsException("Index: "+index); return new ListItr(index);&#125; public ListIterator&lt;E&gt; listIterator() &#123; return new ListItr(0);&#125; ListItrå¯¹è±¡ç»§æ‰¿è‡ªå‰è¾¹åˆ†æçš„ Itrï¼Œä¹Ÿå°±æ˜¯è¯´ä»–æ‹¥æœ‰ Itr çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•ï¼Œå…¶æ‰©å±•äº†è®¿é—®å½“å‰è§’æ ‡å‰ä¸€ä¸ªå…ƒç´ çš„æ–¹æ³•ã€‚ä»¥åŠåœ¨éå†è¿‡ç¨‹ä¸­æ·»åŠ å…ƒç´ å’Œä¿®æ”¹å…ƒç´ çš„æ–¹æ³•ã€‚ ListItr çš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š 12345private class ListItr extends Itr implements ListIterator&lt;E&gt; &#123; ListItr(int index) &#123; super(); cursor = index;&#125; ListItr çš„ previous æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930public boolean hasPrevious() &#123; // cursor = 0 è¡¨ç¤ºæ¸¸æ ‡åœ¨æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å·¦è¾¹ï¼Œæ­¤æ—¶ `hasPrevious` è¿”å›false return cursor != 0;&#125;public int nextIndex() &#123; return cursor;//è°ƒç”¨è¿”å›å½“å‰è§’æ ‡ä½ç½®&#125;public int previousIndex() &#123; return cursor - 1;//è°ƒç”¨è¿”å›ä¸Šä¸€ä¸ªè§’æ ‡&#125;//è¿”å›å½“å‰è§’æ ‡çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å‰ç§»ç§»åŠ¨è§’æ ‡@SuppressWarnings("unchecked")public E previous() &#123; // fast-fail æ£€æŸ¥ checkForComodification(); int i = cursor - 1; // å¦‚æœå‰ç§»è§’æ ‡ &lt;0 ä»£è¡¨éå†åˆ°æ•°ç»„éå†å®Œæˆï¼Œä¸€èˆ¬åœ¨è°ƒç”¨ previous è¦è°ƒç”¨ hasPrevious åˆ¤æ–­ if (i &lt; 0) throw new NoSuchElementException(); //è·å–å…ƒç´  Object[] elementData = ArrayList.this.elementData; if (i &gt;= elementData.length) throw new ConcurrentModificationException(); //è·å–æˆåŠŸåä¿®æ”¹è§’æ ‡ä½ç½®å’Œ lastRet ä½ç½® cursor = i; return (E) elementData[lastRet = i];&#125; ListItr çš„ add æ–¹æ³• 1234567891011121314151617public void add(E e) &#123; // fast-fail æ£€æŸ¥ checkForComodification(); try &#123; // è·å–å½“å‰è§’æ ‡ä½ç½®ï¼Œä¸€èˆ¬çš„æ˜¯è°ƒç”¨ previous åï¼Œè§’æ ‡æ”¹å˜ååå» cursor int i = cursor; //æ·»åŠ å…ƒç´ åœ¨è§’æ ‡ä½ç½® ArrayList.this.add(i, e); //é›†åˆä¿®æ”¹å®Œæˆåè¦æ”¹å˜å½“å‰è§’æ ‡ä½ç½® cursor = i + 1; //é‡æ–°ç½®ä½ -1 å¦‚æœä½¿ç”¨è¿­ä»£å™¨ä¿®æ”¹äº†è§’æ ‡ä½ç½®å…ƒç´ åä¸å…è®¸ç«‹åˆ»ä½¿ç”¨ set æ–¹æ³•ä¿®æ”¹ä¿®æ”¹åè§’æ ‡æœªçŸ¥çš„é¢å…ƒç´  å‚è€ƒ set çš„æºä»£ç  lastRet = -1; expectedModCount = modCount; &#125; catch (IndexOutOfBoundsException ex) &#123; throw new ConcurrentModificationException(); &#125;&#125; å¯èƒ½å¯¹æ¯”ä¸¤ä¸ªè¿­ä»£å™¨åï¼Œä¼šå¯¹ cursor æŒ‡å‘çš„ä½ç½®æœ‰æ‰€ç–‘æƒ‘ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸€æ®µç¤ºä¾‹ä»£ç å¯¹åº”çš„å›¾ï¼š 1234567891011121314151617181920private void testListItr()&#123; ArrayList&lt;Integer&gt; list = new ArrayList&lt;&gt;(); list.add(1); list.add(2); list.add(3); list.add(4); ListIterator&lt;Integer&gt; listIterator = list.listIterator(list.size()); while (listIterator.hasPrevious())&#123; if (listIterator.previous() == 2)&#123; listIterator.add(0); // listIterator.set(10); //Exception in thread "main" java.lang.IllegalStateException &#125; &#125; System.out.println("list " + list.toString());&#125; ç”±æ­¤å¯ä»¥çœ‹ cursor äº æ•°ç»„è§’æ ‡ä¸åŒï¼Œå®ƒå¯ä»¥å¤„çš„ä½ç½®æ€»æ¯”è§’æ ‡å¤šä¸€ä¸ªï¼Œå› ä¸ºåœ¨æˆ‘ä»¬ä½¿ç”¨ Iterator æ“ä½œé›†åˆçš„æ—¶å€™ï¼Œæ€»æ˜¯è¦å…ˆæ“ä½œ cursor ç§»åŠ¨ï¼Œ listIterator.previous ä¹Ÿå¥½ iterator.next() ä¹Ÿå¥½ï¼Œéƒ½æ˜¯ä¸€æ ·çš„é“ç†ï¼Œå¦‚æœä¸æŒ‰ç…§è§„å®šå»è¿›è¡Œæ“ä½œï¼Œå¸¦ç»™ä½¿ç”¨è€…çš„åªæœ‰å¼‚å¸¸ã€‚ java8 æ–°å¢åŠ çš„éå†æ–¹æ³• forEachjava8å¢åŠ å¾ˆå¤šå¥½ç”¨çš„ APIï¼Œå·¥ä½œå’Œå­¦ä¹ ä¸­ä¹Ÿåœ¨æ…¢æ…¢æ¥è§¦è¿™äº› APIï¼ŒforEach æ“ä½œå¯èƒ½æ˜¯æˆ‘ç»§ lambda åï¼Œç¬¬ä¸€ä¸ªä½¿ç”¨çš„ API äº†ï¼ˆå›§ï¼‰ï¼Œjdk doc å¯¹è¿™ä¸ªæ–¹æ³•çš„è§£é‡Šæ˜¯ï¼š å¯¹æ­¤é›†åˆçš„æ¯ä¸ªæ¡ç›®æ‰§è¡Œç»™å®šæ“ä½œï¼Œç›´åˆ°å¤„ç†å®Œæ‰€æœ‰æ¡ç›®æˆ–æ“ä½œæŠ›å‡ºå¼‚å¸¸ä¸ºæ­¢ã€‚ é™¤éå®ç°ç±»å¦æœ‰è§„å®šï¼Œå¦åˆ™æŒ‰ç…§æ¡ç›®é›†è¿­ä»£çš„é¡ºåºæ‰§è¡Œæ“ä½œï¼ˆå¦‚æœæŒ‡å®šäº†è¿­ä»£é¡ºåºï¼‰ã€‚æ“ä½œæŠ›å‡ºçš„å¼‚å¸¸éœ€è¦è°ƒç”¨è€…è‡ªå·±å¤„ç†ã€‚ å…¶å®å…¶å†…éƒ¨å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œåªæ˜¯ä¸€ä¸ªåˆ¤æ–­äº†æ“ä½œæ•°çš„ for å¾ªç¯ï¼Œæ‰€ä»¥åœ¨æ•ˆç‡ä¸Šä¸ä¼šæœ‰æå‡ï¼Œä½†æ˜¯åœ¨å®‰å…¨æ€§ä¸Šçš„ç¡®æœ‰æå‡ï¼Œä¹Ÿå°‘äº›å¾ˆå¤šä»£ç ä¸æ˜¯ä¹ˆï¼Ÿ 1234567891011121314151617@Overridepublic void forEach(Consumer&lt;? super E&gt; action) &#123; //æ£€æŸ¥è°ƒç”¨è€…ä¼ è¿›æ¥çš„æ“ä½œå‡½æ•°æ˜¯å¦ä¸ºç©º Objects.requireNonNull(action); //ä¸è¿­ä»£ä¸åŒæœŸæœ›æ“ä½œè¢«èµ‹å€¼ä¸º final ä¹Ÿå°±æ˜¯ forEach è¿‡ç¨‹ä¸­ä¸å…è®¸å¹¶å‘ä¿®æ”¹é›†åˆå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ final int expectedModCount = modCount; @SuppressWarnings("unchecked") final E[] elementData = (E[]) this.elementData; final int size = this.size; //æ¯æ¬¡å–å…ƒç´ ä¹‹å‰åˆ¤æ–­æ“ä½œæ•°ï¼Œç¡®ä¿æ“ä½œæ­£å¸¸ for (int i=0; modCount == expectedModCount &amp;&amp; i &lt; size; i++) &#123; action.accept(elementData[i]); &#125; if (modCount != expectedModCount) &#123; throw new ConcurrentModificationException(); &#125;&#125; å¯¹äºé«˜çº§ for å¾ªç¯ä»¥åŠæœ€æ™®é€šçš„ fori æ–¹æ³•è¿™é‡Œä¸å†èµ˜è¿°ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹é¢è¯•ä¼šé—®åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åœ¨å•çº¿ç¨‹æ“ä½œé›†åˆçš„æ—¶å€™éœ€è¦æ³¨æ„çš„ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæ­£ç¡®çš„åœ¨éå†è¿‡ç¨‹ä¸­ä¿®æ”¹é›†åˆã€‚ é”™è¯¯æ“ä½œ 1 åœ¨ forå¾ªç¯ä¿®æ”¹é›†åˆåç»§ç»­éå†ç¬¬ä¸€ä¸ªä¾‹å­ï¼š 1234567891011121314List&lt;SubClass&gt; list2 = new ArrayList&lt;&gt;();list2.add(new SubClass(1));list2.add(new SubClass(2));list2.add(new SubClass(3));list2.add(new SubClass(3));for (int i = 0; i &lt; list2.size(); i++) &#123; if (list2.get(i).test == 3) &#123; list2.remove(i); &#125;&#125;System.out.println(list2);//[SubClass&#123;test=1&#125;, SubClass&#123;test=2&#125;, SubClass&#123;test=3&#125;] è¿™ä¸ªä¾‹å­æˆ‘ä»¬ä¼šå‘ç°ï¼Œç¨‹åºå¹¶æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯ä»è¿è¡Œç»è¿‡ä¸Šæ¥çœ‹å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå› ä¸ºè¿˜æœ‰ SubClass.test = 3çš„æ•°æ®åœ¨ï¼Œè¿™æ˜¯å› ä¸º remove æ“ä½œæ”¹å˜äº†list.size(),è€Œ fori ä¸­æ¯æ¬¡æ‰§è¡Œéƒ½ä¼šé‡æ–°è°ƒç”¨ä¸€æ¬¡lists2.size()ï¼Œå½“æˆ‘ä»¬åˆ é™¤äº†å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ åï¼Œlist2.size() = 3,i = 3 &lt; 3 ä¸æˆç«‹åˆ™æ²¡æœ‰åœ¨è¿›è¡Œ remove æ“ä½œï¼ŒçŸ¥é“äº†ä¸ºä»€ä¹ˆä»¥åæˆ‘ä»¬è¯•ç€è¿™æ ·æ”¹å˜äº†å¾ªç¯æ–¹å¼ï¼š 123456789int size = list2.size();for (int i = 0; i &lt; size; i++) &#123; if (list2.get(i).test == 3) &#123; list2.remove(i);//remove ä»¥å list å†…éƒ¨å°† size é‡æ–°æ”¹å˜äº† for å¾ªç¯ä¸‹æ¬¡è°ƒç”¨çš„æ—¶å€™å¯èƒ½å°±ä¸è¿›å»äº† &#125;&#125;System.out.println(list2);//Exception in thread "main" java.lang.IndexOutOfBoundsException: Index: 3, Size: 3 æœçœŸç¨‹åºæŠ›å‡ºäº†è§’æ ‡è¶Šç•Œçš„å¼‚å¸¸ï¼Œå› ä¸ºè¿™æ ·æ¯æ¬¡ fori çš„æ—¶å€™æˆ‘ä»¬ä¸å»æ‹¿æ›´æ–°åçš„ list å…ƒç´ çš„ size å¤§å°ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åˆ é™¤ä¸€ä¸ªå…ƒç´ åï¼Œsize = 3 å½“æˆ‘ä»¬ for å¾ªç¯å»list2.get(3)çš„æ—¶å€™å°±ä¼šè¢« rangeCheckæ–¹æ³•æŠ›å‡ºå¼‚å¸¸ã€‚ é”™è¯¯æ“ä½œå¯¼è‡´ ConcurrentModificationException å¼‚å¸¸æˆ‘ä»¬åˆ†æè¿­ä»£å™¨çš„æ—¶å€™ï¼ŒçŸ¥é“ ConcurrentModificationExceptionæ˜¯æŒ‡å› ä¸ºè¿­ä»£å™¨è°ƒç”¨ checkForComodification æ–¹æ³•æ¯”è¾ƒ modCount å’Œ expectedModCount æ–¹æ³•å¤§å°çš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ã€‚æˆ‘ä»¬åœ¨åˆ†æ ArrayList çš„æ—¶å€™åœ¨æ¯æ¬¡å¯¹é›†åˆè¿›è¡Œä¿®æ”¹ï¼Œ å³æœ‰ add å’Œ remove æ“ä½œçš„æ—¶å€™æ¯æ¬¡éƒ½ä¼šå¯¹ modCount ++ã€‚ modCount è¿™ä¸ªå˜é‡ä¸»è¦ç”¨æ¥è®°å½• ArrayList è¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦è®°å½•è¿™ä¸ªæ¬¡æ•°å‘¢ï¼Ÿæ˜¯ä¸ºäº†é˜²æ­¢å¤šçº¿ç¨‹å¯¹åŒä¸€é›†åˆè¿›è¡Œä¿®æ”¹äº§ç”Ÿé”™è¯¯ï¼Œè®°å½•äº†è¿™ä¸ªå˜é‡ï¼Œåœ¨å¯¹ ArrayList è¿›è¡Œè¿­ä»£çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬èƒ½å¾ˆå¿«çš„å‘ç°è¿™ä¸ªå˜é‡æ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼Œå¦‚æœè¢«ä¿®æ”¹äº† ConcurrentModificationException å°†ä¼šäº§ç”Ÿã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹ä¾‹å­ï¼Œè¿™ä¸ªä¾‹å­å¹¶ä¸æ˜¯åœ¨å¤šçº¿ç¨‹ä¸‹çš„ï¼Œè€Œæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨åŒä¸€çº¿ç¨‹ä¸­å¯¹ list è¿›è¡Œäº†é”™è¯¯æ“ä½œå¯¼è‡´çš„ï¼š 12345678910111213Iterator&lt;SubClass&gt; iterator = lists.iterator();while (iterator.hasNext()) &#123; SubClass next = iterator.next(); int index = next.test; if (index == 3) &#123; list2.remove(index);//æ“ä½œ1ï¼š æ³¨æ„æ˜¯ list2.remove æ“ä½œ //iterator.remove()ï¼›/æ“ä½œ2 æ³¨æ„æ˜¯ iterator.remove æ“ä½œ &#125;&#125;//æ“ä½œ1ï¼š Exception in thread "main" java.util.ConcurrentModificationException//æ“ä½œ2ï¼š [SubClass&#123;test=1&#125;, SubClass&#123;test=2&#125;]System.out.println(list2); æˆ‘ä»¬å¯¹æ“ä½œ1ï¼Œ2åˆ†åˆ«è¿è¡Œç¨‹åºï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ“ä½œ1å¾ˆå¿«å°±æŠ›å‡ºäº† java.util.ConcurrentModificationException å¼‚å¸¸ï¼Œæ“ä½œ2 åˆ™é¡ºåˆ©è¿è¡Œå‡ºæ­£å¸¸ç»“æœï¼Œå¦‚æœå¯¹ modCount æ³¨æ„äº†çš„è¯ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“ç†è§£ï¼Œlist.remove(index) æ“ä½œä¼šä¿®æ”¹List çš„ modCountï¼Œè€Œ iterator.next() å†…éƒ¨æ¯æ¬¡ä¼šæ£€éªŒ expectedModCount != modCountï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨ list.remove ä¸‹ä¸€æ¬¡å†è°ƒç”¨ iterator.next() å°±ä¼šæŠ¥é”™äº†ï¼Œè€Œiterator.removeä¸ºä»€ä¹ˆæ˜¯å®‰å…¨çš„å‘¢ï¼Ÿå› ä¸ºå…¶æ“ä½œå†…éƒ¨ä¼šåœ¨è°ƒç”¨ list.remove åé‡æ–°å°†æ–°çš„ modCount èµ‹å€¼ç»™ expectedModCountã€‚æ‰€ä»¥æˆ‘ä»¬ç›´æ¥è°ƒç”¨ list.remove æ“ä½œæ˜¯é”™è¯¯çš„ã€‚å¯¹äºå¤šçº¿ç¨‹çš„å½±å“è¿™é‡Œä¸åœ¨å±•å¼€è¿™é‡Œæ¨èæœ‰å…´è¶£çš„æœ‹å‹çœ‹ä¸‹è¿™ä¸ªæ–‡ç«  Java ConcurrentModificationExceptionå¼‚å¸¸åŸå› å’Œè§£å†³æ–¹æ³•; ç»è¿‡äº†ä¸€è½®åˆ†ææˆ‘ä»¬æˆ‘ä»¬çŸ¥é“äº†é”™è¯¯äº§ç”ŸåŸå› äº†ï¼Œä½†æ˜¯å¤§å®¶æ˜¯å¦èƒ½çœŸçš„åˆ†è¾¨å‡ºä»€ä¹ˆæ“ä½œæ˜¯é”™è¯¯çš„å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹è¾¹è¿™ä¸ªé¢è¯•é¢˜ï¼Œè¿™æ˜¯æˆ‘åœ¨ç½‘ä¸Šæ— æ„ä¸­çœ‹åˆ°çš„ä¸€é“å¤§ä¼—ç‚¹è¯„çš„é¢è¯•é¢˜ï¼š 123456789101112ArrayList&lt;String&gt; list = new ArrayList&lt;String&gt;();for (int i = 0; i &lt; 10; i++) &#123; list.add("sh" + i);&#125;for (int i = 0; list.iterator().hasNext(); i++) &#123; // hasNext åªæ˜¯åˆ¤æ–­äº† cursor != sizeï¼Œå¹¶æ²¡æœ‰ç§»åŠ¨cursorï¼Œæ‰€ä»¥åªè¦ size ä¸æ˜¯ 0 ï¼Œå°±ä¸ä¼šé€€å‡ºå¾ªç¯ // æœ€åsize == 5ï¼Œlist.remove(5)è¶Šç•Œï¼šIndexOutOfBoundsException // è¿™é‡Œå¹¶ä¸ä¼šå»æŠ¥ ConcurrentModificationException(),å› ä¸ºlist.iterator()æ¯æ¬¡éƒ½ä¼šå»newä¸€ä¸ªæ–°çš„Itrå¯¹è±¡ï¼Œæ¯æ¬¡åˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡éƒ½ä¼šæŠŠæœ€æ–°çš„ modCount èµ‹å€¼ç»™ expectedCountï¼Œæ‰€ä»¥ä¸å¯èƒ½åšåˆ° modeCount != expectedCountï¼Œè€Œä¸”åªæœ‰ iterator.next() ä¼šæœ‰è¿™ä¸ªé”™è¯¯ã€‚ list.remove(i); System.out.println("ç§˜å¯†" + list.get(i));&#125; ä¸€é“é¢è¯•é¢˜ç›¸ä¿¡å¤§å®¶è‚¯å®šçŸ¥é“è¿™æ ·æ“ä½œæ˜¯ä¼šäº§ç”Ÿé”™è¯¯çš„ï¼Œä½†æ˜¯æœ€ç»ˆä¼šæŠ›å‡ºè§’æ ‡è¶Šç•Œè¿˜æ˜¯ConcurrentModificationExceptionå‘¢ï¼Ÿ å…¶å®è¿™é‡Œä¼šæŠ›å‡ºè§’æ ‡è¶Šç•Œå¼‚å¸¸ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸º for å¾ªç¯çš„æ¡ä»¶ list.iterator().hasNext()ï¼Œæˆ‘ä»¬çŸ¥é“ list.iterator() å°†ä¼šnew ä¸€ä¸ªæ–°çš„ iterator å¯¹è±¡ï¼Œè€Œåœ¨ new çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å°† æ¯æ¬¡ list.remove åçš„ modCount èµ‹å€¼ç»™äº†æ–°çš„ iterator çš„ expectedModCountï¼Œæ‰€ä»¥ä¸ä¼šæŠ›å‡º ConcurrentModificationException å¼‚å¸¸ï¼Œè€Œ hasNext å†…éƒ¨åªåˆ¤æ–­äº† size æ˜¯å¦ç­‰äº cursor != size å½“æˆ‘ä»¬åˆ é™¤äº†ä¸€åŠå…ƒç´ ä»¥åï¼Œsize å˜æˆäº† 5 è€Œæ–°çš„ list.iterator() çš„ cursor ç­‰äº 0 ï¼Œ0!=5 for å¾ªç¯ç»§ç»­ï¼Œé‚£ä¹ˆå½“æ‰§è¡Œåˆ° list.removeï¼ˆ5ï¼‰çš„æ—¶å€™å°±ä¼šæŠ›å‡ºè§’æ ‡è¶Šç•Œäº†ã€‚ æ€»ç»“ ArrayList åº•å±‚æ˜¯ä¸€ä¸ªåŠ¨æ€æ‰©å®¹çš„æ•°ç»„ç»“æ„,æ¯æ¬¡æ‰©å®¹éœ€è¦å¢åŠ 1.5å€çš„å®¹é‡ ArrayList æ‰©å®¹åº•å±‚æ˜¯é€šè¿‡ Arrays.CopyOf å’Œ System.arraycopy æ¥å®ç°çš„ã€‚æ¯æ¬¡éƒ½ä¼šäº§ç”Ÿæ–°çš„æ•°ç»„ï¼Œå’Œæ•°ç»„ä¸­å†…å®¹çš„æ‹·è´ï¼Œæ‰€ä»¥ä¼šè€—è´¹æ€§èƒ½ï¼Œæ‰€ä»¥åœ¨å¤šå¢åˆ çš„æ“ä½œçš„æƒ…å†µå¯ä¼˜å…ˆè€ƒè™‘ LinkList è€Œä¸æ˜¯ ArrayListã€‚ ArrayList çš„ toArray æ–¹æ³•é‡è½½æ–¹æ³•çš„ä½¿ç”¨ã€‚ å…è®¸å­˜æ”¾ï¼ˆä¸æ­¢ä¸€ä¸ªï¼‰ null å…ƒç´  å…è®¸å­˜æ”¾é‡å¤æ•°æ®ï¼Œå­˜å‚¨é¡ºåºæŒ‰ç…§å…ƒç´ çš„æ·»åŠ é¡ºåº ArrayList å¹¶ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é›†åˆã€‚å¦‚æœé›†åˆçš„å¢åˆ æ“ä½œéœ€è¦ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ CopyOnWriteArrayList æˆ–è€…ä½¿collections.synchronizedList(List l)å‡½æ•°è¿”å›ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ArrayListç±». ä¸æ­£ç¡®è®¿é—®é›†åˆå…ƒç´ çš„æ—¶å€™ ConcurrentModificationExceptionå’Œ java.lang.IndexOutOfBoundsException å¼‚å¸¸äº§ç”Ÿçš„æ—¶æœºå’ŒåŸç†ã€‚ æœ¬æ–‡åˆé•¿ç¯‡å¤§è®ºçš„åˆ†æäº†ä¸€æ³¢ ArrayList çš„æºç ï¼Œå¯¹æˆ‘ä¸ªäººè€Œè¨€è¿™å¾ˆæœ‰æ„ä¹‰ï¼Œåœ¨æŸ¥çœ‹æºç çš„è¿‡ç¨‹ä¸­ï¼Œæ³¨æ„åˆ°äº†å¹³æ—¶å¾ˆå°‘æœ‰æœºä¼šæ¥è§¦çš„çŸ¥è¯†ç‚¹ã€‚å½“ç„¶è¿™åªæ˜¯é›†åˆæºç åˆ†æçš„å¼€ç«¯ï¼Œä»¥åè¿˜ä¼šæ›´ç»†ï¼Œå…¶ä»–å¸¸ç”¨é›†åˆæºç çš„åˆ†æã€‚å¦‚æœå¤§å®¶æ„Ÿè§‰æˆ‘å†™çš„è¿˜å¯ä»¥ï¼Œ è¯·ç•™è¨€ + ç‚¹èµ + å…³æ³¨ã€‚ è½¬è½½ï¼šææ‡‚ Java ArrayList æºç  LinkedListå…ˆåæ§½ä¸€ä¸‹ï¼Œæ„Ÿè§‰LinkedListæºç çœŸçš„å¾ˆç®€å•å•Šå“ˆå“ˆå“ˆå“ˆå“ˆï¼Œæ€»å…±ä¹Ÿæ‰1000æ¥è¡Œä»£ç â€¦è€Œä¸”è¿ä¸ªæ‰©å®¹éƒ½æ²¡æœ‰ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å¯¹åŒå‘é“¾è¡¨çš„ä¸€é¡¿æ“ä½œï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸ºäº†å‡‘ä»£ç é‡æ‰€ä»¥é¡ºå¸¦åˆ©ç”¨åŒå‘é“¾è¡¨çš„æ€§è´¨å®ç°ä¸€ä¸‹åŒå‘é˜Ÿåˆ—å˜›â€¦ç®—äº†ï¼Œè¿˜æ˜¯è€ç€æ€§è´¨ç¨å¾®åˆ†æä¸€ä¸‹å§â€¦ï¼ˆå°±æ˜¯å°¼ç›æ–¹æ³•æœ‰ç‚¹å¤šï¼Œåå­—æˆ‘éƒ½çœ‹æ™•å•¦â€¦ï¼‰ è¯è¯´å›æ¥ï¼Œè¿™äº›é‡Œé¢çš„å‡½æ•°å°±æ˜¯ å¯¹åŒå‘é“¾è¡¨åšæŸäº›æ“ä½œçš„æ ‡å‡†ç­”æ¡ˆå–ï¼é‡Œé¢å†™çš„ä»£ç éƒ½æŒºä¼˜ç¾çš„ï¼å¯ä»¥æ¬£èµä¸€å“ˆ~ ç®—äº†â€¦â€¦æˆ‘æ‡’å¾—åˆ†æäº†ï¼Œç›´æ¥ä¸¢ä¸ªé“¾æ¥å§â€¦â€¦ ææ‡‚ JAVA LinkedList æºç  æ³¨æ„ç‚¹ ç»§æ‰¿è‡ª AbstrackSequentialList å¹¶å®ç°äº† List æ¥å£ä»¥åŠ Deque åŒå‘é˜Ÿåˆ—æ¥å£ï¼Œå› æ­¤ LinkedList ä¸ä½†æ‹¥æœ‰ List ç›¸å…³çš„æ“ä½œæ–¹æ³•ï¼Œä¹Ÿæœ‰é˜Ÿåˆ—çš„ç›¸å…³æ“ä½œæ–¹æ³•ã€‚ LinkedList é›†åˆåº•å±‚å®ç°çš„æ•°æ®ç»“æ„ä¸ºåŒå‘é“¾è¡¨ LinkedList é›†åˆä¸­å…ƒç´ å…è®¸ä¸º null LinkedList å…è®¸å­˜å…¥é‡å¤çš„æ•°æ® LinkedList ä¸­å…ƒç´ å­˜æ”¾é¡ºåºä¸ºå­˜å…¥é¡ºåºã€‚ LinkedList æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœæƒ³ä¿è¯çº¿ç¨‹å®‰å…¨çš„å‰æä¸‹æ“ä½œ LinkedListï¼Œå¯ä»¥ä½¿ç”¨ List list = Collections.synchronizedList(new LinkedList(...)); æ¥ç”Ÿæˆä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ LinkedList å®ç°Listï¼Œåˆ©ç”¨äº†å…¶æ˜¯ä¸¤ä¸ªå•é“¾è¡¨ç»„æˆçš„ï¼Œå®ç°Dequeï¼Œåˆ©ç”¨å…¶æ˜¯åŒå‘é“¾è¡¨çš„æ€§è´¨ï¼Œæ³¨æ„å“ˆï¼ŒDequeæ—¢å¯ä»¥å½“é˜Ÿåˆ—ä¹Ÿå¯ä»¥å½“æ ˆï¼Œæ‰€ä»¥é˜Ÿåˆ—å’Œæ ˆçš„æ–¹æ³•LinkedListå…¨æœ‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445public interface Deque&lt;E&gt; extends Queue&lt;E&gt; &#123; //ä»å¤´éƒ¨æ’å…¥ï¼ˆæŠ›å¼‚å¸¸ï¼‰ void addFirst(E e); //ä»å°¾éƒ¨æ’å…¥ï¼ˆæŠ›å¼‚å¸¸ï¼‰ void addLast(E e); //ä»å¤´éƒ¨æ’å…¥ï¼ˆç‰¹æ®Šå€¼ï¼‰ boolean offerFirst(E e); //ä»å°¾éƒ¨æ’å…¥ï¼ˆç‰¹æ®Šå€¼ï¼‰ boolean offerLast(E e); //ä»å¤´éƒ¨ç§»é™¤ï¼ˆæŠ›å¼‚å¸¸ï¼‰ E removeFirst(); //ä»å°¾éƒ¨ç§»é™¤ï¼ˆæŠ›å¼‚å¸¸ï¼‰ E removeLast(); //ä»å¤´éƒ¨ç§»é™¤ï¼ˆç‰¹æ®Šå€¼ï¼‰ E pollFirst(); //ä»å°¾éƒ¨ç§»é™¤ï¼ˆç‰¹æ®Šå€¼ï¼‰ E pollLast(); //ä»å¤´éƒ¨æŸ¥è¯¢ï¼ˆæŠ›å¼‚å¸¸ï¼‰ E getFirst(); //ä»å°¾éƒ¨æŸ¥è¯¢ï¼ˆæŠ›å¼‚å¸¸ï¼‰ E getLast(); //ä»å¤´éƒ¨æŸ¥è¯¢ï¼ˆç‰¹æ®Šå€¼ï¼‰ E peekFirst(); //ä»å°¾éƒ¨æŸ¥è¯¢ï¼ˆç‰¹æ®Šå€¼ï¼‰ E peekLast(); //ï¼ˆä»å¤´åˆ°å°¾éå†åˆ—è¡¨æ—¶ï¼Œç§»é™¤åˆ—è¡¨ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„æŒ‡å®šå…ƒç´ ï¼‰ boolean removeFirstOccurrence(Object o); //ï¼ˆä»å¤´åˆ°å°¾éå†åˆ—è¡¨æ—¶ï¼Œç§»é™¤åˆ—è¡¨ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„æŒ‡å®šå…ƒç´ ï¼‰ boolean removeLastOccurrence(Object o); //éƒ½æ²¡å•¥éš¾åº¦ï¼Œä¸è§£é‡Šäº† boolean add(E e); boolean offer(E e); E remove(); E poll(); E element(); E peek(); void push(E e); E pop(); boolean remove(Object o); boolean contains(Object o); public int size(); Iterator&lt;E&gt; iterator(); Iterator&lt;E&gt; descendingIterator();&#125; Vectorç®€è€Œè¨€ä¹‹ï¼ŒVector ä¸ ArrayList ä¹‹é—´çš„å…³ç³»ï¼Œå°±æ˜¯ HashMap å’Œ HashTable ä¹‹é—´çš„å…³ç³»ï¼ŒVector çš„æ–¹æ³•åŸºæœ¬ä¸Šéƒ½æ˜¯ ArrayList çš„æ–¹æ³• åŠ ä¸ª synchronized å…³é”®å­—ç»„æˆçš„ï¼Œè¿™è¾¹è®²ä¸‹å®ƒä¸ ArrayList çš„ä¸åŒï¼Œå°±å¯ä»¥ç»“æŸäº†ï¼ ä¸åŒç‚¹æœ‰ï¼š Vector çº¿ç¨‹å®‰å…¨ï¼Œæ˜¯åŒæ­¥çš„ï¼›ArrayList éçº¿ç¨‹å®‰å…¨ï¼ŒéåŒæ­¥çš„ æ‰©å®¹ç­–ç•¥ä¸åŒï¼ŒArrayList æ‰©å®¹æ˜¯å˜æˆåŸæ¥çš„ 1.5 å€ï¼Œè€Œ Vector å’Œ ArrayDeque æ‰©å®¹ä¸€æ ·ï¼Œéƒ½æ˜¯å˜ä¸ºåŸæ¥çš„ä¸¤å€ Vector å¯ä»¥ä½¿ç”¨ Enumeration å’Œ Iterator è¿›è¡Œå…ƒç´ éå†ï¼ŒArrayList åªæä¾›äº† Iterator çš„æ–¹å¼ ç”±äºä½¿ç”¨çš„çº¿ç¨‹åŒæ­¥ï¼ŒVector çš„æ•ˆç‡æ¯” ArrayList ä½ï¼Œä½†æ˜¯ jdk8 ä¹‹åï¼Œç”±äºå¯¹ synchronized çš„å…³é”®å­—çš„ä¼˜åŒ–ï¼Œå¼•å…¥äº† åå‘é” ç­‰è½»é‡çº§é”ä¹‹åï¼Œ Vector å’Œ ArrayList çš„æ€§èƒ½å·®å¼‚å·²ç»ä¸å¤§äº† Queueæ²¡å•¥å¥½åˆ†æçš„ï¼Œå®ç°è¿™ä¸ªæ¥å£çš„ï¼Œæ¥è§¦çš„æ¯”è¾ƒå¤šçš„ä¹Ÿå°±æ˜¯ PriorityQueueã€ArrayDequeã€‚ ç›´æ¥æ”¾é“¾æ¥ï¼š Javaé›†åˆï¼ˆä¸ƒï¼‰ Queueè¯¦è§£ Javaé›†åˆArrayDequeç±»è§£è¯» æ­»ç£• javaé›†åˆä¹‹ArrayDequeæºç åˆ†æ æ³¨æ„ç‚¹å°±å…¶å®ç°è€Œè¨€ï¼ŒArrayDequeé‡‡ç”¨äº†å¾ªç¯æ•°ç»„çš„æ–¹å¼æ¥å®ŒæˆåŒç«¯é˜Ÿåˆ—çš„åŠŸèƒ½ã€‚ æ— é™çš„æ‰©å±•ï¼Œè‡ªåŠ¨æ‰©å±•é˜Ÿåˆ—å¤§å°çš„ã€‚ï¼ˆå½“ç„¶åœ¨ä¸ä¼šå†…å­˜æº¢å‡ºçš„æƒ…å†µä¸‹ï¼‰ éçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸æ”¯æŒå¹¶å‘è®¿é—®å’Œä¿®æ”¹ã€‚ æ”¯æŒfast-failã€‚ ä½œä¸ºæ ˆä½¿ç”¨çš„è¯æ¯”æ¯”æ ˆè¦å¿«ã€‚ å½“é˜Ÿåˆ—ä½¿ç”¨æ¯” LinkedList è¦å¿«ã€‚ nullå…ƒç´ è¢«ç¦æ­¢ä½¿ç”¨ï¼Œè¿™ä¸ªè·Ÿ ArrayList å’Œ LinkedList ä¹Ÿä¸ä¸€æ · åˆå§‹å€¼è·Ÿ ArrayList ä¸ä¸€æ ·ï¼Œè¿™é‡Œçš„åˆå§‹å€¼æ˜¯ 16ï¼Œæ‰©å®¹ä¹Ÿæ˜¯ç›´æ¥æ‰©å®¹ä¸¤å€ï¼Œè·Ÿ ArrayList çš„ 1.5 å€ä¸ä¸€æ ·ï¼Œæ‰©å®¹çš„æ—¶å€™åˆ©ç”¨äº†å®¹é‡æ˜¯2æ¬¡å¹‚è¿™ä¸ªæ€§è´¨ï¼Œè·Ÿ HashMap ä¸€æ ·ï¼Œç›´æ¥ä¸ length ç›¸ä¸å³å¯ã€‚]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
        <category>é›†åˆç±»æºç åˆ†æ</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>ArrayList</tag>
        <tag>æºç åˆ†æ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVAå¯¹æ•°ç»„çš„å››ç§æ‹·è´æ–¹å¼]]></title>
    <url>%2F2019%2F10%2F07%2FJAVA%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%9B%9B%E7%A7%8D%E6%8B%B7%E8%B4%9D%E6%96%B9%E5%BC%8F.html</url>
    <content type="text"><![CDATA[æ•°ç»„æ‹·è´çš„å››ç§æ–¹å¼ for clone System.arraycopy arrays.copyof æ•°ç»„æ‹·è´æ–¹å¼ä¹‹ä¸€â€”â€”for()å°±æ˜¯forå¾ªç¯å’¯ï¼ï¼ï¼ 12345/** 1 for å¾ªç¯æ‹·è´*/int[] arr1 = new int[len];for (int i = 0; i &lt; len; i++) &#123; arr1[i] = arr0[i];&#125; ä¹Ÿæ˜¯æµ…æ‹·è´å’¯ï¼ æ•°ç»„æ‹·è´æ–¹å¼ä¹‹äºŒâ€”â€”clone()ï¼ˆä¸»è¦å‚è€ƒï¼‰ç»†è¯´ Java çš„æ·±æ‹·è´å’Œæµ…æ‹·è´ åœ¨ Java ä¸­ï¼Œæ‰€æœ‰çš„ Class éƒ½ç»§æ‰¿è‡ª Object ï¼Œè€Œåœ¨ Object ä¸Šï¼Œå­˜åœ¨ä¸€ä¸ª clone() æ–¹æ³•ï¼Œå®ƒè¢«å£°æ˜ä¸ºäº† protected ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å…¶å­ç±»ä¸­ï¼Œä½¿ç”¨å®ƒã€‚è€Œæ— è®ºæ˜¯æµ…æ‹·è´è¿˜æ˜¯æ·±æ‹·è´ï¼Œéƒ½éœ€è¦å®ç° clone() æ–¹æ³•ï¼Œæ¥å®Œæˆæ“ä½œã€‚ é¦–å…ˆéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œclone()æ˜¯æµ…æ‹·è´çš„æ–¹å¼ï¼ï¼ï¼å…¶æ¬¡ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®ç°æ·±æ‹·è´å‘¢ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š ç”¨å¤šå±‚æµ…æ‹·è´è¾¾åˆ°æ·±æ‹·è´çš„ç›®çš„ï¼Œè¦çŸ¥é“ï¼Œæµ…æ‹·è´å’Œæ·±æ‹·è´çš„åŒºåˆ«å°±æ˜¯åœ¨å¤„ç†å¯¹è±¡å¼•ç”¨æ—¶ï¼Œæµ…æ‹·è´ä¸ä¼šåˆ›é€ æ–°çš„å¯¹è±¡ï¼Œè€Œæ·±æ‹·è´ä¼šï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªå¯¹è±¡çš„å±æ€§å˜æˆäº†åŸºæœ¬ç±»å‹æ•°æ®ï¼Œé‚£ä¹ˆæµ…æ‹·è´åŒæ ·ä¼šåˆ›é€ æ–°çš„å¯¹è±¡ï¼Œæ‰€ä»¥è¯´ï¼Œå¤šå±‚æµ…æ‹·è´å°±èƒ½è¾¾åˆ°æ·±æ‹·è´çš„ç›®çš„ï¼Œä¾‹å¦‚ï¼šåœ¨å¯¹fatherClasså’ŒchildClassè¿›è¡Œä¸¤çº§æµ…æ‹·è´ä¹‹åï¼ŒfatherBå°±æœ‰æµ…æ‹·è´å˜æˆäº†æ·±æ‹·è´ï¼Œå› ä¸ºæ­¤æ—¶åŸºæœ¬æ•°æ®ç±»å‹å’ŒChildå¯¹è±¡éƒ½æ˜¯æŒ‡å‘ä¸åŒçš„åœ°å€çš„ï¼Œä¹Ÿå°±æ˜¯äºŒè€…éƒ½æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œæ‰€ä»¥å°±æ˜¯è¾¾åˆ°äº†æ·±æ‹·è´çš„ç›®çš„äº†ã€‚ åºåˆ—åŒ–ï¼ˆserializationï¼‰è¿™ä¸ªå¯¹è±¡ï¼Œå†ååºåˆ—åŒ–å›æ¥ï¼Œå°±å¯ä»¥å¾—åˆ°è¿™ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ— éå°±æ˜¯åºåˆ—åŒ–çš„è§„åˆ™éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥å†™ã€‚æ€»ç»“ä¸‹æ¥å°±æ˜¯åšäº†5ä»¶äº‹ï¼š ç¡®ä¿å¯¹è±¡å›¾ä¸­çš„æ‰€æœ‰ç±»éƒ½æ˜¯å¯åºåˆ—åŒ–çš„ åˆ›å»ºè¾“å…¥è¾“å‡ºæµ ä½¿ç”¨è¿™ä¸ªè¾“å…¥è¾“å‡ºæµæ¥åˆ›å»ºå¯¹è±¡è¾“å…¥å’Œå¯¹è±¡è¾“å‡ºæµ å°†ä½ æƒ³è¦æ‹·è´çš„å¯¹è±¡ä¼ é€’ç»™å¯¹è±¡è¾“å‡ºæµ ä»å¯¹è±¡è¾“å…¥æµä¸­è¯»å–æ–°çš„å¯¹è±¡å¹¶ä¸”è½¬æ¢å›ä½ æ‰€å‘é€çš„å¯¹è±¡çš„ç±» æœ€åï¼Œæ¨ä¸€ä¸ªåºåˆ—åŒ–å®ç°æ·±æ‹·è´çš„ä¾‹å­ï¼šåºåˆ—åŒ–çš„æ–¹å¼ä½¿å¾—å…¶å˜ä¸ºæ·±æ‹·è´ æ•°ç»„æ‹·è´æ–¹å¼ä¹‹ä¸‰â€”â€”System.arraycopy()nativeæ–¹æ³•ï¼Œä¾æ—§æ˜¯ä¸€ä¸ªæµ…æ‹·è´â€”â€”â€“&gt; è¯¦ç»†ä¼ é€é—¨ æ•°ç»„æ‹·è´æ–¹å¼ä¹‹å››â€”â€”arrays.copyof()1234567891011public static &lt;T,U&gt; T[] copyOf(U[] original, int newLength, Class&lt;? extends T[]&gt; newType) &#123; @SuppressWarnings("unchecked") //æ ¹æ®classçš„ç±»å‹æ˜¯å¦æ˜¯ Object[] æ¥å†³å®šæ˜¯ new è¿˜æ˜¯åå°„å»æ„é€ ä¸€ä¸ªæ³›å‹æ•°ç»„ T[] copy = ((Object)newType == (Object)Object[].class) ? (T[]) new Object[newLength] : (T[]) Array.newInstance(newType.getComponentType(), newLength); //ä½¿ç”¨ native æ–¹æ³•æ‰¹é‡èµ‹å€¼å…ƒç´ è‡³æ–°æ•°ç»„ä¸­ã€‚ System.arraycopy(original, 0, copy, 0, Math.min(original.length, newLength)); return copy;&#125; ä½ çœ‹çœ‹ï¼Œåº•å±‚ä¹Ÿåœ¨ç”¨System.arraycopy()è¿™ä¸ªnativeæ–¹æ³•ï¼Œæ‰€ä»¥å°±ä¸å†èµ˜è¿°äº†ï¼Œè¿™ä¸ªåœ¨ArrayListæºç åˆ†æä¸­ä¹Ÿæœ‰æ¶‰åŠå“¦ï¼ï¼ï¼ï¼ æ·±æµ…æ‹·è´çš„åŒºåˆ«ï¼š https://blog.csdn.net/baiye_xing/article/details/71788741?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>æ•°ç»„</tag>
        <tag>Array</tag>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[10.2----10.7æ”¶è·]]></title>
    <url>%2F2019%2F10%2F02%2F10-2-10-7.html</url>
    <content type="text"><![CDATA[10.2 å­¦ä¹ å®Œajaxå¼‚æ­¥è°ƒç”¨ï¼› å®Œæˆæ·»åŠ ç„¶åæ•°æ®åº“é‡Œæœ‰æ•°æ®å¹¶ä¸”èƒ½æ­£å¸¸è·³è½¬ï¼› bç«™ä¸Šå†çœ‹çœ‹springboot+mybatisçš„ç»“åˆï¼› æ€»ç»“åšå®¢ï¼Œåˆ†åˆ«æ€»ç»“åˆ†é¡µæ’åºè¿˜è¦mongodbåœ¨springbootä¸­çš„ç›¸å…³æ“ä½œï¼› æ”¶è· springbootå¯åŠ¨å¾ˆæ…¢çš„åŸå› ï¼šæœªä¿®æ”¹hostç›®å½•çš„æ–‡ä»¶ï¼Œå¯¼è‡´æ¯æ¬¡å¯åŠ¨éƒ½å¾ˆæ…¢ã€‚æ­¥éª¤ åœ¨terminalç»ˆç«¯è¾“å…¥: 1$ hostname å¤åˆ¶ä¸‹æ¥ï¼Œç„¶åä¿®æ”¹hostæ–‡ä»¶ä¸­çš„localhostï¼š 1$ sudo vim /etc/hosts ç„¶åå°†è‡ªå·±hostnameæ›¿æ¢æ‰localhost 123127.0.0.1&lt;ä¸¤ä¸ªtab&gt;localhost æ›¿æ¢ä¸º$hostname255.255.255.255&lt;ä¸¤ä¸ªtab&gt;broadcasthost::1&lt;ä¸¤ä¸ªtab&gt;localhost æ›¿æ¢ä¸º$hostname åœ¨jsä¼ å€¼ç»™controlleræ—¶ï¼Œä¸€ç›´ä¸èƒ½å°†jsonæ•°æ®ä¼ è¿‡å»ï¼ŒåŸå› æ˜¯æ²¡æœ‰ç»™dataçš„å€¼åŠ ä¸ŠJSON.stringify()å¤„ç†ï¼Œå…·ä½“é”™è¯¯ï¼šspringboot æ¥æ”¶å‚æ•°ï¼Œè§£æjsonå‡ºç°é”™è¯¯ï¼šwas expecting â€˜nullâ€™, â€˜trueâ€™, â€˜falseâ€™ or NaNè§£å†³æ–¹æ¡ˆï¼šè§â€”-&gt;jsä¸controllerä¹‹é—´ä¼ å€¼å¸¸è§é—®é¢˜ JQuery.ajaxajaxå’Œspringbootä¼ å€¼ jqueryä¸­å­—ç¬¦ä¸²è½¬æ—¥æœŸï¼Œæ—¥æœŸè½¬å­—ç¬¦ä¸² MyBatisä¸»é”®å›å¡«ç­–ç•¥ è¡¨ä¸­éƒ¨åˆ†å±æ€§è‡ªåŠ¨ç”Ÿæˆï¼Œä¸éœ€è¦é¢å¤–ä¼ å…¥å‚æ•° å…ˆæ˜¯å°è¯•äº†åœ¨beanä¸­åŠ @valueï¼ŒåŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„éšæœºæ•°ï¼Œä½†æ˜¯å‘ç°æ‰§è¡Œä¸€æ¬¡ï¼Œéšæœºæ•°æ˜¯å”¯ä¸€çš„ï¼Œè¿™æ ·å°±ä¸èƒ½åšåˆ°æ’å…¥ä¸€æ¡æ•°æ®ï¼Œéšæœºæ•°å°±å˜åŒ–ï¼› åé¢å‘ç°å¯ä»¥åœ¨mybatisç›´æ¥é…ç½®ç»“æœé›†ï¼Œå¥½åƒä¹Ÿä¸è¡Œâ€¦å› ä¸ºå¦‚æœä½ ç”¨ç»“æœé›†å°†idè½¬æ¢ä¸ºtaskId,é‚£åŸæœ¬beanä¸­çš„idå±æ€§å°±ä¼šå–ä¸åˆ°å€¼â€¦ jQueryè·å–htmlä¸­çš„å€¼è·å–htmlä¸­çš„å€¼ 10.3æ”¶è·ä½¿ç”¨æœ€å¤§çš„idï¼ï¼ï¼mysqlæ’å…¥æ•°æ®åè¿”å›è‡ªå¢IDçš„æ–¹æ³•ï¼ˆAUTO_INCREMENTï¼‰ 10.4æ”¶è· å¤æ‚jsonè½¬æˆå¤šå±‚map 12345678910111213141516171819public Map&lt;String, Object&gt; parseJSON2Map(@RequestBody String jsonStr)&#123; Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); JSONObject json = JSONObject.parseObject(jsonStr); for(Object k : json.keySet())&#123; Object v = json.get(k); if(v instanceof JSONArray)&#123; List&lt;Map&lt;String, Object&gt;&gt; list = new ArrayList&lt;Map&lt;String,Object&gt;&gt;(); Iterator it = ((JSONArray)v).iterator(); while(it.hasNext())&#123; Object json2 = it.next(); list.add(parseJSON2Map(json2.toString())); &#125; map.put(k.toString(), list); &#125; else &#123; map.put(k.toString(), v); &#125; &#125; return map; &#125; macå¼ºåˆ¶åˆ·æ–°ç¼“å­˜ï¼šcommand + shift + Ræ™®é€šåˆ·æ–°ï¼šcommand + R Springbootä½¿ç”¨å¤šçº¿ç¨‹ æœ€è¿‘é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œå°±æ˜¯å½“æœåŠ¡å™¨æ¥åˆ°è¯·æ±‚å¹¶ä¸éœ€è¦ä»»åŠ¡æ‰§è¡Œå®Œæˆæ‰è¿”å›ç»“æœï¼Œå¯ä»¥ç«‹å³è¿”å›ç»“æœï¼Œè®©ä»»åŠ¡å¼‚æ­¥çš„å»æ‰§è¡Œã€‚å¼€å§‹è€ƒè™‘æ˜¯ç›´æ¥å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡æˆ–è€…æŠŠä»»åŠ¡æäº¤åˆ°ä¸€ä¸ªçº¿ç¨‹æ± å»æ‰§è¡Œï¼Œè¿™ä¸¤ç§æ–¹æ³•éƒ½æ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯ Spring è¿™ä¹ˆå¼ºå¤§ï¼Œè‚¯å®šæœ‰ä»€ä¹ˆæ›´ç®€å•çš„æ–¹æ³•ï¼Œå°± google äº†ä¸€ä¸‹ï¼Œè¿˜çœŸæœ‰å‘¢ã€‚å°±æ˜¯ä½¿ç”¨ @EnableAsync å’Œ @Async è¿™ä¸¤ä¸ªæ³¨è§£å°± ok äº†ã€‚ä¼ é€é—¨ï¼šSpringBootéå®˜æ–¹æ•™ç¨‹ | ç¬¬äºŒåä¸‰ç¯‡ï¼š å¼‚æ­¥æ–¹æ³• é¦–å…ˆå£°æ˜ä¸€ä¸‹è‡ªå·±ç”¨äº†æ¯”è¾ƒé•¿çš„æ—¶é—´æ‰å¼„å‡ºæ¥çš„åŸå› æ˜¯ï¼Œè‡ªå·±æŠŠå¼‚æ­¥æ–¹æ³•å†™åˆ°äº†Controllerå±‚ï¼Œå¯¼è‡´åœ¨controllerçš„å¦ä¸€ä¸ªæ–¹æ³•è°ƒç”¨æ—¶æ— æ³•å¼€å¯å¼‚æ­¥åŠŸèƒ½ï¼Œæ‰€ä»¥å¯¹æ­¤æˆ‘æœ‰ä¸‰ç‚¹è§è§£ï¼š åœ¨@SpringBootApplicationå¯åŠ¨ç±» æ·»åŠ æ³¨è§£@EnableAsync å¼‚æ­¥æ–¹æ³•ä½¿ç”¨æ³¨è§£@Async ,è¿”å›å€¼ä¸ºvoidæˆ–è€…Future åˆ‡è®°ä¸€ç‚¹ï¼Œå¼‚æ­¥æ–¹æ³•å’Œè°ƒç”¨æ–¹æ³•ä¸€å®šè¦ å†™åœ¨ä¸åŒçš„ç±»ä¸­,å¦‚æœå†™åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œæ˜¯æ²¡æœ‰æ•ˆæœçš„ï¼Œè‡³äºä¸ºä»€ä¹ˆâ€”-&gt;å› ä¸ºSpringåƒ@Transaction @Asyncç­‰è¿™äº›éƒ½æ˜¯ä½¿ç”¨äº†åŠ¨æ€ä»£ç†ï¼ŒSpringå®¹å™¨åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šå°†å«æœ‰AOPæ³¨è§£çš„ç±»å¯¹è±¡æ›¿æ¢ä¸ºä»£ç†å¯¹è±¡ï¼Œå†ç”±Proxyå¯¹è±¡å»è°ƒç”¨è¢«å¢å¼ºæ–¹æ³•ï¼Œé‡ç‚¹æ¥äº†ï¼šæ–¹æ³•é‡Œæƒ³ç”¨å¢å¼ºæ–¹æ³•(ç¬¬ä¸‰ç‚¹)åˆ™éœ€è¦å¾—åˆ°å½“å‰çš„Proxyå¯¹è±¡ï¼Œä½†å¦‚æœæ˜¯åŒä¸€ä¸ªç±»çš„è¯ï¼Œæ˜¯ä¸ä¼šç»è¿‡springå®¹å™¨çš„ï¼Œæ­¤æ—¶æ˜¯çœŸæ­£çš„å¯¹è±¡æœ¬èº«å»è°ƒç”¨æ–¹æ³•ï¼Œå¹¶ä¸æ˜¯ä»£ç†å¯¹è±¡ï¼Œè¿™æ ·çš„è¯è¢«å¢å¼ºæ–¹æ³•å°±å¤±æ•ˆäº†ï¼Œè¯¦æƒ…è¯·çœ‹ -&gt;Springçš„ AopContext.currentProxy()æ–¹æ³• è§£å†³æ–¹æ¡ˆ æˆ‘é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯ï¼Œå°†å¼‚æ­¥æ–¹æ³•å†™å…¥serviceå±‚ï¼Œç„¶åå†controllerå±‚ä¸­è°ƒç”¨ï¼Œè¿™æ ·å°±ç»è¿‡äº†springå®¹å™¨ï¼Œè°ƒç”¨æ–¹æ³•æ—¶å°±æ˜¯é‡‡ç”¨çš„ä»£ç†å¯¹è±¡ã€‚ ç¬¬äºŒç§æ–¹æ³•ï¼Œæˆ‘æ²¡æœ‰æˆåŠŸï¼ï¼ï¼ï¼çœŸçš„æ˜¯æ°”çš„ä¸è¡Œï¼Œå› ä¸ºæˆ‘çœ‹ç½‘ä¸Šåšå®¢åˆ«äººéƒ½æˆåŠŸäº†â€¦â€¦å°±æ˜¯ç”¨AopContext.currentProxy()è¿™ä¸ªæ–¹æ³•,æ­¥éª¤ä¸ºï¼š æ·»åŠ ä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;&lt;/dependency&gt; åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ æ³¨é‡Š 1@EnableAspectJAutoProxy(exposeProxy=true,proxyTargetClass=true) ç„¶ååœ¨è°ƒç”¨æ–¹æ³•å¤„å†™ï¼š 1((TaskController)AopContext.currentProxy()).testAsy("www.baidu.com"); æŒ‰ç†è¯´åº”è¯¥å¯ä»¥äº†çš„ï¼Œç»“æœå§ï¼Œæˆ‘ä¸€è·‘ç¨‹åºå°±æŠ¥é”™ï¼Œè¯´æˆ‘çš„å“¦ä»£ç†æ€ä¹ˆæ²¡æš´éœ²å•Šï¼Œæˆ‘çœŸæ˜¯å§æ§½äº†ï¼Œé‚£ä»–å¦ˆä¸æ˜¯å·²ç»é…ç½®äº†æš´éœ²äº†å˜›ï¼ï¼ï¼æˆ‘æœäº†ï¼ï¼ï¼ç®—äº†ï¼Œæ‡’å¾—æ­ç†äº†â€¦ç”©ä¸ªè·Ÿè¿™ä¸ªåŸç†ä¸€æ ·çš„é“¾æ¥ï¼Œå­¦ä¹ ä¸€ä¸‹ï¼šJDKåŠ¨æ€ä»£ç†ç»™Springäº‹åŠ¡åŸ‹ä¸‹çš„å‘ï¼å†ç”©ä¸€ä¸ªé“¾æ¥ï¼Œä¸‰ç§æ–¹æ³•é…ç½®è¿™ä¸ªexposeProxy(ç„¶è€Œæˆ‘ä¸€ä¸ªéƒ½æ²¡æˆåŠŸâ€¦)â€”-&gt;springbootä¸­å¦‚ä½•é…ç½®aopåŠ¨æ€ä»£ç†æ¨¡å¼ (åŸåˆ›)]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2019-9-26]]></title>
    <url>%2F2019%2F09%2F26%2F2019-9-26.html</url>
    <content type="text"><![CDATA[ä»Šæ—¥ä»»åŠ¡ springboot + mongodb,å®Œæˆmongoåœ¨springbootä¸­çš„æ­å»ºï¼Œå†™ä¸€ä¸ªå°demo æœ€ä¸»è¦çš„æ˜¯æŠŠrepositoryè¿™ä¸€å±‚å†™å®Œï¼Œä¸šåŠ¡é€»è¾‘å¯ä»¥æ”¾åˆ°æ˜å¤©æ¥å†™ å®Œæˆè¿‡ç¨‹mongodbçš„å®‰è£…macOSä¸‹mongodbçš„å®‰è£…ä¸å¯åŠ¨ Springbootä¸‹çš„ç›¸å…³æ³¨è§£ @DataDataæ³¨è§£ä½¿ç”¨ @Documentæ ‡æ³¨åœ¨å®ä½“ç±»ä¸Šï¼Œç±»ä¼¼äºhibernateçš„entityæ³¨è§£ï¼Œæ ‡æ˜ç”±mongoæ¥ç»´æŠ¤è¯¥è¡¨ï¼Œcollectionä»£è¡¨è¡¨çš„åç§°ã€‚SpringBootä¸­MongoDBä¸­çš„ç›¸å…³æ³¨è§£ @Entityç­‰ä¸€ç³»åˆ—Spring Data JPAæ³¨è§£ @DynamicUpdateã€@DynamicInsert æ˜¯hibernateé‡Œé¢çš„æ³¨è§£ï¼Œè¿™ä¸¤ä¸ªæ³¨è§£åŠ ä¸Šä¹‹åå°±ä¸ä¼šä¸ºå­—æ®µå€¼ä¸å˜çš„å­—æ®µç”Ÿæˆsqlè¯­å¥ï¼Œè¿™æ ·sqlçš„é•¿åº¦å°±å‡å°‘äº†æé«˜äº†ä¼ è¾“æ•ˆç‡å’Œæ‰§è¡Œæ•ˆç‡ï¼Œåœ¨æ’å…¥å’Œä¿®æ”¹æ•°æ®çš„æ—¶å€™,è¯­å¥ä¸­åªåŒ…æ‹¬è¦æ’å…¥æˆ–è€…ä¿®æ”¹çš„å­—æ®µã€‚ @Entity æ ‡è¯†è¿™ä¸ªå®ä½“ç±»æ˜¯ä¸€ä¸ªJPAå®ä½“ï¼Œå‘Šè¯‰JPAåœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™è®°å¾—ç”Ÿæˆè¿™ä¸ªå®ä½“ç±»æ‰€å¯¹åº”çš„è¡¨~ï¼ GeneratedValueã€GenericGeneratoræ˜¯ç”¨äºä¸»é”®ç”Ÿæˆç­–ç•¥çš„ï¼Œå…·ä½“è§JPAæ³¨è§£ä¸»é”®ç”Ÿæˆç­–ç•¥-UUID @Columnï¼ˆname = â€œè‡ªå®šä¹‰å­—æ®µåâ€ï¼Œlength = â€œè‡ªå®šä¹‰é•¿åº¦â€ï¼Œnullable = â€œæ˜¯å¦å¯ä»¥ç©ºâ€ï¼Œunique = â€œæ˜¯å¦å”¯ä¸€â€ï¼ŒcolumnDefinition = â€œè‡ªå®šä¹‰è¯¥å­—æ®µçš„ç±»å‹å’Œé•¿åº¦â€ï¼‰ã€‚è¡¨ç¤ºå¯¹è¿™ä¸ªå˜é‡æ‰€å¯¹åº”çš„å­—æ®µåè¿›è¡Œä¸€äº›ä¸ªæ€§åŒ–çš„è®¾ç½®ï¼Œä¾‹å¦‚å­—æ®µçš„åå­—ï¼Œå­—æ®µçš„é•¿åº¦ï¼Œæ˜¯å¦ä¸ºç©ºå’Œæ˜¯å¦å”¯ä¸€ç­‰ç­‰è®¾ç½®ã€‚ å‰©ä½™æ³¨é‡Šï¼šSpring Data JPAä¸­å¸¸ç”¨çš„æ³¨è§£è¯¦è§£ @Controllerï¼ˆSpring Bootä¹‹ Controller æ¥æ”¶å‚æ•°å’Œè¿”å›æ•°æ®æ€»ç»“(åŒ…æ‹¬ä¸Šä¼ ã€ä¸‹è½½æ–‡ä»¶)ï¼‰Controllerå±‚çš„æ³¨è§£å¤§æ¦‚æœ‰ä»¥ä¸‹ä¸€äº›ï¼šï¼ˆä¸»è¦å‚è€ƒï¼šControllerå±‚ä¸»è¦æ³¨è§£ï¼‰ @Controller:æ ‡æ³¨ Controller ç±»ï¼Œå¤„ç† http è¯·æ±‚ @RestController:æ ‡æ³¨ Controller ç±»ï¼Œspring 4 æ–°åŠ æ³¨è§£ï¼Œç›¸å½“äº@Controller + @ResponseBody ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä½¿ http è¯·æ±‚è¿”å›æ•°æ®æ ¼å¼ä¸º json æ ¼å¼ï¼Œæ­£å¸¸æƒ…å†µä¸‹éƒ½æ˜¯ä½¿ç”¨è¿™ä¸ªæ³¨è§£ @RequestMapping:é…ç½® url æ˜ å°„ï¼Œå¯ä»¥ä½œç”¨äºç±»ä¸Šï¼Œä¹Ÿå¯ä»¥åœ¨æ–¹æ³•ä¸Š 123456789@RestController//å¤„ç†httpè¯·æ±‚ï¼Œè¿”å›jsonæ ¼å¼@RequestMapping(value = "/users")//é…ç½®urlï¼Œè®©è¯¥ç±»ä¸‹çš„æ‰€æœ‰æ¥å£urléƒ½æ˜ å°„åœ¨/usersä¸‹public class UserController &#123; @RequestMapping(value = "/myInfo", method = RequestMethod.GET) public String say() &#123; return "æˆ‘æ˜¯å¼ å°‘æ—"; &#125;&#125; @RequestMapping å®šä¹‰åœ¨ç±»ä¸Šï¼ŒæŒ‡å®šè¯¥ç±»ä¸‹çš„æ‰€æœ‰æ¥å£ url æ˜ å°„åœ¨ /users ä¸‹ï¼Œå®šä¹‰åœ¨æ–¹æ³•ä¸Šï¼ŒæŒ‡å®š è¯·æ±‚æ–¹æ³•ï¼Œå¯ä»¥æŒ‡å®šGETï¼ŒPOSTï¼ŒDELETEï¼ŒPUTå››ç§æ ‡å‡†çš„ Restfulapiè¯·æ±‚æ–¹æ³•ã€‚é‚£ä¹ˆæ­¤æ—¶çš„æ¥å£ url ä¸ºï¼šhttp://127.0.0.1:8080/users/myInfo è¯·æ±‚æ–¹æ³•ï¼šGETï¼Œç±»ä¸Šä¹Ÿå¯ä»¥ä¸ç”¨é…ç½® url æ˜ å°„çš„ã€‚ @PathVariableè·å– url ä¸­çš„æ•°æ®ï¼Œæˆ‘ä»¬åœ¨ url ä¸­æ‹¼æ¥ä¸€ä¸ªå­—ç¬¦ä¸² {username}ï¼Œç±»ä¼¼äºåœ°å€å ä½ç¬¦ï¼Œç”±ç”¨æˆ·è¯·æ±‚æ—¶æ·»åŠ ï¼Œè¯·æ±‚è·å–ã€‚æ³¨æ„æ³¨è§£ä¸­çš„å‚æ•°å¿…é¡»ä¸å ä½ç¬¦å‚æ•°ä¸€è‡´ 12345678@RestController//å¤„ç†httpè¯·æ±‚ï¼Œè¿”å›jsonæ ¼å¼@RequestMapping(value = "/users")//é…ç½®urlï¼Œè®©è¯¥ç±»ä¸‹çš„æ‰€æœ‰æ¥å£urléƒ½æ˜ å°„åœ¨/usersä¸‹public class UserController &#123; @RequestMapping(value = "/myInfo/&#123;username&#125;", method = RequestMethod.GET) public String say(@PathVariable("username") String username) &#123; return username; &#125;&#125; @RequestParamè·å–è¯·æ±‚å‚æ•°å€¼ï¼Œæ–¹æ³•éšæ„å¯ä»¥è®¾ç½®ï¼Œä½†æ˜¯é€šå¸¸éœ€æ±‚éƒ½æ˜¯ä½¿ç”¨ POST è¯·æ±‚å¤„ç†è¡¨å•æäº¤ã€‚ 12345678@RestController//å¤„ç†httpè¯·æ±‚ï¼Œè¿”å›jsonæ ¼å¼@RequestMapping(value = "/users")//é…ç½®urlï¼Œè®©è¯¥ç±»ä¸‹çš„æ‰€æœ‰æ¥å£urléƒ½æ˜ å°„åœ¨/usersä¸‹public class UserController &#123; @RequestMapping(value = "/myInfo", method = RequestMethod.POST) public String say(@RequestParam(value = "username") String username, @RequestParam(value = "password") String password) &#123; return username + password; &#125;&#125; å‡å¦‚ç”¨æˆ·è¾“å…¥çš„çš„uriæ˜¯:http://127.0.0.1:8080/users/myInfo?username=yangweijie&amp;password=123456ï¼Œé‚£ä¹ˆæœ€åè¿”å›çš„æ˜¯yangweijie123456ï¼Œå¦‚æœå‚æ•°ä¸å¸¦å€¼ä¸”æ·»åŠ å±æ€§required=trueï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œæ­¤æ—¶å°±å»ºè®®æ·»åŠ ä¸€ä¸ªdefaultValueå±æ€§ï¼š 12345678910@RestController//å¤„ç†httpè¯·æ±‚ï¼Œè¿”å›jsonæ ¼å¼@RequestMapping(value = "/users")//é…ç½®urlï¼Œè®©è¯¥ç±»ä¸‹çš„æ‰€æœ‰æ¥å£urléƒ½æ˜ å°„åœ¨/usersä¸‹public class UserController &#123; @RequestMapping(value = "/myInfo", method = RequestMethod.POST) public String say(@RequestParam(value = "username",required = false,defaultValue = "å¼ å°‘æ—") String username, @RequestParam(value = "password",required = false,defaultValue = "123456") String password) &#123; return username + password; &#125;&#125; @GetMappingã€@PostMappingã€@DeleteMappingã€@PutMappingç­‰æ˜¯RequestMappingçš„ç»„åˆæ³¨è§£ï¼Œæ ¹æ®methodçš„ä¸åŒã€‚ @RequestHeaderå¯ä»¥æŠŠRequestè¯·æ±‚headeréƒ¨åˆ†çš„å€¼ç»‘å®šåˆ°æ–¹æ³•çš„å‚æ•°ä¸Šã€‚ @CookieValueå¯ä»¥æŠŠRequest headerä¸­å…³äºcookieçš„å€¼ç»‘å®šåˆ°æ–¹æ³•çš„å‚æ•°ä¸Šã€‚ RequestBodyè¯¥æ³¨è§£å¸¸ç”¨æ¥å¤„ç†Content-Type: ä¸æ˜¯application/x-www-form-urlencodedç¼–ç çš„å†…å®¹ï¼Œä¾‹å¦‚application/json, application/xmlç­‰ï¼›å®ƒæ˜¯é€šè¿‡ä½¿ç”¨HandlerAdapter é…ç½®çš„HttpMessageConvertersæ¥è§£æpost data bodyï¼Œç„¶åç»‘å®šåˆ°ç›¸åº”çš„beanä¸Šçš„ã€‚å› ä¸ºé…ç½®æœ‰FormHttpMessageConverterï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨æ¥å¤„ç† application/x-www-form-urlencodedçš„å†…å®¹ï¼Œå¤„ç†å®Œçš„ç»“æœæ”¾åœ¨ä¸€ä¸ªMultiValueMap&lt;String, String&gt;é‡Œï¼Œè¿™ç§æƒ…å†µåœ¨æŸäº›ç‰¹æ®Šéœ€æ±‚ä¸‹ä½¿ç”¨ï¼Œè¯¦æƒ…æŸ¥çœ‹FormHttpMessageConverter api; ModelAttribute(å‚è€ƒï¼šSpring MVC @ModelAttributeè¯¦è§£)@ModelAttributeæœ‰ä¸‰ç§ç”¨æ³•ï¼š å¯ä»¥æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šï¼› å¯ä»¥æ ‡æ³¨åœ¨æ–¹æ³•ä¸­çš„å‚æ•°ä¸Šï¼› è¿˜å¯ä»¥å’Œ@RequestMappingä¸€èµ·æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šï¼›ç›®çš„éƒ½æ˜¯åœ¨RequestMappingä¹‹å‰è¿›è¡Œmodelå±æ€§çš„æ³¨å…¥ï¼Œå¯¹RestControllerå¥½åƒæ²¡ç”¨ï¼Œå› ä¸ºæ˜¯è¿”å›jsonæ•°æ®ï¼Œå¹¶ä¸èƒ½å°†modelé‡Œé¢çš„æ•°æ®ç›´æ¥è¿”å›ç»™é¡µé¢ã€‚å¦‚æœæ²¡ç”¨@RestControllerï¼Œåˆ™@ModelAttributeæ–¹æ³•é€šå¸¸è¢«ç”¨æ¥å¡«å……ä¸€äº›å…¬å…±éœ€è¦çš„å±æ€§æˆ–æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ªä¸‹æ‹‰åˆ—è¡¨æ‰€é¢„è®¾çš„å‡ ç§çŠ¶æ€ï¼Œæˆ–è€…å® ç‰©çš„å‡ ç§ç±»å‹ï¼Œæˆ–è€…å»å–å¾—ä¸€ä¸ªHTMLè¡¨å•æ¸²æŸ“æ‰€éœ€è¦çš„å‘½ä»¤å¯¹è±¡ï¼Œæ¯”å¦‚Accountç­‰ã€‚@ModelAttributeæ ‡æ³¨æ–¹æ³•æœ‰ä¸¤ç§é£æ ¼ï¼š 12345678910111213141516// Add one attribute// The return value of the method is added to the model under the name "account"// You can customize the name via @ModelAttribute("myAccount")@ModelAttributepublic Account addAccount(@RequestParam String number) &#123; return accountManager.findAccount(number);&#125;// Add multiple attributes@ModelAttributepublic void populateModel(@RequestParam String number, Model model) &#123; model.addAttribute(accountManager.findAccount(number)); // add more ... &#125; åœ¨ç¬¬ä¸€ç§å†™æ³•ä¸­ï¼Œæ–¹æ³•é€šè¿‡è¿”å›å€¼çš„æ–¹å¼é»˜è®¤åœ°å°†æ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œåœ¨ç¬¬äºŒç§å†™æ³•ä¸­ï¼Œæ–¹æ³•æ¥æ”¶ä¸€ä¸ªModelå¯¹è±¡ï¼Œç„¶åå¯ä»¥å‘å…¶ä¸­æ·»åŠ ä»»æ„æ•°é‡çš„å±æ€§ï¼Œå¯ä»¥åœ¨æ ¹æ®éœ€è¦ï¼Œåœ¨ä¸¤ç§é£æ ¼ä¸­é€‰æ‹©åˆé€‚çš„ä¸€ç§ã€‚modelé‡Œçš„æ•°æ®ä¼šè¢«æ”¾å…¥åˆ°requestä¸­,é¡µé¢é€šè¿‡requeståŸŸå¯ä»¥è·å–åˆ°ã€‚ @SessionAttributeså’Œ@SessionAttribute@SessionAttributesæ³¨è§£çš„ä½¿ç”¨å°±æ˜¯å°†å±æ€§æ”¾å…¥sessionåŸŸå†…ï¼Œç„¶åå¯ä»¥åœ¨sessionåŸŸå†…è¿›è¡Œç›¸å…³çš„æ“ä½œã€‚ SpringMVCä¸­@ModelAttributeå’Œ@SessionAttributesæ³¨è§£çš„ä½¿ç”¨ @idï¼ˆå¥½åƒå¦‚æœè¡¨ä¸­æ•°æ®å­—æ®µæ˜¯idï¼Œä¼šæ¯”è¾ƒç‰¹æ®Šä¸€ç‚¹ï¼Œspringbootä¼šè‡ªåŠ¨æ£€ç´¢ä¼ è¿‡æ¥çš„å‚æ•°æ˜¯å¦æœ‰idï¼Œå¦‚æœæ²¡æœ‰ä¼šè‡ªåŠ¨æ·»åŠ idï¼‰ Repositoryç›¸å…³æ³¨è§£ Springbootçš„åˆ†é¡µå’Œæ’åºæ“ä½œç”±äºé‡‡ç”¨çš„æ˜¯Mongoæ•°æ®åº“ï¼Œæ‰€ä»¥å…ˆåä½¿ç”¨äº†MongoTemplate()å’ŒMongoRepository(),MongoTemplateåœ¨å†™æ³•ä¸Šæ¯”MongoRepository æ›´å¤æ‚ä¸€äº›ï¼Œä½†æ˜¯å¸¦æ¥æ›´å¤šçš„çµæ´»æ€§ã€‚å¯¹äºå¤æ‚çš„æŸ¥è¯¢æ“ä½œï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨MongoTemplateï¼Œå¯¹äºä¸€äº›ç®€å•çš„æŸ¥è¯¢æˆ‘ä»¬ä¼šä½¿ç”¨MongoRepository ã€‚å¯ä»¥è¿™ä¹ˆç†è§£ï¼ŒMongoRepository åªæ˜¯ä½œä¸ºä¸€ç§å¯¹äºç®€å•æŸ¥è¯¢çš„ç®€ä¾¿æ“ä½œï¼Œè€ŒMongoTemplateæ‰æ˜¯æˆ‘ä»¬åœ¨åšä¸€äº›å¤æ‚æŸ¥è¯¢æ—¶çš„é¦–é€‰ã€‚ MongoRepositoryè‡ªå·±è¿˜å€Ÿç”¨äº†ä¸‹@Queryå’Œ@Modifyingæ³¨è§£ï¼Œæ–¹ä¾¿è‡ªå·±æ‘†è„±å…³é”®å­—çš„æŸ¥è¯¢ï¼Œå¦‚æœéœ€è¦è¿›è¡Œæ›´æ–°æˆ–è€…åˆ é™¤æ•°æ®ï¼Œåˆ™éœ€è¦åœ¨@Queryä¹‹ä¸ŠåŠ ä¸Š@Modifingã€‚]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JSå­¦ä¹ ]]></title>
    <url>%2F2019%2F09%2F21%2FJS%E5%AD%A6%E4%B9%A0.html</url>
    <content type="text"><![CDATA[å­¦ä¹ è¿‡ç¨‹ï¼špromiseâ€”&gt;ç®­å¤´å‡½æ•°â€”&gt;ä½œç”¨åŸŸâ€”&gt;é—­åŒ… jsåŸºç¡€å…¥é—¨ç¯‡åŸºæœ¬è¯­æ³•å˜é‡æå‡JavaScript å¼•æ“çš„å·¥ä½œæ–¹å¼æ˜¯ï¼Œå…ˆè§£æä»£ç ï¼Œè·å–æ‰€æœ‰è¢«å£°æ˜çš„å˜é‡ï¼Œç„¶åå†ä¸€è¡Œä¸€è¡Œåœ°è¿è¡Œã€‚è¿™é€ æˆçš„ç»“æœï¼Œå°±æ˜¯æ‰€æœ‰çš„å˜é‡çš„å£°æ˜è¯­å¥ï¼Œéƒ½ä¼šè¢«æå‡åˆ°ä»£ç çš„å¤´éƒ¨ï¼Œè¿™å°±å«åšå˜é‡æå‡ï¼ˆhoistingï¼‰ã€‚å…¶ä¸­ï¼Œå‡½æ•°ååŒæ ·è¢«è§†ä¸ºå˜é‡åï¼Œæ‰€ä»¥ä¸€æ ·ä¼šè¢«æå‡åˆ°ä»£ç å¤´éƒ¨ã€‚ æ ‡è¯†ç¬¦ ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ï¼Œå¯ä»¥ä»¥ _ å’Œ $ å¼€å¤´ JavaScript æœ‰ä¸€äº›ä¿ç•™å­—ï¼Œä¸èƒ½ç”¨ä½œæ ‡è¯†ç¬¦ï¼šargumentsã€breakã€caseã€catchã€classã€constã€continueã€debuggerã€defaultã€deleteã€doã€elseã€enumã€evalã€exportã€extendsã€falseã€finallyã€forã€functionã€ifã€implementsã€importã€inã€instanceofã€interfaceã€letã€newã€nullã€packageã€privateã€protectedã€publicã€returnã€staticã€superã€switchã€thisã€throwã€trueã€tryã€typeofã€varã€voidã€whileã€withã€yieldã€‚ æ ‡ç­¾jså…è®¸è¯­å¥å‰é¢å¯ä»¥å¸¦æœ‰æ ‡ç­¾ï¼Œæ–¹ä¾¿è·³å‡ºå—åŒºåŸŸå’Œå¤šé‡å¾ªç¯ï¼Œå¸¸ä¸forå¾ªç¯ã€continueã€breakè¿ç”¨ã€‚ æ•°æ®ç±»å‹##nullï¼Œå¸ƒå°”å€¼ booleanå¦‚æœ JavaScript é¢„æœŸæŸä¸ªä½ç½®åº”è¯¥æ˜¯å¸ƒå°”å€¼ï¼Œä¼šå°†è¯¥ä½ç½®ä¸Šç°æœ‰çš„å€¼è‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼ã€‚è½¬æ¢è§„åˆ™æ˜¯é™¤äº†ä¸‹é¢å…­ä¸ªå€¼è¢«è½¬ä¸ºfalseï¼Œå…¶ä»–å€¼éƒ½è§†ä¸ºtrueã€‚ undefined null false 0 NaN â€œâ€æˆ–â€™â€™ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ æ³¨æ„ï¼Œ{}å’Œ[]éƒ½æ˜¯trueã€‚ æ•°å€¼ jsä¸­æ‰€æœ‰æ•°éƒ½æ˜¯å°æ•°ï¼Œ64ä½ï¼Œå…¶ä¸­ç¬¦å·ä½1ä½ï¼Œè¡¨ç¤ºæŒ‡æ•°çš„11ä½ï¼Œå‰©ä½™çš„52ä½è¡¨ç¤ºç²¾åº¦ï¼Œä½†æ˜¯ç”±äºè¡¨ç¤ºç²¾åº¦çš„æœ€é«˜ä½1.xxxxä¸­çš„1è¢«çœç•¥ï¼Œæ‰€ä»¥å¯ä»¥è¡¨ç¤º53ä½ç²¾åº¦ï¼› parseIntå³å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°å‹ï¼Œä¸ç®¡æ˜¯ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œéƒ½ä¼šå…ˆè½¬æ¢ä¸ºå­—ç¬¦ä¸²,å†è½¬ä¸ºæ•´æ•°å‹ï¼Œå…¶ä¸­ï¼ŒparseIntå¯ä»¥ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯è½¬æ¢è¿›åˆ¶å€¼ï¼› å­—ç¬¦ä¸² æƒ³è¾“å‡ºå¤šè¡Œå­—ç¬¦ä¸²ï¼Œæœ‰ä¸€ç§åˆ©ç”¨å¤šè¡Œæ³¨é‡Šçš„å˜é€šæ–¹æ³• 12345678(function () &#123; /*line 1line 2line 3*/&#125;).toString().split('\n').slice(1, -1).join('\n')// "line 1// line 2// line 3" Base64è½¬ç  Base64 å°±æ˜¯ä¸€ç§ç¼–ç æ–¹æ³•ï¼Œå¯ä»¥å°†ä»»æ„å€¼è½¬æˆ 0ï½9ã€Aï½Zã€a-zã€+å’Œ/è¿™64ä¸ªå­—ç¬¦ç»„æˆçš„å¯æ‰“å°å­—ç¬¦ã€‚ä½¿ç”¨å®ƒçš„ä¸»è¦ç›®çš„ï¼Œä¸æ˜¯ä¸ºäº†åŠ å¯†ï¼Œè€Œæ˜¯ä¸ºäº†ä¸å‡ºç°ç‰¹æ®Šå­—ç¬¦ï¼Œç®€åŒ–ç¨‹åºçš„å¤„ç†ã€‚ JavaScript åŸç”Ÿæä¾›ä¸¤ä¸ª Base64 ç›¸å…³çš„æ–¹æ³•ã€‚ btoa()ï¼šä»»æ„å€¼è½¬ä¸º Base64 ç¼–ç  atob()ï¼šBase64 ç¼–ç è½¬ä¸ºåŸæ¥çš„å€¼ 123var string = 'Hello World!';btoa(string) // "SGVsbG8gV29ybGQh"atob('SGVsbG8gV29ybGQh') // "Hello World!" * è¦å°†é ASCII ç å­—ç¬¦è½¬ä¸º Base64 ç¼–ç ï¼Œå¿…é¡»ä¸­é—´æ’å…¥ä¸€ä¸ªè½¬ç ç¯èŠ‚ï¼Œå†ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ 12345678910function b64Encode(str) &#123; return btoa(encodeURIComponent(str));&#125;function b64Decode(str) &#123; return decodeURIComponent(atob(str));&#125;b64Encode('ä½ å¥½') // "JUU0JUJEJUEwJUU1JUE1JUJE"b64Decode('JUU0JUJEJUEwJUU1JUE1JUJE') // "ä½ å¥½" å¯¹è±¡ å¯¹è±¡çš„å¼•ç”¨ä¸¤ä¸ªå˜é‡åŒæ—¶æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­ä»»ä½•ä¸€ä¸ªå˜é‡æ·»åŠ å±æ€§ï¼Œå¦ä¸€ä¸ªå˜é‡éƒ½å¯ä»¥è¯»å†™è¯¥å±æ€§ï¼Œä½†æ˜¯å¦‚æœå–æ¶ˆæŸä¸ªå˜é‡å¯¹äºåŸå¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶ä¸ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå˜é‡ï¼›æ³¨æ„:ä»…é™äºå¯¹è±¡ï¼Œå¦‚æœä¸¤ä¸ªå˜é‡åŒæ—¶æŒ‡å‘åŒä¸€ä¸ªåŸå§‹ç±»å‹çš„å€¼ï¼Œé‚£ä¹ˆå˜é‡æ­¤æ—¶éƒ½æ˜¯å€¼çš„æ‹·è´è€Œå·²ï¼› å¦‚æœè¡Œé¦–æ˜¯ä¸€ä¸ªå¤§æ‹¬å·ï¼Œjså¼•æ“ä¸€å¾‹å°†å…¶è§£é‡Šä¸ºä»£ç å—ï¼Œå¦‚æœæƒ³è¦è¡¨ç¤ºä¸ºå¯¹è±¡ï¼Œåˆ™å¿…é¡»åœ¨å¤§æ‹¬å·å‰åŠ ä¸Šä¸€ä¸ªåœ†æ‹¬å·ï¼Œè¿™ç§å·®å¼‚åœ¨evalè¯­å¥ï¼ˆä½œç”¨æ˜¯å¯¹å­—ç¬¦ä¸²æ±‚å€¼ï¼‰ä¸­ä½“ç°çš„å°¤ä¸ºæ˜æ˜¾ï¼› 12eval('&#123;foo: 123&#125;') // 123eval('(&#123;foo: 123&#125;)') // &#123;foo: 123&#125; å±æ€§è¯»å–ï¼šä¸€ç§ä½¿ç”¨ç‚¹è¿ç®—ç¬¦ï¼Œå¦å¤–ä¸€ç§é‡‡ç”¨æ–¹æ‹¬å·è¿ç®—ç¬¦ï¼Œæ³¨æ„è‹¥ä½¿ç”¨æ–¹æ‹¬å·è¿ç®—ç¬¦ï¼Œé”®åå¿…é¡»æ”¾åœ¨å¼•å·é‡Œé¢ï¼Œå¦åˆ™ä¼šè¢«å½“åšå˜é‡å¤„ç†ï¼š 123456789var foo = 'bar';var obj = &#123; foo: 1, bar: 2&#125;;obj.foo // 1obj[foo] // 2 æŸ¥çœ‹ä¸€ä¸ªå¯¹è±¡æœ¬èº«æ‰€æœ‰å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨Object.keysæ–¹æ³• 1234567var obj = &#123; key1: 1, key2: 2&#125;;Object.keys(obj);// ['key1', 'key2'] å±æ€§çš„éå†ï¼šforâ€¦in å¾ªç¯: å®ƒéå†çš„æ˜¯å¯¹è±¡æ‰€æœ‰å¯éå†ï¼ˆenumerableï¼‰çš„å±æ€§ï¼Œä¼šè·³è¿‡ä¸å¯éå†çš„å±æ€§ã€‚ å®ƒä¸ä»…éå†å¯¹è±¡è‡ªèº«çš„å±æ€§ï¼Œè¿˜éå†ç»§æ‰¿çš„å±æ€§ã€‚ 123456789101112var obj = &#123;a: 1, b: 2, c: 3&#125;;for (var i in obj) &#123; console.log('é”®åï¼š', i); console.log('é”®å€¼ï¼š', obj[i]);&#125;// é”®åï¼š a// é”®å€¼ï¼š 1// é”®åï¼š b// é”®å€¼ï¼š 2// é”®åï¼š c// é”®å€¼ï¼š 3 withè¯­å¥ï¼šä½œç”¨æ˜¯æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå±æ€§æ—¶ï¼Œæä¾›æ–¹ä¾¿ï¼Œä½†æ˜¯ä¸å»ºè®®ä½¿ç”¨ï¼Œå› ä¸ºåœ¨withè¯­å¥é‡Œé¢æ²¡æœ‰æ”¹å˜ä½œç”¨åŸŸï¼Œå¯¼è‡´ç»‘å®šå¯¹è±¡ä¸æ˜ç¡®ï¼Œå¦‚æœwithåŒºå—å†…éƒ¨æœ‰å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œå¿…é¡»æ˜¯å½“å‰å¯¹è±¡å·²ç»å­˜åœ¨çš„å±æ€§ï¼Œå¦åˆ™ä¼šåˆ›é€ ä¸€ä¸ªå½“å‰ä½œç”¨åŸŸçš„å…¨å±€å˜é‡ã€‚ 12345678var obj = &#123;&#125;;with (obj) &#123; p1 = 4; p2 = 5;&#125;obj.p1 // undefinedp1 // 4 å‡½æ•°å‡½æ•°å£°æ˜ functionå‘½ä»¤ 123function print(s)&#123; console.log(s);&#125; å‡½æ•°è¡¨è¾¾å¼(å¦‚æœfunctionåå¸¦å‡½æ•°åï¼Œå‡½æ•°åä¹Ÿåªåœ¨å‡½æ•°ä½“å†…éƒ¨æœ‰æ•ˆ) 1var print = function()&#123;console.log(s)&#125;; Functionæ„é€ å‡½æ•° 12345678910var add = new Function( 'x', 'y', 'return x + y');// ç­‰åŒäºfunction add(x, y) &#123; return x + y;&#125; å‡½æ•°ToStringå¯ä»¥è§£ææ³¨é‡Šå®ç°å¤šè¡Œå­—ç¬¦ä¸²ï¼š 12345678910111213var multiline = function (fn) &#123; var arr = fn.toString().split('\n'); return arr.slice(1, arr.length - 1).join('\n');&#125;;function f() &#123;/* è¿™æ˜¯ä¸€ä¸ª å¤šè¡Œæ³¨é‡Š*/&#125;multiline(f);// " è¿™æ˜¯ä¸€ä¸ª// å¤šè¡Œæ³¨é‡Š" å‡½æ•°ä½œç”¨åŸŸåœ¨ES6ä¸­ï¼Œæœ‰ä¸‰ç§ä½œç”¨åŸŸï¼šå…¨å±€ä½œç”¨åŸŸã€å—ä½œç”¨åŸŸã€å‡½æ•°ä½œç”¨åŸŸã€‚å‡½æ•°æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿæœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚å®ƒçš„ä½œç”¨åŸŸä¸å˜é‡ä¸€æ ·ï¼Œå°±æ˜¯å…¶å£°æ˜æ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸï¼Œä¸å…¶è¿è¡Œæ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸæ— å…³ã€‚ 1234567891011var a = 1;var x = function () &#123; console.log(a);&#125;;function f() &#123; var a = 2; x();&#125;f() // 1 ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°xæ˜¯åœ¨å‡½æ•°fçš„å¤–éƒ¨å£°æ˜çš„ï¼Œæ‰€ä»¥å®ƒçš„ä½œç”¨åŸŸç»‘å®šå¤–å±‚ï¼Œå†…éƒ¨å˜é‡aä¸ä¼šåˆ°å‡½æ•°fä½“å†…å–å€¼ï¼Œæ‰€ä»¥è¾“å‡º1ï¼Œè€Œä¸æ˜¯2ã€‚ æ€»ä¹‹ï¼Œå‡½æ•°æ‰§è¡Œæ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸï¼Œæ˜¯å®šä¹‰æ—¶çš„ä½œç”¨åŸŸï¼Œè€Œä¸æ˜¯è°ƒç”¨æ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸã€‚æ‰€ä»¥è¯´ï¼Œå¦‚æœå‡½æ•°Aè°ƒç”¨å‡½æ•°B,å‡½æ•°Bä¸ä¼šå¼•ç”¨å‡½æ•°Açš„å†…å®¹ã€‚ å‚æ•°ä¼ å€¼ å‡½æ•°å‚æ•°å¦‚æœæ˜¯åŸå§‹ç±»å‹çš„å€¼ï¼ˆæ•°å€¼ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ï¼‰ï¼Œä¼ é€’æ–¹å¼æ˜¯ä¼ å€¼ä¼ é€’ï¼› å‡½æ•°å‚æ•°å¦‚æœæ˜¯å¤åˆç±»å‹çš„å€¼ï¼ˆæ•°ç»„ã€å¯¹è±¡ã€å…¶ä»–å‡½æ•°ï¼‰ï¼Œä¼ é€’æ–¹å¼æ˜¯ä¼ å€ä¼ é€’ï¼› å‡½æ•°å†…éƒ¨ä¿®æ”¹çš„å¦‚æœæ˜¯å‚æ•°å¯¹è±¡çš„æŸä¸ªå±æ€§ï¼Œé‚£ä¹ˆä¼šå½±å“åˆ°åŸå§‹å€¼ï¼Œå¦‚æœæ˜¯æ›¿æ¢æ‰æ•´ä¸ªå‚æ•°ï¼Œåˆ™ä¸ä¼šå½±å“åˆ°åŸå§‹å€¼ï¼š 12345678var obj = [1, 2, 3];function f(o) &#123; o = [2, 3, 4];&#125;f(obj);obj // [1, 2, 3] arguments argumentså¯¹è±¡åŒ…å«äº†å‡½æ•°è¿è¡Œæ—¶çš„æ‰€æœ‰å‚æ•°ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å®ƒä¸èƒ½ç”¨æ•°ç»„ä¸­çš„sliceå’ŒforEachæ–¹æ³•ï¼› åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œargumentså¯¹è±¡å¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹ï¼Œä½†æ˜¯åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä¿®æ”¹argumentså¯¹è±¡çš„å€¼å¹¶ä¸ä¼šæ”¹å˜çœŸå®å‚æ•°çš„å€¼ï¼› å¦‚æœè¦è®©argumentså¯¹è±¡ä½¿ç”¨æ•°ç»„æ–¹æ³•ï¼ŒçœŸæ­£çš„è§£å†³åŠæ³•å°±æ˜¯è®©argumentså¯¹è±¡å˜ä¸ºæ•°ç»„ï¼Œå¸¸ç”¨çš„è½¬æ¢æ–¹æ³•æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯sliceæ–¹æ³•å’Œé€ä¸€å¡«å…¥æ–°æ•°ç»„ï¼š 1234567var args = Array.prototype.slice.call(arguments);// æˆ–è€…var args = [];for (var i = 0; i &lt; arguments.length; i++) &#123; args.push(arguments[i]);&#125; é—­åŒ…é—­åŒ…ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯å‡½æ•°ä¸­çš„å‡½æ•°ï¼Œé—­åŒ…æœ€å¤§çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯å®ƒå¯ä»¥â€œè®°ä½â€è¯ç”Ÿçš„ç¯å¢ƒï¼Œç”¨å¤„æœ‰ä¸‰ä¸ªï¼š 1. å¯ä»¥è¯»å–å‡½æ•°å†…éƒ¨çš„å˜é‡ï¼› 2. è®©è¿™äº›å˜é‡å§‹ç»ˆä¿æŒåœ¨å†…å­˜ä¸­ï¼Œå³é—­åŒ…å¯ä»¥ä½¿å¾—å®ƒè¯ç”Ÿç¯å¢ƒä¸€ç›´å­˜åœ¨; 3. å°è£…å¯¹è±¡çš„ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233function createIncrementor(start) &#123; return function () &#123; return start++; &#125;;&#125;var inc = createIncrementor(5);inc() // 5inc() // 6inc() // 7``` ```jsfunction Person(name) &#123; var _age; function setAge(n) &#123; _age = n; &#125; function getAge() &#123; return _age; &#125; return &#123; name: name, getAge: getAge, setAge: setAge &#125;;&#125;var p1 = Person('å¼ ä¸‰');p1.setAge(25);p1.getAge() // 25 â€œç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼â€ï¼ˆImmediately-Invoked Function Expressionï¼‰123(function()&#123; /* code */ &#125;());// æˆ–è€…(function()&#123; /* code */ &#125;)(); é€šå¸¸æƒ…å†µä¸‹ï¼Œåªå¯¹åŒ¿åå‡½æ•°ä½¿ç”¨è¿™ç§â€œç«‹å³æ‰§è¡Œçš„å‡½æ•°è¡¨è¾¾å¼â€ã€‚å®ƒçš„ç›®çš„æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯ä¸å¿…ä¸ºå‡½æ•°å‘½åï¼Œé¿å…äº†æ±¡æŸ“å…¨å±€å˜é‡ï¼›äºŒæ˜¯ IIFE å†…éƒ¨å½¢æˆäº†ä¸€ä¸ªå•ç‹¬çš„ä½œç”¨åŸŸï¼Œå¯ä»¥å°è£…ä¸€äº›å¤–éƒ¨æ— æ³•è¯»å–çš„ç§æœ‰å˜é‡ã€‚ eval æœ¬è´¨æ˜¯åœ¨å½“å‰åŸŸä¸­æ³¨å…¥ä»£ç ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”å°†è¯¥å­—ç¬¦ä¸²å½“åšè¯­å¥æ‰§è¡Œï¼Œå¦‚æœè¯†åˆ«ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™ä¼šåŸæ ·è¿”å›ã€‚ åŒæ—¶ï¼Œevalæ²¡æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œä¼šæ”¹å˜å½“å‰åŸŸåŸæœ‰å˜é‡çš„å€¼ï¼Œå½“ç„¶åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œevalå†…éƒ¨è‡ªå·±å£°æ˜çš„å˜é‡æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œä¸ä¼šå½±å“åˆ°å¤–éƒ¨ä½œç”¨åŸŸçš„å€¼ã€‚ ç”±äºå¼•æ“æ— æ³•åˆ†è¾¨evalçš„åˆ«åè°ƒç”¨ï¼Œæ‰€ä»¥åœ¨evalä½¿ç”¨åˆ«åæ—¶ï¼Œä¸€å¾‹éƒ½æ˜¯å…¨å±€ä½œç”¨åŸŸã€‚ æ•°ç»„æ•°ç»„éå† æ•°ç»„éå†å¯ä»¥è€ƒè™‘ä½¿ç”¨forå¾ªç¯ã€whileå¾ªç¯ã€forEachå¾ªç¯ï¼Œä¼šè¿”å›é”®å€¼ï¼ˆé”®åä¸ºæ•´æ•°ï¼‰ï¼Œforâ€¦inâ€¦å¾ªç¯ä¼šåŒæ—¶éå†éæ•´æ•°é”®ï¼ˆè¿”å›çš„æ˜¯é”®åï¼‰ï¼› æ•°ç»„éå†ç©ºä½æ—¶ï¼Œéœ€è¦æ ¼å¤–æ³¨æ„ï¼Œç©ºä½å’Œundefinedæ˜¯ä¸ä¸€æ ·çš„ï¼Œç©ºä½è¡¨ç¤ºæ•°ç»„ä¸­æ²¡æœ‰è¿™ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥åœ¨forâ€¦inâ€¦å’ŒforEachå¾ªç¯ä¸­ä¸ä¼šè¢«éå†åˆ°ï¼Œä½†æ˜¯undefinedä»£è¡¨æ•°ç»„æœ‰è¿™ä¸ªå…ƒç´ ï¼Œæ˜¯ä¼šéå†åˆ°çš„ï¼› è¿ç®—ç¬¦ç®—æœ¯è¿ç®—ç¬¦åŠ æ³•è¿ç®—ç¬¦ å¯¹è±¡çš„ç›¸åŠ å¦‚æœè¿ç®—å­æ˜¯å¯¹è±¡ï¼Œå¿…é¡»å…ˆè½¬æˆåŸå§‹ç±»å‹çš„å€¼ï¼Œå¼•æ“ä¼šè‡ªåŠ¨è°ƒç”¨obj.valueof().toString(),æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡æ–°valueOf()å’ŒtoString()æ–¹æ³•å³å¯ï¼Œå…¶ä¸­æœ‰ä¸ªç‰¹ä¾‹ï¼Œå½“è¿ç®—å­æ˜¯ä¸€ä¸ªDateå¯¹è±¡çš„å®ä¾‹ï¼Œé‚£ä¹ˆä¼šä¼˜å…ˆæ‰§è¡ŒtoStringæ–¹æ³•ã€‚ æŒ‡æ•°è¿ç®—ç¬¦** ä¸ºæŒ‡æ•°è¿ç®—ç¬¦ï¼Œæ˜¯å³ç»“åˆçš„ï¼Œå½“ç„¶ï¼Œä¸‰å…ƒæ¡ä»¶è¿ç®—ç¬¦ä¹Ÿæ˜¯å³ç»“åˆçš„ï¼Œå½“ç„¶è¿˜æœ‰èµ‹å€¼è¿ç®—ç¬¦ï¼ˆ=ï¼‰ä¹Ÿæ˜¯å³ç»“åˆçš„ã€‚ æ¯”è¾ƒè¿ç®—ç¬¦ ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦JavaScript æä¾›ä¸¤ç§ç›¸ç­‰è¿ç®—ç¬¦ï¼š== å’Œ === ã€‚ç®€å•è¯´ï¼Œå®ƒä»¬çš„åŒºåˆ«æ˜¯ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ==ï¼‰æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ===ï¼‰æ¯”è¾ƒå®ƒä»¬æ˜¯å¦ä¸ºâ€œåŒä¸€ä¸ªå€¼â€ã€‚å¦‚æœä¸¤ä¸ªå€¼ä¸æ˜¯åŒä¸€ç±»å‹ï¼Œä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ===ï¼‰ç›´æ¥è¿”å›falseï¼Œè€Œç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ==ï¼‰ä¼šå°†å®ƒä»¬è½¬æ¢æˆåŒä¸€ä¸ªç±»å‹ï¼Œå†ç”¨ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦è¿›è¡Œæ¯”è¾ƒã€‚tip: undefinedå’Œnullä¸è‡ªèº«ä¸¥æ ¼ç›¸ç­‰å¸ƒå°”è¿ç®—ç¬¦ç•¥äºŒè¿›åˆ¶ä½è¿ç®—ç¬¦ç•¥ å…¶ä»–è¿ç®—ç¬¦ï¼Œè¿ç®—é¡ºåºvoid è¿ç®—ç¬¦voidè¿ç®—ç¬¦çš„ä½œç”¨æ˜¯æ‰§è¡Œä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç„¶åä¸è¿”å›ä»»ä½•å€¼ï¼Œæˆ–è€…è¯´è¿”å›undefinedï¼Œä¸»è¦ç”¨é€”æ˜¯æµè§ˆå™¨çš„ä¹¦ç­¾å·¥å…·ï¼Œä»¥åŠåœ¨è¶…é“¾æ¥ä¸­æ’å…¥ä»£ç é˜²æ­¢ç½‘é¡µè·³è½¬ã€‚ è¯­æ³•ä¸“é¢˜é”™è¯¯å¤„ç†æœºåˆ¶åŸç”Ÿé”™è¯¯ç±»å‹ SyntaxError ReferenceError RangeError TypeError URIError EvalError è‡ªå®šä¹‰é”™è¯¯é™¤äº† JavaScript åŸç”Ÿæä¾›çš„ä¸ƒç§é”™è¯¯å¯¹è±¡ï¼Œè¿˜å¯ä»¥å®šä¹‰è‡ªå·±çš„é”™è¯¯å¯¹è±¡ 1234567function UserError(message) &#123; this.message = message || 'é»˜è®¤ä¿¡æ¯'; this.name = 'UserError';&#125;UserError.prototype = new Error();UserError.prototype.constructor = UserError; ä¸Šé¢ä»£ç è‡ªå®šä¹‰ä¸€ä¸ªé”™è¯¯å¯¹è±¡UserErrorï¼Œè®©å®ƒç»§æ‰¿Errorå¯¹è±¡ã€‚ç„¶åï¼Œå°±å¯ä»¥ç”Ÿæˆè¿™ç§è‡ªå®šä¹‰ç±»å‹çš„é”™è¯¯äº† 1new UserError('è¿™æ˜¯è‡ªå®šä¹‰çš„é”™è¯¯ï¼'); æ ‡å‡†åº“Objectå››ä¸ªç”¨æ³•ï¼š Objectæœ¬èº«å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥å°†ä»»æ„å€¼è½¬æ¢ä¸ºå¯¹è±¡ï¼› ä¸ä»…å¯ä»¥å½“åšå·¥å…·å‡½æ•°ä½¿ç”¨ï¼Œè¿˜å¯ä»¥å½“åšæ„é€ å‡½æ•°ä½¿ç”¨ï¼Œå³å‰é¢å¯ä»¥åŠ newå‘½ä»¤ï¼› 1æ³¨æ„ï¼Œé€šè¿‡var obj = new Object()çš„å†™æ³•ç”Ÿæˆæ–°å¯¹è±¡ï¼Œä¸å­—é¢é‡çš„å†™æ³•var obj = &#123;&#125;æ˜¯ç­‰ä»·çš„ã€‚æˆ–è€…è¯´ï¼Œåè€…åªæ˜¯å‰è€…çš„ä¸€ç§ç®€ä¾¿å†™æ³•ã€‚ Objectçš„é™æ€æ–¹æ³•ï¼Œä¾‹å¦‚Object.print,æŒ‡éƒ¨ç½²åœ¨Objectå¯¹è±¡è‡ªèº«çš„æ–¹æ³•ï¼› Objectçš„å®ä¾‹æ–¹æ³•ï¼Œå³å®šä¹‰åœ¨Object.prototypeå¯¹è±¡ä¸Šçš„æ–¹æ³•ã€‚ Object.prototype.valueof() Object.prototype.toString() Object.prototype.toLocaleString() Object.prototype.hasOwnProperty() Object.prototype.isPrototypeof() Object.prototype.propertyIsEnumerable() å±æ€§æè¿°å¯¹è±¡jsæä¾›äº†ä¸€ä¸ªå†…éƒ¨æ•°æ®ç»“æ„ï¼Œç”¨æ¥æè¿°å¯¹è±¡çš„å±æ€§ï¼Œæ¯”å¦‚æ˜¯å¦å¯å†™å¯è¯»å¯éå†ï¼Œè¿™ä¸ªå†…éƒ¨æ•°æ®ç»“æ„å°±ç§°ä¹‹ä¸ºâ€œå±æ€§æè¿°å¯¹è±¡â€ã€‚ tip:Object.getOwnPropertyNamesæ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜æ˜¯å‚æ•°å¯¹è±¡è‡ªèº«çš„å…¨éƒ¨å±æ€§çš„å±æ€§åï¼Œä¸ç®¡è¯¥å±æ€§æ˜¯å¦å¯éå†ã€‚è€Œè¿™è·ŸObject.keysçš„è¡Œä¸ºä¸åŒï¼ŒObject.keysåªè¿”å›å¯¹è±¡è‡ªèº«çš„å¯éå†å±æ€§çš„å…¨éƒ¨å±æ€§åã€‚ 123456789101112Object.keys([]) // []Object.getOwnPropertyNames([]) // [ 'length' ]Object.keys(Object.prototype) // []Object.getOwnPropertyNames(Object.prototype)// ['hasOwnProperty',// 'valueOf',// 'constructor',// 'toLocaleString',// 'isPrototypeOf',// 'propertyIsEnumerable',// 'toString'] ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„è‡ªèº«çš„lengthå±æ€§æ˜¯ä¸å¯éå†çš„ï¼ŒObject.keysä¸ä¼šè¿”å›è¯¥å±æ€§ã€‚ç¬¬äºŒä¸ªä¾‹å­çš„Object.prototypeä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½ä¼šç»§æ‰¿å®ƒï¼Œå®ƒè‡ªèº«çš„å±æ€§éƒ½æ˜¯ä¸å¯éå†çš„ã€‚ Object.defineProperty(),Object.defineProperties()Object.defineProperty()æ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ¬¡å¦‚ä¸‹ï¼š Objectï¼šå±æ€§æ‰€åœ¨çš„å¯¹è±¡ propertyName:å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå±æ€§å attributesObject:å±æ€§æè¿°å¯¹è±¡ 1234567891011var obj = Object.defineProperty(&#123;&#125;, 'p', &#123; value: 123, writable: false, enumerable: true, configurable: false&#125;);obj.p // 123obj.p = 246;obj.p // 123 Object.defineProperties()æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œå¦‚ä¸‹ï¼š 123456789101112var obj = Object.defineProperties(&#123;&#125;, &#123; p1: &#123; value: 123, enumerable: true &#125;, p2: &#123; value: 'abc', enumerable: true &#125;, p3: &#123; get: function () &#123; return this.p1 + this.p2 &#125;, enumerable:true, configurable:true &#125;&#125;);obj.p1 // 123obj.p2 // "abc"obj.p3 // "123abc" Object.prototype.propertyIsEnumerable()è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨æ¥åˆ¤æ–­è‡ªèº«å±æ€§æ˜¯å¦å¯ä»¥éå†ã€‚Object.keysæ˜¯è¿”å›æ‰€æœ‰å¯ä»¥éå†çš„å±æ€§ï¼Œä¸åŒ…æ‹¬ç»§æ‰¿çš„å±æ€§ï¼Œè€ŒObject.getOwnPropertyNamesåˆ™æ˜¯è¿”å›åŒ…æ‹¬ç»§æ‰¿çš„å±æ€§åœ¨å†…çš„æ‰€æœ‰å¯ä»¥éå†çš„å±æ€§ã€‚ es6å…¥é—¨lenå’Œconstå‘½ä»¤lenlenæ²¡æœ‰å˜é‡æå‡å¿…é¡»å…ˆå£°æ˜åæ‰èƒ½ä½¿ç”¨ï¼Œæ³¨æ„lenå˜é‡åªåœ¨å—åŒºåŸŸå†…æœ‰ç”¨ï¼Œæ˜¯å—çº§ä½œç”¨åŸŸï¼Œè€Œvarä¸åŒï¼Œvarå…·æœ‰å…¨å±€ä½œç”¨åŸŸã€å‡½æ•°ä½œç”¨åŸŸï¼› æš‚æ—¶æ€§æ­»åŒº123456var tmp = 123;if (true) &#123; tmp = 'abc'; // ReferenceError let tmp;&#125; åœ¨ä»£ç å—å†…ï¼Œä½¿ç”¨letå‘½ä»¤å£°æ˜å˜é‡ä¹‹å‰ï¼Œè¯¥å˜é‡éƒ½æ˜¯ä¸å¯ç”¨çš„ã€‚è¿™åœ¨è¯­æ³•ä¸Šï¼Œç§°ä¸ºâ€œæš‚æ—¶æ€§æ­»åŒºâ€ï¼ˆtemporal dead zoneï¼Œç®€ç§° TDZï¼‰ã€‚éå¸¸éšè”½çš„â€œæ­»åŒºâ€ï¼š 12345function bar(x = y, y = 2) &#123; return [x, y];&#125;bar(); // æŠ¥é”™ é¡¶å±‚å¯¹è±¡çš„å±æ€§é¡¶å±‚å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ç¯å¢ƒæŒ‡çš„æ˜¯windowå¯¹è±¡ï¼Œåœ¨ Node æŒ‡çš„æ˜¯globalå¯¹è±¡ã€‚ES5 ä¹‹ä¸­ï¼Œé¡¶å±‚å¯¹è±¡çš„å±æ€§ä¸å…¨å±€å˜é‡æ˜¯ç­‰ä»·çš„ã€‚ä½†åœ¨ES6ä¸­ï¼Œvarå‘½ä»¤å’Œfunctionå‘½ä»¤å£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¾æ—§æ˜¯é¡¶å±‚å¯¹è±¡çš„å±æ€§ï¼›å¦ä¸€æ–¹é¢è§„å®šï¼Œletå‘½ä»¤ã€constå‘½ä»¤ã€classå‘½ä»¤å£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¸å±äºé¡¶å±‚å¯¹è±¡çš„å±æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä» ES6 å¼€å§‹ï¼Œå…¨å±€å˜é‡å°†é€æ­¥ä¸é¡¶å±‚å¯¹è±¡çš„å±æ€§è„±é’©ã€‚ 1234567var a = 1;// å¦‚æœåœ¨ Node çš„ REPL ç¯å¢ƒï¼Œå¯ä»¥å†™æˆ global.a// æˆ–è€…é‡‡ç”¨é€šç”¨æ–¹æ³•ï¼Œå†™æˆ this.awindow.a // 1let b = 1;window.b // undefined node jså…¥é—¨]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨Microsoft Remote Desktop for mac å’Œ Sparké‚®ç®±]]></title>
    <url>%2F2019%2F09%2F21%2F%E4%BD%BF%E7%94%A8Microsoft-Remote-Desktop-for-mac-%E5%92%8C-Spark%E9%82%AE%E7%AE%B1.html</url>
    <content type="text"><![CDATA[å‰è¨€ç”±äºè¿‘æœŸéœ€è¦è¿œç¨‹æ§åˆ¶windowsæœåŠ¡å™¨ï¼Œæ‰€ä»¥éœ€è¦é€‰æ‹©ä¸€ä¸ªè¿œç¨‹æ“æ§çš„è½¯ä»¶ï¼Œç”±äºmacç«¯å¹¶æ²¡æœ‰åµŒå…¥ç›¸å…³çš„åŠŸèƒ½ï¼Œåªèƒ½é€‰æ‹©Microsoft Remote Desktopï¼Œå¹¶ä¸”é—æ†¾çš„æ˜¯ï¼Œåœ¨ä¸­å›½åŒºçš„app storeå¹¶æ²¡æœ‰å…è®¸å…¶ä¸Šçº¿ï¼Œæ‰€ä»¥è¦åšçš„ç¬¬ä¸€æ­¥å°±æ˜¯ç”³è¯·ä¸€ä¸ªç¾åŒºè´¦å·ã€‚ æ­¥éª¤ chromeæ‰“å¼€apple idæ³¨å†Œ æŒ‰æ­¥éª¤æ³¨å†Œï¼Œå›½å®¶å¡«å†™ç¾å›½ï¼Œæ³¨å†Œå®Œæˆä¹‹åéœ€è¦ç™»å½•ä¸€ä¸‹ ç™»å½•çš„æ—¶å€™ä¼šè¦æ±‚å¡«å†™åœ°å€ï¼Œä»¥ä¸‹æ˜¯å¯ç”¨çš„ä¿¡æ¯è¡—é“: 4114 Sepulveda Blvdï¼ŒåŸå¸‚: Culver Cityï¼Œå·: CAé‚®ç¼–: 90230ç”µè¯: (626) 339-6***å•†å®¶åç§°: Clippinger Chevrolet Oldsmobileæ³¨æ„ç”µè¯å·ç åä¸‰ä½éšä¾¿å¡«å†™å‡ ä¸ªæ•°å­— ç™»å½•App Storeï¼Œç„¶åä¸‹è½½å³å¯ä½¿ç”¨ Sparkå†™è¿™ä¸ªä¸»è¦æ˜¯æƒ³åæ§½ä¸€ä¸‹ï¼Œçœ‹åˆ°ç½‘ä¸Šbä¹å„ç§è¯´sparkå¯ä»¥æ¥æ”¶æ¨é€ï¼Œå³ä½¿æ²¡æœ‰æ‰“å¼€è½¯ä»¶ï¼Œæˆ‘æƒ³è¯´ç®€ç›´æ˜¯æ”¾å±å•Šï¼Œå¯¼è‡´æˆ‘æŸ¥äº†å‡ ä¸ªå°æ—¶éƒ½æ²¡èƒ½æˆåŠŸï¼Œæ ¹æœ¬åšä¸åˆ°å¥½å—ï¼ï¼ï¼ä¸ä¿¡ï¼Ÿçœ‹å®˜ç½‘æ€ä¹ˆè¯´çš„ â€”â€”â€“&gt;Sparkå¸®åŠ©ä¸­å¿ƒæ‰€ä»¥åªèƒ½ä¸€ç›´å¼€ç€äº†â€¦åƒåœ¾çš„ä¸€æ‰¹ï¼ï¼ï¼ï¼ï¼ï¼]]></content>
      <categories>
        <category>åæ§½</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æœ€è¿‘äº‹å®œ]]></title>
    <url>%2F2019%2F09%2F01%2F%E6%9C%80%E8%BF%91%E4%BA%8B%E5%AE%9C.html</url>
    <content type="text"><![CDATA[æœ€è¿‘ç”Ÿç—…äº†â€¦åŠ ä¸Šå¼€å­¦äº‹æƒ…å¾ˆå¤šâ€¦åœæ›´äº†ä¸€ä¸ªæ˜ŸæœŸ æ¥ä¸‹æ¥ä¼šæ…¢æ…¢è·Ÿä¸Šçš„åŠ æ²¹ğŸ†™]]></content>
      <categories>
        <category>åæ§½</category>
      </categories>
      <tags>
        <tag>è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flask + PyJWT å®ç°åŸºäºJson Web Tokençš„ç”¨æˆ·è®¤è¯æˆæƒ]]></title>
    <url>%2F2019%2F08%2F23%2FFlask-PyJWT-%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8EJson-Web-Token%E7%9A%84%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83.html</url>
    <content type="text"><![CDATA[å‰è¨€è¿™æ³¨å®šåˆå°†æ˜¯ä¸€ç¯‡é•¿æ–‡ï¼Œæ¥è§¦åˆ°çš„ç¬¬ä¸€ä¸ªå…³äºpythonçš„æ¡†æ¶flaskï¼Œæœ¬æ–‡å°†ä»æœ€å¼€å§‹çš„å®‰è£…flaskï¼Œåˆ°ä¸mysqlç»“åˆï¼Œæœ€ååˆ°ç”¨pyjwtå’Œflask-jwtå’Œrestfulå†™ä¸€ä¸ªå¸¦æœ‰tokençš„æ¥å£ã€‚ æŠ€æœ¯æ ˆç®€ä»‹Flaskæ˜¯ä¸€ä¸ªä½¿ç”¨Pythonç¼–å†™çš„è½»é‡çº§Webåº”ç”¨æ¡†æ¶ã€‚åŸºäºWerkzeug WSGI(PythonWebæœåŠ¡å™¨ç½‘å…³æ¥å£ï¼ˆPython Web Server Gateway Interfaceï¼Œç¼©å†™ä¸ºWSGI)æ˜¯Pythonåº”ç”¨ç¨‹åºæˆ–æ¡†æ¶å’ŒWebæœåŠ¡å™¨ä¹‹é—´çš„ä¸€ç§æ¥å£ï¼Œå·²ç»è¢«å¹¿æ³›æ¥å—, å®ƒå·²åŸºæœ¬è¾¾æˆå®ƒçš„å¯ç§»æ¤æ€§æ–¹é¢çš„ç›®æ ‡)å·¥å…·ç®±å’ŒJinja2 æ¨¡æ¿å¼•æ“ã€‚ Flaskä½¿ç”¨BSDæˆæƒã€‚ Flaskä¹Ÿè¢«ç§°ä¸ºâ€œmicroframeworkâ€ï¼Œå› ä¸ºå®ƒä½¿ç”¨ç®€å•çš„æ ¸å¿ƒï¼Œç”¨extensionå¢åŠ å…¶ä»–åŠŸèƒ½ã€‚Flaskæ²¡æœ‰é»˜è®¤ä½¿ç”¨çš„æ•°æ®åº“ã€çª—ä½“éªŒè¯å·¥å…·ã€‚ç„¶è€Œï¼ŒFlaskä¿ç•™äº†æ‰©å¢çš„å¼¹æ€§ï¼Œå¯ä»¥ç”¨Flask-extensionåŠ å…¥è¿™äº›åŠŸèƒ½ï¼šORMã€çª—ä½“éªŒè¯å·¥å…·ã€æ–‡ä»¶ä¸Šä¼ ã€å„ç§å¼€æ”¾å¼èº«ä»½éªŒè¯æŠ€æœ¯ SQLAlchemyFlaskæ˜¯ä¸€ä¸ªå¾®å‹æ¡†æ¶ï¼Œè‡ªèº«æ²¡æœ‰æä¾›æ•°æ®åº“ç®¡ç†ï¼Œè¡¨å•éªŒè¯ï¼Œcookieå¤„ç†ç­‰åŠŸèƒ½ï¼Œå¾ˆå¤šåŠŸèƒ½éœ€è¦é€šè¿‡æ‰©å±•æ‰èƒ½å®ç°ï¼Œæ•°æ®åº“ç®¡ç†å°±éœ€è¦SQLAlchemyã€‚SqlAlchemyæ˜¯Pythonç¼–ç¨‹è¯­è¨€ä¸‹çš„ä¸€æ¬¾ORMæ¡†æ¶ï¼Œè¯¥æ¡†æ¶å»ºç«‹åœ¨æ•°æ®åº“APIä¹‹ä¸Šï¼Œä½¿ç”¨å…³ç³»å¯¹è±¡æ˜ å°„è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œç®€è€Œè¨€ä¹‹ï¼šå°†å¯¹è±¡è½¬æ¢æˆSQLï¼Œç„¶åä½¿ç”¨æ•°æ®APIæ‰§è¡ŒSQLå¹¶è·å–æ‰§è¡Œç»“æœã€‚ The first demo123456789from flask import Flaskapp = Flask(__name__)@app.route("/")def index(): return "hello world"if __name__ == '__main__': app.run() ç¬¬ä¸€è¡Œ fromâ€¦importâ€¦å°±æ˜¯å¯¼å…¥flaskä¸­çš„Flaskæ¨¡å—ï¼Œä¸åŒäºç›´æ¥importï¼Œfromâ€¦importç®€å•æ¥è¯´å°±æ˜¯å¸®æˆ‘ä»è½¦é‡Œæ‹¿ç“¶æ°´ï¼Œè€Œimportåˆ™æ˜¯æŠŠè½¦æ‹¿è¿‡æ¥ï¼Œæ‰€ä»¥äºŒè€…åœ¨ä½¿ç”¨çš„æ—¶å€™è¿˜æ˜¯æœ‰äº›åŒºåˆ«çš„ï¼Œåœ¨å¯¼å…¥æŸä¸ª.pyæ–‡ä»¶æ—¶ï¼Œä½¿ç”¨fromâ€¦importâ€¦å¯ä»¥ç›´æ¥åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨importåçš„å‡½æ•°åï¼Œè€Œå¦‚æœæ˜¯importï¼Œå¦‚æœè¦è°ƒç”¨å‡½æ•°å¿…é¡»ç”¨ç±».æ¨¡å—ã€‚ ç¬¬äºŒè¡Œ è¿™è¡Œä»£ç é‡Œæœ‰ä¸€ä¸ªå‚æ•°nameï¼Œè¿™ä¸ªå‚æ•°ç”¨åˆ°å‘Šè¯‰flaskä½ çš„applicationçš„åå­—ï¼Œå®˜æ–¹æœ‰ä¸€å¥è¯ï¼š 12If you are using a single module,__name__ is always the correct value.If you however are using a package, itâ€™s usually recommended to hardcode the name ofyour package there. æ„æ€å°±æ˜¯è¯´ï¼Œå¦‚æœæ˜¯å•ä¸€çš„åº”ç”¨ï¼Œç”¨nameå°±å¯ä»¥äº†ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºåŒ…ï¼Œå°±hardcodeä¸€ä¸ªåå­—ç»™è¿™ä¸ªå‚æ•°ã€‚æ¯”å¦‚ï¼š 1app = Flask(â€œmyAppâ€) ç”±äºç›®å‰æˆ‘ä»¬çš„åº”ç”¨éƒ½ç›¸å¯¹ç®€å•ï¼Œæ‰€ä»¥ç»Ÿä¸€ä½¿ç”¨nameä½œä¸ºå‚æ•°ã€‚ ç¬¬ä¸‰è¡Œ ä½¿ç”¨route()ä¿®é¥°å™¨æ³¨æ˜é€šè¿‡ä»€ä¹ˆæ ·çš„urlå¯ä»¥è®¿é—®æˆ‘ä»¬çš„å‡½æ•°ï¼ŒåŒæ—¶åœ¨å‡½æ•°ä¸­è¿”å›è¦æ˜¾ç¤ºåœ¨æµè§ˆå™¨ä¸­çš„ä¿¡æ¯ã€‚ æœ€å è°ƒç”¨run()æ–¹æ³•ï¼Œè¿è¡Œflask webåº”ç”¨ç¨‹åº 12if __name__ == '__main__': app.run() å…¶ä¸­if __name__==&#39;__main__&#39;çš„æ„æ€æ˜¯ï¼Œå¦‚æœæ­¤æ–‡ä»¶æ˜¯ç›´æ¥è¿è¡Œçš„æ‰ä¼šæ‰§è¡Œapp.run()è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœæ˜¯é€šè¿‡importåœ¨å…¶å®ƒpyæ–‡ä»¶ä¸­è°ƒç”¨çš„è¯æ˜¯ä¸ä¼šæ‰§è¡Œçš„ã€‚ æ¯”å¦‚æˆ‘ä»¬ä¿®æ”¹code.pyä¸­çš„hello_worldæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š 1234567@app.route('/index')def hello_world(): if __name__=='main': return 'Hello World!' else: return "hello my name is "+__name__ å³å½“nameä¸ºmainæ—¶è¿˜æ˜¯æ‰§è¡ŒåŸæ¥çš„é€»è¾‘ï¼Œè¿”å›hello worldï¼Œå¦‚æœä¸æ˜¯åˆ™è¾“å‡ºæ­¤æ—¶çš„åå­—ã€‚ ç„¶åæˆ‘ä»¬æ–°å»ºä¸€ä¸ªsub.pyæ–‡ä»¶ç„¶åå¯¼å…¥code.pyï¼Œå¹¶ä¸”æ‰§è¡Œhello_worldæ–¹æ³•: 1234567import codedef CallCodeFun(): result = code.hello_world() print(result)CallCodeFun()print(__name__) æ­¤æ—¶çš„nameæ˜¯Codeè€Œä¸æ˜¯mainï¼Œè€Œæ­¤æ—¶ï¼Œåœ¨sub.pyä¸­åŠ ä¸€å¥print(name)å¯ä»¥å‘ç°sub.pyä¸­çš„nameå˜æˆäº†main ç”±æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡º name å¦‚æœæ˜¯ main é‚£ä¹ˆä»£è¡¨ä»–æ˜¯ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œç›´æ¥æ‰§è¡Œçš„ã€‚ tip:å»ºæ–‡ä»¶æ—¶æ–‡ä»¶åæœ€å¥½ä¸è¦å«codeï¼Œå› ä¸ºpythonæœ‰æ¨¡å—åå°±å«codeã€‚ flask-sqlalchemy æ•°æ®åº“é…ç½®ï¼Œä¸Šdemo 12345678910111213141516171819202122from flask_sqlalchemy import SQLAlchemyfrom flask import Flaskimport configparser# å‘Šè¯‰flask appçš„åå­—app = Flask(__name__)//é€šè¿‡configparserè·å–è¯»å–é…ç½®æ–‡ä»¶çš„è§£é‡Šå™¨my_config = configparser.ConfigParser()my_config.read('db.conf')# dialect+driver://username:password@host:port/database?charset=utf8# é…ç½® sqlalchemy æ•°æ®åº“é©±åŠ¨://æ•°æ®åº“ç”¨æˆ·å:å¯†ç @ä¸»æœºåœ°å€:ç«¯å£/æ•°æ®åº“?ç¼–ç # py3æ— æ³•ç»§ç»­ä½¿ç”¨sqldbï¼Œæ‰€ä»¥é‡‡ç”¨pymysqlapp.config['SQLALCHEMY_DATABASE_URI'] = 'mysql://' + my_config.get('DB', 'DB_USER') + ':' + \ my_config.get('DB', 'DB_PASSWORD') + '@' + my_config.get('DB', 'DB_HOST') + '/' + \ my_config.get('DB', 'DB_DB') # è®¾ä¸ºTrue è¡¨ç¤ºæ¯æ¬¡è¯·æ±‚ç»“æŸåéƒ½ä¼šè‡ªåŠ¨æäº¤æ•°æ®åº“çš„å˜åŠ¨ï¼Œä½†åƒadd delete insertç­‰ä»éœ€è¦commit,å»ºè®®ä¸è¦è®¾ä¸ºtrueapp.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = Truemydb = SQLAlchemy()mydb.init_app(app)if __name__ == "__main__": app.run(debug=True) ä¸ºäº†ä½¿ä»£ç ç»“æ„æ›´æ¸…æ™°ï¼Œè¿™é‡Œä½¿ç”¨å¦ä¸€ç§é…ç½®æ–¹å¼ï¼Œå³ä½¿ç”¨å•ç‹¬é…ç½®æ–‡ä»¶çš„æ–‡ä»¶æ¥åšå…¨å±€Flaské…ç½® ç®¡æ§æ‰€æœ‰çš„é…ç½®æ–‡ä»¶conf.py: 1234567DB_USER = 'root'DB_PASSWORD = 'jwyjwy9951206-=-'DB_HOST = 'localhost'DB_DB = 'flask_migrate_demo'DEBUG = True SQLALCHEMY_TRACK_MODIFICATIONS = FalseSQLALCHEMY_DATABASE_URI = 'mysql+pymysql://' + DB_USER + ':' + DB_PASSWORD + '@' + DB_HOST + '/' + DB_DB SQLAlchemyå…è®¸æˆ‘ä»¬æ ¹æ®æ•°æ®åº“çš„è¡¨ç»“æ„æ¥åˆ›å»ºæ•°æ®æ¨¡å‹ï¼Œåä¹‹äº¦å¯ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬æ— é¡»æ‰‹åŠ¨çš„ç™»å½•åˆ°æ•°æ®åº“ä¸­ä½¿ç”¨ SQL è¯­å¥æ¥åˆ›å»ºè¡¨, æˆ‘ä»¬åªéœ€æŠŠæ•°æ®æ¨¡å‹å®šä¹‰å¥½äº†ä¹‹å, è¡¨ç»“æ„ä¹Ÿå°±æœ‰äº† æ–°å»ºmodel.pyï¼Œå¹¶å®šä¹‰ä¸€ä¸ªç”¨æˆ·è¡¨æ•°æ®æ¨¡å‹ 12345678from flask_sqlalchemy import SQLAlchemydb = SQLAlchemy()class User(db.Model):user_id = db.Column(db.Integer, primary_key=True)user_name = db.Column(db.String(60), nullable=False)user_password = db.Column(db.String(30), nullable=False)user_nickname = db.Column(db.String(50))user_email = db.Column(db.String(30), nullable=False) æ–°å»ºdb.pyï¼Œåˆ©ç”¨Flask-Scriptå’ŒFlask-Migrateï¼Œæ­å»ºdbå’Œappä¹‹é—´çš„æ¡¥æ¢ 1234567891011from flask import Flaskfrom flask_script import Managerfrom flask_migrate import Migrate, MigrateCommandfrom model import dbapp = Flask(__name__)app.config.from_object('conf')migrate = Migrate(app, db)manager = Manager(app)manager.add_command('db', MigrateCommand)if __name__ == '__main__':manager.run() Flask-Scriptå’ŒFlask-Migrateä½¿ç”¨ æœ€åï¼Œåœ¨pycharmçš„æ§åˆ¶å°æ‰“ä¸‹ä¸‰è¡Œè¿ç§»ä»£ç ï¼Œè¿™æ ·å°±èƒ½åœ¨æ•°æ®åº“ä¸­çœ‹è§è·Ÿmodelå­—æ®µä¸€æ ·çš„è¡¨äº† 123python db.py db initpython db.py db migratepython db.py db upgrade ç¤ºä¾‹æ¥å£å®ç° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091# ç”¨åˆ°flaskä¸­çš„Flaskæ¡†æ¶ï¼Œjsonifyè¿”å›jsonæ•°æ®ï¼Œrequestå°†å‰ç«¯å­—æ®µä¼ å…¥åç«¯from flask import Flask, jsonify, request# å°†modelä¸­çš„Userï¼Œdbå¯¹è±¡ä¼ å…¥from model import db, User# å‘Šè¯‰flaskè¿™ä¸ªappè¦ç”¨å®ƒapp = Flask(__name__)# è¯»å–é…ç½®æ–‡ä»¶ï¼Œä¸»è¦æ˜¯è¿æ¥mysqlapp.config.from_object('conf')# åˆå§‹åŒ–db.init_app(app)# å¼€å§‹è·¯ç”±@app.route('/')def index(): return '&lt;h1&gt;Hello Flask!&lt;/h1&gt;'# å¢@app.route('/user', methods=['POST'])def addUser(): user_name = request.form.get('user_name') user_password = request.form.get('user_password') user_nickname = request.form.get('user_nickname') user_email = request.form.get('user_email') user = User(user_name=user_name, user_password=user_password, user_nickname=user_nickname, user_email=user_email) try: db.session.add(user) db.session.commit() except: db.session.rollback() db.session.flush() userId = user.user_id if (user.user_id is None): result = &#123;'msg': 'æ·»åŠ å¤±è´¥'&#125; return jsonify(data=result) data = User.query.filter_by(user_id=userId).first() result = &#123;'user_id': data.user_id, 'user_name': data.user_name, 'user_nickname': data.user_nickname, 'user_email': data.user_email&#125; return jsonify(data=result)# æŸ¥@app.route('/user/&lt;int:userId&gt;', methods=['GET'])def getUser(userId): user = User.query.filter_by(user_id=userId).first() if (user is None): result = &#123;'msg': 'æ‰¾ä¸åˆ°æ•°æ®'&#125; else: result = &#123;'user_id': user.user_id, 'user_name': user.user_name, 'user_nickname': user.user_nickname, 'user_email': user.user_email&#125; return jsonify(data=result)# æ”¹@app.route('/user/&lt;int:userId&gt;', methods=['PATCH'])def updateUser(userId): user_name = request.form.get('user_name') user_password = request.form.get('user_password') user_nickname = request.form.get('user_nickname') user_email = request.form.get('user_email') try: user = User.query.filter_by(user_id=userId).first() if (user is None): result = &#123;'msg': 'æ‰¾ä¸åˆ°è¦ä¿®æ”¹çš„è®°å½•'&#125; return jsonify(data=result) else: user.user_name = user_name user.user_password = user_password user.user_nickname = user_nickname user.user_email = user_email db.session.commit() except: db.session.rollback() db.session.flush() userId = user.user_id data = User.query.filter_by(user_id=userId).first() result = &#123;'user_id': data.user_id, 'user_name': data.user_name, 'user_password': data.user_password, 'user_nickname': data.user_nickname, 'user_email': data.user_email&#125; return jsonify(data=result)# æŸ¥å…¨éƒ¨@app.route('/user', methods=['GET'])def getUsers(): data = User.query.all() data_all = [] for user in data: data_all.append(&#123;'user_id': user.user_id, 'user_name': user.user_name, 'user_nickname': user.user_nickname, 'user_email': user.user_email&#125;) return jsonify(users=data_all)# åˆ @app.route('/user/&lt;int:userId&gt;', methods=['DELETE'])def deleteUser(userId): # åˆ é™¤æ•°æ® User.query.filter_by(user_id=userId).delete() db.session.commit() return getUsers()if __name__ == '__main__': app.run(debug=app.config['DEBUG']) â€‹ SQLAlchemy å‡ ç§æŸ¥è¯¢æ–¹å¼æ€»ç»“ ä½¿ç”¨Flask-RESTfulå¿«é€Ÿåˆ›å»ºRESTful APIæ¥å£å…ˆå®¹æˆ‘æŠŠé¡¹ç›®åšå®Œâ€¦å¾…ç»­â€¦â€¦.æ— èŠçœ‹çœ‹æ–‡æ¡£ï¼šflask-restfulä¸­æ–‡å®˜æ–¹æ–‡æ¡£ ä½¿ç”¨Flask + PyJWT å®ç°åŸºäºJson Web Tokençš„ç”¨æˆ·è®¤è¯æˆæƒå¾…æ›´â€¦æ— èŠçœ‹çœ‹æ–‡æ¡£ï¼šFlask + PyJWT å®ç°åŸºäºJson Web Tokençš„ç”¨æˆ·è®¤è¯æˆæƒ é—®é¢˜1.ä¸»è¦é—®é¢˜å°±æ˜¯flaskå’Œmysqlçš„è¿æ¥é—®é¢˜ï¼Œå‡ºç°çš„æœ€æ£˜æ‰‹çš„é—®é¢˜é¦–å…ˆæ˜¯mysqldbæ˜¯py2çš„ï¼Œpy3æ²¡æœ‰ï¼Œç”¨pymysqlä»£æ›¿ï¼Œåœ¨SQLALCHEMY_DATABASE_URIæ³¨æ„ä¿®æ”¹driveré©±åŠ¨ã€‚2.æœ€ç»ˆä¿®æ”¹æ–¹æ¡ˆæ˜¯è‡ªå·±ç”¨ä¸€ä¸ªdemoå»ºå¥½äº†æ•°æ®åº“å’Œè¡¨(è®°å¾—ä¿å­˜å¥½demo)ï¼Œdemoå¦‚ä¸‹ï¼Œç„¶åå†è¿è¡Œå°±å¯ä»¥äº†ã€‚ 12345678910111213141516from sqlalchemy import create_engine,Table,Column,Integer,String,MetaData,ForeignKeyengine=create_engine("mysql+pymysql://root:a5230411@localhost:3306/test",echo=True)metadata=MetaData(engine)user=Table('user',metadata, Column('id',Integer,primary_key=True), Column('name',String(20)), Column('fullname',String(40)), )address_table = Table('address', metadata, Column('id', Integer, primary_key=True), Column('user_id', None, ForeignKey('user.id')), Column('email', String(128), nullable=False) )metadata.create_all() 3.è§£å†³ sqlalchemy æŠ¥é”™:(1193, â€œUnknown system variable â€˜tx_isolationâ€™â€): ä¼ é€é—¨ å‚è€ƒç½‘å€ Flask + PyJWT å®ç°åŸºäºJson Web Tokençš„ç”¨æˆ·è®¤è¯æˆæƒ ä½¿ç”¨ Flask è®¾è®¡ RESTful çš„è®¤è¯ ä½¿ç”¨Flask-RESTfulå¿«é€Ÿåˆ›å»ºRESTful APIæ¥å£ Flask + flask-jwt å®ç°åŸºäºJson Web Tokençš„ç”¨æˆ·è®¤è¯æˆæƒ Flaskç¨‹åºç›®å½•ç»“æ„â€”â€”æ„å»ºå¯æ‰©å±•çš„Flaskåº”ç”¨ç¨‹åº Pythonçš„flaskï¼šmodels.pyæ¥åˆ›å»ºmysqlæ•°æ®åº“ pythonä½¿ç”¨sqlalchemyè¿æ¥mysqlæ•°æ®åº“ æ·±å…¥æµ…å‡ºFlask(å­¦ä¹ æ•™ç¨‹) æ·±å…¥æµ…å‡ºç†è§£Pythonè£…é¥°å™¨ flask-restfulä¸­æ–‡å®˜æ–¹æ–‡æ¡£]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>flask</tag>
        <tag>PyJWT</tag>
        <tag>restful</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaæ ¸å¿ƒæŠ€æœ¯]]></title>
    <url>%2F2019%2F08%2F20%2FJava%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF.html</url>
    <content type="text"><![CDATA[ç¬¬ä¸€ç« Javaçš„11ä¸ªå…³é”®æœ¯è¯­ ç®€å•æ€§ é¢å‘å¯¹è±¡ åˆ†å¸ƒå¼ å¥å£®æ€§ å®‰å…¨æ€§ ä½“ç³»ç»“æ„ä¸­ç«‹ å¯ç§»æ¤æ€§ è§£é‡Šå‹ é«˜æ€§èƒ½ å¤šçº¿ç¨‹ åŠ¨æ€æ€§ Java appletåœ¨ç½‘é¡µä¸­è¿è¡Œçš„Javaç¨‹åºç§°ä¸ºapplet ç¬¬äºŒç« éƒ¨åˆ†æœ¯è¯­ JDK(java development kit):javaå¼€å‘å·¥å…·åŒ… JRE(Java Runtime Environment):è¿è¡Œjavaç¨‹åºç”¨æˆ·æ‰€ä½¿ç”¨çš„è½¯ä»¶ SDK(Software Development Kit):è½¯ä»¶å¼€å‘åŒ… å®‰è£…è¿‡ç¨‹MACä¸­JAVAç¯å¢ƒå˜é‡é…ç½®ä»¥åŠIntellij IDEAå¦‚ä½•é…ç½®JDKIDEAçš„æ ¡å›­é‚®ç®±æ¿€æ´»æ–¹å¼IntelliJ IDEA å¸¸ç”¨å¿«æ·é”® ä¹‹ Mac ç‰ˆIntellij IDEAå¿«æ·ç”Ÿæˆå¸¸ç”¨ä»£ç  çç¢çŸ¥è¯†ç‚¹ 0x1.0p-3:0xè¡¨ç¤º16è¿›åˆ¶ï¼Œä½¿ç”¨pè¡¨ç¤ºæŒ‡æ•°ï¼Œæ‰€ä»¥å°±æ˜¯1.0*2çš„-3æ¬¡æ–¹ ä¸‰ä¸ªç‰¹æ®Šçš„æµ®ç‚¹æ•°å€¼ï¼šæ­£æ— ç©·å¤§(Double.POSITIVE_INFINITY)ã€è´Ÿæ— ç©·å¤§(Double.NEGATIVE_INFINITY)ã€NaN(Double.NaN) æµ®ç‚¹æ•°å€¼ä¸é€‚ç”¨äºæ— æ³•æ¥å—èˆå…¥è¯¯å·®çš„è®¡ç®—ä¸­ï¼Œè¦æƒ³å®Œå…¨æ²¡æœ‰è¯¯å·®ï¼Œéœ€è¦ä½¿ç”¨BigDecimalç±» éƒ¨åˆ†ç‰¹æ®Šå­—ç¬¦çš„è½¬ä¹‰åºåˆ—ï¼š\b é€€æ ¼ \t åˆ¶è¡¨ \n æ¢è¡Œ \r å›è½¦ \â€œåŒå¼•å· \åæ–œæ  å¼ºçƒˆå»ºè®®ä¸è¦åœ¨ç¨‹åºä¸­ä½¿ç”¨charç±»å‹ï¼Œå› ä¸ºunicodeæ—©å·²ç»è¶…è¿‡äº†65536ä¸ª ç¬¬ä¸‰ç« éƒ¨åˆ†æœ¯è¯­ ç±»å¸¸é‡ï¼šstatic final,ç±»å¸¸é‡çš„å®šä¹‰åœ¨mainæ–¹æ³•çš„å¤–éƒ¨ æ•´æ•°è¢«0é™¤å°†ä¼šäº§ç”Ÿå¼‚å¸¸ï¼Œæµ®ç‚¹æ•°è¢«0é™¤å°†ä¼šå¾—åˆ°æ— ç©·å¤§æˆ–NaNç»“æœ public static strictfp void main(String[] args)ï¼Œåœ¨è¯¥mainå‡½æ•°ä¸­æ‰€æœ‰æŒ‡ä»¤éƒ½å°†ä½¿ç”¨ä¸¥æ ¼çš„æµ®ç‚¹è®¡ç®— condition ? expression1 : expression2 eg: x&lt;y ? x : y ä½è¿ç®—ç¬¦ï¼š&amp;ã€|ã€^ã€~æ‹“å±•ï¼šå¥‡æ•°ä¸ªæ•°ï¼Œä¸¤ä¸ªä¸¤ä¸ªæˆå¯¹æœ€æœ‰ä¸€ä¸ªå•ç‹¬ï¼Œå¦‚ä½•æ‰¾å‡ºè¿™ä¸ªå•ç‹¬çš„æ•°å­—æ˜¯å‡ ï¼Œå¤æ‚åº¦åœ¨O(n)ä»¥å†…ï¼šç”¨å¼‚æˆ–çš„æ€æƒ³å³å¯ï¼Œå…¨éƒ¨å¼‚æˆ– ç§»ä½è¿ç®—ç¬¦: &lt;&lt;(ç®—æ•°ç§»ä½)&gt;&gt; &gt;&gt;&gt;(é€»è¾‘å³ç§»),å…¶ä¸­&gt;&gt;&gt;ä¼šç”¨0å¡«å……é«˜ä½ï¼Œç§»ä½è¿ç®—ç¬¦çš„å³æ“ä½œæ•°è¦æ»¡è¶³æ¨¡32çš„è¿ç®—(å¦‚æœå·¦è¾¹æ“ä½œæ•°æ˜¯longåˆ™è¦æ»¡è¶³æ¨¡64)ï¼Œ1&lt;&lt;35 == 1&lt;&lt;3 == 8 æšä¸¾ç±»å‹ï¼šenum Size{SMALL,MEDIUM,LARGE } å­—ç¬¦ä¸² å­ä¸²: 12String greeting = "Hello";String s = greeting.substring(0,3); æ‹¼æ¥:ç›´æ¥ç”¨+è¿æ¥ã€å¦‚æœéœ€è¦å¤šä¸ªå­—ç¬¦ä¸²æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”ç”¨ä¸€ä¸ªå®šç•Œç¬¦åˆ†å‰²ï¼Œå¯ä»¥é‡‡ç”¨é™æ€joinæ–¹æ³•ï¼š 12String all = String.join("/","S","M","L","XL")// string: "S/M/L/XL" javaä¸­ä¸å…è®¸ä¿®æ”¹å­—ç¬¦ï¼Œä½†æ˜¯å¯ä»¥ä¿®æ”¹å­—ç¬¦ä¸²å˜é‡*å­—ç¬¦ä¸²æ¯”è¾ƒç”¨equalsæ–¹æ³•ï¼Œä¾‹å¦‚ï¼šâ€Helloâ€.equals(greeting),â€Helloâ€.equalsIgnoreCase(â€œhelloâ€)ã€Œæ— è§†å¤§å°å†™çš„æ¯”è¾ƒã€ java.lang.stringéƒ¨åˆ†apiStringç±»å¸¸ç”¨æ–¹æ³•ä¹‹charAt()ã€codePointAt()ç¤ºä¾‹offsetByCodePoints()ä¸codePointAt() æ³¨æ„lastIndexOf(int cp,int fromindex)ï¼Œæ˜¯è¿”å›ä»indexä½ç½®å¼€å§‹æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªç¬¦åˆçš„å­—ç¬¦ä¸²çš„ä½ç½® 12345678910111213141516public int lastIndexOf(int ch, int fromIndex) &#123; if (ch &lt; Character.MIN_SUPPLEMENTARY_CODE_POINT) &#123; // handle most cases here (ch is a BMP code point or a // negative value (invalid code point)) final char[] value = this.value; int i = Math.min(fromIndex, value.length - 1); for (; i &gt;= 0; i--) &#123; if (value[i] == ch) &#123; return i; &#125; &#125; return -1; &#125; else &#123; return lastIndexOfSupplementary(ch, fromIndex); &#125; &#125; input Scanneråœ¨utilåŒ…ä¸­ï¼Œå½“ä½¿ç”¨çš„ç±»ä¸åœ¨java.langä¸­æ—¶ï¼Œéƒ½éœ€è¦å¯¼åŒ… 1234567Scanner sc = new Scanner(System.in); String nextLine = sc.nextLine(); System.out.println("please input your name:" + nextLine); int nextInt = sc.nextInt(); System.out.println("please input your age:" + nextInt);String next = sc.next();System.out.println("please input your name:" + next);]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kafka]]></title>
    <url>%2F2019%2F08%2F18%2Fkafka.html</url>
    <content type="text"><![CDATA[åˆè¯†kafkakafkaæ¦‚å¿µKafkaæ˜¯ä¸€ç§é«˜ååé‡çš„åˆ†å¸ƒå¼å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿï¼Œå®ƒå¯ä»¥å¤„ç†æ¶ˆè´¹è€…åœ¨ç½‘ç«™ä¸­çš„æ‰€æœ‰åŠ¨ä½œæµæ•°æ®,æ˜¯ç”¨äºæ„å»ºå®æ—¶æ•°æ®ç®¡é“å’Œæµåº”ç”¨ç¨‹åºã€‚ å››ä¸ªæœ¯è¯­ TopicKafkaå°†æ¶ˆæ¯ç§å­(Feed)åˆ†é—¨åˆ«ç±»ï¼Œæ¯ä¸€ç±»çš„æ¶ˆæ¯ç§°ä¹‹ä¸ºä¸€ä¸ªä¸»é¢˜(Topic)ã€‚ Producerå‘å¸ƒæ¶ˆæ¯çš„å¯¹è±¡ç§°ä¹‹ä¸ºä¸»é¢˜ç”Ÿäº§è€…(Kafka topic producer)ã€‚ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯æ—¶è¦é€‰å®šTopicä¸Šçš„åˆ†åŒºã€‚ Consumerè®¢é˜…æ¶ˆæ¯å¹¶å¤„ç†å‘å¸ƒçš„æ¶ˆæ¯çš„ç§å­çš„å¯¹è±¡ç§°ä¹‹ä¸ºä¸»é¢˜æ¶ˆè´¹è€…(consumers)ã€‚ä¸€èˆ¬æ¶ˆè´¹è€…æ¨¡å‹å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šé˜Ÿåˆ—å’Œå‘å¸ƒ-è®¢é˜…å¼ã€‚é˜Ÿåˆ—çš„å¤„ç†æ–¹å¼å°±æ˜¯ä¸€æ¡æ¶ˆæ¯åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…çŸ¥é“å¹¶å¤„ç†ï¼Œå‘å¸ƒ-è®¢é˜…çš„å¤„ç†æ–¹å¼åˆ™æ˜¯æ¶ˆæ¯è¢«æ‰€æœ‰äººéƒ½çŸ¥é“ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥æ¥å¤„ç†è¯¥æ¶ˆæ¯ï¼Œkafkaä¸ºè¿™ä¸¤ç§æ¨¡å‹æä¾›äº†å•ä¸€æŠ½è±¡æ¨¡å‹ï¼šæ¶ˆè´¹è€…ç»„ï¼ˆcosumer groupï¼‰ã€‚æ¯ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰ä¸€ä¸ªç»„åï¼Œå½“æ‰€æœ‰äººçš„ç»„åéƒ½ä¸ä¸€æ ·çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™å°±æ˜¯å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œå› ä¸ºæ¶ˆæ¯è¦æŒ‰ç…§æ¶ˆè´¹è€…ç»„ä¸ºå•ä½å‘å‡ºçš„ï¼Œè¿™æ„å‘³ç€æ­¤æ—¶æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯å¹¶å¯ä»¥è¿›è¡Œå¤„ç†ï¼›å½“æ‰€æœ‰äººçš„æ¶ˆè´¹è€…ç»„åå­—éƒ½ä¸€æ ·æ—¶ï¼Œæ„å‘³ç€åªä¼šæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯å¹¶å¯ä»¥è¿›è¡Œå¤„ç†ï¼Œæ­¤æ—¶å°±æ˜¯é˜Ÿåˆ—æ¨¡å¼äº†ã€‚ Brokerå·²å‘å¸ƒçš„æ¶ˆæ¯ä¿å­˜åœ¨ä¸€ç»„æœåŠ¡å™¨ä¸­ï¼Œç§°ä¹‹ä¸ºKafkaé›†ç¾¤ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªæœåŠ¡å™¨éƒ½æ˜¯ä¸€ä¸ªä»£ç†(Broker). æ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜ï¼ˆtopicï¼‰ï¼Œå¹¶ä»Brokeræ‹‰æ•°æ®ï¼Œä»è€Œæ¶ˆè´¹è¿™äº›å·²å‘å¸ƒçš„æ¶ˆæ¯ã€‚ ä¸‰ä¸ªå…³é”®èƒ½åŠ› å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯æµï¼Œåœ¨è¿™æ–¹é¢ï¼Œå®ƒç±»ä¼¼äºä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—æˆ–ä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿ ä»¥å®¹é”™çš„æ–¹å¼å­˜å‚¨æ¶ˆæ¯ï¼ˆæµ) åœ¨æ¶ˆæ¯æµå‘ç”Ÿæ—¶å¤„ç†ä»–ä»¬ å››ä¸ªæ ¸å¿ƒAPI åº”ç”¨ç¨‹åºä½¿ç”¨ Producer API å‘å¸ƒæ¶ˆæ¯åˆ°1ä¸ªæˆ–å¤šä¸ªtopicï¼ˆä¸»é¢˜ï¼‰ã€‚ åº”ç”¨ç¨‹åºä½¿ç”¨ Consumer API æ¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªtopicï¼Œå¹¶å¤„ç†äº§ç”Ÿçš„æ¶ˆæ¯ åº”ç”¨ç¨‹åºä½¿ç”¨ Streams API å……å½“ä¸€ä¸ªæµå¤„ç†å™¨ï¼Œä»1ä¸ªæˆ–å¤šä¸ªtopicæ¶ˆè´¹è¾“å…¥æµï¼Œå¹¶ç”Ÿäº§ä¸€ä¸ªè¾“å‡ºæµåˆ°1ä¸ªæˆ–å¤šä¸ªè¾“å‡ºtopicï¼Œæœ‰æ•ˆåœ°å°†è¾“å…¥æµè½¬æ¢åˆ°è¾“å‡ºæµã€‚ Connector APIå…è®¸æ„å»ºæˆ–è¿è¡Œå¯é‡å¤ä½¿ç”¨çš„ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ï¼Œå°†topicè¿æ¥åˆ°ç°æœ‰çš„åº”ç”¨ç¨‹åºæˆ–æ•°æ®ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå…³ç³»æ•°æ®åº“çš„è¿æ¥å™¨å¯æ•è·æ¯ä¸€ä¸ªå˜åŒ–ã€‚ kafkaå®‰è£…è¿‡ç¨‹ kafkaçš„å®‰è£… 1brew install kafka å®‰è£…ä¼šä¾èµ–zookeeper æ³¨æ„ï¼šå®‰è£…ç›®å½•ï¼š/usr/local/Cellar/kafka/0.10.2.0 å®‰è£…çš„é…ç½®æ–‡ä»¶ä½ç½®/usr/local/etc/kafka/server.properties/usr/local/etc/kafka/zookeeper.properties å¯åŠ¨zookeeper 1zookeeper-server-start /usr/local/etc/kafka/zookeeper.properties &amp; å¯åŠ¨kafka 1kafka-server-start /usr/local/etc/kafka/server.properties &amp; åˆ›å»ºtopicè®©æˆ‘ä»¬ä½¿ç”¨å•ä¸ªåˆ†åŒºå’Œåªæœ‰ä¸€ä¸ªå‰¯æœ¬åˆ›å»ºä¸€ä¸ªåä¸ºâ€œtestâ€çš„ä¸»é¢˜ 1kafka-topics --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test æŸ¥çœ‹åˆ›å»ºçš„topicæˆ‘ä»¬ç°åœ¨å¯ä»¥çœ‹åˆ°è¯¥ä¸»é¢˜ï¼Œå¦‚æœæˆ‘ä»¬è¿è¡Œlist topicå‘½ä»¤ï¼š 1kafka-topics --list --zookeeper localhost:2181 å‘é€æ¶ˆæ¯Kafkaæä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼Œå®ƒå°†ä»æ–‡ä»¶æˆ–æ ‡å‡†è¾“å…¥æ¥æ”¶è¾“å…¥ï¼Œå¹¶å°†å…¶ä½œä¸ºæ¶ˆæ¯å‘é€åˆ°Kafkaé›†ç¾¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯è¡Œéƒ½å°†ä½œä¸ºå•ç‹¬çš„æ¶ˆæ¯å‘é€ã€‚è¿è¡Œç”Ÿäº§è€…ï¼Œç„¶ååœ¨æ§åˆ¶å°ä¸­é”®å…¥ä¸€äº›æ¶ˆæ¯å‘é€åˆ°æœåŠ¡å™¨ã€‚ 1kafka-console-producer --broker-list localhost:9092 --topic test æ¶ˆè´¹æ¶ˆæ¯Kafkaè¿˜æœ‰ä¸€ä¸ªå‘½ä»¤è¡Œæ¶ˆè´¹è€…ï¼Œå°†æ¶ˆæ¯è½¬å‚¨åˆ°æ ‡å‡†è¾“å‡ºã€‚ 1kafka-console-consumer --bootstrap-server localhost:9092 --topic test --from-beginning TipQ:å®‰è£…kafkaå‡ºç°é”™è¯¯ï¼š 1234kafka: Java 1.8 is required to install this formula.Install AdoptOpenJDK 8 with Homebrew Cask: brew cask install homebrew/cask-versions/adoptopenjdk8Error: An unsatisfied requirement failed this build. A: 1brew cask install homebrew/cask-versions/adoptopenjdk8 bilibiliå­¦ä¹ kafkahttps://www.bilibili.com/video/av36607048?p=2 zookeeper é»˜è®¤æ˜¯å‰å°å¯åŠ¨(å…³é—­äº†æ§åˆ¶å°åœæ­¢)ï¼Œå¯ä»¥åœ¨æœ€å‰é¢åŠ ä¸Š nohupï¼Œè¿™æ ·å°±å¯ä»¥åå°å¯åŠ¨äº†ã€‚ ä¸‰ä¸ªç›®å½• binç›®å½•1cd usr/local/Cellar/kafka/2.2.1/bin * configæ–‡ä»¶ 1/usr/local/etc/kafka/server.properties * æ—¥å¿— 1234############################# Log Basics ############################## A comma separated list of directories under which to store log fileslog.dirs=/usr/local/var/lib/kafka-logs åˆ é™¤topic1kafka-topics --delete --zookeeper localhost:2181 --topic test]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pythonå®è·µwinrmï¼Œå®ç°è¿œç¨‹è¿æ¥è°ƒåº¦WindowsæœåŠ¡å™¨]]></title>
    <url>%2F2019%2F08%2F17%2Fpython%E5%AE%9E%E8%B7%B5winrm%EF%BC%8C%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E8%B0%83%E5%BA%A6Windows%E6%9C%8D%E5%8A%A1%E5%99%A8.html</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘æœ‰ä¸ªéœ€æ±‚ï¼šç”¨è‡ªå·±ä¸»æœºæ§åˆ¶å¤šä¸ªwindowsèŠ‚ç‚¹ï¼Œå®æ—¶è·å–ä»–ä»¬çš„cpuå’Œè¿å­˜å ç”¨æƒ…å†µï¼Œé€šè¿‡æŸ¥è¯¢ï¼Œå†³å®šé‡‡ç”¨pythonä¸­çš„winrmã€‚Tip:winrmæœåŠ¡æ˜¯windows ä¸€ç§æ–¹ä¾¿è¿œç¨‹ç®¡ç†çš„æœåŠ¡ï¼›å¼€å¯winrm service,ä¾¿äºåœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œè¿œç¨‹ç®¡ç†æœåŠ¡å™¨ï¼Œæˆ–é€šè¿‡è„šæœ¬ï¼ŒåŒæ—¶ç®¡ç†å¤šå°æœåŠ¡å™¨ï¼Œæ¥æé«˜å·¥ä½œæ•ˆç‡ã€‚ å¸¸è§„åšæ³•é…ç½®è¿œç¨‹ä¸»æœº,ä½¿å…¶æ”¯æŒè¢«è¿œç¨‹æ§åˆ¶ æŸ¥çœ‹winrm service listenerï¼ˆåˆ†ä¸ºhttpå’Œhttpsï¼‰:1winrm e winrm/config/listener å¦‚æœæ²¡æœ‰è¿”å›ï¼Œåˆ™æ²¡æœ‰å¼€å¯winrmæœåŠ¡ã€‚ å¼€å¯winrmæœåŠ¡ï¼š 1winrm quickconfig ä¸ºwinrm service é…ç½®auth: 1winrm set winrm/config/service/auth @&#123;Basic="true"&#125; ä¸ºwinrm service é…ç½®åŠ å¯†æ–¹å¼ä¸ºå…è®¸éåŠ å¯†ï¼š 1winrm set winrm/config/service @&#123;AllowUnencrypted="true"&#125; æŸ¥çœ‹winrmæœåŠ¡çš„é…ç½®ï¼š 1winrm get winrm/config å®¢æˆ·ç«¯ä¸»æœº è£…winrm 1pip install pywinrm æµ‹è¯• 1234import winrmwintest = winrm.Session('http://47.98.149.160:5985/wsman',auth=('Administrator','Jwy12345a'))ret = wintest.run_cmd('ipconfig')print(ret) é‡åˆ°çš„é—®é¢˜åŠè§£å†³æªæ–½ åœ¨æµ‹è¯•ç¯èŠ‚ï¼Œå¯¼å…¥winrmåŒ…åï¼Œæ§åˆ¶å°æ˜¾ç¤ºï¼šwinrm has no attribute session è§£å†³åŠæ³•ï¼špipå¯¼é”™äº†åŒ…ï¼Œåº”è¯¥æ˜¯pywinrmè¿™ä¸ªåŒ…ï¼Œå°†pipåŸæ¥çš„åŒ…åˆ é™¤ï¼Œé‡æ–°å¯¼å…¥ä¸€éã€‚ pycharmé—®é¢˜ï¼šmodule â€˜pipâ€™ has no attribute â€˜mainâ€™ è§£å†³åŠæ³•ï¼špipå‡çº§å¯¼è‡´æ— æ³•å¯¼åŒ… æµ‹è¯•çš„æ—¶å€™ï¼ŒæŠ¥å‡ºä»¥ä¸‹é”™è¯¯ï¼š 1requests.exceptions.ConnectTimeout: HTTPConnectionPool(host='47.98.149.160', port=5985): Max retries exceeded with url: /wsman (Caused by ConnectTimeoutError(&lt;urllib3.connection.HTTPConnection object at 0x104921650&gt;, 'Connection to 47.98.149.160 timed out. (connect timeout=30)')) è§£å†³åŠæ³•ï¼šç”±äºäº‘æœåŠ¡å™¨æœ‰å…¬ç½‘ipåœ°å€ï¼Œæ‰€ä»¥æœ¬æœºå¯ä»¥pingé€šæœåŠ¡å™¨ï¼Œä½†æ˜¯ç”±äºæœ¬æœºä¸å­˜åœ¨å…¬ç½‘åœ°å€ï¼Œæ˜¯å±€åŸŸç½‘åœ°å€ï¼Œæ‰€ä»¥æœåŠ¡å™¨ä¸èƒ½pingé€šä¸»æœºï¼Œå¯¼è‡´äºŒè€…ä¸èƒ½æ­£å¸¸é€šä¿¡ï¼Œåªèƒ½æ¢ä¸€ç§æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åœ¨äº‘æœåŠ¡å™¨ç«¯è¿è¡Œç¨‹åºï¼Œç¨‹åºæä¾›äº†å½“å‰cpuè¿è¡Œæƒ…å†µå’Œè¿å­˜æƒ…å†µï¼Œæœ¬æœºå¯ä»¥éšæ—¶è®¿é—®å¹¶å¾—åˆ°ä¿¡æ¯ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485import timeimport psutil # cd C:\Python36-32\Scripts pip install psutil# è·å–æœ¬æœºç£ç›˜ä½¿ç”¨ç‡å’Œå‰©ä½™ç©ºé—´Gä¿¡æ¯import pymysqlconn = pymysql.connect(user="root", passwd="No.93329332", host="134.175.5.88", port=3306, db="node_status")cur = conn.cursor()flag = 0while(True): # å¾ªç¯ç£ç›˜åˆ†åŒº content = "" for disk in psutil.disk_partitions(): # è¯»å†™æ–¹å¼ å…‰ç›˜ or æœ‰æ•ˆç£ç›˜ç±»å‹ if 'cdrom' in disk.opts or disk.fstype == '': continue disk_name_arr = disk.device.split(':') disk_name = disk_name_arr[0] disk_info = psutil.disk_usage(disk.device) # ç£ç›˜å‰©ä½™ç©ºé—´ï¼Œå•ä½G free_disk_size = disk_info.free // 1024 // 1024 // 1024 # å½“å‰ç£ç›˜ä½¿ç”¨ç‡å’Œå‰©ä½™ç©ºé—´Gä¿¡æ¯ if (disk_name == 'C'): disk_c_name = disk_name disk_c_info = disk_info free_c_disk_size = free_disk_size info = "%sç›˜ä½¿ç”¨ç‡ï¼š%s%%ï¼Œ å‰©ä½™ç©ºé—´ï¼š%iG" % (disk_c_name, str(disk_c_info.percent), free_c_disk_size) # print(info) # print(disk_name) if (disk_name == 'C'): # æ‹¼æ¥å¤šä¸ªç£ç›˜çš„ä¿¡æ¯ content = content + info print(content) # return content # cpuä¿¡æ¯ cpu_percent = psutil.cpu_percent(interval=1) cpu_info = "CPUä½¿ç”¨ç‡ï¼š%i%%" % cpu_percent print(cpu_info) # return cpu_info # å†…å­˜ä¿¡æ¯ virtual_memory = psutil.virtual_memory() used_memory = virtual_memory.used / 1024 / 1024 / 1024 free_memory = virtual_memory.free / 1024 / 1024 / 1024 memory_percent = virtual_memory.percent memory_info = "å†…å­˜ä½¿ç”¨ï¼š%0.2fGï¼Œä½¿ç”¨ç‡%0.1f%%ï¼Œå‰©ä½™å†…å­˜ï¼š%0.2fG" % (used_memory, memory_percent, free_memory) print(memory_info) # return memory_info now = time.asctime() if(flag == 0): sql = "INSERT INTO status(ip, \ disk_percent, disk_freesize, CPU_percent, memory_used,memory_free,memory_percent,mytime) \ VALUES ('%s', '%s', '%s', '%s', '%s','%s','%s','%s')" % \ ('106.13.70.159', str(disk_c_info.percent) + "%", str(free_c_disk_size) + "G", str(cpu_percent) + "%",str(used_memory)[:3] + "G",str(free_memory)[:3] + "G",str(memory_percent) + "%",now) flag = 1 else: used_memory_float = str(used_memory)[:3] + 'G' free_memory_folat = str(free_memory)[:3] + 'G' disk_c_info_percent_str = str(disk_c_info.percent) + '%' free_c_disk_size_str = str(free_c_disk_size) + 'G' cpu_percent_str = str(cpu_percent) + '%' memory_percent_str = str(memory_percent) + '%' sql = "update status set disk_percent = '%s', disk_freesize = '%s', \ CPU_percent = '%s', memory_used = '%s' , memory_free = '%s' ,\ memory_percent = '%s' , mytime = '%s' where ip = '106.13.70.159'" % \ (disk_c_info_percent_str,free_c_disk_size_str,cpu_percent_str,used_memory_float,free_memory_folat,memory_percent_str,now) flag = 2 try: # æ‰§è¡Œsqlè¯­å¥ cur.execute(sql) # æ‰§è¡Œsqlè¯­å¥ conn.commit() if(flag==1): print("insert ok") else: print("update ok") except Exception as e: # å‘ç”Ÿé”™è¯¯æ—¶å›æ»š conn.rollback() print("failed") print(e) time.sleep(60)# å…³é—­æ•°æ®åº“è¿æ¥conn.close() sqlä¸­updateä¹Ÿå¯ä»¥ 1sql = "update table set ss = '%s'where id = '1'"% disk]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>winrm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŸºäºHexoçš„NexTä¸»é¢˜---ä»å…¥é—¨åˆ°å…¥åœŸ]]></title>
    <url>%2F2019%2F08%2F15%2F%E5%9F%BA%E4%BA%8EHexo%E7%9A%84NexT%E4%B8%BB%E9%A2%98-%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F.html</url>
    <content type="text"><![CDATA[å‰è¨€æœ¬ç¯‡æ–‡ç« ä¸»è¦æ˜¯é’ˆå¯¹nexTä¸»é¢˜çš„ä¼˜åŒ–è¯´æ˜ï¼Œä½¿ç”¨hexoå…¶ä»–ä¸»é¢˜çš„ç«¥é´è¯·ç»•é“~~æ•´ç†ä¸€ä¸‹å¤§æ¦‚ä¼˜åŒ–ï¼š1.æ ‡é¢˜éƒ¨åˆ†ä¼˜åŒ–ï¼Œé¢œè‰²æ ·å¼ï¼›2.è®¾ç½®åšå®¢æ–‡ç« è¿æ¥ä¸ºyear/month/day/title.htmlæ ¼å¼3.Menuå¢åŠ å…³äºã€æ ‡ç­¾ã€åˆ†ç±»ã€äº’åŠ¨ã€æœç´¢èœå•4.ç¦ç”¨å…³äºã€æ ‡ç­¾ã€åˆ†ç±»èœå•è¯„è®ºåŠŸèƒ½5.æ·»åŠ RSS6.è®¾ç½®èƒŒæ™¯å›¾ç‰‡7.Canvas_neståŠ¨æ€èƒŒæ™¯8.å›¾ç‰‡å¿«é€ŸåŠ è½½è®¾ç½®9.å¾®ä¿¡æ”¯ä»˜å®æ‰“èµåŠŸèƒ½10.ç‚¹å‡»å‡ºç°æ¡ƒå¿ƒæ•ˆæœ11.ä¸»é¡µæ–‡ç« æ·»åŠ é˜´å½±æ•ˆæœ12.è®¾ç½®ä»£ç é«˜äº®13.é¡¶æ èƒŒæ™¯è‰²14.åº•æ èƒŒæ™¯è‰²15.ä¿®æ”¹æ–‡ç« å†…é“¾æ¥æ–‡æœ¬æ ·å¼16.ä¿®æ”¹æ–‡ç« åº•éƒ¨æ ‡ç­¾æ ·å¼17.åœ¨æ–‡ç« æœ«å°¾æ·»åŠ â€œæ–‡ç« ç»“æŸâ€æ ‡è®°18.è®¾ç½®å¤´åƒ19.ç½‘ç«™åº•éƒ¨åŠ ä¸Šè®¿é—®é‡20.ç½‘ç«™åº•éƒ¨å­—æ•°ç»Ÿè®¡21.ç½‘ç«™åº•éƒ¨æ·»åŠ ç½‘ç«™è¿è¡Œæ—¶é—´22.ç½‘ç«™åº•éƒ¨æ·»åŠ åŠ¨æ€æ¡ƒå¿ƒ23.åº•éƒ¨éšè—ç”±Hexoå¼ºåŠ›é©±åŠ¨ã€ä¸»é¢˜â€“NexT.Mist24.è®¾ç½®ç½‘ç«™çš„å›¾æ ‡Favicon25.å®ç°æ–‡ç« æ–‡å­—ç»Ÿè®¡åŠŸèƒ½å’Œé˜…è¯»æ—¶é•¿26.åŠ æ¥å¿…åŠ›äº‘è·Ÿå¸–åŠŸèƒ½27.å»æ‰åº•éƒ¨é‡å¤å­—æ•°ç»Ÿè®¡28.ä¿®æ”¹å­—ä½“å¤§å°29.ä¾§è¾¹æ ç¤¾äº¤å°å›¾æ ‡è®¾ç½®30.æ·»åŠ ä¾§æ æ¨èé˜…è¯»31.ä¿®æ”¹ä¾§è¾¹æ èƒŒæ™¯å›¾ç‰‡32.æ·»åŠ ä¾§è¾¹æ éŸ³ä¹33.ä¿®æ”¹ä¾§è¾¹æ æ–‡å­—é¢œè‰²34.åœ¨æ–‡ç« åº•éƒ¨å¢åŠ ç‰ˆæƒä¿¡æ¯35.Hexoåšå®¢æ·»åŠ ç«™å†…æœç´¢36.ä¿®æ”¹é€‰ä¸­å­—ç¬¦çš„é¢œè‰²37.æ·»åŠ aplayéŸ³ä¹æ’­æ”¾38.æ·»åŠ åšå®¢å·¦ä¸‹è§’é—¨ç¥(çœ‹é—¨ğŸ¶)39.å¢åŠ äº†3Dåº“three_wavesï¼Œé»˜è®¤å…³é—­40.å¢åŠ äº†canvasé¡µé¢ä¸å¸¦(è¯è¯´è¿™ç©æ„çœŸçš„å¾ˆåƒcpuï¼Œä¸€å¼€æˆ‘çš„macå°±é“æ¿çƒ§äº†)41.å¢åŠ äº†é¦–é¡µpaceåŠ è½½è¿›åº¦42.å¢åŠ å›¾ç‰‡æ‡’åŠ è½½lazyload43.å¢åŠ äº†fancybox44.å¢åŠ äº†fastclickè§£å†³å»¶è¿Ÿé—®é¢˜45.å¢åŠ äº†gulpå‹ç¼©ç½‘é¡µcss jsæ ·å¼46.æˆªæ–­é¦–é¡µæ–‡ç« å†…å®¹47.ä»£ç å¤åˆ¶åŠŸèƒ½ hexoç›®å½•ç»“æ„ä¸»ç›®å½•ç»“æ„ _config.ymlå…¨å±€é…ç½®æ–‡ä»¶ï¼Œç½‘ç«™çš„å¾ˆå¤šä¿¡æ¯éƒ½åœ¨è¿™é‡Œé…ç½®ï¼Œè¯¸å¦‚ç½‘ç«™åç§°ï¼Œå‰¯æ ‡é¢˜ï¼Œæè¿°ï¼Œä½œè€…ï¼Œè¯­è¨€ï¼Œä¸»é¢˜ï¼Œéƒ¨ç½²ç­‰ç­‰å‚æ•°ã€‚ package.jsonhexoæ¡†æ¶çš„å‚æ•°å’Œæ‰€ä¾èµ–æ’ä»¶ã€‚ scaffoldsscaffoldsæ˜¯â€œè„šæ‰‹æ¶ã€éª¨æ¶â€çš„æ„æ€ï¼Œå½“ä½ æ–°å»ºä¸€ç¯‡æ–‡ç« ï¼ˆhexo new â€˜titleâ€™ï¼‰çš„æ—¶å€™ï¼Œhexoæ˜¯æ ¹æ®è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶è¿›è¡Œæ„å»ºçš„ã€‚åŸºæœ¬ä¸ç”¨å…³å¿ƒã€‚ sourceè¿™ä¸ªç›®å½•å¾ˆé‡è¦ï¼Œæ–°å»ºçš„æ–‡ç« éƒ½æ˜¯åœ¨ä¿å­˜åœ¨è¿™ä¸ªç›®å½•ä¸‹çš„._postsï¼Œéœ€è¦æ–°å»ºçš„åšæ–‡éƒ½æ”¾åœ¨_postsç›®å½•ä¸‹ã€‚_postsç›®å½•ä¸‹æ˜¯ä¸€ä¸ªä¸ª markdown æ–‡ä»¶ã€‚ä½ åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸€ä¸ª hello-world.md çš„æ–‡ä»¶ï¼Œæ–‡ç« å°±åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç¼–è¾‘ã€‚_posts ç›®å½•ä¸‹çš„mdæ–‡ä»¶ï¼Œä¼šè¢«ç¼–è¯‘æˆhtmlæ–‡ä»¶ï¼Œæ”¾åˆ° public ï¼ˆæ­¤æ–‡ä»¶ç°åœ¨åº”è¯¥æ²¡æœ‰ï¼Œå› ä¸ºä½ è¿˜æ²¡æœ‰ç¼–è¯‘è¿‡ï¼‰æ–‡ä»¶å¤¹ä¸‹ã€‚é‡Œé¢è¿˜æœ‰ä¸€ä¸ªé‡è¦æ–‡ä»¶å¤¹ï¼šimagesï¼Œæ˜¯ç”¨æ¥å­˜æ”¾åšæ–‡çš„å›¾ç‰‡çš„ï¼Œè¿™é‡Œå»ºè®®ä½¿ç”¨ä¸ƒç‰›äº‘å›¾åºŠæ¥å­˜å‚¨å›¾ç‰‡ï¼Œå› ä¸ºå¯ä»¥æ›´å¿«çš„åŠ è½½å›¾ç‰‡ã€‚åŒæ—¶å¼ºçƒˆå»ºè®®å¤§å®¶ç”¨ä¸€æ¬¾hexoâ€”clientæ¥è¿›è¡Œå¯è§†åŒ–åšå®¢çš„ä¹¦å†™ï¼Œä¸€ç«™å¼æœåŠ¡ï¼Œæ”¯æŒä¸ƒç‰›äº‘å›¾åºŠï¼Œæ¥å¥½ä¼ é€é—¨ï¼šhexoclientã€‚ themesç½‘ç«™ä¸»é¢˜ç›®å½•ï¼Œæˆ‘ç”¨çš„å°±æ˜¯nexTä¸»é¢˜ã€‚ node_moduleshexoä¾èµ–çš„ç»„ä»¶éƒ½åœ¨å…¶ä¸­ã€‚ ä¸»é¢˜ç›®å½•ç»“æ„12345678910111213141516171819202122232425262728293031323334353637â”œâ”€â”€ .github #gitä¿¡æ¯â”œâ”€â”€ languages #å¤šè¯­è¨€| â”œâ”€â”€ default.yml #é»˜è®¤è¯­è¨€| â””â”€â”€ zh-Hans.yml #ç®€ä½“ä¸­æ–‡| â””â”€â”€ zh-tw.yml #ç¹ä½“ä¸­æ–‡â”œâ”€â”€ layout #å¸ƒå±€ï¼Œæ ¹ç›®å½•ä¸‹çš„*.ejsæ–‡ä»¶æ˜¯å¯¹ä¸»é¡µï¼Œåˆ†é¡µï¼Œå­˜æ¡£ç­‰çš„æ§åˆ¶| â”œâ”€â”€ _custom #å¯ä»¥è‡ªå·±ä¿®æ”¹çš„æ¨¡æ¿ï¼Œè¦†ç›–åŸæœ‰æ¨¡æ¿| | â”œâ”€â”€ _header.swig #å¤´éƒ¨æ ·å¼| | â”œâ”€â”€ _sidebar.swig #ä¾§è¾¹æ æ ·å¼| â”œâ”€â”€ _macro #å¯ä»¥è‡ªå·±ä¿®æ”¹çš„æ¨¡æ¿ï¼Œè¦†ç›–åŸæœ‰æ¨¡æ¿| | â”œâ”€â”€ post.swig #æ–‡ç« æ¨¡æ¿| | â”œâ”€â”€ reward.swig #æ‰“èµæ¨¡æ¿| | â”œâ”€â”€ sidebar.swig #ä¾§è¾¹æ æ¨¡æ¿| â”œâ”€â”€ _partial #å±€éƒ¨çš„å¸ƒå±€| | â”œâ”€â”€ head #å¤´éƒ¨æ¨¡æ¿| | â”œâ”€â”€ search #æœç´¢æ¨¡æ¿| | â”œâ”€â”€ share #åˆ†äº«æ¨¡æ¿| â”œâ”€â”€ _script #å±€éƒ¨çš„å¸ƒå±€| â”œâ”€â”€ _third-party #ç¬¬ä¸‰æ–¹æ¨¡æ¿| â”œâ”€â”€ _layout.swig #ä¸»é¡µé¢æ¨¡æ¿| â”œâ”€â”€ index.swig #ä¸»é¡µé¢æ¨¡æ¿| â”œâ”€â”€ page #é¡µé¢æ¨¡æ¿| â””â”€â”€ tag.swig #tagæ¨¡æ¿â”œâ”€â”€ scripts #scriptæºç | â”œâ”€â”€ tags #tagsçš„scriptæºç | â”œâ”€â”€ marge.js #é¡µé¢æ¨¡æ¿â”œâ”€â”€ source #æºç | â”œâ”€â”€ css #cssæºç | | â”œâ”€â”€ _common #*.stylåŸºç¡€css| | â”œâ”€â”€ _custom #*.stylå±€éƒ¨css| | â””â”€â”€ _mixins #mixinsçš„css| â”œâ”€â”€ fonts #å­—ä½“| â”œâ”€â”€ images #å›¾ç‰‡| â”œâ”€â”€ uploads #æ·»åŠ çš„æ–‡ä»¶| â””â”€â”€ js #javascriptæºä»£ç â”œâ”€â”€ _config.yml #ä¸»é¢˜é…ç½®æ–‡ä»¶â””â”€â”€ README.md #ç”¨GitHubçš„éƒ½çŸ¥é“ é«˜åº¦å®šåˆ¶ä¼˜åŒ–ç¯‡æ ‡é¢˜éƒ¨åˆ†ä¼˜åŒ–ï¼Œé¢œè‰²æ ·å¼é¦–å…ˆä½ è¦ç¡®å®šä½ æ˜¯ä¸»é¢˜ä¸­çš„å“ªä¸ªschemeï¼šMuseã€Mistã€Piscesã€Geminiï¼Œæˆ‘çš„æ˜¯Mist,æ‰€ä»¥æˆ‘å°±å»themes/nexT/source/css/_schemes/Mist/_header.stylä¸‹ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š12345//å¯ä»¥åŠ å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥è‡ªå·±è°ƒè‰²å½©.header &#123; //background: url('/images/headbg.jpg') repeat !important; background: rgba(#EBF2EA,1) none repeat scroll !important; &#125; è®¾ç½®èƒŒæ™¯å›¾ç‰‡é»˜è®¤ç¦ç”¨ï¼Œå¯ä»¥åœ¨themes/nexT/source/css/_custom/custon.stylæ–‡ä»¶ä¸­å¯ç”¨12345678//è®¾ç½®èƒŒæ™¯å›¾ç‰‡body &#123; background:url(http://pw5u1sbg2.bkt.clouddn.com/145676.jpg); background-repeat: repeat; background-attachment:fixed; background-position:50% 50%; background-size:cover;&#125; Canvas_neståŠ¨æ€èƒŒæ™¯èƒŒæ™¯çš„å‡ ä½•çº¿æ¡æ˜¯é‡‡ç”¨çš„nestæ•ˆæœ, ä¸€ä¸ªåŸºäºhtml5 canvasç»˜åˆ¶çš„ç½‘é¡µèƒŒæ™¯æ•ˆæœ, éå¸¸èµï¼æ¥è‡ªgithubçš„å¼€æºé¡¹ç›®canvas-nest ç‰¹æ€§ ä¸ä¾èµ–ä»»ä½•æ¡†æ¶æˆ–è€…å†…åº“ï¼Œæ¯”å¦‚ä¸ä¾èµ–jQueryï¼Œä½¿ç”¨åŸç”Ÿçš„javascript éå¸¸å°ï¼Œåªæœ‰1.66kbï¼Œå¦‚æœå¼€å¯gzipï¼Œå¯ä»¥æ›´å° éå¸¸å®¹æ˜“å®ç°ï¼Œé…ç½®ç®€å•ï¼Œå³ä½¿ä½ ä¸æ˜¯webå¼€å‘è€…ï¼Œä¹Ÿèƒ½ç®€å•æå®šè¯´æ˜ colorï¼šçº¿æ¡é¢œè‰²ï¼Œé»˜è®¤ï¼š â€˜0,0,0â€™ ï¼›ä¸‰ä¸ªæ•°å­—åˆ†åˆ«ä¸º(R,G,B)ï¼Œè¿™é‡Œæ¨èä¸€ä¸ªé¢œè‰²é‡‡é›†å™¨ï¼šColorSlurpï¼Œåœ¨AppStoreä¸­å°±å¯ä»¥æœåˆ° opacityï¼šçº¿æ¡é€æ˜åº¦ï¼ˆ0~1ï¼‰ï¼Œé»˜è®¤: 0.5 countï¼šçº¿æ¡çš„æ€»æ•°é‡ï¼Œ é»˜è®¤ï¼š150 zIndexï¼šèƒŒæ™¯çš„z-indexå±æ€§ï¼Œcsså±æ€§ç”¨äºæ§åˆ¶æ‰€åœ¨å±‚çš„ä½ç½®ï¼Œé»˜è®¤ï¼š-1ä¸è¶³å†…å­˜å ç”¨è¿‡é«˜åšæ³•ç›´æ¥æ‰¾åˆ°ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œå°†canvasæ”¹ä¸ºtrueå³å¯ã€‚RSSåœ¨ä½ çš„hexoç«™ç‚¹ç›®å½•ä¸‹ï¼š1$ npm install hexo-generator-feed --save æ‰“å¼€ç«™ç‚¹ç›®å½•ä¸‹çš„_config.yml:12345678# feed# Dependencies: https://github.com/hexojs/hexo-generator-feedfeed: type: atom path: atom.xml limit: 20 hub: content: æ¥å¿…åŠ›è¯„è®ºç³»ç»Ÿç­‰ç¬¬ä¸‰æ–¹æ’ä»¶ç™»å½• æ¥å¿…åŠ› ï¼Œè·å–LiveRe UIDï¼Œç¼–è¾‘ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œç¼–è¾‘livere_uidå­—æ®µï¼Œå°†idå¡«å…¥å³å¯ï¼Œæ›´å¤šç¬¬ä¸‰æ–¹é›†æˆæ’ä»¶å¯è§ï¼šnexTå®˜ç½‘ï¼ŒåŒ…æ‹¬è¯„è®ºç³»ç»Ÿã€æ•°æ®ç»Ÿè®¡ä¸åˆ†æã€å†…å®¹åˆ†äº«æœåŠ¡ã€æœç´¢æœåŠ¡ç­‰ç­‰ã€‚ æ‰“èµåŠŸèƒ½nexTé›†æˆäº†æ”¯ä»˜å®å¾®ä¿¡æ‰“èµåŠŸèƒ½ï¼Œç›´æ¥åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶æœç´¢wechatæˆ–è€…alipayå³å¯,ç„¶åè·Ÿä¸Šè‡ªå·±çš„å¾®ä¿¡å’Œæ”¯ä»˜å®çš„æ”¶é’±ç å›¾ç‰‡åœ°å€å³å¯ã€‚ ç‚¹å‡»å‡ºç°æ¡ƒå¿ƒæ•ˆæœ1!function(e,t,a)&#123;function n()&#123;c(".heart&#123;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);&#125;.heart:after,.heart:before&#123;content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;&#125;.heart:after&#123;top: -5px;&#125;.heart:before&#123;left: -5px;&#125;"),o(),r()&#125;function r()&#123;for(var e=0;e&lt;d.length;e++)d[e].alpha&lt;=0?(t.body.removeChild(d[e].el),d.splice(e,1)):(d[e].y--,d[e].scale+=.004,d[e].alpha-=.013,d[e].el.style.cssText="left:"+d[e].x+"px;top:"+d[e].y+"px;opacity:"+d[e].alpha+";transform:scale("+d[e].scale+","+d[e].scale+") rotate(45deg);background:"+d[e].color+";z-index:99999");requestAnimationFrame(r)&#125;function o()&#123;var t="function"==typeof e.onclick&amp;&amp;e.onclick;e.onclick=function(e)&#123;t&amp;&amp;t(),i(e)&#125;&#125;function i(e)&#123;var a=t.createElement("div");a.className="heart",d.push(&#123;el:a,x:e.clientX-5,y:e.clientY-5,scale:1,alpha:1,color:s()&#125;),t.body.appendChild(a)&#125;function c(e)&#123;var a=t.createElement("style");a.type="text/css";try&#123;a.appendChild(t.createTextNode(e))&#125;catch(t)&#123;a.styleSheet.cssText=e&#125;t.getElementsByTagName("head")[0].appendChild(a)&#125;function s()&#123;return"rgb("+~~(255*Math.random())+","+~~(255*Math.random())+","+~~(255*Math.random())+")"&#125;var d=[];e.requestAnimationFrame=function()&#123;return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e)&#123;setTimeout(e,1e3/60)&#125;&#125;(),n()&#125;(window,document); æ–°å»º clicklove.js æ–‡ä»¶å¹¶ä¸”å°†ä»¥ä¸Šä»£ç å¤åˆ¶è¿›å»ï¼Œç„¶åä¿å­˜ã€‚ å°† clicklove.jsæ–‡ä»¶æ”¾åˆ°è·¯å¾„ /themes/next/source/js/src é‡Œé¢ ç„¶åæ‰“å¼€ \themes\next\layout\_layout.swig æ–‡ä»¶,åœ¨æœ«å°¾ï¼ˆåœ¨å‰é¢å¼•ç”¨ä¼šå‡ºç°æ‰¾ä¸åˆ°çš„bugï¼‰æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š12&lt;!-- é¡µé¢ç‚¹å‡»å°çº¢å¿ƒ --&gt;&lt;script type="text/javascript" src="/js/src/clicklove.js"&gt;&lt;/script&gt; ä¸»é¡µæ–‡ç« æ·»åŠ é˜´å½±æ•ˆæœæ‰“å¼€ themes/next/source/css/_custom/custom.stylï¼Œå‘é‡Œé¢åŠ ä»£ç :12345678// ä¸»é¡µæ–‡ç« æ·»åŠ é˜´å½±æ•ˆæœ.post &#123; margin-top: 0px; margin-bottom: 60px; padding: 25px; -webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5); -moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5);&#125; ä»£ç é«˜äº®ç›´æ¥åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶æœç´¢ highlight_themeï¼š1234# Code Highlight theme# Available values: normal | night | night eighties | night blue | night bright# https://github.com/chriskempson/tomorrow-themehighlight_theme: night bright é¡¶éƒ¨åº•éƒ¨èƒŒæ™¯è‰²æ”¹å˜é¦–å…ˆä½ è¦ç¡®å®šä½ æ˜¯ä¸»é¢˜ä¸­çš„å“ªä¸ªschemeï¼šMuseã€Mistã€Piscesã€Geminiï¼Œæˆ‘çš„æ˜¯Mist,æ‰€ä»¥æˆ‘å°±themes/nexT/source/css/_schemes/Mist/_header.stylä¸‹ï¼Œå°†é¢œè‰²è¿›è¡Œä¿®æ”¹å³å¯ã€‚åº•éƒ¨é¢œè‰²åˆ™åœ¨themes/nexT/source/css/_schemes/Mist/index.stylä¸­è¿›è¡Œä¿®æ”¹ï¼š123456789101112131415161718// Footer// --------------------------------------------------.footer &#123; margin-top: 80px; padding: 10px 0; //background: url('/images/headbg.jpg') repeat !important; background: rgba(#EBF2EA,1) none repeat scroll !important; color: $grey-dim;&#125;.footer-inner &#123; margin: 0 auto; text-align: left; +mobile() &#123; width: auto; text-align: center; &#125;&#125; ä¿®æ”¹æ–‡ç« å†…æ–‡æœ¬è¿æ¥æ ·å¼æ‰“å¼€ themes/next/source/css/_custom/custom.styl,æ·»åŠ ä»£ç ï¼š1234567891011// æ–‡ç« å†…é“¾æ¥æ–‡æœ¬æ ·å¼.post-body p a&#123; color: #0593d3; border-bottom: none; border-bottom: 1px solid #0593d3; &amp;:hover &#123; color: #fc6423; border-bottom: none; border-bottom: 1px solid #fc6423; &#125;&#125; ä¿®æ”¹ç½‘é¡µåº•éƒ¨ åœ¨å›¾æ ‡åº“ä¸­æ‰¾åˆ°ä½ è‡ªå·±å–œæ¬¢çš„å›¾æ ‡, ä¿®æ”¹æ¡ƒå¿ƒ,æ‰“å¼€ themes/next_config.yml ,æœç´¢å…³é”®å­— authoricon,æ›¿æ¢å›¾æ ‡åï¼š 12# icon between year and author @Footerauthoricon: id-card éšè—ç½‘é¡µåº•éƒ¨ Hexo å¼ºåŠ›é©±åŠ¨ æ‰“å¼€ä¸»é¢˜é…ç½®æ–‡ä»¶,æœç´¢å…³é”®å­— copyright ï¼Œå¦‚ä¸‹: 12# Footer `powered-by` and `theme-info` copyrightcopyright: false æ·»åŠ æ–‡ç« ç»“æŸæ ‡è®°åœ¨themes/next/layout/_macro/post.swigä¸­, åœ¨wechat-subscriber.swigä¹‹å‰æ·»åŠ å¦‚ä¸‹ä»£ç :123&lt;div style="text-align:center;color: #ccc;font-size:14px;"&gt;---------------- The End ----------------&lt;/div&gt; ç»Ÿè®¡åŠŸèƒ½ï¼Œç»Ÿè®¡åŠŸèƒ½,æ˜¾ç¤ºæ–‡ç« å­—æ•°ç»Ÿè®¡,é˜…è¯»æ—¶é•¿,æ€»å­—æ•°åœ¨ç«™ç‚¹çš„æ ¹ç›®å½•ä¸‹ï¼š1$ npm i --save hexo-wordcount æ‰“å¼€ themes/next/_config.yml ï¼Œæœç´¢å…³é”®å­— post_wordcountï¼š1234567891011# Post wordcount display settings# Dependencies: https://github.com/willin/hexo-wordcountpost_wordcount: item_text: true #å­—æ•°ç»Ÿè®¡ wordcount: true #é¢„è§ˆæ—¶é—´ min2read: true #æ€»å­—æ•°,æ˜¾ç¤ºåœ¨é¡µé¢åº•éƒ¨ totalcount: true separated_meta: true è®¾ç½®å¤´åƒæ‰“å¼€ themes/next/_config.yml ï¼Œæœç´¢å…³é”®å­— avatarï¼š123456789101112# Sidebar Avataravatar: # In theme directory (source/images): /images/avatar.gif # In site directory (source/uploads): /uploads/avatar.gif # You can also use other linking images. url: http://pw5u1sbg2.bkt.clouddn.com/avatar.png #/images/avatar.png # If true, the avatar would be dispalyed in circle. rounded: true # The value of opacity should be choose from 0 to 1 to set the opacity of the avatar. opacity: 1 # If true, the avatar would be rotated with the cursor. rotated: false åº•éƒ¨æ·»åŠ è®¿é—®é‡å’Œå­—æ•°ç»Ÿè®¡è¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œè§nexTå®˜ç½‘ï¼Œæ¨èç™¾åº¦ç»Ÿè®¡å’Œä¸è’œå­ç»Ÿè®¡ã€‚ åº•éƒ¨æ·»åŠ è¿è¡Œæ—¶é—´æ‰¾åˆ°\themes\next\layout\_partials\ä¸‹é¢çš„footer.swigæ–‡ä»¶ï¼Œåœ¨æœ«å°¾æ·»åŠ æ‰€ç¤ºä»£ç ï¼š12345678910111213141516171819&lt;div class="run_time" style=" text-align:center;"&gt; &lt;span id="timeDate"&gt;è½½å…¥å¤©æ•°...&lt;/span&gt;&lt;span id="times"&gt;è½½å…¥æ—¶åˆ†ç§’...&lt;/span&gt; &lt;script&gt; var now = new Date(); function createtime() &#123; var grt= new Date("08/06/2019 19:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´ now.setTime(now.getTime()+250); days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); if(String(hnum).length ==1 )&#123;hnum = "0" + hnum;&#125; minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); mnum = Math.floor(minutes); if(String(mnum).length ==1 )&#123;mnum = "0" + mnum;&#125; seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); snum = Math.round(seconds); if(String(snum).length ==1 )&#123;snum = "0" + snum;&#125; document.getElementById("timeDate").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ "+dnum+" å¤© "; document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’"; &#125; setInterval("createtime()",250); &lt;/script&gt;&lt;/div&gt; åº•éƒ¨æ·»åŠ çº¢å¿ƒæ‰“å¼€ themes/next/_config.yml ï¼Œæœç´¢å…³é”®å­— footerï¼š123456789101112131415footer: # Specify the date when the site was setup. If not defined, current year will be used. since: 2019 # visitors count counter: true # Icon between year and copyright info. icon: # Icon name in fontawesome, see: https://fontawesome.com/v4.7.0/icons/ # `heart` is recommended with animation in red (#ff0000). name: heart # If you want to animate the icon, set it to true. animated: true # Change the color of icon, using Hex Code. color: "#ff0000" æ·»åŠ ä¾§è¾¹æ éŸ³ä¹æ¡†å»å¾€ç½‘æ˜“äº‘éŸ³ä¹æœç´¢å–œæ¬¢çš„éŸ³ä¹ï¼Œç‚¹å‡»ç”Ÿæˆå¤–é“¾æ’­æ”¾å™¨ï¼Œ å¤åˆ¶ä»£ç ç›´æ¥æ”¾åˆ°åšæ–‡æœ«å°¾å³å¯ï¼Œheightè®¾ä¸º0å¯éšè—æ’­æ”¾å™¨ï¼Œä½†ä»ç„¶å¯ä»¥æ’­æ”¾éŸ³ä¹ï¼Œautoè®¾æˆ0å¯æ‰‹åŠ¨æ’­æ”¾ï¼Œé»˜è®¤æ˜¯1è‡ªåŠ¨æ’­æ”¾ï¼Œå¯æŠŠä»£ç æ”¾åˆ°themes/next/layout/_custom/sidebar.swigæ–‡ä»¶é‡Œï¼Œæ’­æ”¾å™¨ä¼šæ˜¾ç¤ºåœ¨ç«™ç‚¹é¢„è§ˆä¸­,ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š12&lt;iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=110 src="//music.163.com/outchain/player?type=0&amp;id=2588481240&amp;auto=1&amp;height=90"&gt;&lt;/iframe&gt; æ·»åŠ aplayeréŸ³ä¹æ’­æ”¾ç”±äºæˆ‘æƒ³åœ¨å•ç‹¬çš„é¡µé¢åŠ å…¥æ­Œå•ï¼Œæ‰€ä»¥é¢å¤–åˆ›äº†ä¸ªé¡µé¢ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨æ–‡ç« ä¸­æ’å…¥ï¼ŒåŸç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚ æ–°å»ºé¡µé¢ï¼Œå‘½åä¸ºguestbookï¼š 1hexo new page guestbook è¿™æ—¶å€™åœ¨ /Hexo/source æ–‡ä»¶å¤¹ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªguestbookæ–‡ä»¶å¤¹ï¼Œæ‰“å¼€é‡Œé¢çš„index.mdï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š 123456789101112---title: ç•™è¨€äº’åŠ¨date: 2019-08-15 12:18:09type: "guestbook"---&lt;div align="center"&gt; &lt;img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1558956326532&amp;di=82cc9907fc903cfb978a35206986d3f6&amp;imgtype=0&amp;src=http%3A%2F%2Fimg.mp.itc.cn%2Fupload%2F20160809%2F31283a3e2d7f411492d3fb27297180ec_th.jpg" /&gt;&lt;/div&gt;[//]: #(aplayéŸ³é¢‘æ’­æ”¾https://github.com/MoePlayer/hexo-tag-aplayer)&#123;% meting "2331951308" "netease" "playlist" "autoplay" "mutex:false" "order:random" "listmaxheight:250px" "preload:none" "theme:#f7f7f7"%&#125; metingä¸­é…ç½®å‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š é€‰é¡¹ é»˜è®¤å€¼ æè¿° id å¿…é¡»å€¼ æ­Œæ›² id / æ’­æ”¾åˆ—è¡¨ id / ç›¸å†Œ id / æœç´¢å…³é”®å­— server å¿…é¡»å€¼ éŸ³ä¹å¹³å°: netease, tencent, kugou, xiami, baidu type å¿…é¡»å€¼ song, playlist, album, search, artist fixed false å¼€å¯å›ºå®šæ¨¡å¼ mini false å¼€å¯å›ºå®šæ¨¡å¼ loop all åˆ—è¡¨å¾ªç¯æ¨¡å¼ï¼šall, one,none order list åˆ—è¡¨æ’­æ”¾æ¨¡å¼ï¼š list, random volume 0.7 æ’­æ”¾å™¨éŸ³é‡ lrctype 0 æ­Œè¯æ ¼å¼ç±»å‹ listfolded false æŒ‡å®šéŸ³ä¹æ’­æ”¾åˆ—è¡¨æ˜¯å¦æŠ˜å  storagename metingjs LocalStorage ä¸­å­˜å‚¨æ’­æ”¾å™¨è®¾å®šçš„é”®å autoplay true è‡ªåŠ¨æ’­æ”¾ï¼Œç§»åŠ¨ç«¯æµè§ˆå™¨æš‚æ—¶ä¸æ”¯æŒæ­¤åŠŸèƒ½ mutex true è¯¥é€‰é¡¹å¼€å¯æ—¶ï¼Œå¦‚æœåŒé¡µé¢æœ‰å…¶ä»– aplayer æ’­æ”¾ï¼Œè¯¥æ’­æ”¾å™¨ä¼šæš‚åœ theme #ad7a86 æ’­æ”¾å™¨é£æ ¼è‰²å½©è®¾ç½® listmaxheight 340px æ’­æ”¾åˆ—è¡¨çš„æœ€å¤§é•¿åº¦ preload auto éŸ³ä¹æ–‡ä»¶é¢„è½½å…¥æ¨¡å¼ï¼Œå¯é€‰é¡¹ï¼š none, metadata, auto æ‰“å¼€ä¸»é¢˜_config.ymlæ–‡ä»¶ï¼Œåœ¨menuä¸‹æ–°å»ºä¸€ä¸ªåä¸ºguestbookçš„ç±»ï¼Œå®Œæˆåå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567menu: home: / || home tags: /tags/ || tags categories: /categories/ || bookmark archives: /archives/ || archive about: /about/ || user äº’åŠ¨: /guestbook/ || comments æ‰“å¼€/Hexo/themes/hexo-theme-next/languages/zh-Hans.ymlï¼Œæ·»åŠ å¯¹åº”çš„ä¸­æ–‡ç¿»è¯‘ï¼š 12menu: guestbook: äº’åŠ¨ è‡³æ­¤ï¼Œæ­Œå•é¡µé¢åˆ›å»ºå®Œæˆï¼Œç°åœ¨åªéœ€è¦åœ¨ç«™ç‚¹é…ç½®æ–‡ä»¶ä¸­å¼€å¯metingæ¨¡å¼ï¼Œåœ¨_config.ymlä¸­æœç´¢metingï¼š 12aplayer: meting: true TipåŒä¸€ä¸ªæ­Œå•ä¸èƒ½åšåˆ°å®æ—¶åˆ·æ–°ï¼Œéœ€è¦24å°æ—¶åaplayeræ‰ä¼šè‡ªåŠ¨æ›´æ–°ç¼“å­˜ æ·»åŠ åšå®¢å·¦ä¸‹è§’é—¨ç¥å®‰è£…ä¾èµ–:12npm install --save hexo-helper-live2dnpm install --save live2d-widget-model-wanko ç«™ç‚¹é…ç½®æ·»åŠ :12345678910111213141516171819202122# hexo-helper-live2dé…ç½®, å‚è€ƒhttps://github.com/EYHN/hexo-helper-live2d/blob/master/README.zh-CN.mdlive2d: enable: true scriptFrom: local pluginRootPath: live2dw/ pluginJsPath: lib/ pluginModelPath: assets/ tagMode: false debug: false model: scale: 1 use: live2d-widget-model-wanko display: superSample: 2 # è¶…é‡‡æ ·ç­‰çº§ width: 100 height: 100 position: left # ä½ç½® mobile: show: false react: opacityDefault: 0.9 # é»˜è®¤é€æ˜åº¦ opacityOnHover: 0.5 # é¼ æ ‡ç§»ä¸Šé€æ˜åº¦ å¢åŠ é¦–é¡µpaceåŠ è½½è¿›åº¦æ‰“å¼€ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼š12345678# Progress bar in the top during page loading.# Dependencies: https://github.com/theme-next/theme-next-pacepace: true# Themes list:# pace-theme-big-counter | pace-theme-bounce | pace-theme-barber-shop | pace-theme-center-atom# pace-theme-center-circle | pace-theme-center-radar | pace-theme-center-simple | pace-theme-corner-indicator# pace-theme-fill-left | pace-theme-flash | pace-theme-loading-bar | pace-theme-mac-osx | pace-theme-minimalpace_theme: pace-theme-bounce å¢åŠ å›¾ç‰‡æ‡’åŠ è½½lazyloadæ‰“å¼€ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼š123# Vanilla JavaScript plugin for lazyloading images.# Dependencies: https://github.com/theme-next/theme-next-jquery-lazyloadlazyload: true å¢åŠ fancyboxå’Œfastclickè§£å†³å»¶è¿Ÿé—®é¢˜æ‰“å¼€ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼š123456789# Fancybox. There is support for old version 2 and new version 3.# Choose only one variant, do not need to install both.# To install 2.x: https://github.com/theme-next/theme-next-fancybox# To install 3.x: https://github.com/theme-next/theme-next-fancybox3fancybox: true# Polyfill to remove click delays on browsers with touch UIs.# Dependencies: https://github.com/theme-next/theme-next-fastclickfastclick: true æˆªæ–­é¦–é¡µæ–‡ç« å†…å®¹æ‰“å¼€ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œæœç´¢auto_excerptï¼š12345# Automatically Excerpt (Not recommend).# Use &lt;!-- more --&gt; in the post to control excerpt accurately.auto_excerpt: enable: true length: 150 ä»£ç å¤åˆ¶åŠŸèƒ½ å¤åˆ¶è¯¥ç½‘é¡µçš„ä»£ç ï¼Œä¼ é€é—¨ï¼šclipboard.min.jsï¼Œç„¶ååœ¨themes\next\source\js\srcä¸‹æ–°å»ºclipboard.min.jsæ–‡ä»¶ï¼Œå°†ä»¥ä¸Šå†…å®¹å¤åˆ¶è¿›å»å³å¯ï¼› åœ¨themes\next\source\js\srcç›®å½•ä¸‹ï¼Œåˆ›å»ºclipboard-use.jsï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718 /*é¡µé¢è½½å…¥å®Œæˆåï¼Œåˆ›å»ºå¤åˆ¶æŒ‰é’®*/ !function (e, t, a) &#123; /* code */ var initCopyCode = function()&#123; var copyHtml = ''; copyHtml += '&lt;button class="btn-copy" data-clipboard-snippet=""&gt;'; //fa fa-globeå¯ä»¥å»å­—ä½“åº“æ›¿æ¢è‡ªå·±æƒ³è¦çš„å›¾æ ‡copyHtml += ' &lt;i class="fa fa-clipboard"&gt;&lt;/i&gt;&lt;span&gt;copy&lt;/span&gt;'; copyHtml += '&lt;/button&gt;'; $(".highlight .code pre").before(copyHtml); new ClipboardJS('.btn-copy', &#123; target: function(trigger) &#123; return trigger.nextElementSibling; &#125; &#125;); &#125; initCopyCode(); &#125;(window, document); åœ¨themes\next\source\css\_custom\custom.stylæ ·å¼æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536//ä»£ç å—å¤åˆ¶æŒ‰é’®.highlight&#123; //æ–¹ä¾¿copyä»£ç æŒ‰é’®ï¼ˆbtn-copyï¼‰çš„å®šä½ position: relative;&#125;.btn-copy &#123; display: inline-block; cursor: pointer; background-color: #eee; background-image: linear-gradient(#fcfcfc,#eee); border: 1px solid #d5d5d5; border-radius: 3px; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; -webkit-appearance: none; font-size: 13px; font-weight: 700; line-height: 20px; color: #333; -webkit-transition: opacity .3s ease-in-out; -o-transition: opacity .3s ease-in-out; transition: opacity .3s ease-in-out; padding: 2px 6px; position: absolute; right: 5px; top: 5px; opacity: 0;&#125;.btn-copy span &#123; margin-left: 5px;&#125;.highlight:hover .btn-copy&#123; opacity: 1;&#125; åœ¨themes\next\layout\_layout.swigæ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¼•ç”¨ï¼ˆæ³¨ï¼šåœ¨ swig æœ«å°¾æˆ– body ç»“æŸæ ‡ç­¾ï¼ˆL2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"superSample":1,"width":250,"height":300,"position":"left"},"mobile":{"show":false},"react":{"opacityDefault":0.9,"opacityOnHover":0.5},"log":false});ï¼‰ä¹‹å‰æ·»åŠ ï¼‰ï¼š 123&lt;!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ --&gt;&lt;script type="text/javascript" src="/js/src/clipboard.min.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="/js/src/clipboard-use.js"&gt;&lt;/script&gt; å°è¯•äº†ä½†æœªå®ç°çš„åŠŸèƒ½1.ç”¨mob_shareçš„app_keyæœªèƒ½å®ç°shareçš„åŠŸèƒ½ï¼Œç»è¿‡å…¶å®˜æ–¹äººå‘˜ç”µè¯æ²Ÿé€šï¼Œå·²ç»ä¸å†æ”¯æŒpcç«¯åšå®¢æœåŠ¡2.aplayéŸ³ä¹æ’­æ”¾æ­Œå•ï¼Œä¸èƒ½åšåˆ°å®æ—¶æ›´æ–°æ­Œå•ï¼Œç©¶å…¶åŸå› æ˜¯å…¶apiè®¾ç½®äº†24å°æ—¶ç¼“å­˜ï¼ŒåŒä¸€ä¸ªæ­Œå•24å°æ—¶å†…ä¸ä¼šå‘ç”Ÿæ”¹å˜ éå¸¸æœ‰ç›Šçš„ç½‘å€ NexTä¸»é¢˜è¿›é˜¶ åŸºäºHexoçš„ä¸ªäººåšå®¢æ­å»º(è¿›é˜¶ç‰ˆ) Hexo+Nextä¸»é¢˜ä¼˜åŒ–]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>NexT</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‰‘æŒ‡offerç®—æ³•é¢˜]]></title>
    <url>%2F2019%2F08%2F12%2F%E5%89%91%E6%8C%87offer%E7%AE%97%E6%B3%95%E9%A2%98.html</url>
    <content type="text"><![CDATA[äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾é¢˜ç›®æè¿°åœ¨ä¸€ä¸ªäºŒç»´æ•°ç»„ä¸­ï¼ˆæ¯ä¸ªä¸€ç»´æ•°ç»„çš„é•¿åº¦ç›¸åŒï¼‰ï¼Œæ¯ä¸€è¡Œéƒ½æŒ‰ç…§ä»å·¦åˆ°å³é€’å¢çš„é¡ºåºæ’åºï¼Œæ¯ä¸€åˆ—éƒ½æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é€’å¢çš„é¡ºåºæ’åºã€‚è¯·å®Œæˆä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥è¿™æ ·çš„ä¸€ä¸ªäºŒç»´æ•°ç»„å’Œä¸€ä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å«æœ‰è¯¥æ•´æ•°ã€‚ è§£é¢˜æ€è·¯è¦æ±‚æ—¶é—´å¤æ‚åº¦ O(M + N)ï¼Œç©ºé—´å¤æ‚åº¦ O(1)ã€‚å…¶ä¸­ M ä¸ºè¡Œæ•°ï¼ŒN ä¸ºåˆ—æ•°ã€‚è¯¥äºŒç»´æ•°ç»„ä¸­çš„ä¸€ä¸ªæ•°ï¼Œå°äºå®ƒçš„æ•°ä¸€å®šåœ¨å…¶å·¦è¾¹ï¼Œå¤§äºå®ƒçš„æ•°ä¸€å®šåœ¨å…¶ä¸‹è¾¹ã€‚å› æ­¤ï¼Œä»å³ä¸Šè§’å¼€å§‹æŸ¥æ‰¾ï¼Œå°±å¯ä»¥æ ¹æ® target å’Œå½“å‰å…ƒç´ çš„å¤§å°å…³ç³»æ¥ç¼©å°æŸ¥æ‰¾åŒºé—´ï¼Œå½“å‰å…ƒç´ çš„æŸ¥æ‰¾åŒºé—´ä¸ºå·¦ä¸‹è§’çš„æ‰€æœ‰å…ƒç´ ã€‚ My code1234567891011121314151617# -*- coding:utf-8 -*-class Solution: # array äºŒç»´åˆ—è¡¨ def Find(self, target, array): # write code here row = len(array) col = len(array[0]) c = col - 1 r = 0 while(r &lt;= row-1 and c &gt;=0): if(target == array[r][c]): return True elif(target &gt; array[r][c]): r+=1 else: c-=1 return False æ›¿æ¢ç©ºæ ¼é¢˜ç›®æè¿°è¯·å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œå°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªç©ºæ ¼æ›¿æ¢æˆâ€œ%20â€ã€‚ä¾‹å¦‚ï¼Œå½“å­—ç¬¦ä¸²ä¸ºWe Are Happy.åˆ™ç»è¿‡æ›¿æ¢ä¹‹åçš„å­—ç¬¦ä¸²ä¸ºWe%20Are%20Happyã€‚ è§£é¢˜æ€è·¯å°†å­—ç¬¦ä¸²å¤åˆ¶ç»™ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œç¢°åˆ°ç©ºæ ¼åˆ™æ›¿æ¢ï¼Œæ²¡æœ‰åˆ™copyåŸå­—ç¬¦ä¸²ï¼Œæœ€åå¯¹åˆ—è¡¨è¿›è¡Œjoinï¼Œè¿”å›å­—ç¬¦ä¸²ã€‚ æ˜“é”™ç‚¹ My code12345678910111213141516171819202122# -*- coding:utf-8 -*-class Solution: # s æºå­—ç¬¦ä¸² def replaceSpace(self, s): # write code here t = len(s) j = 0 m = list(s) for i in range(0,t): if(s[i] == ' '): m[j] = '%20' j+=1 else: m[j] = s[i] j+=1 pass return ''.join(m)# s = 'I want to sleep'# solution = Solution()# ss = solution.replaceSpace(s)# print(ss) ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨é¢˜ç›®æè¿°è¾“å…¥ä¸€ä¸ªé“¾è¡¨ï¼ŒæŒ‰é“¾è¡¨å€¼ä»å°¾åˆ°å¤´çš„é¡ºåºè¿”å›ä¸€ä¸ªArrayListã€‚ è§£é¢˜æ€è·¯çŸ¥è¯†ç‚¹è¡¥å……pythonä¸­é“¾è¡¨çš„æ“ä½œ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768class Node(): 'åˆ›å»ºèŠ‚ç‚¹' def __init__(self,data): self.data = data self.next = None class LinkList(): 'åˆ›å»ºåˆ—è¡¨' def __init__(self, node): 'åˆå§‹åŒ–åˆ—è¡¨' self.head = node self.head.next = None self.tail = self.head def add_node(self, node): 'æ·»åŠ èŠ‚ç‚¹' self.tail.next = node self.tail = self.tail.next def view(self): 'æŸ¥çœ‹åˆ—è¡¨' node = self.head link_str = '' while node is not None: if node.next is not None: link_str += str(node.data) + '--&gt;' else: link_str += str(node.data) node = node.next print ('The Linklist is:' + link_str) def length(self): 'åˆ—è¡¨é•¿åº¦' node = self.head count = 1 while node.next is not None: count += 1 node = node.next print ('The length of linklist are %d' % count) return count def delete_node(self, index): 'åˆ é™¤èŠ‚ç‚¹' if index+1 &gt; self.length(): raise IndexError('index out of bounds') num = 0 node = self.head while True: if num == index-1: break node = node.next num += 1 tmp_node = node.next node.next = node.next.next return tmp_node.data def find_node(self, index): 'æŸ¥çœ‹å…·ä½“èŠ‚ç‚¹' if index+1 &gt; self.length(): raise IndexError('index out of bounds') num = 0 node = self.head while True: if num == index: break node = node.next num += 1 return node.data My code123456789101112131415# -*- coding:utf-8 -*-# class ListNode:# def __init__(self, x):# self.val = x# self.next = Noneclass Solution: # è¿”å›ä»å°¾éƒ¨åˆ°å¤´éƒ¨çš„åˆ—è¡¨å€¼åºåˆ—ï¼Œä¾‹å¦‚[1,2,3] def printListFromTailToHead(self, listNode): # write code here res=[] while listNode: res.append(listNode.val) listNode=listNode.next return res[::-1] #é€†åºæ‰“å° é‡å»ºäºŒå‰æ ‘é¢˜ç›®æè¿°è¾“å…¥æŸäºŒå‰æ ‘çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœï¼Œè¯·é‡å»ºå‡ºè¯¥äºŒå‰æ ‘ã€‚å‡è®¾è¾“å…¥çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœä¸­éƒ½ä¸å«é‡å¤çš„æ•°å­—ã€‚ä¾‹å¦‚è¾“å…¥å‰åºéå†åºåˆ—{1,2,4,7,3,5,6,8}å’Œä¸­åºéå†åºåˆ—{4,7,2,1,5,3,8,6}ï¼Œåˆ™é‡å»ºäºŒå‰æ ‘å¹¶è¿”å›ã€‚ è§£é¢˜æ€è·¯ é€’å½’ æ•´ä½“æ€è·¯å°±æ˜¯ï¼šåˆ©ç”¨é€’å½’çš„æ€æƒ³ï¼Œè·Ÿå½’å¹¶å’Œå¿«æ’æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚æŠ“ä½ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹ï¼Œç„¶ååœ¨ä¸­åºéå†ä¸­å®šä½è¯¥èŠ‚ç‚¹ï¼Œå·¦è¾¹å³ä¸ºæ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘ï¼Œå³è¾¹å³ä¸ºæ ¹èŠ‚ç‚¹çš„å³å­æ ‘ã€‚ç„¶åå¯¹å·¦å­æ ‘å’Œå³å­æ ‘åˆ†åˆ«è¿›è¡Œé€’å½’å³å¯ï¼Œç›´åˆ°å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ²¡äº†ã€‚ éé€’å½’ æ•´ä½“æ€è·¯ï¼šæˆ‘è¿˜æ²¡è®¤çœŸçœ‹å‘¢ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ ç”¨ä¸¤ä¸ªå †æ ˆæ¥åˆ†åˆ«å­˜å‚¨äºŒå‰æ ‘å’Œå…ˆåºä¸­åºåºåˆ—ç´¢å¼•å€¼ï¼Œè·Ÿé€’å½’æ€è·¯ä¸€æ ·ï¼Œå…ˆæ‰¾åˆ°æ ¹èŠ‚ç‚¹ï¼Œç„¶ååˆ†åˆ«åˆ¤æ–­åœ¨ä¸­åºéå†ä¸­æ˜¯å¦è¿˜æœ‰å·¦å³å­æ ‘ï¼Œå¦‚æœæœ‰åˆ™è®¡æ•°å€¼count+=1,å½“æ‰¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¹‹åå°±å°†è®¡æ•°å€¼count-=1ï¼Œç›´åˆ°ä¸­åºéå†ä¸­å†ä¹Ÿæ²¡æœ‰å·¦å³å­æ ‘ã€‚ My codeé€’å½’1234567891011121314151617181920212223242526272829303132333435/** * Definition for binary tree * public class TreeNode &#123; * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) &#123; val = x; &#125; * &#125; */public class Solution &#123; public TreeNode reConstructBinaryTree(int [] pre, int [] in) &#123; if(pre == null || in == null || pre.length == 0 || in.length == 0)&#123; return null; &#125; return constructBinaryTree(pre,in,0,pre.length-1,0,in.length-1); // é¦–å…ˆçœ‹å…ˆåºéå†çš„ç¬¬ä¸€ä¸ªæ•°ï¼Œè¿™æ˜¯æ ¹èŠ‚ç‚¹ï¼Œç„¶åæ ¹æ®ä¸­åºéå†ç„¶ååˆ†ä¸ºå·¦å³ä¸¤ä¸ªèŠ‚ç‚¹å— // å†çœ‹å·¦è¾¹çš„ç¬¬ä¸€ä¸ªæ•°ï¼Œè¿™ä¸ªè‚¯å®šæ˜¯æ ¹èŠ‚ç‚¹ï¼Œç„¶åå®šä½åˆ°ä¸­åºéå†è¯¥æ•°çš„ä½ç½®ï¼Œå†å°†å…¶åˆ†ä¸ºå·¦å³ä¸¤ä¸ªèŠ‚ç‚¹å—ï¼Œä»¥æ­¤ç±»æ¨ã€‚ &#125; private TreeNode constructBinaryTree(int[] pre, int[] in, int preStart, int preEnd, int inStart, int inEnd) &#123; if(preStart &gt; preEnd || inStart &gt; inEnd)&#123; return null; &#125; TreeNode node = new TreeNode(pre[preStart]); int mid = inStart; while (pre[preStart] != in[mid]) mid++; int preNumber = mid - inStart; node.left = constructBinaryTree(pre,in,preStart + 1,preStart + preNumber,inStart,mid - 1); node.right = constructBinaryTree(pre,in,preStart + preNumber + 1,preEnd,mid + 1,inEnd); return node; &#125;&#125; éé€’å½’123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475/** * Definition for binary tree * public class TreeNode &#123; * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) &#123; val = x; &#125; * &#125; */import java.util.*;public class Solution &#123; public TreeNode reConstructBinaryTree(int [] pre,int [] in) &#123; //pç”¨æ¥ä¿å­˜ä¸¤ä¸ªåºåˆ—çš„ç´¢å¼•å€¼ Stack&lt;Integer&gt; p = new Stack&lt;Integer&gt;(); Stack&lt;TreeNode&gt; l = new Stack&lt;TreeNode&gt;(); TreeNode cur = null; p.push(0); p.push(pre.length - 1); p.push(0); p.push(in.length - 1); int count = 1; int pStart = 0; int pEnd = pre.length - 1; int iStart = 0; int iEnd = in.length - 1; TreeNode root = new TreeNode(-1); l.push(root); while( count != 0)&#123; iEnd = p.pop(); iStart = p.pop(); pEnd = p.pop(); pStart = p.pop(); cur = l.pop(); count -= 1; int index = find(pre[pStart], in, iStart, iEnd); cur.val = pre[pStart]; int lenL = index - iStart; if(lenL == 0)&#123; &#125;else&#123; p.push(pStart + 1); p.push(pStart + lenL); p.push(iStart); p.push(index - 1); count += 1; cur.left = new TreeNode(-1); l.push(cur.left); &#125; int lenR = iEnd - index; if(lenR == 0)&#123; &#125;else&#123; p.push(pStart + lenL + 1); p.push(pEnd); p.push(index + 1); p.push(iEnd); count += 1; cur.right = new TreeNode(-1); l.push(cur.right); &#125; &#125; return root; &#125; int find(int target, int[] all, int start , int end)&#123; for(int i = start; i &lt;= end; ++i)&#123; if(all[i] == target) return i; &#125; return -1; &#125;&#125; çŸ¥è¯†ç‚¹è¡¥å……Tips: äºŒå‰æ ‘çš„å‰åºï¼Œä¸­åºï¼Œååºéå†æ–¹æ³•æ€»ç»“ å‰åºé€’å½’å’Œéé€’å½’ç®—æ³•å‰åºé€’å½’é€’å½’çš„æ–¹æ³•å¾ˆå®¹æ˜“å®ç°ï¼Œä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼šæˆ‘ä»¬å…ˆè®¿é—®æ ¹èŠ‚ç‚¹ï¼Œç„¶åé€’å½’è®¿é—®å·¦å­æ ‘ï¼Œå†é€’å½’è®¿é—®å³å­æ ‘ï¼Œå³å®ç°äº†æ ¹-&gt;å·¦-&gt;å³çš„è®¿é—®é¡ºåºï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯é€’å½’æ–¹æ³•ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªå­æ ‘éƒ½å®ç°äº†è¿™æ ·çš„é¡ºåºã€‚ 1234567891011121314class Solution &#123; public List&lt;Integer&gt; preorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; result = new LinkedList&lt;&gt;(); preorderHelper(root, result); return result; &#125; private void preorderHelper(TreeNode root, List&lt;Integer&gt; result) &#123; if (root == null) return; result.add(root.val); // è®¿é—®æ ¹èŠ‚ç‚¹ preorderHelper(root.left, result); // é€’å½’éå†å·¦å­æ ‘ preorderHelper(root.right, result); //é€’å½’éå†å³å­æ ‘ &#125;&#125; å‰åºéé€’å½’åœ¨è¿­ä»£æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ ˆæ¥å®ç°ã€‚ç”±äºå‡ºæ ˆé¡ºåºå’Œå…¥æ ˆé¡ºåºç›¸åï¼Œæ‰€ä»¥æ¯æ¬¡æ·»åŠ èŠ‚ç‚¹çš„æ—¶å€™å…ˆæ·»åŠ å³èŠ‚ç‚¹ï¼Œå†æ·»åŠ å·¦èŠ‚ç‚¹ã€‚è¿™æ ·åœ¨ä¸‹ä¸€è½®è®¿é—®å­æ ‘çš„æ—¶å€™ï¼Œå°±ä¼šå…ˆè®¿é—®å·¦å­æ ‘ï¼Œå†è®¿é—®å³å­æ ‘ï¼š 123456789101112131415161718class Solution &#123; public List&lt;Integer&gt; preorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; result = new LinkedList&lt;&gt;(); if (root == null) return result; Stack&lt;TreeNode&gt; toVisit = new Stack&lt;&gt;(); toVisit.push(root); TreeNode cur; while (!toVisit.isEmpty()) &#123; cur = toVisit.pop(); result.add(cur.val); // è®¿é—®æ ¹èŠ‚ç‚¹ if (cur.right != null) toVisit.push(cur.right); // å³èŠ‚ç‚¹å…¥æ ˆ if (cur.left != null) toVisit.push(cur.left); // å·¦èŠ‚ç‚¹å…¥æ ˆ &#125; return result; &#125;&#125; ä¸­åºé€’å½’å’Œéé€’å½’ç®—æ³•ä¸­åºé€’å½’æ— è®ºå¯¹äºå“ªç§æ–¹å¼ï¼Œé€’å½’çš„æ–¹æ³•æ€»æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ï¼Œä¹Ÿæ˜¯å¾ˆç¬¦åˆç›´è§‰çš„ã€‚å¯¹äºä¸­åºéå†ï¼Œå°±æ˜¯å…ˆè®¿é—®å·¦å­æ ‘ï¼Œå†è®¿é—®æ ¹èŠ‚ç‚¹ï¼Œå†è®¿é—®å³å­æ ‘ï¼Œå³ å·¦-&gt;æ ¹-&gt;å³ï¼š 1234567891011121314class Solution &#123; public List&lt;Integer&gt; inorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; result = new LinkedList&lt;&gt;(); inorderHelper(root, result); return result; &#125; private void inorderHelper(TreeNode root, List&lt;Integer&gt; result) &#123; if(root == null) return; inorderHelper(root.left, result); // é€’å½’éå†å·¦å­æ ‘ result.add(root.val); // è®¿é—®æ ¹èŠ‚ç‚¹ inorderHelper(root.right, result); // é€’å½’éå†å³å­æ ‘ &#125;&#125; ä¸­åºéé€’å½’ä¸­åºéå†çš„è¿­ä»£æ³•è¦ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œå› ä¸ºæœ€å…ˆé‡åˆ°çš„æ ¹èŠ‚ç‚¹ä¸æ˜¯æœ€å…ˆè®¿é—®çš„ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¿é—®å·¦å­æ ‘ï¼Œå†å›é€€åˆ°æ ¹èŠ‚ç‚¹ï¼Œå†è®¿é—®æ ¹èŠ‚ç‚¹çš„å³å­æ ‘ï¼Œè¿™é‡Œçš„ä¸€ä¸ªéš¾ç‚¹æ˜¯ä»å·¦å­æ ‘å›é€€åˆ°æ ¹èŠ‚ç‚¹çš„æ“ä½œï¼Œè™½ç„¶å¯ä»¥ç”¨æ ˆæ¥å®ç°å›é€€ï¼Œä½†æ˜¯è¦æ³¨æ„åœ¨å‡ºæ ˆæ—¶ä¿å­˜æ ¹èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡æ ¹èŠ‚ç‚¹æ¥è®¿é—®å³å­æ ‘ï¼š 123456789101112131415161718class Solution &#123; public List&lt;Integer&gt; inorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; result = new LinkedList&lt;&gt;(); Stack&lt;TreeNode&gt; toVisit = new Stack&lt;&gt;(); TreeNode cur = root; while (cur != null || !toVisit.isEmpty()) &#123; while (cur != null) &#123; toVisit.push(cur); // æ·»åŠ æ ¹èŠ‚ç‚¹ cur = cur.left; // å¾ªç¯æ·»åŠ å·¦èŠ‚ç‚¹ &#125; cur = toVisit.pop(); // å½“å‰æ ˆé¡¶å·²ç»æ˜¯æœ€åº•å±‚çš„å·¦èŠ‚ç‚¹äº†ï¼Œå–å‡ºæ ˆé¡¶å…ƒç´ ï¼Œè®¿é—®è¯¥èŠ‚ç‚¹ result.add(cur.val); cur = cur.right; // æ·»åŠ å³èŠ‚ç‚¹ &#125; return result; &#125;&#125; åœ¨çœ‹è¿™éƒ¨åˆ†ä»£ç ä¸­ï¼Œè„‘æµ·ä¸­è¦æœ‰ä¸€ä¸ªæ¦‚å¿µï¼šå½“å‰æ ‘çš„æ ¹èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼Œæ˜¯å®ƒçš„å·¦å­æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚å› æ­¤ä»ä¸åŒçš„å±‚æ¬¡ä¸Šçœ‹ï¼Œå·¦èŠ‚ç‚¹ä¹Ÿæ˜¯æ ¹èŠ‚ç‚¹ã€‚å¦å¤–ï¼ŒLeetCodeä¸Šä¹Ÿæä¾›äº†å…³äºä¸­åºéå†çš„åŠ¨æ€å›¾çš„æ¼”ç¤ºï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å»çœ‹ä¸€çœ‹ã€‚ ååºé€’å½’å’Œéé€’å½’ç®—æ³•ååºé€’å½’æ— è®ºå¯¹äºå“ªç§æ–¹å¼ï¼Œé€’å½’çš„æ–¹æ³•æ€»æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ï¼Œä¹Ÿæ˜¯å¾ˆç¬¦åˆç›´è§‰çš„ã€‚å¯¹äºååºéå†ï¼Œå°±æ˜¯å…ˆè®¿é—®å·¦å­æ ‘ï¼Œå†è®¿é—®å³å­æ ‘ï¼Œå†è®¿é—®æ ¹èŠ‚ç‚¹ï¼Œå³ å·¦-&gt;å³-&gt;æ ¹ï¼š 1234567891011121314class Solution &#123; public List&lt;Integer&gt; postorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; result = new LinkedList&lt;&gt;(); postorderHelper(root, result); return result; &#125; private void postorderHelper(TreeNode root, List&lt;Integer&gt; result) &#123; if (root == null) return; postorderHelper(root.left, result); // éå†å·¦å­æ ‘ postorderHelper(root.right, result); // éå†å³å­æ ‘ result.add(root.val); // è®¿é—®æ ¹èŠ‚ç‚¹ &#125;&#125; ååºéé€’å½’å‰é¢è¯´è¿‡ï¼Œä¸ä¸­åºéå†ä¸åŒçš„æ˜¯ï¼Œååºéå†åœ¨è®¿é—®å®Œå·¦å­æ ‘å‘ä¸Šå›é€€åˆ°æ ¹èŠ‚ç‚¹çš„æ—¶å€™ä¸æ˜¯ç«‹é©¬è®¿é—®æ ¹èŠ‚ç‚¹çš„ï¼Œè€Œæ˜¯å¾—å…ˆå»è®¿é—®å³å­æ ‘ï¼Œè®¿é—®å®Œå³å­æ ‘ååœ¨å›é€€åˆ°æ ¹èŠ‚ç‚¹ï¼Œå› æ­¤ï¼Œåœ¨è¿­ä»£è¿‡ç¨‹ä¸­è¦å¤æ‚ä¸€ç‚¹ï¼š 1234567891011121314151617181920212223242526class Solution &#123; public List&lt;Integer&gt; postorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; result = new LinkedList&lt;&gt;(); Stack&lt;TreeNode&gt; toVisit = new Stack&lt;&gt;(); TreeNode cur = root; TreeNode pre = null; while (cur != null || !toVisit.isEmpty()) &#123; while (cur != null) &#123; toVisit.push(cur); // æ·»åŠ æ ¹èŠ‚ç‚¹ cur = cur.left; // é€’å½’æ·»åŠ å·¦èŠ‚ç‚¹ &#125; cur = toVisit.peek(); // å·²ç»è®¿é—®åˆ°æœ€å·¦çš„èŠ‚ç‚¹äº† //åœ¨ä¸å­˜åœ¨å³èŠ‚ç‚¹æˆ–è€…å³èŠ‚ç‚¹å·²ç»è®¿é—®è¿‡çš„æƒ…å†µä¸‹ï¼Œè®¿é—®æ ¹èŠ‚ç‚¹ if (cur.right == null || cur.right == pre) &#123; toVisit.pop(); result.add(cur.val); pre = cur; cur = null; &#125; else &#123; cur = cur.right; // å³èŠ‚ç‚¹è¿˜æ²¡æœ‰è®¿é—®è¿‡å°±å…ˆè®¿é—®å³èŠ‚ç‚¹ &#125; &#125; return result; &#125;&#125; è¿™é‡Œå°¤å…¶æ³¨æ„åç»­éå†å’Œä¸­åºéå†ä¸­å¯¹äºä»æœ€å·¦ä¾§èŠ‚ç‚¹å‘ä¸Šå›é€€æ—¶çš„å¤„ç†ï¼š åœ¨ååºéå†ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨çš„æ˜¯ï¼š 1cur = toVisit.peek(); æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯peekè€Œä¸æ˜¯popï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦é¦–å…ˆå»è®¿é—®å³èŠ‚ç‚¹ï¼Œä¸‹é¢çš„ï¼š 1if (cur.right == null || cur.right == pre) å°±æ˜¯ç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨å³èŠ‚ç‚¹ï¼Œæˆ–è€…å³èŠ‚ç‚¹æ˜¯å¦å·²ç»è®¿é—®è¿‡äº†ï¼Œå¦‚æœå³èŠ‚ç‚¹å·²ç»è®¿é—®è¿‡äº†ï¼Œåˆ™æ¥ä¸‹æ¥çš„æ“ä½œå°±å’Œä¸­åºéå†çš„æƒ…å†µå·®ä¸å¤šäº†ï¼Œæ‰€ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œå¤šäº†ä¸¤æ­¥ï¼š 12pre = cur;cur = null; è¿™ä¸¤æ­¥çš„ç›®çš„éƒ½æ˜¯ä¸ºäº†åœ¨ä¸‹ä¸€è½®éå†ä¸­ä¸å†è®¿é—®è‡ªå·±ï¼Œcur = nullå¾ˆå¥½ç†è§£ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»åœ¨ä¸€è½®ç»“æŸåæ”¹å˜curçš„å€¼ï¼Œä»¥æ·»åŠ ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥å®ƒå’Œcur = cur.rightä¸€æ ·ï¼Œç›®çš„éƒ½æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªå¾…éå†çš„èŠ‚ç‚¹ï¼Œåªæ˜¯åœ¨è¿™é‡Œï¼Œå³èŠ‚ç‚¹å·²ç»è®¿é—®è¿‡äº†ï¼Œåˆ™ä»¥å½“å‰èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„æ•´ä¸ªå­æ ‘éƒ½å·²ç»è®¿é—®è¿‡äº†ï¼Œæ¥ä¸‹æ¥åº”è¯¥å›é€€åˆ°å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œè€Œå½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å·²ç»åœ¨æ ˆé‡Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶æ²¡æœ‰æ–°çš„èŠ‚ç‚¹è¦æ·»åŠ ï¼Œç›´æ¥å°†curè®¾ä¸ºnullå³å¯ã€‚ pre = cur çš„ç›®çš„æœ‰ç‚¹ç±»ä¼¼äºå°†å½“å‰èŠ‚ç‚¹æ ‡è®°ä¸ºå·²è®¿é—®ï¼Œå®ƒæ˜¯å’Œifæ¡ä»¶ä¸­çš„cur.right == preé…åˆä½¿ç”¨çš„ã€‚æ³¨æ„è¿™é‡Œçš„ä¸¤ä¸ªcuræŒ‡çš„ä¸æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ã€‚æˆ‘ä»¬å‡è®¾å½“å‰èŠ‚ç‚¹ä¸ºCï¼Œå½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸ºAï¼Œè€ŒCæ˜¯Açš„å³å­©å­ï¼Œåˆ™å½“å‰curæ˜¯Cï¼Œä½†åœ¨ä¸€è½®ä¸­ï¼Œcurå°†å˜æˆAï¼Œåˆ™ï¼š 123 A / \B C (pre) pre = cur å°±æ˜¯ pre = C if (cur.right == null || cur.right == pre) å°±æ˜¯ if (A.right == null || A.right == pre) è¿™é‡Œï¼Œç”±äºAæ˜¯æœ‰å³èŠ‚ç‚¹çš„ï¼Œå®ƒçš„å³èŠ‚ç‚¹å°±æ˜¯Cï¼Œæ‰€ä»¥A.right == nullä¸æˆç«‹ã€‚ä½†æ˜¯CèŠ‚ç‚¹æˆ‘ä»¬åœ¨ä¸Šä¸€è½®å·²ç»è®¿é—®è¿‡äº†ï¼Œæ‰€ä»¥è¿™é‡Œä¸ºäº†é˜²æ­¢è¿›å…¥elseè¯­å¥é‡å¤æ·»åŠ èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¤šåŠ äº†ä¸€ä¸ªA.right == preæ¡ä»¶ï¼Œå®ƒè¡¨ç¤ºAçš„å³èŠ‚ç‚¹å·²ç»è®¿é—®è¿‡äº†ï¼Œæˆ‘ä»¬å¾—ä»¥è¿›å…¥ifè¯­å¥å†…ï¼Œç›´æ¥è®¿é—®AèŠ‚ç‚¹ã€‚ ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—tipsï¼šåªè¦æ˜¯å…³äºæœ‰åºæ•°ç»„ï¼ŒåŸºæœ¬å°±åœ¨è€ƒå¯ŸäºŒåˆ†æ³• æ–æ³¢é‚£å¥‘æ•°åˆ—å˜æ€è·³å°é˜¶]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>å‰‘æŒ‡offer</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åœ¨macOSä¸Šä½¿ç”¨GitHub Pages+Hexoæ­å»ºä¸ªäººåšå®¢]]></title>
    <url>%2F2019%2F08%2F08%2F%E5%9C%A8macOS%E4%B8%8A%E4%BD%BF%E7%94%A8GitHub-Pages-Hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2.html</url>
    <content type="text"><![CDATA[æ­å»ºç¯å¢ƒæ“ä½œç³»ç»Ÿï¼šmacos 10.14.5å·¥å…·ï¼šgithub Desktop, Node.js, Gitæ¡†æ¶ï¼šHexo, Github Pages å…·ä½“æ­¥éª¤å®‰è£…gitç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥git --versionåˆ¤æ–­è‡ªå·±ç³»ç»Ÿæ˜¯å¦å·²æœ‰gitï¼Œå¦‚æœæ²¡æœ‰ï¼Œç‚¹å‡»è¯¥é“¾æ¥gitä¸‹è½½ï¼Œå®‰è£…å®Œåè¿›å…¥ç»ˆç«¯è¾“å…¥git --versionæ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸã€‚ å®‰è£…node.jsè¯ä¸å¤šè¯´ï¼Œä¸Šé“¾æ¥ï¼šnode.jsä¸‹è½½ï¼Œç„¶åå‚»ç“œå¼å®‰è£…å°±è¡Œã€‚å®‰è£…å®Œä¹‹åè¯·è®°å¾—å»æ§åˆ¶å°çœ‹çœ‹æ˜¯å¦å®‰è£…æˆåŠŸnode --version,ç„¶åæ›´æ–°ä¸€ä¸‹npm,è¾“å…¥:npm install -g npm æ³¨å†Œè´¦å·å¹¶åˆ›å»ºåšå®¢ä»“åº“a.é¦–å…ˆè¿›å…¥githubå®˜ç½‘ï¼šgithub,è¿›è¡Œç›¸åº”çš„æ³¨å†Œç™»å½•ï¼Œç„¶ååˆ›å»ºä»“åº“ï¼Œå°±åœ¨å·¦ä¸Šè§’é‚£ä¸ªçŒ«çŒ«æ—è¾¹ã€‚b.æˆ³è¿›å»ä¹‹å,Respository nameå¿…é¡»æ˜¯:æ‚¨çš„githubè´¦æˆ·å.github.io,ç„¶åå‹¾é€‰ä¸‹é¢çš„åˆ›å»ºreadmeï¼Œåˆ›å»ºå®Œæˆã€‚c.è¿›å…¥ä»“åº“ï¼Œç‚¹å‡»Settingï¼Œå¯ç”¨GitHub Pages,æ­¤æ—¶ä½ è¾“å…¥æ‚¨çš„githubè´¦æˆ·å.github.io,å°±èƒ½çœ‹åˆ°ä¸æ˜¯404äº†ï¼Œè¯´æ˜æ­¤æ—¶åšå®¢å·²ç»å»ºç«‹äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨Hexoæ¡†æ¶è®©ä½ çš„åšå®¢ç¾èµ·æ¥å•¦ï¼ï¼ï¼ï¼ å®‰è£…é…ç½®Hexoa.é¦–å…ˆå»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹(éšä¾¿ä½ å»ºåœ¨å“ª)b.åœ¨è¯¥æ–‡ä»¶å¤¹å†…æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ï¼š1$ npm install hexo-cli -g æ¥ä¸‹æ¥ä½ å°±èƒ½çœ‹åˆ°æ–‡ä»¶å¤¹å†…çš„ä¸œè¥¿å¤šäº†èµ·æ¥å“ˆå“ˆå“ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ–‡ä»¶ç»“æ„ï¼šc.Hexoå·²ç»æœ‰äº†ï¼Œgithub pagesä¹Ÿæœ‰äº†ï¼Œç°åœ¨å°±å‰©æŠŠä»–ä»¬è”ç³»èµ·æ¥äº†ï¼Œæ‰€ä»¥è¿™æ­¥å°±æ˜¯å…³é”®å’¯ï¼Œæ‰“å¼€ä¸Šå›¾ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼š_config.yml,ç„¶ååœ¨æ–‡æœ¬çš„ç»“å°¾åŠ ä¸Šä¸‹é¢çš„ä¸€æ®µä»£ç ï¼š1234deploy: type: git repository: https://github.com/jeromememory/jeromememory.github.io.git branch: master å…¶ä¸­repositoryå°±æ˜¯ä½ æœ€å¼€å§‹è®¾ç½®çš„ä»“åº“å“Ÿï¼Œè®°å¾—æ›¿æ¢è‡ªå·±çš„githubç”¨æˆ·åã€‚ æ£€æµ‹æ˜¯å¦éƒ¨ç½²æˆåŠŸé¦–å…ˆå¦‚æœä½ æƒ³åœ¨æœ¬åœ°é¢„è§ˆä½ çš„åšå®¢ï¼Œåªéœ€è¦æ‰“å¼€ç»ˆç«¯,é¦–å…ˆè¿›å…¥Hexoæ–‡ä»¶å¤¹å†…ï¼Œç„¶åè¿›è¡Œ hexo så³å¯ï¼š12$ cd /Users/jerome/Hexo $ hexo s ç„¶åä½ å°±ä¼šçœ‹åˆ°åœ¨ç»ˆç«¯æç¤ºä½ åœ¨localhost:4000é¢„è§ˆä½ çš„åšå®¢å•¦ï¼ï¼å¦‚æœä½ æƒ³åœ¨ç½‘é¡µä¸Šçœ‹åˆ°ä½ çš„åšå®¢ï¼Œåªéœ€è¦åœ¨ç»ˆç«¯è¾“å…¥ï¼š12$ hexo g$ hexo d ç¨ç­‰ä¸€å°ä¼š(github pageséœ€è¦ä¸€å°æ®µæ—¶é—´æ‰ä¼šæ›´æ–°)ï¼Œä½ å°±èƒ½åœ¨ä½ ä»“åº“å¯¹åº”çš„é‚£ä¸ªç½‘å€(æ‚¨çš„githubç”¨æˆ·å.io.git)çœ‹åˆ°æ‚¨çš„åšå®¢äº†ï¼Œè‡³æ­¤ï¼Œæ‚¨çš„åšå®¢åº”è¯¥å°±å·²ç»æ­å»ºå®Œæˆäº†ï¼Œå½“ç„¶æ‚¨è‚¯å®šä¼šè¯´è¿™ä¹Ÿå¤ªä¸‘äº†å§ï¼Œå¯¹ï¼Œæˆ‘ä¹Ÿè§‰å¾—ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è¯·ç»§ç»­çœ‹ä¸‹é¢çš„æ“ä½œå§ï¼ï¼ï¼ Hexoä¸»é¢˜é…ç½®é»˜è®¤çš„ä¸»é¢˜å¾ˆä¸‘ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å»githubè¿™ä¸ªæœ€å¤§çš„å¼€æºç½‘ç«™æ‰¾äº†ï¼Œæˆ‘æ¨èHexoçš„nextä¸»é¢˜ï¼Œæˆ‘è‡ªå·±ç”¨çš„å°±æ˜¯è¿™ä¸ªï¼Œæç®€è‡³æï¼Œæ‰¾åˆ°åˆ«äººçš„ä¸»é¢˜ä¹‹åï¼ŒæŠŠä»–çš„ä»£ç cloneä¸‹æ¥ï¼Œæ”¾åˆ°/Hexo/themesè¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼šç„¶åå»å¼€å§‹çš„_config.ymlä¸­å®šä½åˆ°themeï¼Œå°†åé¢çš„å€¼æ”¹ä¸ºä½ çš„ä¸»é¢˜åï¼Œåˆ«å¿˜äº†ï¼Œæ”¹å®Œè¿™äº›åï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ï¼š12$ hexo g$ hexo d è¿‡ä¸€å°ä¼šä½ å°±èƒ½çœ‹åˆ°è‡ªå·±çš„ä¸»é¢˜å‘ç”Ÿå˜åŒ–å•¦ï¼å‰©ä¸‹çš„å…·ä½“é…ç½®ï¼Œæˆ‘å°±å·å·æ‡’æ”¾ä¸ªé“¾æ¥ï¼šNexTä¸»é¢˜ï¼Œå…¶ä»–ä¸»é¢˜çš„åŒå­¦ï¼Œä½ ä»¬ä¹Ÿå¯ä»¥è‡ªå·±æŸ¥ä¸€ä¸‹å¯¹åº”çš„å®˜ç½‘å“Ÿï¼Œéƒ½å†™çš„è´¼è¯¦ç»†ï¼Œå¥½ç”¨ï¼ æ€»ç»“è‡³æ­¤ï¼Œä¸ªäººåšå®¢å°±åº”è¯¥æ­å»ºå¥½äº†ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€æ”¶è·ï¼!(è¯è¯´ç¬¬ä¸€ç¯‡åšå®¢æœç„¶æ˜¯ç‹—å±ä¸é€šå•Šå¤§å®¶å‡‘åˆçœ‹å§)]]></content>
      <categories>
        <category>ç¨‹åºçŒ¿</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>GitHub Pages</tag>
      </tags>
  </entry>
</search>
